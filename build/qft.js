/*
 *  phina.assetloaderex.js
 *  2016/11/25
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//バックグラウンドでアセット読み込み
phina.define("phina.extension.AssetLoaderEx", {

    //進捗
    loadprogress: 0,

    //読み込み終了フラグ
    loadcomplete: false,

    init: function() {
    },

    load: function(assets, callback) {
        this._onLoadAssets = callback || function(){};
        var loader = phina.asset.AssetLoader();
        loader.load(assets);
        loader.on('load', function(e) {
            this.loadcomplete = true;
            this._onLoadAssets();
        }.bind(this));
        loader.onprogress = function(e) {
            this.loadprogress = e.progress;
        }.bind(this);
        return this;
    },
});

/*
 *  phina.extension.js
 *  2016/11/25
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//setAlphaを追加
phina.display.DisplayElement.prototype.setAlpha = function(val) {
    this.alpha = val;
    return this;
};

//スプライト機能拡張
phina.display.Sprite.prototype.setFrameTrimming = function(x, y, width, height) {
  this._frameTrimX = x || 0;
  this._frameTrimY = y || 0;
  this._frameTrimWidth = width || this.image.domElement.width - this._frameTrimX;
  this._frameTrimHeight = height || this.image.domElement.height - this._frameTrimY;
  return this;
}

phina.display.Sprite.prototype.setFrameIndex = function(index, width, height) {
  var sx = this._frameTrimX || 0;
  var sy = this._frameTrimY || 0;
  var sw = this._frameTrimWidth  || (this.image.domElement.width-sx);
  var sh = this._frameTrimHeight || (this.image.domElement.height-sy);

  var tw  = width || this.width;      // tw
  var th  = height || this.height;    // th
  var row = ~~(sw / tw);
  var col = ~~(sh / th);
  var maxIndex = row*col;
  index = index%maxIndex;

  var x   = index%row;
  var y   = ~~(index/row);
  this.srcRect.x = sx+x*tw;
  this.srcRect.y = sy+y*th;
  this.srcRect.width  = tw;
  this.srcRect.height = th;

  this._frameIndex = index;

  return this;
}

//エレメント同士の接触判定
phina.display.DisplayElement.prototype.isHitElement = function(elm) {
    //自分とテスト対象をグローバルへ変換
    var p = this.globalToLocal(elm);
    var target = phina.display.DisplayElement({width: elm.width, height: elm.height}).setPosition(p.x, p.y);

    if (this.boundingType == 'rect') {
        if (elm.boundingType == 'rect') {
            return phina.geom.Collision.testRectRect(this, target);
        } else {
            return phina.geom.Collision.testRectCircle(this, target);
        }
    } else {
        if (elm.boundingType == 'rect') {
            return phina.geom.Collision.testCiecleRect(this, target);
        } else {
            return phina.geom.Collision.testCircleCircle(this, target);
        }
    }
}

//子要素全て切り離し
phina.app.Element.prototype.removeChildren = function(beginIndex) {
    beginIndex = beginIndex || 0;
    var tempChildren = this.children.slice();
    var len = len = tempChildren.length;
    for (var i = beginIndex; i < len; ++i) {
        tempChildren[i].remove();
    }
    this.children = [];
}

/**
 * @method testLineLine
 * @static
 * 2つの線分が重なっているかどうかを判定します
 * 参考：http://www5d.biglobe.ne.jp/~tomoya03/shtml/algorithm/Intersection.htm
 *
 * ### Example
 *     p1 = phina.geom.Vector2(100, 100);
 *     p2 = phina.geom.Vector2(200, 200);
 *     p3 = phina.geom.Vector2(150, 240);
 *     p4 = phina.geom.Vector2(200, 100);
 * phina.geom.Collision.testLineLine(p1, p2, p3, p4); // => true
 *
 * @param {phina.geom.Vector2} p1 線分1の端の座標
 * @param {phina.geom.Vector2} p2 線分1の端の座標
 * @param {phina.geom.Vector2} p3 線分2の端の座標
 * @param {phina.geom.Vector2} p4 線分2の端の座標
 * @return {Boolean} 線分1と線分2が重なっているかどうか
 */
phina.geom.Collision.testLineLine = function(p1, p2, p3, p4) {
  //同一ＸＹ軸上に乗ってる場合の誤判定回避
  if (p1.x == p2.x && p1.x == p3.x && p1.x == p4.x) {
    var min = Math.min(p1.y, p2.y);
    var max = Math.max(p1.y, p2.y);
    if (min <= p3.y && p3.y <= max || min <= p4.y && p4.y <= max) return true;
    return false;
  }
  if (p1.y == p2.y && p1.y == p3.y && p1.y == p4.y) {
    var min = Math.min(p1.x, p2.x);
    var max = Math.max(p1.x, p2.x);
    if (min <= p3.x && p3.x <= max || min <= p4.x && p4.x <= max) return true;
    return false;
  }
  var a = (p1.x - p2.x) * (p3.y - p1.y) + (p1.y - p2.y) * (p1.x - p3.x);
  var b = (p1.x - p2.x) * (p4.y - p1.y) + (p1.y - p2.y) * (p1.x - p4.x);
  var c = (p3.x - p4.x) * (p1.y - p3.y) + (p3.y - p4.y) * (p3.x - p1.x);
  var d = (p3.x - p4.x) * (p2.y - p3.y) + (p3.y - p4.y) * (p3.x - p2.x);
  return a * b <= 0 && c * d <= 0;
}

/**
 * @method testRectLine
 * @static
 * 矩形と線分が重なっているかどうかを判定します
 *
 * ### Example
 *     rect = phina.geom.Rect(120, 130, 40, 50);
 *     p1 = phina.geom.Vector2(100, 100);
 *     p2 = phina.geom.Vector2(200, 200);
 * phina.geom.Collision.testRectLine(rect, p1, p2); // => true
 *
 * @param {phina.geom.Rect} rect 矩形領域オブジェクト
 * @param {phina.geom.Vector2} p1 線分の端の座標
 * @param {phina.geom.Vector2} p2 線分の端の座標
 * @return {Boolean} 矩形と線分が重なっているかどうか
 */
phina.geom.Collision.testRectLine = function(rect, p1, p2) {
    //包含判定(p1が含まれてれば良いのでp2の判定はしない）
    if (rect.left <= p1.x && p1.x <= rect.right && rect.top <= p1.y && p1.y <= rect.bottom ) return true;

    //矩形の４点
    var r1 = phina.geom.Vector2(rect.left, rect.top);     //左上
    var r2 = phina.geom.Vector2(rect.right, rect.top);    //右上
    var r3 = phina.geom.Vector2(rect.right, rect.bottom); //右下
    var r4 = phina.geom.Vector2(rect.left, rect.bottom);  //左下

    //矩形の４辺をなす線分との接触判定
    if (phina.geom.Collision.testLineLine(p1, p2, r1, r2)) return true;
    if (phina.geom.Collision.testLineLine(p1, p2, r2, r3)) return true;
    if (phina.geom.Collision.testLineLine(p1, p2, r3, r4)) return true;
    if (phina.geom.Collision.testLineLine(p1, p2, r1, r4)) return true;
    return false;
}


//円弧の描画
phina.define('phina.display.ArcShape', {
  superClass: 'phina.display.Shape',

  init: function(options) {
    options = ({}).$safe(options, {
      backgroundColor: 'transparent',
      fill: 'red',
      stroke: '#aaa',
      strokeWidth: 4,
      radius: 32,
      startAngle: 0,
      endAngle: 270,

      anticlockwise: false,
    });
    this.superInit(options);

    this.radius = options.radius;
    this.startAngle = options.startAngle;
    this.endAngle = options.endAngle;
    this.anticlockwise = options.anticlockwise;

    this.setBoundingType('circle');
  },

  prerender: function(canvas) {
    canvas.fillPie(0, 0, this.radius, this.startAngle, this.endAngle);
  },
});

/*
 *  phina.tiledmap.js
 *  2016/09/10
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

/**
 * @class phina.asset.TiledMap
 * @extends phina.asset.Asset
 * # TiledMapEditorで作成したtmxファイルを読み込みクラス
 */
phina.define("phina.asset.TiledMap", {
    superClass: "phina.asset.Asset",

    /**
     * @property image
     * 作成されたマップ画像
     */
    image: null,

    /**
     * @property tilesets
     * タイルセット情報
     */
    tilesets: null,

    /**
     * @property layers
     * レイヤー情報が格納されている配列
     */
    layers: null,

    init: function() {
        this.superInit();
    },

    _load: function(resolve) {
        //パス抜き出し
        this.path = "";
        var last = this.src.lastIndexOf("/");
        if (last > 0) {
            this.path = this.src.substring(0, last+1);
        }

        //終了関数保存
        this._resolve = resolve;

        // load
        var self = this;
        var xml = new XMLHttpRequest();
        xml.open('GET', this.src);
        xml.onreadystatechange = function() {
            if (xml.readyState === 4) {
                if ([200, 201, 0].indexOf(xml.status) !== -1) {
                    var data = xml.responseText;
                    data = (new DOMParser()).parseFromString(data, "text/xml");
                    self.dataType = "xml";
                    self.data = data;
                    self._parse(data);
//                    resolve(self);
                }
            }
        };
        xml.send(null);
    },

    /**
     * @method getMapData
     * 指定したマップレイヤーを配列として取得します。
     *
     * @param {String} layerName 対象レイヤー名
     */
    getMapData: function(layerName) {
        //レイヤー検索
        var data = null;
        for(var i = 0; i < this.layers.length; i++) {
            if (this.layers[i].name == layerName) {
                //コピーを返す
                return this.layers[i].data.concat();
            }
        }
        return null;
    },

    /**
     * @method getObjectGroup
     * オブジェクトグループを取得します
     *
     * グループ指定が無い場合、全レイヤーを配列にして返します。
     *
     * @param {String} grounpName 対象オブジェクトグループ名
     */
    getObjectGroup: function(groupName) {
        groupName = groupName || null;
        var ls = [];
        var len = this.layers.length;
        for (var i = 0; i < len; i++) {
            if (this.layers[i].type == "objectgroup") {
                if (groupName == null || groupName == this.layers[i].name) {
                    //レイヤー情報をクローンする
                    var obj = this._cloneObjectLayer(this.layers[i]);
                    if (groupName !== null) return obj;
                }
                ls.push(obj);
            }
        }
        return ls;
    },

    /**
     * @method getMapImage
     * マップイメージの作成
     *
     * 複数のマップレイヤーを指定出来ます。
     * 描画順序はTiledMapEditor側での指定順では無く、引数の順序となります（第一引数が一番下となる）
     *
     * @param {String}  対象レイヤー名
     */
    getImage: function(...args) {
        var numLayer = 0;
        for (var i = 0; i < this.layers.length; i++) {
            if (this.layers[i].type == "layer" || this.layers[i].type == "imagelayer") numLayer++;
        }
        if (numLayer == 0) return null;

        var generated = false;
        var width = this.width * this.tilewidth;
        var height = this.height * this.tileheight;
        var canvas = phina.graphics.Canvas().setSize(width, height);

        for (var i = 0; i < this.layers.length; i++) {
            var find = args.indexOf(this.layers[i].name);
            if (args.length == 0 || find >= 0) {
                //マップレイヤー
                if (this.layers[i].type == "layer" && this.layers[i].visible != "0") {
                    var layer = this.layers[i];
                    var mapdata = layer.data;
                    var width = layer.width;
                    var height = layer.height;
                    var opacity = layer.opacity || 1.0;
                    var count = 0;
                    for (var y = 0; y < height; y++) {
                        for (var x = 0; x < width; x++) {
                            var index = mapdata[count];
                                if (index !== -1) {
                                //マップチップを配置
                                this._setMapChip(canvas, index, x * this.tilewidth, y * this.tileheight, opacity);
                            }
                            count++;
                        }
                    }
                    generated = true;
                }
                //オブジェクトグループ
                if (this.layers[i].type == "objectgroup" && this.layers[i].visible != "0") {
                    var layer = this.layers[i];
                    var opacity = layer.opacity || 1.0;
                    layer.objects.forEach(function(e) {
                        if (e.gid) {
                            this._setMapChip(canvas, e.gid, e.x, e.y, opacity);
                        }
                    }.bind(this));
                    generated = true;
                }
                //イメージレイヤー
                if (this.layers[i].type == "imagelayer" && this.layers[i].visible != "0") {
                    var len = this.layers[i];
                    var image = phina.asset.AssetManager.get('image', this.layers[i].image.source);
                    canvas.context.drawImage(image.domElement, this.layers[i].x, this.layers[i].y);
                    generated = true;
                }
            }
        }

        if (!generated) return null;

        var texture = phina.asset.Texture();
        texture.domElement = canvas.domElement;
        return texture;
    },

    /**
     * @method _cloneObjectLayer
     * 引数として渡されたオブジェクトレイヤーをクローンして返します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _cloneObjectLayer: function(srcLayer) {
        var result = {}.$safe(srcLayer);
        result.objects = [];
        //レイヤー内オブジェクトのコピー
        srcLayer.objects.forEach(function(obj){
            var resObj = {
                properties: {}.$safe(obj.properties),
            }.$extend(obj);
            if (obj.ellipse) resObj.ellipse = obj.ellipse;
            if (obj.gid) resObj.gid = obj.gid;
            if (obj.polygon) resObj.polygon = obj.polygon.clone();
            if (obj.polyline) resObj.polyline = obj.polyline.clone();
            result.objects.push(resObj);
        });
        return result;
    },

    /**
     * @method _parse
     * 取得したTiledMapEditのデータをパースします。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parse: function(data) {
        //タイル属性情報取得
        var map = data.getElementsByTagName('map')[0];
        var attr = this._attrToJSON(map);
        this.$extend(attr);
        this.properties = this._propertiesToJSON(map);

        //タイルセット取得
        this.tilesets = this._parseTilesets(data);

        //タイルセット情報補完
        var defaultAttr = {
            tilewidth: 32,
            tileheight: 32,
            spacing: 0,
            margin: 0,
        };
        this.tilesets.chips = [];
        for (var i = 0; i < this.tilesets.length; i++) {
            //タイルセット属性情報取得
            var attr = this._attrToJSON(data.getElementsByTagName('tileset')[i]);
            attr.$safe(defaultAttr);
            attr.firstgid--;
            this.tilesets[i].$extend(attr);

            //マップチップリスト作成
            var t = this.tilesets[i];
            this.tilesets[i].mapChip = [];
            for (var r = attr.firstgid; r < attr.firstgid+attr.tilecount; r++) {
                var chip = {
                    image: t.image,
                    x: ((r - attr.firstgid) % t.columns) * (t.tilewidth + t.spacing) + t.margin,
                    y: Math.floor((r - attr.firstgid) / t.columns) * (t.tileheight + t.spacing) + t.margin,
                }.$safe(attr);
                this.tilesets.chips[r] = chip;
            }
        }

        //レイヤー取得
        this.layers = this._parseLayers(data);

        //イメージデータ読み込み
        this._checkImage();
    },

    /**
     * @method _checkImage
     * アセットに無いイメージデータをチェックして読み込みを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _checkImage: function() {
        var that = this;
        var imageSource = [];
        var loadImage = [];

        //一覧作成
        for (var i = 0; i < this.tilesets.length; i++) {
            var obj = {
                image: this.tilesets[i].image,
                transR: this.tilesets[i].transR,
                transG: this.tilesets[i].transG,
                transB: this.tilesets[i].transB,
            };
            imageSource.push(obj);
        }
        for (var i = 0; i < this.layers.length; i++) {
            if (this.layers[i].image) {
                var obj = {
                    image: this.layers[i].image.source
                };
                imageSource.push(obj);
            }
        }

        //アセットにあるか確認
        for (var i = 0; i < imageSource.length; i++) {
            var image = phina.asset.AssetManager.get('image', imageSource[i].image);
            if (image) {
                //アセットにある
            } else {
                //なかったのでロードリストに追加
                loadImage.push(imageSource[i]);
            }
        }

        //一括ロード
        //ロードリスト作成
        var assets = {
            image: []
        };
        for (var i = 0; i < loadImage.length; i++) {
            //イメージのパスをマップと同じにする
            assets.image[loadImage[i].image] = this.path+loadImage[i].image;
        }
        if (loadImage.length) {
            var loader = phina.asset.AssetLoader();
            loader.load(assets);
            loader.on('load', function(e) {
                //透過色設定反映
                loadImage.forEach(function(elm) {
                    var image = phina.asset.AssetManager.get('image', elm.image);
                    if (elm.transR !== undefined) {
                        var r = elm.transR, g = elm.transG, b = elm.transB;
                        image.filter(function(pixel, index, x, y, bitmap) {
                            var data = bitmap.data;
                            if (pixel[0] == r && pixel[1] == g && pixel[2] == b) {
                                data[index+3] = 0;
                            }
                        });
                    }
                });
                //読み込み終了
                that._resolve(that);
            }.bind(this));
        } else {
            //読み込み終了
            this._resolve(that);
        }
    },

    /**
     * @method _setMapChip
     * キャンバスの指定した座標にマップチップのイメージをコピーします。
     *
     * 内部で使用している関数です。
     * @private
     */
    _setMapChip: function(canvas, index, x, y, opacity) {
        //タイルセットからマップチップを取得
        var chip = this.tilesets.chips[index];
        if (!chip) {
            return;
        }
        var image = phina.asset.AssetManager.get('image', chip.image);
        if (!image) {
            console.log(chip.image);
        }
        canvas.context.drawImage(
            image.domElement,
            chip.x + chip.margin, chip.y + chip.margin,
            chip.tilewidth, chip.tileheight,
            x, y,
            chip.tilewidth, chip.tileheight);
    },

    /**
     * @method _propertiesToJSON
     * XMLプロパティをJSONに変換します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _propertiesToJSON: function(elm) {
        var properties = elm.getElementsByTagName("properties")[0];
        var obj = {};
        if (properties === undefined) {
            return obj;
        }
        for (var k = 0; k < properties.childNodes.length; k++) {
            var p = properties.childNodes[k];
            if (p.tagName === "property") {
                //propertyにtype指定があったら変換
                var type = p.getAttribute('type');
                var value = p.getAttribute('value');
                if (!value) value = p.textContent;
                if (type == "int") {
                    obj[p.getAttribute('name')] = parseInt(value, 10);
                } else if (type == "float") {
                    obj[p.getAttribute('name')] = parseFloat(value);
                } else if (type == "bool" ) {
                    if (value == "true") obj[p.getAttribute('name')] = true;
                    else obj[p.getAttribute('name')] = false;
                } else {
                    obj[p.getAttribute('name')] = value;
                }
            }
        }
        return obj;
    },

    /**
     * @method _propertiesToJSON
     * XML属性情報をJSONに変換します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _attrToJSON: function(source) {
        var obj = {};
        for (var i = 0; i < source.attributes.length; i++) {
            var val = source.attributes[i].value;
            val = isNaN(parseFloat(val))? val: parseFloat(val);
            obj[source.attributes[i].name] = val;
        }
        return obj;
    },

    /**
     * @method _propertiesToJSON_str
     * XMLプロパティをJSONに変換し、文字列で返します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _attrToJSON_str: function(source) {
        var obj = {};
        for (var i = 0; i < source.attributes.length; i++) {
            var val = source.attributes[i].value;
            obj[source.attributes[i].name] = val;
        }
        return obj;
    },

    /**
     * @method _parseTilesets
     * タイルセットのパースを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parseTilesets: function(xml) {
        var each = Array.prototype.forEach;
        var self = this;
        var data = [];
        var tilesets = xml.getElementsByTagName('tileset');
        each.call(tilesets, function(tileset) {
            var t = {};
            var props = self._propertiesToJSON(tileset);
            if (props.src) {
                t.image = props.src;
            } else {
                t.image = tileset.getElementsByTagName('image')[0].getAttribute('source');
            }
            //透過色設定取得
            t.trans = tileset.getElementsByTagName('image')[0].getAttribute('trans');
            if (t.trans) {
                t.transR = parseInt(t.trans.substring(0, 2), 16);
                t.transG = parseInt(t.trans.substring(2, 4), 16);
                t.transB = parseInt(t.trans.substring(4, 6), 16);
            }

            data.push(t);
        });
        return data;
    },

    /**
     * @method _parseLayers
     * レイヤー情報のパースを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parseLayers: function(xml) {
        var each = Array.prototype.forEach;
        var data = [];

        var map = xml.getElementsByTagName("map")[0];
        var layers = [];
        each.call(map.childNodes, function(elm) {
            if (elm.tagName == "layer" || elm.tagName == "objectgroup" || elm.tagName == "imagelayer") {
                layers.push(elm);
            }
        });

        layers.each(function(layer) {
            switch (layer.tagName) {
                case "layer":
                    //通常レイヤー
                    var d = layer.getElementsByTagName('data')[0];
                    var encoding = d.getAttribute("encoding");
                    var l = {
                        type: "layer",
                        name: layer.getAttribute("name"),
                    };

                    if (encoding == "csv") {
                        l.data = this._parseCSV(d.textContent);
                    } else if (encoding == "base64") {
                        l.data = this._parseBase64(d.textContent);
                    }

                    var attr = this._attrToJSON(layer);
                    l.$extend(attr);
                    l.properties = this._propertiesToJSON(layer);

                    data.push(l);
                    break;

                //オブジェクトレイヤー
                case "objectgroup":
                    var l = {
                        type: "objectgroup",
                        objects: [],
                        name: layer.getAttribute("name"),
                        x: parseFloat(layer.getAttribute("offsetx")) || 0,
                        y: parseFloat(layer.getAttribute("offsety")) || 0,
                        alpha: layer.getAttribute("opacity") || 1,
                        color: layer.getAttribute("color") || null,
                        draworder: layer.getAttribute("draworder") || null,
                    };
                    l.properties = this._propertiesToJSON(layer);

                    //レイヤー内解析
                    each.call(layer.childNodes, function(elm) {
                        if (elm.nodeType == 3) return;
                        var d = this._attrToJSON(elm);
                        if (d.id === undefined) return;
                        d.properties = this._propertiesToJSON(elm);
                        //子要素の解析
                        if (elm.childNodes.length) {
                            elm.childNodes.forEach(function(e) {
                                if (e.nodeType == 3) return;
                                //楕円
                                if (e.nodeName == 'ellipse') {
                                    d.ellipse = true;
                                }
                                //多角形
                                if (e.nodeName == 'polygon') {
                                    d.polygon = [];
                                    var attr = this._attrToJSON_str(e);
                                    var pl = attr.points.split(" ");
                                    pl.forEach(function(str) {
                                        var pts = str.split(",");
                                        d.polygon.push({x: parseFloat(pts[0]), y: parseFloat(pts[1])});
                                    });
                                }
                                //線分
                                if (e.nodeName == 'polyline') {
                                    d.polyline = [];
                                    var attr = this._attrToJSON_str(e);
                                    var pl = attr.points.split(" ");
                                    pl.forEach(function(str) {
                                        var pts = str.split(",");
                                        d.polyline.push({x: parseFloat(pts[0]), y: parseFloat(pts[1])});
                                    });
                                }
                            }.bind(this));
                        }
                        l.objects.push(d);
                    }.bind(this));

                    data.push(l);
                    break;

                //イメージレイヤー
                case "imagelayer":
                    var l = {
                        type: "imagelayer",
                        name: layer.getAttribute("name"),
                        x: parseFloat(layer.getAttribute("offsetx")) || 0,
                        y: parseFloat(layer.getAttribute("offsety")) || 0,
                        alpha: layer.getAttribute("opacity") || 1,
                        visible: (layer.getAttribute("visible") === undefined || layer.getAttribute("visible") != 0),
                    };
                    var imageElm = layer.getElementsByTagName("image")[0];
                    l.image = {source: imageElm.getAttribute("source")};

                    data.push(l);
                    break;
            }
        }.bind(this));
        return data;
    },

    /**
     * @method _perseCSV
     * CSVのパースを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parseCSV: function(data) {
        var dataList = data.split(',');
        var layer = [];

        dataList.each(function(elm, i) {
            var num = parseInt(elm, 10) - 1;
            layer.push(num);
        });

        return layer;
    },

    /**
     * @method _perseCSV
     * BASE64のパースを行います。
     *
     * 内部で使用している関数です。
     * http://thekannon-server.appspot.com/herpity-derpity.appspot.com/pastebin.com/75Kks0WH
     * @private
     */
    _parseBase64: function(data) {
        var dataList = atob(data.trim());
        var rst = [];

        dataList = dataList.split('').map(function(e) {
            return e.charCodeAt(0);
        });

        for (var i=0,len=dataList.length/4; i<len; ++i) {
            var n = dataList[i*4];
            rst[i] = parseInt(n, 10) - 1;
        }

        return rst;
    },
});

//ローダーに追加
phina.asset.AssetLoader.assetLoadFunctions.tmx = function(key, path) {
    var tmx = phina.asset.TiledMap();
    return tmx.load(path);
};

/*
 *  phina.virtualpad.js
 *  2017/06/13
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//バーチャルパッド
phina.define("phina.extension.VirtualPad", {
    superClass: "phina.display.DisplayElement",

    active: true,

    //挿下キー情報
    keyData: {
        up: false,
        down: false,
        left: false,
        right: false,
        a: false,
        b: false,
    },

    defaultOptions: {
        //パッド縦横
        width: 640,
        height: 480,

        //パッド座標
        x: 0,
        y: 0,

        //判定半径
        fingerRadius: 20,
    },

    init: function(options) {
        this.superInit();
        options = (options || {}).$safe(this.defaultOptions);
        this.options = options;

        var param = {
            width: options.width,
            height: options.height,
            fill: "rgba(0,0,0,0.3)",
            stroke: "rgba(0,0,0,0.3)",
            strokeWigth: 0,
            backgroundColor: 'transparent',
        };
        this.mask = phina.display.RectangleShape(param)
//            .addChildTo(this)
            .setOrigin(0, 0)
            .setPosition(options.x, options.y);

        this.analog = phina.extension.VirtualPad.AnalogStick()
            .addChildTo(this)
            .setPosition(82, options.height - 82);

        this.btn = [];
        this.btn[0] = phina.extension.VirtualPad.Button().addChildTo(this).setPosition(options.width * 0.7, options.height * 0.9);
        this.btn[1] = phina.extension.VirtualPad.Button().addChildTo(this).setPosition(options.width * 0.7 + 80, options.height * 0.9);

        //タップ位置表示
        var fingerParam = {
            backgroundColor: 'transparent',
            fill: "rgba(0,0,0,0.2)",
            stroke: "rgba(0,0,0,0.2)",
            strokeWidth: 1,
            radius: options.fingerRadius,
        };
        this.finger = [];
        for (var i = 0; i < 5; i++) {
            this.finger[i] = phina.display.CircleShape(fingerParam).addChildTo(this);
            this.finger[i].visible = false;
        }
    },

    update: function() {
    },

    updateInfo: function() {
        var p = app.mouse;
        if (p.getPointing()) {
            //タップ位置表示
            var ps = app.pointers;
            for (var i = 0; i < 5; i++) {
                if (i < ps.length) {
                    this.finger[i].visible = true;
                    this.finger[i].setPosition(ps[i].x, ps[i].y);
                } else {
                    this.finger[i].visible = false;
                }
            }
        } else {
            for (var i = 0; i < 5; i++) {
                this.finger[i].visible = false;
            }
        }
    },

    getKey: function(code) {
        var ov = 10;
        var angle = this.analog.angle;
        switch (code) {
            case "right":
                return angle && (angle >= 315 - ov || angle <= 45 + ov);
            case "down":
                return angle && (angle >= 45 - ov && angle <= 135 + ov);
            case "left":
                return angle && (angle >= 135 - ov && angle <= 215 + ov);
            case "up":
                return angle && (angle >= 215 - ov && angle <= 315 + ov);
            case "z":
            case "Z":
                return this.btn[0].isOn;
            case "x":
            case "X":
                return this.btn[1].isOn;
            default:
                return false;
        }
    },
});

//バーチャルパッド十字キー
phina.define("phina.extension.VirtualPad.CrossKey", {
    superClass: "phina.display.DisplayElement",

    active: true,

    init: function(options) {
        this.superInit();
        options = (options || {}).$safe(this.defaultOptions);
        this.options = options;

        //十字キー中心点
        var hw = 0;
        var hh = 0;
        var cp = phina.geom.Vector2(0, 0);

        var button = {
            width: 20,
            height: 20,
            fill: "rgba(0,0,0,0.2)",
            stroke: "rgba(0,0,0,0.2)",
            backgroundColor: 'transparent',
        };
        //0:上 1:右上 2:右 3:右下 4:下 5:左下 6:左 7:左上
        this.btn = [];
        this.btn[0] = phina.display.RectangleShape({width: 60, height: 50}.$safe(button)).setPosition(cp.x     , cp.y - 40).addChildTo(this).setInteractive(true);
        this.btn[2] = phina.display.RectangleShape({width: 50, height: 60}.$safe(button)).setPosition(cp.x + 40, cp.y     ).addChildTo(this).setInteractive(true);
        this.btn[4] = phina.display.RectangleShape({width: 60, height: 50}.$safe(button)).setPosition(cp.x     , cp.y + 40).addChildTo(this).setInteractive(true);
        this.btn[6] = phina.display.RectangleShape({width: 50, height: 60}.$safe(button)).setPosition(cp.x - 40, cp.y     ).addChildTo(this).setInteractive(true);

        this.btn[1] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x + 40, cp.y - 40).addChildTo(this).setInteractive(true);
        this.btn[3] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x + 40, cp.y + 40).addChildTo(this).setInteractive(true);
        this.btn[5] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x - 40, cp.y + 40).addChildTo(this).setInteractive(true);
        this.btn[7] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x - 40, cp.y - 40).addChildTo(this).setInteractive(true);

        for (var i = 0; i < this.btn.length; i++) {
            this.btn[i].isOn = false;
            this.btn[i].on('pointover', function() {
                this.isOn = true;
            });
            this.btn[i].on('pointout', function() {
                this.isOn = false;
            });
        }

        //挿下キー情報
        this.keydata = {
            up: false,
            down: false,
            left: false,
            right: false,
        };
    },

    update: function() {
        this.keydata = {
            up: this.btn[0].isOn || this.btn[1].isOn || this.btn[7].isOn,
            right: this.btn[2].isOn || this.btn[1].isOn || this.btn[3].isOn,
            down: this.btn[4].isOn || this.btn[3].isOn || this.btn[5].isOn,
            left: this.btn[6].isOn || this.btn[5].isOn || this.btn[7].isOn,
        };
    },
});

//バーチャルパッドボタン
phina.define("phina.extension.VirtualPad.Button", {
    superClass: "phina.display.DisplayElement",

    active: true,

    init: function(options) {
        this.superInit();
        options = (options || {}).$safe(this.defaultOptions);
        this.options = options;

        var param = {
            radius: options.radius || 30,
            fill: "rgba(0,0,0,0.3)",
            stroke: "rgba(255, 255, 255, 0.3)",
            backgroundColor: 'transparent',
        };
        this.btn = phina.display.CircleShape(param)
            .addChildTo(this)
            .setInteractive(true);
        this.btn.on('pointover', e => {
            this.isOn = true;
        });
        this.btn.on('pointout', e => {
            this.isOn = false;
        });
    },
});

//バーチャルパッドアナログスティック
phina.define("phina.extension.VirtualPad.AnalogStick", {
    superClass: "phina.display.CircleShape",

    active: true,

    init: function(options) {
        this.superInit({
            radius: 80,
            fill: null,
            stroke: "rgba(255, 255, 255, 0.3)",
            backgroundColor: 'transparent',
        });

        //中心点
        var hw = 0;
        var hh = 0;
        var cp = phina.geom.Vector2(0, 0);

        var param = {
            radius: 20,
            fill: "rgba(0,0,0,0.3)",
            stroke: "rgba(0,0,0,0.3)",
            backgroundColor: 'transparent',
        };
        this.inner = phina.display.CircleShape(param)
            .addChildTo(this)
            .setInteractive(true);
        this.vector = phina.geom.Vector2(0, 0);
        this.pt = null;
    },

    update: function() {
        if (!app.pointer.getPointing()) {
            this.vector.set(0, 0);
        }
        var pointers = app.pointers;
        pointers.forEach(pointer => {
            if (pointer.getPointingStart() && this.hitTest(pointer.x, pointer.y)) {
                this.pt = pointer;
            }
        });
        if (this.pt) {
            if (this.pt.getPointing()) {
                this.vector.set(this.pt.x - this.x, this.pt.y - this.y).normalize();
            } else if (this.pt.getPointingEnd()) {
                this.vector.set(0, 0);
            }
        }
        this.inner.x = this.vector.x * this.radius * 0.6;
        this.inner.y = this.vector.y * this.radius * 0.6;

        //角度
        if (this.vector.x == 0 && this.vector.y == 0) {
            this.angle = null;
        } else {
            this.angle = Math.floor(Math.atan2(this.vector.y, this.vector.x).toDegree());
            if (this.angle < 0) this.angle += 360;
        }
    },
});

/*
 *  SoundSet.js
 *  2014/11/28
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//サウンド管理
phina.define("phina.extension.SoundSet", {

    //サウンドが格納される配列
    elements: null,

    //再生中ＢＧＭ
    bgm: null,
    bgmIsPlay: false,

    //マスターボリューム
    volumeBGM: 0.5,
    volumeSE: 0.5,

    init: function() {
        this.elements = [];
    },

    //登録済みアセット読み込み
    readAsset: function() {
        for (var key in phina.asset.AssetManager.assets.sound) {
            var obj = phina.asset.AssetManager.get("sound", key);
            if (obj instanceof phina.asset.Sound) this.add(key);
        }
    },

    //サウンド追加
    add: function(name, url) {
        if (name === undefined) return null;
        url = url || null;
        if (this.find(name)) return true;

        var e = phina.extension.SoundElement(name);
        if (!e.media) return false;
        this.elements.push(e);
        return true;
    },

    //サウンド検索
    find: function(name) {
        if (!this.elements) return null;
        for (var i = 0; i < this.elements.length; i++) {
            if (this.elements[i].name == name) return this.elements[i];
        }
        return null;
    },

    //サウンドをＢＧＭとして再生
    playBGM: function(name, loop, callback) {
        if (loop === undefined) loop = true;
        if (this.bgm) {
            this.bgm.stop();
            this.bgmIsPlay = false;
        }
        var element = this.find(name);
        if (element) {
            var vol = this.volumeBGM * element._volume;
            element.media.volume = vol;
            element.play(loop, callback);
            this.bgm = element;
            this.bgmIsPlay = true;
        } else {
            if (this.add(name)) this.playBGM(name);
        }
        return this;
    },

    //ＢＧＭ停止
    stopBGM: function() {
        if (this.bgm) {
            if (this.bgmIsPlay) {
                this.bgm.stop();
                this.bgmIsPlay = false;
            }
            this.bgm = null;
        }
        return this;
    },

    //ＢＧＭ一時停止
    pauseBGM: function() {
        if (this.bgm) {
            if (this.bgmIsPlay) {
                this.bgm.pause();
                this.bgmIsPlay = false;
            }
        }
        return this;
    },

    //ＢＧＭ再開
    resumeBGM: function() {
        if (this.bgm) {
            if (!this.bgmIsPlay) {
                this.bgm.volume = this.volumeBGM;
                this.bgm.resume();
                this.bgmIsPlay = true;
            }
        }
        return this;
    },

    //ＢＧＭマスターボリューム設定
    setVolumeBGM: function(vol) {
        this.volumeBGM = vol;
        if (this.bgm) {
            this.bgm.pause();
            this.bgm.setVolume(this.volumeBGM * this.bgm._volume);
            this.bgm.resume();
        }
        return this;
    },

    //アセットを指定してボリュームを設定
    setVolume: function(name, vol) {
        var media = this.find(name);
        if (media) {
            media.setVolume(vol);
        }
        return this;
    },

    //サウンドをサウンドエフェクトとして再生
    playSE: function(name, loop, callback) {
        var element = this.find(name);
        if (element) {
            var vol = this.volumeSE * element._volume;
            element.media.volume = vol;
            element.play(loop, callback);
        } else {
            if (this.add(name)) this.playSE(name);
        }
        return this;
    },

    //ループ再生しているSEを停止
    stopSE: function(name) {
        var media = this.find(name);
        if (media) {
            media.stop();
        }
        return this;
    },

    //ＢＧＭ一時停止
    pauseBGM: function() {
        if (this.bgm) {
            if (this.bgmIsPlay) {
                this.bgm.pause();
                this.bgmIsPlay = false;
            }
        }
        return this;
    },

    //ＳＥマスターボリューム設定
    setVolumeSE: function(vol) {
        this.volumeSE = vol;
        return this;
    },
});

//SoundElement Basic
phina.define("phina.extension.SoundElement", {
    //サウンド名
    name: null,

    //ＵＲＬ
    url: null,

    //サウンド本体
    media: null,

    //ボリューム
    _volume: 1,

    //再生終了時のコールバック関数
    callback: null,

    //再生中フラグ
    playing: false,

    init: function(name) {
        this.name = name;
        this.media = phina.asset.AssetManager.get("sound", name);
        if (this.media) {
            this.media.volume = 1;
            this.media.on('ended', function() {
                if (this.media.loop) this.playing = false;
                if (this.callback) this.callback();
            }.bind(this))
        } else {
            console.warn("asset not found. "+name);
        }
    },

    //サウンドの再生
    play: function(loop, callback) {
        if (loop === undefined) loop = false
        if (!this.media) return this;

        //ループ再生の場合多重再生を禁止
        if (loop && this.playing) return;

        this.media.loop = loop;
        this.media.play();
        this.callback = callback;
        this.playing = true;
        return this;
    },

    //サウンド再生再開
    resume: function() {
        if (!this.media) return this;
        this.media.resume();
        this.playing = true;
        return this;
    },

    //サウンド一時停止
    pause: function () {
        if (!this.media) return this;
        this.media.pause();
        this.playing = false;
    },

    //サウンド停止
    stop: function() {
        if (!this.media) return this;
        this.media.stop();
        this.playing = false;
        return this;
    },

    //ボリューム設定
    setVolume: function(vol) {
        if (!this.media) return this;
        if (vol === undefined) vol = 0.5;
        this._volume = vol;
        return this;
    },

    _accessor: {
        volume: {
            "get": function() { return this._volume; },
            "set": function(vol) { this.setVolume(vol); }
        },
        loop: {
            "get": function() { return this.media.loop; },
            "set": function(f) { this.media.loop = f; }
        },
    }
});

/*
 *  application.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

//namespaace Quest For the Tanelorn
var qft = {};

phina.define("qft.Application", {
    superClass: "phina.display.CanvasApp",

    init: function() {
        this.superInit({
            query: '#world',
            width: SC_W,
            height: SC_H,
            backgroundColor: 'rgba(0, 0, 0, 1)',
        });
        this.fps = FPS;

        //ゲームパッド管理
        this.gamepadManager = phina.input.GamepadManager();
        this.gamepad = this.gamepadManager.get(0);

        //バーチャルパッド
        this.virtualPad = phina.extension.VirtualPad({width: SC_W, height: SC_H}).setPosition(0, 0);

        //パッド情報を更新
        this.on('enterframe', function() {
            this.gamepadManager.update();
            this.virtualPad.updateInfo();
            this.updateController();
        });
        this.controller = {};

        //サウンドセット
        this.soundset = phina.extension.SoundSet();

        //Labelデフォルト設定
        phina.display.Label.defaults.$extend({
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        });
    },

    updateController: function() {
        var before = this.controller;
        before.before = null;

        var gp = this.gamepad;
        var kb = this.keyboard;
        var angle1 = gp.getKeyAngle();
        var angle2 = kb.getKeyAngle();
        this.controller = {
            angle: angle1 !== null? angle1: angle2,

            up: gp.getKey("up") || kb.getKey("up"),
            down: gp.getKey("down") || kb.getKey("down"),
            left: gp.getKey("left") || kb.getKey("left"),
            right: gp.getKey("right") || kb.getKey("right"),

            attack: gp.getKey("X") || kb.getKey("Z"),
            jump:   gp.getKey("up") || gp.getKey("A") || kb.getKey("up") || kb.getKey("X"),
            change: gp.getKey("B") || kb.getKey("C"),
            menu:   gp.getKey("start") || kb.getKey("escape"),

            a: gp.getKey("A") || kb.getKey("Z"),
            b: gp.getKey("B") || kb.getKey("X"),
            x: gp.getKey("X") || kb.getKey("C"),
            y: gp.getKey("Y") || kb.getKey("V"),

            ok: gp.getKey("A") || kb.getKey("Z") || kb.getKey("space") || kb.getKey("return"),
            cancel: gp.getKey("B") || kb.getKey("X") || kb.getKey("escape"),

            start: gp.getKey("start") || kb.getKey("return"),
            select: gp.getKey("select"),

            pause: gp.getKey("start") || kb.getKey("escape"),

            analog1: gp.getStickDirection(0),
            analog2: gp.getStickDirection(1),

            //前フレーム情報
            before: before,
        };
    },

    _onLoadAssets: function() {
        this.soundset.readAsset();

        //特殊効果用ビットマップ作成
        [
            "player1",
            "player2",
        ].forEach(function(name) {
            if (!phina.asset.AssetManager.get("image", name)) return;

            //ダメージ用
            if (!phina.asset.AssetManager.get("image", name+"White")) {
                var tex = phina.asset.AssetManager.get("image", name).clone();
                tex.filter( function(pixel, index, x, y, bitmap) {
                    var data = bitmap.data;
                    data[index+0] = (pixel[0] == 0? 0: 128); //r
                    data[index+1] = (pixel[1] == 0? 0: 128); //g
                    data[index+2] = (pixel[2] == 0? 0: 128); //b
                });
                phina.asset.AssetManager.set("image", name+"White", tex);
            }
            //瀕死用
            if (!phina.asset.AssetManager.get("image", name+"Red")) {
                var tex = phina.asset.AssetManager.get("image", name).clone();
                tex.filter( function(pixel, index, x, y, bitmap) {
                    var data = bitmap.data;
                    data[index+0] = pixel[0];
                    data[index+1] = 0;
                    data[index+2] = 0;
                });
                phina.asset.AssetManager.set("image", name+"Red", tex);
            }
            //影用
            if (!phina.asset.AssetManager.get("image", name+"Black")) {
                var tex = phina.asset.AssetManager.get("image", name).clone();
                tex.filter( function(pixel, index, x, y, bitmap) {
                    var data = bitmap.data;
                    data[index+0] = 0;
                    data[index+1] = 0;
                    data[index+2] = 0;
                });
                phina.asset.AssetManager.set("image", name+"Black", tex);
            }
        });
    },

    playBGM: function(asset, loop, callback) {
        if (loop === undefined) loop = true;
        this.soundset.playBGM(asset, loop, callback);
    },

    stopBGM: function(asset) {
        this.soundset.stopBGM();
    },

    setVolumeBGM: function(vol) {
        if (vol > 1) vol = 1;
        if (vol < 0) vol = 0;
        this.soundset.setVolumeBGM(vol);
    },

    playSE: function(asset, loop) {
        if (loop === undefined) loop = false;
        this.soundset.playSE(asset, loop);
    },

    setVolumeSE: function(vol) {
        if (vol > 1) vol = 1;
        if (vol < 0) vol = 0;
        this.soundset.setVolumeSE(vol);
    },

    setVolume: function(asset, vol) {
        this.soundset.setVolume(asset, vol);
    },

    _accessor: {
        volumeBGM: {
            "get": function() { return this.sounds.volumeBGM; },
            "set": function(vol) { this.setVolumeBGM(vol); }
        },
        volumeSE: {
            "get": function() { return this.sounds.volumeSE; },
            "set": function(vol) { this.setVolumeSE(vol); }
        }
    }
});

/*
 *  asset.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Assets", {
    _static: {
        loaded: [],
        isLoaded: function(assetType) {
            return qft.Assets.loaded[assetType]? true: false;
        },
        get: function(options) {
            qft.Assets.loaded[options.assetType] = true;
            switch (options.assetType) {
                case "splash":
                    return {
                        image: {
                            "openingmap":   "assets/image/opening_map.jpg",
                            "openingtower": "assets/image/opening_tower.png",
                            "openingground":"assets/image/opening_ground.png",
                            "openingback":  "assets/image/opening_back.png",
                            "openingback2": "assets/image/opening_bg_jan.jpg",
                            "openinglight": "assets/image/opening_tree_light_yellow.png",
                            "player1":      "assets/image/actor4.png",
                            "background":   "assets/image/back-s03b.png",
                        },
                    };
                case "splash2":
                    return {
                        sound: {
                            "openingbgm":   "assets/sound/DS-070m.mp3",
                        },
                    };
                case "common":
                    return {
                        image: {
                            "actor4":    "assets/image/actor4.png",
                            "actor19":    "assets/image/actor19.png",
                            "actor40":    "assets/image/actor40.png",
                            "actor55":    "assets/image/actor55.png",
                            "actor64":    "assets/image/actor64_a.png",
                            "actor642":    "assets/image/actor64_b.png",
                            "actor108":    "assets/image/actor108.png",
                            "actor111":    "assets/image/actor111.png",
                            "actor112":    "assets/image/actor112.png",
                            "weapons":    "assets/image/weapons.png",
                            "item":       "assets/image/item.png",
                            "itembox":    "assets/image/takarabako.png",
                            "particle":   "assets/image/particle.png",
                            "door":       "assets/image/door.png",
                            "checkicon":  "assets/image/check icon_00.png",
                            "titleback":  "assets/image/titleback.png", 
                            "menuframe":  "assets/image/nc92367.png",

                            "monster01":  "assets/image/monster01.png",
                            "monster02":  "assets/image/char_m_devil01.png",
                            "monster03":  "assets/image/char_m_magi01.png",
                            "monster01x2":  "assets/image/monster01x2.png",
                            "monster02x2":  "assets/image/char_m_devil01x2.png",
                            "bullet":     "assets/image/effect_bullet01.png",
                            "effect":     "assets/image/effect.png",
                            "effect2":    "assets/image/effect01a.png",
                            "gate":       "assets/image/gate.png",
                            "flame02":    "assets/image/object_fire02a.png",
                            "flame03":    "assets/image/object_fire03a.png",
                            "flame05":    "assets/image/object_fire05a.png",
                            "accessory1": "assets/image/map_effect2.png",
                            "block":      "assets/image/block.png",
                            "floor":      "assets/map/TileA4.png",
                            "balloon":    "assets/image/chara09_c1.png",
                            "shadow":     "assets/image/shadow.png",
                        },
                        sound: {
                            "click":      "assets/sound/se_maoudamashii_system44.mp3",
                            "ok":         "assets/sound/se_maoudamashii_system36.mp3",
                            "cancel":     "assets/sound/se_maoudamashii_system43.mp3",
                            "attack":     "assets/sound/sen_ka_katana_sasinuku01.mp3",
                            "hit":        "assets/sound/sen_ka_katana_sasu01.mp3",
                            "hit_blunt":  "assets/sound/sen_blunt.mp3",
                            "damage":     "assets/sound/se_maoudamashii_battle12.mp3",
                            "arrowstick": "assets/sound/sen_ka_ya03.mp3",
                            "stageclear": "assets/sound/DS-030m.mp3",
                            "gameover":   "assets/sound/gameover3.mp3",
                            "getkeyitem": "assets/sound/se_maoudamashii_onepoint23.mp3",
                            "bomb":       "assets/sound/sen_ge_taihou03.mp3",
                            "select":     "assets/sound/se_maoudamashii_system45.mp3",
                            "getitem":    "assets/sound/ata_a49.mp3",
                            "recovery":   "assets/sound/se_maoudamashii_magical01.mp3",
                            "tinkling":   "assets/sound/tinkling.mp3",
                            "holy1":      "assets/sound/holy1.mp3",
                            "bgm1":       "assets/sound/DS-ba01m.mp3",
                        },
                        font: {
                            "UbuntuMono": "assets/font/UbuntuMono-Bold.ttf",
                            "titlefont1": "assets/font/teutonic4.ttf",
                            "titlefont2": "assets/font/GothStencil_Premium.ttf",
                        },
                        tmx: {
                            "stage1": "assets/map/stage1.tmx",
                            "stage999": "assets/map/stage999.tmx",
                        },
                    };
                case "stage2":
                    return {
                        sound: {
                            "bgm2": "assets/sound/DS-035m.mp3",
                        },
                        tmx: {
                            "stage2_1": "assets/map/stage2_1.tmx",
                        },
                    };
                case "stage3":
                    return {
                        sound: {
                            "bgm3": "assets/sound/DS-041m.mp3",
                        },
                        tmx: {
                            "stage3_1": "assets/map/stage3_1.tmx",
                            "stage3_2": "assets/map/stage3_2.tmx",
                            "stage3_3": "assets/map/stage3_3.tmx",
                        },
                    };
                case "stage4":
                    return {
                        sound: {
                            "bgm4": "assets/sound/DS-076m.mp3",
                        },
                        tmx: {
                            "stage4_1": "assets/map/stage4_1.tmx",
                            "stage4_2": "assets/map/stage4_2.tmx",
                        },
                    };
                case "stage5":
                    return {
                        sound: {
                            "bgm5": "assets/sound/DS-089m.mp3",
                        },
                        tmx: {
                            "stage5_1": "assets/map/stage5_1.tmx",
                            "stage5_2": "assets/map/stage5_2.tmx",
                        },
                    };
                case "stage6":
                    return {
                        sound: {
                            "bgm6": "assets/sound/DS-060m.mp3",
                        },
                        tmx: {
                            "stage6_1": "assets/map/stage6_1.tmx",
                            "stage6_2": "assets/map/stage6_2.tmx",
                        },
                    };
                case "stage7":
                    return {
                        sound: {
                            "bgm7": "assets/sound/DS-105m.mp3",
                        },
                        tmx: {
                            "stage7_1": "assets/map/stage7_1.tmx",
                            "stage7_2": "assets/map/stage7_2.tmx",
                            "stage7_3": "assets/map/stage7_3.tmx",
                        },
                    };
                case "stage8":
                    return {
                        sound: {
                            "bgm8": "assets/sound/DS-064m.mp3",
                        },
                        tmx: {
                            "stage8_1": "assets/map/stage8_1.tmx",
                            "stage8_2": "assets/map/stage8_2.tmx",
                        },
                    };
                case "stage9":
                    return {
                        sound: {
                            "bgm9": "assets/sound/DS-064m.mp3",
                        },
                        tmx: {
                            "stage9_1": "assets/map/stage9_1.tmx",
                        },
                    };
                case "stage10":
                    return {
                        sound: {
                            "ending": "assets/sound/DS-071m.mp3",
                        },
                        tmx: {
                            "stage10": "assets/map/stage10.tmx",
                        },
                    };
                default:
                    throw "invalid assetType: " + options.assetType;
            }
        },
    },
});


/*
 *  Benri.js
 *  2014/12/18
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
var toRad = 3.14159/180;    //弧度法toラジアン変換
var toDeg = 180/3.14159;    //ラジアンto弧度法変換

//距離計算
var distance = function(from, to) {
    var x = from.x-to.x;
    var y = from.y-to.y;
    return Math.sqrt(x*x+y*y);
}

//距離計算（ルート無し版）
var distanceSq = function(from, to) {
    var x = from.x - to.x;
    var y = from.y - to.y;
    return x*x+y*y;
}

//数値の制限
var clamp = function(x, min, max) {
    return (x<min)?min:((x>max)?max:x);
};

//乱数生成
var prand = phina.util.Random();
var rand = function(min, max) {
    return prand.randint(min, max);
}

//タイトル無しダイアログ
var AdvanceAlert = function(str) {
    var tmpFrame = document.createElement('iframe');
    tmpFrame.setAttribute('src', 'data:text/plain,');
    document.documentElement.appendChild(tmpFrame);

    window.frames[0].window.alert(str);
    tmpFrame.parentNode.removeChild(tmpFrame);
};
var AdvanceConfirm = function(str) {
    var tmpFrame = document.createElement('iframe');
    tmpFrame.setAttribute('src', 'data:text/plain,');
    document.documentElement.appendChild(tmpFrame);

    var result = window.frames[0].window.confirm(str);
    tmpFrame.parentNode.removeChild(tmpFrame);

    return result;
};

//数値をカンマ編集して文字列として出力
Number.prototype.$method("comma",  function() {
    var str = this+'';
    var len = str.length;
    var out = '';
    for (var i = len-1; i > -1; i--) {
        out = str[i]+out;
        if (i != 0 && (len-i)%3 == 0) out = ','+out;
    }
    return out;
});

/*
 *  main.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

//phina.globalize();

//デバッグフラグ
const DEBUG = false;
const DEBUG_COLLISION = false;
const DEBUG_EYESIGHT = false;
const DEBUG_MOBILE = false;

//定数
const SC_W = 576;
const SC_H = 324;
// SC_W = 480;
// SC_H = 320;

const FPS = 30;

//アイテムＩＤ
const ITEM_SHORTSWORD = 0;
const ITEM_LONGSWORD = 1;
const ITEM_AX = 2;
const ITEM_SPEAR = 3;
const ITEM_BOW = 4;
const ITEM_ROD = 5;
const ITEM_BOOK = 6;
const ITEM_SHIELD = 7;
const ITEM_ARMOR = 8;
const ITEM_HAT = 9;
const ITEM_BOOTS = 10;
const ITEM_GROVE = 11;
const ITEM_RING = 12;
const ITEM_SCROLL = 13;
const ITEM_LETTER = 14;
const ITEM_CARD = 15;
const ITEM_KEY = 16;
const ITEM_COIN = 17;
const ITEM_BAG = 18;
const ITEM_ORB = 19;
const ITEM_STONE = 20;
const ITEM_JEWEL = 21;
const ITEM_JEWELBOX = 22;
const ITEM_APPLE = 24;
const ITEM_HARB = 25;
const ITEM_MEAT = 26;
const ITEM_POTION = 27;

//インスタンス
let app;

window.onload = function() {
    app = qft.Application();
    app.replaceScene(qft.SceneFlow());

    //モバイル対応
    if (phina.isMobile()) {
        app.domElement.addEventListener('touchend', function dummy() {
            var s = phina.asset.Sound();
            s.loadFromBuffer();
            s.play().stop();
            app.domElement.removeEventListener('touchend', dummy);
        });
    }
    app.domElement.addEventListener('click', function dummy() {
        var context = phina.asset.Sound.getAudioContext();
        context.resume();
    });

    app.run();
//    app.enableStats();
};

/*
 *  configscene.js
 *  2017/03/02
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.ConfigScene", {
    superClass: "phina.display.DisplayScene",

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,0.5)",
            stroke: "rgba(0,0,0,0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.alpha = 0;
        this.bg.tweener.clear().fadeIn(500);

        this.scroll = phina.display.Sprite("menuframe")
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)
            .setScale(0.85, 1.1);
        this.scroll.alpha = 0;
        this.scroll.tweener.clear().fadeIn(500);

        this.menuBase = phina.display.DisplayElement().addChildTo(this.scroll);

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont1",
            align: "center",
            baseline: "middle",
            fontSize: 70,
        };
        this.textLabel = phina.display.Label({text: "Menu", fontSize: 20}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(0, -SC_H*0.3);

        //メニューテキスト表示
        var that = this;
        this.menu = ["System", "Practice", "Exit"];
        this.menuText = [];
        for (var i = 0; i < this.menu.length; i++) {
            this.menuText[i] = phina.display.Label({text: this.menu[i], fontSize: 40}.$safe(labelParam))
                .addChildTo(this.menuBase)
                .setPosition(0, -SC_H*0.15+SC_H*0.15*i)
                .setScale(0.7);

            //タッチ判定用
            var param2 = {
                width: SC_W*0.3,
                height: SC_H*0.10,
                fill: "rgba(0,100,200,0.5)",
                stroke: "rgba(0,100,200,0.5)",
                backgroundColor: 'transparent',
            };
            var c = phina.display.RectangleShape(param2)
                .addChildTo(this.menuBase)
                .setPosition(0, -SC_H*0.15+SC_H*0.15*i)
                .setInteractive(true);
            c.alpha = 0;
            c.select = i;
            c.onpointstart = function() {
                if (that.isSelected || that.time < 10) return;
                if (this.select == that.select) {
                    that.ok = true;
                } else {
                    that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    that.select = this.select;
                    that.menuText[that.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                    app.playSE("select");
                }
            }
        }
        this.isSelected = false;
        this.select = 0;
        this.selectMax = 3;
        this.menuText[0].setScale(1);
        this.ok = false;
        this.cansel = false;

        this.time = 0;

        this.on('resume', function() {
            this.menuBase.tweener.clear().fadeIn(500);
            this.time = 0;
            this.isSelected = false;
            this.ok = false;
            this.cansel = false;
        });
    },

    update: function() {
        var ct = app.controller;
        if (ct.down && !ct.before.down && this.select < this.selectMax-1) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select++;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }
        if (ct.up && !ct.before.up && this.select > 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }

        if (this.time > 15) {
            //決定
            if (ct.ok || this.ok) {
                if (this.select == 0) {
                }
                if (this.select == 1) {
                    app.playSE("ok");
                    this.menuBase.tweener.clear()
                        .fadeOut(500)
                        .call(function() {
                            app.pushScene(qft.ConfigScene_Practice());
                        });
                }
                if (this.select == 2) {
                    app.playSE("cancel");
                    this.exitMenu();
                }
                this.time = 0;
            }

            //キャンセル        
            if (ct.cancel) {
                app.playSE("cancel");
                this.exitMenu();
                this.time = 0;
            }
        }
        this.time++;
    },

    exitMenu: function() {
        this.bg.tweener.clear().fadeOut(500);
        this.scroll.tweener.clear()
            .fadeOut(500)
            .call(function() {
                this.exit();
            }.bind(this));
    }
});

/*
 *  conversationscene.js
 *  2017/08/17
 *  @auther minimo  
 *  This Program is MIT license.
 */

//会話表示シーン 
phina.define("qft.ConversationScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene, text) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //プレイヤーの画面上位置によりフレームの縦位置を変更
        var frameY = SC_H * 0.25;
        var pl = this.currentScene.player;

        //会話表示フレーム
        var param = {
            width:SC_W * 0.95,
            height:SC_H * 0.4,
            fill: "rgba(0, 0, 0, 0.5)",
            stroke: "rgba(1, 1, 1, 0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W * 0.5, frameY)

        //テキスト処理
        if (text === undefined) text = "TEST MESSAGE";
        if (text instanceof Array) {
            this.text = "";
            text.forEach((t) => {
                this.text += (t + "\n");
            });
        } else {
            this.text = text;
        }

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "Orbitron",
            fontSize: 70,

            verticalAlign: 'top',
            align:'start',
            baseline:'top',
            width: SC_W * 0.9,
            height: SC_H * 0.3,
            scrollX: 0,
            scrollY: 0,
        };
        this.textLabel = phina.ui.LabelArea({text: "", fontSize: 20}.$safe(labelParam)).addChildTo(this.bg);

        this.isExit = false;
        this.isFinish = false;
        this.waitTime = 0;
        this.col = 0;
        this.time = 0;
    },

    update: function() {
        if (this.waitTime == 0) {
            this.textLabel.text = this.text.substring(0, this.col);
            if (this.text.substring(this.col, this.col+1) == "\n") this.waitTime = 10;
            this.col++;
            if (this.col > this.text.length) this.isFinish = true;
        }
        if (this.waitTime > 0) this.waitTime--;

        var ct = app.controller;
        if (this.isFinish) {
            if (!this.isExit && this.time > 10 && ct.before.attack && !ct.attack) {
                this.isExit = true;
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
        } else {
            if (ct.attack) {
                this.col = this.text.length;
                this.isFinish = true;
                this.time = 0;
            }
        }
        this.time++;
    },
});


/*
 *  creditscene.js
 *  2017/12/24
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.CreditScene", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.clear()
            .set({alpha: 0})
            .to({alpha: 0.5}, 1000);

        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 26,
            fontWeight: ''
        };
        phina.display.Label({text: "Congraturations!!"}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.2);

        phina.display.Label({text: "Thank you for playing."}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.4);

        phina.display.Label({text: "This game is a test version."}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);

        phina.display.Label({text: "Push button to title.", fontSize: 20}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.8);

        app.playBGM("gameover", false);

        this.time = 0;
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time > 120) {
            if (ct.ok || ct.cancel) {
                app.playBGM("openingbgm");
                this.parentScene.flare('exitgame');
                this.exit();
            }
        }
        this.time++;
    },
});

/*
 *  endingcene.js
 *  2017/02/07
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.EndingScene", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.clear()
            .set({alpha: 0})
            .to({alpha: 0.5}, 1000);

        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 26,
            fontWeight: ''
        };
        phina.display.Label({text: "Thank you for playing."}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.4);

        phina.display.Label({text: "This game is over"}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);

        phina.display.Label({text: "Push button to title.", fontSize: 20}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.8);

        app.playBGM("gameover", false);

        this.time = 0;
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time > 120) {
            if (ct.ok || ct.cancel) {
                app.playBGM("openingbgm");
                this.parentScene.flare('exitgame');
                this.exit();
            }
        }
        this.time++;
    },
});

/*
 *  endingcene.trueending.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

//トゥルーエンディング
phina.define("qft.EndingScene.TrueEnding", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        this.text = [
            "数多の苦難を乗り越え",
            "あなたは遂に楽園「永遠の都」への入り口へと到達した",
            "扉の向こうには階段があり",
            "その階段は遥か天上へと続いている",
            "階段を昇りますか？",
        ];

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.clear()
            .set({alpha: 0})
            .to({alpha: 0.5}, 1000);

        //イメージ表示用レイヤ
        this.imageLayer = phina.display.DisplayElement().addChildTo(this);

        //上下黒帯
        param.height = SC_H * 0.15;
        this.bar1 = phina.display.RectangleShape(param).addChildTo(this).setOrigin(0, 1).setPosition(0, -1);
        this.bar2 = phina.display.RectangleShape(param).addChildTo(this).setOrigin(0, 0).setPosition(0, SC_H + 1);
        this.bar1.tweener.clear().setUpdateType('fps').moveBy(0, SC_H * 0.15, 30, "easeOutSine");
        this.bar2.tweener.clear().setUpdateType('fps').moveBy(0, -SC_H * 0.15, 30, "easeOutSine");

        this.time = 0;

        this.one('enterframe', () => {
            //ＢＧＭ再生
            app.playBGM("endingbgm");
        });
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time > 120) {
            if (ct.ok || ct.cancel) {
                app.playBGM("openingbgm");
                this.parentScene.flare('exitgame');
                this.exit();
            }
        }
        this.time++;
    },
});

/*
 *  GameOverScene.js
 *  2014/06/04
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.GameOverScene", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        //バックグラウンド
        var param = {
            width: SC_W,
            height: SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.5)
        this.bg.alpha = 0;

        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        };
        var x = SC_W * 0.5-32*4;
        var n = 0;
        ["G", "A", "M", "E", "O", "V", "E", "R"].forEach(function(e) {
            var lb = phina.display.Label({text: e}.$safe(labelParam))
                .setPosition(x, SC_H*0.5+32)
                .setScale(0, 1)
                .addChildTo(this);
            lb.tweener.clear()
                .set({alpha: 0})
                .wait(n*50)
                .to({scaleX: 1.0, alpha: 1, y: SC_H*0.5}, 1000, "easeOutSine")
                .wait(1000-n*50)
                .set({alpha: 0})
                .to({scaleX: 0.0, alpha: 0, y: SC_H*0.5-32}, 1000, "easeOutSine")
            var pt = phina.display.Sprite("particle", 16, 16)
                .setFrameIndex(48)
                .setPosition(x, SC_H*0.5)
                .setScale(3, 3)
                .addChildTo(this);
            pt.alpha = 0;
            pt.tweener.clear()
                .wait(n*50+1000)
                .to({alpha: 1}, 1000-n*50, "easeOutSine")
                .to({scaleX: 0.0, alpha: 0, y: SC_H*0.5-32}, 1000, "easeOutSine")
            x += 32;
            n++;
        }.bind(this));

        app.playBGM("gameover", false);

        this.select = 0; //0:YES 1:NO
        this.pushyes = false;
        this.pushno = false;
        this.ok = false;

        this.time = 0;
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time == 90) {
            this.dispContinue();
        }
        if (this.time > 105) {
            if ((ct.left || this.pushyes) && this.select == 1) {
                this.select = 0;
                this.pushyes = false;
                this.yes.tweener.clear().to({scaleX: 1, scaleY: 1}, 500, "easeOutBounce");
                this.no.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                app.playSE("select");
                this.text3.text = "ゲームオーバー地点からコンティニューします（スコアはリセットされます）";
            } else if ((ct.right || this.pushno) && this.select == 0) {
                this.select = 1;
                this.pushno = false;
                this.yes.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                this.no.tweener.clear().to({scaleX: 1, scaleY: 1}, 500, "easeOutBounce");
                app.playSE("select");
                this.text3.text = "タイトルに戻ります";
            }
            if (ct.ok || ct.cancel || this.ok) {
                if (this.select == 0) {
                    this.parentScene.flare('continue');
                    this.exit();
                } else {
                    this.parentScene.flare('exitgame');
                    this.exit();
                }
            }
        }
        this.time++;
    },

    dispContinue: function() {
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 36,
            fontWeight: ''
        };
        this.text1 = phina.display.Label({text: "CONTINUE?"}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.4+10)
            .addChildTo(this);
        this.text1.alpha = 0;
        this.text1.tweener.clear().to({y: SC_H*0.4, alpha: 1}, 500, "easeInSine");

        this.yes = phina.display.Label({text: "YES", fontSize: 30}.$safe(labelParam))
            .setScale(1)
            .setPosition(SC_W*0.4, SC_H*0.6+10)
            .addChildTo(this);
        this.yes.alpha = 0;
        this.yes.tweener.clear().to({y: SC_H*0.6, alpha: 1}, 500, "easeInSine");

        this.no = phina.display.Label({text: "NO", fontSize: 30}.$safe(labelParam))
            .setScale(0.7)
            .setPosition(SC_W*0.6, SC_H*0.6+10)
            .addChildTo(this);
        this.no.alpha = 0;
        this.no.tweener.clear().to({y: SC_H*0.6, alpha: 1}, 500, "easeInSine");

        //タッチ判定用
        var that = this;
        var param2 = {
            width: 80,
            height: SC_H*0.08,
            fill: "rgba(0,100,200,0.5)",
            stroke: "rgba(0,100,200,0.5)",
            backgroundColor: 'transparent',
        };
        var yes = phina.display.RectangleShape(param2)
            .addChildTo(this)
            .setPosition(SC_W*0.4, SC_H*0.6)
            .setInteractive(true);
        yes.alpha = 0;
        yes.onpointstart = function() {
            if (that.select == 0) {
                that.ok = true;
            } else {
                that.pushyes = true;
            }
        }
        var no = phina.display.RectangleShape(param2)
            .addChildTo(this)
            .setPosition(SC_W*0.6, SC_H*0.6)
            .setInteractive(true);
        no.alpha = 0;
        no.onpointstart = function() {
            if (that.select == 1) {
                that.ok = true;
            } else {
                that.pushno = true;
            }
        }

        this.text3 = phina.display.Label({text: "ゲームオーバー地点からコンティニューします（スコアはリセットされます）", fontSize: 10}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.75+10)
            .addChildTo(this);
        this.text3.alpha = 0;
        this.text3.tweener.clear().to({y: SC_H*0.75, alpha: 1}, 500, "easeInSine");

        this.bg.tweener.clear().to({alpha:0.3}, 500, "easeInSine");
    },
});

/*
 *  LoadingScene.js
 *  2015/09/08
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アセットロード用シーン
phina.define("qft.LoadingScene", {
    superClass: "phina.display.DisplayScene",

    init: function(options) {
        options = (options || {}).$safe({
            assets: null,
            width: SC_W,
            height: SC_H,
            lie: false,
            exitType: "auto",
        });
        this.superInit(options);

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)
        this.bg.tweener.setUpdateType('fps');

        //ロードする物が無い場合スキップ
        this.forceExit = false;
        var assets = options.assets;
        if (!assets.$has("sound") &&
            !assets.$has("image") &&
            !assets.$has("font") &&
            !assets.$has("spritesheet") &&
            !assets.$has("script") &&
            !assets.$has("tmx")) {

            this.forceExit = true;
            return;
        }

        var labelParam = {
            text: "Loading",
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 30
        };
        phina.display.Label(labelParam)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);

        this.fromJSON({
            children: {
                gauge: {
                    className: 'phina.ui.Gauge',
                    arguments: {
                        value: 0,
                        width: this.width*0.5,
                        height: 5,
                        color: 'black',
                        stroke: false,
                        gaugeColor: 'blue',
                        padding: 0,
                    },
                    x: this.gridX.center(),
                    y: SC_H*0.5+20,
                    originY: 0,
                }
            }
        });
        this.gauge.update = function(e) {
            this.gaugeColor = 'hsla({0}, 100%, 50%, 0.8)'.format(e.ticker.frame*3);
        }

        var loader = phina.asset.AssetLoader();
        if (options.lie) {
            this.gauge.animationTime = 10*1000;
            this.gauge.value = 90;
            loader.onload = function() {
                this.gauge.animationTime = 1*1000;
                this.gauge.value = 100;
            }.bind(this);
        } else {
            loader.onprogress = function(e) {
                this.gauge.value = e.progress*100;
            }.bind(this);
        }
        this.gauge.onfull = function() {
            if (options.exitType === 'auto') {
                if (this.app._onLoadAssets) this.app._onLoadAssets();
                this.exit();
            }
        }.bind(this);

        loader.load(options.assets);
    },
    update: function() {
        if (this.forceExit) this.exit();
    },    
});

/*
 *  MainScene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.MainScene", {
    superClass: "phina.display.DisplayScene",

    //現在ステージ番号
    stageNumber: 1,

    //最大ステージ番号
    stageNumberMax: 8,

    //残り時間（フレーム単位）
    timeLimit: 120,

    //メッセージスタック
    messageStack: [],

    //ステージクリアフラグ
    isStageClear: false,

    //エンディング進行中フラグ
    isEnding: false,

    //真エンディングフラグ
    isTrueEnding: true,

    //スコア
    totalScore: 0,

    //敵討伐数
    totalKill: 0,

    //コンティニュー回数
    continueCount: 0,

    //ステージクリア時情報
    clearResult: [],

    //スクリーンのマップ外への移動制限フラグ
    limitWidth: false,
    limitHeight: true,

    //スクリーン中心座標
    screenCenterPosition: null,

    //プレイヤースクリーン中央固定フラグ
    centerPlayer: true,

    //シーン内全オブジェクト強制停止
    pauseScene: false,

    init: function(options) {
        this.superInit({width: SC_W, height: SC_H});
        options = (options || {}).$safe({
            startStage: 1,
            isPractice: false,
            isContinue: false,
        })
        this.stageNumber = options.startStage || 1;
        this.isPractice = options.isPractice;
        this.isContinue = options.isContinue;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.setUpdateType('fps');

        //背景
        this.backgroundImage = phina.display.Sprite("background")
            .addChildTo(this).setPosition(0, SC_H*0.5)
            .setOrigin(0, 0.5)
            .setScale(1.0, 1.1);

        //管理用基準レイヤ
        this.baseLayer = phina.display.DisplayElement().addChildTo(this);

        //プレイヤーキャラクタ
        this.player = qft.Player(this);

        //スクリーン初期化
        this.setupScreen();

        //スクリーン中心座標管理用
        var that = this;
        this.camera = phina.app.Object2D().addChildTo(this);
        this.camera.parentScene = this;
        this.camera.tweener.setUpdateType('fps');
        this.camera.moveFrom = phina.geom.Vector2(0, 0);
        this.camera.moveTo = phina.geom.Vector2(0, 0);
        this.camera.moveRatio = 0;
        this.camera.moveLerp = false;
        this.camera.moveToPlayer = false;
        this.camera.update = function() {
            if (that.centerPlayer) {
                this.x = that.player.x;
                this.y = that.player.y;
            } else {
                if (this.moveLerp) {
                    if (this.moveToPlayer) {
                        this.moveTo.x = that.player.x;
                        this.moveTo.y = that.player.y;
                    }
                    var p = phina.geom.Vector2.lerp(this.moveFrom, this.moveTo, this.moveRatio);
                    this.setPosition(p.x, p.y);
                }
            }
        };

        //ステージクリア時情報
        this.clearResult = [];
        this.totalScore = 0;
        this.totalKill = 0;

        //コンティニュー時状態ロード
        if (this.isContinue) this.loadGame();

        //ステージ開始位置
        this.mapstart = phina.geom.Vector2(0, 0);

        //ステージ情報初期化
        this.setupStage();

        this.fgWhite = phina.display.RectangleShape(param.$extend({fill: 'white'}))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fgWhite.alpha = 0;
        this.fgWhite.tweener.setUpdateType('fps').clear();

        this.fg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fg.tweener.setUpdateType('fps').clear().fadeOut(30);

        //バーチャルパッドの可視化
        if (phina.isMobile() || DEBUG_MOBILE) {
            app.virtualPad.addChildTo(this).setPosition(0, 0);
        }

        app.volumeBGM = 0.5;
        app.volumeSE = 0.2;

        //メニューを開く
        this.on('openmenu', function(e) {
            app.pushScene(qft.MenuScene(this));
        });

        //キー取得
        this.on('getkey', function(e) {
            var x = this.mapLayer.x + this.player.x;
            var y = this.mapLayer.y + this.player.y;
            var key = phina.display.DisplayElement()
                .setPosition(x, y)
                .addChildTo(this.baseLayer);
            key.tweener.clear().moveTo(15+(this.player.keys.length-1)*24, 36, 500);
            var sp = phina.display.Sprite("item", 24, 24)
                .setFrameIndex(ITEM_KEY)
                .addChildTo(key);
        });

        //ステージクリア
        this.on('stageclear', this.stageClear);

        //次ステージへ移行
        this.on('nextstage', function(e) {
            if (!this.allClear) {
                this.stageNumber++;
                this.setupStage();
                this.player.saveStatus();
            } else {
                //エンディング分岐
                if (this.isTrueEnding) {
                    this.stageNumber = 10;
                    this.setupStage();
                } else {
                    //仮エンディング
                    app.pushScene(qft.EndingScene(this));
                }
            }
        });

        //エンディングへ移行
        this.on('ending', function(e) {
            app.pushScene(qft.EndingScene(this));
        });

        //ゲームオーバー
        this.on('gameover', function(e) {
            app.pushScene(qft.GameOverScene(this));
        });

        //コンティニュー
        this.on('continue', function(e) {
            this.restart();
        });

        //ゲーム終了
        this._exitGame = false;
        this.on('exitgame', function(e) {
            this._exitGame = true;
            if (!this.isPractice) this.saveGame();
        });
        this.on('exitgame_nosave', function(e) {
            this._exitGame = true;
        });

        //メッセージ表示
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };
        var that = this;
        this.messageStack = [];
        this.eventMessage = phina.display.Label({text: ""}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.2)
            .addChildTo(this);
        this.eventMessage.alpha = 0;
        this.eventMessage.tweener.clear().setUpdateType('fps');
        this.eventMessage.nextOk = true;
        this.eventMessage.update = function() {
            if (this.nextOk && that.messageStack.length > 0) {
                this.nextOk = false;
                var msg = that.messageStack[0];
                this.tweener.clear()
                    .call(function(){
                        this.text = msg.text;
                    }.bind(this))
                    .fadeIn(15).wait(90).fadeOut(15)
                    .call(function(){
                        this.nextOk = true;
                        that.messageStack.splice(0, 1);
                    }.bind(this))
            }
        }

        this.time = 0;
    },

    update: function(app) {
        if (this.time == 15) this.player.isControl = true;

        //ゲーム終了
        if (this._exitGame) {
            this.exitGame();
        }

        var ct = app.controller;
        if (!this.isStageClear) {
            //通常時処理
            //メニューシーンへ移行
            if (this.time > 15) {
                if (ct.pause || ct.menu) {
                    this.flare('openmenu');
                }
            }

            //ステージ進行
            var event = this.stageController.get(this.time);
            if (event) {
                if (typeof(event.value) === 'function') {
                    event.value.call(this, event.option);
                } else {
                    this.enterEnemyUnit(event.value);
                }
            }
            //ステージクリア条件チェック
            if (this.mapLayer.clearGate) {
                if (this.stageController.checkStageClearCondition()) {
                    this.mapLayer.clearGate.isLock = false;
                }
            }

            if (!this.pauseScene) this.timeLimit--;
            if (this.timeLimit < 0) {
                this.timeLimit = 0;
            }
            if (this.timeLimit == 0 && !this.player.isDead) {
//                this.player.dead();
            }
        } else {
            //ステージクリア時処理
            //残りタイムをスコア加算
            if (this.timeLimit >= 60) {
                this.timeLimit -= 60;
                this.totalScore += 20;
                if (this.timeLimit < 60) this.timeLimit = 0;
            }

            //ショートカット
            var ct = app.controller;
            if (ct.ok) {
                if (this.timeLimit >= 60) {
                    this.totalScore += Math.floor(this.timeLimit / 60) * 20;
                }
            }
        }

        //スクリーン表示位置
        var map = this.mapLayer.map;
        this.mapLayer.x = SC_W * 0.5 - this.camera.x;
        this.mapLayer.y = SC_H * 0.5 - this.camera.y;
        if (this.limitHeight) {
            if (this.mapLayer.y > 0) this.mapLayer.y = 0;
            if (this.mapLayer.y < -(map.height-SC_H)) this.mapLayer.y = -(map.height-SC_H);
        }
        if (this.limitWidth) {
            if (this.mapLayer.x > 0) this.mapLayer.x = 0;
            if (this.mapLayer.x < -(map.width-SC_W)) this.mapLayer.x = -(map.width-SC_W);
        }

        //スクリーン座標
        this.screenX = -this.mapLayer.x;
        this.screenY = -this.mapLayer.y;

        if (this.stageController.isBackgroundMove) {
            //バックグラウンドのX座標を全体の割合から計算
            this.backgroundImage.x = -Math.floor(this.backgroundImage.width * (this.player.x / map.width)*0.05);
        } else {
            this.backgroundImage.x = this.stageController.backgroundX;
        }

        this.time++;
    },

    //敵キャラクタ投入
    spawnEnemy: function(x, y, name, options) {
        return qft.Enemy[name](this, options).addChildTo(this.enemyLayer).setPosition(x, y);
    },

    //アイテム投入
    spawnItem: function(x, y, options) {
        return qft.Item(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //アイテムボックス投入
    spawnItemBox: function(x, y, options) {
        return qft.ItemBox(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //エフェクト投入
    spawnEffect: function(x, y, options) {
        return qft.Effect(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //メッセージ投入
    spawnMessage: function(text, between, waitFrame) {
        between = between || 32;
        waitFrame = waitFrame || 30;
        var arrayText = text.split("");
        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        };
        var n = 0;
        var x = SC_W * 0.5 - (arrayText.length * between * 0.5);
        arrayText.forEach(function(e) {
            if (e == " ") {
                x += between;
                return;
            }
            var lb = phina.display.Label({text: e}.$safe(labelParam)).setPosition(x, SC_H*0.5+32).setScale(0, 1).addChildTo(this);
            lb.tweener.clear().setUpdateType('fps')
                .set({alpha: 0})
                .wait(n)
                .to({scaleX: 1.0, alpha: 1, y: SC_H*0.5}, 15, "easeOutSine")
                .wait(waitFrame)
                .to({scaleX: 0.0, y: SC_H*0.5-32}, 10, "easeOutSine")
                .call(function(){this.remove()}.bind(lb));
            x += between;
            n += 5;
        }.bind(this));
    },

    //イベントメッセージ投入
    spawnEventMessage: function(id, text) {
        if (!id || !text) return;
        //メッセージスタック内に同一ＩＤがある場合は投入しない
        for (var i = 0; i < this.messageStack.length; i++) {
            if (this.messageStack[i].id == id) return;
        }
        if (text instanceof Array) {
            text.forEach(function(str) {
                this.messageStack.push({id: id, text: str});
            }.bind(this));
        } else {
            this.messageStack.push({id: id, text: text});
        }
    },

    //スクリーン初期化
    setupScreen: function() {
        var that = this;
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "UbuntuMono",
            align: "left",
            baseline: "middle",
            fontSize: 20,
            fontWeight: ''
        };

        //体力ゲージ
        this.lifeGaugeLabel = phina.display.Label({text: "LIFE"}.$safe(labelParam)).addChildTo(this).setPosition(0, 10);
        var options = {
            width:  200,
            height: 5,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 2,
            gaugeColor: 'lime',
            cornerRadius: 0,
            value: this.player.hp,
            maxValue: this.player.hpMax,
        };
        this.lifeGauge = phina.ui.Gauge(options).addChildTo(this).setOrigin(0, 0.5).setPosition(40, 10);
        this.lifeGauge.update = function() {
            this.value = that.player.hp;
            this.width = that.player.hpMax * 2;
            this.maxValue = that.player.hpMax;
        };

        //スコア表示
        this.scoreLabel = phina.display.Label({text:"SCORE:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 10);
        this.scoreLabel.score = 0;
        this.scoreLabel.s = 0;
        this.scoreLabel.update = function(e) {
            if (e.ticker.frame % 10 == 0) {
                this.s = ~~((that.totalScore-this.score)/7);
                if (this.s < 3) this.s = 3;
                if (this.s > 7777) this.s = 7777;
            }
            this.score += this.s;
            if (this.score > that.totalScore) this.score = that.totalScore;

            this.text = "SCORE "+this.score.comma();
        }

        //制限時間表示
        this.timeLabel = phina.display.Label({text: "TIME:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 30);
        this.timeLabel.update = function() {
            this.text = "TIME:"+Math.floor(that.timeLimit/30);
            if (that.timeLimit == 0) {
                this.fill = 'red';
            } else {
                this.fill = 'white';
            }
        }

        //プレイヤー装備武器表示
        this.playerWeapon = qft.PlayerWeapon(this.player).addChildTo(this).setPosition(SC_W-30, SC_H-30);
        var sw = phina.display.RectangleShape({width: 60, height: 60})
            .addChildTo(this)
            .setPosition(SC_W-30, SC_H-30)
            .setInteractive(true)
            .setAlpha(0.0);
        sw.on('pointstart', e => {
            var pl = that.player;
            if (!pl.before.change && pl.equip.switchOk) pl.switchWeapon();
        });
    },

    //マップ情報の初期化
    setupStage: function() {

        this.baseLayer.removeChildren();

        //登録済みマップの消去
        this.clearMap();

        //ステージ設定読み込み
        switch (this.stageNumber) {
            case 1:
                this.stageController = qft.Stage1(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 2:
                this.stageController = qft.Stage2(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 3:
                this.stageController = qft.Stage3(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 4:
                this.stageController = qft.Stage4(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 5:
                this.stageController = qft.Stage5(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 6:
                this.stageController = qft.Stage6(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 7:
                this.stageController = qft.Stage7(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 8:
                this.stageController = qft.Stage8(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 9:
                this.stageController = qft.Stage9(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 10:
                this.stageController = qft.Stage10(this);
                this.switchMap(this.stageController.mapLayer[0]);
                this.isEnding = true;
                //システム表示のＯＦＦ
                this.lifeGaugeLabel.visible = false;
                this.lifeGauge.visible = false;
                this.scoreLabel.visible = false;
                this.timeLabel.visible = false;
                this.playerWeapon.visible = false;
                break;
            case 999:
                this.stageController = qft.Stage999(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
        };

        //ステージクリアフラグクリア
        this.isStageClear = false;

        //経過時間初期化
        this.time = 0;

        //タイムリミット設定
        this.timeLimit = this.stageController.timeLimit;

        //プレイヤー設定
        this.player.isControl = true;
        this.player.isMuteki = false;
        this.player.alpha = 1.0;

        this.mapstart = phina.geom.Vector2(this.player.x, this.player.y);

        this.stageController.playBGM();
    },

    //ステージイベント発火
    fireStageEvent: function(eventName) {
        return this.stageController.fireEvent(eventName);
    },

    warp: function(x, y, frame) {
        frame = frame || 60;
        this.player.isControl = false;
        this.player.gravity = 0;
        this.player.vx = 0;
        this.player.isMuteki = true;
        this.player.tweener.clear()
            .wait(45)
            .call(function(){
                this.ignoreCollision = true;
            }.bind(this.player))
            .moveTo(x, y, frame, "easeInOutSine")
            .call(function(){
                this.ignoreCollision = false;
                this.gravity = 0.9;
            }.bind(this.player))
            .wait(90)
            .call(function(){
                this.isControl = true;
                this.isMuteki = false;
            }.bind(this.player));
    },

    //マップ情報の消去
    clearMap: function() {
        //当たり判定、オブジェクトの全消去
        if (this.backgroundLayer) this.backgroundLayer.removeChildren();
        if (this.foregroundLayer) this.foregroundLayer.removeChildren();
        if (this.collisionLaye) this.collisionLayer.removeChildren();
        if (this.enemyLayer) this.enemyLayer.removeChildren();
        if (this.objLayer) this.objLayer.removeChildren();
        if (this.mapImageLayer) this.mapImageLayer.removeChildren();
        if (this.effectLayer) this.effectLayer.removeChildren();
        if (this.shadowLayer) this.shadowLayer.removeChildren();
    },

    //マップレイヤの切替
    switchMap: function(layer, x, y) {
        if (this.mapLayer) this.mapLayer.remove();
        this.mapLayer = layer;
        this.mapLayer.addChildTo(this.baseLayer);
        this.map = layer.map;

        this.backgroundLayer = layer.backgroundLayer;
        this.foregroundLayer = layer.foregroundLayer;
        this.collisionLayer = layer.collisionLayer;
        this.enemyLayer = layer.enemyLayer;
        this.playerLayer = layer.playerLayer;
        this.objLayer = layer.objLayer;
        this.mapImageLayer = layer.mapImageLayer;
        this.effectLayer = layer.effectLayer;
        this.shadowLayer = layer.shadowLayer;

        this.player.remove();
        this.player.addChildTo(layer.playerLayer);
        if (x) {
            this.player.setPosition(x, y);
        }
    },

    //リスタート
    restart: function() {
        this.player.continueReset();
        this.player.mutekiTime = 90;
        this.player.addChildTo(this.mapLayer.playerLayer);

        //プレイヤー座標を最後に床にいた場所にする
        this.player.x = this.player.lastOnFloorX;
        this.player.y = this.player.lastOnFloorY;

        //復帰位置安全性確認
        var x = this.player.x;
        var y = this.player.y;
        var c1 = this.player.checkMapCollision2(x, y + 5, 4, 32);   //真下
        var c2 = this.player.checkMapCollision2(x+32, y + 5, 4, 32);//右下
        var c3 = this.player.checkMapCollision2(x-32, y + 5, 4, 32);//左下
        //真下に足場が無い場合は安全な場所にずらす
        if (!c1) {
            if (c2) {
                this.player.x += 32;
            } else if (c3){
                this.player.x -= 32;
            } else {
                //安全に復帰出来ないので直近のスタート地点へ
                this.player.x = this.mapstart.x;
                this.player.y = this.mapstart.y;
            }
        }

        this.totalScore = 0;
        this.totalKill = 0;
        this.continueCount++;

        this.stageController.playBGM();
    },

    //ステージクリア
    stageClear: function() {
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 2,

            fontFamily: "UbuntuMono",
            baseline: "middle",
            fontSize: 20,
            fontWeight: ''
        };

        //オールクリア判定
        this.allClear = false;
        if (!this.isPractice && this.stageNumber >= this.stageNumberMax) this.allClear = true;

        //クリアメッセージ投入
        var text = "STAGE " + this.stageNumber + " CLEAR!";
        if (this.allClear) text = "STAGE ALL CLEAR!";
        this.spawnMessage(text, 24);
        this.player.isControl = false;
        this.stageController.stageClear();
        this.isStageClear = true;

        //プレイヤー所持キークリア
        this.player.keys = [];
        this.player.isMuteki = true;

        //クリアBGM
        var bgmFinish = false;
        app.playBGM("stageclear", false, function() {
            bgmFinish = true;
        });

        var ar = {loadcomplete: true};
        if (!this.isPractice) {
            //クリア時点情報保存
            var data = {
                stage: this.stageNumber,
                score: this.totalScore,
                kill: this.totalKill,
                time: this.stageController.timeLimit - this.timeLimit,
            };
            this.clearResult[this.stageNumber] = data;

            //次ステージのアセット読み込み
            if (this.stageNumber < this.stageNumberMax) {
                var assets = qft.Assets.get({assetType: "stage"+(this.stageNumber+1)});
                var ar = phina.extension.AssetLoaderEx().load(assets, function(){app.soundset.readAsset();});
            } else {
                //オールクリア時はエンディング用ステージへ
                if (this.allClear) {
                    var assets = qft.Assets.get({assetType: "stage10"});
                    var ar = phina.extension.AssetLoaderEx().load(assets, function(){app.soundset.readAsset();});
                }
            }
        }

        //ロード進捗表示
        var that = this;
        var param = {text: "Loading... ", align: "right", fontSize: 20}.$safe(labelParam);
        var progress = phina.display.Label(param).addChildTo(this).setPosition(SC_W, SC_H*0.95);
        progress.time = 0;
        progress.update = function() {
            //ロードが終わったらキー入力で次ステージへ
            if (ar.loadprogress) this.text = "Loading... "+Math.floor(ar.loadprogress * 100)+"%";
            if (bgmFinish && that.timeLimit == 0 && ar.loadcomplete) {
                this.text = "Push button to next stage.";
                if (that.allClear) this.text = "Push button to next...";
                var ct = app.controller;
                if (ct.ok || ct.cancel) {
                    if (that.isPractice) {
                        that._exitGame = true;
                    } else {
                        that.flare('nextstage');
                    }
                    this.remove();
                }
            }
            if (this.time % 30 == 0) this.visible = !this.visible;
            this.time++;
        }
    },

    exitGame: function() {
        app.playBGM("openingbgm");
        if (this.isPractice || this.isContinue) {
            this.exit();
        } else {
            this.exit("title");
        }
    },

    //現在のステータスをローカルストレージへ保存
    saveGame: function() {
        var saveObj = {
            stageNumber: this.stageNumber,
            score: this.totalScore,
            kill: this.totalKill,
            result: this.clearResult,
            playerStatus: this.player.startStatus,
        };
        localStorage.setItem("stage", JSON.stringify(saveObj));
        return saveObj;
    },

    //ローカルストレージから直前の保存状態を読み込み
    loadGame: function() {
        var data = localStorage.getItem("stage");
        if (data) {
            var d = JSON.parse(data).$safe({
                stageNumber: 1,
                result: [],
                playerStatus: {},
            });
            this.stageNumber = d.stageNumber;
            this.totalScore = 0;
            this.totalKill = 0;
            this.clearResult = d.result;

            //プレイヤー情報復元
            this.player.startStatus = d.playerStatus;
            this.player.restoreStatus();
            this.playerWeapon.rotation = 0;
        }
        return d;
    },
});

/*
 *  menuscene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.MenuScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,0.5)",
            stroke: "rgba(0,0,0,0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "left",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };

        this.player = this.currentScene.player;
        this.limitFrame = 30;
        this.isExit = false;

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont2",
            align: "center",
            baseline: "middle",
            fontSize: 70,
        };
        this.textLabel1 = phina.display.Label({text: "PAUSE", fontSize: 20}.$safe(labelParam))
            .addChildTo(this).setPosition(SC_W*0.5, SC_H*0.8);

        this.time = 0;        
    },

    update: function() {
        var ct = app.controller;
        if (this.time > 10 && !this.isExit) {
            if (ct.start || ct.pause || ct.menu) {
                this.isExit = true;
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
        }
        this.limitFrame--;
        this.time++;
    },
});


/*
 *  menuscene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.MenuScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,0.5)",
            stroke: "rgba(0,0,0,0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "left",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };

        this.player = this.currentScene.player;
        var x = SC_W*0.3; //this.player.x + this.currentScene.mapLayer.x;
        var y = SC_H*0.5; //this.player.y + this.currentScene.mapLayer.y;

        //ベースエレメント
        this.menuBase = phina.display.DisplayElement().addChildTo(this).setPosition(x, y);
        this.menuBase.tweener.setUpdateType('fps');

        //メニューアイテム初期化
        this.setItems();

        //現在装備表示
        var eq = this.player.equip;
        this.weapon = phina.display.Sprite("item", 24, 24)
            .setPosition(SC_W*0.55, SC_H*0.3)
            .setScale(1.5)
            .setFrameIndex(eq.weapon[0])
            .addChildTo(this);
        this.weaponLabel = phina.display.Label({text: ""}.$safe(labelParam))
            .setPosition(SC_W*0.55+32, SC_H*0.3)
            .addChildTo(this);
        this.weaponLabel.update = function() {
            var item = qft.ItemInfo.get(eq.weapon[0]);
            this.text = item.name;
        };

        this.limitFrame = 30;

        this.isExit = false;
        this.time = 0;        
    },

    update: function() {
        var ct = app.controller;
        if (this.time > 10 && !this.isExit) {
            if (ct.start || ct.pause || ct.menu) {
                this.isExit = true;
                this.close();
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
            if (ct.right && this.limitFrame < 0) {
                app.playSE("click");
                this.menuBase.tweener.clear()
                    .by({rotation: -this.deg_1}, 4)
                    .call(function(){
                        if (this.rotation < 0) this.rotation += 360;
                    }.bind(this.menuBase));
                this.limitFrame = 5;
                this.currentScene.menuSelect++;
                if (this.currentScene.menuSelect == this.icon.length) this.currentScene.menuSelect = 0;
            }
            if (ct.left && this.limitFrame < 0) {
                app.playSE("click");
                this.menuBase.tweener.clear()
                    .by({rotation: this.deg_1}, 4)
                    .call(function(){
                        if (this.rotation > 360) this.rotation -= 360;
                    }.bind(this.menuBase));
                this.limitFrame = 5;
                this.currentScene.menuSelect--;
                if (this.currentScene.menuSelect < 0) this.currentScene.menuSelect = this.icon.length-1;
            }
        }
        this.limitFrame--;
        this.time++;
    },

    setItems: function() {
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 24,
            fontWeight: ''
        };

        var that = this;
        this.menuBase.removeChildren();

        //メニューアイテム
        this.icon = [];
        this.menuItems = this.player.items.clone();

        var rad = 0;
        var rad_1 = (Math.PI*2) / this.menuItems.length;
        var id = 0;
        this.menuItems.forEach(function(e) {
            var ic;
            if (typeof e === 'string') {
                ic = phina.display.Label({text: e}.$safe(labelParam)).addChildTo(this.menuBase);
                ic.setScale(0.5);
            } else {
                ic = phina.display.Sprite("item", 24, 24)
                    .addChildTo(this.menuBase)
                    .setFrameIndex(e);
            }
            ic.tweener.setUpdateType('fps');
            ic.rad = rad;
            ic.id = id;
            ic.distance = 0;
            ic.isClose = false;
            ic.update = function() {
                this.rotation = -that.menuBase.rotation;
                this.x =  Math.sin(this.rad)*this.distance;
                this.y = -Math.cos(this.rad)*this.distance;
                if (this.isClose) return;
                if (this.id == that.currentScene.menuSelect) {
                    this.tweener.clear().to({distance: 88, scaleX: 3, scaleY: 3}, 3);
                } else {
                    this.tweener.clear().to({distance: 72, scaleX: 1, scaleY: 1}, 3);
                }
            }
            ic.close = function() {
                this.tweener.clear().to({distance: 0, scaleX: 1, scaleY: 1}, 3);
                this.isClose = true;
            }
            ic.tweener.clear().to({distance: 48}, 500);
            this.icon.push(ic);
            rad += rad_1;
            id++;
        }.bind(this));

        this.deg_1 = 360/ this.menuItems.length;
        this.menuBase.rotation = -(this.currentScene.menuSelect * this.deg_1) - 90;
        this.menuBase.tweener.by({rotation: 90}, 15, "easeOutSine");
    },

    close: function() {
        this.menuBase.tweener.clear().by({rotation: 180}, 15, "easeOutSine");
        this.icon.forEach(function(e) {
            e.close();
        }.bind(this));
    },
});


/*
 *  messagescene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.MessageScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //メッセージウィンドウ
        var param = {
            width:SC_W*0.8,
            height:SC_H*0.4,
            fill: "rgba(0,0,0,0.8)",
            stroke: "white",
            sttokeWidth: 5,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.25)
            .setScale(1, 0);
        this.bg.tweener.clear().to({scaleY: 1}, 500, "easeOutCube");

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };
        this.textLabel = phina.display.Label({text: options.message || "no message", fontSize: 20}.$safe(labelParam))
            .addChildTo(this).setPosition(SC_W*0.5, SC_H*0.25);

        this.player = this.currentScene.player;
        this.limitFrame = 30;
        this.isExit = false;

        this.time = 0;        
    },

    update: function() {
        var ct = app.controller;
        if (this.time > 10 && !this.isExit) {
            if (ct.start || ct.pause || ct.menu) {
                this.isExit = true;
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
        }
        this.limitFrame--;
        this.time++;
    },
});


/*
 *  openingscene.js
 *  2017/02/08
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.OpeningScene", {
    superClass: "phina.display.DisplayScene",

    //進行
    seq: 0,

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //ＢＧＭ再生
        app.playBGM("openingbgm");

        this.text = [
            "世界の中心にそびえる塔",
            "塔の最上階には",
            "「永遠の都」と呼ばれる楽園があるという",
            "噂を聞いた多くの冒険者が",
            "楽園を求めて塔へと赴き",
            "その謎に挑んでいった",
            "しかし…",
            "彼らが果たして楽園に辿り着いたのか",
            "それとも世界の果てで力尽きたのか",
            "その末路を知る者はいない",
            "そして…",
            "新たな冒険者がまた一人",
            "いまだ見ぬ楽園への道に挑もうとしていた",
        ];

        //バックグラウンド
        var param = {
            width: SC_W,
            height: SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.5)

        //イメージ表示用レイヤ
        this.imageLayer = phina.display.DisplayElement().addChildTo(this);

        //フォアグラウンド
        var that = this;
        this.fg = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.5).setInteractive(true);
        this.fg.alpha = 0;
        this.fg.onpointstart = function() {
            if (that.alreadyLoad || that.loader && that.loader.loadcomplete) that.exit();
        }

        //上下黒帯
        param.height = SC_H * 0.15;
        this.bg1 = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.07)
        this.bg2 = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.93)

        //字幕
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 14,
        };
        var num = 0;
        this.textLabel = phina.display.Label({text: ""}.$safe(labelParam)).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.9);
        this.textLabel.alpha = 0;
        this.textLabel.tweener.clear()
            .call(function() {
                this.textLabel.text = this.text[num];
                num++;
                if (num == this.text.length) {
                    this.textLabel.tweener.setLoop(false);
                }
            }.bind(this))
            .fadeIn(500)
            .wait(3000)
            .fadeOut(500)
            .wait(1000)
            .setLoop(true);

        //基本アセットをロード
        this.alreadyLoad = false;
        if (qft.Assets.isLoaded("common")) {
            //読込済みなのでスキップ
            this.alreadyLoad = true;
            return;
        }
        var that = this;
        var assets = qft.Assets.get({assetType: "common"});
        this.loader = phina.extension.AssetLoaderEx().load(assets, function(){app.soundset.readAsset();});
        this.loadLabel = phina.display.Label({text: "", align: "right", fontSize: 12}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.99, SC_H*0.1);
        this.loadLabel.time = 1;    
        this.loadLabel.update = function() {
            this.text = "Loading... "+Math.floor(that.loader.loadprogress * 100)+"%";
            if (that.loader.loadcomplete) {
                this.text = "Push button to skip.";
                this.visible = true;
            } else {
                if (this.time % 20 == 0) this.visible = !this.visible;
            }
            this.time++;
        };
    },

    update: function() {
        if (this.alreadyLoad || this.loader && this.loader.loadcomplete) {
            var ct = app.controller;
            if (ct.ok || ct.cancel) this.exit();
        }

        if (this.seq == 0) {
            this.worldmap();
            this.seq++;
        }
        if (this.seq == 2) {
            this.towerimage();
            this.seq++;
        }
        if (this.seq == 4) {
            this.sequence3();
            this.seq++;
        }
        if (this.seq == 6) {
            this.playerimage();
            this.seq++;
        }
        if (this.seq == 8) {
            this.exit();
        }
    },

    //世界地図
    worldmap: function() {
        var sprite1 = phina.display.Sprite("openingmap")
            .addChildTo(this.imageLayer)
            .setPosition(SC_W * 0.5, -SC_H * 0.25)
            .setScale(0.8)
            .setAlpha(0.0);
        sprite1.tweener.clear()
            .by({alpha: 1.0, y: 200}, 7000)
            .by({alpha: -1.0, y: 200}, 7000)
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));
    },

    //塔外観
    towerimage: function() {
        var sprite1 = phina.display.Sprite("background").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.5);
        sprite1.alpha = 0;
        sprite1.tweener.clear()
            .call(function(){
                sprite1.alpha = 1;
                this.fg.alpha = 1;
                this.fg.tweener.clear().fadeOut(7000).fadeIn(7000);
            }.bind(this))
            .wait(14000)
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));

        var sprite2 = phina.display.Sprite("openingtower").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.3);
        sprite2.alpha = 0;
        sprite2.tweener.clear()
            .call(function(){
                sprite2.alpha = 1;
            }.bind(this))
            .by({x: -100}, 4000, "easeInOutSine")
            .wait(3000)
            .by({y: 300}, 7000, "easeInSine")
            .call(function(){
                sprite2.remove();
            }.bind(this));
    },

    //三番目表示（暫定）
    sequence3: function() {
        var sprite1 = phina.display.Sprite("openingback2").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.3).setScale(1.1);
        sprite1.alpha = 0;
        sprite1.tweener.clear()
            .call(function(){
                sprite1.alpha = 1;
                this.fg.alpha = 1;
                this.fg.tweener.clear().fadeOut(7000).wait(10000).fadeIn(7000);
            }.bind(this))
            .by({y: 150}, 12000, "easeInOutSine")
            .wait(12000)
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));

        var sprite2 = phina.display.Sprite("openinglight").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.5);
        sprite2.blendMode = 'lighter';
        sprite2.alpha = 0.3;
        sprite2.tweener.clear()
            .wait(12000)
            .by({x: -50}, 12000, "easeInOutSine");
    },

    //プレイヤー表示
    playerimage: function() {
        var sprite1 = phina.display.Sprite("openingback").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.35).setScale(1.2);
        sprite1.alpha = 0;
        sprite1.tweener.clear()
            .call(function(){
                sprite1.alpha = 1;
                this.fg.alpha = 1;
                this.fg.tweener.clear().fadeOut(7000).wait(5000).fadeIn(7000);
            }.bind(this))
            .wait(15000)
            .by({y: 150}, 5000, "easeInOutSine")
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));

        var sprite2 = phina.display.Sprite("openingground").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.9);
        sprite2.tweener.clear()
            .by({y: -50}, 4000, "easeInOutSine")
            .wait(10000)
            .by({y: 200}, 5000, "easeInOutSine")

        var pl = qft.PlayerDummy("player1").addChildTo(sprite2).setPosition(0, 38);
        pl.setAnimation("up");
        pl.tweener.clear()
            .wait(3000)
            .by({y: -76}, 5000, "easeInOutSine")
            .call(function() {
                pl.setAnimation("up_stop");
            })
            .wait(6000)
            .call(function() {
                pl.setAnimation("down");
            })
            .by({y: 76}, 5000, "easeInOutSine");
    },
});


/*
 *  practicescene.js
 *  2017/04/15
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.ConfigScene_Practice", {
    superClass: "phina.display.DisplayScene",

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        this.menuBase = phina.display.DisplayElement().addChildTo(this);
        this.menuBase.alpha = 0;
        this.menuBase.tweener.clear().fadeIn(500);

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont1",
            align: "center",
            baseline: "middle",
            fontSize: 70,
        };
        this.textLabel1 = phina.display.Label({text: "Practice", fontSize: 20}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.2);
        this.textLabel2 = phina.display.Label({text: "Stage select", fontSize: 20}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.3);

        //メニューテキスト表示
        var that = this;
        this.menu = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "P"];
        this.menuText = [];
        for (var i = 0; i < this.menu.length; i++) {
            this.menuText[i] = phina.display.Label({text: this.menu[i], fontSize: 40}.$safe(labelParam))
                .addChildTo(this.menuBase)
                .setPosition(SC_W*0.5+(SC_W*0.07*i)-(SC_W*0.07*(this.menu.length-1)/2), SC_H*0.5)
                .setScale(0.7);

            //タッチ判定用
            var param2 = {
                width: 30,
                height: SC_H*0.10,
                fill: "rgba(0,100,200,0.5)",
                stroke: "rgba(0,100,200,0.5)",
                backgroundColor: 'transparent',
            };
            var c = phina.display.RectangleShape(param2)
                .addChildTo(this.menuBase)
                .setPosition(SC_W*0.5+(SC_W*0.07*i)-(SC_W*0.07*(this.menu.length-1)/2), SC_H*0.5)
                .setInteractive(true);
            c.alpha = 0;
            c.select = i;
            c.onpointstart = function() {
                if (that.isSelected || that.time < 10) return;
                if (this.select == that.select) {
                    that.ok = true;
                } else {
                    if (that.vselect == 0) {
                        that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    } else {
                        that.exitText.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    }
                    that.select = this.select;
                    that.menuText[that.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                    that.vselect = 0;
                    app.playSE("select");
                }
            }
        }

        this.exitText = phina.display.Label({text: "Exit", fontSize: 40}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.7)
            .setScale(0.7);
        //タッチ判定用
        var param2 = {
            width: SC_W*0.3,
            height: SC_H*0.10,
            fill: "rgba(0,100,200,0.5)",
            stroke: "rgba(0,100,200,0.5)",
            backgroundColor: 'transparent',
        };
        var c = phina.display.RectangleShape(param2)
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.7)
            .setInteractive(true);
        c.alpha = 0;
        c.onpointstart = function() {
            if (that.isSelected || that.time < 10) return;
            if (that.vselect == 1) {
                that.ok = true;
            } else {
                that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                that.exitText.tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                that.vselect = 1;
                app.playSE("select");
            }
        }

        this.vselect = 0;
        this.select = 0;
        this.isSelected = false;
        this.selectMax = this.menu.length;
        this.menuText[0].setScale(1);
        this.ok = false;
        this.cancel = false;

        this.time = 0;

        this.on('resume', function() {
            this.time = 0;
            this.isSelected = false;
            this.ok = false;
            this.cansel = false;
        });
    },

    update: function() {
        var ct = app.controller;
        if (ct.right && !ct.before.right && this.select < this.selectMax-1 && this.vselect == 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select++;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }
        if (ct.left && !ct.before.left && this.select > 0  && this.vselect == 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }
        if (ct.down && !ct.before.down && this.vselect == 0) {
            this.vselect++;
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.exitText.tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }
        if (ct.up && !ct.before.up && this.vselect == 1) {
            this.vselect--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.exitText.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }

        if (this.time > 15) {
            if (ct.ok || this.ok) {
                if (this.vselect == 0) {
                    if (this.select == 0) {
                        app.pushScene(qft.MainScene({startStage: 1, isPractice: true}));
                    } else {
                        if (this.select == 9) {
                            app.pushScene(qft.MainScene({startStage: 999, isPractice: true}));
                        } else if (this.select == 8) {
                            app.pushScene(qft.SceneFlow.Resume({stageNumber: 10, isPractice: false}));
                        } else {
                            app.pushScene(qft.SceneFlow.Resume({stageNumber: this.select+1, isPractice: true}));
                        }
                    }
                    app.stopBGM();
                }
                if (this.vselect == 1) {
                    app.playSE("cancel");
                    this.exitMenu();
                }
                this.time = 0;
            }
            if (ct.cancel || this.cancel) {
                app.playSE("cancel");
                this.exitMenu();
                this.time = 0;
            }
        }
        this.time++;
    },

    exitMenu: function() {
        this.menuBase.tweener.clear()
            .fadeOut(500)
            .call(function() {
                this.exit();
            }.bind(this));
    },
});

phina.define("qft.PracticePlatform", {
    superClass: "phina.display.DisplayScene",

    init: function(options) {
        this.superInit();
        this.options = (options || {}).$safe({
            assetType: "stage2",
            startStage: 2,
        })
        this.count = 0;
    },

    onenter: function() {
        app.pushScene(qft.LoadingScene({
            assets: qft.Assets.get(this.options),
        }));
    },

    onresume: function() {
        this.count++;
        if (this.count == 1) {
            app.pushScene(qft.MainScene({startStage: this.options.startStage, isPractice: true}));
        }
        if (this.count == 2){
            this.exit();
        }
    }
});

/*
 *  SceneFlow.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

//メインシーンフロー
phina.define("qft.SceneFlow", {
    superClass: "phina.game.ManagerScene",

    init: function(options) {
        options = options || {};
        startLabel = options.startLabel || "splash";
        this.superInit({
            startLabel: startLabel,
            scenes: [{
                label: "splash",
                className: "qft.SplashScene",
            },{
                label: "opening",
                className: "qft.OpeningScene",
            },{
                label: "title",
                className: "qft.TitleScene",
                nextLabel: "opening",
            },{
                label: "main",
                className: "qft.MainScene",
                arguments: {
                    startStage: 1,
                    isPractice: false,
                },
                nextLabel: "title",
            },{
                label: "continue",
                className: "qft.SceneFlow.Resume",
                arguments: {
                    isPractice: false,
                    isContinue: true,
                },
                nextLabel: "title",
            },{
                label: "ending",
                className: "qft.EndingScene",
                nextLabel: "main",
            },{
                label: "config",
                className: "qft.ConfigScene",
                nextLabel: "title",
            },{
                label: "practice",
                className: "qft.ConfigScene_Practice",
                nextLabel: "config",
            }],
        });
    }
});

//復帰用
phina.define("qft.SceneFlow.Resume", {
    superClass: "phina.game.ManagerScene",

    init: function(options) {
        options = (options || {}).$safe({stageNumber: 2, isPractice: false, isContinue: false});
        if (options.isContinue) {
            var data = localStorage.getItem("stage");
            if (data) {
                var d = JSON.parse(data).$safe({
                    stageNumber: 1,
                    result: [],
                    playerStatus: {},
                });
                options.stageNumber = d.stageNumber;
            } else {
                options.stageNumber = 1;
            }
        }
        var startLabel = "start";
        var assets = qft.Assets.get({assetType: "stage"+options.stageNumber});
        this.superInit({
            startLabel: startLabel,
            scenes: [{
                label: "start",
                className: "qft.LoadingScene",
                arguments: {
                    assets: assets,
                },
                nextLabel: "main",
            },{
                label: "main",
                className: "qft.MainScene",
                arguments: {
                    startStage: options.stageNumber,
                    isPractice: options.isPractice,
                    isContinue: options.isContinue,
                },
            }],
        });
    },
    onfinish: function() {
        this.exit();
    }
});

/*
 *  splashscene.js
 *  2017/02/08
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define('qft.SplashScene', {
    superClass: 'phina.display.DisplayScene',

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        this.unlock = false;
        this.loadcomplete1 = false;
        this.loadcomplete2 = false;
        this.progress1 = 0;
        this.progress2 = 0;

        //preload asset
        var assets = qft.Assets.get({assetType: "splash"});
        this.loader = phina.asset.AssetLoader();
        this.loader.load(assets);
        this.loader.on('load', function(e) {
            this.loadcomplete1 = true;
        }.bind(this));
        this.loader.on('progress', function(e) {
            this.progress1 = Math.floor(e.progress*100);
        }.bind(this));

        //preload asset2
        var assets = qft.Assets.get({assetType: "splash2"});
        this.loader2 = phina.asset.AssetLoader();
        this.loader2.load(assets);
        this.loader2.on('load', function(e) {
            this.loadcomplete2 = true;
        }.bind(this));
        this.loader2.on('progress', function(e) {
            this.progress2 = Math.floor(e.progress*100);
        }.bind(this));

        //logo
        var texture = phina.asset.Texture();
        texture.load(qft.SplashScene.logo).then(function() {
            this._init();
        }.bind(this));
        this.texture = texture;
    },

    _init: function() {
        this.sprite = phina.display.Sprite(this.texture)
            .addChildTo(this)
            .setPosition(this.gridX.center(), this.gridY.center())
            .setScale(0.3);
        this.sprite.alpha = 0;

        this.sprite.tweener.clear()
            .to({alpha:1}, 500, 'easeOutCubic')
            .wait(500)
            .call(function() {
                this.unlock = true;
            }, this);

        var that = this;
        //進捗ゲージ
        var options = {
            width:  SC_W*0.1,
            height: 3,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 1,
            gaugeColor: 'lime',
            cornerRadius: 3,
            value: 0,
            maxValue: 100,
        };
        this.progressGauge = phina.ui.Gauge(options).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.8);
        this.progressGauge.beforeValue = 0;
        this.progressGauge.update = function() {
            if (that.progress1 == this.beforeValue) {
                this.value++;
            } else {
                this.value = that.progress1;
            }
            this.beforeValue = this.value;
        };
    },

    update: function() {
        if (this.unlock && this.loadcomplete1 && this.loadcomplete2) {
            this.unlock = false;
            this.sprite.tweener.clear()
                .to({alpha:0}, 500, 'easeOutCubic')
                .call(function() {
                    this.exit();
                }, this);
            this.progressGauge.tweener.clear().to({alpha:0}, 10, 'easeOutCubic')
        }
    },

    _static: {
        logo: "assets/image/phinajs_logo.png",
    },
});

/*
 *  titlescene.js
 *  2017/02/09
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.TitleScene", {
    superClass: "phina.display.DisplayScene",

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.setUpdateType('fps');

        var sprite1 = phina.display.Sprite("titleback").addChildTo(this).setPosition(SC_W * 0.5, SC_H * 0.5);
        sprite1.alpha = 0;
        sprite1.tweener.clear().fadeIn(500);

        //タイトルロゴの表示
        this.dispTitleLogo();

        //メニューアイテム表示
        var that = this;
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont2",
            align: "center",
            baseline: "middle",
            fontSize: 30,
        };
        this.menu = ["Start", "Continue", "Config"];
        this.menuComment = ["ゲームを開始します", "前回ゲームオーバーになったステージの最初から開始します", "設定メニューを開きます"];
        this.menuText = [];
        for (var i = 0; i < this.menu.length; i++) {
            this.menuText[i] = phina.display.Label({text: this.menu[i]}.$safe(labelParam))
                .addChildTo(this)
                .setPosition(SC_W*0.5, SC_H*0.6+i*30)
                .setScale(0.7);

            //タッチ判定用
            var param2 = {
                width: SC_W*0.3,
                height: SC_H*0.08,
                fill: "rgba(0,100,200,0.5)",
                stroke: "rgba(0,100,200,0.5)",
                backgroundColor: 'transparent',
            };
            var c = phina.display.RectangleShape(param2)
                .addChildTo(this)
                .setPosition(SC_W*0.5, SC_H*0.6+i*30)
                .setInteractive(true);
            c.alpha = 0;
            c.select = i;
            c.onpointstart = function() {
                if (that.isSelected || that.time < 10) return;
                if (this.select == that.select) {
                    that.ok = true;
                } else {
                    that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    that.select = this.select;
                    that.menuText[that.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                    app.playSE("select");
                }
            }
        }
        this.isSelected = false;
        this.select = 0;
        this.selectMax = 3;
        this.menuText[0].setScale(1);
        this.ok = false;
        this.cansel = false;

        //メニューコメント
        var that = this;
        this.comment = phina.display.Label({text: "", fontSize: 10}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.9);
        this.comment.update = function() {
            this.text = that.menuComment[that.select];
        }

        this.fg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fg.tweener.setUpdateType('fps');
        this.fg.tweener.clear().fadeOut(15);

        this.on('resume', e => {
            this.fg.tweener.clear().fadeOut(15);
            this.time = 0;
            this.isSelected = false;
            this.ok = false;
            this.cansel = false;
        });

        this.time = 0;
    },

    update: function(app) {
        if (this.isSelected) return;

        var ct = app.controller;
        if (ct.down && !ct.before.down && this.select < this.selectMax-1) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select++;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }
        if (ct.up && !ct.before.up && this.select > 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }
        if (this.time > 15) {
            if (ct.ok || this.ok){
                this.isSelected = true;
                this.time = 0;
                switch (this.select) {
                    case 0:
                        //通常開始
                        app.playSE("ok");
                        this.fg.tweener.clear()
                            .fadeIn(3)
                            .call(function() {
                                this.exit("main");
                            }.bind(this));
                        break;
                    case 1:
                        //コンティニュー
                        app.playSE("ok");
                        this.fg.tweener.clear()
                            .fadeIn(3)
                            .call(function() {
                                var data = localStorage.getItem("stage");
                                if (data) {
                                    var d = JSON.parse(data).$safe({stageNumber: 1});
                                    if (d.stageNumber == 1) {
                                        this.exit("main");
                                    } else {
                                        app.pushScene(qft.SceneFlow.Resume({isPractice: false, isContinue: true}));
                                    }
                                } else {
                                    this.exit("main");
                                }
                            }.bind(this));
                        break;
                    case 2:
                        //設定メニュー
                        app.pushScene(qft.ConfigScene(this));
                        break;
                }
            }
            if (ct.cancel || this.cancel) {
                app.pushScene(qft.ConfigScene(this));
                this.isSelected = true;
                this.time = 0;
            }
        }
        if (this.time > 30 * 120) {
            this.exit("opening");
        }
        this.time++;
    },

    //タイトルロゴ表示
    dispTitleLogo: function(x, y) {
        x = x || SC_W * 0.5;
        y = y || SC_H * 0.45;

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 10,

            fontFamily: "titlefont1",
            align: "center",
            baseline: "middle",
            fontSize: 60,
        };
        var num = 0;
        this.textLabel = phina.display.Label({text: "The", fontSize: 30}.$safe(labelParam))
            .addChildTo(this).setPosition(x-182, y-85);
        this.textLabel = phina.display.Label({text: "Quest"}.$safe(labelParam))
            .addChildTo(this).setPosition(x-47, y-85);
        this.textLabel = phina.display.Label({text: "for", fontSize: 40}.$safe(labelParam))
            .addChildTo(this).setPosition(x-17, y-40);
        this.textLabel = phina.display.Label({text: "Tanelorn"}.$safe(labelParam))
            .addChildTo(this).setPosition(x+48, y);
    },
});

/*
 *  tutorialscene.js
 *  2017/06/01
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.TutorialScene", {
    superClass: "phina.display.DisplayScene",

    //スクリーンのマップ外への移動制限フラグ
    limitWidth: false,
    limitHeight: true,

    //プレイヤースクリーン中央固定フラグ
    centerPlayer: true,

    init: function(options) {
        this.superInit({width: SC_W, height: SC_H});

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.setUpdateType('fps');

        //背景
        this.backgroundImage = phina.display.Sprite("background").addChildTo(this).setPosition(0, SC_H*0.5).setOrigin(0, 0.5);

        //管理用基準レイヤ
        this.baseLayer = phina.display.DisplayElement().addChildTo(this);

        //プレイヤーキャラクタ
        this.player = qft.Player(this);

       //スクリーン初期化
        this.setupScreen();

        //ステージ情報初期化
        this.setupStage();

        this.fg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fg.tweener.setUpdateType('fps').clear().fadeOut(30);

        //バーチャルパッドの可視化
//        app.virtualPad.addChildTo(this);

        app.volumeBGM = 0.5;
        app.volumeSE = 0.2;

        //メッセージ表示
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };
        var that = this;
        this.messageStack = [];
        this.eventMessage = phina.display.Label({text: ""}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.2)
            .addChildTo(this);
        this.eventMessage.alpha = 0;
        this.eventMessage.tweener.clear().setUpdateType('fps');
        this.eventMessage.nextOk = true;
        this.eventMessage.update = function() {
            if (this.nextOk && that.messageStack.length > 0) {
                this.nextOk = false;
                var msg = that.messageStack[0];
                this.tweener.clear()
                    .call(function(){
                        this.text = msg.text;
                    }.bind(this))
                    .fadeIn(15).wait(90).fadeOut(15)
                    .call(function(){
                        this.nextOk = true;
                        that.messageStack.splice(0, 1);
                    }.bind(this))
            }
        }

        this.time = 0;
    },

    update: function(app) {
        if (this.time == 15) this.player.isControl = true;

        //スクリーン表示位置をプレイヤー中心になる様に調整
        if (this.centerPlayer) {
            var map = this.mapLayer.map;
            this.mapLayer.x = SC_W*0.5-this.player.x;
            this.mapLayer.y = SC_H*0.5-this.player.y;
            if (this.limitHeight) {
                if (this.mapLayer.y > 0) this.mapLayer.y = 0;
                if (this.mapLayer.y < -(map.height-SC_H)) this.mapLayer.y = -(map.height-SC_H);
            }
            if (this.limitWidth) {
                if (this.mapLayer.x > 0) this.mapLayer.x = 0;
                if (this.mapLayer.x < -(map.width-SC_W)) this.mapLayer.x = -(map.width-SC_W);
            }

            //スクリーン座標
            this.screenX = -this.mapLayer.x;
            this.screenY = -this.mapLayer.y;

            //バックグラウンドのX座標を全体の割合から計算
            this.backgroundImage.x = -Math.floor(this.backgroundImage.width * (this.player.x / map.width)*0.01);
        }

        this.time++;
    },

    //敵キャラクタ投入
    spawnEnemy: function(x, y, name, options) {
        return qft.Enemy[name](this, options).addChildTo(this.enemyLayer).setPosition(x, y);
    },

    //アイテム投入
    spawnItem: function(x, y, options) {
        return qft.Item(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //アイテムボックス投入
    spawnItemBox: function(x, y, options) {
        return qft.ItemBox(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //エフェクト投入
    spawnEffect: function(x, y, options) {
        return qft.Effect(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //メッセージ投入
    spawnMessage: function(text, between, waitFrame) {
        between = between || 32;
        waitFrame = waitFrame || 30;
        var arrayText = text.split("");
        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        };
        var n = 0;
        var x = SC_W * 0.5 - (arrayText.length * between * 0.5);
        arrayText.forEach(function(e) {
            if (e == " ") {
                x += between;
                return;
            }
            var lb = phina.display.Label({text: e}.$safe(labelParam)).setPosition(x, SC_H*0.5+32).setScale(0, 1).addChildTo(this);
            lb.tweener.clear().setUpdateType('fps')
                .set({alpha: 0})
                .wait(n)
                .to({scaleX: 1.0, alpha: 1, y: SC_H*0.5}, 15, "easeOutSine")
                .wait(waitFrame)
                .to({scaleX: 0.0, y: SC_H*0.5-32}, 10, "easeOutSine")
                .call(function(){this.remove()}.bind(lb));
            x += between;
            n += 5;
        }.bind(this));
    },

    //イベントメッセージ投入
    spawnEventMessage: function(id, text) {
        if (!id || !text) return;
        //メッセージスタック内に同一ＩＤがある場合は投入しない
        for (var i = 0; i < this.messageStack.length; i++) {
            if (this.messageStack[i].id == id) return;
        }
        if (text instanceof Array) {
            text.forEach(function(str) {
                this.messageStack.push({id: id, text: str});
            }.bind(this));
        } else {
            this.messageStack.push({id: id, text: text});
        }
    },

    //スクリーン初期化
    setupScreen: function() {
        var that = this;
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "UbuntuMono",
            align: "left",
            baseline: "middle",
            fontSize: 20,
            fontWeight: ''
        };

        //体力ゲージ
        phina.display.Label({text: "LIFE"}.$safe(labelParam)).addChildTo(this).setPosition(0, 10);
        var options = {
            width:  256,
            height: 5,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 2,
            gaugeColor: 'lime',
            cornerRadius: 0,
            value: this.player.hp,
            maxValue: this.player.hp,
        };
        this.lifeGauge = phina.ui.Gauge(options).addChildTo(this).setOrigin(0, 0.5).setPosition(40, 10);
        this.lifeGauge.update = function() {
            this.value = that.player.hp;
        };

        //スコア表示
        this.scoreLabel = phina.display.Label({text:"SCORE:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 10);
        this.scoreLabel.score = 0;
        this.scoreLabel.s = 0;
        this.scoreLabel.update = function(e) {
            if (e.ticker.frame % 10 == 0) {
                this.s = ~~((that.totalScore-this.score)/7);
                if (this.s < 3) this.s = 3;
                if (this.s > 7777) this.s = 7777;
            }
            this.score += this.s;
            if (this.score > that.totalScore) this.score = that.totalScore;

            this.text = "SCORE "+this.score.comma();
        }

        //制限時間表示
        var tl = phina.display.Label({text: "TIME:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 30);
        tl.update = function() {
            this.text = "TIME:"+Math.floor(that.timeLimit/30);
            if (that.timeLimit == 0) {
                this.fill = 'red';
            } else {
                this.fill = 'white';
            }
        }

        //プレイヤー装備武器表示
        this.playerWeapon = qft.PlayerWeapon(this.player).addChildTo(this).setPosition(SC_W-30, SC_H-30);
    },

    //マップ情報の初期化
    setupStage: function() {

        this.baseLayer.removeChildren();

        this.stageController = qft.Stage999(this);
        this.switchMap(this.stageController.mapLayer[0]);

        //経過時間初期化
        this.time = 0;

        //タイムリミット設定
        this.timeLimit = this.stageController.timeLimit;

        //プレイヤー設定
        this.player.isControl = false;
        this.player.isMuteki = false;
        this.player.alpha = 1.0;

        this.stageController.playBGM();
    },

    //マップレイヤの切替
    switchMap: function(layer, x, y) {
        if (this.mapLayer) this.mapLayer.remove();
        this.mapLayer = layer;
        this.mapLayer.addChildTo(this.baseLayer);
        this.map = layer.map;

        this.backgroundLayer = layer.backgroundLayer;
        this.foregroundLayer = layer.foregroundLayer;
        this.collisionLayer = layer.collisionLayer;
        this.enemyLayer = layer.enemyLayer;
        this.playerLayer = layer.playerLayer;
        this.objLayer = layer.objLayer;
        this.mapImageLayer = layer.mapImageLayer;
        this.effectLayer = layer.effectLayer;

        this.player.remove();
        this.player.addChildTo(layer.playerLayer);
        if (x) {
            this.player.setPosition(x, y);
        }
    },
});

/*
 *  stage1.js
 *  2017/01/24
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage1", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 1,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm1",

    init: function(parentScene) {
        this.superInit(parentScene);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage1");
        this.mapLayer[0] = this.createMap(tmx);

       //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 1", 24);

            //マップ表示設定
            this.limitWidth = false;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveBy(14, -32, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage10.js
 *  2017/09/10
 *  @auther minimo  
 *  This Program is MIT license.
 */

//エンディングシーン
phina.define("qft.Stage10", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 10,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "ending",

    //特殊ステージフラグ
    isEnding: true,

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage10");
        this.mapLayer[0] = this.createMap(tmx);

        //プレイヤーダミースプライト
        var pl = qft.PlayerDummy("player1")

        //初期処理
        this.add(1, function() {
            //開始メッセージ投入
            this.spawnEventMessage(1, "Congraturations!!");

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;

            this.player.speed = 2;
            this.player.speedAscend = 2;
            this.player.isAuto = true;
            this.player.autoKey.up = true;
        });

        this.add(224, function() {
            this.player.autoKey.up = false;
        });

        this.add(60, function() {
            this.player.autoKey.right = true;
        });

        //石碑まで
        this.add(255, function() {
            this.player.autoKey.right = false;
            this.player.setAlpha(0);
            pl.addChildTo(this.mapLayer.playerLayer);
            pl.setPosition(this.player.x, this.player.y);
            pl.setAnimation("up_stop");
        });
        this.add(120, function() {
            this.player.autoKey.right = true;
            this.player.setAlpha(1.0);
            pl.remove();
        });

        //入り口まで
        this.add(330, function() {
            this.player.autoKey.right =　false;
        });

        this.add(60, function() {
            this.player.autoKey.right = true;
        });
        this.add(30, function() {
            this.player.autoKey.right = false;
        });
        this.add(30, function() {
            this.player.autoKey.right = true;
        });
        this.add(20, function() {
            this.player.autoKey.right = false;
        });

        this.add(60, function() {
            this.player.tweener.clear().set({alpha: 0}).moveBy(0, -600, 600);
            this.player.gravity = 0;

            pl.addChildTo(this.mapLayer.playerLayer);
            pl.setPosition(this.player.x, this.player.y);
            pl.setAnimation("up");
            pl.tweener.setUpdateType('fps').clear()
                .moveBy(0, -600, 600)
                .call(() => {
                    pl.setAnimation("down");
                })
                .wait(10)
                .call(() => {
                    pl.setAnimation("clear");
                })
                .wait(30)
                .call(() => {
                    pl.setAnimation("up");
                })
                .wait(30)
                .call(() => {
                    this.fgWhite.tweener.clear()
                        .wait(120)
                        .fadeIn(120)
                        .call(() => {
                            this.flare("ending");
                        });
                    this.fg.tweener.clear()
                        .wait(150)
                        .fadeIn(60);

                })
                .moveBy(0, -600, 600);
            var obj = this.stageController.findObject(17, 0, "enemy");
            obj.setAnimation("up");
        });

        this.add(60, function() {
            var obj = this.stageController.findObject(17, 0, "enemy");
            obj.tweener.clear().moveBy(0, -300, 300);
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
    },
});

/*
 *  stage1.js
 *  2017/01/24
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage2", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 2,

    //タイムリミット
    timeLimit: FPS*60*7,

    //BGMアセット名
    bgm: "bgm2",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage2_1");
        this.mapLayer[0] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 2", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 2) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(487, 271, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage3.js
 *  2017/03/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage3", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 3,

    //タイムリミット
    timeLimit: FPS*60*10,

    //BGMアセット名
    bgm: "bgm3",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage3_1");
        this.mapLayer[0] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage3_2");
        this.mapLayer[1] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage3_3");
        this.mapLayer[2] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 3", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 2) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(86, 272, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage4.js
 *  2017/03/08
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage4", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 4,

    //タイムリミット
    timeLimit: FPS*60*7,

    //BGMアセット名
    bgm: "bgm4",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage4_1");
        this.mapLayer[0] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage4_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 4", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(2903, 176, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage5.js
 *  2017/05/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage5", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 5,

    //タイムリミット
    timeLimit: FPS*60*8,

    //BGMアセット名
    bgm: "bgm5",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage5_1");
        this.mapLayer[0] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage5_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 5", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        //鍵出現
        this.addEvent("key", () => {
            var kx = 1196;
            var ky = 688;
            var key = qft.Item(this.parentScene, {properties: {kind: "key"}})
                .addChildTo(this.parentScene.mapLayer.objLayer)
                .setPosition(kx, ky);
            key.vy = -5;
            this.parentScene.pauseScene = true;
            this.parentScene.centerPlayer = false;
            this.parentScene.camera.setPosition(this.parentScene.player.x, this.parentScene.player.y);
            this.parentScene.camera.tweener.clear()
                .call(function() {
                    app.playSE("holy1");
                })
                .moveTo(kx, ky, 30, "easeInOutSine")
                .wait(30)
                .call(function() {
                    this.parentScene.pauseScene = false;
                    this.moveFrom.x = kx;
                    this.moveFrom.y = ky;
                    this.moveRaio = 0;
                    this.moveLerp = true;
                    this.moveToPlayer = true;
                }.bind(this.parentScene.camera))
                .to({moveRatio: 1}, 30, "easeInOutSine")
                .call(function() {
                    this.parentScene.centerPlayer = true;
                    this.moveLerp = false;
                }.bind(this.parentScene.camera));
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(3493+18, 80+80, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },

    //ステージＢＧＭ再生
    playBGM: function() {
        app.setVolume(this.bgm, 0.5);
        app.playBGM(this.bgm);
    },
});

/*
 *  stage6.js
 *  2017/05/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage6", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 6,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm6",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage6_1");
        this.mapLayer[0] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage6_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 6", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.bossdead1 = false;
        this.bossdead2 = false;

        //ボス１討伐
        this.addEvent("bossdead_1", () => {
            this.bossdead1 = true;
            if (this.bossdead2) this.fireEvent("key");
        });
        //ボス２討伐
        this.addEvent("bossdead_2", () => {
            this.bossdead2 = true;
            if (this.bossdead1) this.fireEvent("key");
        });

        //鍵出現
        this.addEvent("key", () => {
            var kx = 384;
            var ky = 944;
            var key = qft.Item(this.parentScene, {properties: {kind: "key"}})
                .addChildTo(this.parentScene.mapLayer.objLayer)
                .setPosition(kx, ky);
            key.vy = -5;
            this.parentScene.pauseScene = true;
            this.parentScene.centerPlayer = false;
            this.parentScene.camera.setPosition(this.parentScene.player.x, this.parentScene.player.y);
            this.parentScene.camera.tweener.clear()
                .call(function() {
                    app.playSE("holy1");
                })
                .moveTo(kx, ky, 30, "easeInOutSine")
                .wait(30)
                .call(function() {
                    this.parentScene.pauseScene = false;
                    this.moveFrom.x = kx;
                    this.moveFrom.y = ky;
                    this.moveRaio = 0;
                    this.moveLerp = true;
                    this.moveToPlayer = true;
                }.bind(this.parentScene.camera))
                .to({moveRatio: 1}, 30, "easeInOutSine")
                .call(function() {
                    this.parentScene.centerPlayer = true;
                    this.moveLerp = false;
                }.bind(this.parentScene.camera));
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 3) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(119 + 18　, 448 + 80, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage7.js
 *  2017/07/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ7
phina.define("qft.Stage7", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 6,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm7",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage7_1");
        this.mapLayer[0] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage7_2");
        this.mapLayer[1] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage7_3");
        this.mapLayer[2] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 7", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(182 + 18, 208 + 80, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage8.js
 *  2017/07/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ8
phina.define("qft.Stage8", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 8,

    //タイムリミット
    timeLimit: FPS*60*8,

    //BGMアセット名
    bgm: "bgm8",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage8_1");
        this.mapLayer[0] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage8_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 8", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        //鍵出現
        this.addEvent("key", () => {
            var kx = 670;
            var ky = 853;
            var key = qft.Item(this.parentScene, {properties: {kind: "key"}})
                .addChildTo(this.parentScene.mapLayer.objLayer)
                .setPosition(kx, ky);
            key.vy = -5;
            this.parentScene.pauseScene = true;
            this.parentScene.centerPlayer = false;
            this.parentScene.camera.setPosition(this.parentScene.player.x, this.parentScene.player.y);
            this.parentScene.camera.tweener.clear()
                .call(function() {
                    app.playSE("holy1");
                })
                .moveTo(kx, ky, 30, "easeInOutSine")
                .wait(30)
                .call(function() {
                    this.parentScene.pauseScene = false;
                    this.moveFrom.x = kx;
                    this.moveFrom.y = ky;
                    this.moveRaio = 0;
                    this.moveLerp = true;
                    this.moveToPlayer = true;
                }.bind(this.parentScene.camera))
                .to({moveRatio: 1}, 30, "easeInOutSine")
                .call(function() {
                    this.parentScene.centerPlayer = true;
                    this.moveLerp = false;
                }.bind(this.parentScene.camera));
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
//        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("walk");
                pl.tweener.clear()
                    .moveTo(784+16, 304-16, 500)
                    .call(function() {
                        pl.setAnimation("up");
                    })
                    .moveTo(784+16, -32, 5000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage9.js
 *  2017/07/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ9
phina.define("qft.Stage9", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 9,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm9",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage9_1");
        this.mapLayer[0] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 9", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(487, 271, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage999.js
 *  2017/05/03
 *  @auther minimo  
 *  This Program is MIT license.
 */

//テストステージ
phina.define("qft.Stage999", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 1,

    //タイムリミット
    timeLimit: FPS*60*5,

    init: function(parentScene) {
        this.superInit(parentScene);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage999");
        this.mapLayer[0] = this.createMap(tmx);

       //初期処理
        this.add(1, function() {
            //ＢＧＭ再生
            app.playBGM("bgm1");

            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 1", 24);

            //マップ表示設定
            this.limitWidth = false;
            this.limitHeight = true;
        });
    },
});

/*
 *  stagecontroller.js
 *  2017/01/24
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ制御
phina.define("qft.StageController", {
    superClass: "phina.app.Object2D",

    //ステージ番号
    stageNumber: 0,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm1",

    //マップ表示設定
    limitWidth: false,
    limitHeight: true,

    parentScene: null,
    mapLayer: null,
    player: null,
    time: 0,

    //経過時間トリガイベント
    seq: null,
    index: 0,

    //マップトリガイベント
    event: null,

    //バックグラウンド設定
    isBackgroundMove: true,
    backgroundX: -320,

    //特殊ステージフラグ
    isOpening: false,
    isTutorial: false,
    isEnding: false,

    init: function(parentScene) {
        this.superInit();

        this.parentScene = parentScene;
        this.mapLayer = [];
        this.player = parentScene.player;

        this.seq = [];
        this.event = [];
    },

    //時間イベント追加
    add: function(time, value, option) {
        this.index += time;
        this.seq[this.index] = {
            value: value,
            option: option,
        };
    },

    //時間イベント取得
    get: function(time) {
        var data = this.seq[time];
        if (data === undefined) return null;
        return data;
    },

    //マップイベント追加
    addEvent: function(id, value, option) {
        this.event[id] = {
            value: value,
            option: option,
            executed: false,
        };
    },

    //マップイベント取得
    getEvent: function(id) {
        var data = this.event[id];
        if (data === undefined) return null;
        return data;
    },

    //次にイベントが発生する時間を取得
    getNextEventTime: function(time) {
        var data = this.seq[time];
        if (data === undefined) {
            var t = time+1;
            var rt = -1;
            this.seq.some(function(val, index){
                if (index > t) {
                    rt = index;
                    return true;
                }
            },this.seq);
            return rt;
        } else {
            return time;
        }
    },

    //イベント発火
    fireEvent: function(eventName) {
        var event = this.event[eventName];
        if (event) {
            event.value.call();
            return true;
        }
        return false;
    },

    clear: function() {
        this.seq = [];
        this.index = 0;
    },

    checkStageClearCondition: function() {
        return false;
    },

    stageClear: function() {
    },

    //ステージＢＧＭ再生
    playBGM: function() {
        app.playBGM(this.bgm);
    },

    //IDからオブジェクト検索
    findObject: function(id, layerNumber, layerName) {
        layerNumber = layerNumber || 0;
        layerName = layerName || "object";
        var result = null;
        switch (layerName) {
            case "object":
                this.mapLayer[layerNumber].objLayer.children.forEach(function(e) {
                    if (e.id == id) result = e;
                }.bind(this));
                break;
            case "enemy":
                this.mapLayer[layerNumber].enemyLayer.children.forEach(function(e) {
                    if (e.id == id) result = e;
                }.bind(this));
                break;
        }
        return result;
    },

    //tmxからマップレイヤを作成する
    createMap: function(tmx) {
        //マップレイヤ
        var mapLayer = phina.display.DisplayElement();

        //マップ画像用レイヤ
        mapLayer.mapImageLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //地形判定用レイヤ
        mapLayer.collisionLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //バックグラウンドレイヤ
        mapLayer.backgroundLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //オブジェクト管理レイヤ
        mapLayer.objLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //影表示レイヤ
        mapLayer.shadowLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //敵キャラクタ管理レイヤ
        mapLayer.enemyLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //プレイヤー表示レイヤ
        mapLayer.playerLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //エフェクト管理レイヤ
        mapLayer.effectLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //フォアグラウンドレイヤ
        mapLayer.foregroundLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //マップ画像取得
        var mapImage = tmx.getImage("map", "background", "background2", "background3");
        mapLayer.map = phina.display.Sprite(mapImage).addChildTo(mapLayer.mapImageLayer).setOrigin(0, 0);

        //フォアグラウンド画像
        var foreground = tmx.getImage("foreground", "foreground2", "foreground3");
        phina.display.Sprite(foreground).addChildTo(mapLayer.foregroundLayer).setOrigin(0, 0);

        //マップ当たり判定取得
        var objects = tmx.getObjectGroup("collision").objects;
        objects.forEach(function(e) {
            var width = e.width || 16;
            var height = e.height || 16;
            var c = phina.display.RectangleShape({width: width, height: height})
                .addChildTo(mapLayer.collisionLayer)
                .setPosition(e.x+width/2, e.y+height/2)
                .setVisible(DEBUG_COLLISION);
            c.on('enterframe', function() {
                this.x += this.vx;
                this.y += this.vy;
            });
            c.id = e.id;
            c.vx = 0;
            c.vy = 0;
            c.alpha = 0.3;
            c.ignore = false;
            c.friction = e.properties.friction == undefined? 0.5: e.properties.friction;
            if (e.name) c.name = e.name;
            if (e.type) c.type = e.type;
            c.$extend(e.properties);

            //常時実行スクリプト
            if (c.script) {
                var sc = "(function(app) {"+c.script+"})";
                var f = eval(sc);
                c.on('enterframe', f);
            }
            //当たり判定時実行スクリプト
            if (c.collision) {
                var sc = "(function(e, dir) {"+c.collision+"})";
                c.collisionScript = eval(sc);
            }
        }.bind(this));

        //イベント取得
        var events = tmx.getObjectGroup("event").objects;
        events.forEach(function(e) {
            var that = this;
            var x = e.x + (e.width || 16) / 2;
            var y = e.y + (e.height || 16) / 2;
            switch (e.type) {
                case "player":
                    if (e.name == "start") {
                        mapLayer.startPosition = {x: x, y: y};
                        this.player.x = x;
                        this.player.y = y;
                        this.player.scaleX = 1;
                        if (e.properties.direction == 180) this.player.scaleX = -1;
                    }
                    break;
                case "enemy":
                    if (qft.Enemy[e.name]) {
                        var enemy = qft.Enemy[e.name](this.parentScene, e.properties).addChildTo(mapLayer.enemyLayer).setPosition(x, y);
                        if (e.properties.dead) {
                            var sc = "(function(app) {"+e.properties.dead+"})";
                            var f = eval(sc);
                            enemy.on('dead', f);
                        }
                        //移動パス設定
                        if (e.properties.path) {
                            var path = null;
                            var id = e.properties.path;
                            for (var i = 0; i < events.length; i++) {
                                if (events[i].id == id) {
                                    path = events[i];
                                    break;
                                }
                            }
                            if (path) enemy.setPath(path, e.properties.loop || false);
                        }
                    } else {
                        console.warn("unknown enemy: "+e.name);
                    }
                    break;
                case "item":
                    qft.Item(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "itembox":
                    qft.ItemBox(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "door":
                    var door = qft.MapObject.Door(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    if (e.name == "clear") mapLayer.clearGate = door;
                    if (e.properties.script) {
                        var sc = "(function(app) {"+e.properties.script+"})";
                        var f = eval(sc);
                        door.on('enterframe', f);
                        door.stageController = this;
                        door.player = this.parentScene.player;
                        door.parentScene = this.parentScene;
                    }
                    break;
                case "block":
                    var block = qft.MapObject.Block(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    block.addCollision(mapLayer.collisionLayer);
                    break;
                case "floor":
                    var floor = qft.MapObject.Floor(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    floor.addCollision(mapLayer.collisionLayer);
                    if (e.properties.script) {
                        var sc = "(function(app) {"+e.properties.script+"})";
                        var f = eval(sc);
                        floor.on('enterframe', f);
                        floor.stageController = this;
                        floor.player = this.parentScene.player;
                        floor.parentScene = this.parentScene;
                    }
                    //移動パス設定
                    var path = null;
                    if (e.properties.moveType == 'path' && e.properties.path) {
                        var id = e.properties.path;
                        for (var i = 0; i < events.length; i++) {
                            if (events[i].id == id) {
                                path = events[i];
                                break;
                            }
                        }
                        if (path) {
                            floor.setPath(path.x, path.y, path.polyline, e.properties.loop);
                        }
                    }
                    break;
                case "check":
                    qft.MapObject.CheckIcon(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y).setAnimation(e.name);
                    break;
                case "message":
                    qft.MapObject.Message(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "event":
                    qft.MapObject.Event(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "gate":
                    var gate = qft.MapObject.Gate(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    if (e.properties.script) {
                        var sc = "(function(app) {"+e.properties.script+"})";
                        var f = eval(sc);
                        gate.on('enterframe', f);
                        gate.stageController = this;
                        gate.player = this.parentScene.player;
                        gate.parentScene = this.parentScene;
                    }
                    break;
                case "accessory":
                    var layer = e.properties.foreground? mapLayer.foregroundLayer: mapLayer.backgroundLayer;
                    switch (e.name) {
                        case "lamp":
                            qft.MapObject.Lamp(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "bonfire":
                            qft.MapObject.Bonfire(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "flame":
                            qft.MapObject.Flame(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "candle":
                            qft.MapObject.Candle(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "lanthanum":
                            qft.MapObject.Lanthanum(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "candlelamp":
                            qft.MapObject.CandleLamp(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        default:
                            console.warn("unknown map accessory: "+e.name);
                    }
                    break;
                case "npc":
                    qft.MapObject.npc(this.parentScene, e).addChildTo(mapLayer.enemyLayer).setPosition(x, y);
                    break;
                case "path":
                    break;
                default:
                    console.warn("unknown map object id:[" + e.id + "] type:[" + e.type + "] name:[" + e.name + "]");
            }
        }.bind(this));
        return mapLayer;
    },
});

/*
 *  stage10.js
 *  2017/09/10
 *  @auther minimo  
 *  This Program is MIT license.
 */

//エンディングシーン
phina.define("qft.Stage10", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 10,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "ending",

    //特殊ステージフラグ
    isEnding: true,

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage10");
        this.mapLayer[0] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },
});

/*
 *  character.balloon.js
 *  2017/04/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Character.balloon", {
    superClass: "phina.display.Sprite",

    //寿命フレーム
    lifeSpan: 30,

    //アニメーション間隔
    animationInterval: 6,


    init: function(options) {
        this.superInit("balloon", 24, 32);

        this.pattern = options.pattern || "!";
        this.setAnimation(this.pattern);

        this.lifeSpan = options.lifeSpan || 60;
        this.animationInterval = options.animationInterval || 6;
        this.time = 0;

        //特殊パターン
        if (this.pattern == "anger2") {
            this.tweener.setUpdateType('fps').clear().by({y: -16, alpha: -1}, this.animationInterval, "easeInSine");
        }
    },

    update : function() {
        if (this.time % this.animationInterval == 0) this.frameIndex++;

        this.time++;
        if (this.time > this.lifeSpan) this.remove();
    },

    setAnimation: function(pattern) {
        switch (pattern) {
            case "...":
                this.setFrameTrimming(0, 0, 24, 128);
                break;
            case "?":
                this.setFrameTrimming(96, 32, 24, 32);
                break;
            case "!":
                this.setFrameTrimming(72, 64, 72, 32);
                break;
            case "zzz":
                this.setFrameTrimming(0, 0, 24, 32);
                break;
            case "stun":
                this.setFrameTrimming(144, 32, 48, 32);
                break;
            case "light":
                this.setFrameTrimming(144, 64, 48, 32);
                break;
            case "newtype":
                this.setFrameTrimming(144, 96, 72, 32);
                break;
            case "anger":
            case "anger1":
                this.setFrameTrimming(72, 96, 24, 32);
                break;
            case "anger2":
                this.setFrameTrimming(144, 128, 72, 32);
                break;
        }
    },
});

/*
 *  character.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Character", {
    superClass: "phina.display.DisplayElement",

    //マップオブジェクトID
    id: -1,

    //加速度
    vx: 0,
    vy: 0,

    //初期座標
    firstX: 0,
    firstY: 0,

    //重力加速度
    gravity: 0.9,

    //横移動減衰率
    friction: 0.5,

    //床移動減衰率
    floorFriction: 0.5,

    //反発係数
    rebound: 0,

    //ジャンプ中フラグ
    isJump: false,

    //スルーしたフロア
    throughFloor: null,

    //床上フラグ
    isOnFloor: false,

    //乗っているオブジェクト
    floorObject: null,

    //はしご上フラグ
    isOnLadder: false,

    //階段上フラグ
    isOnStairs: false,

    //はしご掴みフラグ
    isCatchLadder: false,

    //死亡フラグ
    isDead: false,

    //落下死亡フラグ
    isDrop: false,

    //気絶フラグ
    isStun: false,

    //操作停止時間
    stopTime: 0,

    //無敵フラグ
    isMuteki: false,

    //無敵時間
    mutekiTime: 0,

    //アニメーションフラグ
    isAnimation: true,

    //現在実行中アクション
    nowAnimation: "stand",

    //前フレーム実行アクション
    beforeAnimation: "",

    //アニメーション進行可能フラグ
    isAdvanceAnimation: true,

    //アニメーション変更検知フラグ
    isChangeAnimation: false,

    //アニメーション間隔
    animationInterval: 6,

    //地形無視
    ignoreCollision: false,

    //スクリーン内フラグ
    onScreen: false,

    //活動フラグ
    isActive: true,

    //影表示
    isShadow: false,
    shadowY: 0,

    //識別フラグ
    isPlayer: false,
    isEnemy: false,
    isItemBox: false,
    isItem: false,
    isBlock: false,
    isMapAccessory: false,

    //経過フレーム
    time: 0,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;
        this.boundingType = "rect";
        this.tweener.setUpdateType('fps');

        this.options = options || {};
        this.setupAnimation();

        this.id = options.id || -1;

        //当たり判定情報初期化
        if (!this.isMapAccessory) this.initCollision(options);

        //吹き出し
        var that = this;
        this.balloon = null;
        this.lastBalloon = "";
        this.balloonTime = 0;
        this.on('balloon', e => {
            if (this.isStun) return;
            if (this.time > this.balloonTime) this.lastBalloon = "";
            if (this.lastBalloonPattern == e.pattern && !e.force) return;
            if (this.balloon) this.balloon.remove();
            e.$safe({x: 0, y: -this.height/2-10});
            this.balloon = qft.Character.balloon({pattern: e.pattern, lifeSpan: e.lifeSpan, animationInterval: e.animationInterval})
                .addChildTo(this)
                .setPosition(e.x, e.y);
            this.balloon.on('removed', e => {
                that.balloon = null;
                that.flare('balloonend');
            });
            this.lastBalloonPattern = e.pattern;
            this.balloonTime = this.time + 120;
        });
        this.on('balloonerace', e => {
            if (this.balloon == null) return;
            this.balloon.remove();
            this.balloon = null;
            this.balloonTime = 0;
        });

        //気絶状態
        this.on('stun', e => {
            this.isStun = true;
            this.stopTime = e.power * 10;
            this.balloon = qft.Character.balloon({pattern: "stun", lifeSpan: this.stopTime})
                .addChildTo(this)
                .setPosition(0, -this.height/2-10);
            this.lastBalloon = e.pattern;
            this.balloonTime = this.time + 120;
        });

        this.on('enterframe', function(e) {
            if (this.parentScene.pauseScene) return;

            //初期座標の記録と初回フレーム処理
            if (this.time == 0) {
                this.firstX = this.x;
                this.firstY = this.y;
                this.firstFrame();
            }

            //画面内判定
            var ps = this.parentScene;
            if (ps.screenX-SC_W < this.x && this.x < ps.screenX + SC_W*2 && 
                ps.screenY-SC_H < this.y && this.y < ps.screenY + SC_H*2) {
                this.onScreen = true;
            } else {
                this.onScreen = false;
            }
            //画面外の場合は動作停止
//            if (!this.onScreen) return;

            //活動フラグ
            if (!this.isActive) return;

            this.x += this.vx;
            if (this.isOnFloor) {
                this.vx *= this.floorFriction;
            } else {
                this.vx *= this.friction;
            }

            if (this.isCatchLadder) {
                this.y += this.vy;
                this.vy = 0;
            } else {
                this.y += this.vy;
                this.vy += this.gravity;
                //落下速度上限
                if (this.vy > 20) this.vy = 20;
            }
            if (Math.abs(this.vx) < 0.01) this.vx = 0;
            if (Math.abs(this.vy) < 0.01) this.vy = 0;

            //当たり判定
            if (!this.isMapAccessory) {
                this.resetCollisionPosition();
                this.checkMapCollision();
            }

            //画面外落ち
            if (!this.isDead && this.y > this.parent.parent.map.height) this.dropDead();

            //アニメーション
            if (this.sprite && this.isAnimation && this.isAdvanceAnimation && this.time % this.animationInterval == 0) {
                this.index = (this.index+1) % this.frame[this.nowAnimation].length;
                //次フレーム番号が特殊指定の場合
                var next = this.frame[this.nowAnimation][this.index];
                if (next == "stop") {
                    //停止
                    this.index--;
                } else if (next == "remove") {
                    //リムーブ
                    this.remove();
                } else if (typeof next === "string") {
                    //指定アニメーションへ変更
                    this.setAnimation(next);
                } else {
                    this.sprite.frameIndex = next;
                }
            }

            //無敵時間処理
            if (this.mutekiTime > 0) {
                if (this.mutekiTime % 2 == 0) this.visible = !this.visible;
                this.mutekiTime--;
            } else {
                this.visible = true;
            }

            //操作停止時間
            this.stopTime--;
            if (this.stopTime < 0) this.stopTime = 0;

            //操作停止時間が終わったら気絶解除
            if (this.isStun && this.stopTime == 0) {
                this.isStun = false;
                this.flare('balloonerace');
            }

            if (this.balloon) this.balloon.scaleX = this.scaleX;

            //乗っている床の取得
            if (this.isOnFloor) {
                this.floorObject = this._collision[2].hit;
            } else {
                this.floorObject = null;
            }

            //影処理
            if (this.shadowSprite) {
                this.shadowSprite.x = this.x;
                this.shadowSprite.y = this.shadowY;
            }

            this.time++;
            this.beforeAnimation = this.nowAnimation;
        });

        this.on('added', () => {
            this.one('enterframe', () => {
                if (this.isShadow && !this.ignoreCollision) this.setupShadow();
            });
        });

        this.on('removed', () => {
            if(this.shadowSprite) this.shadowSprite.remove();
        });
    },

    //一回目のenterframeで一度だけ呼ばれる
    firstFrame: function() {
    },

    //影表示セットアップ
    setupShadow: function() {
        var that = this;
        var sc = this.width / 24;
        if (sc < 1) sc += 0.2;
        this.shadowSprite = phina.display.Sprite("shadow", 24, 8)
            .addChildTo(this.parentScene.shadowLayer)
            .setAlpha(0.5)
            .setScale(sc, 1.0);
        this.shadowSprite.update = function() {
            this.alpha = 0.5;
            if (that.alpha < 0.5) this.alpha = that.alpha;
        }
    },

    //当たり判定情報初期化
    initCollision: function(options) {
        //当り判定用（0:上 1:右 2:下 3:左）
        var w = Math.floor(this.width/4);
        var h = Math.floor(this.height/4);
        this._collision = [];
        this._collision[0] = phina.display.RectangleShape({width: w, height: 2});
        this._collision[1] = phina.display.RectangleShape({width: 2, height: h});
        this._collision[2] = phina.display.RectangleShape({width: w, height: 2});
        this._collision[3] = phina.display.RectangleShape({width: 2, height: h});
        this.collisionResult = null;

        //当たり判定チェック位置オフセット
        this.offsetCollisionX = options.offsetCollisionX || 0;
        this.offsetCollisionY = options.offsetCollisionY || 0;

        //当たり判定情報再設定
        this.setupCollision();

        //当たり判定デバッグ用
        if (DEBUG_COLLISION) {
            this.one('enterframe', e => {
                this._collision[0].addChildTo(this.parentScene.objLayer);
                this._collision[1].addChildTo(this.parentScene.objLayer);
                this._collision[2].addChildTo(this.parentScene.objLayer);
                this._collision[3].addChildTo(this.parentScene.objLayer);
                this._collision[0].alpha = 0.3;
                this._collision[1].alpha = 0.3;
                this._collision[2].alpha = 0.3;
                this._collision[3].alpha = 0.3;
                //ダメージ当たり判定表示
                var c = phina.display.RectangleShape({width: this.width, height: this.height}).addChildTo(this);
                c.alpha = 0.3;
            });
            this.one('removed', e => {
                this._collision[0].remove();
                this._collision[1].remove();
                this._collision[2].remove();
                this._collision[3].remove();
                });
        }
        return this;
    },

    //画面外落ち
    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        this.vx = 0;
        this.vy = -10;
        this.tweener.clear()
            .wait(60)
            .call(function(){
                this.flare('dead');
                this.remove();
            }.bind(this));
        return this;
    },

    //ノックバックモーション
    knockback: function(power, direction) {
        power = power || 0;
        if (power == 0) return;
        if (direction === undefined) direction = (this.direction + 180) % 360;

        var back = 32 + Math.floor(power / 10);
        var sx = Math.cos(direction.toRadian());
        var sy = Math.sin(direction.toRadian());

        //ノックバック先に壁が無いかチェック
        var chk = this.checkMapCollision2(this.x + sx * back, this.y + sy * back, 8, 8);
        if (chk) {
            //壁に当たる所までバックする
            var c = chk[0];
            switch (direction) {
                case 0:
                    back = (c.x - c.width / 2) - this.x;
                    back *= 0.8;
                    break;
                case 180:
                    back = this.x - (c.x + c.width / 2);
                    back *= 0.8;
                    break;
                default:
            }
        }

        this.tweener.clear().by({x: sx * back, y: sy * back}, 10, "easeOutElastic");
        this.vx = 0;
        this.vy = 0;
        return this;
    },

    //地形当たり判定
    checkMapCollision: function() {
        if (this.ignoreCollision) return this;

        this._collision[0].hit = null;
        this._collision[1].hit = null;
        this._collision[2].hit = null;
        this._collision[3].hit = null;

        this.isOnLadder = false;
        this.isOnStairs = false;

        if (this.onScreen && this.shadowSprite) {
            this.shadowY = 99999;
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(this.x, this.y + 128);
            this.shadowSprite.visible = false;
        }

        //地形接触判定
        this.parentScene.collisionLayer.children.forEach(e => {
            if (this.isDrop) return;
            if (e.ignore || e == this.throughFloor) return;
            if (e.type == "ladder" || e.type == "stairs") return;

            //上側
            if (this.vy < 0  && e.hitTestElement(this._collision[0])) this._collision[0].hit = e;
            //下側
            if (this.vy >= 0 && e.hitTestElement(this._collision[2])) this._collision[2].hit = e;
            //右側
            if (this.vx > 0  && e.hitTestElement(this._collision[1])) this._collision[1].hit = e;
            //左側
            if (this.vx < 0  && e.hitTestElement(this._collision[3])) this._collision[3].hit = e;

            if (this.onScreen && this.shadowSprite) {
                //キャラクターの下方向にレイを飛ばして直下の地面座標を取る
                var x = e.x - e.width / 2;
                var y = e.y - e.height / 2;
                var p3 = phina.geom.Vector2(x, y);
                var p4 = phina.geom.Vector2(x + e.width, y);
                if (y < this.shadowY && phina.geom.Collision.testLineLine(p1, p2, p3, p4)) {
                    this.shadowSprite.setPosition(this.x, y);
                    this.shadowSprite.visible = true;
                    this.shadowY = y;
                }
            }
        });

        if (this.isCatchLadder) this.shadowSprite.visible = false;

        //当たり判定結果反映
        this.collisionProcess();

        //はしごのみ判定
        this.parentScene.collisionLayer.children.forEach(e => {
            //梯子判定
            if (e.type == "ladder" || e.type == "stairs") {
                if (this.ladderCollision && e.hitTestElement(this.ladderCollision)) {
                    this.isOnLadder = true;
                    this.isOnStairs = (e.type == "stairs");
                }
                return;
            }
        });
        return this;
    },

    //当たり判定結果反映処理
    collisionProcess: function() {
        var w = Math.floor(this.width/2)+6;
        var h = Math.floor(this.height/2)+6;
        this.isOnFloor = false;

        //上側接触
        if (this._collision[0].hit && !this.isCatchLadder) {
            var ret = this._collision[0].hit;
            this.y = ret.y+ret.height*(1-ret.originY)+h;
            this.vy = 0;
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 0);
            }
        }
        //下側接触
        if (this._collision[2].hit && !this.isCatchLadder) {
            var ret = this._collision[2].hit;
            this.y = ret.y-ret.height*ret.originY-h;
            this.x += ret.vx || 0;
            if (!this.isPlayer && ret.vy > 0) this.y += ret.vy || 0;

            this.isJump = false;
            this.isOnFloor = true;
            this.floorFriction = ret.friction == undefined? 0.5: ret.friction;

            this.throughFloor = null;
            if (this.rebound > 0) {
                this.isJump = true;
                this.vy = -this.vy * this.rebound;
            } else {
                this.vy = 0;
            }
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 2);
            }
        }
        //右側接触
        if (this._collision[1].hit && !this.isCatchLadder) {
            var ret = this._collision[1].hit;
            this.x = ret.x-ret.width*ret.originX-w;
            this.vx = 0;
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 1);
            }
        }
        //左側接触
        if (this._collision[3].hit && !this.isCatchLadder) {
            var ret = this._collision[3].hit;
            this.x = ret.x+ret.width*(1-ret.originX)+w;
            this.vx = 0;
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 3);
            }
        }
        return this;
    },

    //地形当たり判定（特定地点チェックのみ）衝突したものを配列で返す
    checkMapCollision2: function(x, y, width, height) {
        x = x || this.x;
        y = y || this.y;
        width = width || 1;
        height = height || 1;
        var c = phina.display.DisplayElement({width: width, height: height}).setPosition(x, y);
        var ret = null;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.type == "ladder" || e.type == "stairs") return;
            if (e.hitTestElement(c)) {
                if (ret == null) ret = [];
                ret.push(e);
            }
        });
        return ret;
    },

    //キャラクタ同士当たり判定（ブロックのみ）
    checkCharacterCollision: function() {
        if (this.ignoreCollision) return;
        if (this.isDrop) return;

        var ret = [];
        var that = this;
        this.parentScene.objLayer.children.forEach(function(e) {
            if (!e.isBlock) return;
            if (e.isDead) return;

            //上側
            if (that.vy < 0 && e.hitTestElement(that._collision[0])) {
                that.y = e.y+e.height*(1-e.originY)+16;
                that.vy = 1;
                ret[0] = e;
                that.resetCollisionPosition();
            }
            //下側
            if (that.vy > 0 && e.hitTestElement(that._collision[2])) {
                that.y = e.y-e.height*e.originY-16;
                that.vx = e.vx;
                that.vy = 0;
                that.isJump = false;
                that.isOnFloor = true;
                that.throughFloor = null;
                ret[2] = e;
                if (that.rebound > 0) {
                    that.isJump = true;
                    that.vy = -that.vy * that.rebound;
                } else {
                    that.vy = 0;
                }
                that.resetCollisionPosition();
            }
            //右側
            if (that.vx > 0 && e.hitTestElement(that._collision[1])) {
                that.x = e.x-e.width*e.originX-10;
                that.vx = 0;
                ret[1] = e;
                that.resetCollisionPosition();
            }
            //左側
            if (that.vx < 0 && e.hitTestElement(that._collision[3])) {
                that.x = e.x+e.width*(1-e.originX)+10;
                that.vx = 0;
                ret[3] = e;
                that.resetCollisionPosition();
            }
        });
        return ret;
    },

    //当たり判定用エレメントの再設定
    setupCollision: function() {
        return this;
    },

    //当たり判定用エレメントの位置再セット
    resetCollisionPosition: function() {
        var w = Math.floor(this.width/2) + 6 + this.offsetCollisionX;
        var h = Math.floor(this.height/2)+ 6 + this.offsetCollisionY;
        this._collision[0].setPosition(this.x, this.y - h);
        this._collision[1].setPosition(this.x + w, this.y);
        this._collision[2].setPosition(this.x, this.y + h);
        this._collision[3].setPosition(this.x - w, this.y);
        return this;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [0, "stop"];
        this.frame["walk"] = [0];
        this.frame["up"] =   [0];
        this.frame["down"] = [0];
        this.frame["attack"] = [0, "stop"];
        this.index = 0;
        return this;
    },

    setAnimation: function(animName) {
        if (!this.frame[animName]) return;
        if (animName == this.nowAnimation) return;
        this.nowAnimation = animName;
        this.index = -1;
        this.isChangeAnimation = true;
        return this;
    },

    //プレイヤーからの直線距離
    getDistancePlayer: function() {
        var x = this.x-this.parentScene.player.x;
        var y = this.y-this.parentScene.player.y;
        return Math.sqrt(x*x+y*y);
    },

    //オブジェクト間の直線距離
    getDistance: function(element) {
        var x = this.x - element.x;
        var y = this.y - element.y;
        return Math.sqrt(x*x+y*y);
    },

    //自分と他エレメントを結ぶ直線の角度（弧度法）
    getAngle: function(element) {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(element.x, element.y);
        var p = p2.sub(p1);
        return p.toDegree();
    },

    //自分と他エレメントを結ぶ直線の角度（ラジアン）
    getAngleRadian: function(element) {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(element.x, element.y);
        var p = p2.sub(p1);
        return p.toAngle();
    },

    //物理現象情報のみオブジェクトで取得
    getPhysics: function() {
        return {
            vx: this.vx,
            vy: this.vy,
            gravity: this.gravity,
            friction: this.friction,
            rebound: this.rebound,
        };
    },

    //移動パスの設定
    setPath: function(path, loop) {
        this.path = [];
        this.loop = loop;

        //パス情報の作成
        var sum = 0;
        var ptb = null;
        for (var i = 0; i < path.polyline.length; i++) {
            var pt = phina.geom.Vector2(path.x + path.polyline[i].x, path.y + path.polyline[i].y);
            if (i > 0) {
                sum += Math.floor(ptb.distance(pt));
            }
            pt.time = sum;
            this.path.push(pt);
            ptb = pt;
        }

        //ループ有り指定の場合、始点の座標を終点に加える
        if (loop) {
            var end = phina.geom.Vector2(path.x + path.polyline[path.polyline.length - 1].x, path.y + path.polyline[path.polyline.length - 1].y);
            var start = phina.geom.Vector2(path.x + path.polyline[0].x, path.y + path.polyline[0].y);
            sum += Math.floor(start.distance(end));
            start.time = sum;
            this.path.push(start);
        }
        this.path.maxTime = sum;

        return this;
    },

    //パス座標の取得
    getPathPosition: function(time) {
        if (!this.path || time < 0) return null;
        time %= this.path.maxTime;

        var len = this.path.length;
        for (var i = 0; i < len; i++) {
            var p = this.path[i];
            if (time == p.time) return p;
            if (time < p.time) {
                var p2 = this.path[i - 1];
                var t = (time - p2.time) / (p.time - p2.time);
                return phina.geom.Vector2.lerp(p2, p, t);
            }
        }
        return null;
    },
});

/*
 *  effect.js
 *  2017/01/12
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Effect", {
    superClass: "phina.display.DisplayElement",

    //インデックス更新間隔
    interval: 2,

    //現在インデックス
    index: 0,

    //開始インデックス
    startIndex: 0,

    //最大インデックス
    maxIndex: 8,

    //アニメーション進行可能フラグ   
    isAdvanceAnimation: true,

    //経過フレーム
    time: 0,

    defaultOptions: {
        name: "explode",
        assetName: "effect",
        loop: false,
        position: {x: 0, y: 0},
        origin: {x: 0.5, y: 0.5},
        rotation: 0,
        alpha: 1.0,
        scale: {x: 1.0, y: 1.0},
        blendMode: "source-over",
    },

    init: function(parentScene, options) {
        this.superInit();

        this.options = (options || {}).$safe(this.defaultOptions);
        this.options.$extend(qft.EffectData.get(this.options.name));
        this.setup();

        this.on('enterframe', function() {
            this.time++;
            if (this.time % this.interval == 0 && this.isAdvanceAnimation) {
                this.sprite.frameIndex++;
                if (this.sprite.frameIndex == 0 || this.sprite.frameIndex == this.maxIndex) {
                    if (this.options.loop) {
                        this.sprite.frameIndex = this.startIndex;
                    } else {
                        this.remove();
                    }
                    this.flare('animationend');
                }
            }
        });
    },

    setup: function() {
        var op = this.options;
        this.sprite = phina.display.Sprite(op.assetName, op.width, op.height)
            .setPosition(op.position.x, op.position.y)
            .setOrigin(op.origin.x, op.origin.y)
            .setScale(op.scale.x, op.scale.y)
            .setRotation(op.rotation)
            .addChildTo(this);
        if (op.trimming) {
            var t = op.trimming;
            this.sprite.setFrameTrimming(t.x, t.y, t.width, t.height);
        }
        this.startIndex = op.startIndex;
        this.maxIndex = op.maxIndex;
        this.sprite.alpha = op.alpha;
        this.sprite.frameIndex = this.startIndex;
    },
});

phina.define("qft.EffectData", {
    _static: {
        get: function(name) {
            switch (name) {
                case "explode_small":
                    return {
                        width: 16,
                        height: 16,
                        interval: 2,
                        startIndex: 8,
                        maxIndex: 15,
                        trimming: {x: 256, y: 256, width: 128, height: 32},
                    };
                case "explode_small2":
                    return {
                        width: 16,
                        height: 16,
                        interval: 4,
                        startIndex: 0,
                        maxIndex: 7,
                        trimming: {x: 256, y: 256, width: 128, height: 32},
                    };
                case "explode":
                    return {
                        width: 64,
                        height: 64,
                        interval: 1,
                        startIndex: 0,
                        maxIndex: 8,
                        trimming: {x: 0, y: 0, width: 512, height: 128},
                    };
                case "explode_large":
                    return {
                        width: 48,
                        height: 48,
                        interval: 4,
                        startIndex: 0,
                        maxIndex: 7,
                        trimming: {x: 0, y: 0, width: 512, height: 128},
                    };
                case "explode_ground":
                    return {
                        width: 32,
                        height: 48,
                        interval: 4,
                        startIndex: 0,
                        maxIndex: 7,
                        trimming: {x: 256, y: 192, width: 256, height: 48},
                    };
                case "smoke_small":
                    return {
                        width: 16,
                        height: 16,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 4,
                        trimming: {x: 128, y: 128, width: 64, height: 16},
                    };
                case "smoke":
                    return {
                        width: 24,
                        height: 24,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 5,
                        trimming: {x: 128, y: 160, width: 120, height: 24},
                    };
                case "smoke_large":
                    return {
                        width: 32,
                        height: 32,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 8,
                        trimming: {x: 256, y: 128, width: 128, height: 64},
                    };
                case "hit":
                    return {
                        assetName: "effect2",
                        width: 72,
                        height: 32,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 3,
                        trimming: {x: 0, y: 0, width: 72, height: 128},
                    };
                default:
                    return {};
            }
        }
    }
});

/*
 *  enemy.adventurer.js
 *  2017/08/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//冒険者
phina.define("qft.Enemy.Adventurer", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 360,

    //得点
    point: 10000,

    //アニメーション間隔
    animationInterval: 6,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 24, height: 20});
        this.superInit(parentScene, options);

        //武器用スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setOrigin(1, 1)
            .setPosition(-3, 3);
        this.weapon.alpha = 0;
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.kind = "sword";
        this.weapon.scaleX = -1;
        this.weapon.scaleY = -1;

        //表示用スプライト
        if (this.black) {
            this.sprite = phina.display.Sprite("player1Black", 32, 32).addChildTo(this);
        } else {
            this.sprite = phina.display.Sprite("player1", 32, 32).addChildTo(this);
        }
        this.sprite.scaleX = -1;

        this.hp += this.level * 5;
        this.power += this.level * 5;
        this.point += this.level * 1000;

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;
        this.attackInterval = 30;

        //行動フェーズ
        this.phase = "wander";

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        //待機状態
        if (this.phase == "wait") {
            this.isAdvanceAnimation = false;
            if (look) {
                this.flare('balloon', {pattern: "!", lifeSpan: 15});
                this.phase = "approach";
            }
        } else {
            this.isAdvanceAnimation = true;
        }

        //徘徊
        if (this.phase == "wander") {
            if (look) {
                this.flare('balloon', {pattern: "!", lifeSpan: 15});
                this.phase = "approach";
            } else {
                this.roundtripAlgorithm_ground(distance, look);
            }
        }

        //プレイヤー発見後接近
        if (this.phase == "approach") {
            if (this.x < player.x) {
                this.vx = 3;
            } else {
                this.vx = -3;
            }
            if (!look) {
                this.phase = "lost";
                this.chaseTime = 150;
            }
            if (distance < 52 && this.attackInterval == 0) this.phase = "attack";
        }

        //プレイヤー見失い
        if (this.phase == "lost") {
            this.chaseTime--;
            if (this.x < player.x) {
                this.vx = 3;
            } else {
                this.vx = -3;
            }
            if (this.chaseTime < 0) {
                this.chaseTime = 0;
                this.flare('balloon', {pattern: "..."});
                this.phase = "wait";
            }
        }

        //攻撃
        if (this.phase == "attack") {
            this.attack();
            this.attackInterval = 30;
        } else if (this.phase != "attacking") {
            if (this.isOnFloor) {
                this.setAnimation("walk");
            } else {
                this.setAnimation("jump");
            }
        }

        this.attackInterval--;
        if (this.attackInterval < 0) this.attackInterval = 0;
    },

    //攻撃
    attack: function() {
        this.animationInterval = 2;
        this.setAnimation("attack");
        this.phase = "attacking";

        //攻撃判定
        var that = this;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 24, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        app.playSE("attack");
        this.weapon.tweener.clear()
            .set({rotation: 200, alpha: 1.0})
            .to({rotation: 360}, 6)
            .fadeOut(1)
            .call(() => {
                this.animationInterval = 6;
                this.setAnimation("walk");
                this.phase = "approach";
                atk.remove();
            });
    },

    //飛び道具弾き
    guard: function() {
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [36, "stop"];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
        this.frame["defense"] = [ 41, 42, 43, 44, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["drop"] = [18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.frame["clear"] = [24, 25, 26];
        this.frame["stun"] = [ 18, 19, 20];
        this.index = 0;
        return this;
    },
});

/*
 *  enemy.archdemon.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アークデーモン
phina.define("qft.Enemy.ArchDemon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 30,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 180,

    //アニメーション間隔
    animationInterval: 15,

    //得点
    point: 5000,

    //飛行モード
    flying: false,
    flyingPhase: 0, //行動フェーズ
    flyingX: 0,     //飛行開始Ｘ座標

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 35, height: 30});
        if (options.size) {
            var size = options.size || 1;
            options.width = size * 35;
            options.height = size * 30;
        }
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(216*2, 640*2, 72*2, 128*2).setPosition(0, -10);
        if (options.size) {
            var size = options.size || 1;
            this.sprite.setScale(size).setPosition(0, size * -12);
        }

        this.hp += this.level * 5;
        this.power += this.level * 5;
        this.point += this.level * 1000;

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.phase = 0;
        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤー情報
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //進行方向決定
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }

        //プレイヤー発見後一定時間追跡する
        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.vx *= 3;
            this.flare('balloon', {pattern: "!"});
        }
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }
        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this._collision[3].hit) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //プレイヤーへの攻撃
            if (look && !this.isAttack && !this.isJump) {
                if (dis > 128) {
                    this.firebreath();
                } else {
                    this.exploding();
                }
            }
        }

        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    //火球を吐く
    fireball: function() {
        this.isAttack = true;
        this.stopTime = 30;
        this.sprite.tweener.clear()
            .wait(10)
            .call(() => {
                this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, rotation: this.getPlayerAngle(), power: 30});
            })
            .wait(45)
            .call(() => {
                this.isAttack = false;
            });
    },

    //炎を吐く
    firebreath: function() {
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite.tweener.clear()
            .wait(10)
            .wait(60)
            .call(() => {
                this.isAttack = false;
            });

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var b = this.parentScene.spawnEnemy(this.x + 24 * this.scaleX, this.y-8, "Bullet", {type: "explode", power: 10, rotation: this.getPlayerAngle(), velocity: 5});
                b.setScale(0.1);
                b.tweener.clear().setUpdateType('fps').to({scaleX: 1, scaleY: 1}, 10);
                ct++;
                if (ct == 6 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(5)
            .setLoop(true);
    },

    //爆発
    exploding: function() {
        app.playSE("bomb");
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite.tweener.clear()
            .fadeIn(15)
            .wait(45)
            .call(() => {
                this.isAttack = false;
            });

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var rad = rot.toRadian();
                var ex = Math.cos(rad) * 16;
                var ey = Math.sin(rad) * 16;
                this.parentScene.spawnEnemy(this.x + ex, this.y + ey, "Bullet", {type: "explode", power: 10, rotation: rot, velocity: 3});
                rot += 22.5;
                ct++;
                if (ct == 16 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(1)
            .setLoop(true);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.archknight.js
 *  2017/05/18
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アークナイト
phina.define("qft.Enemy.ArchKnight", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 70,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 90,

    //得点
    point: 5000,

    //アニメーション間隔
    animationInterval: 10,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_LONGSWORD,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 25, height: 40});
        this.superInit(parentScene, options);

        //武器スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setOrigin(1, 1)
            .setPosition(-6, 3)
            .setScale(-1.5, 1.5)
            .setRotation(430);
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.kind = "sword";
        if (options.weapon == "ax") {
            this.weapon.setFrameIndex(20 + Math.min(9, this.level));
            this.weapon.kind = "ax";
        }
        if (options.weapon == "spear") {
            this.weapon.setFrameIndex(30 + Math.min(9, this.level));
            this.weapon.kind = "spear";
        }

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(216*2, 128*2, 72*2, 128*2);
        this.sprite.setPosition(0, -5);

        this.hp += this.level * 5;
        this.power += this.level * 5;
        this.point += this.level * 1000;

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 0.5;
            } else {
                this.vx = -0.5;
            }
            if (this.isJump) this.vx *= 2;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }
        if (this.chaseTime > 0) this.vx *= 3;

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+40, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+40, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                    this.turnWait = 1;
                }
            }

            //攻撃
            if (look && !this.isJump && dis < 64 && !this.isAttack) {
                this.attack();
            }

            //プレイヤー飛び道具を弾く
            if (look && !this.isAttack) {
                var that = this;
                //プレイヤーショットとの距離判定
                this.parentScene.playerLayer.children.forEach(function(e) {
                    if (e instanceof qft.PlayerAttack && e.isCollision && e.type == "arrow") {
                        if (that.getDistance(e) < 64) that.guard();
                    }
                }.bind(this));
            }
        }
        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    attack: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 48, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        if (this.weapon.kind == "sword" || this.weapon.kind == "ax") {
            atk.isActive = false;
            this.weapon.tweener.clear()
                .to({rotation: 270}, 2)
                .call(function() {
                    atk.isActive = true;
                    that.isSuperArmor = true;
                    that.vx = 16 * that.scaleX;
                })
                .to({rotation: 430}, 6)
                .call(function() {
                    that.isAttack = false;
                    that.isSuperArmor = false;
                    atk.remove();
                });
        } else if (this.weapon.kind == "spear") {
            atk.width = 32;
            atk.height = 8;
            atk.setPosition(this.x + this.scaleX * 1, this.y);
            atk.tweener.clear().by({x: 20 * this.scaleX}, 10).by({x: -20 * this.scaleX}, 10);
            atk.isActive = false;

            this.weapon.tweener.clear()
                .set({rotation: 45, x: -20})
                .wait(6)
                .call(function() {
                    atk.isActive = true;
                    that.isSuperArmor = true;
                    that.vx = 32 * that.scaleX;
                })
                .by({x: 20}, 3)
                .by({x: -30}, 5)
                .call(function() {
                    that.isAttack = false;
                    that.isSuperArmor = false;
                    atk.remove();
                })
                .set({rotation: 430, x: -2});
        }
        this.isAttack = true;
        this.stopTime = 30;
    },

    //飛び道具弾き
    guard: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 48, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        this.isMuteki = true;
        this.weapon.tweener.clear()
            .set({rotation: 430})
            .to({rotation: 300}, 3)
            .call(function() {
                that.vx = 4 * that.scaleX;
            })
            .to({rotation: 430}, 3)
            .call(function() {
                that.isAttack = false;
                that.isMuteki = false;
                atk.remove();
            });
        this.isAttack = true;
        this.stopTime = Math.min(0, 6 - this.level);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.frame["turn"] = [6, "walk"];
        this.index = 0;
    },
});

/*
 *  enemy.archmage.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アークメイジ
phina.define("qft.Enemy.ArchMage", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 360,

    //得点
    point: 800,

    //重力加速度
    gravity: 0,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var lv = Math.min(this.level, 3);
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming((lv % 2) * 144 + 72, Math.floor(lv / 2) * 128, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.speed = 1;
        this.phase = 0;
        this.isAttack = false;

        //接近戦経過時間
        this.nearCount = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        //これ以上進めない場合は折り返す
        if (this._collision[1].hit) {
            this.direction = 180;
        } else if (this._collision[3].hit) {
            this.direction = 0;
        }

        //テリトリー指定
        if (this.territory) {
            //水平方向のみチェック
            var tx = this.x - this.firstX;
            if (Math.abs(tx) > this.territory) {
                if (tx > 0) {
                    this.direction = 180;
                } else {
                    this.direction = 0;
                }
            }
        }

        //通常フェーズでプレイヤーを発見したら警戒フェーズに移る
        if (this.phase == 0 && look) {
            this.flare('balloon', {pattern: "!"});
            this.phase = 1;
            this.speed = 0;
        }

        //プレイヤーが離れたら通常フェーズ
        if (this.phase != 0) {
            if (distance > 192 || !look) {
                this.flare('balloonerace');
                this.phase = 0;
                this.speed = 1;
                for (var i = 0; i < this.dagger.length; i++) {
                    this.dagger[i].phase = 0;
                }
            }
        }

        //通常
        if (this.phase == 0) {
            this.vx = this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        } else {
            if (this.x < player.x) {
                this.scaleX = 1;
                this.direction = 0;
            } else {
                this.scaleX = -1;
                this.direction = 180;
            }
        }

        //警戒
        if (this.phase == 1) {
            if (this.balloon == null) this.flare('balloon', {pattern: "...", animationInterval : 15});
            if (distance < 192) this.phase = 2;
        }

        //攻撃
        if (this.phase == 2) {
            this.flare('balloonerace');
            for (var i = 0; i < this.dagger.length; i++) {
                this.dagger[i].isAttack = true;
            }
            if (distance < 92) this.phase = 3;
        }
        if (this.phase == 3) {
            this.phase++;
            this.flare('balloonerace');
            for (var i = 0; i < this.dagger.length; i++) {
                this.dagger[i].phase = 10;
            }
        }
        if (this.phase == 4 && this.time % 90 == 0) {
            this.isAttack = true;
        }

        if (this.isAttack) {
            this.isAttack = false;
            if (this.phase == 2) {
                var b = this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true});
                b.rotation = this.getPlayerAngle() + Math.randint(-30, 30);
            }
            if (this.phase == 4) {
                for (var i = 0; i < 4; i++) {
                    var b = this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true});
                    b.rotation = this.getPlayerAngle() + Math.randint(-60, 60);
                }
            }
        }

        if (distance < 96) {
            this.nearCount++;
            if (this.nearCount > 90) {
                this.teleport();
                this.nearCount = 0;
            }
        } else {
            this.nearCount -= 10;
            if (this.nearCount < 0) this.nearCount = 0;
        }
    },

    //テレポート
    teleport: function() {
        for (var i = 0; i < this.dagger.length; i++) {
            this.dagger[i].phase = 10;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },

    firstFrame: function() {
        //マジックダガー装備
        this.dagger = [];
        this.dagger[0] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX:  16, offsetY: -16, order: 0, level: this.level});
        this.dagger[1] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX: -16, offsetY: -16, order: 1, level: this.level});
        if (this.level > 2) this.dagger[2] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX: -32, offsetY: -8, order: 2, level: this.level});
        if (this.level > 3) this.dagger[3] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX:  32, offsetY: -8, order: 3, level: this.level});
    },
});

/*
 *  enemy.babydemon.js
 *  2017/01/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ベビーデーモン
phina.define("qft.Enemy.BabyDemon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 40,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 5,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 0, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 100;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //汎用追跡アルゴリズム
        this.chaseAlgorithm(dis, look);

        //プレイヤーが近くにいたら攻撃
        if (this.isOnFloor && look && !this.isJump && dis < 64) {
            //飛びかかる
            this.isJump = true;
            this.vy = -6;
            var pl = this.parentScene.player;
            if (this.x > pl.x) {
                this.direction = 180;
            } else {
                this.direction = 0;
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look || this.chaseTime > 0) {
            this.vx *= 4;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.bird.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//鳥
phina.define("qft.Enemy.Bird", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 30,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 60,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0,

    //得点
    point: 200,

    //属性ダメージ倍率
    damageArrow: 5,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18});
        options = options.$safe(this.defaultOptions);
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72, 0, 72, 128).setScale(1 + capLevel * 0.1);

        this.hp += this.level * 5;
        this.power += this.level * 1;
        this.point += this.level * 100;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.isVertical = this.options.vertical || false;
        this.direction = this.options.direction || this.isVertical? 90: 0;
        this.speed = this.options.speed || 2;
        this.returnTime = this.options.returnTime || 120;
        this.bombInterval = this.options.bombInterval || 90;

        this.on('damaged', e => {
            if (this.isVertical) return;
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //チェックする壁決定
        var chk = 0;
        if (!this.isVertical) chk = 1;

        //壁に当たるか一定時間経過で折り返し
        if (this._collision[chk].hit || this._collision[chk+2].hit || this.returnTime < 0) {
            this.direction = (this.direction + 180) % 360;
            this.returnTime = this.options.returnTime;
        }

        //プレイヤーをみつけたら加速
        if (this.isLookPlayer()) {
            this.speed = 4;
            this.returnTime -= 2;
        } else {
            this.speed = 2;
            this.returnTime--;
        }

        //移動
        var rad = this.direction.toRadian();
        this.vx = Math.cos(rad) * this.speed;
        this.vy = Math.sin(rad) * this.speed;

        //落し物
        if (this.onScreen && this.time % this.bombInterval == 0) {
            this.parentScene.spawnEnemy(this.x, this.y, "BirdBomb", {});
        }

        //向きの指定
        if (this.vx != 0) {
            if (this.vx > 0) {
                this.scaleX = 1;
            } else {
                this.scaleX = -1;
            }
        }
        if (this.isVertical && this.getDistancePlayer() < 256) {
            if (this.x < this.parentScene.player.x) this.scaleX = 1; else this.scaleX = -1;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["walk"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

//鳥の落し物
phina.define("qft.Enemy.BirdBomb", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //防御力
    deffence: 10,

    //攻撃力
    power: 5,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 5, height: 5});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(72);

        this.setAnimation("normal");
        this.animationInterval = 6;
    },

    update: function() {
        if (this.isOnFloor) this.remove();
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [72, 73, 74, 73];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.bullet.js
 *  2017/01/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.Bullet", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //寿命
    lifespan: 75,

    //速度
    velocity: 2,

    //加速度
    accel: 1.02,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 1.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 0,

    //爆発フラグ
    explode: false,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        this.type = options.type;
        this.power = options.power || this.power;
        this.rotation = options.rotation || 0;
        this.velocity = options.velocity || this.velocity;
        this.lifeSpan = options.lifeSpan || this.lifeSpan;

        //表示用スプライト
        switch (options.type) {
            case "explode":
                this.sprite = phina.display.Sprite("effect", 48, 48).addChildTo(this).setFrameTrimming(0, 192, 192, 96);
                this.animationInterval = 3;
                this.explode = false;
                this.ignoreCollision = true;
                this.isMuteki = true;
                this.pattern = "explode";
                break;
            default:
                this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(9);
                this.animationInterval = 3;
                this.explode = options.explode || true;
                this.pattern = options.pattern || "pattern1";
                break;
        }

        this.setAnimation(this.pattern);

        this.on('dead', function() {
            if (this.explode) {
                this.parentScene.spawnEffect(this.x, this.y);
                app.playSE("bomb");
            }
        });
    },

    algorithm: function() {
        var rad = this.rotation.toRadian();
        this.vx = Math.cos(rad) * this.velocity;
        this.vy = Math.sin(rad) * this.velocity;
        this.velocity *= this.accel;
        if (this.vx > 1) this.sprite.scaleX = 1; else this.sprite.scaleX = -1;
        if (this.time > this.lifespan) this.remove();

        if (!this.ignoreCollision) {
            if (this._collision[0].hit ||
                this._collision[1].hit ||
                this._collision[2].hit ||
                this._collision[3].hit) this.flare('dead');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [9, 10, 11, 10];
        this.frame["pattern2"] = [15, 16, 17, 16];
        this.frame["explode"] = [0, 1, 2, 3, 4, 5, 6, 7, "remove"];
        this.index = 0;
    },

    hit: function() {
        if (this.type == "explode") return;

        this.remove();
        this.flare('dead');
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        this.vx = 0;
        this.vy = -10;
        return this;
    },
});

/*
 *  enemy.death.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//死神
phina.define("qft.Enemy.Death", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 30,

    //重力加速度
    gravity: 0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //気絶確率
    stunPower: 30,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 180,

    //地形無視
    ignoreCollision: true,

    //ノックバックキャンセル
    isSuperArmor: true,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_STONE,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_STONE,

    //属性ダメージ倍率
    damageFire: 2.0,
    damageIce: 0.8,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 128, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 1;
        this.point += this.level * 100;

        this.setAnimation("move");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.phase = 0;
        this.speed = 1;

        //行動パターン
        this.pattern = options.pattern || "linear";
        this.moveLength = options.length || 48;
        this.degree = 0;
        this.isVertical = false;

        //被ダメージ時処理
        this.on('damaged', e => {
            this.phase = 0;
        });

        this.tweener2 = phina.accessory.Tweener().attachTo(this);
    },

    algorithm: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        var rad = this.degree.toRadian();
        if (this.pattern == "linear") {
            if (this.isVertical) {
                this.vy = Math.cos(rad) * 2;
            } else {
                this.vx = Math.cos(rad) * 2;
            }
        }
        this.degree += 2;

        //徘徊モードの場合は適当に攻撃
        if (this.time % 90 == 0) this.isAttack = true;

        //攻撃
        if (this.isAttack) {
            this.isAttack = false;
            var b = this.parentScene.spawnEnemy(this.x, this.y, "DeathFlame", {pattern: 0});
            b.vy = -2;
            b.vx = 2 * this.scaleX;
            this.actionWait = 120;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["move"] = [3, 4, 5, 4];
        this.frame["up"] = [6, 7, 6, 8];
        this.frame["down"] =   [0, 1, 0, 2];
        this.frame["attack"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

//炎
phina.define("qft.Enemy.DeathFlame", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //攻撃力
    power: 10,

    //重力加速度
    gravity: 0.1,

    //横移動減衰率
    friction: 0.98,

    //気絶確率
    stunPower: 20,

    //地形無視
    ignoreCollision: false,

    //無敵フラグ
    isMuteki: true,

    //攻撃当たり判定有効フラグ
    isAttackCollision: true,

    //寿命
    lifeSpan: 120,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 20});
        this.superInit(parentScene, options);

        this.pattern = options.pattern || 0;
        this.lifeSpan = options.lifeSpan || 120;
        this.power += this.level * 5;

        this.setupAnimation(this.pattern);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 0, 144, 128).setFrameIndex(15 + this.pattern);

        this.setAnimation("appear");
        this.animationInterval = 3;

        this.direction = 0;
    },

    algorithm: function() {
        if (this.lifeSpan == 0) this.remove();
        if (this.lifeSpan < 30) {
            if (this.time % 2 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 60){
            if (this.time % 5 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 90) {
            if (this.time % 10 == 0) this.visible = !this.visible;
        }
        this.lifeSpan--;
    },

    setupAnimation: function(index) {
        index = index || 0;
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["appear"] = [15+index, 9+index,  3+index, 21+index, "normal"];
        this.frame["normal"] = [ 0+index, 6+index, 12+index, 18+index];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.demon.js
 *  2017/01/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

//デーモン
phina.define("qft.Enemy.Demon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 30,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 90,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 5,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(Math.min(this.level, 4) * 72, 640, 72, 128)
            .setScale(1.5)
            .setPosition(0, -8);

        this.hp += this.level * 10;
        this.power += this.level * 3;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 16) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 16) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //プレイヤーが近くにいたら攻撃
            if (look && !this.isJump && !this.isAttack) {
                if (dis > 96) {
                    //火を吐く
                    this.fireball();
                } else {
                    //飛びかかる
                    this.isJump = true;
                    this.vy = -6;
                    var pl = this.parentScene.player;
                    if (this.x > pl.x) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look) {
            this.vx *= 3;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (dis < 256) {
                this.flare('balloon', {pattern: "?"});
            } else {
                this.flare('balloonerace');
            }
        }
    },

    //火球を吐く
    fireball: function() {
        this.isAttack = true;
        this.stopTime = 30;
        var tw = phina.accessory.Tweener().attachTo(this).setUpdateType('fps')
            .call(() => {
                this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, power: 10 + this.level * 5, rotation: this.getPlayerAngle()});
            })
            .wait(30)
            .call(() => {
                tw.remove();
                this.isAttack = false;
            });
    },

    //火を吐く
    flaming: function() {
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite2.tweener.clear()
            .fadeIn(15)
            .wait(60)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(15);

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var b = this.parentScene.spawnEnemy(this.x + 24 * this.scaleX, this.y-8, "Bullet", {type: "explode", power: 10, rotation: this.getPlayerAngle(), velocity: 5});
                b.setScale(0.1);
                b.tweener.clear().setUpdateType('fps').to({scaleX: 1, scaleY: 1}, 10);
                ct++;
                if (ct == 6 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(5)
            .setLoop(true);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.devil.js
 *  2017/04/25
 *  @auther minimo  
 *  This Program is MIT license.
 */

//悪魔
phina.define("qft.Enemy.Devil", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 30,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 360,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 800,

    //属性ダメージ倍率
    damageArrow: 5,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_BAG,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_STONE,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18}).$safe(this.defaultOptions);
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(72, 0, 72, 128);

        this.hp += this.level * 10;
        this.power += this.level * 5;
        this.point += this.level * 100;

        this.setAnimation("stand");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.isVertical = this.options.vertical || false;
        this.direction = this.options.direction || this.isVertical? 90: 0;
        this.speed = this.options.speed || 2;
        this.returnTime = this.options.returnTime || 120;
        this.attackInterval = this.options.attackInterval || 90;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤー情報
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤーが近くにいたら寄っていく
        if (look && dis > 32) {
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(pl.x, pl.y);
            var p = p2.sub(p1);
            p.normalize();
            this.vx = p.x * (1 + this.level * 0.2);
            this.vy = p.y * (1 + this.level * 0.2);

            //プレイヤーの方向を向く
            var angle = this.getPlayerAngle();
            if (angle > 315 || angle < 45) this.setAnimation('horizon');
            if ( 45 < angle && angle < 135) this.setAnimation('down');
            if (135 < angle && angle < 225) this.setAnimation('horizon');
            if (225 < angle && angle < 315) this.setAnimation('down');

            //一定以上近づいたら攻撃
            if (dis < 96) this.isAttack = true;

            this.flare('balloon', {pattern: "!"});
        } else {
            this.vx = 0;
            this.vy = 0;
            this.setAnimation("stand");
            this.flare('balloonerace');
        }

        if (this.vx > 0) {
            this.scaleX = 1;
        } else {
            this.scaleX = -1;
        }

        if (this.isAttack) {
            this.attack();
        }
    },

    attack: function() {
        this.stopTime = 30;
        this.isAttack = false;
        this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, power: 10 + this.level * 5, rotation: this.getPlayerAngle()});
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [6, 7, 8, 7];
        this.frame["up"] = [0, 1, 2, 1];
        this.frame["down"] = [5, 6, 7, 6];
        this.frame["horizon"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

/*
 *  enemy.explode.js
 *  2017/07/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.Explode", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0.98,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 0,

    //無敵フラグ
    isMuteki: true,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("effect", 48, 48)
            .addChildTo(this)
            .setFrameTrimming(0, 192, 192, 96);
        this.animationInterval = 3;

        this.power = options.power || this.power;

        this.pattern = options.pattern || "pattern1";
        this.setAnimation(this.pattern);
        this.animationInterval = 3;
    },

    algorithm: function() {
        if (this.index == 8) this.remove();
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [0, 1, 2, 3, 4, 5, 6, 7, 8, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.firebird.js
 *  2016/03/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//鳥
phina.define("qft.Enemy.FireBird", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 90,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0,

    //得点
    point: 300,

    //属性ダメージ倍率
    damageArrow: 5,
    damageFire: 0.5,
    damageIce: 2,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16, offsetCollisionX: -6});
        options = options.$safe(this.defaultOptions);
        this.superInit(parentScene, options);


        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(288, 0, 72, 128);

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.isVertical = this.options.vertical || false;
        this.direction = this.options.direction || this.isVertical? 90: 0;
        this.speed = this.options.speed || 2;
        this.returnTime = this.options.returnTime || 120;
        this.bombInterval = this.options.bombInterval || 90;
        this.attackInterval = 0;
        this.attackCount = 99;
        this.isAttack = false;

        this.on('damaged', e => {
            if (this.isVertical) return;
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
        this.on('dead', function() {
            this.parentScene.spawnEffect(this.x, this.y);
            app.playSE("bomb");
        });
    },

    algorithm: function() {
        //チェックする壁決定
        var chk = 1;
        if (this.isVertical) chk = 0;

        //壁に当たるか一定時間経過で折り返し
        if (this._collision[chk].hit || this._collision[chk+2].hit || this.returnTime < 0) {
            this.direction = (this.direction + 180) % 360;
            this.returnTime = this.options.returnTime;
        }
        //移動
        var rad = this.direction.toRadian();
        this.vx = Math.cos(rad) * this.speed;
        this.vy = Math.sin(rad) * this.speed;
        this.returnTime--;
 
        //プレイヤーを見つけたら攻撃
        var lookPlayer = this.isLookPlayer();
        if (lookPlayer) {
            if (this.attackInterval == 0) {
                var b = this.parentScene.spawnEnemy(this.x, this.y+6, "Bullet", {pattern: "pattern2", explode: true, velocity: 3});
                b.rotation = this.getPlayerAngle();
                this.attackInterval = 90;
            }
        } else {
                this.attackInterval = 60;
        }

        //落し物
        if (this.onScreen && this.time % this.bombInterval == 0) {
            this.parentScene.spawnEnemy(this.x, this.y, "FireBirdBomb", {});
        }

        //向きの指定
        if (this.vx != 0) {
            if (this.vx > 0) {
                this.scaleX = 1;
            } else {
                this.scaleX = -1;
            }
        }
        if (this.isVertical && this.getDistancePlayer() < 256) {
            if (this.x < this.parentScene.player.x) this.scaleX = 1; else this.scaleX = -1;
        }

        if (this.attackInterval > 0) this.attackInterval--;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["walk"] = [3, 4, 5, 4];
        this.index = 0;
    },

    attack: function() {
    },
});

//鳥の落し物
phina.define("qft.Enemy.FireBirdBomb", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //防御力
    deffence: 10,

    //攻撃力
    power: 5,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 5, height: 5});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(72);

        this.setAnimation("normal");
        this.animationInterval = 6;
    },

    update: function() {
        if (this.isOnFloor) {
            this.parentScene.spawnEffect(this.x, this.y, {name: "explode_ground"});
            if (this.onScreen) app.playSE("bomb");
            this.remove();
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [72, 73, 74, 73];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.flame.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//炎
phina.define("qft.Enemy.Flame", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //攻撃力
    power: 10,

    //無敵フラグ
    isMuteki: true,

    //攻撃当たり判定有効フラグ
    isAttackCollision: true,

    //寿命
    lifeSpan: 120,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 20});
        this.superInit(parentScene, options);

        this.pattern = options.pattern || 0;
        this.lifeSpan = options.lifeSpan || 120;
        this.power += this.level * 5;

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(Math.min(this.pattern, 2) * 24 + 72, 0, 24, 128);

        this.setAnimation("normal");
        this.animationInterval = 3;

        this.direction = 0;
    },

    algorithm: function() {
        if (this.lifeSpan == 0) this.remove();
        if (this.lifeSpan < 30) {
            if (this.time % 2 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 60){
            if (this.time % 5 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 90) {
            if (this.time % 10 == 0) this.visible = !this.visible;
        }
        this.lifeSpan--;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [0, 1, 2, 3];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.garuda.js
 *  2017/07/07
 *  @auther minimo  
 *  This Program is MIT license.
 */

//怪鳥
phina.define("qft.Enemy.Garuda", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 80,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 60,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0,

    //スーパーアーマー
    isSuperArmor: true,

    //得点
    point: 3000,

    //属性ダメージ倍率
    damageArrow: 5,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18});
        options = options.$safe(this.defaultOptions);
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01x2", 48, 64).addChildTo(this);
        this.sprite.setFrameTrimming(0, 0, 72 * 2, 128 * 2).setScale(1.5).setPosition(0, 16);

        this.sprite2 = phina.display.Sprite("monster01x2", 48, 64).addChildTo(this);
        this.sprite2.setFrameTrimming(288 * 2, 0, 72 * 2, 128 * 2).setScale(1.5).setPosition(0, 16).setAlpha(0);
        var that = this;
        this.sprite2.update = function() {
            this.frameIndex = that.sprite.frameIndex;
        }

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.moveTime = 0;
    },

    algorithm: function() {
        if (this.path) {
            var p = this.getPathPosition(this.moveTime);
            this.setPosition(p.x, p.y);
        }
        this.moveTime += 2;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["up"] =   [0, 1, 2, 1];
        this.frame["down"] = [6, 7, 8, 7];
        this.frame["walk"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

/*
 *  enemy.greaterdemon.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//グレーターデーモン
phina.define("qft.Enemy.GreaterDemon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 120,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 180,

    //アニメーション間隔
    animationInterval: 15,

    //得点
    point: 5000,

    //飛行モード
    flying: false,
    flyingPhase: 0, //行動フェーズ
    flyingX: 0,     //飛行開始Ｘ座標

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 35, height: 30});
        if (options.size) {
            var size = options.size || 1;
            options.width = size * 35;
            options.height = size * 30;
        }
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(72*2*2, 640*2, 72*2, 128*2).setPosition(0, -10);
        if (options.size) {
            var size = options.size || 1;
            this.sprite.setScale(size).setPosition(0, size * -12);
        }

        this.sprite2 = phina.display.Sprite("monster01x2", 24*2, 32*2).addChildTo(this).setAlpha(0);
        this.sprite2.setFrameTrimming(288*2, 640*2, 72*2, 128*2).setPosition(0, -10);
        this.sprite2.tweener.setUpdateType('fps');
        if (options.size) {
            var size = options.size || 1;
            this.sprite2.setScale(size).setPosition(0, size * -12);
        }
        var that = this;
        this.sprite2.update = function() {
            this.frameIndex = that.sprite.frameIndex;
        }

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.phase = 0;
        this.direction = 0;
        this.isAttack = false;
        this.isAttackCancel = false;
        this.chaseTime = 0;
        this.turnTime = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
            this.isAttackCancel = true;
        });
    },

    algorithm: function() {
        //プレイヤー情報
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //進行方向決定
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }

        //プレイヤー発見後一定時間追跡する
        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.vx *= 3;
            this.flare('balloon', {pattern: "!"});
        }
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }
        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this._collision[3].hit) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //プレイヤーへの攻撃
            if (look && !this.isAttack && !this.isJump) {
                if (dis > 128) {
                    this.firebreath();
                } else {
                    this.exploding();
                }
            }
        }

        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    //火球を吐く
    fireball: function() {
        this.isAttack = true;
        this.stopTime = 30;
        this.sprite2.tweener.clear()
            .fadeIn(10)
            .call(() => {
                this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, rotation: this.getPlayerAngle(), power: 30});
            })
            .wait(45)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(10);
    },

    //炎を吐く
    firebreath: function() {
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite2.tweener.clear()
            .fadeIn(15)
            .wait(60)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(15);

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var b = this.parentScene.spawnEnemy(this.x + 24 * this.scaleX, this.y-8, "Bullet", {type: "explode", power: 10, rotation: this.getPlayerAngle(), velocity: 5});
                b.setScale(0.1);
                b.tweener.clear().setUpdateType('fps').to({scaleX: 1, scaleY: 1}, 10);
                ct++;
                if (ct == 6 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(5)
            .setLoop(true);
    },

    //爆発
    exploding: function() {
        app.playSE("bomb");
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite2.tweener.clear()
            .fadeIn(15)
            .wait(45)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(15);

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var rad = rot.toRadian();
                var ex = Math.cos(rad) * 16;
                var ey = Math.sin(rad) * 16;
                this.parentScene.spawnEnemy(this.x + ex, this.y + ey, "Bullet", {type: "explode", power: 10, rotation: rot, velocity: 3});
                rot += 22.5;
                ct++;
                if (ct == 16 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(1)
            .setLoop(true);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.intelligentsword.js
 *  2017/07/19
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.IntelligentSword", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 1.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 360,

    //得点
    point: 2000,

    //アニメーションフラグ
    isAnimation: false,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_LONGSWORD,

    //レアドロップ率（％）
    rareDropRate: 1,
    rareDropItem: ITEM_LONGSWORD,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 24});
        this.superInit(parentScene, options);

        this.sprite = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setRotation(215);
        this.sprite.tweener.clear()
            .to({y: -2}, 1000, "easeInOutSine")
            .to({y: 4}, 1000, "easeInOutSine")
            .setLoop(true);

        this.type = options.type;
        this.power = options.power || this.power;
        this.rotation = options.rotation || 0;
        this.velocity = options.velocity || this.velocity;

        this.phase = 0;

        this.setupLifeGauge();
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.phase == 0) {
            if (look && dis < 64) {
                this.phase++;
            }
        }

        if (this.phase == 2) {
            var ang = this.getAngle(pl);
            this.rotation = ang + 30;
        }

        if (look) {
            this.flare('balloon', {pattern: "!", lifeSpan: 15, y: 0});
        } else {
            this.flare('balloonerace');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [0];
        this.index = 0;
    },

    snap: function(target) {
        //効果音
        app.playSE("tinkling");
        this.tweener.clear()
            .by({y: -64, rotation: 700}, 15, "easeOutQuad")
            .call(function() {
                this.phase = 10;
            }.bind(this));
    },
});

/*
 *  enemy.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//敵キャラクタ基本クラス
phina.define("qft.Enemy", {
    superClass: "qft.Character",

    //識別フラグ
    isEnemy: true,

    //レベル
    level: 0,

    //ヒットポイント
    hp: 10,

    //防御力
    deffence: 1,

    //攻撃力
    power: 0,

    //移動速度
    speed: 1,

    //気絶確率
    stunPower: 1,

    //視力
    eyesight: 0,

    //視野角
    viewAngle: 90,

    //進行方向（0:右 180:左 270:上 90:下）
    direction: 0,

    //ポイント
    point: 0,

    //攻撃当たり判定有効フラグ
    isEnableAttackCollision: true,

    //スーパーアーマー状態フラグ
    isSuperArmor: false,

    //影表示フラグ
    isShadow: true,

    //属性ダメージ倍率
    damageSlash: 1,
    damageSting: 1,
    damageBlow: 1,
    damageArrow: 1,
    damageFire: 1,
    damageIce: 1,
    damageHoly: 1,
    damageDark: 1,

    //アイテムドロップ率（％）
    dropRate: 0,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 0,
    rareDropItem: ITEM_BAG,

    //行動パターン用
    chaseTime: 0,
    turnTime: 0,
    stopTime: 0,
    turnCount: 0,

    init: function(parentScene, options) {
        options = options || {};
        this.superInit(parentScene, options);
        this.setupAnimation();
        this.options = options;
        this.level = options.level || 0;
        this.territory = options.territory;

        //デバッグ時視界の可視化
        if (DEBUG_EYESIGHT) {
            var that = this;
            var va = (this.viewAngle / 2).toRadian();
            phina.display.ArcShape({radius: this.eyesight, startAngle: -va, endAngle: va}).addChildTo(this).setAlpha(0.3);
        }

        this.on('enterframe', function() {
            if (this.parentScene.pauseScene) return;
            //画面外の場合は動作停止
            if (!this.onScreen) return;

            var pl = this.parentScene.player;

            //向きの指定
            if (this.vx != 0) {
                if (this.vx > 0) {
                    this.scaleX = 1;
                } else {
                    this.scaleX = -1;
                }
            }

            //ステージクリアの場合は当たり判定無し
            if (this.parentScene.isStageClear) return;

            //気絶中はアニメーションしない
            if (this.isStun) {
                this.isAdvanceAnimation = false;
            } else {
                this.isAdvanceAnimation = true;
            }

            //被ダメージ当たり判定
            if (!this.isMuteki && this.mutekiTime == 0) {
                //プレイヤー攻撃との当たり判定
                if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                    this.damage(pl.attackCollision);
                }
                //プレイヤーショットとの当たり判定
                this.parentScene.playerLayer.children.forEach(function(e) {
                    if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                        e.hit(this);
                        e.remove();
                        this.damage(e);
                    }
                }.bind(this));
            }

            //プレイヤーとの当たり判定
            if (this.isEnableAttackCollision && this.mutekiTime == 0) {
                if (!this.isDead && !pl.isDead && this.power > 0 && this.hitTestElement(pl)) {
                    this.hit();
                    pl.damage(this);
                }
            }

            if (this.stopTime == 0) {
                this.algorithm();
                if (this.chaseTime > 0) this.chaseTime--;
                if (this.turnTime > 0) this.turnTime--;
            }
        });

        this.on('dead', function() {
            //確定ドロップアイテム
            if (this.options.item) {
                var i = this.parentScene.spawnItem(this.x, this.y, {kind: this.options.item});
                i.vy = -5;
                if (this.options.item == "key") {
                    i.isEnemyDrop = false;
                } else {
                    i.isEnemyDrop = true;
                }
                this.remove();
                return;
            }
            //レアアイテムドロップ判定
            var dice = Math.randint(1, 100);
            if (dice <= this.rareDropRate) {
                var i = this.parentScene.spawnItem(this.x, this.y, {kind: this.rareDropItem});
                i.vy = -5;
                i.isEnemyDrop = true;
            } else {
                //通常アイテムドロップ判定
                var dice = Math.randint(1, 100);
                if (dice <= this.dropRate) {
                    var i = this.parentScene.spawnItem(this.x, this.y, {kind: this.dropItem});
                    i.vy = -5;
                    i.isEnemyDrop = true;
                }
            }
            this.remove();
        });
    },

    algorithm: function() {
    },

    damage: function(target) {
        if (this.mutekiTime > 0) return false;
        if (this.isMuteki) return false;

        //気絶キャンセル
        this.isStun = false;

        var dir = 0;
        if (target instanceof qft.PlayerAttack) {
            if (target.scaleX == 1) dir = 0; else dir = 180;
        } else {
            if (this.x > target.x) dir = 0; else dir = 180;
        }

        var power = target.power;
        if (target.isSlash) power *= this.damageSlash;
        if (target.isSting) power *= this.damageSting;
        if (target.isBlow) power *= this.damageBlow;
        if (target.isArrow) power *= this.damageArrow;
        if (target.isFire) power *= this.damageFire;
        if (target.isIce) power *= this.damageIce;
        if (target.isHoly) power *= this.damageHoly;
        if (target.isDark) power *= this.damageDark;
        power = Math.floor(power);
        if (!this.isSuperArmor) this.knockback(power, dir);
        this.mutekiTime = 10;
        this.hp -= power;
        if (this.hp <= 0) {
            this.hp = 0;
            this.parentScene.totalScore += this.point;
            this.parentScene.totalKill++;
            this.flare('dead');
        } else {
            this.flare('damaged', {direction: dir});

            //気絶判定
            var dice = Math.randint(1, 100);
            if (dice <= target.stunPower) this.flare('stun', {power: target.power});
        }
        app.playSE("hit");
        return true;
    },

    //プレイヤーが見える位置にいるのか判定
    isLookPlayer: function() {
        //視力外の場合は見えない
        if (this.getDistancePlayer() > this.eyesight) return false;

        //視野角外の場合は見えない
        if (this.viewAngle != 360) {
            //プレイヤーとの角度（右が360度）
            var angle = Math.floor(this.getPlayerAngle());

            //視界範囲内の判定
            if (this.direction == 0) {
                var va = this.viewAngle / 2;
                if (!(360-va < angle || angle < va)) return false;
            } else {
                var dir = this.direction;
                var va = this.viewAngle / 2;
                if (!(dir-va < angle && angle < dir+va)) return false;
            }
        }

        var result = true;
        var that = this;
        var player = this.parentScene.player;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.type == "ladder" || this.type == "stairs") return;
            //自分とプレイヤー間に遮蔽物（地形当り判定）がある場合見えない
            if (phina.geom.Collision.testRectLine(e, that, player)) {
                result = false;
            }
        });
        return result;
    },

    //自分とプレイヤーを結ぶ直線の角度（弧度法）
    getPlayerAngle: function() {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(this.parentScene.player.x, this.parentScene.player.y);
        var p = p2.sub(p1);
        return p.toDegree();
    },

    //自分とプレイヤーを結ぶ直線の角度（ラジアン）
    getPlayerRadian: function() {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(this.parentScene.player.x, this.parentScene.player.y);
        var p = p2.sub(p1);
        return p.toAngle();
    },

    //体力ゲージ設置
    setupLifeGauge: function() {
        var that = this;
        //体力ゲージ
        var options = {
            width:  32,
            height: 2,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 1,
            gaugeColor: 'lime',
            cornerRadius: 0,
            value: this.hp,
            maxValue: this.hp,
        };
        this.lifeGauge = phina.ui.Gauge(options).addChildTo(this).setPosition(0, 0);
        this.lifeGauge.update = function() {
            this.visible = (that.hp != this.maxValue);
            this.value = that.hp;
            this.rotation = -that.rotation;
            this.scaleX = that.scaleX;

            if (this.dispTime > 150) this.visible = false;
            if (this.beforeValue == this.value) this.dispTime++; else this.dispTime = 0;
            this.beforeValue = this.value;
        };
        this.lifeGauge.dispTime = 0;
    },

    hit: function() {
    },

    //汎用往復アルゴリズム（陸上）
    roundtripAlgorithm_ground: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //テリトリー指定
            if (!look && this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }

        if (this.isOnFloor || this.isJump) {
            this.vx =  this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        }
    },

    //汎用往復アルゴリズム（空中）
    roundtripAlgorithm_flying: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        var chk1 = 1;
        var chk2 = 3;
        if (this.vertical) {
            chk1 = 0;
            chk2 = 2;
        }
        //壁に当たったら折り返す
        var turn = false;
        if (this._collision[chk1].hit || this._collision[chk2].hit) turn = true;

        //テリトリー指定
        if (!look && this.territory) {
            if (this.vertical) {
                //垂直方向チェック
                var ty = this.y - this.firstY;
                if (Math.abs(ty) > this.territory) {
                    if (ty > 0) {
                        this.direction = 270;
                    } else {
                        this.direction = 90;
                    }
                }
            } else {
                //水平方向チェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }
    },

    //汎用追跡アルゴリズム
    chaseAlgorithm: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
                this.firstX = this.x;
                this.firstY = this.y;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) {
            this.chaseTime = 0;
            this.firstX = this.x;
            this.firstY = this.y;
        }

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
            if (this.isJump) this.vx *= 1;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }

        if (this.isOnFloor) {
            //テリトリー指定
            if (this.chaseTime == 0 && this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }

            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        }
                    }

                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+32, this.y+32, 16, 96)) {jumpOk = true; this.vy = -7;}
                            if (this.checkMapCollision2(this.x+32, this.y-32, 16, 96)) {jumpOk = true; this.vy = -10;}
                        } else {
                            if (this.checkMapCollision2(this.x-32, this.y+32, 16, 96)) {jumpOk = true; this.vy = -7;}
                            if (this.checkMapCollision2(this.x-32, this.y-32, 16, 96)) {jumpOk = true; this.vy = -10;}
                        }
                        if (jumpOk) {
                            this.isJump = true;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 45;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                            this.firstX = this.x;
                            this.firstY = this.y;
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                }
            }
        }

        if (this.chaseTime == 30) {
            this.flare('balloon', {pattern: "?"});
            this.firstX = this.x;
            this.firstY = this.y;
        }
    },

    //評価関数
    evaluate: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        //脅威度
        var threat = 0;

        //プレイヤーとの距離により脅威度を加算
        if (dis < 256) threat += 10
        if (dis < 128) threat += 20

        //プレイヤー視認可能状態
        if (look) threat += 30;

        //プレイヤー行動状態
        var playerAction = "";
        if (pl.x == pl.before.x && pl.y == pl.before.y) {
            //プレイヤーは移動していない
        } else {
            //プレイヤー進行方向（右:0 左:180）
            var pldir = 0;
            if (pl.x < pl.before.x) pldir = 180;
            if (this.x < pl.x) {
                if (prdir == 0) {
                    //プレイヤーは近づいている
                } else {
                    //プレイヤーは離れている
                }
            } else {
                if (prdir == 180) {
                    //プレイヤーは近づいている
                } else {
                    //プレイヤーは離れている
                }
            }
        }

        return {
            threat: threat,
            playerAction: playerAction,
        };
    },
});

//敵攻撃判定
phina.define("qft.EnemyAttack", {
    superClass: "phina.display.RectangleShape",

    //攻撃力
    power: 1,

    //有効フラグ
    isActive: true,

    //寿命
    lifeSpan: 15,

    init: function(parentScene, options) {
        options = (options || {}).$safe({width: 32, height: 32});
        this.superInit(options);
        this.parentScene = parentScene;

        this.$extend(options);
        this.time = 0;

        this.on('enterframe', e => {
            this.time++;
            if (this.time > this.lifeSpan) {
                this.remove();
                return;
            }
            if (!this.isActive) return;
            var pl = this.parentScene.player;

            //プレイヤー攻撃と当たった場合はエフェクトを出して無効化
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                this.isActice = false;
                this.bump();
                return;
            }

            //プレイヤーショットとの当たり判定
            this.parentScene.playerLayer.children.forEach(function(e) {
                if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                    e.snap(this);
                    e.isCollision = false;
                }
            }.bind(this));

            //プレイヤーとの当たり判定
            if (!pl.isDead && this.hitTestElement(pl)) {
                pl.damage(this);
            }
        });

        if (DEBUG_COLLISION) {
            phina.display.RectangleShape({width: this.width, height: this.height}).addChildTo(this).setAlpha(0.5);
        }
    },

    //判定同士がぶつかった場合の処理
    bump: function() {
        this.parentScene.spawnEffect(this.x, this.y, {name: "hit"});
        if (this.master) {
            var pl = this.parentScene.player;
            pl.knockback(5, this.master.direction);
            this.master.knockback(5, (this.master.direction + 180) % 360);
            app.playSE("tinkling");
        }
    },
});

/*
 *  enemy.knight.js
 *  2017/05/06
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ナイト
phina.define("qft.Enemy.Knight", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 70,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //速度
    speed: 1,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 90,

    //得点
    point: 1000,

    //アイテムドロップ率（％）
    dropRate: 7,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_LONGSWORD,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //武器スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setOrigin(1, 1)
            .setPosition(-4, 2)
            .setScale(-1, 1)
            .setRotation(430);
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.kind = "sword";
        if (options.weapon == "ax") {
            this.weapon.setFrameIndex(20 + Math.min(9, this.level));
            this.weapon.kind = "ax";
        }
        if (options.weapon == "spear") {
            this.weapon.setFrameIndex(30 + Math.min(9, this.level));
            this.weapon.kind = "spear";
        }

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(144, 128, 72, 128);
        this.sprite.setPosition(0, -5).setScale(1.3);

        this.hp += this.level * 10;
        this.power += this.level * 10;
        this.point += this.level * 500;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
            if (this.isJump) this.vx *= 1;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }
        if (this.chaseTime > 0) this.vx *= 3;

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                }
            }

            //攻撃
            if (look && !this.isJump && dis < 64 && !this.isAttack) {
                this.attack();
            }

            //プレイヤー飛び道具を弾く（レベル４以上）
            if (this.level > 3 && look && !this.isAttack) {
                var that = this;
                //プレイヤーショットとの距離判定
                this.parentScene.playerLayer.children.forEach(function(e) {
                    if (e instanceof qft.PlayerAttack && e.isCollision && e.type == "arrow") {
                        if (that.getDistance(e) < 64) that.guard();
                    }
                }.bind(this));
            }
        }

        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    attack: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 24, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        if (this.weapon.kind == "sword" || this.weapon.kind == "ax") {
            atk.isActive = false;
            this.weapon.tweener.clear()
                .to({rotation: 270}, 3)
                .wait(3)
                .call(function() {
                    atk.isActive = true;
                    that.vx = 16 * that.scaleX;
                })
                .to({rotation: 430}, 6)
                .call(function() {
                    that.isAttack = false;
                    atk.remove();
                });
        } else if (this.weapon.kind == "spear") {
            atk.width = 32;
            atk.height = 8;
            atk.setPosition(this.x + this.scaleX * 1, this.y);
            atk.tweener.clear().by({x: 20 * this.scaleX}, 10).by({x: -20 * this.scaleX}, 10);
            atk.isActive = false;

            this.weapon.tweener.clear()
                .set({rotation: 45, x: -20})
                .wait(2)
                .call(function() {
                    atk.isActive = true;
                    that.isSuperArmor = true;
                    that.vx = 32 * that.scaleX;
                })
                .by({x: 20}, 3)
                .by({x: -30}, 5)
                .call(function() {
                    that.isAttack = false;
                    that.isSuperArmor = false;
                    atk.remove();
                })
                .set({rotation: 430, x: -2});
        }
        this.isAttack = true;
        this.stopTime = 30;
    },

    //飛び道具弾き
    guard: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 24, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        this.isMuteki = true;
        this.weapon.tweener.clear()
            .set({rotation: 430})
            .to({rotation: 300}, 3)
            .to({rotation: 430}, 3)
            .call(function() {
                that.isAttack = false;
                that.isMuteki = false;
                atk.remove();
            });
        this.isAttack = true;
        this.stopTime = 6;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.mage.js
 *  2017/04/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

//魔術師
phina.define("qft.Enemy.Mage", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 160,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var lv = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming((lv % 2) * 144, Math.floor(lv / 2) * 128, 72, 128);
        this.sprite.setScale(1.2).setPosition(0, -2);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 200;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.phase = 0;
        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        if (this.isOnFloor) {
            //プレイヤーが近くにいたら距離を取る
            if (this.phase == 0 && look && !this.isJump && distance < 128) {
                this.flare('balloon', {pattern: "!"});
                this.phase = 1;
                this.speed = 3;
            }

            //逃げるフェーズ
            if (this.phase == 1) {
                if (distance < 128) {
                    if (this.x < player.x) this.direction = 180; else this.direction = 0;
                    this.speed = 3;
                } else {
                    if (this.x < player.x) this.direction = 0; else this.direction = 180;
                    this.speed = 0;
                    this.phase = 2;
                }
                var lv = Math.min(this.level, 4);
                this.sprite.setFrameTrimming((lv % 2) * 144, Math.floor(lv / 2) * 128, 72, 128);
            }

            //攻撃フェーズ
            if (this.phase == 2) {
                if (distance < 96) {
                    //プレイヤーが近づいたら逃げる
                    this.phase = 1;
                } else {
                    //プレイヤーが遠くにいる場合は攻撃
                    this.isAttack = true;
                }
            }

            //発狂モード
            if (this.phase == 3) {
                this.isAttack = true;
            }

            if (this.isAttack) {
                var lv = Math.min(this.level, 4);
                this.sprite.setFrameTrimming((lv % 2) * 144 + 72, Math.floor(lv / 2) * 128, 72, 128);
                this.isAttack = false;

                if (this.phase < 3) {
                    this.stopTime = 30;
                    this.fireball();
                } else {
                    this.stopTime = 8;
                    this.fireball();
                }

                //プレイヤー方向を向く
                if (this.x < player.x) {
                    this.diretion = 0;
                    this.scaleX = 1;
                } else {
                    this.direction = 180;
                    this.scaleX = -1;
                }
            }

            //これ以上進めない場合は折り返す
            var cantescape = false;
            if (this._collision[1].hit || this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
                if (this.phase == 1) cantescape = true;
            } else if (this._collision[3].hit || this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
                if (this.phase == 1) cantescape = true;
            }
            //逃げられない場合は発狂モード
            if (cantescape) {
                this.phase = 3;
                this.speed = 0;
            }

            //プレイヤーが離れたら通常フェーズ
            if (distance > 128 + 64) {
                var lv = Math.min(this.level, 4);
                this.sprite.setFrameTrimming((lv % 2) * 144, Math.floor(lv / 2) * 128, 72, 128);
                this.phase = 0;
                this.speed = 1;
            }
        }

        if (this.isOnFloor || this.isJump) {
            this.vx = this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },

    //ファイアボール
    fireball: function() {
        this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, rotation: this.getPlayerAngle() + Math.randint(-40, 40)});
    },

    //爆発
    explode: function() {
        app.playSE("bomb");
        this.isAttack = false;
        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var rad = rot.toRadian();
                var ex = Math.cos(rad) * 16;
                var ey = Math.sin(rad) * 16;
                this.parentScene.spawnEnemy(this.x + ex, this.y + ey, "Bullet", {type: "explode", power: 10, rotation: rot, velocity: 3});
                rot += 22.5;
                ct++;
                if (ct == 32 || this.attackCancel) {
                    tw.remove();
                }
            })
            .wait(1)
            .setLoop(true);
    },
});

/*
 *  enemy.magicdgger.js
 *  2017/07/19
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.MagicDagger", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //寿命
    lifespan: 75,

    //速度
    velocity: 2,

    //加速度
    accel: 1.02,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 1.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 0,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(0);
        this.setAnimation("pattern1");

        this.power = options.power || this.power;
        this.power += this.level * 2;

        this.parentUnit = options.parent || null;
        this.offsetX = options.offsetX || Math.randint(-16, 16);
        this.offsetY = options.offsetY || Math.randint(-16, 16);
        this.order = options.order || 0;

        this.isAttack = false;
        this.isAttack_before = false;
        this.isDamaged = false;

        this.phase = 0;
    },

    algorithm: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //待機開始
        if (this.phase == 0) {
            this.phase++;
            var x = this.parentUnit.x + this.offsetX;
            var y = this.parentUnit.y + this.offsetY;
            y += Math.cos(this.time.toRadian() * 6) * 5;
            this.tweener.clear()
                .moveTo(x, y, 5)
                .call(() => {
                    this.phase++;
                });
        }

        //待機中
        if (this.phase == 2) {
            this.x = this.parentUnit.x + this.offsetX;
            this.y = this.parentUnit.y + this.offsetY;
            this.y += Math.cos(this.time.toRadian() * 6) * 5;
            this.rotation -= 3;

            if (this.isAttack) {
                this.phase = 3;
                this.isAttack = false;
            }
        }

        //プレイヤー攻撃開始
        if (this.phase == 3) {
            this.phase++;
            this.rotation = this.getPlayerAngle() + 135;
            this.tweener.clear()
                .moveTo(pl.x, pl.y, 20, "easeInQuad")
                .call(() => {
                    this.phase++;
                });
        }

        //攻撃終了
        if (this.phase == 5) {
            this.phase++;
            this.isEnableAttackCollision = false;
            var x = this.parentUnit.x + this.offsetX;
            var y = this.parentUnit.y + this.offsetY;
            this.tweener.clear()
                .moveTo(x, y, 15, "easeInOutQuad")
                .wait(5)
                .call(() => {
                    this.phase = 0;
                    this.isEnableAttackCollision = true;
                });
        }

        //警戒待機開始
        if (this.phase == 10) {
            this.phase++;
            var deg = this.time.toRadian() * 6 + this.order * 60;
            var x = this.parentUnit.x + Math.cos(deg) * 16;
            var y = this.parentUnit.y + Math.sin(deg) * 16;
            this.tweener.clear()
                .moveTo(x, y, 5)
                .call(() => {
                    this.phase++;
                });
        }

        //警戒待機中
        if (this.phase == 12) {
            var deg = this.time.toRadian() * 6 + this.order * 60;
            this.x = this.parentUnit.x + Math.cos(deg) * 16;
            this.y = this.parentUnit.y + Math.sin(deg) * 16;
            this.rotation -= 6;

            if (this.isAttack) {
                this.phase = 13;
                this.isAttack = false;
            }
        }

        //近接攻撃開始
        if (this.phase == 13) {
            this.phase++;
            this.tweener.clear()
                .wait(10)
                .call(() => {
                    this.phase++;
                    this.rotation = this.getPlayerAngle() + 135;
                })
                .moveTo(pl.x, pl.y, 6)
                .call(() => {
                    this.phase++;
                });
        }

        //近接攻撃
        if (this.phase == 14) {
            var deg = this.time.toRadian() * 20 + this.order * 60;
            this.x = this.parentUnit.x + Math.cos(deg) * 24;
            this.y = this.parentUnit.y + Math.sin(deg) * 24;
            this.rotation -= 6;
        }

        //攻撃終了
        if (this.phase == 16) {
            this.phase++;
            this.isEnableAttackCollision = false;
            var x = this.parentUnit.x + this.offsetX;
            var y = this.parentUnit.y + this.offsetY;
            this.tweener.clear()
                .moveTo(x, y, 10)
                .call(() => {
                    this.phase = 10;
                    this.isEnableAttackCollision = true;
                });
        }

        //親ユニット同期
        if (this.parentUnit) {
            this.direction = this.parentUnit.direction;
            if (this.parentUnit.hp == 0) this.remove();
        }

        //飛び道具迎撃
        this.parentScene.playerLayer.children.forEach(function(e) {
            if (e instanceof qft.PlayerAttack && e.isCollision) {
                if (e.type != "arrow" && e.type != "masakari") return;
                var dis = this.getDistance(e);
                if (dis < 64) {
                    this.phase = 20;
                    this.tweener.clear()
                        .moveTo(e.x, e.y, 5)
                        .call(() => {
                            this.phase = 10;
                        });
                }
            }
        }.bind(this));

        this.isAttack_before = this.isAttack;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [0];
        this.index = 0;
    },

    damage: function(target) {
        this.isDamaged = true;
        if (this.phase < 10) this.phase = 6; else this.phase = 17;

        //効果音
        app.playSE("tinkling");
        this.tweener.clear()
            .by({y: -64, rotation: 700}, 15, "easeOutQuad")
            .call(function() {
                if (this.phase < 10) this.phase = 0; else this.phase = 10;
                this.isDamaged = false;
            }.bind(this));
    },
});

/*
 *  enemy.ogre.js
 *  2017/05/06
 *  @auther minimo  
 *  This Program is MIT license.
 */

//オーガ
phina.define("qft.Enemy.Ogre", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 60,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 1000,

    //アイテムドロップ率（％）
    dropRate: 7,
    dropItem: ITEM_BAG,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWEL,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(216, 0, 72, 128);
        this.sprite.setPosition(0, -5).setScale(1.3);

        this.hp += this.level * 5;
        this.power += this.level * 3;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 0.5;
            } else {
                this.vx = -0.5;
            }
            if (this.chaseTime > 0) this.vx *= 4;
        }

        if (look) {
            this.chaseTime = 150;
            this.turnCount = 0;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+40, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+40, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                    this.turnWait = 1;
                }
            }
        }
        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.orochi.js
 *  2017/06/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

//大蛇
phina.define("qft.Enemy.Orochi", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 700,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 32, height: 36});
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01x2", 24 * 2, 32 * 2).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72 * 2, 384 * 2, 72 * 2, 128 * 2)
            .setScale(1 + capLevel * 0.1)
            .setPosition(0, capLevel * -1 - 4);
        this.width += capLevel * 10;

        this.hp += this.level * 10;
        this.power += this.level * 5;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 15;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        if (this.isDead) return;

        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+10, this.y+40, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-10, this.y+40, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //プレイヤーが近くにいたらジャンプ攻撃
            if (look && !this.isJump && dis < 40) {
                this.isJump = true;
                this.vy = -6;
                var pl = this.parentScene.player;
                if (this.x > pl.x) {
                    this.direction = 180;
                } else {
                    this.direction = 0;
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look) {
            this.vx *= 4;
            this.flare('balloon', {pattern: "!", lifeSpan: 15, y: 0});
        } else {
            this.flare('balloonerace');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.slime.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//スライム
phina.define("qft.Enemy.Slime", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 100,

    //属性ダメージ倍率
    damageSting: 0.8,
    damageBlow: 0.5,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72, 256, 72, 128)
            .setScale(1 + capLevel * 0.2)
            .setPosition(0, -2 + capLevel * -3);
        this.width += capLevel * 5;

        this.hp += this.level * 10;
        if (this.level > 3) this.hp += 30;
        this.power += this.level * 5;
        this.point += this.level * 200;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
            if (this.level > 3　&& this.stopTime == 0) {
                this.attack();
                this.flare('balloon', {pattern: "anger1", lifeSpan: 60, y: 0, force: true});
            }
        });
    },

    algorithm: function() {
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //テリトリー指定
            if (this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }

            if (this.level < 4) {
                //プレイヤーが近くにいたらジャンプ攻撃
                if (look && !this.isJump && dis < 40) {
                    this.isJump = true;
                    this.vy = -6;
                    var pl = this.parentScene.player;
                    if (this.x > pl.x) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            this.vx =  2 + Math.floor(this.level*0.5) * this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        }
    },

    attack: function() {
        this.stopTime = 30;
        var vx = 1;
        if (this.direction == 180) vx = -1;
        for (var i = 0; i < this.level; i++) {
            var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 2});
            b.vy = -8;
            b.vx = i * 2 * vx;
        }
    },

    randomAttack: function() {
        this.stopTime = 30;
        var vx = 1;
        if (this.direction == 180) vx = -1;
        for (var i = 0; i < this.level; i++) {
            var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 2});
            b.vy = -8;
            b.vx = i * 2 * vx;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.snake.js
 *  2017/01/27
 *  @auther minimo  
 *  This Program is MIT license.
 */

//蛇
phina.define("qft.Enemy.Snake", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 150,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18});
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72, 384, 72, 128)
            .setScale(1 + capLevel * 0.1)
            .setPosition(0, capLevel * -1)
        this.width += capLevel * 5;

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 100;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        if (this.isDead) return;

        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //プレイヤーが近くにいたらジャンプ攻撃
            if (look && !this.isJump && dis < 40) {
                this.isJump = true;
                this.vy = -6;
                var pl = this.parentScene.player;
                if (this.x > pl.x) {
                    this.direction = 180;
                } else {
                    this.direction = 0;
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look) {
            this.vx *= 4;
            this.flare('balloon', {pattern: "!", lifeSpan: 15, y: 0});
        } else {
            this.flare('balloonerace');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.titan.js
 *  2017/05/06
 *  @auther minimo  
 *  This Program is MIT license.
 */

//巨人
phina.define("qft.Enemy.Titan", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 3000,

    //アイテムドロップ率（％）
    dropRate: 7,
    dropItem: ITEM_BAG,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWEL,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 25, height: 40});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(216*2, 0, 72*2, 128*2);
        this.sprite.setPosition(0, -5);

        this.hp += this.level * 10;
        this.power += this.level * 5;
        this.point += this.level * 500;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 0.5;
            } else {
                this.vx = -0.5;
            }
            if (this.isJump) this.vx *= 1.5;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }
        if (this.chaseTime > 0) this.vx *= 3;

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+40, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+40, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                    this.turnWait = 1;
                }
            }

            //攻撃
            if (look && !this.isJump && dis < 64 && !this.isAttack) {
                this.attack();
            }
        }
        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    attack: function() {
        var that = this;
        var atk = qft.EnemyAttack(this.parentScene, {width: 1, height: 24, power: 40 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        atk.isActive = false;
        atk.tweener.clear()
            .wait(6)
            .call(function() {
                atk.isActive = true;
                that.vx = 24 * that.scaleX;
            })
            .wait(6)
            .call(function() {
                that.isAttack = false;
                atk.remove();
            });
        this.isAttack = true;
        this.stopTime = 30;

        qft.Character.balloon({pattern: "anger2"}).addChildTo(this).setPosition(0, -this.height/2-10);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.wisp.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ウィスプ
phina.define("qft.Enemy.Wisp", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //重力加速度
    gravity: 0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 360,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 100,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_STONE,

    //レアドロップ率（％）
    rareDropRate: 0,
    rareDropItem: ITEM_STONE,

    //属性ダメージ倍率
    damageFire: 0.8,
    damageIce: 2,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(Math.min(this.level, 4) * 72, 512, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.eyesight += this.level * 64,
        this.point += this.level * 200;

        this.setAnimation("stand");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.move = false;
        this.attackCount = 0;
    },

    algorithm: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤーが近くにいたら寄っていく
        if (look) {
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(pl.x, pl.y);
            var p = p2.sub(p1);
            p.normalize();
            this.vx = p.x * (1 + this.level * 0.2);
            this.vy = p.y * (1 + this.level * 0.2);
        } else {
            this.vx = 0;
            this.vy = 0;
        }

        //攻撃
        if (this.level > 3 && dis < 128) {
            this.attackCount--;
            if (this.attackCount == 0) {
                for (var i = 0; i < this.level; i++) {
                    var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 1});
                    b.vy = -10;
                    b.vx = (i*2) * this.scaleX;
                }
                this.attackCount = 180 - this.level * 15;
            }
        } else {
            this.attackCount = 60;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

//ウィスプ（強）
phina.define("qft.Enemy.WispHard", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //重力加速度
    gravity: 0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 360,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 300,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_STONE,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_JEWEL,

    //属性ダメージ倍率
    damageFire: 0.5,
    damageIce: 2,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(288, 512, 72, 128);

        this.setAnimation("stand");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.move = false;
        this.attackCount = 0;
    },

    update: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤーが近くにいたら寄っていく
        if (look) {
            var player = this.parentScene.player;
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(player.x, player.y);
            var p = p2.sub(p1);
            p.normalize();
            this.vx = p.x / 2;
            this.vy = p.y / 2;
        } else {
            this.vx = 0;
            this.vy = 0;
        }

        //攻撃
        if (dis < 160) {
            this.attackCount--;
            if (this.attackCount == 0) {
                for (var i = 0; i < this.level+4; i++) {
                    var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 1});
                    b.vy = -10;
                    b.vx = (i*2) * this.scaleX;
                }
                this.attackCount = 180 - this.level * 15;
            }
        } else {
            this.attackCount = 60;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

phina.define("qft.Enemy.WispBomb", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //横移動減衰率
    friction: 0.99,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //得点
    point: 0,

    //無敵フラグ
    isMuteki: true,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 10, height: 10});
        options = options || {};
        this.$extend(options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("particle", 16, 16).addChildTo(this).setFrameIndex(31);
        this.animationInterval = 3;

        this.pattern = options.pattern || 1;
        this.setAnimation("pattern"+this.pattern);

        this.on('dead', function() {
        });
    },

    update: function() {
        if (this.isOnFloor) {
            if (this.onScreen) app.playSE("bomb");
            var b = this.parentScene.spawnEnemy(this.x, this.y, "Flame", {pattern: 1});
            this.remove();
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [31, 30, 29, 28, 27, 26, "stop"];
        this.frame["pattern2"] = [31, 30, 29, 28, 27, 26, "stop"];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.wizard.js
 *  2017/08/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ウィザード
phina.define("qft.Enemy.Wizard", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 360,

    //得点
    point: 3000,

    //重力加速度
    gravity: 0,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this)
            .setFrameTrimming(0, 0, 72, 128)
            .setScale(1.2);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.speed = 1;
        this.isAttack = false;

        //行動フェーズ
        this.phase = "wait";

        //接近戦経過時間
        this.nearCount = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        //待機中
        if (this.phase == "wait") {
            if (look) {
                this.flare('balloon', {pattern: "!", lifeSpan: 15});
                this.phase = "approach";
            }
        }

        //プレイヤー発見後接近
        if (this.phase == "approach") {
        }

        if (distance < 128) {
            this.nearCount++
        } else {
            this.nearCount = 0;
        }
    },

    //テレポート開始
    teleportIn: function() {
        this.sprite.tweener.fadeOut(30);
        for (var i = 0; i < 7; i++) {
            var sp = phina.display.Sprite("monster03", 24, 32)
                .addChildTo(this)
                .setFrameTrimming(0, 0, 72, 128);
            sp.tweener.setUpdateType('fps').clear()
                .by({x: -64 + i * 16, alpha: -1}, 30,"easeOutSine");
        }
    },

    //テレポート終了
    teleportOut: function() {
        this.sprite.tweener.fadeIn(30);
        for (var i = 0; i < 7; i++) {
            var sp = phina.display.Sprite("monster03", 24, 32)
                .addChildTo(this)
                .setFrameTrimming(0, 0, 72, 128);
            sp.tweener.setUpdateType('fps').clear()
                .by({x: -64 + i * 16, alpha: -1}, 30,"easeOutSine");
        }
    },

    //分身
    cloneMySelf: function() {
    },

    //火炎魔法
    flame: function() {
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },

    firstFrame: function() {
    },
});

//ウィザード分身
phina.define("qft.Enemy.WizardClone", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //得点
    point: 0,

    //重力加速度
    gravity: 0,

    //アイテムドロップ率（％）
    dropRate: 0,

    //レアドロップ率（％）
    rareDropRate: 0,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var lv = Math.min(this.level, 3);
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming((lv % 2) * 144 + 72, Math.floor(lv / 2) * 128, 72, 128);
        this.sprite.setScale(1.2);

        this.setAnimation("walk");
        this.animationInterval = 10;

        this.direction = 0;
        this.speed = 1;
        this.phase = 0;
        this.isAttack = false;
        this.isTeleport = false;
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  item.js
 *  2017/01/04
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アイテムクラス
phina.define("qft.Item", {
    superClass: "qft.Character",

    //識別フラグ
    isItem: true,

    //アイテム種別
    kind: 0,

    //アイテムレベル
    level: 0,

    //捨てアイテム
    throwAway: false,

    //大まかな種別フラグ
    isWeapon: false,
    isEquip: false,
    isFood: false,
    isItem: false,
    isKey: false,

    //敵ドロップアイテムフラグ
    isEnemyDrop: false,

    //アイテム情報
    status: null,

    //反発係数
    rebound: 0.3,

    //アニメーション進行可能フラグ   
    isAdvanceAnimation: false,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 16, height: 16});

        //アイテムレベル
        this.level = 0;
        this.kind = null;
        if (options.properties) {
            this.level = options.properties.level || 0;
            this.kind = options.properties.kind;
        }
        if (options.kind !== undefined) this.kind = options.kind;

        //アイテム種別
        if (this.kind == null) {
            if (options.name == "food") {
                this.kind = ITEM_APPLE + this.level;
            } else {
                var name = "ITEM_"+options.name.toUpperCase();
                this.kind = eval(name);
            }
        } else if (typeof this.kind === "string") {
            var name = "ITEM_"+this.kind.toUpperCase();
            this.kind = eval(name);
        }

        //アイテムステータス取得
        this.$extend(qft.ItemInfo.get(this.kind));

        //アイテムスプライト
        if (this.isWeapon) {
            //武器の場合
            var index = this.kind * 10 + Math.min(this.level, this.maxIndex);
            this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(index);

            if (this.level > 0) {
                //強化レベル表示
                var labelParam = {
                    fill: "white",
                    stroke: "black",
                    strokeWidth: 2,

                    fontFamily: "Orbitron",
                    align: "center",
                    baseline: "middle",
                    fontSize: 10,
                    fontWeight: ''
                };
                phina.display.Label({text: "+"+this.level}.$safe(labelParam)).setPosition(6, 6).addChildTo(this);
            }
        } else {
            this.sprite = phina.display.Sprite("item", 24, 24).addChildTo(this).setFrameIndex(this.kind);
        }

        //寿命
        this.lifeSpan = 150;

        //アクティブフラグ
        if (this.options.active === undefined || this.options.active == true) {
            this.isActive = true;
        } else {
            this.isActive = false;
        }

        this.on('enterframe', e => {
            //プレイヤーとの当たり判定
            var pl = this.parentScene.player;
            if (this.hitTestElement(pl)) {
                if (this.time > 10 && !this.throwAway) {
                    pl.getItem(this);
                    this.remove();
                }
            } else if (this.time > 30 && this.throwAway) this.throwAway = false;

            if (this.isEnemyDrop) {
                if (this.lifeSpan == 0) this.remove();
                if (this.lifeSpan < 30) {
                    if (this.time % 2 == 0) this.visible = !this.visible;
                } else if (this.lifeSpan < 60){
                    if (this.time % 5 == 0) this.visible = !this.visible;
                } else if (this.lifeSpan < 90) {
                    if (this.time % 10 == 0) this.visible = !this.visible;
                }
                this.lifeSpan--;
            }
        });
    },
});

phina.define("qft.ItemInfo", {
    _static: {
        get: function(kind) {
            switch (kind) {
                case "shortsword":
                case ITEM_SHORTSWORD:
                    return {
                        name: "SHORT SWORD",
                        type: "sword",
                        isWeapon: true,
                        isSlash: true,
                        power: 10,
                        stunPower: 1,
                        maxIndex: 0,
                        collision: {
                            width: 14,
                            height: 30
                        }
                    };
                case "longsword":
                case ITEM_LONGSWORD:
                    return {
                        name: "LONG SWORD",
                        type: "sword",
                        isWeapon: true,
                        isSlash: true,
                        power: 15,
                        stunPower: 5,
                        maxIndex: 7,
                        collision: {
                            width: 24,
                            height: 25
                        }
                    };
                case "ax":
                case ITEM_AX:
                    return {
                        name: "AX",
                        type: "ax",
                        isWeapon: true,
                        isSlash: true,
                        isBrow: true,
                        power: 20,
                        stunPower: 20,
                        maxIndex: 4,
                        collision: {
                            width: 14,
                            height: 26
                        }
                    };
                case "spear":
                case ITEM_SPEAR:
                    return {
                        name: "SPEAR",
                        type: "spear",
                        isWeapon: true,
                        isSting: true,
                        power: 10,
                        stunPower: 1,
                        maxIndex: 4,
                        collision: {
                            width: 39,
                            height: 10
                        }
                    };
                case "bow":
                case ITEM_BOW:
                    return {
                        name: "BOW",
                        type: "bow",
                        isWeapon: true,
                        isBrow: true,
                        power: 5,
                        stunPower: 5,
                        maxIndex: 0,
                        collision: {
                            width: 20,
                            height: 10
                        }
                    };
                case "rod":
                case ITEM_ROD:
                    return {
                        name: "MAGIC ROD",
                        type: "rod",
                        isWeapon: true,
                        isBrow: true,
                        isFire: true,
                        power: 5,
                        stunPower: 10,
                        maxIndex: 7,
                        collision: {
                            width: 20,
                            height: 10
                        }
                    };
                case "book":
                case ITEM_BOOK:
                    return {
                        name: "BOOK",
                        type: "book",
                        isWeapon: true,
                        isBrow: true,
                        isHoly: true,
                        power: 10,
                        stunPower: 40,
                        maxIndex: 0,
                        collision: {
                            width: 20,
                            height: 20
                        }
                    };
                case "shield":
                case ITEM_SHIELD:
                    return {
                        name: "SHIELD",
                        type: "equip",
                        isEquip: true,
                        power: 20,
                        point: 1000,
                    };
                case "armor":
                case ITEM_ARMOR:
                    return {
                        name: "ARMOR",
                        type: "equip",
                        isEquip: true,
                        power: 30,
                        point: 5000,
                    };
                case "hat":
                case ITEM_HAT:
                    return {
                        name: "HAT",
                        type: "equip",
                        isEquip: true,
                        power: 10,
                        point: 300,
                    };
                case "boots":
                case ITEM_BOOTS:
                    return {
                        name: "BOOTS",
                        type: "equip",
                        isEquip: true,
                        power: 10,
                        point: 500,
                    };
                case "grove":
                case ITEM_GROVE:
                    return {
                        name: "GROVE",
                        type: "equip",
                        isEquip: true,
                        power: 10,
                        point: 500,
                    };
                case "ring":
                case ITEM_RING:
                    return {
                        name: "RING",
                        type: "equip",
                        isEquip: true,
                        power: 20,
                        point: 3000,
                    };
                case "scroll":
                case ITEM_SCROLL:
                    return {
                        name: "SCROLL",
                        type: "item",
                        isItem: true,
                        point: 1000,
                    };
                case "letter":
                case ITEM_LETTER:
                    return {
                        name: "LETTER",
                        type: "item",
                        isItem: true,
                        point: 100,
                    };
                case "card":
                case ITEM_CARD:
                    return {
                        name: "CARD",
                        type: "item",
                        isItem: true,
                        point: 1000,
                    };
                case "key":
                case ITEM_KEY:
                    return {
                        name: "KEY",
                        type: "key",
                        isKey: true,
                        point: 2000,
                    };
                case "coin":
                case ITEM_COIN:
                    return {
                        name: "COIN",
                        type: "item",
                        isItem: true,
                        point: 500,
                    };
                case "bag":
                case ITEM_BAG:
                    return {
                        name: "BAG",
                        type: "item",
                        isItem: true,
                        point: 1000,
                    };
                case "orb":
                case ITEM_ORB:
                    return {
                        name: "ORB",
                        type: "item",
                        isItem: true,
                        point: 5000,
                    };
                case "stone":
                case ITEM_STONE:
                    return {
                        name: "STONE",
                        type: "item",
                        isItem: true,
                        point: 2000,
                    };
                case "jewel":
                case ITEM_JEWEL:
                    return {
                        name: "JEWEL",
                        type: "item",
                        isItem: true,
                        point: 5000,
                    };
                case "jewelbox":
                case ITEM_JEWELBOX:
                    return {
                        name: "JEWELBOX",
                        type: "item",
                        isItem: true,
                        point: 10000,
                    };
                case "apple":
                case ITEM_APPLE:
                    return {
                        name: "APPLE",
                        type: "food",
                        isFood: true,
                        power: 20,
                    };
                case "harb":
                case ITEM_HARB:
                    return {
                        name: "HARB",
                        type: "food",
                        isFood: true,
                        power: 40,
                    };
                case "meat":
                case ITEM_MEAT:
                    return {
                        name: "MEAT",
                        type: "food",
                        isFood: true,
                        power: 60,
                    };
                case "potion":
                case ITEM_POTION:
                    return {
                        name: "POTION",
                        type: "food",
                        isFood: true,
                        power: 100,
                    };
                default:
                    return {};
            }
        },
    },
});


/*
 *  itembox.js
 *  2017/01/04
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アイテムボックスクラス
phina.define("qft.ItemBox", {
    superClass: "qft.Character",

    //識別フラグ
    isItemBox: true,

    //耐久力
    hp: 1,

    //開いたフラグ
    opened: false,

    //アイテム種別
    kind: 0,

    //アニメーション間隔
    animationInterval: 3,

    //反発係数
    rebound: 0.3,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 26, height: 26}.$safe(options.properties));

        //アイテムボックススプライト
        this.sprite = phina.display.Sprite("itembox", 32, 32)
            .addChildTo(this)
            .setScale(0.8)
            .setFrameIndex(0);
        this.sprite.tweener.setUpdateType('fps');

        this.setAnimation("close");

        //内容物
        this.name = options.name;
        this.kind = options.properties? options.properties.kind: undefined;
        this.level = options.properties? options.properties.level: 0;
    },

    update: function() {
        if (!this.opened) {
            //プレイヤー攻撃（固定）との当たり判定
            var pl = this.parentScene.player;
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                this.damage(pl);
            }
            //プレイヤー攻撃判定との当たり判定
            this.parentScene.playerLayer.children.forEach(function(e) {
                if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                    e.remove();
                    this.damage(e);
                }
            }.bind(this));
        }
        this.visible = true;    //点滅キャンセル
    },

    damage: function(target) {
        if (this.opened) return;
        this.hp -= target.power;
        this.mutekiTime = 10;
        if (this.hp <= 0) {
            this.open();
        }
        if (this.x < target.x) {
            this.sprite.tweener.clear().moveBy(-5, 0, 2).moveBy(5, 0, 2);
        } else {
            this.sprite.tweener.clear().moveBy(5, 0, 2).moveBy(-5, 0, 2);
        }
    },

    open: function() {
        this.isAdvanceAnimation = true;
        this.opened = true;
        this.setAnimation("open");
        switch (this.name) {
            case "empty":
                break;
            case "item":
                this.tweener.clear()
                    .wait(10)
                    .call(function() {
                        var options = {
                            kind: this.kind,
                            properties: {
                                level: this.level
                            }
                        };
                        var i = this.parentScene.spawnItem(this.x, this.y, options);
                        i.vy = -5;
                    }.bind(this));
                break;
            default:
                this.tweener.clear()
                    .wait(10)
                    .call(function() {
                        var options = {
                            name: this.name,
                            properties: {
                                level: this.level
                            }
                        };
                        var i = this.parentScene.spawnItem(this.x, this.y, options);
                        i.vy = -5;
                    }.bind(this));
                break;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        if (this.options.color == "gold") {
            this.frame["close"] = [2];
            this.frame["open"] = [2, 6, 8, "stop"];
        } else if (this.options.color == "red") {
            this.frame["close"] = [1];
            this.frame["open"] = [1, 4, 7, "stop"];
        } else if (this.options.color == "blue") {
            this.frame["close"] = [0];
            this.frame["open"] = [0, 3, 6, "stop"];
        } else {
            this.frame["close"] = [1];
            this.frame["open"] = [1, 4, 7, "stop"];
        }
        this.index = 0;
    },
});

/*
 *  mapobject.accessory.js
 *  2017/01/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//マップ装飾アクセサリ
phina.define("qft.MapObject.Accessory", {
    superClass: "qft.Character",

    id: null,

    //識別フラグ
    isMapAccessory: true,

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 2,

    isAdvanceAnimation: true,

    //地形無視
    ignoreCollision: true,

    init: function(parentScene, options) {
        this.options = (options || {}).$safe({
            width: 32,
            height: 32,
            index: 0,
        })
        this.superInit(parentScene, {width: this.options.width, height: this.options.height});

        this.id = options.id;
        this.level = options.properties.level || 0;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [2, 1, 0, 3];
        this.frame["normal2"] = [1, 0, 3, 2];
        this.index = 0;
    },
});

//ランプ
phina.define("qft.MapObject.Lamp", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this).setFrameIndex(0);
        this.sprite.setFrameTrimming(this.level * 24, 0, 24, 128);

        //アニメーション設定
        if (this.id % 2) {
            this.setAnimation("normal");
        } else {
            this.setAnimation("normal2");
        }
        this.animationInterval = 8;
    },
});

//たき火
phina.define("qft.MapObject.Bonfire", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this).setFrameIndex(0);
        this.sprite.setFrameTrimming(this.level * 24, 128, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//炎
phina.define("qft.MapObject.Flame", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(this.level * 24 + 72, 0, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//火
phina.define("qft.MapObject.Fire", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame05", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(this.level * 24 + 72, 0, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//燭台
phina.define("qft.MapObject.Candle", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame05", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(this.level * 24 + 72, 128, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//ランタン
phina.define("qft.MapObject.Lanthanum", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("accessory1", 16, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 96, 72, 32);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [0, 1, 2, 1];
        this.index = 0;
    },
});

//ランプ２
phina.define("qft.MapObject.CandleLamp", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("accessory1", 16, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 32, 72, 32);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [0, 1, 2, 1];
        this.index = 0;
    },
});

/*
 *  mapobject.block.js
 *  2017/03/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//ブロッククラス
phina.define("qft.MapObject.Block", {
    superClass: "qft.Character",

    id: null,

    //耐久力
    hp: 30,

    //識別フラグ
    isBlock: true,

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 1,

    isAdvanceAnimation: false,

    //地形無視
    ignoreCollision: true,

    init: function(parentScene, options) {
        this.options = (options || {}).$safe({
            width: 32,
            height: 32,
            index: 0,
        })
        this.superInit(parentScene, {width: this.options.width, height: this.options.height});

        this.id = options.id;

        //スプライト
        this.index = options.index;
        this.sprite = phina.display.Sprite("block", 32, 32).addChildTo(this).setFrameIndex(this.index);

        var param = {
            width: 32,
            height: 32,
            fill: "rgba(0, 0, 0, 0.0)",
            stroke: "black",
            strokeWidth: 1,
            backgroundColor: 'transparent',
        };
        this.waku = phina.display.RectangleShape(param).setPosition(0, 0);
        if (options.enableFrame) this.waku.addChildTo(this);

        //スクリプト
        if (options.properties.script) {
            var sc = "(function(app) {"+options.properties.script+"})";
            var f = eval(sc);
            this.on('enterframe', f);
        }

        this.on('dead', function() {
            this.sprite.remove();
            this.waku.remove();
            if (this.collision) this.collision.remove();
            var s = [];
            s[0] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition(-8, -8).setFrameIndex(this.index * 2 + 0);
            s[1] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition( 8, -8).setFrameIndex(this.index * 2 + 1);
            s[2] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition(-8,  8).setFrameIndex(this.index * 2 + 16 + 0);
            s[3] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition( 8,  8).setFrameIndex(this.index * 2 + 16 + 1);
            //スプライトがバラバラに壊れるよ
            (4).times(function(i) {
                s[i].update = function() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vx *= 0.9;
                    this.vy += 0.9;
                    this.rotation += this.rot;
                    this.alpha -= 0.05;
                }
                s[i].vx = 0;
                s[i].vy = -5;
            }.bind(this));
            s[0].vx = -6; s[0].rot = -3;
            s[1].vx =  6; s[1].rot =  3;
            s[2].vx = -3; s[2].rot = -3;
            s[3].vx =  3; s[3].rot =  3;
            this.tweener.clear()
                .wait(10)
                .call(function() {
                    this.remove();
                }.bind(this));
        });
    },

    update: function(e) {
        if (this.collision) {
            this.collision.x = this.x;
            this.collision.y = this.y;
        }
        if (!this.isDead) {
            //プレイヤー攻撃（固定）との当たり判定
            var pl = this.parentScene.player;
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                this.damage(pl);
            }
            //プレイヤー攻撃判定との当たり判定
            this.parentScene.playerLayer.children.forEach(function(e) {
                if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                    e.remove();
                    this.damage(e);
                }
            }.bind(this));
        }
        this.visible = true;    //点滅キャンセル
    },

    damage: function(target) {
        if (this.isDead) return;
        if (this.mutekiTime > 0) return;
        this.hp -= target.power;
        this.mutekiTime = 10;
        if (this.hp <= 0) {
            this.isDead = true;
            this.flare('dead');
            return;
        }
        var dir = 2;
        if (this.x < target.x) dir = -2;
        this.sprite.tweener.clear()
            .moveBy(dir, 0, 1)
            .moveBy(-dir, 0, 1)
            .call(function(){
                app.playSE("hit_blunt");
            });
    },

    //当たり判定の追加
    addCollision: function (layer) {
        this.collision = phina.display.RectangleShape({width: 32, height: 32})
            .addChildTo(layer)
            .setPosition(this.x, this.y)
            .setVisible(DEBUG_COLLISION);
        this.collision.alpha = 0.3;
        this.collision.vx = 0;
        this.collision.vy = 0;
        this.collision.ignore = false;
        this.collision.type = "block";
    }
});

/*
 *  mapobject.door.js
 *  2017/01/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//大型ドアクラス
phina.define("qft.MapObject.Door", {
    superClass: "qft.Character",

    id: null,

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 3,

    //地形無視
    ignoreCollision: true,

    //実行済みフラグ
    already: false,

    //ロックされているか
    isLock: false,

    init: function(parentScene, options) {
        var width = options.width || 36;
        var height = options.height || 64;
        this.superInit(parentScene, {width: width, height: height});

        //スプライト
        this.sprite = phina.display.Sprite("door", 36, 64).addChildTo(this).setFrameIndex(3);
        this.setAnimation("closed");

        this.id = options.id;
        this.isLock = options.properties.lock || false;
        this.name = options.name;
        this.enterOffset = options.properties.enterOffset || 0;
        this.sprite.visible = options.properties.visible == undefined? true: options.properties.visible;

        //ドア機能
        var properties = options.properties;
        switch (options.name) {
            //クリア
            case "clear":
                this.isLock = true;
                this.on('enterdoor', function() {
                    this.parentScene.flare('stageclear');
                });
                break;
            //マップ内移動
            case "warp":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.on('enterdoor', function() {
                    //行き先の検索
                    var next = this.findDoor(this.nextID);
                    if (!next) return;
                    this.enterPlayer();
                    this.parentScene.warp(next.x, next.y+next.offset);
                    this.tweener.clear()
                        .wait(120)
                        .call(function(){
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                });
                break;
            //マップ切り替え
            case "mapswitch":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.toLayerNumber = properties.toLayerNumber;
                this.on('enterdoor', function() {
                    var layer = this.parentScene.stageController.mapLayer[this.toLayerNumber];
                    var next = this.parentScene.stageController.findObject(this.nextID, this.toLayerNumber);
                    if (!next) return;
                    this.enterPlayer();
                    this.tweener.clear()
                        .wait(60)
                        .call(function(){
                            this.parentScene.switchMap(layer);
                            this.parentScene.player.setPosition(next.x, next.y + next.offset);
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                    this.parentScene.fg.tweener.clear().wait(30).fadeIn(30).fadeOut(30);
                });
                break;
        }
    },

    update: function(e) {
        //近くに来たら自動的に開ける
        if (this.getDistancePlayer() < 64) {
            if (!this.isLock) this.open();
        } else {
            if (this.nowAnimation == "open") {
                this.close();
            }
        }

        //プレイヤーとの当たり判定
        var pl = this.parentScene.player;
        var hit = this.hitTestElement(pl);
        if (hit && !this.isLock && !this.already) {
            if (this.name == "clear") {
                //ステージクリアの扉は無条件で入る
                this.flare('enterdoor');
                this.already = true;
            }
        }
    },

    setupAnimation: function(options) {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["opend"] = [3, "stop"];
        this.frame["closed"] = [2, "stop"];
        this.frame["open"] = [2, 1, 0, 3, "stop"];
        this.frame["close"] = [3, 0, 1, 2, "stop"];
        this.index = 0;
    },

    open: function() {
        this.setAnimation("open");
    },

    close: function() {
        this.setAnimation("close");
    },

    //プレイヤーが扉に入る
    enterPlayer: function() {
        var enterOffset = this.enterOffset;
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1")
            .setPosition(player.x, player.y)
            .addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.setAnimation("up");
        pl.tweener.clear().setUpdateType('fps')
            .moveTo(this.x, this.y+this.height/2-16+enterOffset, 15)
            .call(function() {
                pl.animation = false;
            })
            .fadeOut(15)
            .call(function() {
                pl.remove();
            });
    },

    //プレイヤーが扉から出る
    leavePlayer: function() {
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1")
            .setPosition(this.x, this.y+16)
            .addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.alpha = 0;
        pl.setAnimation("down");
        pl.tweener.clear().setUpdateType('fps')
            .fadeIn(15)
            .moveTo(player.x, player.y, 30)
            .fadeIn(10)
            .call(function() {
                player.alpha = 1;
                player.isControl = true;
                player.isMuteki = false;
                pl.remove();
            });
    },

    //他の扉を検索
    findDoor: function(id) {
        var result = null;
        this.parentScene.objLayer.children.forEach(function(e) {
            if (e instanceof qft.MapObject.Door) {
                if (e.id == id) result = e;
            }
        }.bind(this));
        return result;
    },
});

/*
 *  mapobject.floor.js
 *  2017/03/27
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//可動フロアクラス
phina.define("qft.MapObject.Floor", {
    superClass: "qft.Character",

    id: null,

    //識別フラグ
    isFloor: true,

    //重力加速度
    gravity: 0.0,

    //移動フラグ
    isActive: true,

    //プレイヤーが上に乗ってるフラグ
    isOnPlayer: false,

    //アニメーション進行可能フラグ
    isAdvanceAnimation: false,

    //地形無視
    ignoreCollision: true,

    //移動パス
    movePath: null,

    //移動パス現在時間(0-1)
    pathTime: 0,

    init: function(parentScene, options) {
        this.options = (options || {}).$safe({
            width: 32,
            height: 32,
            index: 0,
        })
        this.superInit(parentScene, {width: this.options.width, height: this.options.height});

        this.id = options.id;

        this.moveType = options.properties.moveType || "linear";
        this.moveAngle = options.properties.moveAngle || 0;
        this.moveLength = options.properties.moveLength || 0;
        this.moveRadius = options.properties.moveRadius || 64;
        this.moveSpeed = options.properties.moveSpeed || 60;
        this.moveWait = (options.properties.moveWait !== undefined)? options.properties.moveWait: 60;

        //始点と終点
        this.startX = options.x + (options.width || 16) / 2;
        this.startY = options.y + (options.height || 16) / 2;
        if (this.moveLength > 0) {
            //移動距離が設定されている場合
            var rad = this.moveAngle.toRadian();
            this.endX = this.startX + Math.cos(rad) * this.moveLength;
            this.endY = this.startY + Math.sin(rad) * this.moveLength;
        } else {
            //終点座標が設定されている場合
            this.endX = options.properties.endX || this.startX;
            this.endY = options.properties.endY || this.startY;
        }

        //円運動の場合は中心を設定（無い場合は終点を中心とする）
        if (this.moveType == "circle") {
            this.centerX = options.properties.centerX || this.endX;
            this.centerY = options.properties.centerY || this.endY;
        }

        //移動パターン
        switch (this.moveType) {
            //直線運動
            case "linear":
                this.tweener.clear()
                    .moveTo(this.endX, this.endY, this.moveSpeed, "easeInOutSine")
                    .call(function() {this.flare('moveend');}.bind(this))
                    .wait(this.moveWait)
                    .moveTo(this.startX, this.startY, this.moveSpeed, "easeInOutSine")
                    .call(function() {this.flare('movestart');}.bind(this))
                    .wait(this.moveWait)
                    .setLoop(true);
                break;
            //円運動
            case "circle":
                this.angle = 0;
                if (options.properties.counterClockWise) {
                    //反時計回り
                    this.tweener.clear()
                        .to({angle: -360}, this.moveSpeed)
                        .call(function() {this.flare('moveend');}.bind(this))
                        .set({angle: 0})
                        .setLoop(true);
                } else {
                    //時計回り
                    this.tweener.clear()
                        .to({angle: 360}, this.moveSpeed)
                        .call(function() {this.flare('moveend');}.bind(this))
                        .set({angle: 0})
                        .setLoop(true);
                    break;
                }
            //設定されたパスに沿って移動
            case "path":
                break;
        }

        //スプライト
        this.index = options.properties.index || 0;
        var sw = Math.floor(this.width / 16);
        var sh = Math.floor(this.height / 16)+32;
        var top = this.height / 2;
        for (var x = 0; x < sw; x++) {
            var idx = (x % 2) + 1;
            if (x == 0) idx = 0;
            if (x == sw-1) idx = 3;
            var s = phina.display.Sprite("floor", 16, 96)
                .addChildTo(this)
                .setFrameTrimming(this.index * 64, 32, 64, 96)
                .setFrameIndex(idx)
                .setPosition(x * 16 - this.width / 2 + 8, 16-top);
        }
    },

    update: function(e) {
        if (this.moveType == "circle") {
            var rad = this.radius.toRadian();
            this.x = this.centerX + Math.cos(rad) * this.moveRadius;
            this.y = this.centerY + Math.sin(rad) * this.moveRadius;
        } else if (this.moveType == 'path') {
        }

        //停止と再生
        if (!this.isActive) this.tweener.pause();
        if (this.isActive) this.tweener.play();

        if (this.collision) {
            this.collision.vx = this.x - this.collision.x;
            this.collision.vy = this.y - this.collision.y;
            this.collision.x = this.x;
            this.collision.y = this.y;
        }

        //プレイヤーが上に乗っているか判定
        var pl = this.parentScene.player;
        this.isOnPlayer = false;
        if (pl.floorObject && pl.floorObject.parentObject === this) {
            this.isOnPlayer = true;
            //床が下降している時のみ
            if (!pl.isJump && this.collision.vy > 0) {
                pl.y = this.y - this.height * 0.5;
            }
        }
    },

    //フロア当たり判定の追加
    addCollision: function (layer) {
        this.collision = phina.display.RectangleShape({width: this.width, height: this.height})
            .addChildTo(layer)
            .setPosition(this.x, this.y)
            .setVisible(DEBUG_COLLISION);
        this.collision.alpha = 0.3;
        this.collision.vx = 0;
        this.collision.vy = 0;
        this.collision.ignore = false;
        this.collision.type = "movefloor";
        this.collision.parentObject = this;
    },

    //移動パスの設定
    setPath: function(startX, startY, path, loop) {
        this.x = startX;
        this.y = startY;
        this.path = path;
        this.loop = loop;

        if (loop) {
            //距離計算
            var sum = 0;
            for (var i = 0; i < path.length - 1; i++) {
                var p1 = path[i];
                var p2 = path[i+1];
                p2.magnitude = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
                sum += p2.magnitude;
            }
            //終点から始点までの距離を加算
            var p1 = path[path.length - 1];
            var p2 = path[0];
            p2.magnitude = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
            sum += p2.magnitude;
            var unit = this.moveSpeed / sum;

            this.tweener.clear().wait(60);
            for (var i = 1; i < path.length; i++) {
                var p = path[i];
                var time = Math.floor(p.magnitude * unit);
                this.tweener.moveTo(startX + p.x, startY + p.y, time);
            }
            this.tweener.moveTo(startX + path[0].x, startY + path[0].y, time);
            this.tweener.setLoop(true);
        } else {
            //往路距離計算
            var sum = 0;
            for (var i = 0; i < path.length - 1; i++) {
                var p1 = path[i];
                var p2 = path[i+1];
                p2.magnitude = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
                sum += p2.magnitude;
            }
            var unit = this.moveSpeed / sum;

            //復路距離計算
            for (var i = path.length - 1; i > 0; i--) {
                var p1 = path[i];
                var p2 = path[i-1];
                p2.magnitude_ret = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
            }

            this.tweener.clear().wait(60);
            for (var i = 1; i < path.length; i++) {
                var p = path[i];
                var time = Math.floor(p.magnitude * unit);
                this.tweener.moveTo(startX + p.x, startY + p.y, time);
            }
            this.tweener.wait(60);
            for (var i = path.length - 2; i >= 0; i--) {
                var p = path[i];
                var time = Math.floor(p.magnitude_ret * unit);
                this.tweener.moveTo(startX + p.x, startY + p.y, time);
            }
            this.tweener.setLoop(true);
        }
    },
});

/*
 *  mapobject.gate.js
 *  2017/03/20
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//ワープゲート
phina.define("qft.MapObject.Gate", {
    superClass: "qft.Character",

    id: null,

    //重力加速度
    gravity: 0.0,

    //地形無視
    ignoreCollision: true,

    //実行済みフラグ
    already: false,

    //ロックされているか
    isLock: false,

    //アニメーションフラグ
    isAdvanceAnimation: false,

    init: function(parentScene, options) {
        var width = options.width || 36;
        var height = options.height || 64;
        this.superInit(parentScene, {width: width, height: height});
        this.width_half = width / 2;
        this.height_half = height / 2;

        this.id = options.id;
        this.isLock = options.properties.lock || false;
        this.name = options.name;
        this.enterOffset = options.properties.enterOffset || 0;

        //スプライト
        this.sprite = null;

        //ゲート機能
        var properties = options.properties;
        switch (options.name) {
            //マップ内移動
            case "warp":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.on('enterdoor', function() {
                    //行き先の検索
                    var next = this.findGate(this.nextID);
                    if (!next) return;
                    this.enterPlayer();
                    this.parentScene.warp(next.x, next.y+next.offset);
                    this.tweener.clear()
                        .wait(120)
                        .call(function(){
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                });
                break;
            //マップ切り替え
            case "mapswitch":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.toLayerNumber = properties.toLayerNumber;
                this.on('enterdoor', function() {
                    var layer = this.parentScene.stageController.mapLayer[this.toLayerNumber];
                    var next = this.parentScene.stageController.findObject(this.nextID, this.toLayerNumber);
                    if (!next) return;
                    this.enterPlayer();
                    this.tweener.clear()
                        .wait(60)
                        .call(function(){
                            this.parentScene.switchMap(layer);
                            this.parentScene.player.setPosition(next.x, next.y + next.offset);
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                    this.parentScene.fg.tweener.clear().wait(30).fadeIn(30).fadeOut(30);
                });
                break;
        }

        this.time = 0;
    },

    update: function() {
        //パーティクル
        if (!this.isLock && this.time % 6 == 0) {
            (2).times(function(i) {
                var sp = phina.display.Sprite("particle", 16, 16)
                    .addChildTo(this)
                    .setFrameIndex(0)
                    .setScale(0)
                    .setPosition(Math.randint(-this.width_half, this.width_half), this.height_half + Math.randint(-4, 4));
                sp.alpha = 0.3;
                sp.tweener.clear()
                    .by({y: -48, alpha:  0.9, scaleX:  0.3, scaleY:  0.3}, 1000, "easeInSine")
                    .by({y: -48, alpha: -0.9, scaleX: -0.3, scaleY: -0.3}, 1000, "easeOutSine")
                    .call(function() {
                        this.remove();
                    }.bind(sp));
            }.bind(this));
        }
    },

    //プレイヤーがゲートに入る
    enterPlayer: function() {
        var enterOffset = this.enterOffset;
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1").setPosition(player.x, player.y).addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.setAnimation("walk");
        pl.tweener.clear().setUpdateType('fps')
            .moveTo(this.x, this.y+enterOffset, 15)
            .call(function() {
                pl.animation = false;
            })
            .fadeOut(15)
            .call(function() {
                pl.remove();
            });
    },

    //プレイヤーがゲートから出る
    leavePlayer: function() {
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1").setPosition(this.x, this.y).addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.alpha = 0;
        pl.setAnimation("walk");
        pl.animation = false;
        pl.tweener.clear().setUpdateType('fps')
            .fadeIn(15)
            .moveTo(player.x, player.y, 30)
            .fadeIn(10)
            .call(function() {
                player.alpha = 1;
                player.isControl = true;
                player.isMuteki = false;
                pl.remove();
            });
    },

    //他のゲートを検索
    findGate: function(id) {
        var result = null;
        this.parentScene.objLayer.children.forEach(function(e) {
            if (e instanceof qft.MapObject.Gate) {
                if (e.id == id) result = e;
            }
        }.bind(this));
        return result;
    },
});

/*
 *  mapobject.js
 *  2017/01/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//チェックアイコン
phina.define("qft.MapObject.CheckIcon", {
    superClass: "qft.Character",

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 3,

    //地形無視
    ignoreCollision: true,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 36, height: 64});
        this.$safe(options);

        //スプライト
        this.sprite = phina.display.Sprite("checkicon", 32, 32).addChildTo(this);
        this.setAnimation("up");
        this.animationInterval = 10;
    },

    update: function(e) {
    },

    setupAnimation: function(options) {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["in"] = [2, 1, 0];
        this.frame["up"] = [5, 4, 3];
        this.frame["down"] = [8, 7, 6];
        this.frame["out"] = [11, 10, 9];
        this.index = 0;
    },
});

//メッセージ表示
phina.define("qft.MapObject.Message", {
    superClass: "phina.display.DisplayElement",

    //オブジェクトID
    id: null,

    //一回のみ表示フラグ
    once: false,

    //表示済みフラグ
    alreadyRead: false,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;
        this.id = options.id;
        this.once = options.properties.once || false;
        this.text = options.properties.text || "TEST";
    },

    update: function(e) {
        //プレイヤーとの当たり判定
        var pl = this.parentScene.player;
        var hit = this.hitTestElement(pl);
        if (hit && !this.alreadyRead) {
            this.parentScene.spawnEventMessage(this.id, this.text);
            this.alreadyRead = true;

            //一回のみの場合はリムーブ
            if (this.once) this.remove();
        }

        //判定を外れたら表示済みフラグを外す
        if (!hit && this.alreadyRead) this.alreadyRead = false;
    },
});

//イベント
phina.define("qft.MapObject.Event", {
    superClass: "phina.display.DisplayElement",

    //オブジェクトID
    id: null,

    //一回のみ表示フラグ
    once: false,

    //実行済みフラグ
    already: false,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;
        this.id = options.id;
        this.once = options.properties.once || false;
        this.properties = options.properties;
    },

    update: function(e) {
        //プレイヤーとの当たり判定
        var pl = this.parentScene.player;
        var hit = this.hitTestElement(pl);
        if (hit && !this.alreadyRead) {
            this.parentScene.spawnEventMessage(this.id, this.text);
            this.already = true;

            //一回のみの場合はリムーブ
            if (this.once) this.remove();
        }

        //判定を外れたら実行済みフラグを外す
        if (!hit && this.already) this.alreadyRead = false;
    },
});

/*
 *  mapobject.npc.js
 *  2017/08/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//冒険者
phina.define("qft.MapObject.npc", {
    superClass: "qft.Character",

    //移動速度
    speed: 2,

    //アニメーション間隔
    animationInterval: 8,

    //影表示フラグ
    isShadow: true,

    //移動フラグ
    isMove: true,

    //不動フラグ
    toFix: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 24, height: 20});
        this.superInit(parentScene, options);

        this.sprite = phina.display.Sprite("actor" + (options.properties.actor || "40"), 32, 32).addChildTo(this);
        this.sprite.scaleX = -1;

        this.speed = options.properties.speed || this.speed;
        this.isMove = (options.properties.isMove === undefined? true: options.properties.isMove);
        this.territory = options.properties.territory || null;
        this.direction = options.properties.direction || 0;
        this.text = options.properties.text;

        if (options.properties.toFix) {
            this.ignoreCollision = true;
            this.gravity = 0;
            this.isMove = false;
            this.toFix = true;
            this.one('enterframe', () => {
                this.setupFixedShadow();
            });
        }

        this.setAnimation("walk");

        this.waitTime = 0;

        this.one('enterframe', () => {
            if (!this.isMove) {
                switch (this.direction) {
                    case 0:
                        this.setAnimation("walk");
                        this.scaleX = 1;
                        break;
                    case 90:
                        this.setAnimation("down");
                        break;
                    case 180:
                        this.setAnimation("walk");
                        this.scaleX = -1;
                        break;
                    case 270:
                        this.setAnimation("up");
                        break;
                }
            }
        });
    },

    update: function() {
        if (this.waitTime == 0) {
            if (this.isMove) {
                this.moveAlgorithm();
            }

            //プレイヤー攻撃との当たり判定
            var pl = this.parentScene.player;
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                //話しかけた事になる
                this.tweener.clear()
                    .wait(5)
                    .call(()=> {
                        var scene = qft.ConversationScene(this.parentScene, this.text);
                        app.pushScene(scene);
                    });
                this.waitTime = 15;

                //向きの調整
                this.setAnimation("walk");
                if (this.x < pl.x) {
                    this.scaleX = 1;
                } else {
                    this.scaleX = -1;
                }
            }
        }

        this.waitTime--;
        if (this.waitTime < 0) this.waitTime = 0;
    },

    moveAlgorithm: function() {
        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //テリトリー指定
            if (this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }

        if (this.isOnFloor) {
            this.vx =  this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
                this.scaleX = -1;
            } else {
                this.scaleX = 1;
            }
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [36, "stop"];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
        this.frame["defense"] = [ 41, 42, 43, 44, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["drop"] = [18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.frame["clear"] = [24, 25, 26];
        this.frame["stun"] = [ 18, 19, 20];
        this.index = 0;
        return this;
    },

    //固定影表示セットアップ
    setupFixedShadow: function() {
        var that = this;
        var sc = this.width / 24;
        if (sc < 1) sc += 0.2;
        this.fixedShadowSprite = phina.display.Sprite("shadow", 24, 8)
            .addChildTo(this.parentScene.shadowLayer)
            .setAlpha(0.5)
            .setScale(sc, 1.0);
        this.fixedShadowSprite.update = function() {
            this.alpha = 0.5;
            if (that.alpha < 0.5) this.alpha = that.alpha;
            this.x = that.x;
            this.y = that.y + 16;
        }
    },
});

/*
 *  player.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Player", {
    superClass: "qft.Character",

    //識別フラグ
    isPlayer: true,

    //最大ヒットポイント
    hpMax: 100,

    //ヒットポイント
    hp: 100,

    //攻撃力
    power: 10,

    //気絶確率
    stunPower: 1,

    //防御力
    defense: 10,

    //移動速度
    speed: 5,

    //登坂速度
    speedAscend: 4,

    //下押し連続フレーム数
    downFrame: 0,

    //多段ジャンプ可能回数
    numJump: 0,
    numJumpMax: 1,

    //所持装備アイテム
    equip: null,

    //アイテム所持最大数
    maxItem: 10,

    //所持アイテム
    items: null,

    //所持クリア条件キー
    keys: null,

    //操作可能フラグ
    isControl: true,

    //攻撃中フラグ
    isAttack: false,

    //防御中フラグ
    isDefense: false,

    //ドア上フラグ
    isOnDoor: false,

    //ダミー表示スプライト
    dummy: null,

    //影表示フラグ
    isShadow: true,

    //オートパイロット
    isAuto: false,
    autoKey: {
        up: false,
        right: false,
        down: false,
        left: false,
        attack: false,
        jump: false,
    },

    //前フレームの情報
    before: {
        //操作系
        up: false,
        down: false,
        attack: false,
        jump: false,
        change: false,
        isStun: false,
        isOnFloor: false,
        x: 0,
        y: 0,
    },

    //ステージ開始時ステータス
    startStatus: null,

    init: function(parentScene) {
        this.superInit(parentScene, {width: 16, height: 20});
        var that = this;

        //スプライト背後
        this.back = phina.display.DisplayElement().addChildTo(this).setScale(-1, 1);

        //表示用スプライト
        this.sprite = phina.display.Sprite("player1", 32, 32).addChildTo(this).setFrameIndex(0);
        this.sprite.scaleX = -1;

        //武器用スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this.back)
            .setFrameIndex(0)
            .setOrigin(1, 1)
            .setPosition(3, 3);
        this.weapon.alpha = 0;
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.type = "sword";

        //盾
        this.shield = phina.display.Sprite("item", 24, 24)
//            .addChildTo(this)
            .setFrameIndex(7)
            .setPosition(10, 6)
            .setScale(0.8)
            .setVisible(false);

        //攻撃判定用
        this.attackCollision = phina.display.RectangleShape({width: 14, height: 26});
        //当たり判定デバッグ用
        if (DEBUG_COLLISION) {
            this.one('enterframe', e => {
                this.attackCollision.addChildTo(this.parentScene.playerLayer);
                this.attackCollision.alpha = 0.3;
            });
            this.on('removed', e => {
                this.attackCollision.remove();
            });
        }

        //プレイヤー情報の初期化
        this.reset();

        //はしご判定用
        this.ladderCollision = phina.display.RectangleShape({width: 16, height: 20});

        //初期アニメーション設定
        this.setAnimation("walk");
        this.beforeAnimation = "";

        //死亡時コールバック
        this.on('dead', function(e) {
            this.parentScene.flare('gameover');
        });

        //ステージ開始時ステータス
        this.saveStatus();

        //最後に床上にいた場所を保存
        this.lastOnFloorX = 0;
        this.lastOnFloorY = 0;
    },

    update: function(app) {
        if (this.parentScene.pauseScene) return;

        //オブジェクトレイヤー接触判定
        this.isOnDoor = null;
        this.parentScene.objLayer.children.forEach(function(e) {
            //扉判定
            if (e instanceof qft.MapObject.Door || e instanceof qft.MapObject.Gate) {
                if (e.hitTestElement(this)) {
                    this.isOnDoor = e;
                    return;
                }
            }
        }.bind(this));

        //死亡時は何も出来ない
        if (this.isDead) {
            //マップ外落下
            if (this.isDrop) {
                this.hp = 0;
                this.setAnimation("drop");
            }
            return;
        }

//        this.shield.setVisible(false);
//        this.isDefense = false;

        //プレイヤー操作
        var ct = app.controller;
        //バーチャルパッド情報取得
        var vp = app.virtualPad;
        if (vp.getKey("up")) ct.up = true;
        if (vp.getKey("right")) ct.right = true;
        if (vp.getKey("down")) ct.down = true;
        if (vp.getKey("left")) ct.left = true;
        if (vp.getKey("Z")) ct.attack = true;
        if (vp.getKey("X")) ct.jump = true;

        //オートパイロット
        if (this.isAuto) {
            ct = this.autoKey;
        }

        if (!this.isControl) ct = {};
        if (this.stopTime == 0) {
            //左移動
            if (ct.left && !ct.down) {
                if (!this.isJump && !this.isAttack && !this.isCatchLadder) this.setAnimation("walk");
                //はしご掴み状態で左に壁がある場合は不可
                var c = this._collision[3];
                if (!(this.isCatchLadder && this.checkMapCollision2(c.x+6, c.y, c.width, c.height))) {
                    this.scaleX = -1;
                    this.vx = -this.speed;
                }
            }
            //右移動
            if (ct.right && !ct.down) {
                if (!this.isJump && !this.isAttack && !this.isCatchLadder) this.setAnimation("walk");
                //はしご掴み状態で右に壁がある場合は不可
                var c = this._collision[1];
                if (!(this.isCatchLadder && this.checkMapCollision2(c.x-6, c.y, c.width, c.height))) {
                    this.scaleX = 1;
                    this.vx = this.speed;
                }
            }

            //頭上足元はしご検知
            var headLadder = this.checkHeadLadder();
            var footLadder = this.checkFootLadder();

            //はしご掴み状態で操作分岐
            if (this.isCatchLadder) {
                if (ct.up) {
                    this.vx = 0;
                    this.vy = -this.speedAscend;
                    var c = this._collision[0];
                    if (!headLadder && this.checkMapCollision2(c.x, c.y-6, c.width, c.height)) {
                        this.vy = 0;
                    }
                }
                if (ct.down) {
                    this.vx = 0;
                    this.vy = this.speedAscend;
                }
            } else {
                //ジャンプボタンのみ
                if (ct.jump && !ct.up) {
                    //ジャンプ二段目以降
                    if (this.isJump && this.numJump < this.numJumpMax && this.vy > -5) {
                        this.vy = -11;
                        this.numJump++;
                    }
                    //ジャンプ
                    var chk = this.checkMapCollision2(this.x, this.y-16, 5, 3);
                    if (!this.isJump && this.isOnFloor && !chk) {
                        this.setAnimation("jump");
                        this.isJump = true;
                        this.vy = -11;
                        this.numJump = 1;
                    }
                }
                //上キー押下
                if (ct.up) {
                    //ジャンプ二段目以降
                    if (this.isJump && this.numJump < this.numJumpMax && this.vy > -5) {
                        this.vy = -11;
                        this.numJump++;
                    }
                    //ジャンプ
                    var chk = this.checkMapCollision2(this.x, this.y-16, 5, 3);
                    if (!this.isJump && this.isOnFloor && !this.isOnLadder && !chk) {
                        this.setAnimation("jump");
                        this.isJump = true;
                        this.vy = -11;
                        this.numJump = 1;
                    }
                    //はしごを昇る（階段は接地時のみ）
                    if (this.isOnLadder && !this.isOnStairs || this.isOnFloor && this.isOnStairs) {
                        this.setAnimation("up");
                        this.vx = 0;
                        this.vy = 0;
                        this.isCatchLadder = true;
                        this.throughFloor = null;
                    }
                    //扉に入る（接地時＆左右キーオフ時のみ）
                    if (!ct.left && !ct.right && this.isOnFloor && this.isOnDoor && !this.isOnDoor.isLock && !this.isOnDoor.already) {
                        this.vx = 0;
                        this.vy = 0;
                        this.isOnDoor.flare('enterdoor');
                        this.isOnDoor.already = false;
                    }
                }
                //下キー押下
                if (ct.down) {
                    //はしごを降りる
                    if (footLadder) {
                        this.setAnimation("up");
                        this.vx = 0;
                        this.vy = 0;
                        this.isCatchLadder = true;
                        this.throughFloor = null;
                    }
                    //床スルー
                    if (this.downFrame > 6 && !this.jump && !footLadder) {
                        if (this.isOnFloor && !this.throughFloor) {
                            var floor = this.checkMapCollision2(this.x, this.y+16, 5, 5);
                            if (floor && floor[0].enableThrough) this.throughFloor = floor[0];
                        }
                    }
                    //盾を構える
                    if (!this.isAttack) {
//                        this.shield.setVisible(true);
//                        this.isDefense = true;
//                        this.setAnimation("defense");
                    }
                }
            }

        }

        //はしごから外れたら梯子掴み状態キャンセル
        if (this.isCatchLadder) {
            if (!this.isOnLadder && !ct.down || this.isOnLadder && !footLadder && !ct.up) {
                this.isCatchLadder = false;
            }
        }

        //攻撃
        if (!this.isAttack) {
            if (this.isOnFloor) {
                if (this.nowAnimation != "damage" && !this.isDefense) this.setAnimation("walk");
            } else if (this.isCatchLadder) {
                if (ct.up) {
                    this.setAnimation("up");
                } else if (ct.down) {
                    if (this.isOnStairs) {
                        this.setAnimation("down");
                    } else {
                        this.setAnimation("up");
                    }
                }
            } else {
                if (!this.isStun && !this.isDead) this.setAnimation("jump");
            }
            if (ct.attack && !this.before.attack && this.stopTime == 0 && !(this.isCatchLadder && this.isOnLadder)) {
                this.isCatchLadder = false;
                this.setAnimation("attack");
                this.weaponAttack();
            }

            //武器の変更
            if (ct.change && !this.before.change && this.equip.switchOk) {
                this.switchWeapon();
            }
        }

        //気絶状態
        if (this.isStun) {
            this.setAnimation("stun");

            //梯子掴みキャンセル
            this.isCatchLadder = false;

            //レバガチャで気絶復帰を早める
            if (ct.left && !ct.before.left ||
                ct.right && !ct.before.right ||
                ct.up && !ct.before.up ||
                ct.down && !ct.before.down) this.stopTime -= 2;
        } else if (this.before.isStun) {
            //気絶復帰したらアニメーションを標準に
            this.setAnimation("stand");
        }

        //死亡状態
        if (this.isDead) {
            this.setAnimation("dead");
            this.isCatchLadder = false;
        }

        //アニメーション変更を検知
        if (this.nowAnimation != this.beforeAnimation) {
            this.time = 0;
            this.isAdvanceAnimation = true;
            this.animationInterval = 6;
            if (this.nowAnimation == "attack") this.animationInterval = 2;
            if (this.nowAnimation == "defense") this.animationInterval = 1;
        } else {
            //歩行アニメーションの場合は移動している時のみ進める
            if (this.nowAnimation == "walk" && !ct.left && !ct.right) {
                this.isAdvanceAnimation = false;
            } else {
                this.isAdvanceAnimation = true;
            }
            if (this.nowAnimation == "up" || this.nowAnimation == "down") {
                if (ct.up || ct.down || ct.left || ct.right) {
                    this.isAdvanceAnimation = true;
                } else {
                    this.isAdvanceAnimation = false;
                }
            }
        }

        //攻撃判定追従
        this.attackCollision.x = this.x + this.scaleX * 12;
        this.attackCollision.y = this.y;

        //コントローラ他情報保存
        this.before.up = ct.up;
        this.before.down = ct.down;
        this.before.attack = ct.attack;
        this.before.jump = ct.up || ct.jump;
        this.before.change = ct.change;
        this.before.isStun = this.isStun;
        this.before.inOnFloor = this.isOnFloor;
        this.before.x = this.x;
        this.before.y = this.y;

        //ダウンキー連続押下フレームカウント
        if (this.isOnFloor && !this.isCatchLadder && ct.down && !ct.right && !ct.left && !ct.up && !ct.attack) {
            this.downFrame++;
        } else {
            this.downFrame = 0;
        }

        //接地時座標保存
        if (this.isOnFloor && this._collision[2].hit.type != "movefloor") {
            this.lastOnFloorX = this.x;
            this.lastOnFloorY = this.y;
        }
    },

    //プレイヤー情報リセット
    reset: function() {
        //移動情報
        this.vx = 0;
        this.vy = 0;

        //ステータス
        this.hp = this.hpMax;

        //各種フラグ
        this.isJump = false;
        this.isDead = false;
        this.isCatchLadder = false;
        this.isDrop = false;
        this.isOnFloor = false;
        this.isAdvanceAnimation = true;
        this.ignoreCollision = false;

        //経過時間系
        this.mutekiTime = 0;
        this.stopTime = 0;
        this.downFrame = 0;
        this.time = 0;

        //アニメーション
        this.setAnimation("walk");
        this.beforeAnimation = "";
        this.animationInterval = 6;

        //所持装備
        this.equip = {
            using: 0,         //現在使用中（weaponsのindex）
            weapons: [0],     //所持リスト（最大３）
            level: [0],       //武器レベル
            switchOk: true,   //変更可能フラグ
        };

        //武器セット
        this.setWeapon(this.equip.weapons[this.equip.using]);

        //所持アイテム
        this.items = [];

        //所持クリア条件キー
        this.keys = [];

        //操作可能フラグ
        this.isControl = true;

        //多段ジャンプ最大回数
        this.numJumpMax = 0;

        //ダミースプライト除去
        if (this.dummy) {
            this.dummy.remove();
            this.dummy = null;
        }

        return this;
    },

    //プレイヤー情報コンティニュー用リセット
    continueReset: function() {
        //移動情報
        this.vx = 0;
        this.vy = 0;

        //ステータス
        this.hp = this.hpMax;

        //各種フラグ
        this.isJump = false;
        this.isDead = false;
        this.isCatchLadder = false;
        this.isDrop = false;
        this.isOnFloor = false;
        this.isAdvanceAnimation = true;
        this.ignoreCollision = false;

        //経過時間系
        this.mutekiTime = 0;
        this.stopTime = 0;
        this.downFrame = 0;
        this.time = 0;

        //アニメーション
        this.setAnimation("walk");
        this.beforeAnimation = "";
        this.animationInterval = 6;

        //操作可能フラグ
        this.isControl = true;

        //多段ジャンプ最大回数
        this.numJumpMax = 0;

        //ダミースプライト除去
        if (this.dummy) {
            this.dummy.remove();
            this.dummy = null;
        }
        this.sprite.visible = true;

        return this;
    },

    //ダメージ処理
    damage: function(target) {
        if (this.mutekiTime > 0) return false;
        if (target.power == 0) return false;
        if (this.isDead) return false;
        if (this.isMuteki) return false;

        //気絶キャンセル
        this.isStun = false;

        var dir = 0;
        if (this.x < target.x) dir = 180;
        if (!this.isCatchLadder) this.knockback(target.power, dir);

        this.hp -= target.power;
        this.isCatchLadder = false;
        app.playSE("damage");

        if (this.hp <= 0) {
            this.dead();
        } else {
            this.mutekiTime = 60;
            this.stopTime = 15;
            if (this.nowAnimation != "jump") this.setAnimation("damage");

            //気絶判定
            var dice = Math.randint(1, 100);
            if (dice <= target.stunPower) {
                this.flare('stun', {power: 10});
                this.setAnimation("stun");
            }
        }
        return true;
    },

    //死亡時処理
    dead: function() {
        this.hp = 0;
        this.isDead = true;
        this.isCatchLadder = false;
        this.vx = 0;
        this.vy = -6;
        var tw = phina.accessory.Tweener().attachTo(this).setUpdateType('fps');
        tw.clear()
            .wait(60)
            .call(function(){
                this.flare('dead');
                tw.remove();
            }.bind(this));

        //ダミースプライト追加
        this.sprite.visible = false;
        this.dummy = qft.PlayerDummy("player1").addChildTo(this).setAnimation("dead");
    },

    //アイテム取得
    getItem: function(item) {
        //武器
        if (item.isWeapon) {
            //既に持っている武器かチェック
            var index = this.equip.weapons.findIndex(function(e, i, a) {
                return e == item.kind;
            });
            if (index == null || index == -1) {
                //持って無い武器だった場合
                if (this.equip.weapons.length < 3) {
                    //リストに追加
                    this.equip.weapons.push(item.kind);
                    this.equip.level.push(item.level);
                } else {
                    //現在使用武器の手前の武器を捨てる
                    var dropIndex = this.equip.using == 0? 2: this.equip.using - 1;
                    var options = {
                        properties: {
                            kind: this.equip.weapons[dropIndex],
                            level: this.equip.level[dropIndex],
                        },
                    };
                    var drop = this.parentScene.spawnItem(this.x, this.y, options);
                    drop.friction = 0.8;
                    drop.vx = 0 * -this.scaleX;
                    drop.vy = -5;
                    drop.throwAway = true;
                    this.equip.weapons[dropIndex] = item.kind;
                    this.equip.level[dropIndex] = item.level;
                }
            } else {
                //所持武器を拾ったらその武器のレベルが上がる
                this.equip.level[index]++;
                var id = this.equip.weapons[this.equip.using];
                var lv = this.equip.level[this.equip.using];
                this.setWeapon(id, lv);
            }
            app.playSE("getitem");
        }
        //装備品
        if (item.isEquip) {
            this.hpMax += (item.power || 0);
            this.hp += (item.power || 0);
            if (this.hpMax > 200) this.hpMax = 200;
            if (this.hp > this.hpMax) this.hp = this.hpMax;
            this.parentScene.totalScore += (item.point || 0);
            app.playSE("getitem");
        }
        //食べ物
        if (item.isFood) {
            //ステージ進度によって回復量が増加
            var power = item.power;
            if (this.parentScene.stageNumber > 4) power *= 1.5;
            this.hp += power;
            app.playSE("recovery");
            if (this.hp > this.hpMax) this.hp = this.hpMax;
            this.parentScene.totalScore += (item.point || 0);
        }
        //鍵
        if (item.isKey) {
            this.keys.push(item);
            app.playSE("getkeyitem");
            this.parentScene.flare('getkey', {key: item});
            this.parentScene.totalScore += (item.point || 0);
        }
        //得点アイテム
        if (item.isItem) {
            this.parentScene.totalScore += (item.point || 0);
            app.playSE("getitem");
        }
        return this;
    },

    //使用武器の変更
    switchWeapon: function() {
        //手持ちの武器が一個の場合は何もしない
        if (this.equip.weapons.length < 2) return;

        this.equip.switchOk = false;

        var rot = 120;
        if (this.equip.weapons.length == 2 && this.equip.using == 1) rot = 240;
        this.parentScene.playerWeapon.tweener.clear()
            .by({rotation: rot}, 300)
            .call(function() {
                this.equip.switchOk = true;
            }.bind(this));

        //現在使用武器設定
        this.equip.using = (this.equip.using + 1) % this.equip.weapons.length;
        var id = this.equip.weapons[this.equip.using];
        var lv = this.equip.level[this.equip.using];
        this.setWeapon(id, lv);

        app.playSE("select");
    },

    //武器変更
    setWeapon: function(kind, level) {
        kind = kind || 0;
        level = level || 0;

        //属性初期化
        this.attackCollision.$extend({
            isSlash: false,
            isSting: false,
            isBlow: false,
            isArrow: false,
            isFire: false,
            isIce: false,
            stunPower: 1,
        });

        //アイテム情報取得
        var spec = qft.ItemInfo.get(kind);
        this.attackCollision.$extend(spec);
        this.attackCollision.power += level * (spec.levelBonus || 2);

        switch (kind) {
            case 0:
                //ショートソード
                level = 0;
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
            case 1:
                //ロングソード
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
            case 2:
                //斧
                this.frame["attack"] = [ 44, 44, 44, 43, 43, 43, 42, 42, 42, 41, 41, 41, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
            case 3:
                //槍
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(0, 0);
                break;
            case 4:
                //弓
                level = 0;
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(0, 0);
                break;
            case 5:
                //魔法の杖
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(0, 0);
                break;
            case 6:
                //魔導書
                this.frame["attack"] = [ 44, 44, 44, 43, 43, 43, 42, 42, 42, 41, 41, 41, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
        }

        //武器画像設定
        var index = kind * 10 + Math.min(level, spec.maxIndex);
        this.weapon.setFrameIndex(index);

        return this;
    },

    //装備武器により攻撃モーションを変える
    weaponAttack: function() {
        var kind = this.equip.weapons[this.equip.using];
        var level = this.equip.level[this.equip.using];
        this.isAttack = true;
        var that = this;
        switch (kind) {
            case 0:
                //ショートソード
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 200, alpha: 1.0})
                    .to({rotation: 360}, 5)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 1:
                //ロングソード
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 200, alpha: 1.0})
                    .to({rotation: 360}, 6)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 2:
                //斧
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 400, alpha: 1.0})
                    .to({rotation: 270}, 8)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 3:
                //槍
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: -45, alpha: 1.0})
                    .by({x: -10}, 2)
                    .by({x: 10}, 2)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 4:
                //弓
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: -45, alpha: 1.0})
                    .by({x: 7}, 3)
                    .by({x: -7}, 3)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                    var arrowPower = 5 + level * 2;
                    var arrow = qft.PlayerAttack(this.parentScene, {width: 15, height: 10, power: arrowPower, type: "arrow"})
                        .addChildTo(this.parentScene.playerLayer)
                        .setScale(this.scaleX, 1)
                        .setPosition(this.x, this.y);
                    arrow.tweener.setUpdateType('fps').clear()
                        .by({x: (150 + level * 5) * this.scaleX}, 7)
                        .call(function() {
                            this.remove();
                        }.bind(arrow));
                break;
            case 5:
                //魔法の杖
                app.playSE("bomb");
                this.weapon.tweener.clear()
                    .set({rotation: 200, alpha: 1.0})
                    .to({rotation: 360}, 8)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                var magicPower = 15 + level * 2;
                for (var i = 0; i < 6; i++) {
                    var magic = qft.PlayerAttack(this.parentScene, {width: 15, height: 10, index: 30, power: magicPower, type: "flame"})
                        .addChildTo(this.parentScene.playerLayer)
                        .setScale(this.scaleX, 1);
                    magic.rad = (90 - i * 30).toRadian();
                    magic.isCollision = false;
                    magic.visible = false;
                    magic.tweener.setUpdateType('fps').clear()
                        .wait(i)
                        .call(function() {
                            this.isCollision = true;
                            this.visible = true;
                            var mx = Math.cos(this.rad) * that.scaleX;
                            var my = Math.sin(this.rad);
                            this.setPosition(that.x + 32 * mx, that.y + 32 * my);
                        }.bind(magic))
                        .wait(8)
                        .call(function() {
                            this.remove();
                        }.bind(magic));
                }
                break;
            case 6:
                //魔導書
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 400, alpha: 1.0})
                    .to({rotation: 270}, 8)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
        }
        return this;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [36, "stop"];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
        this.frame["defense"] = [ 41, 42, 43, 44, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["drop"] = [18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.frame["clear"] = [24, 25, 26];
        this.frame["stun"] = [ 18, 19, 20];
        this.index = 0;
        return this;
    },

    //当たり判定用エレメントの位置再セット
    resetCollisionPosition: function() {
        var w = Math.floor(this.width/2)+6;
        var h = Math.floor(this.height/2)+6;
        this._collision[0].setPosition(this.x, this.y - h);
        this._collision[1].setPosition(this.x + w, this.y - 5);
        this._collision[2].setPosition(this.x, this.y + h);
        this._collision[3].setPosition(this.x - w, this.y - 5);
        this.ladderCollision.setPosition(this.x, this.y);
        return this;
    },

    //頭上はしごチェック
    checkHeadLadder: function() {
        var h = Math.floor(this.height/2)+10;
        var c = phina.display.DisplayElement({width: 16, height: 2}).setPosition(this.x, this.y-h);
        var ret = null;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.hitTestElement(c)) {
                if (e.type == "ladder" || e.type == "stairs") ret = e;
            }
        }.bind(this));
        return ret;
    },

    //足下はしごチェック
    checkFootLadder: function() {
        var h = Math.floor(this.height/2)+10;
        var c = phina.display.DisplayElement({width: 16, height: 2}).setPosition(this.x, this.y+h);
        var ret = null;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.hitTestElement(c)) {
                if (e.type == "ladder" || e.type == "stairs") ret = e;
            }
        }.bind(this));
        return ret;
    },

    //現在ステータス保存
    saveStatus: function() {
        //所持武器、アイテム等ステータスの取得
        var eq = this.equip;
        var equip = {
            using: 0,
            weapons: eq.weapons.concat(),
            level: eq.level.concat(),
            switchOk: true,
        };
        var items = this.items.concat();
        var numJumpMax = this.numJumpMax;

        this.startStatus = {
            hpMax: this.hpMax,
            hp: this.hp,
            power: this.power,
            defense: this.defense,
            equip: equip,
            items: items,
            numJumpMax: numJumpMax,
        };
    },

    //ステータス復元
    restoreStatus: function() {
        var ss = this.startStatus;
        this.hpMax = ss.hpMax;
        this.hp = ss.hp;
        this.power = ss.power;
        this.defense = ss.defense;
        this.equip = {
            using: 0,
            weapons: ss.equip.weapons.concat(),
            level: ss.equip.level.concat(),
            switchOk: true,
        }
        if (ss.items) {
            this.items = ss.items.concat();
        } else {
            this.item = [];
        }
        this.numJumpMax = ss.numJumpMax;

        var id = this.equip.weapons[this.equip.using];
        var lv = this.equip.level[this.equip.using];
        this.setWeapon(id, lv);
    },
});

//プレイヤー攻撃判定
phina.define("qft.PlayerAttack", {
    superClass: "phina.display.DisplayElement",

    //攻撃力
    power: 1,

    //当たり判定発生フラグ
    isCollision: true,

    //属性
    isSlash: false,
    isSting: false,
    isBlow: false,
    isArrow: false,
    isFire: false,
    isIce: false,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;

        this.type = options.type || "arrow";
        this.power = options.power || 0;
        this.time = 0;
        this.index = 0;

        //表示スプライト
        switch (this.type) {
            case "arrow":
                this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(1);
                this.frame = [1];
                this.isArrow = true;
                this.isSting = true;
                this.stunPower = 10;
                break;
            case "fireball":
                this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(9);
                this.frame = [9, 10, 11, 10];
                this.isFire = true;
                break;
            case "masakari":
                this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(20);
                this.frame = [20];
                this.isSlash = true;
                this.isBrow = true;
                this.stunPower = 50;
                break;
            case "dagger":
                this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(20);
                this.sprite.rotation = 135;
                this.frame = [0];
                this.isSting = true;
                this.stunPower = 1;
                break;
            case "flame":
                this.sprite = phina.display.Sprite("effect", 48, 48)
                    .addChildTo(this)
                    .setFrameTrimming(0, 192, 192, 96)
                    .setScale(0.5);
                this.frame = [0, 1, 2, 3, 4, 5, 6, 7, 8];
                this.isFire = true;
                this.stunPower = 1;
                break;
        }

        if (DEBUG_COLLISION) {
            phina.display.RectangleShape({width: this.width, height: this.height}).addChildTo(this).setAlpha(0.5);
        }
    },

    update: function(app) {
        if (!this.isCollision || this.type == "explode") return;

        if (this.time % 3 == 0) {
            this.sprite.setFrameIndex(this.frame[this.index]);
            this.index = (this.index + 1) % this.frame.length;
        }
        if (this.type == "flame") return;

        //地形接触判定
        var that = this;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.type == "ladder" || e.type == "stairs") return;
            if (this.hitTestElement(e)) {
                this.isCollision = false;
                switch (this.type) {
                    case "arrow":
                        this.stick(e);
                        break;
                    case "fireball":
                        this.explode(e);
                        break;
                }
            }
        }.bind(this));

        this.time++;
    },

    //ヒット後処理
    hit: function(target) {
        switch (this.type) {
            case "fireball":
                this.explode(target);
                break;
        }
    },

    //刺さる
    stick: function(e) {
        //効果音
        switch (this.type) {
            case "arrow":
                app.playSE("arrowstick");
                break;
            case "masakari":
                break;
        }

        if (this.scaleX == 1) {
            this.x = e.left;
        } else {
            this.x = e.right;
        }
        this.tweener.clear()
            .wait(30)
            .call(function() {
                this.remove();
            }.bind(this));
    },

    //弾かれる
    snap: function(e) {
        //効果音
        app.playSE("tinkling");
        this.tweener.clear()
            .by({y: -92, rotation: 700}, 15, "easeOutQuad")
            .call(function() {
                this.remove();
            }.bind(this));
    },

    //爆発
    explode: function(e) {
        this.parentScene.spawnEffect(this.x, this.y);
        app.playSE("bomb");
        this.remove();
    },
});

//プレイヤーダミースプライト
phina.define("qft.PlayerDummy", {
    superClass: "phina.display.Sprite",

    init: function(assetName) {
        this.superInit(assetName, 32, 32);
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["walk_stop"] = [ 3,  4,  5,  4, "stop"];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["up_stop"] =   [10, "stop"];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["clear"] = [24, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.index = 0;

        this.nowAnimation = "stand";
        this.animation = true;

        this.bx = 0;
        this.by = 0;
        this.time = 0;

        //影の追加
        var that = this;
        var sc = 16 / 24;
        if (sc < 1) sc += 0.2;
        this.shadowSprite = phina.display.Sprite("shadow", 24, 8)
            .addChildTo(this)
            .setAlpha(0.5)
            .setScale(sc, 1.0)
            .setPosition(0, 16);
    },

    update: function() {
        if (this.animation && this.time % 6 == 0) {
            this.index = (this.index+1) % this.frame[this.nowAnimation].length;
            if (this.frame[this.nowAnimation][this.index] == "stop") this.index--;
            this.frameIndex = this.frame[this.nowAnimation][this.index];
        }

        if (this.x < this.bx) this.scaleX = 1;
        if (this.x > this.bx) this.scaleX = -1;
        this.bx = this.x;
        this.by = this.y;

        this.time++;
    },

    setAnimation: function(animName) {
        if (!this.frame[animName]) return;
        if (animName == this.nowAnimation) return;
        this.nowAnimation = animName;
        this.index = -1;
        return this;
    },
});

//プレイヤー現在使用武器表示
phina.define("qft.PlayerWeapon", {
    superClass: "phina.display.DisplayElement",

    init: function(player) {
        this.superInit();
        this.player = player;

        var that = this;
        this.base = phina.display.DisplayElement().addChildTo(this);
        this.base.update = function() {
            this.rotation = -that.rotation;
        }
        var param = {
            width: 25,
            height: 25,
            fill: "rgba(0,0,0,0.0)",
            stroke: "yellow",
            strokeWidth: 2,
            backgroundColor: 'transparent',
        };
        //使用中武器
        phina.display.RectangleShape(param).addChildTo(this.base).setPosition(0, -18);
        //捨てちゃう武器
        this.dropFrame = phina.display.RectangleShape({stroke: "red"}.$safe(param))
            .addChildTo(this.base)
            .setPosition(14, 10)
            .setVisible(false);
        this.dropFrame.update = function() {
            if (that.player.equip.weapons.length < 3) {
                this.visible = false;
            } else {
                this.visible = true;
            }
        }

        //武器リスト（３つ）
        this.weapons = [];
        var rad = 0;
        var rad_1 = (Math.PI*2) / 3;
        (3).times(function(i) {
            var x =  Math.sin(rad)*18;
            var y = -Math.cos(rad)*18;
            rad -= rad_1;
            this.weapons[i] = phina.display.Sprite("weapons", 24, 24)
                .addChildTo(this)
                .setPosition(x, y);
            this.weapons[i].index = i;
            this.weapons[i].update = function() {
                this.rotation = -that.rotation;
                var weapons = that.player.equip.weapons;
                if (this.index < weapons.length) {
                    var kind = that.player.equip.weapons[this.index];
                    var level = that.player.equip.level[this.index];
                    var spec = qft.ItemInfo.get(kind);
                    var index = kind * 10 + Math.min(level, spec.maxIndex);
                    this.setFrameIndex(index);
                    this.visible = true;
                } else {
                    this.visible = false;
                }
            }
            var labelParam = {
                fill: "white",
                stroke: "black",
                strokeWidth: 2,

                fontFamily: "Orbitron",
                align: "center",
                baseline: "middle",
                fontSize: 10,
                fontWeight: ''
            };
            //強化レベル表示
            this.weapons[i].level = phina.display.Label({text: ""}.$safe(labelParam)).setPosition(6, 6).addChildTo(this.weapons[i]);
            this.weapons[i].level.index = i;
            this.weapons[i].level.update = function() {
                var level = that.player.equip.level[this.index];
                if (level != 0) {
                    this.text = "+"+level;
                } else {
                    this.text = "";
                }
            }
        }.bind(this));
    },

    clear: function() {
    },
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAwMF9wbHVnaW5zL3BoaW5hLmFzc2V0bG9hZGVyZXguanMiLCIwMDBfcGx1Z2lucy9waGluYS5leHRlbnNpb24uanMiLCIwMDBfcGx1Z2lucy9waGluYS50aWxlZG1hcC5qcyIsIjAwMF9wbHVnaW5zL3BoaW5hLnZpcnR1YWxwYWQuanMiLCIwMDBfcGx1Z2lucy9zb3VuZHNldC5qcyIsIjAwMV9hcHAvYXBwbGljYXRpb24uanMiLCIwMDFfYXBwL2Fzc2V0cy5qcyIsIjAwMV9hcHAvYmVucmkuanMiLCIwMDFfYXBwL21haW4uanMiLCIwMDJfc2NlbmUvY29uZmlnc2NlbmUuanMiLCIwMDJfc2NlbmUvY29udmVyc2F0aW9uc2NlbmUuanMiLCIwMDJfc2NlbmUvY3JlZGl0c2NlbmUuanMiLCIwMDJfc2NlbmUvZW5kaW5nc2NlbmUuanMiLCIwMDJfc2NlbmUvZW5kaW5nc2NlbmUudHJ1ZWVuZGluZy5qcyIsIjAwMl9zY2VuZS9nYW1lb3ZlcnNjZW5lLmpzIiwiMDAyX3NjZW5lL2xvYWRpbmdzY2VuZS5qcyIsIjAwMl9zY2VuZS9tYWluc2NlbmUuanMiLCIwMDJfc2NlbmUvbWVudXNjZW5lLmpzIiwiMDAyX3NjZW5lL21lbnVzY2VuZV8uanMiLCIwMDJfc2NlbmUvbWVzc2FnZXNjZW5lLmpzIiwiMDAyX3NjZW5lL29wZW5pbmdzY2VuZS5qcyIsIjAwMl9zY2VuZS9wcmFjdGljZXNjZW5lLmpzIiwiMDAyX3NjZW5lL3NjZW5lZmxvdy5qcyIsIjAwMl9zY2VuZS9zcGxhc2hzY2VuZS5qcyIsIjAwMl9zY2VuZS90aXRsZXNjZW5lLmpzIiwiMDAyX3NjZW5lL3R1dG9yaWFsc2NlbmUuanMiLCIwMDNfc3RhZ2Uvc3RhZ2UxLmpzIiwiMDAzX3N0YWdlL3N0YWdlMTAuanMiLCIwMDNfc3RhZ2Uvc3RhZ2UyLmpzIiwiMDAzX3N0YWdlL3N0YWdlMy5qcyIsIjAwM19zdGFnZS9zdGFnZTQuanMiLCIwMDNfc3RhZ2Uvc3RhZ2U1LmpzIiwiMDAzX3N0YWdlL3N0YWdlNi5qcyIsIjAwM19zdGFnZS9zdGFnZTcuanMiLCIwMDNfc3RhZ2Uvc3RhZ2U4LmpzIiwiMDAzX3N0YWdlL3N0YWdlOS5qcyIsIjAwM19zdGFnZS9zdGFnZTk5OS5qcyIsIjAwM19zdGFnZS9zdGFnZWNvbnRyb2xsZXIuanMiLCIwMDNfc3RhZ2Uvc3RhZ2VlbmRpbmcuanMiLCIwMDRfY2hhcmFjdGVyL2NoYXJhY3Rlci5iYWxsb29uLmpzIiwiMDA0X2NoYXJhY3Rlci9jaGFyYWN0ZXIuanMiLCIwMDRfY2hhcmFjdGVyL2VmZmVjdC5qcyIsIjAwNF9jaGFyYWN0ZXIvZW5lbXkuYWR2ZW50dXJlci5qcyIsIjAwNF9jaGFyYWN0ZXIvZW5lbXkuYXJjaGRlbW9uLmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5hcmNoa25pZ2h0LmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5hcmNobWFnZS5qcyIsIjAwNF9jaGFyYWN0ZXIvZW5lbXkuYmFieWRlbW9uLmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5iaXJkLmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5idWxsZXQuanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15LmRlYXRoLmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5kZW1vbi5qcyIsIjAwNF9jaGFyYWN0ZXIvZW5lbXkuZGV2aWwuanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15LmV4cGxvZGUuanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15LmZpcmViaXJkLmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5mbGFtZS5qcyIsIjAwNF9jaGFyYWN0ZXIvZW5lbXkuZ2FydWRhLmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5ncmVhdGVyZGVtb24uanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15LmludGVsbGlnZW50c3dvcmQuanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15LmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5rbmlnaHQuanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15Lm1hZ2UuanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15Lm1hZ2ljZGFnZ2VyLmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5vZ3JlLmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5vcm9jaGkuanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15LnNsaW1lLmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5zbmFrZS5qcyIsIjAwNF9jaGFyYWN0ZXIvZW5lbXkudGl0YW4uanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15Lndpc3AuanMiLCIwMDRfY2hhcmFjdGVyL2VuZW15LndpemFyZC5qcyIsIjAwNF9jaGFyYWN0ZXIvaXRlbS5qcyIsIjAwNF9jaGFyYWN0ZXIvaXRlbWJveC5qcyIsIjAwNF9jaGFyYWN0ZXIvbWFwb2JqZWN0LmFjY2Vzc29yeS5qcyIsIjAwNF9jaGFyYWN0ZXIvbWFwb2JqZWN0LmJsb2NrLmpzIiwiMDA0X2NoYXJhY3Rlci9tYXBvYmplY3QuZG9vci5qcyIsIjAwNF9jaGFyYWN0ZXIvbWFwb2JqZWN0LmZsb29yLmpzIiwiMDA0X2NoYXJhY3Rlci9tYXBvYmplY3QuZ2F0ZS5qcyIsIjAwNF9jaGFyYWN0ZXIvbWFwb2JqZWN0LmpzIiwiMDA0X2NoYXJhY3Rlci9tYXBvYmplY3QubnBjLmpzIiwiMDA0X2NoYXJhY3Rlci9wbGF5ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDelJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ255QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcFRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0WEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0dEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDak5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOW5CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN1NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaktBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4UkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbGFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoicWZ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqICBwaGluYS5hc3NldGxvYWRlcmV4LmpzXG4gKiAgMjAxNi8xMS8yNVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmV4dGVuc2lvbiA9IHBoaW5hLmV4dGVuc2lvbiB8fCB7fTtcblxuLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4njgafjgqLjgrvjg4Pjg4joqq3jgb/ovrzjgb9cbnBoaW5hLmRlZmluZShcInBoaW5hLmV4dGVuc2lvbi5Bc3NldExvYWRlckV4XCIsIHtcblxuICAgIC8v6YCy5o2XXG4gICAgbG9hZHByb2dyZXNzOiAwLFxuXG4gICAgLy/oqq3jgb/ovrzjgb/ntYLkuobjg5Xjg6njgrBcbiAgICBsb2FkY29tcGxldGU6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIGxvYWQ6IGZ1bmN0aW9uKGFzc2V0cywgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fb25Mb2FkQXNzZXRzID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24oKXt9O1xuICAgICAgICB2YXIgbG9hZGVyID0gcGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIoKTtcbiAgICAgICAgbG9hZGVyLmxvYWQoYXNzZXRzKTtcbiAgICAgICAgbG9hZGVyLm9uKCdsb2FkJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkY29tcGxldGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fb25Mb2FkQXNzZXRzKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIGxvYWRlci5vbnByb2dyZXNzID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkcHJvZ3Jlc3MgPSBlLnByb2dyZXNzO1xuICAgICAgICB9LmJpbmQodGhpcyk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgcGhpbmEuZXh0ZW5zaW9uLmpzXG4gKiAgMjAxNi8xMS8yNVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmV4dGVuc2lvbiA9IHBoaW5hLmV4dGVuc2lvbiB8fCB7fTtcblxuLy9zZXRBbHBoYeOCkui/veWKoFxucGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudC5wcm90b3R5cGUuc2V0QWxwaGEgPSBmdW5jdGlvbih2YWwpIHtcbiAgICB0aGlzLmFscGhhID0gdmFsO1xuICAgIHJldHVybiB0aGlzO1xufTtcblxuLy/jgrnjg5fjg6njgqTjg4jmqZ/og73mi6HlvLVcbnBoaW5hLmRpc3BsYXkuU3ByaXRlLnByb3RvdHlwZS5zZXRGcmFtZVRyaW1taW5nID0gZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICB0aGlzLl9mcmFtZVRyaW1YID0geCB8fCAwO1xuICB0aGlzLl9mcmFtZVRyaW1ZID0geSB8fCAwO1xuICB0aGlzLl9mcmFtZVRyaW1XaWR0aCA9IHdpZHRoIHx8IHRoaXMuaW1hZ2UuZG9tRWxlbWVudC53aWR0aCAtIHRoaXMuX2ZyYW1lVHJpbVg7XG4gIHRoaXMuX2ZyYW1lVHJpbUhlaWdodCA9IGhlaWdodCB8fCB0aGlzLmltYWdlLmRvbUVsZW1lbnQuaGVpZ2h0IC0gdGhpcy5fZnJhbWVUcmltWTtcbiAgcmV0dXJuIHRoaXM7XG59XG5cbnBoaW5hLmRpc3BsYXkuU3ByaXRlLnByb3RvdHlwZS5zZXRGcmFtZUluZGV4ID0gZnVuY3Rpb24oaW5kZXgsIHdpZHRoLCBoZWlnaHQpIHtcbiAgdmFyIHN4ID0gdGhpcy5fZnJhbWVUcmltWCB8fCAwO1xuICB2YXIgc3kgPSB0aGlzLl9mcmFtZVRyaW1ZIHx8IDA7XG4gIHZhciBzdyA9IHRoaXMuX2ZyYW1lVHJpbVdpZHRoICB8fCAodGhpcy5pbWFnZS5kb21FbGVtZW50LndpZHRoLXN4KTtcbiAgdmFyIHNoID0gdGhpcy5fZnJhbWVUcmltSGVpZ2h0IHx8ICh0aGlzLmltYWdlLmRvbUVsZW1lbnQuaGVpZ2h0LXN5KTtcblxuICB2YXIgdHcgID0gd2lkdGggfHwgdGhpcy53aWR0aDsgICAgICAvLyB0d1xuICB2YXIgdGggID0gaGVpZ2h0IHx8IHRoaXMuaGVpZ2h0OyAgICAvLyB0aFxuICB2YXIgcm93ID0gfn4oc3cgLyB0dyk7XG4gIHZhciBjb2wgPSB+fihzaCAvIHRoKTtcbiAgdmFyIG1heEluZGV4ID0gcm93KmNvbDtcbiAgaW5kZXggPSBpbmRleCVtYXhJbmRleDtcblxuICB2YXIgeCAgID0gaW5kZXglcm93O1xuICB2YXIgeSAgID0gfn4oaW5kZXgvcm93KTtcbiAgdGhpcy5zcmNSZWN0LnggPSBzeCt4KnR3O1xuICB0aGlzLnNyY1JlY3QueSA9IHN5K3kqdGg7XG4gIHRoaXMuc3JjUmVjdC53aWR0aCAgPSB0dztcbiAgdGhpcy5zcmNSZWN0LmhlaWdodCA9IHRoO1xuXG4gIHRoaXMuX2ZyYW1lSW5kZXggPSBpbmRleDtcblxuICByZXR1cm4gdGhpcztcbn1cblxuLy/jgqjjg6zjg6Hjg7Pjg4jlkIzlo6vjga7mjqXop6bliKTlrppcbnBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQucHJvdG90eXBlLmlzSGl0RWxlbWVudCA9IGZ1bmN0aW9uKGVsbSkge1xuICAgIC8v6Ieq5YiG44Go44OG44K544OI5a++6LGh44KS44Kw44Ot44O844OQ44Or44G45aSJ5o+bXG4gICAgdmFyIHAgPSB0aGlzLmdsb2JhbFRvTG9jYWwoZWxtKTtcbiAgICB2YXIgdGFyZ2V0ID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCh7d2lkdGg6IGVsbS53aWR0aCwgaGVpZ2h0OiBlbG0uaGVpZ2h0fSkuc2V0UG9zaXRpb24ocC54LCBwLnkpO1xuXG4gICAgaWYgKHRoaXMuYm91bmRpbmdUeXBlID09ICdyZWN0Jykge1xuICAgICAgICBpZiAoZWxtLmJvdW5kaW5nVHlwZSA9PSAncmVjdCcpIHtcbiAgICAgICAgICAgIHJldHVybiBwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0UmVjdFJlY3QodGhpcywgdGFyZ2V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0UmVjdENpcmNsZSh0aGlzLCB0YXJnZXQpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGVsbS5ib3VuZGluZ1R5cGUgPT0gJ3JlY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdENpZWNsZVJlY3QodGhpcywgdGFyZ2V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0Q2lyY2xlQ2lyY2xlKHRoaXMsIHRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8v5a2Q6KaB57Sg5YWo44Gm5YiH44KK6Zui44GXXG5waGluYS5hcHAuRWxlbWVudC5wcm90b3R5cGUucmVtb3ZlQ2hpbGRyZW4gPSBmdW5jdGlvbihiZWdpbkluZGV4KSB7XG4gICAgYmVnaW5JbmRleCA9IGJlZ2luSW5kZXggfHwgMDtcbiAgICB2YXIgdGVtcENoaWxkcmVuID0gdGhpcy5jaGlsZHJlbi5zbGljZSgpO1xuICAgIHZhciBsZW4gPSBsZW4gPSB0ZW1wQ2hpbGRyZW4ubGVuZ3RoO1xuICAgIGZvciAodmFyIGkgPSBiZWdpbkluZGV4OyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgdGVtcENoaWxkcmVuW2ldLnJlbW92ZSgpO1xuICAgIH1cbiAgICB0aGlzLmNoaWxkcmVuID0gW107XG59XG5cbi8qKlxuICogQG1ldGhvZCB0ZXN0TGluZUxpbmVcbiAqIEBzdGF0aWNcbiAqIDLjgaTjga7nt5rliIbjgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYvjgpLliKTlrprjgZfjgb7jgZlcbiAqIOWPguiAg++8mmh0dHA6Ly93d3c1ZC5iaWdsb2JlLm5lLmpwL350b21veWEwMy9zaHRtbC9hbGdvcml0aG0vSW50ZXJzZWN0aW9uLmh0bVxuICpcbiAqICMjIyBFeGFtcGxlXG4gKiAgICAgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMTAwLCAxMDApO1xuICogICAgIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDIwMCwgMjAwKTtcbiAqICAgICBwMyA9IHBoaW5hLmdlb20uVmVjdG9yMigxNTAsIDI0MCk7XG4gKiAgICAgcDQgPSBwaGluYS5nZW9tLlZlY3RvcjIoMjAwLCAxMDApO1xuICogcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdExpbmVMaW5lKHAxLCBwMiwgcDMsIHA0KTsgLy8gPT4gdHJ1ZVxuICpcbiAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBwMSDnt5rliIYx44Gu56uv44Gu5bqn5qiZXG4gKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDIg57ea5YiGMeOBruerr+OBruW6p+aomVxuICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHAzIOe3muWIhjLjga7nq6/jga7luqfmqJlcbiAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBwNCDnt5rliIYy44Gu56uv44Gu5bqn5qiZXG4gKiBAcmV0dXJuIHtCb29sZWFufSDnt5rliIYx44Go57ea5YiGMuOBjOmHjeOBquOBo+OBpuOBhOOCi+OBi+OBqeOBhuOBi1xuICovXG5waGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUgPSBmdW5jdGlvbihwMSwgcDIsIHAzLCBwNCkge1xuICAvL+WQjOS4gO+8uO+8uei7uOS4iuOBq+S5l+OBo+OBpuOCi+WgtOWQiOOBruiqpOWIpOWumuWbnumBv1xuICBpZiAocDEueCA9PSBwMi54ICYmIHAxLnggPT0gcDMueCAmJiBwMS54ID09IHA0LngpIHtcbiAgICB2YXIgbWluID0gTWF0aC5taW4ocDEueSwgcDIueSk7XG4gICAgdmFyIG1heCA9IE1hdGgubWF4KHAxLnksIHAyLnkpO1xuICAgIGlmIChtaW4gPD0gcDMueSAmJiBwMy55IDw9IG1heCB8fCBtaW4gPD0gcDQueSAmJiBwNC55IDw9IG1heCkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmIChwMS55ID09IHAyLnkgJiYgcDEueSA9PSBwMy55ICYmIHAxLnkgPT0gcDQueSkge1xuICAgIHZhciBtaW4gPSBNYXRoLm1pbihwMS54LCBwMi54KTtcbiAgICB2YXIgbWF4ID0gTWF0aC5tYXgocDEueCwgcDIueCk7XG4gICAgaWYgKG1pbiA8PSBwMy54ICYmIHAzLnggPD0gbWF4IHx8IG1pbiA8PSBwNC54ICYmIHA0LnggPD0gbWF4KSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgdmFyIGEgPSAocDEueCAtIHAyLngpICogKHAzLnkgLSBwMS55KSArIChwMS55IC0gcDIueSkgKiAocDEueCAtIHAzLngpO1xuICB2YXIgYiA9IChwMS54IC0gcDIueCkgKiAocDQueSAtIHAxLnkpICsgKHAxLnkgLSBwMi55KSAqIChwMS54IC0gcDQueCk7XG4gIHZhciBjID0gKHAzLnggLSBwNC54KSAqIChwMS55IC0gcDMueSkgKyAocDMueSAtIHA0LnkpICogKHAzLnggLSBwMS54KTtcbiAgdmFyIGQgPSAocDMueCAtIHA0LngpICogKHAyLnkgLSBwMy55KSArIChwMy55IC0gcDQueSkgKiAocDMueCAtIHAyLngpO1xuICByZXR1cm4gYSAqIGIgPD0gMCAmJiBjICogZCA8PSAwO1xufVxuXG4vKipcbiAqIEBtZXRob2QgdGVzdFJlY3RMaW5lXG4gKiBAc3RhdGljXG4gKiDnn6nlvaLjgajnt5rliIbjgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYvjgpLliKTlrprjgZfjgb7jgZlcbiAqXG4gKiAjIyMgRXhhbXBsZVxuICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoMTIwLCAxMzAsIDQwLCA1MCk7XG4gKiAgICAgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMTAwLCAxMDApO1xuICogICAgIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDIwMCwgMjAwKTtcbiAqIHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RSZWN0TGluZShyZWN0LCBwMSwgcDIpOyAvLyA9PiB0cnVlXG4gKlxuICogQHBhcmFtIHtwaGluYS5nZW9tLlJlY3R9IHJlY3Qg55+p5b2i6aCY5Z+f44Kq44OW44K444Kn44Kv44OIXG4gKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDEg57ea5YiG44Gu56uv44Gu5bqn5qiZXG4gKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDIg57ea5YiG44Gu56uv44Gu5bqn5qiZXG4gKiBAcmV0dXJuIHtCb29sZWFufSDnn6nlvaLjgajnt5rliIbjgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYtcbiAqL1xucGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdFJlY3RMaW5lID0gZnVuY3Rpb24ocmVjdCwgcDEsIHAyKSB7XG4gICAgLy/ljIXlkKvliKTlrpoocDHjgYzlkKvjgb7jgozjgabjgozjgbDoia/jgYTjga7jgadwMuOBruWIpOWumuOBr+OBl+OBquOBhO+8iVxuICAgIGlmIChyZWN0LmxlZnQgPD0gcDEueCAmJiBwMS54IDw9IHJlY3QucmlnaHQgJiYgcmVjdC50b3AgPD0gcDEueSAmJiBwMS55IDw9IHJlY3QuYm90dG9tICkgcmV0dXJuIHRydWU7XG5cbiAgICAvL+efqeW9ouOBru+8lOeCuVxuICAgIHZhciByMSA9IHBoaW5hLmdlb20uVmVjdG9yMihyZWN0LmxlZnQsIHJlY3QudG9wKTsgICAgIC8v5bem5LiKXG4gICAgdmFyIHIyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHJlY3QucmlnaHQsIHJlY3QudG9wKTsgICAgLy/lj7PkuIpcbiAgICB2YXIgcjMgPSBwaGluYS5nZW9tLlZlY3RvcjIocmVjdC5yaWdodCwgcmVjdC5ib3R0b20pOyAvL+WPs+S4i1xuICAgIHZhciByNCA9IHBoaW5hLmdlb20uVmVjdG9yMihyZWN0LmxlZnQsIHJlY3QuYm90dG9tKTsgIC8v5bem5LiLXG5cbiAgICAvL+efqeW9ouOBru+8lOi+uuOCkuOBquOBmee3muWIhuOBqOOBruaOpeinpuWIpOWumlxuICAgIGlmIChwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUocDEsIHAyLCByMSwgcjIpKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAocGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdExpbmVMaW5lKHAxLCBwMiwgcjIsIHIzKSkgcmV0dXJuIHRydWU7XG4gICAgaWYgKHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RMaW5lTGluZShwMSwgcDIsIHIzLCByNCkpIHJldHVybiB0cnVlO1xuICAgIGlmIChwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUocDEsIHAyLCByMSwgcjQpKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG59XG5cblxuLy/lhoblvKfjga7mj4/nlLtcbnBoaW5hLmRlZmluZSgncGhpbmEuZGlzcGxheS5BcmNTaGFwZScsIHtcbiAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuU2hhcGUnLFxuXG4gIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gKHt9KS4kc2FmZShvcHRpb25zLCB7XG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICBmaWxsOiAncmVkJyxcbiAgICAgIHN0cm9rZTogJyNhYWEnLFxuICAgICAgc3Ryb2tlV2lkdGg6IDQsXG4gICAgICByYWRpdXM6IDMyLFxuICAgICAgc3RhcnRBbmdsZTogMCxcbiAgICAgIGVuZEFuZ2xlOiAyNzAsXG5cbiAgICAgIGFudGljbG9ja3dpc2U6IGZhbHNlLFxuICAgIH0pO1xuICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgdGhpcy5yYWRpdXMgPSBvcHRpb25zLnJhZGl1cztcbiAgICB0aGlzLnN0YXJ0QW5nbGUgPSBvcHRpb25zLnN0YXJ0QW5nbGU7XG4gICAgdGhpcy5lbmRBbmdsZSA9IG9wdGlvbnMuZW5kQW5nbGU7XG4gICAgdGhpcy5hbnRpY2xvY2t3aXNlID0gb3B0aW9ucy5hbnRpY2xvY2t3aXNlO1xuXG4gICAgdGhpcy5zZXRCb3VuZGluZ1R5cGUoJ2NpcmNsZScpO1xuICB9LFxuXG4gIHByZXJlbmRlcjogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgY2FudmFzLmZpbGxQaWUoMCwgMCwgdGhpcy5yYWRpdXMsIHRoaXMuc3RhcnRBbmdsZSwgdGhpcy5lbmRBbmdsZSk7XG4gIH0sXG59KTtcbiIsIi8qXG4gKiAgcGhpbmEudGlsZWRtYXAuanNcbiAqICAyMDE2LzA5LzEwXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxuLyoqXG4gKiBAY2xhc3MgcGhpbmEuYXNzZXQuVGlsZWRNYXBcbiAqIEBleHRlbmRzIHBoaW5hLmFzc2V0LkFzc2V0XG4gKiAjIFRpbGVkTWFwRWRpdG9y44Gn5L2c5oiQ44GX44GfdG1444OV44Kh44Kk44Or44KS6Kqt44G/6L6844G/44Kv44Op44K5XG4gKi9cbnBoaW5hLmRlZmluZShcInBoaW5hLmFzc2V0LlRpbGVkTWFwXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmFzc2V0LkFzc2V0XCIsXG5cbiAgICAvKipcbiAgICAgKiBAcHJvcGVydHkgaW1hZ2VcbiAgICAgKiDkvZzmiJDjgZXjgozjgZ/jg57jg4Pjg5fnlLvlg49cbiAgICAgKi9cbiAgICBpbWFnZTogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSB0aWxlc2V0c1xuICAgICAqIOOCv+OCpOODq+OCu+ODg+ODiOaDheWgsVxuICAgICAqL1xuICAgIHRpbGVzZXRzOiBudWxsLFxuXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5IGxheWVyc1xuICAgICAqIOODrOOCpOODpOODvOaDheWgseOBjOagvOe0jeOBleOCjOOBpuOBhOOCi+mFjeWIl1xuICAgICAqL1xuICAgIGxheWVyczogbnVsbCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgIH0sXG5cbiAgICBfbG9hZDogZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICAvL+ODkeOCueaKnOOBjeWHuuOBl1xuICAgICAgICB0aGlzLnBhdGggPSBcIlwiO1xuICAgICAgICB2YXIgbGFzdCA9IHRoaXMuc3JjLmxhc3RJbmRleE9mKFwiL1wiKTtcbiAgICAgICAgaWYgKGxhc3QgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnBhdGggPSB0aGlzLnNyYy5zdWJzdHJpbmcoMCwgbGFzdCsxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v57WC5LqG6Zai5pWw5L+d5a2YXG4gICAgICAgIHRoaXMuX3Jlc29sdmUgPSByZXNvbHZlO1xuXG4gICAgICAgIC8vIGxvYWRcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB2YXIgeG1sID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhtbC5vcGVuKCdHRVQnLCB0aGlzLnNyYyk7XG4gICAgICAgIHhtbC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh4bWwucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICAgICAgICAgIGlmIChbMjAwLCAyMDEsIDBdLmluZGV4T2YoeG1sLnN0YXR1cykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0geG1sLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IChuZXcgRE9NUGFyc2VyKCkpLnBhcnNlRnJvbVN0cmluZyhkYXRhLCBcInRleHQveG1sXCIpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmRhdGFUeXBlID0gXCJ4bWxcIjtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcGFyc2UoZGF0YSk7XG4vLyAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzZWxmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHhtbC5zZW5kKG51bGwpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGdldE1hcERhdGFcbiAgICAgKiDmjIflrprjgZfjgZ/jg57jg4Pjg5fjg6zjgqTjg6Tjg7zjgpLphY3liJfjgajjgZfjgablj5blvpfjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsYXllck5hbWUg5a++6LGh44Os44Kk44Ok44O85ZCNXG4gICAgICovXG4gICAgZ2V0TWFwRGF0YTogZnVuY3Rpb24obGF5ZXJOYW1lKSB7XG4gICAgICAgIC8v44Os44Kk44Ok44O85qSc57SiXG4gICAgICAgIHZhciBkYXRhID0gbnVsbDtcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMubGF5ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllcnNbaV0ubmFtZSA9PSBsYXllck5hbWUpIHtcbiAgICAgICAgICAgICAgICAvL+OCs+ODlOODvOOCkui/lOOBmVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxheWVyc1tpXS5kYXRhLmNvbmNhdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGdldE9iamVjdEdyb3VwXG4gICAgICog44Kq44OW44K444Kn44Kv44OI44Kw44Or44O844OX44KS5Y+W5b6X44GX44G+44GZXG4gICAgICpcbiAgICAgKiDjgrDjg6vjg7zjg5fmjIflrprjgYznhKHjgYTloLTlkIjjgIHlhajjg6zjgqTjg6Tjg7zjgpLphY3liJfjgavjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBncm91bnBOYW1lIOWvvuixoeOCquODluOCuOOCp+OCr+ODiOOCsOODq+ODvOODl+WQjVxuICAgICAqL1xuICAgIGdldE9iamVjdEdyb3VwOiBmdW5jdGlvbihncm91cE5hbWUpIHtcbiAgICAgICAgZ3JvdXBOYW1lID0gZ3JvdXBOYW1lIHx8IG51bGw7XG4gICAgICAgIHZhciBscyA9IFtdO1xuICAgICAgICB2YXIgbGVuID0gdGhpcy5sYXllcnMubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllcnNbaV0udHlwZSA9PSBcIm9iamVjdGdyb3VwXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZ3JvdXBOYW1lID09IG51bGwgfHwgZ3JvdXBOYW1lID09IHRoaXMubGF5ZXJzW2ldLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg6zjgqTjg6Tjg7zmg4XloLHjgpLjgq/jg63jg7zjg7PjgZnjgotcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuX2Nsb25lT2JqZWN0TGF5ZXIodGhpcy5sYXllcnNbaV0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBOYW1lICE9PSBudWxsKSByZXR1cm4gb2JqO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBscy5wdXNoKG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGdldE1hcEltYWdlXG4gICAgICog44Oe44OD44OX44Kk44Oh44O844K444Gu5L2c5oiQXG4gICAgICpcbiAgICAgKiDopIfmlbDjga7jg57jg4Pjg5fjg6zjgqTjg6Tjg7zjgpLmjIflrprlh7rmnaXjgb7jgZnjgIJcbiAgICAgKiDmj4/nlLvpoIbluo/jga9UaWxlZE1hcEVkaXRvcuWBtOOBp+OBruaMh+WumumghuOBp+OBr+eEoeOBj+OAgeW8leaVsOOBrumghuW6j+OBqOOBquOCiuOBvuOBme+8iOesrOS4gOW8leaVsOOBjOS4gOeVquS4i+OBqOOBquOCi++8iVxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9ICDlr77osaHjg6zjgqTjg6Tjg7zlkI1cbiAgICAgKi9cbiAgICBnZXRJbWFnZTogZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgICB2YXIgbnVtTGF5ZXIgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGF5ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllcnNbaV0udHlwZSA9PSBcImxheWVyXCIgfHwgdGhpcy5sYXllcnNbaV0udHlwZSA9PSBcImltYWdlbGF5ZXJcIikgbnVtTGF5ZXIrKztcbiAgICAgICAgfVxuICAgICAgICBpZiAobnVtTGF5ZXIgPT0gMCkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgdmFyIGdlbmVyYXRlZCA9IGZhbHNlO1xuICAgICAgICB2YXIgd2lkdGggPSB0aGlzLndpZHRoICogdGhpcy50aWxld2lkdGg7XG4gICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodCAqIHRoaXMudGlsZWhlaWdodDtcbiAgICAgICAgdmFyIGNhbnZhcyA9IHBoaW5hLmdyYXBoaWNzLkNhbnZhcygpLnNldFNpemUod2lkdGgsIGhlaWdodCk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxheWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGZpbmQgPSBhcmdzLmluZGV4T2YodGhpcy5sYXllcnNbaV0ubmFtZSk7XG4gICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPT0gMCB8fCBmaW5kID49IDApIHtcbiAgICAgICAgICAgICAgICAvL+ODnuODg+ODl+ODrOOCpOODpOODvFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS50eXBlID09IFwibGF5ZXJcIiAmJiB0aGlzLmxheWVyc1tpXS52aXNpYmxlICE9IFwiMFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXllciA9IHRoaXMubGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWFwZGF0YSA9IGxheWVyLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGxheWVyLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gbGF5ZXIuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3BhY2l0eSA9IGxheWVyLm9wYWNpdHkgfHwgMS4wO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBtYXBkYXRhW2NvdW50XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+ODnuODg+ODl+ODgeODg+ODl+OCkumFjee9rlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRNYXBDaGlwKGNhbnZhcywgaW5kZXgsIHggKiB0aGlzLnRpbGV3aWR0aCwgeSAqIHRoaXMudGlsZWhlaWdodCwgb3BhY2l0eSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy/jgqrjg5bjgrjjgqfjgq/jg4jjgrDjg6vjg7zjg5dcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXllcnNbaV0udHlwZSA9PSBcIm9iamVjdGdyb3VwXCIgJiYgdGhpcy5sYXllcnNbaV0udmlzaWJsZSAhPSBcIjBcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGF5ZXIgPSB0aGlzLmxheWVyc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wYWNpdHkgPSBsYXllci5vcGFjaXR5IHx8IDEuMDtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXIub2JqZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmdpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldE1hcENoaXAoY2FudmFzLCBlLmdpZCwgZS54LCBlLnksIG9wYWNpdHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL+OCpOODoeODvOOCuOODrOOCpOODpOODvFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS50eXBlID09IFwiaW1hZ2VsYXllclwiICYmIHRoaXMubGF5ZXJzW2ldLnZpc2libGUgIT0gXCIwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxlbiA9IHRoaXMubGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCdpbWFnZScsIHRoaXMubGF5ZXJzW2ldLmltYWdlLnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZS5kb21FbGVtZW50LCB0aGlzLmxheWVyc1tpXS54LCB0aGlzLmxheWVyc1tpXS55KTtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWdlbmVyYXRlZCkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgdmFyIHRleHR1cmUgPSBwaGluYS5hc3NldC5UZXh0dXJlKCk7XG4gICAgICAgIHRleHR1cmUuZG9tRWxlbWVudCA9IGNhbnZhcy5kb21FbGVtZW50O1xuICAgICAgICByZXR1cm4gdGV4dHVyZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfY2xvbmVPYmplY3RMYXllclxuICAgICAqIOW8leaVsOOBqOOBl+OBpua4oeOBleOCjOOBn+OCquODluOCuOOCp+OCr+ODiOODrOOCpOODpOODvOOCkuOCr+ODreODvOODs+OBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICog5YaF6YOo44Gn5L2/55So44GX44Gm44GE44KL6Zai5pWw44Gn44GZ44CCXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY2xvbmVPYmplY3RMYXllcjogZnVuY3Rpb24oc3JjTGF5ZXIpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHt9LiRzYWZlKHNyY0xheWVyKTtcbiAgICAgICAgcmVzdWx0Lm9iamVjdHMgPSBbXTtcbiAgICAgICAgLy/jg6zjgqTjg6Tjg7zlhoXjgqrjg5bjgrjjgqfjgq/jg4jjga7jgrPjg5Tjg7xcbiAgICAgICAgc3JjTGF5ZXIub2JqZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKG9iail7XG4gICAgICAgICAgICB2YXIgcmVzT2JqID0ge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LiRzYWZlKG9iai5wcm9wZXJ0aWVzKSxcbiAgICAgICAgICAgIH0uJGV4dGVuZChvYmopO1xuICAgICAgICAgICAgaWYgKG9iai5lbGxpcHNlKSByZXNPYmouZWxsaXBzZSA9IG9iai5lbGxpcHNlO1xuICAgICAgICAgICAgaWYgKG9iai5naWQpIHJlc09iai5naWQgPSBvYmouZ2lkO1xuICAgICAgICAgICAgaWYgKG9iai5wb2x5Z29uKSByZXNPYmoucG9seWdvbiA9IG9iai5wb2x5Z29uLmNsb25lKCk7XG4gICAgICAgICAgICBpZiAob2JqLnBvbHlsaW5lKSByZXNPYmoucG9seWxpbmUgPSBvYmoucG9seWxpbmUuY2xvbmUoKTtcbiAgICAgICAgICAgIHJlc3VsdC5vYmplY3RzLnB1c2gocmVzT2JqKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BhcnNlXG4gICAgICog5Y+W5b6X44GX44GfVGlsZWRNYXBFZGl044Gu44OH44O844K/44KS44OR44O844K544GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXJzZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvL+OCv+OCpOODq+WxnuaAp+aDheWgseWPluW+l1xuICAgICAgICB2YXIgbWFwID0gZGF0YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbWFwJylbMF07XG4gICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0clRvSlNPTihtYXApO1xuICAgICAgICB0aGlzLiRleHRlbmQoYXR0cik7XG4gICAgICAgIHRoaXMucHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXNUb0pTT04obWFwKTtcblxuICAgICAgICAvL+OCv+OCpOODq+OCu+ODg+ODiOWPluW+l1xuICAgICAgICB0aGlzLnRpbGVzZXRzID0gdGhpcy5fcGFyc2VUaWxlc2V0cyhkYXRhKTtcblxuICAgICAgICAvL+OCv+OCpOODq+OCu+ODg+ODiOaDheWgseijnOWujFxuICAgICAgICB2YXIgZGVmYXVsdEF0dHIgPSB7XG4gICAgICAgICAgICB0aWxld2lkdGg6IDMyLFxuICAgICAgICAgICAgdGlsZWhlaWdodDogMzIsXG4gICAgICAgICAgICBzcGFjaW5nOiAwLFxuICAgICAgICAgICAgbWFyZ2luOiAwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRpbGVzZXRzLmNoaXBzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50aWxlc2V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy/jgr/jgqTjg6vjgrvjg4Pjg4jlsZ7mgKfmg4XloLHlj5blvpdcbiAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0clRvSlNPTihkYXRhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aWxlc2V0JylbaV0pO1xuICAgICAgICAgICAgYXR0ci4kc2FmZShkZWZhdWx0QXR0cik7XG4gICAgICAgICAgICBhdHRyLmZpcnN0Z2lkLS07XG4gICAgICAgICAgICB0aGlzLnRpbGVzZXRzW2ldLiRleHRlbmQoYXR0cik7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX44OB44OD44OX44Oq44K544OI5L2c5oiQXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMudGlsZXNldHNbaV07XG4gICAgICAgICAgICB0aGlzLnRpbGVzZXRzW2ldLm1hcENoaXAgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIHIgPSBhdHRyLmZpcnN0Z2lkOyByIDwgYXR0ci5maXJzdGdpZCthdHRyLnRpbGVjb3VudDsgcisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNoaXAgPSB7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiB0LmltYWdlLFxuICAgICAgICAgICAgICAgICAgICB4OiAoKHIgLSBhdHRyLmZpcnN0Z2lkKSAlIHQuY29sdW1ucykgKiAodC50aWxld2lkdGggKyB0LnNwYWNpbmcpICsgdC5tYXJnaW4sXG4gICAgICAgICAgICAgICAgICAgIHk6IE1hdGguZmxvb3IoKHIgLSBhdHRyLmZpcnN0Z2lkKSAvIHQuY29sdW1ucykgKiAodC50aWxlaGVpZ2h0ICsgdC5zcGFjaW5nKSArIHQubWFyZ2luLFxuICAgICAgICAgICAgICAgIH0uJHNhZmUoYXR0cik7XG4gICAgICAgICAgICAgICAgdGhpcy50aWxlc2V0cy5jaGlwc1tyXSA9IGNoaXA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODrOOCpOODpOODvOWPluW+l1xuICAgICAgICB0aGlzLmxheWVycyA9IHRoaXMuX3BhcnNlTGF5ZXJzKGRhdGEpO1xuXG4gICAgICAgIC8v44Kk44Oh44O844K444OH44O844K/6Kqt44G/6L6844G/XG4gICAgICAgIHRoaXMuX2NoZWNrSW1hZ2UoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfY2hlY2tJbWFnZVxuICAgICAqIOOCouOCu+ODg+ODiOOBq+eEoeOBhOOCpOODoeODvOOCuOODh+ODvOOCv+OCkuODgeOCp+ODg+OCr+OBl+OBpuiqreOBv+i+vOOBv+OCkuihjOOBhOOBvuOBmeOAglxuICAgICAqXG4gICAgICog5YaF6YOo44Gn5L2/55So44GX44Gm44GE44KL6Zai5pWw44Gn44GZ44CCXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY2hlY2tJbWFnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIGltYWdlU291cmNlID0gW107XG4gICAgICAgIHZhciBsb2FkSW1hZ2UgPSBbXTtcblxuICAgICAgICAvL+S4gOimp+S9nOaIkFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudGlsZXNldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICAgICAgaW1hZ2U6IHRoaXMudGlsZXNldHNbaV0uaW1hZ2UsXG4gICAgICAgICAgICAgICAgdHJhbnNSOiB0aGlzLnRpbGVzZXRzW2ldLnRyYW5zUixcbiAgICAgICAgICAgICAgICB0cmFuc0c6IHRoaXMudGlsZXNldHNbaV0udHJhbnNHLFxuICAgICAgICAgICAgICAgIHRyYW5zQjogdGhpcy50aWxlc2V0c1tpXS50cmFuc0IsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaW1hZ2VTb3VyY2UucHVzaChvYmopO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sYXllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS5pbWFnZSkge1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiB0aGlzLmxheWVyc1tpXS5pbWFnZS5zb3VyY2VcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGltYWdlU291cmNlLnB1c2gob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44Ki44K744OD44OI44Gr44GC44KL44GL56K66KqNXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW1hZ2VTb3VyY2UubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpbWFnZSA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ2ltYWdlJywgaW1hZ2VTb3VyY2VbaV0uaW1hZ2UpO1xuICAgICAgICAgICAgaWYgKGltYWdlKSB7XG4gICAgICAgICAgICAgICAgLy/jgqLjgrvjg4Pjg4jjgavjgYLjgotcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy/jgarjgYvjgaPjgZ/jga7jgafjg63jg7zjg4njg6rjgrnjg4jjgavov73liqBcbiAgICAgICAgICAgICAgICBsb2FkSW1hZ2UucHVzaChpbWFnZVNvdXJjZVtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4gOaLrOODreODvOODiVxuICAgICAgICAvL+ODreODvOODieODquOCueODiOS9nOaIkFxuICAgICAgICB2YXIgYXNzZXRzID0ge1xuICAgICAgICAgICAgaW1hZ2U6IFtdXG4gICAgICAgIH07XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbG9hZEltYWdlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvL+OCpOODoeODvOOCuOOBruODkeOCueOCkuODnuODg+ODl+OBqOWQjOOBmOOBq+OBmeOCi1xuICAgICAgICAgICAgYXNzZXRzLmltYWdlW2xvYWRJbWFnZVtpXS5pbWFnZV0gPSB0aGlzLnBhdGgrbG9hZEltYWdlW2ldLmltYWdlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsb2FkSW1hZ2UubGVuZ3RoKSB7XG4gICAgICAgICAgICB2YXIgbG9hZGVyID0gcGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIoKTtcbiAgICAgICAgICAgIGxvYWRlci5sb2FkKGFzc2V0cyk7XG4gICAgICAgICAgICBsb2FkZXIub24oJ2xvYWQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgLy/pgI/pgY7oibLoqK3lrprlj43mmKBcbiAgICAgICAgICAgICAgICBsb2FkSW1hZ2UuZm9yRWFjaChmdW5jdGlvbihlbG0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgnaW1hZ2UnLCBlbG0uaW1hZ2UpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZWxtLnRyYW5zUiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IGVsbS50cmFuc1IsIGcgPSBlbG0udHJhbnNHLCBiID0gZWxtLnRyYW5zQjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLmZpbHRlcihmdW5jdGlvbihwaXhlbCwgaW5kZXgsIHgsIHksIGJpdG1hcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gYml0bWFwLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsWzBdID09IHIgJiYgcGl4ZWxbMV0gPT0gZyAmJiBwaXhlbFsyXSA9PSBiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrM10gPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy/oqq3jgb/ovrzjgb/ntYLkuoZcbiAgICAgICAgICAgICAgICB0aGF0Ll9yZXNvbHZlKHRoYXQpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8v6Kqt44G/6L6844G/57WC5LqGXG4gICAgICAgICAgICB0aGlzLl9yZXNvbHZlKHRoYXQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3NldE1hcENoaXBcbiAgICAgKiDjgq3jg6Pjg7Pjg5Djgrnjga7mjIflrprjgZfjgZ/luqfmqJnjgavjg57jg4Pjg5fjg4Hjg4Pjg5fjga7jgqTjg6Hjg7zjgrjjgpLjgrPjg5Tjg7zjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NldE1hcENoaXA6IGZ1bmN0aW9uKGNhbnZhcywgaW5kZXgsIHgsIHksIG9wYWNpdHkpIHtcbiAgICAgICAgLy/jgr/jgqTjg6vjgrvjg4Pjg4jjgYvjgonjg57jg4Pjg5fjg4Hjg4Pjg5fjgpLlj5blvpdcbiAgICAgICAgdmFyIGNoaXAgPSB0aGlzLnRpbGVzZXRzLmNoaXBzW2luZGV4XTtcbiAgICAgICAgaWYgKCFjaGlwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGltYWdlID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgnaW1hZ2UnLCBjaGlwLmltYWdlKTtcbiAgICAgICAgaWYgKCFpbWFnZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coY2hpcC5pbWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FudmFzLmNvbnRleHQuZHJhd0ltYWdlKFxuICAgICAgICAgICAgaW1hZ2UuZG9tRWxlbWVudCxcbiAgICAgICAgICAgIGNoaXAueCArIGNoaXAubWFyZ2luLCBjaGlwLnkgKyBjaGlwLm1hcmdpbixcbiAgICAgICAgICAgIGNoaXAudGlsZXdpZHRoLCBjaGlwLnRpbGVoZWlnaHQsXG4gICAgICAgICAgICB4LCB5LFxuICAgICAgICAgICAgY2hpcC50aWxld2lkdGgsIGNoaXAudGlsZWhlaWdodCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Byb3BlcnRpZXNUb0pTT05cbiAgICAgKiBYTUzjg5fjg63jg5Hjg4bjgqPjgpJKU09O44Gr5aSJ5o+b44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wcm9wZXJ0aWVzVG9KU09OOiBmdW5jdGlvbihlbG0pIHtcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBlbG0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJwcm9wZXJ0aWVzXCIpWzBdO1xuICAgICAgICB2YXIgb2JqID0ge307XG4gICAgICAgIGlmIChwcm9wZXJ0aWVzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBwcm9wZXJ0aWVzLmNoaWxkTm9kZXMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIHZhciBwID0gcHJvcGVydGllcy5jaGlsZE5vZGVzW2tdO1xuICAgICAgICAgICAgaWYgKHAudGFnTmFtZSA9PT0gXCJwcm9wZXJ0eVwiKSB7XG4gICAgICAgICAgICAgICAgLy9wcm9wZXJ0eeOBq3R5cGXmjIflrprjgYzjgYLjgaPjgZ/jgonlpInmj5tcbiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IHAuZ2V0QXR0cmlidXRlKCd0eXBlJyk7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gcC5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJyk7XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkgdmFsdWUgPSBwLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgIGlmICh0eXBlID09IFwiaW50XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqW3AuZ2V0QXR0cmlidXRlKCduYW1lJyldID0gcGFyc2VJbnQodmFsdWUsIDEwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJmbG9hdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIG9ialtwLmdldEF0dHJpYnV0ZSgnbmFtZScpXSA9IHBhcnNlRmxvYXQodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImJvb2xcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IFwidHJ1ZVwiKSBvYmpbcC5nZXRBdHRyaWJ1dGUoJ25hbWUnKV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIG9ialtwLmdldEF0dHJpYnV0ZSgnbmFtZScpXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9ialtwLmdldEF0dHJpYnV0ZSgnbmFtZScpXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9wcm9wZXJ0aWVzVG9KU09OXG4gICAgICogWE1M5bGe5oCn5oOF5aCx44KSSlNPTuOBq+WkieaPm+OBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICog5YaF6YOo44Gn5L2/55So44GX44Gm44GE44KL6Zai5pWw44Gn44GZ44CCXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfYXR0clRvSlNPTjogZnVuY3Rpb24oc291cmNlKSB7XG4gICAgICAgIHZhciBvYmogPSB7fTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2UuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHZhbCA9IHNvdXJjZS5hdHRyaWJ1dGVzW2ldLnZhbHVlO1xuICAgICAgICAgICAgdmFsID0gaXNOYU4ocGFyc2VGbG9hdCh2YWwpKT8gdmFsOiBwYXJzZUZsb2F0KHZhbCk7XG4gICAgICAgICAgICBvYmpbc291cmNlLmF0dHJpYnV0ZXNbaV0ubmFtZV0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfcHJvcGVydGllc1RvSlNPTl9zdHJcbiAgICAgKiBYTUzjg5fjg63jg5Hjg4bjgqPjgpJKU09O44Gr5aSJ5o+b44GX44CB5paH5a2X5YiX44Gn6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9hdHRyVG9KU09OX3N0cjogZnVuY3Rpb24oc291cmNlKSB7XG4gICAgICAgIHZhciBvYmogPSB7fTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2UuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHZhbCA9IHNvdXJjZS5hdHRyaWJ1dGVzW2ldLnZhbHVlO1xuICAgICAgICAgICAgb2JqW3NvdXJjZS5hdHRyaWJ1dGVzW2ldLm5hbWVdID0gdmFsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BhcnNlVGlsZXNldHNcbiAgICAgKiDjgr/jgqTjg6vjgrvjg4Pjg4jjga7jg5Hjg7zjgrnjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3BhcnNlVGlsZXNldHM6IGZ1bmN0aW9uKHhtbCkge1xuICAgICAgICB2YXIgZWFjaCA9IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciBkYXRhID0gW107XG4gICAgICAgIHZhciB0aWxlc2V0cyA9IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGlsZXNldCcpO1xuICAgICAgICBlYWNoLmNhbGwodGlsZXNldHMsIGZ1bmN0aW9uKHRpbGVzZXQpIHtcbiAgICAgICAgICAgIHZhciB0ID0ge307XG4gICAgICAgICAgICB2YXIgcHJvcHMgPSBzZWxmLl9wcm9wZXJ0aWVzVG9KU09OKHRpbGVzZXQpO1xuICAgICAgICAgICAgaWYgKHByb3BzLnNyYykge1xuICAgICAgICAgICAgICAgIHQuaW1hZ2UgPSBwcm9wcy5zcmM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHQuaW1hZ2UgPSB0aWxlc2V0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbWFnZScpWzBdLmdldEF0dHJpYnV0ZSgnc291cmNlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+mAj+mBjuiJsuioreWumuWPluW+l1xuICAgICAgICAgICAgdC50cmFucyA9IHRpbGVzZXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltYWdlJylbMF0uZ2V0QXR0cmlidXRlKCd0cmFucycpO1xuICAgICAgICAgICAgaWYgKHQudHJhbnMpIHtcbiAgICAgICAgICAgICAgICB0LnRyYW5zUiA9IHBhcnNlSW50KHQudHJhbnMuc3Vic3RyaW5nKDAsIDIpLCAxNik7XG4gICAgICAgICAgICAgICAgdC50cmFuc0cgPSBwYXJzZUludCh0LnRyYW5zLnN1YnN0cmluZygyLCA0KSwgMTYpO1xuICAgICAgICAgICAgICAgIHQudHJhbnNCID0gcGFyc2VJbnQodC50cmFucy5zdWJzdHJpbmcoNCwgNiksIDE2KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGF0YS5wdXNoKHQpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BhcnNlTGF5ZXJzXG4gICAgICog44Os44Kk44Ok44O85oOF5aCx44Gu44OR44O844K544KS6KGM44GE44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXJzZUxheWVyczogZnVuY3Rpb24oeG1sKSB7XG4gICAgICAgIHZhciBlYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2g7XG4gICAgICAgIHZhciBkYXRhID0gW107XG5cbiAgICAgICAgdmFyIG1hcCA9IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIm1hcFwiKVswXTtcbiAgICAgICAgdmFyIGxheWVycyA9IFtdO1xuICAgICAgICBlYWNoLmNhbGwobWFwLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKGVsbSkge1xuICAgICAgICAgICAgaWYgKGVsbS50YWdOYW1lID09IFwibGF5ZXJcIiB8fCBlbG0udGFnTmFtZSA9PSBcIm9iamVjdGdyb3VwXCIgfHwgZWxtLnRhZ05hbWUgPT0gXCJpbWFnZWxheWVyXCIpIHtcbiAgICAgICAgICAgICAgICBsYXllcnMucHVzaChlbG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBsYXllcnMuZWFjaChmdW5jdGlvbihsYXllcikge1xuICAgICAgICAgICAgc3dpdGNoIChsYXllci50YWdOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImxheWVyXCI6XG4gICAgICAgICAgICAgICAgICAgIC8v6YCa5bi444Os44Kk44Ok44O8XG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gbGF5ZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RhdGEnKVswXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuY29kaW5nID0gZC5nZXRBdHRyaWJ1dGUoXCJlbmNvZGluZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImxheWVyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmNvZGluZyA9PSBcImNzdlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsLmRhdGEgPSB0aGlzLl9wYXJzZUNTVihkLnRleHRDb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbmNvZGluZyA9PSBcImJhc2U2NFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsLmRhdGEgPSB0aGlzLl9wYXJzZUJhc2U2NChkLnRleHRDb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0clRvSlNPTihsYXllcik7XG4gICAgICAgICAgICAgICAgICAgIGwuJGV4dGVuZChhdHRyKTtcbiAgICAgICAgICAgICAgICAgICAgbC5wcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllc1RvSlNPTihsYXllcik7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKGwpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIC8v44Kq44OW44K444Kn44Kv44OI44Os44Kk44Ok44O8XG4gICAgICAgICAgICAgICAgY2FzZSBcIm9iamVjdGdyb3VwXCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBsID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3Rncm91cFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0czogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgeDogcGFyc2VGbG9hdChsYXllci5nZXRBdHRyaWJ1dGUoXCJvZmZzZXR4XCIpKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgeTogcGFyc2VGbG9hdChsYXllci5nZXRBdHRyaWJ1dGUoXCJvZmZzZXR5XCIpKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IGxheWVyLmdldEF0dHJpYnV0ZShcIm9wYWNpdHlcIikgfHwgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJjb2xvclwiKSB8fCBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhd29yZGVyOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJkcmF3b3JkZXJcIikgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgbC5wcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllc1RvSlNPTihsYXllcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy/jg6zjgqTjg6Tjg7zlhoXop6PmnpBcbiAgICAgICAgICAgICAgICAgICAgZWFjaC5jYWxsKGxheWVyLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKGVsbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsbS5ub2RlVHlwZSA9PSAzKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2F0dHJUb0pTT04oZWxtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLmlkID09PSB1bmRlZmluZWQpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXNUb0pTT04oZWxtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v5a2Q6KaB57Sg44Gu6Kej5p6QXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxtLmNoaWxkTm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxtLmNoaWxkTm9kZXMuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVUeXBlID09IDMpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/mpZXlhoZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUubm9kZU5hbWUgPT0gJ2VsbGlwc2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmVsbGlwc2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5aSa6KeS5b2iXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVOYW1lID09ICdwb2x5Z29uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wb2x5Z29uID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IHRoaXMuX2F0dHJUb0pTT05fc3RyKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBsID0gYXR0ci5wb2ludHMuc3BsaXQoXCIgXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGwuZm9yRWFjaChmdW5jdGlvbihzdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHRzID0gc3RyLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnBvbHlnb24ucHVzaCh7eDogcGFyc2VGbG9hdChwdHNbMF0pLCB5OiBwYXJzZUZsb2F0KHB0c1sxXSl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v57ea5YiGXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVOYW1lID09ICdwb2x5bGluZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucG9seWxpbmUgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0clRvSlNPTl9zdHIoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGwgPSBhdHRyLnBvaW50cy5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbC5mb3JFYWNoKGZ1bmN0aW9uKHN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwdHMgPSBzdHIuc3BsaXQoXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucG9seWxpbmUucHVzaCh7eDogcGFyc2VGbG9hdChwdHNbMF0pLCB5OiBwYXJzZUZsb2F0KHB0c1sxXSl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGwub2JqZWN0cy5wdXNoKGQpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChsKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAvL+OCpOODoeODvOOCuOODrOOCpOODpOODvFxuICAgICAgICAgICAgICAgIGNhc2UgXCJpbWFnZWxheWVyXCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBsID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpbWFnZWxheWVyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgeDogcGFyc2VGbG9hdChsYXllci5nZXRBdHRyaWJ1dGUoXCJvZmZzZXR4XCIpKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgeTogcGFyc2VGbG9hdChsYXllci5nZXRBdHRyaWJ1dGUoXCJvZmZzZXR5XCIpKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IGxheWVyLmdldEF0dHJpYnV0ZShcIm9wYWNpdHlcIikgfHwgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IChsYXllci5nZXRBdHRyaWJ1dGUoXCJ2aXNpYmxlXCIpID09PSB1bmRlZmluZWQgfHwgbGF5ZXIuZ2V0QXR0cmlidXRlKFwidmlzaWJsZVwiKSAhPSAwKSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlRWxtID0gbGF5ZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpbWFnZVwiKVswXTtcbiAgICAgICAgICAgICAgICAgICAgbC5pbWFnZSA9IHtzb3VyY2U6IGltYWdlRWxtLmdldEF0dHJpYnV0ZShcInNvdXJjZVwiKX07XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKGwpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BlcnNlQ1NWXG4gICAgICogQ1NW44Gu44OR44O844K544KS6KGM44GE44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXJzZUNTVjogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICB2YXIgZGF0YUxpc3QgPSBkYXRhLnNwbGl0KCcsJyk7XG4gICAgICAgIHZhciBsYXllciA9IFtdO1xuXG4gICAgICAgIGRhdGFMaXN0LmVhY2goZnVuY3Rpb24oZWxtLCBpKSB7XG4gICAgICAgICAgICB2YXIgbnVtID0gcGFyc2VJbnQoZWxtLCAxMCkgLSAxO1xuICAgICAgICAgICAgbGF5ZXIucHVzaChudW0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gbGF5ZXI7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BlcnNlQ1NWXG4gICAgICogQkFTRTY044Gu44OR44O844K544KS6KGM44GE44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBodHRwOi8vdGhla2Fubm9uLXNlcnZlci5hcHBzcG90LmNvbS9oZXJwaXR5LWRlcnBpdHkuYXBwc3BvdC5jb20vcGFzdGViaW4uY29tLzc1S2tzMFdIXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcGFyc2VCYXNlNjQ6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdmFyIGRhdGFMaXN0ID0gYXRvYihkYXRhLnRyaW0oKSk7XG4gICAgICAgIHZhciByc3QgPSBbXTtcblxuICAgICAgICBkYXRhTGlzdCA9IGRhdGFMaXN0LnNwbGl0KCcnKS5tYXAoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgcmV0dXJuIGUuY2hhckNvZGVBdCgwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yICh2YXIgaT0wLGxlbj1kYXRhTGlzdC5sZW5ndGgvNDsgaTxsZW47ICsraSkge1xuICAgICAgICAgICAgdmFyIG4gPSBkYXRhTGlzdFtpKjRdO1xuICAgICAgICAgICAgcnN0W2ldID0gcGFyc2VJbnQobiwgMTApIC0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByc3Q7XG4gICAgfSxcbn0pO1xuXG4vL+ODreODvOODgOODvOOBq+i/veWKoFxucGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIuYXNzZXRMb2FkRnVuY3Rpb25zLnRteCA9IGZ1bmN0aW9uKGtleSwgcGF0aCkge1xuICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5UaWxlZE1hcCgpO1xuICAgIHJldHVybiB0bXgubG9hZChwYXRoKTtcbn07XG4iLCIvKlxuICogIHBoaW5hLnZpcnR1YWxwYWQuanNcbiAqICAyMDE3LzA2LzEzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxucGhpbmEuZXh0ZW5zaW9uID0gcGhpbmEuZXh0ZW5zaW9uIHx8IHt9O1xuXG4vL+ODkOODvOODgeODo+ODq+ODkeODg+ODiVxucGhpbmEuZGVmaW5lKFwicGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgYWN0aXZlOiB0cnVlLFxuXG4gICAgLy/mjL/kuIvjgq3jg7zmg4XloLFcbiAgICBrZXlEYXRhOiB7XG4gICAgICAgIHVwOiBmYWxzZSxcbiAgICAgICAgZG93bjogZmFsc2UsXG4gICAgICAgIGxlZnQ6IGZhbHNlLFxuICAgICAgICByaWdodDogZmFsc2UsXG4gICAgICAgIGE6IGZhbHNlLFxuICAgICAgICBiOiBmYWxzZSxcbiAgICB9LFxuXG4gICAgZGVmYXVsdE9wdGlvbnM6IHtcbiAgICAgICAgLy/jg5Hjg4Pjg4nnuKbmqKpcbiAgICAgICAgd2lkdGg6IDY0MCxcbiAgICAgICAgaGVpZ2h0OiA0ODAsXG5cbiAgICAgICAgLy/jg5Hjg4Pjg4nluqfmqJlcbiAgICAgICAgeDogMCxcbiAgICAgICAgeTogMCxcblxuICAgICAgICAvL+WIpOWumuWNiuW+hFxuICAgICAgICBmaW5nZXJSYWRpdXM6IDIwLFxuICAgIH0sXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG5cbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6IG9wdGlvbnMud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IG9wdGlvbnMuaGVpZ2h0LFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuMylcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDAuMylcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZ3RoOiAwLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1hc2sgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuLy8gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldE9yaWdpbigwLCAwKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKG9wdGlvbnMueCwgb3B0aW9ucy55KTtcblxuICAgICAgICB0aGlzLmFuYWxvZyA9IHBoaW5hLmV4dGVuc2lvbi5WaXJ0dWFsUGFkLkFuYWxvZ1N0aWNrKClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oODIsIG9wdGlvbnMuaGVpZ2h0IC0gODIpO1xuXG4gICAgICAgIHRoaXMuYnRuID0gW107XG4gICAgICAgIHRoaXMuYnRuWzBdID0gcGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWQuQnV0dG9uKCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihvcHRpb25zLndpZHRoICogMC43LCBvcHRpb25zLmhlaWdodCAqIDAuOSk7XG4gICAgICAgIHRoaXMuYnRuWzFdID0gcGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWQuQnV0dG9uKCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihvcHRpb25zLndpZHRoICogMC43ICsgODAsIG9wdGlvbnMuaGVpZ2h0ICogMC45KTtcblxuICAgICAgICAvL+OCv+ODg+ODl+S9jee9ruihqOekulxuICAgICAgICB2YXIgZmluZ2VyUGFyYW0gPSB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC4yKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMC4yKVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG4gICAgICAgICAgICByYWRpdXM6IG9wdGlvbnMuZmluZ2VyUmFkaXVzLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmZpbmdlciA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5maW5nZXJbaV0gPSBwaGluYS5kaXNwbGF5LkNpcmNsZVNoYXBlKGZpbmdlclBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5maW5nZXJbaV0udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIHVwZGF0ZUluZm86IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcCA9IGFwcC5tb3VzZTtcbiAgICAgICAgaWYgKHAuZ2V0UG9pbnRpbmcoKSkge1xuICAgICAgICAgICAgLy/jgr/jg4Pjg5fkvY3nva7ooajnpLpcbiAgICAgICAgICAgIHZhciBwcyA9IGFwcC5wb2ludGVycztcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGkgPCBwcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5nZXJbaV0udmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZ2VyW2ldLnNldFBvc2l0aW9uKHBzW2ldLngsIHBzW2ldLnkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZ2VyW2ldLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmluZ2VyW2ldLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRLZXk6IGZ1bmN0aW9uKGNvZGUpIHtcbiAgICAgICAgdmFyIG92ID0gMTA7XG4gICAgICAgIHZhciBhbmdsZSA9IHRoaXMuYW5hbG9nLmFuZ2xlO1xuICAgICAgICBzd2l0Y2ggKGNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBhbmdsZSAmJiAoYW5nbGUgPj0gMzE1IC0gb3YgfHwgYW5nbGUgPD0gNDUgKyBvdik7XG4gICAgICAgICAgICBjYXNlIFwiZG93blwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBhbmdsZSAmJiAoYW5nbGUgPj0gNDUgLSBvdiAmJiBhbmdsZSA8PSAxMzUgKyBvdik7XG4gICAgICAgICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBhbmdsZSAmJiAoYW5nbGUgPj0gMTM1IC0gb3YgJiYgYW5nbGUgPD0gMjE1ICsgb3YpO1xuICAgICAgICAgICAgY2FzZSBcInVwXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ2xlICYmIChhbmdsZSA+PSAyMTUgLSBvdiAmJiBhbmdsZSA8PSAzMTUgKyBvdik7XG4gICAgICAgICAgICBjYXNlIFwielwiOlxuICAgICAgICAgICAgY2FzZSBcIlpcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5idG5bMF0uaXNPbjtcbiAgICAgICAgICAgIGNhc2UgXCJ4XCI6XG4gICAgICAgICAgICBjYXNlIFwiWFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ0blsxXS5pc09uO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG5cbi8v44OQ44O844OB44Oj44Or44OR44OD44OJ5Y2B5a2X44Kt44O8XG5waGluYS5kZWZpbmUoXCJwaGluYS5leHRlbnNpb24uVmlydHVhbFBhZC5Dcm9zc0tleVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICBhY3RpdmU6IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG5cbiAgICAgICAgLy/ljYHlrZfjgq3jg7zkuK3lv4PngrlcbiAgICAgICAgdmFyIGh3ID0gMDtcbiAgICAgICAgdmFyIGhoID0gMDtcbiAgICAgICAgdmFyIGNwID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuXG4gICAgICAgIHZhciBidXR0b24gPSB7XG4gICAgICAgICAgICB3aWR0aDogMjAsXG4gICAgICAgICAgICBoZWlnaHQ6IDIwLFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuMilcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDAuMilcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgLy8wOuS4iiAxOuWPs+S4iiAyOuWPsyAzOuWPs+S4iyA0OuS4iyA1OuW3puS4iyA2OuW3piA3OuW3puS4ilxuICAgICAgICB0aGlzLmJ0biA9IFtdO1xuICAgICAgICB0aGlzLmJ0blswXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiA2MCwgaGVpZ2h0OiA1MH0uJHNhZmUoYnV0dG9uKSkuc2V0UG9zaXRpb24oY3AueCAgICAgLCBjcC55IC0gNDApLmFkZENoaWxkVG8odGhpcykuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMuYnRuWzJdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDUwLCBoZWlnaHQ6IDYwfS4kc2FmZShidXR0b24pKS5zZXRQb3NpdGlvbihjcC54ICsgNDAsIGNwLnkgICAgICkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgdGhpcy5idG5bNF0gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogNjAsIGhlaWdodDogNTB9LiRzYWZlKGJ1dHRvbikpLnNldFBvc2l0aW9uKGNwLnggICAgICwgY3AueSArIDQwKS5hZGRDaGlsZFRvKHRoaXMpLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB0aGlzLmJ0bls2XSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiA1MCwgaGVpZ2h0OiA2MH0uJHNhZmUoYnV0dG9uKSkuc2V0UG9zaXRpb24oY3AueCAtIDQwLCBjcC55ICAgICApLmFkZENoaWxkVG8odGhpcykuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG5cbiAgICAgICAgdGhpcy5idG5bMV0gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMzAsIGhlaWdodDogMzB9LiRzYWZlKGJ1dHRvbikpLnNldFBvc2l0aW9uKGNwLnggKyA0MCwgY3AueSAtIDQwKS5hZGRDaGlsZFRvKHRoaXMpLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB0aGlzLmJ0blszXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAzMCwgaGVpZ2h0OiAzMH0uJHNhZmUoYnV0dG9uKSkuc2V0UG9zaXRpb24oY3AueCArIDQwLCBjcC55ICsgNDApLmFkZENoaWxkVG8odGhpcykuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMuYnRuWzVdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDMwLCBoZWlnaHQ6IDMwfS4kc2FmZShidXR0b24pKS5zZXRQb3NpdGlvbihjcC54IC0gNDAsIGNwLnkgKyA0MCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgdGhpcy5idG5bN10gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMzAsIGhlaWdodDogMzB9LiRzYWZlKGJ1dHRvbikpLnNldFBvc2l0aW9uKGNwLnggLSA0MCwgY3AueSAtIDQwKS5hZGRDaGlsZFRvKHRoaXMpLnNldEludGVyYWN0aXZlKHRydWUpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5idG4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuYnRuW2ldLmlzT24gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuYnRuW2ldLm9uKCdwb2ludG92ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzT24gPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmJ0bltpXS5vbigncG9pbnRvdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzT24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/mjL/kuIvjgq3jg7zmg4XloLFcbiAgICAgICAgdGhpcy5rZXlkYXRhID0ge1xuICAgICAgICAgICAgdXA6IGZhbHNlLFxuICAgICAgICAgICAgZG93bjogZmFsc2UsXG4gICAgICAgICAgICBsZWZ0OiBmYWxzZSxcbiAgICAgICAgICAgIHJpZ2h0OiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5rZXlkYXRhID0ge1xuICAgICAgICAgICAgdXA6IHRoaXMuYnRuWzBdLmlzT24gfHwgdGhpcy5idG5bMV0uaXNPbiB8fCB0aGlzLmJ0bls3XS5pc09uLFxuICAgICAgICAgICAgcmlnaHQ6IHRoaXMuYnRuWzJdLmlzT24gfHwgdGhpcy5idG5bMV0uaXNPbiB8fCB0aGlzLmJ0blszXS5pc09uLFxuICAgICAgICAgICAgZG93bjogdGhpcy5idG5bNF0uaXNPbiB8fCB0aGlzLmJ0blszXS5pc09uIHx8IHRoaXMuYnRuWzVdLmlzT24sXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmJ0bls2XS5pc09uIHx8IHRoaXMuYnRuWzVdLmlzT24gfHwgdGhpcy5idG5bN10uaXNPbixcbiAgICAgICAgfTtcbiAgICB9LFxufSk7XG5cbi8v44OQ44O844OB44Oj44Or44OR44OD44OJ44Oc44K/44OzXG5waGluYS5kZWZpbmUoXCJwaGluYS5leHRlbnNpb24uVmlydHVhbFBhZC5CdXR0b25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgYWN0aXZlOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHJhZGl1czogb3B0aW9ucy5yYWRpdXMgfHwgMzAsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC4zKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJ0biA9IHBoaW5hLmRpc3BsYXkuQ2lyY2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB0aGlzLmJ0bi5vbigncG9pbnRvdmVyJywgZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzT24gPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5idG4ub24oJ3BvaW50b3V0JywgZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzT24gPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfSxcbn0pO1xuXG4vL+ODkOODvOODgeODo+ODq+ODkeODg+ODieOCouODiuODreOCsOOCueODhuOCo+ODg+OCr1xucGhpbmEuZGVmaW5lKFwicGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWQuQW5hbG9nU3RpY2tcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5DaXJjbGVTaGFwZVwiLFxuXG4gICAgYWN0aXZlOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7XG4gICAgICAgICAgICByYWRpdXM6IDgwLFxuICAgICAgICAgICAgZmlsbDogbnVsbCxcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMylcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/kuK3lv4PngrlcbiAgICAgICAgdmFyIGh3ID0gMDtcbiAgICAgICAgdmFyIGhoID0gMDtcbiAgICAgICAgdmFyIGNwID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHJhZGl1czogMjAsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC4zKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMC4zKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmlubmVyID0gcGhpbmEuZGlzcGxheS5DaXJjbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMudmVjdG9yID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuICAgICAgICB0aGlzLnB0ID0gbnVsbDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCFhcHAucG9pbnRlci5nZXRQb2ludGluZygpKSB7XG4gICAgICAgICAgICB0aGlzLnZlY3Rvci5zZXQoMCwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHBvaW50ZXJzID0gYXBwLnBvaW50ZXJzO1xuICAgICAgICBwb2ludGVycy5mb3JFYWNoKHBvaW50ZXIgPT4ge1xuICAgICAgICAgICAgaWYgKHBvaW50ZXIuZ2V0UG9pbnRpbmdTdGFydCgpICYmIHRoaXMuaGl0VGVzdChwb2ludGVyLngsIHBvaW50ZXIueSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnB0ID0gcG9pbnRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLnB0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wdC5nZXRQb2ludGluZygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52ZWN0b3Iuc2V0KHRoaXMucHQueCAtIHRoaXMueCwgdGhpcy5wdC55IC0gdGhpcy55KS5ub3JtYWxpemUoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wdC5nZXRQb2ludGluZ0VuZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52ZWN0b3Iuc2V0KDAsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5uZXIueCA9IHRoaXMudmVjdG9yLnggKiB0aGlzLnJhZGl1cyAqIDAuNjtcbiAgICAgICAgdGhpcy5pbm5lci55ID0gdGhpcy52ZWN0b3IueSAqIHRoaXMucmFkaXVzICogMC42O1xuXG4gICAgICAgIC8v6KeS5bqmXG4gICAgICAgIGlmICh0aGlzLnZlY3Rvci54ID09IDAgJiYgdGhpcy52ZWN0b3IueSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmFuZ2xlID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYW5nbGUgPSBNYXRoLmZsb29yKE1hdGguYXRhbjIodGhpcy52ZWN0b3IueSwgdGhpcy52ZWN0b3IueCkudG9EZWdyZWUoKSk7XG4gICAgICAgICAgICBpZiAodGhpcy5hbmdsZSA8IDApIHRoaXMuYW5nbGUgKz0gMzYwO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBTb3VuZFNldC5qc1xuICogIDIwMTQvMTEvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG5waGluYS5leHRlbnNpb24gPSBwaGluYS5leHRlbnNpb24gfHwge307XG5cbi8v44K144Km44Oz44OJ566h55CGXG5waGluYS5kZWZpbmUoXCJwaGluYS5leHRlbnNpb24uU291bmRTZXRcIiwge1xuXG4gICAgLy/jgrXjgqbjg7Pjg4njgYzmoLzntI3jgZXjgozjgovphY3liJdcbiAgICBlbGVtZW50czogbnVsbCxcblxuICAgIC8v5YaN55Sf5Lit77yi77yn77ytXG4gICAgYmdtOiBudWxsLFxuICAgIGJnbUlzUGxheTogZmFsc2UsXG5cbiAgICAvL+ODnuOCueOCv+ODvOODnOODquODpeODvOODoFxuICAgIHZvbHVtZUJHTTogMC41LFxuICAgIHZvbHVtZVNFOiAwLjUsXG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50cyA9IFtdO1xuICAgIH0sXG5cbiAgICAvL+eZu+mMsua4iOOBv+OCouOCu+ODg+ODiOiqreOBv+i+vOOBv1xuICAgIHJlYWRBc3NldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuYXNzZXRzLnNvdW5kKSB7XG4gICAgICAgICAgICB2YXIgb2JqID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcInNvdW5kXCIsIGtleSk7XG4gICAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgcGhpbmEuYXNzZXQuU291bmQpIHRoaXMuYWRkKGtleSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/jgrXjgqbjg7Pjg4nov73liqBcbiAgICBhZGQ6IGZ1bmN0aW9uKG5hbWUsIHVybCkge1xuICAgICAgICBpZiAobmFtZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gbnVsbDtcbiAgICAgICAgdXJsID0gdXJsIHx8IG51bGw7XG4gICAgICAgIGlmICh0aGlzLmZpbmQobmFtZSkpIHJldHVybiB0cnVlO1xuXG4gICAgICAgIHZhciBlID0gcGhpbmEuZXh0ZW5zaW9uLlNvdW5kRWxlbWVudChuYW1lKTtcbiAgICAgICAgaWYgKCFlLm1lZGlhKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHRoaXMuZWxlbWVudHMucHVzaChlKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K144Km44Oz44OJ5qSc57SiXG4gICAgZmluZDogZnVuY3Rpb24obmFtZSkge1xuICAgICAgICBpZiAoIXRoaXMuZWxlbWVudHMpIHJldHVybiBudWxsO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnRzW2ldLm5hbWUgPT0gbmFtZSkgcmV0dXJuIHRoaXMuZWxlbWVudHNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIC8v44K144Km44Oz44OJ44KS77yi77yn77yt44Go44GX44Gm5YaN55SfXG4gICAgcGxheUJHTTogZnVuY3Rpb24obmFtZSwgbG9vcCwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGxvb3AgPT09IHVuZGVmaW5lZCkgbG9vcCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLmJnbSkge1xuICAgICAgICAgICAgdGhpcy5iZ20uc3RvcCgpO1xuICAgICAgICAgICAgdGhpcy5iZ21Jc1BsYXkgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZmluZChuYW1lKTtcbiAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciB2b2wgPSB0aGlzLnZvbHVtZUJHTSAqIGVsZW1lbnQuX3ZvbHVtZTtcbiAgICAgICAgICAgIGVsZW1lbnQubWVkaWEudm9sdW1lID0gdm9sO1xuICAgICAgICAgICAgZWxlbWVudC5wbGF5KGxvb3AsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIHRoaXMuYmdtID0gZWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMuYmdtSXNQbGF5ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFkZChuYW1lKSkgdGhpcy5wbGF5QkdNKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL++8ou+8p++8reWBnOatolxuICAgIHN0b3BCR006IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5iZ20pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJnbUlzUGxheSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYmdtLnN0b3AoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJnbUlzUGxheSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5iZ20gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL++8ou+8p++8reS4gOaZguWBnOatolxuICAgIHBhdXNlQkdNOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuYmdtKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5iZ21Jc1BsYXkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJnbS5wYXVzZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYmdtSXNQbGF5ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v77yi77yn77yt5YaN6ZaLXG4gICAgcmVzdW1lQkdNOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuYmdtKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYmdtSXNQbGF5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5iZ20udm9sdW1lID0gdGhpcy52b2x1bWVCR007XG4gICAgICAgICAgICAgICAgdGhpcy5iZ20ucmVzdW1lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5iZ21Jc1BsYXkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL++8ou+8p++8reODnuOCueOCv+ODvOODnOODquODpeODvOODoOioreWumlxuICAgIHNldFZvbHVtZUJHTTogZnVuY3Rpb24odm9sKSB7XG4gICAgICAgIHRoaXMudm9sdW1lQkdNID0gdm9sO1xuICAgICAgICBpZiAodGhpcy5iZ20pIHtcbiAgICAgICAgICAgIHRoaXMuYmdtLnBhdXNlKCk7XG4gICAgICAgICAgICB0aGlzLmJnbS5zZXRWb2x1bWUodGhpcy52b2x1bWVCR00gKiB0aGlzLmJnbS5fdm9sdW1lKTtcbiAgICAgICAgICAgIHRoaXMuYmdtLnJlc3VtZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+OCouOCu+ODg+ODiOOCkuaMh+WumuOBl+OBpuODnOODquODpeODvOODoOOCkuioreWumlxuICAgIHNldFZvbHVtZTogZnVuY3Rpb24obmFtZSwgdm9sKSB7XG4gICAgICAgIHZhciBtZWRpYSA9IHRoaXMuZmluZChuYW1lKTtcbiAgICAgICAgaWYgKG1lZGlhKSB7XG4gICAgICAgICAgICBtZWRpYS5zZXRWb2x1bWUodm9sKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/jgrXjgqbjg7Pjg4njgpLjgrXjgqbjg7Pjg4njgqjjg5Xjgqfjgq/jg4jjgajjgZfjgablho3nlJ9cbiAgICBwbGF5U0U6IGZ1bmN0aW9uKG5hbWUsIGxvb3AsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5maW5kKG5hbWUpO1xuICAgICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHZvbCA9IHRoaXMudm9sdW1lU0UgKiBlbGVtZW50Ll92b2x1bWU7XG4gICAgICAgICAgICBlbGVtZW50Lm1lZGlhLnZvbHVtZSA9IHZvbDtcbiAgICAgICAgICAgIGVsZW1lbnQucGxheShsb29wLCBjYWxsYmFjayk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hZGQobmFtZSkpIHRoaXMucGxheVNFKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+ODq+ODvOODl+WGjeeUn+OBl+OBpuOBhOOCi1NF44KS5YGc5q2iXG4gICAgc3RvcFNFOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgIHZhciBtZWRpYSA9IHRoaXMuZmluZChuYW1lKTtcbiAgICAgICAgaWYgKG1lZGlhKSB7XG4gICAgICAgICAgICBtZWRpYS5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v77yi77yn77yt5LiA5pmC5YGc5q2iXG4gICAgcGF1c2VCR006IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5iZ20pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJnbUlzUGxheSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5iZ21Jc1BsYXkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/vvLPvvKXjg57jgrnjgr/jg7zjg5zjg6rjg6Xjg7zjg6DoqK3lrppcbiAgICBzZXRWb2x1bWVTRTogZnVuY3Rpb24odm9sKSB7XG4gICAgICAgIHRoaXMudm9sdW1lU0UgPSB2b2w7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcblxuLy9Tb3VuZEVsZW1lbnQgQmFzaWNcbnBoaW5hLmRlZmluZShcInBoaW5hLmV4dGVuc2lvbi5Tb3VuZEVsZW1lbnRcIiwge1xuICAgIC8v44K144Km44Oz44OJ5ZCNXG4gICAgbmFtZTogbnVsbCxcblxuICAgIC8v77y177yy77ysXG4gICAgdXJsOiBudWxsLFxuXG4gICAgLy/jgrXjgqbjg7Pjg4nmnKzkvZNcbiAgICBtZWRpYTogbnVsbCxcblxuICAgIC8v44Oc44Oq44Ol44O844OgXG4gICAgX3ZvbHVtZTogMSxcblxuICAgIC8v5YaN55Sf57WC5LqG5pmC44Gu44Kz44O844Or44OQ44OD44Kv6Zai5pWwXG4gICAgY2FsbGJhY2s6IG51bGwsXG5cbiAgICAvL+WGjeeUn+S4reODleODqeOCsFxuICAgIHBsYXlpbmc6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24obmFtZSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLm1lZGlhID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcInNvdW5kXCIsIG5hbWUpO1xuICAgICAgICBpZiAodGhpcy5tZWRpYSkge1xuICAgICAgICAgICAgdGhpcy5tZWRpYS52b2x1bWUgPSAxO1xuICAgICAgICAgICAgdGhpcy5tZWRpYS5vbignZW5kZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tZWRpYS5sb29wKSB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYWxsYmFjaykgdGhpcy5jYWxsYmFjaygpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiYXNzZXQgbm90IGZvdW5kLiBcIituYW1lKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+OCteOCpuODs+ODieOBruWGjeeUn1xuICAgIHBsYXk6IGZ1bmN0aW9uKGxvb3AsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmIChsb29wID09PSB1bmRlZmluZWQpIGxvb3AgPSBmYWxzZVxuICAgICAgICBpZiAoIXRoaXMubWVkaWEpIHJldHVybiB0aGlzO1xuXG4gICAgICAgIC8v44Or44O844OX5YaN55Sf44Gu5aC05ZCI5aSa6YeN5YaN55Sf44KS56aB5q2iXG4gICAgICAgIGlmIChsb29wICYmIHRoaXMucGxheWluZykgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMubWVkaWEubG9vcCA9IGxvb3A7XG4gICAgICAgIHRoaXMubWVkaWEucGxheSgpO1xuICAgICAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgICAgIHRoaXMucGxheWluZyA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+OCteOCpuODs+ODieWGjeeUn+WGjemWi1xuICAgIHJlc3VtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghdGhpcy5tZWRpYSkgcmV0dXJuIHRoaXM7XG4gICAgICAgIHRoaXMubWVkaWEucmVzdW1lKCk7XG4gICAgICAgIHRoaXMucGxheWluZyA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+OCteOCpuODs+ODieS4gOaZguWBnOatolxuICAgIHBhdXNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5tZWRpYSkgcmV0dXJuIHRoaXM7XG4gICAgICAgIHRoaXMubWVkaWEucGF1c2UoKTtcbiAgICAgICAgdGhpcy5wbGF5aW5nID0gZmFsc2U7XG4gICAgfSxcblxuICAgIC8v44K144Km44Oz44OJ5YGc5q2iXG4gICAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghdGhpcy5tZWRpYSkgcmV0dXJuIHRoaXM7XG4gICAgICAgIHRoaXMubWVkaWEuc3RvcCgpO1xuICAgICAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44Oc44Oq44Ol44O844Og6Kit5a6aXG4gICAgc2V0Vm9sdW1lOiBmdW5jdGlvbih2b2wpIHtcbiAgICAgICAgaWYgKCF0aGlzLm1lZGlhKSByZXR1cm4gdGhpcztcbiAgICAgICAgaWYgKHZvbCA9PT0gdW5kZWZpbmVkKSB2b2wgPSAwLjU7XG4gICAgICAgIHRoaXMuX3ZvbHVtZSA9IHZvbDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuICAgICAgICB2b2x1bWU6IHtcbiAgICAgICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5fdm9sdW1lOyB9LFxuICAgICAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odm9sKSB7IHRoaXMuc2V0Vm9sdW1lKHZvbCk7IH1cbiAgICAgICAgfSxcbiAgICAgICAgbG9vcDoge1xuICAgICAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLm1lZGlhLmxvb3A7IH0sXG4gICAgICAgICAgICBcInNldFwiOiBmdW5jdGlvbihmKSB7IHRoaXMubWVkaWEubG9vcCA9IGY7IH1cbiAgICAgICAgfSxcbiAgICB9XG59KTtcbiIsIi8qXG4gKiAgYXBwbGljYXRpb24uanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL25hbWVzcGFhY2UgUXVlc3QgRm9yIHRoZSBUYW5lbG9yblxudmFyIHFmdCA9IHt9O1xuXG5waGluYS5kZWZpbmUoXCJxZnQuQXBwbGljYXRpb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5DYW52YXNBcHBcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7XG4gICAgICAgICAgICBxdWVyeTogJyN3b3JsZCcsXG4gICAgICAgICAgICB3aWR0aDogU0NfVyxcbiAgICAgICAgICAgIGhlaWdodDogU0NfSCxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMCwgMCwgMCwgMSknLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5mcHMgPSBGUFM7XG5cbiAgICAgICAgLy/jgrLjg7zjg6Djg5Hjg4Pjg4nnrqHnkIZcbiAgICAgICAgdGhpcy5nYW1lcGFkTWFuYWdlciA9IHBoaW5hLmlucHV0LkdhbWVwYWRNYW5hZ2VyKCk7XG4gICAgICAgIHRoaXMuZ2FtZXBhZCA9IHRoaXMuZ2FtZXBhZE1hbmFnZXIuZ2V0KDApO1xuXG4gICAgICAgIC8v44OQ44O844OB44Oj44Or44OR44OD44OJXG4gICAgICAgIHRoaXMudmlydHVhbFBhZCA9IHBoaW5hLmV4dGVuc2lvbi5WaXJ0dWFsUGFkKHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSkuc2V0UG9zaXRpb24oMCwgMCk7XG5cbiAgICAgICAgLy/jg5Hjg4Pjg4nmg4XloLHjgpLmm7TmlrBcbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5nYW1lcGFkTWFuYWdlci51cGRhdGUoKTtcbiAgICAgICAgICAgIHRoaXMudmlydHVhbFBhZC51cGRhdGVJbmZvKCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xsZXIoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IHt9O1xuXG4gICAgICAgIC8v44K144Km44Oz44OJ44K744OD44OIXG4gICAgICAgIHRoaXMuc291bmRzZXQgPSBwaGluYS5leHRlbnNpb24uU291bmRTZXQoKTtcblxuICAgICAgICAvL0xhYmVs44OH44OV44Kp44Or44OI6Kit5a6aXG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwuZGVmYXVsdHMuJGV4dGVuZCh7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmx1ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMzIsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdXBkYXRlQ29udHJvbGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBiZWZvcmUgPSB0aGlzLmNvbnRyb2xsZXI7XG4gICAgICAgIGJlZm9yZS5iZWZvcmUgPSBudWxsO1xuXG4gICAgICAgIHZhciBncCA9IHRoaXMuZ2FtZXBhZDtcbiAgICAgICAgdmFyIGtiID0gdGhpcy5rZXlib2FyZDtcbiAgICAgICAgdmFyIGFuZ2xlMSA9IGdwLmdldEtleUFuZ2xlKCk7XG4gICAgICAgIHZhciBhbmdsZTIgPSBrYi5nZXRLZXlBbmdsZSgpO1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSB7XG4gICAgICAgICAgICBhbmdsZTogYW5nbGUxICE9PSBudWxsPyBhbmdsZTE6IGFuZ2xlMixcblxuICAgICAgICAgICAgdXA6IGdwLmdldEtleShcInVwXCIpIHx8IGtiLmdldEtleShcInVwXCIpLFxuICAgICAgICAgICAgZG93bjogZ3AuZ2V0S2V5KFwiZG93blwiKSB8fCBrYi5nZXRLZXkoXCJkb3duXCIpLFxuICAgICAgICAgICAgbGVmdDogZ3AuZ2V0S2V5KFwibGVmdFwiKSB8fCBrYi5nZXRLZXkoXCJsZWZ0XCIpLFxuICAgICAgICAgICAgcmlnaHQ6IGdwLmdldEtleShcInJpZ2h0XCIpIHx8IGtiLmdldEtleShcInJpZ2h0XCIpLFxuXG4gICAgICAgICAgICBhdHRhY2s6IGdwLmdldEtleShcIlhcIikgfHwga2IuZ2V0S2V5KFwiWlwiKSxcbiAgICAgICAgICAgIGp1bXA6ICAgZ3AuZ2V0S2V5KFwidXBcIikgfHwgZ3AuZ2V0S2V5KFwiQVwiKSB8fCBrYi5nZXRLZXkoXCJ1cFwiKSB8fCBrYi5nZXRLZXkoXCJYXCIpLFxuICAgICAgICAgICAgY2hhbmdlOiBncC5nZXRLZXkoXCJCXCIpIHx8IGtiLmdldEtleShcIkNcIiksXG4gICAgICAgICAgICBtZW51OiAgIGdwLmdldEtleShcInN0YXJ0XCIpIHx8IGtiLmdldEtleShcImVzY2FwZVwiKSxcblxuICAgICAgICAgICAgYTogZ3AuZ2V0S2V5KFwiQVwiKSB8fCBrYi5nZXRLZXkoXCJaXCIpLFxuICAgICAgICAgICAgYjogZ3AuZ2V0S2V5KFwiQlwiKSB8fCBrYi5nZXRLZXkoXCJYXCIpLFxuICAgICAgICAgICAgeDogZ3AuZ2V0S2V5KFwiWFwiKSB8fCBrYi5nZXRLZXkoXCJDXCIpLFxuICAgICAgICAgICAgeTogZ3AuZ2V0S2V5KFwiWVwiKSB8fCBrYi5nZXRLZXkoXCJWXCIpLFxuXG4gICAgICAgICAgICBvazogZ3AuZ2V0S2V5KFwiQVwiKSB8fCBrYi5nZXRLZXkoXCJaXCIpIHx8IGtiLmdldEtleShcInNwYWNlXCIpIHx8IGtiLmdldEtleShcInJldHVyblwiKSxcbiAgICAgICAgICAgIGNhbmNlbDogZ3AuZ2V0S2V5KFwiQlwiKSB8fCBrYi5nZXRLZXkoXCJYXCIpIHx8IGtiLmdldEtleShcImVzY2FwZVwiKSxcblxuICAgICAgICAgICAgc3RhcnQ6IGdwLmdldEtleShcInN0YXJ0XCIpIHx8IGtiLmdldEtleShcInJldHVyblwiKSxcbiAgICAgICAgICAgIHNlbGVjdDogZ3AuZ2V0S2V5KFwic2VsZWN0XCIpLFxuXG4gICAgICAgICAgICBwYXVzZTogZ3AuZ2V0S2V5KFwic3RhcnRcIikgfHwga2IuZ2V0S2V5KFwiZXNjYXBlXCIpLFxuXG4gICAgICAgICAgICBhbmFsb2cxOiBncC5nZXRTdGlja0RpcmVjdGlvbigwKSxcbiAgICAgICAgICAgIGFuYWxvZzI6IGdwLmdldFN0aWNrRGlyZWN0aW9uKDEpLFxuXG4gICAgICAgICAgICAvL+WJjeODleODrOODvOODoOaDheWgsVxuICAgICAgICAgICAgYmVmb3JlOiBiZWZvcmUsXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIF9vbkxvYWRBc3NldHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNvdW5kc2V0LnJlYWRBc3NldCgpO1xuXG4gICAgICAgIC8v54m55q6K5Yq55p6c55So44OT44OD44OI44Oe44OD44OX5L2c5oiQXG4gICAgICAgIFtcbiAgICAgICAgICAgIFwicGxheWVyMVwiLFxuICAgICAgICAgICAgXCJwbGF5ZXIyXCIsXG4gICAgICAgIF0uZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICBpZiAoIXBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoXCJpbWFnZVwiLCBuYW1lKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAvL+ODgOODoeODvOOCuOeUqFxuICAgICAgICAgICAgaWYgKCFwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KFwiaW1hZ2VcIiwgbmFtZStcIldoaXRlXCIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRleCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoXCJpbWFnZVwiLCBuYW1lKS5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHRleC5maWx0ZXIoIGZ1bmN0aW9uKHBpeGVsLCBpbmRleCwgeCwgeSwgYml0bWFwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gYml0bWFwLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMF0gPSAocGl4ZWxbMF0gPT0gMD8gMDogMTI4KTsgLy9yXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMV0gPSAocGl4ZWxbMV0gPT0gMD8gMDogMTI4KTsgLy9nXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMl0gPSAocGl4ZWxbMl0gPT0gMD8gMDogMTI4KTsgLy9iXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLnNldChcImltYWdlXCIsIG5hbWUrXCJXaGl0ZVwiLCB0ZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/ngJXmrbvnlKhcbiAgICAgICAgICAgIGlmICghcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUrXCJSZWRcIikpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUpLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgdGV4LmZpbHRlciggZnVuY3Rpb24ocGl4ZWwsIGluZGV4LCB4LCB5LCBiaXRtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBiaXRtYXAuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCswXSA9IHBpeGVsWzBdO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2luZGV4KzFdID0gMDtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCsyXSA9IDA7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLnNldChcImltYWdlXCIsIG5hbWUrXCJSZWRcIiwgdGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v5b2x55SoXG4gICAgICAgICAgICBpZiAoIXBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoXCJpbWFnZVwiLCBuYW1lK1wiQmxhY2tcIikpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUpLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgdGV4LmZpbHRlciggZnVuY3Rpb24ocGl4ZWwsIGluZGV4LCB4LCB5LCBiaXRtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBiaXRtYXAuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCswXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMV0gPSAwO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2luZGV4KzJdID0gMDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuc2V0KFwiaW1hZ2VcIiwgbmFtZStcIkJsYWNrXCIsIHRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBwbGF5QkdNOiBmdW5jdGlvbihhc3NldCwgbG9vcCwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGxvb3AgPT09IHVuZGVmaW5lZCkgbG9vcCA9IHRydWU7XG4gICAgICAgIHRoaXMuc291bmRzZXQucGxheUJHTShhc3NldCwgbG9vcCwgY2FsbGJhY2spO1xuICAgIH0sXG5cbiAgICBzdG9wQkdNOiBmdW5jdGlvbihhc3NldCkge1xuICAgICAgICB0aGlzLnNvdW5kc2V0LnN0b3BCR00oKTtcbiAgICB9LFxuXG4gICAgc2V0Vm9sdW1lQkdNOiBmdW5jdGlvbih2b2wpIHtcbiAgICAgICAgaWYgKHZvbCA+IDEpIHZvbCA9IDE7XG4gICAgICAgIGlmICh2b2wgPCAwKSB2b2wgPSAwO1xuICAgICAgICB0aGlzLnNvdW5kc2V0LnNldFZvbHVtZUJHTSh2b2wpO1xuICAgIH0sXG5cbiAgICBwbGF5U0U6IGZ1bmN0aW9uKGFzc2V0LCBsb29wKSB7XG4gICAgICAgIGlmIChsb29wID09PSB1bmRlZmluZWQpIGxvb3AgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zb3VuZHNldC5wbGF5U0UoYXNzZXQsIGxvb3ApO1xuICAgIH0sXG5cbiAgICBzZXRWb2x1bWVTRTogZnVuY3Rpb24odm9sKSB7XG4gICAgICAgIGlmICh2b2wgPiAxKSB2b2wgPSAxO1xuICAgICAgICBpZiAodm9sIDwgMCkgdm9sID0gMDtcbiAgICAgICAgdGhpcy5zb3VuZHNldC5zZXRWb2x1bWVTRSh2b2wpO1xuICAgIH0sXG5cbiAgICBzZXRWb2x1bWU6IGZ1bmN0aW9uKGFzc2V0LCB2b2wpIHtcbiAgICAgICAgdGhpcy5zb3VuZHNldC5zZXRWb2x1bWUoYXNzZXQsIHZvbCk7XG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuICAgICAgICB2b2x1bWVCR006IHtcbiAgICAgICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5zb3VuZHMudm9sdW1lQkdNOyB9LFxuICAgICAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odm9sKSB7IHRoaXMuc2V0Vm9sdW1lQkdNKHZvbCk7IH1cbiAgICAgICAgfSxcbiAgICAgICAgdm9sdW1lU0U6IHtcbiAgICAgICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5zb3VuZHMudm9sdW1lU0U7IH0sXG4gICAgICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2b2wpIHsgdGhpcy5zZXRWb2x1bWVTRSh2b2wpOyB9XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiIsIi8qXG4gKiAgYXNzZXQuanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuQXNzZXRzXCIsIHtcbiAgICBfc3RhdGljOiB7XG4gICAgICAgIGxvYWRlZDogW10sXG4gICAgICAgIGlzTG9hZGVkOiBmdW5jdGlvbihhc3NldFR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybiBxZnQuQXNzZXRzLmxvYWRlZFthc3NldFR5cGVdPyB0cnVlOiBmYWxzZTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgICAgICBxZnQuQXNzZXRzLmxvYWRlZFtvcHRpb25zLmFzc2V0VHlwZV0gPSB0cnVlO1xuICAgICAgICAgICAgc3dpdGNoIChvcHRpb25zLmFzc2V0VHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzcGxhc2hcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJvcGVuaW5nbWFwXCI6ICAgXCJhc3NldHMvaW1hZ2Uvb3BlbmluZ19tYXAuanBnXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJvcGVuaW5ndG93ZXJcIjogXCJhc3NldHMvaW1hZ2Uvb3BlbmluZ190b3dlci5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmdncm91bmRcIjpcImFzc2V0cy9pbWFnZS9vcGVuaW5nX2dyb3VuZC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmdiYWNrXCI6ICBcImFzc2V0cy9pbWFnZS9vcGVuaW5nX2JhY2sucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJvcGVuaW5nYmFjazJcIjogXCJhc3NldHMvaW1hZ2Uvb3BlbmluZ19iZ19qYW4uanBnXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJvcGVuaW5nbGlnaHRcIjogXCJhc3NldHMvaW1hZ2Uvb3BlbmluZ190cmVlX2xpZ2h0X3llbGxvdy5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBsYXllcjFcIjogICAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjQucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiYWNrZ3JvdW5kXCI6ICAgXCJhc3NldHMvaW1hZ2UvYmFjay1zMDNiLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3BsYXNoMlwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291bmQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmdiZ21cIjogICBcImFzc2V0cy9zb3VuZC9EUy0wNzBtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY29tbW9uXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3I0XCI6ICAgIFwiYXNzZXRzL2ltYWdlL2FjdG9yNC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yMTlcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3IxOS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yNDBcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3I0MC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yNTVcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3I1NS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yNjRcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3I2NF9hLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3I2NDJcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3I2NF9iLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3IxMDhcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3IxMDgucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhY3RvcjExMVwiOiAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjExMS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yMTEyXCI6ICAgIFwiYXNzZXRzL2ltYWdlL2FjdG9yMTEyLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwid2VhcG9uc1wiOiAgICBcImFzc2V0cy9pbWFnZS93ZWFwb25zLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXRlbVwiOiAgICAgICBcImFzc2V0cy9pbWFnZS9pdGVtLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXRlbWJveFwiOiAgICBcImFzc2V0cy9pbWFnZS90YWthcmFiYWtvLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGFydGljbGVcIjogICBcImFzc2V0cy9pbWFnZS9wYXJ0aWNsZS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRvb3JcIjogICAgICAgXCJhc3NldHMvaW1hZ2UvZG9vci5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNoZWNraWNvblwiOiAgXCJhc3NldHMvaW1hZ2UvY2hlY2sgaWNvbl8wMC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlYmFja1wiOiAgXCJhc3NldHMvaW1hZ2UvdGl0bGViYWNrLnBuZ1wiLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1lbnVmcmFtZVwiOiAgXCJhc3NldHMvaW1hZ2UvbmM5MjM2Ny5wbmdcIixcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9uc3RlcjAxXCI6ICBcImFzc2V0cy9pbWFnZS9tb25zdGVyMDEucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtb25zdGVyMDJcIjogIFwiYXNzZXRzL2ltYWdlL2NoYXJfbV9kZXZpbDAxLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9uc3RlcjAzXCI6ICBcImFzc2V0cy9pbWFnZS9jaGFyX21fbWFnaTAxLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9uc3RlcjAxeDJcIjogIFwiYXNzZXRzL2ltYWdlL21vbnN0ZXIwMXgyLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9uc3RlcjAyeDJcIjogIFwiYXNzZXRzL2ltYWdlL2NoYXJfbV9kZXZpbDAxeDIucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJidWxsZXRcIjogICAgIFwiYXNzZXRzL2ltYWdlL2VmZmVjdF9idWxsZXQwMS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVmZmVjdFwiOiAgICAgXCJhc3NldHMvaW1hZ2UvZWZmZWN0LnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZWZmZWN0MlwiOiAgICBcImFzc2V0cy9pbWFnZS9lZmZlY3QwMWEucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJnYXRlXCI6ICAgICAgIFwiYXNzZXRzL2ltYWdlL2dhdGUucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmbGFtZTAyXCI6ICAgIFwiYXNzZXRzL2ltYWdlL29iamVjdF9maXJlMDJhLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmxhbWUwM1wiOiAgICBcImFzc2V0cy9pbWFnZS9vYmplY3RfZmlyZTAzYS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZsYW1lMDVcIjogICAgXCJhc3NldHMvaW1hZ2Uvb2JqZWN0X2ZpcmUwNWEucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhY2Nlc3NvcnkxXCI6IFwiYXNzZXRzL2ltYWdlL21hcF9lZmZlY3QyLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmxvY2tcIjogICAgICBcImFzc2V0cy9pbWFnZS9ibG9jay5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZsb29yXCI6ICAgICAgXCJhc3NldHMvbWFwL1RpbGVBNC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhbGxvb25cIjogICAgXCJhc3NldHMvaW1hZ2UvY2hhcmEwOV9jMS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNoYWRvd1wiOiAgICAgXCJhc3NldHMvaW1hZ2Uvc2hhZG93LnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjbGlja1wiOiAgICAgIFwiYXNzZXRzL3NvdW5kL3NlX21hb3VkYW1hc2hpaV9zeXN0ZW00NC5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9rXCI6ICAgICAgICAgXCJhc3NldHMvc291bmQvc2VfbWFvdWRhbWFzaGlpX3N5c3RlbTM2Lm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2FuY2VsXCI6ICAgICBcImFzc2V0cy9zb3VuZC9zZV9tYW91ZGFtYXNoaWlfc3lzdGVtNDMubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhdHRhY2tcIjogICAgIFwiYXNzZXRzL3NvdW5kL3Nlbl9rYV9rYXRhbmFfc2FzaW51a3UwMS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhpdFwiOiAgICAgICAgXCJhc3NldHMvc291bmQvc2VuX2thX2thdGFuYV9zYXN1MDEubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJoaXRfYmx1bnRcIjogIFwiYXNzZXRzL3NvdW5kL3Nlbl9ibHVudC5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRhbWFnZVwiOiAgICAgXCJhc3NldHMvc291bmQvc2VfbWFvdWRhbWFzaGlpX2JhdHRsZTEyLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXJyb3dzdGlja1wiOiBcImFzc2V0cy9zb3VuZC9zZW5fa2FfeWEwMy5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YWdlY2xlYXJcIjogXCJhc3NldHMvc291bmQvRFMtMDMwbS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImdhbWVvdmVyXCI6ICAgXCJhc3NldHMvc291bmQvZ2FtZW92ZXIzLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZ2V0a2V5aXRlbVwiOiBcImFzc2V0cy9zb3VuZC9zZV9tYW91ZGFtYXNoaWlfb25lcG9pbnQyMy5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJvbWJcIjogICAgICAgXCJhc3NldHMvc291bmQvc2VuX2dlX3RhaWhvdTAzLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2VsZWN0XCI6ICAgICBcImFzc2V0cy9zb3VuZC9zZV9tYW91ZGFtYXNoaWlfc3lzdGVtNDUubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJnZXRpdGVtXCI6ICAgIFwiYXNzZXRzL3NvdW5kL2F0YV9hNDkubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyZWNvdmVyeVwiOiAgIFwiYXNzZXRzL3NvdW5kL3NlX21hb3VkYW1hc2hpaV9tYWdpY2FsMDEubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aW5rbGluZ1wiOiAgIFwiYXNzZXRzL3NvdW5kL3RpbmtsaW5nLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaG9seTFcIjogICAgICBcImFzc2V0cy9zb3VuZC9ob2x5MS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJnbTFcIjogICAgICAgXCJhc3NldHMvc291bmQvRFMtYmEwMW0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVWJ1bnR1TW9ub1wiOiBcImFzc2V0cy9mb250L1VidW50dU1vbm8tQm9sZC50dGZcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlZm9udDFcIjogXCJhc3NldHMvZm9udC90ZXV0b25pYzQudHRmXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aXRsZWZvbnQyXCI6IFwiYXNzZXRzL2ZvbnQvR290aFN0ZW5jaWxfUHJlbWl1bS50dGZcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0bXg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YWdlMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2UxLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U5OTlcIjogXCJhc3NldHMvbWFwL3N0YWdlOTk5LnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2UyXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtMlwiOiBcImFzc2V0cy9zb3VuZC9EUy0wMzVtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UyXzFcIjogXCJhc3NldHMvbWFwL3N0YWdlMl8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2UzXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtM1wiOiBcImFzc2V0cy9zb3VuZC9EUy0wNDFtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UzXzFcIjogXCJhc3NldHMvbWFwL3N0YWdlM18xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UzXzJcIjogXCJhc3NldHMvbWFwL3N0YWdlM18yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UzXzNcIjogXCJhc3NldHMvbWFwL3N0YWdlM18zLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U0XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtNFwiOiBcImFzc2V0cy9zb3VuZC9EUy0wNzZtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U0XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlNF8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U0XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlNF8yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U1XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtNVwiOiBcImFzc2V0cy9zb3VuZC9EUy0wODltLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U1XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlNV8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U1XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlNV8yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U2XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtNlwiOiBcImFzc2V0cy9zb3VuZC9EUy0wNjBtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U2XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlNl8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U2XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlNl8yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U3XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtN1wiOiBcImFzc2V0cy9zb3VuZC9EUy0xMDVtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U3XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlN18xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U3XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlN18yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U3XzNcIjogXCJhc3NldHMvbWFwL3N0YWdlN18zLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U4XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtOFwiOiBcImFzc2V0cy9zb3VuZC9EUy0wNjRtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U4XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlOF8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U4XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlOF8yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U5XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtOVwiOiBcImFzc2V0cy9zb3VuZC9EUy0wNjRtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U5XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlOV8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2UxMFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291bmQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVuZGluZ1wiOiBcImFzc2V0cy9zb3VuZC9EUy0wNzFtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UxMFwiOiBcImFzc2V0cy9tYXAvc3RhZ2UxMC50bXhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgXCJpbnZhbGlkIGFzc2V0VHlwZTogXCIgKyBvcHRpb25zLmFzc2V0VHlwZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICB9LFxufSk7XG5cbiIsIi8qXG4gKiAgQmVucmkuanNcbiAqICAyMDE0LzEyLzE4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuIFxudmFyIHRvUmFkID0gMy4xNDE1OS8xODA7ICAgIC8v5byn5bqm5rOVdG/jg6njgrjjgqLjg7PlpInmj5tcbnZhciB0b0RlZyA9IDE4MC8zLjE0MTU5OyAgICAvL+ODqeOCuOOCouODs3Rv5byn5bqm5rOV5aSJ5o+bXG5cbi8v6Led6Zui6KiI566XXG52YXIgZGlzdGFuY2UgPSBmdW5jdGlvbihmcm9tLCB0bykge1xuICAgIHZhciB4ID0gZnJvbS54LXRvLng7XG4gICAgdmFyIHkgPSBmcm9tLnktdG8ueTtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KHgqeCt5KnkpO1xufVxuXG4vL+i3nembouioiOeul++8iOODq+ODvOODiOeEoeOBl+eJiO+8iVxudmFyIGRpc3RhbmNlU3EgPSBmdW5jdGlvbihmcm9tLCB0bykge1xuICAgIHZhciB4ID0gZnJvbS54IC0gdG8ueDtcbiAgICB2YXIgeSA9IGZyb20ueSAtIHRvLnk7XG4gICAgcmV0dXJuIHgqeCt5Knk7XG59XG5cbi8v5pWw5YCk44Gu5Yi26ZmQXG52YXIgY2xhbXAgPSBmdW5jdGlvbih4LCBtaW4sIG1heCkge1xuICAgIHJldHVybiAoeDxtaW4pP21pbjooKHg+bWF4KT9tYXg6eCk7XG59O1xuXG4vL+S5seaVsOeUn+aIkFxudmFyIHByYW5kID0gcGhpbmEudXRpbC5SYW5kb20oKTtcbnZhciByYW5kID0gZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICByZXR1cm4gcHJhbmQucmFuZGludChtaW4sIG1heCk7XG59XG5cbi8v44K/44Kk44OI44Or54Sh44GX44OA44Kk44Ki44Ot44KwXG52YXIgQWR2YW5jZUFsZXJ0ID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgdmFyIHRtcEZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgdG1wRnJhbWUuc2V0QXR0cmlidXRlKCdzcmMnLCAnZGF0YTp0ZXh0L3BsYWluLCcpO1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0bXBGcmFtZSk7XG5cbiAgICB3aW5kb3cuZnJhbWVzWzBdLndpbmRvdy5hbGVydChzdHIpO1xuICAgIHRtcEZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodG1wRnJhbWUpO1xufTtcbnZhciBBZHZhbmNlQ29uZmlybSA9IGZ1bmN0aW9uKHN0cikge1xuICAgIHZhciB0bXBGcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgIHRtcEZyYW1lLnNldEF0dHJpYnV0ZSgnc3JjJywgJ2RhdGE6dGV4dC9wbGFpbiwnKTtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodG1wRnJhbWUpO1xuXG4gICAgdmFyIHJlc3VsdCA9IHdpbmRvdy5mcmFtZXNbMF0ud2luZG93LmNvbmZpcm0oc3RyKTtcbiAgICB0bXBGcmFtZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRtcEZyYW1lKTtcblxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG4vL+aVsOWApOOCkuOCq+ODs+ODnue3qOmbhuOBl+OBpuaWh+Wtl+WIl+OBqOOBl+OBpuWHuuWKm1xuTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwiY29tbWFcIiwgIGZ1bmN0aW9uKCkge1xuICAgIHZhciBzdHIgPSB0aGlzKycnO1xuICAgIHZhciBsZW4gPSBzdHIubGVuZ3RoO1xuICAgIHZhciBvdXQgPSAnJztcbiAgICBmb3IgKHZhciBpID0gbGVuLTE7IGkgPiAtMTsgaS0tKSB7XG4gICAgICAgIG91dCA9IHN0cltpXStvdXQ7XG4gICAgICAgIGlmIChpICE9IDAgJiYgKGxlbi1pKSUzID09IDApIG91dCA9ICcsJytvdXQ7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG59KTtcbiIsIi8qXG4gKiAgbWFpbi5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8vcGhpbmEuZ2xvYmFsaXplKCk7XG5cbi8v44OH44OQ44OD44Kw44OV44Op44KwXG5jb25zdCBERUJVRyA9IGZhbHNlO1xuY29uc3QgREVCVUdfQ09MTElTSU9OID0gZmFsc2U7XG5jb25zdCBERUJVR19FWUVTSUdIVCA9IGZhbHNlO1xuY29uc3QgREVCVUdfTU9CSUxFID0gZmFsc2U7XG5cbi8v5a6a5pWwXG5jb25zdCBTQ19XID0gNTc2O1xuY29uc3QgU0NfSCA9IDMyNDtcbi8vIFNDX1cgPSA0ODA7XG4vLyBTQ19IID0gMzIwO1xuXG5jb25zdCBGUFMgPSAzMDtcblxuLy/jgqLjgqTjg4bjg6DvvKnvvKRcbmNvbnN0IElURU1fU0hPUlRTV09SRCA9IDA7XG5jb25zdCBJVEVNX0xPTkdTV09SRCA9IDE7XG5jb25zdCBJVEVNX0FYID0gMjtcbmNvbnN0IElURU1fU1BFQVIgPSAzO1xuY29uc3QgSVRFTV9CT1cgPSA0O1xuY29uc3QgSVRFTV9ST0QgPSA1O1xuY29uc3QgSVRFTV9CT09LID0gNjtcbmNvbnN0IElURU1fU0hJRUxEID0gNztcbmNvbnN0IElURU1fQVJNT1IgPSA4O1xuY29uc3QgSVRFTV9IQVQgPSA5O1xuY29uc3QgSVRFTV9CT09UUyA9IDEwO1xuY29uc3QgSVRFTV9HUk9WRSA9IDExO1xuY29uc3QgSVRFTV9SSU5HID0gMTI7XG5jb25zdCBJVEVNX1NDUk9MTCA9IDEzO1xuY29uc3QgSVRFTV9MRVRURVIgPSAxNDtcbmNvbnN0IElURU1fQ0FSRCA9IDE1O1xuY29uc3QgSVRFTV9LRVkgPSAxNjtcbmNvbnN0IElURU1fQ09JTiA9IDE3O1xuY29uc3QgSVRFTV9CQUcgPSAxODtcbmNvbnN0IElURU1fT1JCID0gMTk7XG5jb25zdCBJVEVNX1NUT05FID0gMjA7XG5jb25zdCBJVEVNX0pFV0VMID0gMjE7XG5jb25zdCBJVEVNX0pFV0VMQk9YID0gMjI7XG5jb25zdCBJVEVNX0FQUExFID0gMjQ7XG5jb25zdCBJVEVNX0hBUkIgPSAyNTtcbmNvbnN0IElURU1fTUVBVCA9IDI2O1xuY29uc3QgSVRFTV9QT1RJT04gPSAyNztcblxuLy/jgqTjg7Pjgrnjgr/jg7PjgrlcbmxldCBhcHA7XG5cbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICBhcHAgPSBxZnQuQXBwbGljYXRpb24oKTtcbiAgICBhcHAucmVwbGFjZVNjZW5lKHFmdC5TY2VuZUZsb3coKSk7XG5cbiAgICAvL+ODouODkOOCpOODq+WvvuW/nFxuICAgIGlmIChwaGluYS5pc01vYmlsZSgpKSB7XG4gICAgICAgIGFwcC5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgZnVuY3Rpb24gZHVtbXkoKSB7XG4gICAgICAgICAgICB2YXIgcyA9IHBoaW5hLmFzc2V0LlNvdW5kKCk7XG4gICAgICAgICAgICBzLmxvYWRGcm9tQnVmZmVyKCk7XG4gICAgICAgICAgICBzLnBsYXkoKS5zdG9wKCk7XG4gICAgICAgICAgICBhcHAuZG9tRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGR1bW15KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFwcC5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gZHVtbXkoKSB7XG4gICAgICAgIHZhciBjb250ZXh0ID0gcGhpbmEuYXNzZXQuU291bmQuZ2V0QXVkaW9Db250ZXh0KCk7XG4gICAgICAgIGNvbnRleHQucmVzdW1lKCk7XG4gICAgfSk7XG5cbiAgICBhcHAucnVuKCk7XG4vLyAgICBhcHAuZW5hYmxlU3RhdHMoKTtcbn07XG4iLCIvKlxuICogIGNvbmZpZ3NjZW5lLmpzXG4gKiAgMjAxNy8wMy8wMlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cbiBcbnBoaW5hLmRlZmluZShcInFmdC5Db25maWdTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuNSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDAuNSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuYmcuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuY2xlYXIoKS5mYWRlSW4oNTAwKTtcblxuICAgICAgICB0aGlzLnNjcm9sbCA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibWVudWZyYW1lXCIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSlcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjg1LCAxLjEpO1xuICAgICAgICB0aGlzLnNjcm9sbC5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMuc2Nyb2xsLnR3ZWVuZXIuY2xlYXIoKS5mYWRlSW4oNTAwKTtcblxuICAgICAgICB0aGlzLm1lbnVCYXNlID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcy5zY3JvbGwpO1xuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogNSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJ0aXRsZWZvbnQxXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDcwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRleHRMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiTWVudVwiLCBmb250U2l6ZTogMjB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAtU0NfSCowLjMpO1xuXG4gICAgICAgIC8v44Oh44OL44Ol44O844OG44Kt44K544OI6KGo56S6XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5tZW51ID0gW1wiU3lzdGVtXCIsIFwiUHJhY3RpY2VcIiwgXCJFeGl0XCJdO1xuICAgICAgICB0aGlzLm1lbnVUZXh0ID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tZW51Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W2ldID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogdGhpcy5tZW51W2ldLCBmb250U2l6ZTogNDB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKDAsIC1TQ19IKjAuMTUrU0NfSCowLjE1KmkpXG4gICAgICAgICAgICAgICAgLnNldFNjYWxlKDAuNyk7XG5cbiAgICAgICAgICAgIC8v44K/44OD44OB5Yik5a6a55SoXG4gICAgICAgICAgICB2YXIgcGFyYW0yID0ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiBTQ19XKjAuMyxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IFNDX0gqMC4xMCxcbiAgICAgICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0yKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKDAsIC1TQ19IKjAuMTUrU0NfSCowLjE1KmkpXG4gICAgICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICAgICAgYy5hbHBoYSA9IDA7XG4gICAgICAgICAgICBjLnNlbGVjdCA9IGk7XG4gICAgICAgICAgICBjLm9ucG9pbnRzdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LmlzU2VsZWN0ZWQgfHwgdGhhdC50aW1lIDwgMTApIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3QgPT0gdGhhdC5zZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5vayA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5tZW51VGV4dFt0aGF0LnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zZWxlY3QgPSB0aGlzLnNlbGVjdDtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5tZW51VGV4dFt0aGF0LnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2VsZWN0ID0gMDtcbiAgICAgICAgdGhpcy5zZWxlY3RNYXggPSAzO1xuICAgICAgICB0aGlzLm1lbnVUZXh0WzBdLnNldFNjYWxlKDEpO1xuICAgICAgICB0aGlzLm9rID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2Fuc2VsID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDtcblxuICAgICAgICB0aGlzLm9uKCdyZXN1bWUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMubWVudUJhc2UudHdlZW5lci5jbGVhcigpLmZhZGVJbig1MDApO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5vayA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5jYW5zZWwgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAoY3QuZG93biAmJiAhY3QuYmVmb3JlLmRvd24gJiYgdGhpcy5zZWxlY3QgPCB0aGlzLnNlbGVjdE1heC0xKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3QrKztcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAxMDtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN0LnVwICYmICFjdC5iZWZvcmUudXAgJiYgdGhpcy5zZWxlY3QgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3QtLTtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAxMDtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy50aW1lID4gMTUpIHtcbiAgICAgICAgICAgIC8v5rG65a6aXG4gICAgICAgICAgICBpZiAoY3Qub2sgfHwgdGhpcy5vaykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJva1wiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51QmFzZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LkNvbmZpZ1NjZW5lX1ByYWN0aWNlKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdCA9PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJjYW5jZWxcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhpdE1lbnUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jgq3jg6Pjg7Pjgrvjg6sgICAgICAgIFxuICAgICAgICAgICAgaWYgKGN0LmNhbmNlbCkge1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJjYW5jZWxcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5leGl0TWVudSgpO1xuICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcblxuICAgIGV4aXRNZW51OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLmNsZWFyKCkuZmFkZU91dCg1MDApO1xuICAgICAgICB0aGlzLnNjcm9sbC50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5mYWRlT3V0KDUwMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG59KTtcbiIsIi8qXG4gKiAgY29udmVyc2F0aW9uc2NlbmUuanNcbiAqICAyMDE3LzA4LzE3XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+S8muipseihqOekuuOCt+ODvOODsyBcbnBoaW5hLmRlZmluZShcInFmdC5Db252ZXJzYXRpb25TY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oY3VycmVudFNjZW5lLCB0ZXh0KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIHRoaXMuY3VycmVudFNjZW5lID0gY3VycmVudFNjZW5lO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Gu55S76Z2i5LiK5L2N572u44Gr44KI44KK44OV44Os44O844Og44Gu57im5L2N572u44KS5aSJ5pu0XG4gICAgICAgIHZhciBmcmFtZVkgPSBTQ19IICogMC4yNTtcbiAgICAgICAgdmFyIHBsID0gdGhpcy5jdXJyZW50U2NlbmUucGxheWVyO1xuXG4gICAgICAgIC8v5Lya6Kmx6KGo56S644OV44Os44O844OgXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1cgKiAwLjk1LFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0ggKiAwLjQsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwgMCwgMCwgMC41KVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMSwgMSwgMSwgMC41KVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyAqIDAuNSwgZnJhbWVZKVxuXG4gICAgICAgIC8v44OG44Kt44K544OI5Yem55CGXG4gICAgICAgIGlmICh0ZXh0ID09PSB1bmRlZmluZWQpIHRleHQgPSBcIlRFU1QgTUVTU0FHRVwiO1xuICAgICAgICBpZiAodGV4dCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSBcIlwiO1xuICAgICAgICAgICAgdGV4dC5mb3JFYWNoKCh0KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0ICs9ICh0ICsgXCJcXG5cIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDUsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGZvbnRTaXplOiA3MCxcblxuICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ3RvcCcsXG4gICAgICAgICAgICBhbGlnbjonc3RhcnQnLFxuICAgICAgICAgICAgYmFzZWxpbmU6J3RvcCcsXG4gICAgICAgICAgICB3aWR0aDogU0NfVyAqIDAuOSxcbiAgICAgICAgICAgIGhlaWdodDogU0NfSCAqIDAuMyxcbiAgICAgICAgICAgIHNjcm9sbFg6IDAsXG4gICAgICAgICAgICBzY3JvbGxZOiAwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRleHRMYWJlbCA9IHBoaW5hLnVpLkxhYmVsQXJlYSh7dGV4dDogXCJcIiwgZm9udFNpemU6IDIwfS4kc2FmZShsYWJlbFBhcmFtKSkuYWRkQ2hpbGRUbyh0aGlzLmJnKTtcblxuICAgICAgICB0aGlzLmlzRXhpdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzRmluaXNoID0gZmFsc2U7XG4gICAgICAgIHRoaXMud2FpdFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmNvbCA9IDA7XG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLndhaXRUaW1lID09IDApIHtcbiAgICAgICAgICAgIHRoaXMudGV4dExhYmVsLnRleHQgPSB0aGlzLnRleHQuc3Vic3RyaW5nKDAsIHRoaXMuY29sKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnRleHQuc3Vic3RyaW5nKHRoaXMuY29sLCB0aGlzLmNvbCsxKSA9PSBcIlxcblwiKSB0aGlzLndhaXRUaW1lID0gMTA7XG4gICAgICAgICAgICB0aGlzLmNvbCsrO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29sID4gdGhpcy50ZXh0Lmxlbmd0aCkgdGhpcy5pc0ZpbmlzaCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMud2FpdFRpbWUgPiAwKSB0aGlzLndhaXRUaW1lLS07XG5cbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICh0aGlzLmlzRmluaXNoKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNFeGl0ICYmIHRoaXMudGltZSA+IDEwICYmIGN0LmJlZm9yZS5hdHRhY2sgJiYgIWN0LmF0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNFeGl0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCgxMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnBvcFNjZW5lKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGN0LmF0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuY29sID0gdGhpcy50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRmluaXNoID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG59KTtcblxuIiwiLypcbiAqICBjcmVkaXRzY2VuZS5qc1xuICogIDIwMTcvMTIvMjRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuQ3JlZGl0U2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcbiAgICBcbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC50byh7YWxwaGE6IDAuNX0sIDEwMDApO1xuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsdWVcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDI2LFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJDb25ncmF0dXJhdGlvbnMhIVwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC4yKTtcblxuICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlRoYW5rIHlvdSBmb3IgcGxheWluZy5cIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNCk7XG5cbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJUaGlzIGdhbWUgaXMgYSB0ZXN0IHZlcnNpb24uXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuXG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiUHVzaCBidXR0b24gdG8gdGl0bGUuXCIsIGZvbnRTaXplOiAyMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuOCk7XG5cbiAgICAgICAgYXBwLnBsYXlCR00oXCJnYW1lb3ZlclwiLCBmYWxzZSk7XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxMjApIHtcbiAgICAgICAgICAgIGlmIChjdC5vayB8fCBjdC5jYW5jZWwpIHtcbiAgICAgICAgICAgICAgICBhcHAucGxheUJHTShcIm9wZW5pbmdiZ21cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZSgnZXhpdGdhbWUnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZGluZ2NlbmUuanNcbiAqICAyMDE3LzAyLzA3XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZGluZ1NjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG4gICAgXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAudG8oe2FscGhhOiAwLjV9LCAxMDAwKTtcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibHVlXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAyNixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiVGhhbmsgeW91IGZvciBwbGF5aW5nLlwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC40KTtcblxuICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlRoaXMgZ2FtZSBpcyBvdmVyXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuXG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiUHVzaCBidXR0b24gdG8gdGl0bGUuXCIsIGZvbnRTaXplOiAyMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuOCk7XG5cbiAgICAgICAgYXBwLnBsYXlCR00oXCJnYW1lb3ZlclwiLCBmYWxzZSk7XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxMjApIHtcbiAgICAgICAgICAgIGlmIChjdC5vayB8fCBjdC5jYW5jZWwpIHtcbiAgICAgICAgICAgICAgICBhcHAucGxheUJHTShcIm9wZW5pbmdiZ21cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZSgnZXhpdGdhbWUnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZGluZ2NlbmUudHJ1ZWVuZGluZy5qc1xuICogIDIwMTcvMDUvMDFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG4vL+ODiOOCpeODq+ODvOOCqOODs+ODh+OCo+ODs+OCsFxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZGluZ1NjZW5lLlRydWVFbmRpbmdcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcbiAgICBcbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG5cbiAgICAgICAgdGhpcy50ZXh0ID0gW1xuICAgICAgICAgICAgXCLmlbDlpJrjga7oi6bpm6PjgpLkuZfjgorotorjgYhcIixcbiAgICAgICAgICAgIFwi44GC44Gq44Gf44Gv6YGC44Gr5qW95ZyS44CM5rC46YGg44Gu6YO944CN44G444Gu5YWl44KK5Y+j44G444Go5Yiw6YGU44GX44GfXCIsXG4gICAgICAgICAgICBcIuaJieOBruWQkeOBk+OBhuOBq+OBr+majuauteOBjOOBguOCilwiLFxuICAgICAgICAgICAgXCLjgZ3jga7pmo7mrrXjga/pgaXjgYvlpKnkuIrjgbjjgajntprjgYTjgabjgYTjgotcIixcbiAgICAgICAgICAgIFwi6ZqO5q6144KS5piH44KK44G+44GZ44GL77yfXCIsXG4gICAgICAgIF07XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC50byh7YWxwaGE6IDAuNX0sIDEwMDApO1xuXG4gICAgICAgIC8v44Kk44Oh44O844K46KGo56S655So44Os44Kk44OkXG4gICAgICAgIHRoaXMuaW1hZ2VMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMpO1xuXG4gICAgICAgIC8v5LiK5LiL6buS5bivXG4gICAgICAgIHBhcmFtLmhlaWdodCA9IFNDX0ggKiAwLjE1O1xuICAgICAgICB0aGlzLmJhcjEgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpLnNldE9yaWdpbigwLCAxKS5zZXRQb3NpdGlvbigwLCAtMSk7XG4gICAgICAgIHRoaXMuYmFyMiA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pLmFkZENoaWxkVG8odGhpcykuc2V0T3JpZ2luKDAsIDApLnNldFBvc2l0aW9uKDAsIFNDX0ggKyAxKTtcbiAgICAgICAgdGhpcy5iYXIxLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKS5tb3ZlQnkoMCwgU0NfSCAqIDAuMTUsIDMwLCBcImVhc2VPdXRTaW5lXCIpO1xuICAgICAgICB0aGlzLmJhcjIudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLm1vdmVCeSgwLCAtU0NfSCAqIDAuMTUsIDMwLCBcImVhc2VPdXRTaW5lXCIpO1xuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgdGhpcy5vbmUoJ2VudGVyZnJhbWUnLCAoKSA9PiB7XG4gICAgICAgICAgICAvL++8ou+8p++8reWGjeeUn1xuICAgICAgICAgICAgYXBwLnBsYXlCR00oXCJlbmRpbmdiZ21cIik7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDEyMCkge1xuICAgICAgICAgICAgaWYgKGN0Lm9rIHx8IGN0LmNhbmNlbCkge1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5QkdNKFwib3BlbmluZ2JnbVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmZsYXJlKCdleGl0Z2FtZScpO1xuICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgR2FtZU92ZXJTY2VuZS5qc1xuICogIDIwMTQvMDYvMDRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuR2FtZU92ZXJTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuICAgIFxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUgPSBwYXJlbnRTY2VuZTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDogU0NfVyxcbiAgICAgICAgICAgIGhlaWdodDogU0NfSCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KVxuICAgICAgICB0aGlzLmJnLmFscGhhID0gMDtcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibHVlXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAzMixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHZhciB4ID0gU0NfVyAqIDAuNS0zMio0O1xuICAgICAgICB2YXIgbiA9IDA7XG4gICAgICAgIFtcIkdcIiwgXCJBXCIsIFwiTVwiLCBcIkVcIiwgXCJPXCIsIFwiVlwiLCBcIkVcIiwgXCJSXCJdLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyIGxiID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogZX0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKHgsIFNDX0gqMC41KzMyKVxuICAgICAgICAgICAgICAgIC5zZXRTY2FsZSgwLCAxKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICAgICAgbGIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgICAgIC53YWl0KG4qNTApXG4gICAgICAgICAgICAgICAgLnRvKHtzY2FsZVg6IDEuMCwgYWxwaGE6IDEsIHk6IFNDX0gqMC41fSwgMTAwMCwgXCJlYXNlT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC53YWl0KDEwMDAtbio1MClcbiAgICAgICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAgICAgLnRvKHtzY2FsZVg6IDAuMCwgYWxwaGE6IDAsIHk6IFNDX0gqMC41LTMyfSwgMTAwMCwgXCJlYXNlT3V0U2luZVwiKVxuICAgICAgICAgICAgdmFyIHB0ID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJwYXJ0aWNsZVwiLCAxNiwgMTYpXG4gICAgICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoNDgpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKHgsIFNDX0gqMC41KVxuICAgICAgICAgICAgICAgIC5zZXRTY2FsZSgzLCAzKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICAgICAgcHQuYWxwaGEgPSAwO1xuICAgICAgICAgICAgcHQudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLndhaXQobio1MCsxMDAwKVxuICAgICAgICAgICAgICAgIC50byh7YWxwaGE6IDF9LCAxMDAwLW4qNTAsIFwiZWFzZU91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAudG8oe3NjYWxlWDogMC4wLCBhbHBoYTogMCwgeTogU0NfSCowLjUtMzJ9LCAxMDAwLCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICB4ICs9IDMyO1xuICAgICAgICAgICAgbisrO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIGFwcC5wbGF5QkdNKFwiZ2FtZW92ZXJcIiwgZmFsc2UpO1xuXG4gICAgICAgIHRoaXMuc2VsZWN0ID0gMDsgLy8wOllFUyAxOk5PXG4gICAgICAgIHRoaXMucHVzaHllcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnB1c2hubyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9rID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPT0gOTApIHtcbiAgICAgICAgICAgIHRoaXMuZGlzcENvbnRpbnVlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDEwNSkge1xuICAgICAgICAgICAgaWYgKChjdC5sZWZ0IHx8IHRoaXMucHVzaHllcykgJiYgdGhpcy5zZWxlY3QgPT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLnB1c2h5ZXMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnllcy50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMSwgc2NhbGVZOiAxfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5uby50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0My50ZXh0ID0gXCLjgrLjg7zjg6Djgqrjg7zjg5Djg7zlnLDngrnjgYvjgonjgrPjg7Pjg4bjgqPjg4vjg6Xjg7zjgZfjgb7jgZnvvIjjgrnjgrPjgqLjga/jg6rjgrvjg4Pjg4jjgZXjgozjgb7jgZnvvIlcIjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKGN0LnJpZ2h0IHx8IHRoaXMucHVzaG5vKSAmJiB0aGlzLnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3QgPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMucHVzaG5vID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy55ZXMudHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLCBzY2FsZVk6IDF9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dDMudGV4dCA9IFwi44K/44Kk44OI44Or44Gr5oi744KK44G+44GZXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3Qub2sgfHwgY3QuY2FuY2VsIHx8IHRoaXMub2spIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmZsYXJlKCdjb250aW51ZScpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmZsYXJlKCdleGl0Z2FtZScpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcblxuICAgIGRpc3BDb250aW51ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAzNixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGV4dDEgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIkNPTlRJTlVFP1wifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjQrMTApXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy50ZXh0MS5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMudGV4dDEudHdlZW5lci5jbGVhcigpLnRvKHt5OiBTQ19IKjAuNCwgYWxwaGE6IDF9LCA1MDAsIFwiZWFzZUluU2luZVwiKTtcblxuICAgICAgICB0aGlzLnllcyA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiWUVTXCIsIGZvbnRTaXplOiAzMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNCwgU0NfSCowLjYrMTApXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy55ZXMuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLnllcy50d2VlbmVyLmNsZWFyKCkudG8oe3k6IFNDX0gqMC42LCBhbHBoYTogMX0sIDUwMCwgXCJlYXNlSW5TaW5lXCIpO1xuXG4gICAgICAgIHRoaXMubm8gPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIk5PXCIsIGZvbnRTaXplOiAzMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMC43KVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC42LCBTQ19IKjAuNisxMClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLm5vLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy5uby50d2VlbmVyLmNsZWFyKCkudG8oe3k6IFNDX0gqMC42LCBhbHBoYTogMX0sIDUwMCwgXCJlYXNlSW5TaW5lXCIpO1xuXG4gICAgICAgIC8v44K/44OD44OB5Yik5a6a55SoXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHBhcmFtMiA9IHtcbiAgICAgICAgICAgIHdpZHRoOiA4MCxcbiAgICAgICAgICAgIGhlaWdodDogU0NfSCowLjA4LFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB2YXIgeWVzID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbTIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC40LCBTQ19IKjAuNilcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgeWVzLmFscGhhID0gMDtcbiAgICAgICAgeWVzLm9ucG9pbnRzdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoYXQuc2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGF0Lm9rID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC5wdXNoeWVzID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgbm8gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtMilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjYsIFNDX0gqMC42KVxuICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICBuby5hbHBoYSA9IDA7XG4gICAgICAgIG5vLm9ucG9pbnRzdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoYXQuc2VsZWN0ID09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGF0Lm9rID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC5wdXNobm8gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50ZXh0MyA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwi44Ky44O844Og44Kq44O844OQ44O85Zyw54K544GL44KJ44Kz44Oz44OG44Kj44OL44Ol44O844GX44G+44GZ77yI44K544Kz44Ki44Gv44Oq44K744OD44OI44GV44KM44G+44GZ77yJXCIsIGZvbnRTaXplOiAxMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC43NSsxMClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnRleHQzLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy50ZXh0My50d2VlbmVyLmNsZWFyKCkudG8oe3k6IFNDX0gqMC43NSwgYWxwaGE6IDF9LCA1MDAsIFwiZWFzZUluU2luZVwiKTtcblxuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuY2xlYXIoKS50byh7YWxwaGE6MC4zfSwgNTAwLCBcImVhc2VJblNpbmVcIik7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBMb2FkaW5nU2NlbmUuanNcbiAqICAyMDE1LzA5LzA4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCouOCu+ODg+ODiOODreODvOODieeUqOOCt+ODvOODs1xucGhpbmEuZGVmaW5lKFwicWZ0LkxvYWRpbmdTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgICAgIGFzc2V0czogbnVsbCxcbiAgICAgICAgICAgIHdpZHRoOiBTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OiBTQ19ILFxuICAgICAgICAgICAgbGllOiBmYWxzZSxcbiAgICAgICAgICAgIGV4aXRUeXBlOiBcImF1dG9cIixcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6ICdibGFjaycsXG4gICAgICAgICAgICBzdHJva2U6IGZhbHNlLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KVxuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG5cbiAgICAgICAgLy/jg63jg7zjg4njgZnjgovnianjgYznhKHjgYTloLTlkIjjgrnjgq3jg4Pjg5dcbiAgICAgICAgdGhpcy5mb3JjZUV4aXQgPSBmYWxzZTtcbiAgICAgICAgdmFyIGFzc2V0cyA9IG9wdGlvbnMuYXNzZXRzO1xuICAgICAgICBpZiAoIWFzc2V0cy4kaGFzKFwic291bmRcIikgJiZcbiAgICAgICAgICAgICFhc3NldHMuJGhhcyhcImltYWdlXCIpICYmXG4gICAgICAgICAgICAhYXNzZXRzLiRoYXMoXCJmb250XCIpICYmXG4gICAgICAgICAgICAhYXNzZXRzLiRoYXMoXCJzcHJpdGVzaGVldFwiKSAmJlxuICAgICAgICAgICAgIWFzc2V0cy4kaGFzKFwic2NyaXB0XCIpICYmXG4gICAgICAgICAgICAhYXNzZXRzLiRoYXMoXCJ0bXhcIikpIHtcblxuICAgICAgICAgICAgdGhpcy5mb3JjZUV4aXQgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICB0ZXh0OiBcIkxvYWRpbmdcIixcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibHVlXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAzMFxuICAgICAgICB9O1xuICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKGxhYmVsUGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG5cbiAgICAgICAgdGhpcy5mcm9tSlNPTih7XG4gICAgICAgICAgICBjaGlsZHJlbjoge1xuICAgICAgICAgICAgICAgIGdhdWdlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ3BoaW5hLnVpLkdhdWdlJyxcbiAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoKjAuNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnYmxhY2snLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdWdlQ29sb3I6ICdibHVlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDAsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHg6IHRoaXMuZ3JpZFguY2VudGVyKCksXG4gICAgICAgICAgICAgICAgICAgIHk6IFNDX0gqMC41KzIwLFxuICAgICAgICAgICAgICAgICAgICBvcmlnaW5ZOiAwLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZ2F1Z2UudXBkYXRlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5nYXVnZUNvbG9yID0gJ2hzbGEoezB9LCAxMDAlLCA1MCUsIDAuOCknLmZvcm1hdChlLnRpY2tlci5mcmFtZSozKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsb2FkZXIgPSBwaGluYS5hc3NldC5Bc3NldExvYWRlcigpO1xuICAgICAgICBpZiAob3B0aW9ucy5saWUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2F1Z2UuYW5pbWF0aW9uVGltZSA9IDEwKjEwMDA7XG4gICAgICAgICAgICB0aGlzLmdhdWdlLnZhbHVlID0gOTA7XG4gICAgICAgICAgICBsb2FkZXIub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nYXVnZS5hbmltYXRpb25UaW1lID0gMSoxMDAwO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2F1Z2UudmFsdWUgPSAxMDA7XG4gICAgICAgICAgICB9LmJpbmQodGhpcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2FkZXIub25wcm9ncmVzcyA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdhdWdlLnZhbHVlID0gZS5wcm9ncmVzcyoxMDA7XG4gICAgICAgICAgICB9LmJpbmQodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5nYXVnZS5vbmZ1bGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmV4aXRUeXBlID09PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hcHAuX29uTG9hZEFzc2V0cykgdGhpcy5hcHAuX29uTG9hZEFzc2V0cygpO1xuICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgbG9hZGVyLmxvYWQob3B0aW9ucy5hc3NldHMpO1xuICAgIH0sXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuZm9yY2VFeGl0KSB0aGlzLmV4aXQoKTtcbiAgICB9LCAgICBcbn0pO1xuIiwiLypcbiAqICBNYWluU2NlbmUuanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuTWFpblNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICAvL+ePvuWcqOOCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiAxLFxuXG4gICAgLy/mnIDlpKfjgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlck1heDogOCxcblxuICAgIC8v5q6L44KK5pmC6ZaT77yI44OV44Os44O844Og5Y2Y5L2N77yJXG4gICAgdGltZUxpbWl0OiAxMjAsXG5cbiAgICAvL+ODoeODg+OCu+ODvOOCuOOCueOCv+ODg+OCr1xuICAgIG1lc3NhZ2VTdGFjazogW10sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouODleODqeOCsFxuICAgIGlzU3RhZ2VDbGVhcjogZmFsc2UsXG5cbiAgICAvL+OCqOODs+ODh+OCo+ODs+OCsOmAsuihjOS4reODleODqeOCsFxuICAgIGlzRW5kaW5nOiBmYWxzZSxcblxuICAgIC8v55yf44Ko44Oz44OH44Kj44Oz44Kw44OV44Op44KwXG4gICAgaXNUcnVlRW5kaW5nOiB0cnVlLFxuXG4gICAgLy/jgrnjgrPjgqJcbiAgICB0b3RhbFNjb3JlOiAwLFxuXG4gICAgLy/mlbXoqI7kvJDmlbBcbiAgICB0b3RhbEtpbGw6IDAsXG5cbiAgICAvL+OCs+ODs+ODhuOCo+ODi+ODpeODvOWbnuaVsFxuICAgIGNvbnRpbnVlQ291bnQ6IDAsXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouaZguaDheWgsVxuICAgIGNsZWFyUmVzdWx0OiBbXSxcblxuICAgIC8v44K544Kv44Oq44O844Oz44Gu44Oe44OD44OX5aSW44G444Gu56e75YuV5Yi26ZmQ44OV44Op44KwXG4gICAgbGltaXRXaWR0aDogZmFsc2UsXG4gICAgbGltaXRIZWlnaHQ6IHRydWUsXG5cbiAgICAvL+OCueOCr+ODquODvOODs+S4reW/g+W6p+aomVxuICAgIHNjcmVlbkNlbnRlclBvc2l0aW9uOiBudWxsLFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgrnjgq/jg6rjg7zjg7PkuK3lpK7lm7rlrprjg5Xjg6njgrBcbiAgICBjZW50ZXJQbGF5ZXI6IHRydWUsXG5cbiAgICAvL+OCt+ODvOODs+WGheWFqOOCquODluOCuOOCp+OCr+ODiOW8t+WItuWBnOatolxuICAgIHBhdXNlU2NlbmU6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgICAgIHN0YXJ0U3RhZ2U6IDEsXG4gICAgICAgICAgICBpc1ByYWN0aWNlOiBmYWxzZSxcbiAgICAgICAgICAgIGlzQ29udGludWU6IGZhbHNlLFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnN0YWdlTnVtYmVyID0gb3B0aW9ucy5zdGFydFN0YWdlIHx8IDE7XG4gICAgICAgIHRoaXMuaXNQcmFjdGljZSA9IG9wdGlvbnMuaXNQcmFjdGljZTtcbiAgICAgICAgdGhpcy5pc0NvbnRpbnVlID0gb3B0aW9ucy5pc0NvbnRpbnVlO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6ICdibGFjaycsXG4gICAgICAgICAgICBzdHJva2U6IGZhbHNlLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuXG4gICAgICAgIC8v6IOM5pmvXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJiYWNrZ3JvdW5kXCIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbigwLCBTQ19IKjAuNSlcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMCwgMC41KVxuICAgICAgICAgICAgLnNldFNjYWxlKDEuMCwgMS4xKTtcblxuICAgICAgICAvL+euoeeQhueUqOWfuua6luODrOOCpOODpFxuICAgICAgICB0aGlzLmJhc2VMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Kt44Oj44Op44Kv44K/XG4gICAgICAgIHRoaXMucGxheWVyID0gcWZ0LlBsYXllcih0aGlzKTtcblxuICAgICAgICAvL+OCueOCr+ODquODvOODs+WIneacn+WMllxuICAgICAgICB0aGlzLnNldHVwU2NyZWVuKCk7XG5cbiAgICAgICAgLy/jgrnjgq/jg6rjg7zjg7PkuK3lv4PluqfmqJnnrqHnkIbnlKhcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLmNhbWVyYSA9IHBoaW5hLmFwcC5PYmplY3QyRCgpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuY2FtZXJhLnBhcmVudFNjZW5lID0gdGhpcztcbiAgICAgICAgdGhpcy5jYW1lcmEudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgdGhpcy5jYW1lcmEubW92ZUZyb20gPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG4gICAgICAgIHRoaXMuY2FtZXJhLm1vdmVUbyA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcbiAgICAgICAgdGhpcy5jYW1lcmEubW92ZVJhdGlvID0gMDtcbiAgICAgICAgdGhpcy5jYW1lcmEubW92ZUxlcnAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jYW1lcmEubW92ZVRvUGxheWVyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2FtZXJhLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoYXQuY2VudGVyUGxheWVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy54ID0gdGhhdC5wbGF5ZXIueDtcbiAgICAgICAgICAgICAgICB0aGlzLnkgPSB0aGF0LnBsYXllci55O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb3ZlTGVycCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb3ZlVG9QbGF5ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVRvLnggPSB0aGF0LnBsYXllci54O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlVG8ueSA9IHRoYXQucGxheWVyLnk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBwaGluYS5nZW9tLlZlY3RvcjIubGVycCh0aGlzLm1vdmVGcm9tLCB0aGlzLm1vdmVUbywgdGhpcy5tb3ZlUmF0aW8pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uKHAueCwgcC55KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmmYLmg4XloLFcbiAgICAgICAgdGhpcy5jbGVhclJlc3VsdCA9IFtdO1xuICAgICAgICB0aGlzLnRvdGFsU2NvcmUgPSAwO1xuICAgICAgICB0aGlzLnRvdGFsS2lsbCA9IDA7XG5cbiAgICAgICAgLy/jgrPjg7Pjg4bjgqPjg4vjg6Xjg7zmmYLnirbmhYvjg63jg7zjg4lcbiAgICAgICAgaWYgKHRoaXMuaXNDb250aW51ZSkgdGhpcy5sb2FkR2FtZSgpO1xuXG4gICAgICAgIC8v44K544OG44O844K46ZaL5aeL5L2N572uXG4gICAgICAgIHRoaXMubWFwc3RhcnQgPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgrjmg4XloLHliJ3mnJ/ljJZcbiAgICAgICAgdGhpcy5zZXR1cFN0YWdlKCk7XG5cbiAgICAgICAgdGhpcy5mZ1doaXRlID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbS4kZXh0ZW5kKHtmaWxsOiAnd2hpdGUnfSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuZmdXaGl0ZS5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMuZmdXaGl0ZS50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKCk7XG5cbiAgICAgICAgdGhpcy5mZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuZmcudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKS5jbGVhcigpLmZhZGVPdXQoMzApO1xuXG4gICAgICAgIC8v44OQ44O844OB44Oj44Or44OR44OD44OJ44Gu5Y+v6KaW5YyWXG4gICAgICAgIGlmIChwaGluYS5pc01vYmlsZSgpIHx8IERFQlVHX01PQklMRSkge1xuICAgICAgICAgICAgYXBwLnZpcnR1YWxQYWQuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbigwLCAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFwcC52b2x1bWVCR00gPSAwLjU7XG4gICAgICAgIGFwcC52b2x1bWVTRSA9IDAuMjtcblxuICAgICAgICAvL+ODoeODi+ODpeODvOOCkumWi+OBj1xuICAgICAgICB0aGlzLm9uKCdvcGVubWVudScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0Lk1lbnVTY2VuZSh0aGlzKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v44Kt44O85Y+W5b6XXG4gICAgICAgIHRoaXMub24oJ2dldGtleScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5tYXBMYXllci54ICsgdGhpcy5wbGF5ZXIueDtcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5tYXBMYXllci55ICsgdGhpcy5wbGF5ZXIueTtcbiAgICAgICAgICAgIHZhciBrZXkgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KClcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oeCwgeSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLmJhc2VMYXllcik7XG4gICAgICAgICAgICBrZXkudHdlZW5lci5jbGVhcigpLm1vdmVUbygxNSsodGhpcy5wbGF5ZXIua2V5cy5sZW5ndGgtMSkqMjQsIDM2LCA1MDApO1xuICAgICAgICAgICAgdmFyIHNwID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJpdGVtXCIsIDI0LCAyNClcbiAgICAgICAgICAgICAgICAuc2V0RnJhbWVJbmRleChJVEVNX0tFWSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyhrZXkpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+OCueODhuODvOOCuOOCr+ODquOColxuICAgICAgICB0aGlzLm9uKCdzdGFnZWNsZWFyJywgdGhpcy5zdGFnZUNsZWFyKTtcblxuICAgICAgICAvL+asoeOCueODhuODvOOCuOOBuOenu+ihjFxuICAgICAgICB0aGlzLm9uKCduZXh0c3RhZ2UnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYWxsQ2xlYXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlTnVtYmVyKys7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR1cFN0YWdlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuc2F2ZVN0YXR1cygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL+OCqOODs+ODh+OCo+ODs+OCsOWIhuWykFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVHJ1ZUVuZGluZykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YWdlTnVtYmVyID0gMTA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dXBTdGFnZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8v5Luu44Ko44Oz44OH44Kj44Oz44KwXG4gICAgICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LkVuZGluZ1NjZW5lKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v44Ko44Oz44OH44Kj44Oz44Kw44G456e76KGMXG4gICAgICAgIHRoaXMub24oJ2VuZGluZycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LkVuZGluZ1NjZW5lKHRoaXMpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jgrLjg7zjg6Djgqrjg7zjg5Djg7xcbiAgICAgICAgdGhpcy5vbignZ2FtZW92ZXInLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5HYW1lT3ZlclNjZW5lKHRoaXMpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jgrPjg7Pjg4bjgqPjg4vjg6Xjg7xcbiAgICAgICAgdGhpcy5vbignY29udGludWUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3RhcnQoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jgrLjg7zjg6DntYLkuoZcbiAgICAgICAgdGhpcy5fZXhpdEdhbWUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vbignZXhpdGdhbWUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLl9leGl0R2FtZSA9IHRydWU7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNQcmFjdGljZSkgdGhpcy5zYXZlR2FtZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5vbignZXhpdGdhbWVfbm9zYXZlJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5fZXhpdEdhbWUgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+ODoeODg+OCu+ODvOOCuOihqOekulxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMTYsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMubWVzc2FnZVN0YWNrID0gW107XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJcIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC4yKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZS5uZXh0T2sgPSB0cnVlO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm5leHRPayAmJiB0aGF0Lm1lc3NhZ2VTdGFjay5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0T2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gdGhhdC5tZXNzYWdlU3RhY2tbMF07XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IG1zZy50ZXh0O1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlSW4oMTUpLndhaXQoOTApLmZhZGVPdXQoMTUpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5leHRPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lm1lc3NhZ2VTdGFjay5zcGxpY2UoMCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPT0gMTUpIHRoaXMucGxheWVyLmlzQ29udHJvbCA9IHRydWU7XG5cbiAgICAgICAgLy/jgrLjg7zjg6DntYLkuoZcbiAgICAgICAgaWYgKHRoaXMuX2V4aXRHYW1lKSB7XG4gICAgICAgICAgICB0aGlzLmV4aXRHYW1lKCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKCF0aGlzLmlzU3RhZ2VDbGVhcikge1xuICAgICAgICAgICAgLy/pgJrluLjmmYLlh6bnkIZcbiAgICAgICAgICAgIC8v44Oh44OL44Ol44O844K344O844Oz44G456e76KGMXG4gICAgICAgICAgICBpZiAodGhpcy50aW1lID4gMTUpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3QucGF1c2UgfHwgY3QubWVudSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdvcGVubWVudScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjpgLLooYxcbiAgICAgICAgICAgIHZhciBldmVudCA9IHRoaXMuc3RhZ2VDb250cm9sbGVyLmdldCh0aGlzLnRpbWUpO1xuICAgICAgICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZihldmVudC52YWx1ZSkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQudmFsdWUuY2FsbCh0aGlzLCBldmVudC5vcHRpb24pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW50ZXJFbmVteVVuaXQoZXZlbnQudmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu244OB44Kn44OD44KvXG4gICAgICAgICAgICBpZiAodGhpcy5tYXBMYXllci5jbGVhckdhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGFnZUNvbnRyb2xsZXIuY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXBMYXllci5jbGVhckdhdGUuaXNMb2NrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMucGF1c2VTY2VuZSkgdGhpcy50aW1lTGltaXQtLTtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWVMaW1pdCA8IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVMaW1pdCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lTGltaXQgPT0gMCAmJiAhdGhpcy5wbGF5ZXIuaXNEZWFkKSB7XG4vLyAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5kZWFkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouaZguWHpueQhlxuICAgICAgICAgICAgLy/mrovjgorjgr/jgqTjg6DjgpLjgrnjgrPjgqLliqDnrpdcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWVMaW1pdCA+PSA2MCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGltZUxpbWl0IC09IDYwO1xuICAgICAgICAgICAgICAgIHRoaXMudG90YWxTY29yZSArPSAyMDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lTGltaXQgPCA2MCkgdGhpcy50aW1lTGltaXQgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+OCt+ODp+ODvOODiOOCq+ODg+ODiFxuICAgICAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgICAgICBpZiAoY3Qub2spIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lTGltaXQgPj0gNjApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbFNjb3JlICs9IE1hdGguZmxvb3IodGhpcy50aW1lTGltaXQgLyA2MCkgKiAyMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+OCueOCr+ODquODvOODs+ihqOekuuS9jee9rlxuICAgICAgICB2YXIgbWFwID0gdGhpcy5tYXBMYXllci5tYXA7XG4gICAgICAgIHRoaXMubWFwTGF5ZXIueCA9IFNDX1cgKiAwLjUgLSB0aGlzLmNhbWVyYS54O1xuICAgICAgICB0aGlzLm1hcExheWVyLnkgPSBTQ19IICogMC41IC0gdGhpcy5jYW1lcmEueTtcbiAgICAgICAgaWYgKHRoaXMubGltaXRIZWlnaHQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1hcExheWVyLnkgPiAwKSB0aGlzLm1hcExheWVyLnkgPSAwO1xuICAgICAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIueSA8IC0obWFwLmhlaWdodC1TQ19IKSkgdGhpcy5tYXBMYXllci55ID0gLShtYXAuaGVpZ2h0LVNDX0gpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmxpbWl0V2lkdGgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1hcExheWVyLnggPiAwKSB0aGlzLm1hcExheWVyLnggPSAwO1xuICAgICAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIueCA8IC0obWFwLndpZHRoLVNDX1cpKSB0aGlzLm1hcExheWVyLnggPSAtKG1hcC53aWR0aC1TQ19XKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44K544Kv44Oq44O844Oz5bqn5qiZXG4gICAgICAgIHRoaXMuc2NyZWVuWCA9IC10aGlzLm1hcExheWVyLng7XG4gICAgICAgIHRoaXMuc2NyZWVuWSA9IC10aGlzLm1hcExheWVyLnk7XG5cbiAgICAgICAgaWYgKHRoaXMuc3RhZ2VDb250cm9sbGVyLmlzQmFja2dyb3VuZE1vdmUpIHtcbiAgICAgICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJ44GuWOW6p+aomeOCkuWFqOS9k+OBruWJsuWQiOOBi+OCieioiOeul1xuICAgICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UueCA9IC1NYXRoLmZsb29yKHRoaXMuYmFja2dyb3VuZEltYWdlLndpZHRoICogKHRoaXMucGxheWVyLnggLyBtYXAud2lkdGgpKjAuMDUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UueCA9IHRoaXMuc3RhZ2VDb250cm9sbGVyLmJhY2tncm91bmRYO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcblxuICAgIC8v5pW144Kt44Oj44Op44Kv44K/5oqV5YWlXG4gICAgc3Bhd25FbmVteTogZnVuY3Rpb24oeCwgeSwgbmFtZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gcWZ0LkVuZW15W25hbWVdKHRoaXMsIG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcy5lbmVteUxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICB9LFxuXG4gICAgLy/jgqLjgqTjg4bjg6DmipXlhaVcbiAgICBzcGF3bkl0ZW06IGZ1bmN0aW9uKHgsIHksIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHFmdC5JdGVtKHRoaXMsIG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcy5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgfSxcblxuICAgIC8v44Ki44Kk44OG44Og44Oc44OD44Kv44K55oqV5YWlXG4gICAgc3Bhd25JdGVtQm94OiBmdW5jdGlvbih4LCB5LCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBxZnQuSXRlbUJveCh0aGlzLCBvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgIH0sXG5cbiAgICAvL+OCqOODleOCp+OCr+ODiOaKleWFpVxuICAgIHNwYXduRWZmZWN0OiBmdW5jdGlvbih4LCB5LCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBxZnQuRWZmZWN0KHRoaXMsIG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcy5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgfSxcblxuICAgIC8v44Oh44OD44K744O844K45oqV5YWlXG4gICAgc3Bhd25NZXNzYWdlOiBmdW5jdGlvbih0ZXh0LCBiZXR3ZWVuLCB3YWl0RnJhbWUpIHtcbiAgICAgICAgYmV0d2VlbiA9IGJldHdlZW4gfHwgMzI7XG4gICAgICAgIHdhaXRGcmFtZSA9IHdhaXRGcmFtZSB8fCAzMDtcbiAgICAgICAgdmFyIGFycmF5VGV4dCA9IHRleHQuc3BsaXQoXCJcIik7XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsdWVcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDMyLFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG4gPSAwO1xuICAgICAgICB2YXIgeCA9IFNDX1cgKiAwLjUgLSAoYXJyYXlUZXh0Lmxlbmd0aCAqIGJldHdlZW4gKiAwLjUpO1xuICAgICAgICBhcnJheVRleHQuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZSA9PSBcIiBcIikge1xuICAgICAgICAgICAgICAgIHggKz0gYmV0d2VlbjtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbGIgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBlfS4kc2FmZShsYWJlbFBhcmFtKSkuc2V0UG9zaXRpb24oeCwgU0NfSCowLjUrMzIpLnNldFNjYWxlKDAsIDEpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgICAgICBsYi50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAgICAgLndhaXQobilcbiAgICAgICAgICAgICAgICAudG8oe3NjYWxlWDogMS4wLCBhbHBoYTogMSwgeTogU0NfSCowLjV9LCAxNSwgXCJlYXNlT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC53YWl0KHdhaXRGcmFtZSlcbiAgICAgICAgICAgICAgICAudG8oe3NjYWxlWDogMC4wLCB5OiBTQ19IKjAuNS0zMn0sIDEwLCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXt0aGlzLnJlbW92ZSgpfS5iaW5kKGxiKSk7XG4gICAgICAgICAgICB4ICs9IGJldHdlZW47XG4gICAgICAgICAgICBuICs9IDU7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIC8v44Kk44OZ44Oz44OI44Oh44OD44K744O844K45oqV5YWlXG4gICAgc3Bhd25FdmVudE1lc3NhZ2U6IGZ1bmN0aW9uKGlkLCB0ZXh0KSB7XG4gICAgICAgIGlmICghaWQgfHwgIXRleHQpIHJldHVybjtcbiAgICAgICAgLy/jg6Hjg4Pjgrvjg7zjgrjjgrnjgr/jg4Pjgq/lhoXjgavlkIzkuIDvvKnvvKTjgYzjgYLjgovloLTlkIjjga/mipXlhaXjgZfjgarjgYRcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1lc3NhZ2VTdGFjay5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMubWVzc2FnZVN0YWNrW2ldLmlkID09IGlkKSByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRleHQgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgdGV4dC5mb3JFYWNoKGZ1bmN0aW9uKHN0cikge1xuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZVN0YWNrLnB1c2goe2lkOiBpZCwgdGV4dDogc3RyfSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlU3RhY2sucHVzaCh7aWQ6IGlkLCB0ZXh0OiB0ZXh0fSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/jgrnjgq/jg6rjg7zjg7PliJ3mnJ/ljJZcbiAgICBzZXR1cFNjcmVlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIlVidW50dU1vbm9cIixcbiAgICAgICAgICAgIGFsaWduOiBcImxlZnRcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDIwLFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcblxuICAgICAgICAvL+S9k+WKm+OCsuODvOOCuFxuICAgICAgICB0aGlzLmxpZmVHYXVnZUxhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJMSUZFXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKDAsIDEwKTtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICB3aWR0aDogIDIwMCxcbiAgICAgICAgICAgIGhlaWdodDogNSxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIGZpbGw6ICdyZWQnLFxuICAgICAgICAgICAgc3Ryb2tlOiAnd2hpdGUnLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgICAgICBnYXVnZUNvbG9yOiAnbGltZScsXG4gICAgICAgICAgICBjb3JuZXJSYWRpdXM6IDAsXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5wbGF5ZXIuaHAsXG4gICAgICAgICAgICBtYXhWYWx1ZTogdGhpcy5wbGF5ZXIuaHBNYXgsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubGlmZUdhdWdlID0gcGhpbmEudWkuR2F1Z2Uob3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzKS5zZXRPcmlnaW4oMCwgMC41KS5zZXRQb3NpdGlvbig0MCwgMTApO1xuICAgICAgICB0aGlzLmxpZmVHYXVnZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGF0LnBsYXllci5ocDtcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSB0aGF0LnBsYXllci5ocE1heCAqIDI7XG4gICAgICAgICAgICB0aGlzLm1heFZhbHVlID0gdGhhdC5wbGF5ZXIuaHBNYXg7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy/jgrnjgrPjgqLooajnpLpcbiAgICAgICAgdGhpcy5zY29yZUxhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDpcIlNDT1JFOlwiLCBhbGlnbjogXCJyaWdodFwifS4kc2FmZShsYWJlbFBhcmFtKSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XLCAxMCk7XG4gICAgICAgIHRoaXMuc2NvcmVMYWJlbC5zY29yZSA9IDA7XG4gICAgICAgIHRoaXMuc2NvcmVMYWJlbC5zID0gMDtcbiAgICAgICAgdGhpcy5zY29yZUxhYmVsLnVwZGF0ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLnRpY2tlci5mcmFtZSAlIDEwID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnMgPSB+figodGhhdC50b3RhbFNjb3JlLXRoaXMuc2NvcmUpLzcpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnMgPCAzKSB0aGlzLnMgPSAzO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnMgPiA3Nzc3KSB0aGlzLnMgPSA3Nzc3O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zY29yZSArPSB0aGlzLnM7XG4gICAgICAgICAgICBpZiAodGhpcy5zY29yZSA+IHRoYXQudG90YWxTY29yZSkgdGhpcy5zY29yZSA9IHRoYXQudG90YWxTY29yZTtcblxuICAgICAgICAgICAgdGhpcy50ZXh0ID0gXCJTQ09SRSBcIit0aGlzLnNjb3JlLmNvbW1hKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WItumZkOaZgumWk+ihqOekulxuICAgICAgICB0aGlzLnRpbWVMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiVElNRTpcIiwgYWxpZ246IFwicmlnaHRcIn0uJHNhZmUobGFiZWxQYXJhbSkpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVywgMzApO1xuICAgICAgICB0aGlzLnRpbWVMYWJlbC51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiVElNRTpcIitNYXRoLmZsb29yKHRoYXQudGltZUxpbWl0LzMwKTtcbiAgICAgICAgICAgIGlmICh0aGF0LnRpbWVMaW1pdCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxsID0gJ3JlZCc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsbCA9ICd3aGl0ZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOijheWCmeatpuWZqOihqOekulxuICAgICAgICB0aGlzLnBsYXllcldlYXBvbiA9IHFmdC5QbGF5ZXJXZWFwb24odGhpcy5wbGF5ZXIpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVy0zMCwgU0NfSC0zMCk7XG4gICAgICAgIHZhciBzdyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiA2MCwgaGVpZ2h0OiA2MH0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1ctMzAsIFNDX0gtMzApXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSlcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjApO1xuICAgICAgICBzdy5vbigncG9pbnRzdGFydCcsIGUgPT4ge1xuICAgICAgICAgICAgdmFyIHBsID0gdGhhdC5wbGF5ZXI7XG4gICAgICAgICAgICBpZiAoIXBsLmJlZm9yZS5jaGFuZ2UgJiYgcGwuZXF1aXAuc3dpdGNoT2spIHBsLnN3aXRjaFdlYXBvbigpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jg57jg4Pjg5fmg4XloLHjga7liJ3mnJ/ljJZcbiAgICBzZXR1cFN0YWdlOiBmdW5jdGlvbigpIHtcblxuICAgICAgICB0aGlzLmJhc2VMYXllci5yZW1vdmVDaGlsZHJlbigpO1xuXG4gICAgICAgIC8v55m76Yyy5riI44G/44Oe44OD44OX44Gu5raI5Y67XG4gICAgICAgIHRoaXMuY2xlYXJNYXAoKTtcblxuICAgICAgICAvL+OCueODhuODvOOCuOioreWumuiqreOBv+i+vOOBv1xuICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhZ2VOdW1iZXIpIHtcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTEodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlMih0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2UzKHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTQodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlNSh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2U2KHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTcodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlOCh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2U5KHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTA6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2UxMCh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0VuZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgLy/jgrfjgrnjg4bjg6DooajnpLrjga7vvK/vvKbvvKZcbiAgICAgICAgICAgICAgICB0aGlzLmxpZmVHYXVnZUxhYmVsLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxpZmVHYXVnZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zY29yZUxhYmVsLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVMYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJXZWFwb24udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA5OTk6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2U5OTkodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8v44K544OG44O844K444Kv44Oq44Ki44OV44Op44Kw44Kv44Oq44KiXG4gICAgICAgIHRoaXMuaXNTdGFnZUNsZWFyID0gZmFsc2U7XG5cbiAgICAgICAgLy/ntYzpgY7mmYLplpPliJ3mnJ/ljJZcbiAgICAgICAgdGhpcy50aW1lID0gMDtcblxuICAgICAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiOioreWumlxuICAgICAgICB0aGlzLnRpbWVMaW1pdCA9IHRoaXMuc3RhZ2VDb250cm9sbGVyLnRpbWVMaW1pdDtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOioreWumlxuICAgICAgICB0aGlzLnBsYXllci5pc0NvbnRyb2wgPSB0cnVlO1xuICAgICAgICB0aGlzLnBsYXllci5pc011dGVraSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBsYXllci5hbHBoYSA9IDEuMDtcblxuICAgICAgICB0aGlzLm1hcHN0YXJ0ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpO1xuXG4gICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyLnBsYXlCR00oKTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgqTjg5njg7Pjg4jnmbrngatcbiAgICBmaXJlU3RhZ2VFdmVudDogZnVuY3Rpb24oZXZlbnROYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YWdlQ29udHJvbGxlci5maXJlRXZlbnQoZXZlbnROYW1lKTtcbiAgICB9LFxuXG4gICAgd2FycDogZnVuY3Rpb24oeCwgeSwgZnJhbWUpIHtcbiAgICAgICAgZnJhbWUgPSBmcmFtZSB8fCA2MDtcbiAgICAgICAgdGhpcy5wbGF5ZXIuaXNDb250cm9sID0gZmFsc2U7XG4gICAgICAgIHRoaXMucGxheWVyLmdyYXZpdHkgPSAwO1xuICAgICAgICB0aGlzLnBsYXllci52eCA9IDA7XG4gICAgICAgIHRoaXMucGxheWVyLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCg0NSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhpcy5pZ25vcmVDb2xsaXNpb24gPSB0cnVlO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMucGxheWVyKSlcbiAgICAgICAgICAgIC5tb3ZlVG8oeCwgeSwgZnJhbWUsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGlzLmlnbm9yZUNvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3Jhdml0eSA9IDAuOTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzLnBsYXllcikpXG4gICAgICAgICAgICAud2FpdCg5MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0NvbnRyb2wgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNNdXRla2kgPSBmYWxzZTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzLnBsYXllcikpO1xuICAgIH0sXG5cbiAgICAvL+ODnuODg+ODl+aDheWgseOBrua2iOWOu1xuICAgIGNsZWFyTWFwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/lvZPjgZ/jgorliKTlrprjgIHjgqrjg5bjgrjjgqfjgq/jg4jjga7lhajmtojljrtcbiAgICAgICAgaWYgKHRoaXMuYmFja2dyb3VuZExheWVyKSB0aGlzLmJhY2tncm91bmRMYXllci5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICBpZiAodGhpcy5mb3JlZ3JvdW5kTGF5ZXIpIHRoaXMuZm9yZWdyb3VuZExheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG4gICAgICAgIGlmICh0aGlzLmNvbGxpc2lvbkxheWUpIHRoaXMuY29sbGlzaW9uTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICAgICAgaWYgKHRoaXMuZW5lbXlMYXllcikgdGhpcy5lbmVteUxheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG4gICAgICAgIGlmICh0aGlzLm9iakxheWVyKSB0aGlzLm9iakxheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG4gICAgICAgIGlmICh0aGlzLm1hcEltYWdlTGF5ZXIpIHRoaXMubWFwSW1hZ2VMYXllci5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICBpZiAodGhpcy5lZmZlY3RMYXllcikgdGhpcy5lZmZlY3RMYXllci5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICBpZiAodGhpcy5zaGFkb3dMYXllcikgdGhpcy5zaGFkb3dMYXllci5yZW1vdmVDaGlsZHJlbigpO1xuICAgIH0sXG5cbiAgICAvL+ODnuODg+ODl+ODrOOCpOODpOOBruWIh+abv1xuICAgIHN3aXRjaE1hcDogZnVuY3Rpb24obGF5ZXIsIHgsIHkpIHtcbiAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIpIHRoaXMubWFwTGF5ZXIucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMubWFwTGF5ZXIgPSBsYXllcjtcbiAgICAgICAgdGhpcy5tYXBMYXllci5hZGRDaGlsZFRvKHRoaXMuYmFzZUxheWVyKTtcbiAgICAgICAgdGhpcy5tYXAgPSBsYXllci5tYXA7XG5cbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kTGF5ZXIgPSBsYXllci5iYWNrZ3JvdW5kTGF5ZXI7XG4gICAgICAgIHRoaXMuZm9yZWdyb3VuZExheWVyID0gbGF5ZXIuZm9yZWdyb3VuZExheWVyO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbkxheWVyID0gbGF5ZXIuY29sbGlzaW9uTGF5ZXI7XG4gICAgICAgIHRoaXMuZW5lbXlMYXllciA9IGxheWVyLmVuZW15TGF5ZXI7XG4gICAgICAgIHRoaXMucGxheWVyTGF5ZXIgPSBsYXllci5wbGF5ZXJMYXllcjtcbiAgICAgICAgdGhpcy5vYmpMYXllciA9IGxheWVyLm9iakxheWVyO1xuICAgICAgICB0aGlzLm1hcEltYWdlTGF5ZXIgPSBsYXllci5tYXBJbWFnZUxheWVyO1xuICAgICAgICB0aGlzLmVmZmVjdExheWVyID0gbGF5ZXIuZWZmZWN0TGF5ZXI7XG4gICAgICAgIHRoaXMuc2hhZG93TGF5ZXIgPSBsYXllci5zaGFkb3dMYXllcjtcblxuICAgICAgICB0aGlzLnBsYXllci5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuYWRkQ2hpbGRUbyhsYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgIGlmICh4KSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODquOCueOCv+ODvOODiFxuICAgIHJlc3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnBsYXllci5jb250aW51ZVJlc2V0KCk7XG4gICAgICAgIHRoaXMucGxheWVyLm11dGVraVRpbWUgPSA5MDtcbiAgICAgICAgdGhpcy5wbGF5ZXIuYWRkQ2hpbGRUbyh0aGlzLm1hcExheWVyLnBsYXllckxheWVyKTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOW6p+aomeOCkuacgOW+jOOBq+W6iuOBq+OBhOOBn+WgtOaJgOOBq+OBmeOCi1xuICAgICAgICB0aGlzLnBsYXllci54ID0gdGhpcy5wbGF5ZXIubGFzdE9uRmxvb3JYO1xuICAgICAgICB0aGlzLnBsYXllci55ID0gdGhpcy5wbGF5ZXIubGFzdE9uRmxvb3JZO1xuXG4gICAgICAgIC8v5b6p5biw5L2N572u5a6J5YWo5oCn56K66KqNXG4gICAgICAgIHZhciB4ID0gdGhpcy5wbGF5ZXIueDtcbiAgICAgICAgdmFyIHkgPSB0aGlzLnBsYXllci55O1xuICAgICAgICB2YXIgYzEgPSB0aGlzLnBsYXllci5jaGVja01hcENvbGxpc2lvbjIoeCwgeSArIDUsIDQsIDMyKTsgICAvL+ecn+S4i1xuICAgICAgICB2YXIgYzIgPSB0aGlzLnBsYXllci5jaGVja01hcENvbGxpc2lvbjIoeCszMiwgeSArIDUsIDQsIDMyKTsvL+WPs+S4i1xuICAgICAgICB2YXIgYzMgPSB0aGlzLnBsYXllci5jaGVja01hcENvbGxpc2lvbjIoeC0zMiwgeSArIDUsIDQsIDMyKTsvL+W3puS4i1xuICAgICAgICAvL+ecn+S4i+OBq+i2s+WgtOOBjOeEoeOBhOWgtOWQiOOBr+WuieWFqOOBquWgtOaJgOOBq+OBmuOCieOBmVxuICAgICAgICBpZiAoIWMxKSB7XG4gICAgICAgICAgICBpZiAoYzIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci54ICs9IDMyO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjMyl7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIueCAtPSAzMjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy/lronlhajjgavlvqnluLDlh7rmnaXjgarjgYTjga7jgafnm7Tov5Hjga7jgrnjgr/jg7zjg4jlnLDngrnjgbhcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci54ID0gdGhpcy5tYXBzdGFydC54O1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLnkgPSB0aGlzLm1hcHN0YXJ0Lnk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRvdGFsU2NvcmUgPSAwO1xuICAgICAgICB0aGlzLnRvdGFsS2lsbCA9IDA7XG4gICAgICAgIHRoaXMuY29udGludWVDb3VudCsrO1xuXG4gICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyLnBsYXlCR00oKTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqJcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIlVidW50dU1vbm9cIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDIwLFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcblxuICAgICAgICAvL+OCquODvOODq+OCr+ODquOCouWIpOWumlxuICAgICAgICB0aGlzLmFsbENsZWFyID0gZmFsc2U7XG4gICAgICAgIGlmICghdGhpcy5pc1ByYWN0aWNlICYmIHRoaXMuc3RhZ2VOdW1iZXIgPj0gdGhpcy5zdGFnZU51bWJlck1heCkgdGhpcy5hbGxDbGVhciA9IHRydWU7XG5cbiAgICAgICAgLy/jgq/jg6rjgqLjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgdmFyIHRleHQgPSBcIlNUQUdFIFwiICsgdGhpcy5zdGFnZU51bWJlciArIFwiIENMRUFSIVwiO1xuICAgICAgICBpZiAodGhpcy5hbGxDbGVhcikgdGV4dCA9IFwiU1RBR0UgQUxMIENMRUFSIVwiO1xuICAgICAgICB0aGlzLnNwYXduTWVzc2FnZSh0ZXh0LCAyNCk7XG4gICAgICAgIHRoaXMucGxheWVyLmlzQ29udHJvbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlci5zdGFnZUNsZWFyKCk7XG4gICAgICAgIHRoaXMuaXNTdGFnZUNsZWFyID0gdHJ1ZTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaJgOaMgeOCreODvOOCr+ODquOColxuICAgICAgICB0aGlzLnBsYXllci5rZXlzID0gW107XG4gICAgICAgIHRoaXMucGxheWVyLmlzTXV0ZWtpID0gdHJ1ZTtcblxuICAgICAgICAvL+OCr+ODquOCokJHTVxuICAgICAgICB2YXIgYmdtRmluaXNoID0gZmFsc2U7XG4gICAgICAgIGFwcC5wbGF5QkdNKFwic3RhZ2VjbGVhclwiLCBmYWxzZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBiZ21GaW5pc2ggPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgYXIgPSB7bG9hZGNvbXBsZXRlOiB0cnVlfTtcbiAgICAgICAgaWYgKCF0aGlzLmlzUHJhY3RpY2UpIHtcbiAgICAgICAgICAgIC8v44Kv44Oq44Ki5pmC54K55oOF5aCx5L+d5a2YXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzdGFnZTogdGhpcy5zdGFnZU51bWJlcixcbiAgICAgICAgICAgICAgICBzY29yZTogdGhpcy50b3RhbFNjb3JlLFxuICAgICAgICAgICAgICAgIGtpbGw6IHRoaXMudG90YWxLaWxsLFxuICAgICAgICAgICAgICAgIHRpbWU6IHRoaXMuc3RhZ2VDb250cm9sbGVyLnRpbWVMaW1pdCAtIHRoaXMudGltZUxpbWl0LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJSZXN1bHRbdGhpcy5zdGFnZU51bWJlcl0gPSBkYXRhO1xuXG4gICAgICAgICAgICAvL+asoeOCueODhuODvOOCuOOBruOCouOCu+ODg+ODiOiqreOBv+i+vOOBv1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhZ2VOdW1iZXIgPCB0aGlzLnN0YWdlTnVtYmVyTWF4KSB7XG4gICAgICAgICAgICAgICAgdmFyIGFzc2V0cyA9IHFmdC5Bc3NldHMuZ2V0KHthc3NldFR5cGU6IFwic3RhZ2VcIisodGhpcy5zdGFnZU51bWJlcisxKX0pO1xuICAgICAgICAgICAgICAgIHZhciBhciA9IHBoaW5hLmV4dGVuc2lvbi5Bc3NldExvYWRlckV4KCkubG9hZChhc3NldHMsIGZ1bmN0aW9uKCl7YXBwLnNvdW5kc2V0LnJlYWRBc3NldCgpO30pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL+OCquODvOODq+OCr+ODquOCouaZguOBr+OCqOODs+ODh+OCo+ODs+OCsOeUqOOCueODhuODvOOCuOOBuFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFsbENsZWFyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhc3NldHMgPSBxZnQuQXNzZXRzLmdldCh7YXNzZXRUeXBlOiBcInN0YWdlMTBcIn0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXIgPSBwaGluYS5leHRlbnNpb24uQXNzZXRMb2FkZXJFeCgpLmxvYWQoYXNzZXRzLCBmdW5jdGlvbigpe2FwcC5zb3VuZHNldC5yZWFkQXNzZXQoKTt9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODreODvOODiemAsuaNl+ihqOekulxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBwYXJhbSA9IHt0ZXh0OiBcIkxvYWRpbmcuLi4gXCIsIGFsaWduOiBcInJpZ2h0XCIsIGZvbnRTaXplOiAyMH0uJHNhZmUobGFiZWxQYXJhbSk7XG4gICAgICAgIHZhciBwcm9ncmVzcyA9IHBoaW5hLmRpc3BsYXkuTGFiZWwocGFyYW0pLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVywgU0NfSCowLjk1KTtcbiAgICAgICAgcHJvZ3Jlc3MudGltZSA9IDA7XG4gICAgICAgIHByb2dyZXNzLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jg63jg7zjg4njgYzntYLjgo/jgaPjgZ/jgonjgq3jg7zlhaXlipvjgafmrKHjgrnjg4bjg7zjgrjjgbhcbiAgICAgICAgICAgIGlmIChhci5sb2FkcHJvZ3Jlc3MpIHRoaXMudGV4dCA9IFwiTG9hZGluZy4uLiBcIitNYXRoLmZsb29yKGFyLmxvYWRwcm9ncmVzcyAqIDEwMCkrXCIlXCI7XG4gICAgICAgICAgICBpZiAoYmdtRmluaXNoICYmIHRoYXQudGltZUxpbWl0ID09IDAgJiYgYXIubG9hZGNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0ID0gXCJQdXNoIGJ1dHRvbiB0byBuZXh0IHN0YWdlLlwiO1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LmFsbENsZWFyKSB0aGlzLnRleHQgPSBcIlB1c2ggYnV0dG9uIHRvIG5leHQuLi5cIjtcbiAgICAgICAgICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgICAgICAgICBpZiAoY3Qub2sgfHwgY3QuY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmlzUHJhY3RpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX2V4aXRHYW1lID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZmxhcmUoJ25leHRzdGFnZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMudGltZSAlIDMwID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgICAgICB0aGlzLnRpbWUrKztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBleGl0R2FtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGFwcC5wbGF5QkdNKFwib3BlbmluZ2JnbVwiKTtcbiAgICAgICAgaWYgKHRoaXMuaXNQcmFjdGljZSB8fCB0aGlzLmlzQ29udGludWUpIHtcbiAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5leGl0KFwidGl0bGVcIik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/nj77lnKjjga7jgrnjg4bjg7zjgr/jgrnjgpLjg63jg7zjgqvjg6vjgrnjg4jjg6zjg7zjgrjjgbjkv53lrZhcbiAgICBzYXZlR2FtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzYXZlT2JqID0ge1xuICAgICAgICAgICAgc3RhZ2VOdW1iZXI6IHRoaXMuc3RhZ2VOdW1iZXIsXG4gICAgICAgICAgICBzY29yZTogdGhpcy50b3RhbFNjb3JlLFxuICAgICAgICAgICAga2lsbDogdGhpcy50b3RhbEtpbGwsXG4gICAgICAgICAgICByZXN1bHQ6IHRoaXMuY2xlYXJSZXN1bHQsXG4gICAgICAgICAgICBwbGF5ZXJTdGF0dXM6IHRoaXMucGxheWVyLnN0YXJ0U3RhdHVzLFxuICAgICAgICB9O1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInN0YWdlXCIsIEpTT04uc3RyaW5naWZ5KHNhdmVPYmopKTtcbiAgICAgICAgcmV0dXJuIHNhdmVPYmo7XG4gICAgfSxcblxuICAgIC8v44Ot44O844Kr44Or44K544OI44Os44O844K444GL44KJ55u05YmN44Gu5L+d5a2Y54q25oWL44KS6Kqt44G/6L6844G/XG4gICAgbG9hZEdhbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic3RhZ2VcIik7XG4gICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICB2YXIgZCA9IEpTT04ucGFyc2UoZGF0YSkuJHNhZmUoe1xuICAgICAgICAgICAgICAgIHN0YWdlTnVtYmVyOiAxLFxuICAgICAgICAgICAgICAgIHJlc3VsdDogW10sXG4gICAgICAgICAgICAgICAgcGxheWVyU3RhdHVzOiB7fSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zdGFnZU51bWJlciA9IGQuc3RhZ2VOdW1iZXI7XG4gICAgICAgICAgICB0aGlzLnRvdGFsU2NvcmUgPSAwO1xuICAgICAgICAgICAgdGhpcy50b3RhbEtpbGwgPSAwO1xuICAgICAgICAgICAgdGhpcy5jbGVhclJlc3VsdCA9IGQucmVzdWx0O1xuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaDheWgseW+qeWFg1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuc3RhcnRTdGF0dXMgPSBkLnBsYXllclN0YXR1cztcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnJlc3RvcmVTdGF0dXMoKTtcbiAgICAgICAgICAgIHRoaXMucGxheWVyV2VhcG9uLnJvdGF0aW9uID0gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIG1lbnVzY2VuZS5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG4gXG5waGluYS5kZWZpbmUoXCJxZnQuTWVudVNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihjdXJyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUgPSBjdXJyZW50U2NlbmU7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuNSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDAuNSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSlcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImxlZnRcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDE2LFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnBsYXllciA9IHRoaXMuY3VycmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdGhpcy5saW1pdEZyYW1lID0gMzA7XG4gICAgICAgIHRoaXMuaXNFeGl0ID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiA1LFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcInRpdGxlZm9udDJcIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogNzAsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGV4dExhYmVsMSA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiUEFVU0VcIiwgZm9udFNpemU6IDIwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuOCk7XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDsgICAgICAgIFxuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDEwICYmICF0aGlzLmlzRXhpdCkge1xuICAgICAgICAgICAgaWYgKGN0LnN0YXJ0IHx8IGN0LnBhdXNlIHx8IGN0Lm1lbnUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRXhpdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLndhaXQoMTAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wb3BTY2VuZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpbWl0RnJhbWUtLTtcbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcbn0pO1xuXG4iLCIvKlxuICogIG1lbnVzY2VuZS5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG4gXG5waGluYS5kZWZpbmUoXCJxZnQuTWVudVNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihjdXJyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUgPSBjdXJyZW50U2NlbmU7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuNSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDAuNSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSlcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImxlZnRcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDE2LFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnBsYXllciA9IHRoaXMuY3VycmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIHggPSBTQ19XKjAuMzsgLy90aGlzLnBsYXllci54ICsgdGhpcy5jdXJyZW50U2NlbmUubWFwTGF5ZXIueDtcbiAgICAgICAgdmFyIHkgPSBTQ19IKjAuNTsgLy90aGlzLnBsYXllci55ICsgdGhpcy5jdXJyZW50U2NlbmUubWFwTGF5ZXIueTtcblxuICAgICAgICAvL+ODmeODvOOCueOCqOODrOODoeODs+ODiFxuICAgICAgICB0aGlzLm1lbnVCYXNlID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgIHRoaXMubWVudUJhc2UudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcblxuICAgICAgICAvL+ODoeODi+ODpeODvOOCouOCpOODhuODoOWIneacn+WMllxuICAgICAgICB0aGlzLnNldEl0ZW1zKCk7XG5cbiAgICAgICAgLy/nj77lnKjoo4XlgpnooajnpLpcbiAgICAgICAgdmFyIGVxID0gdGhpcy5wbGF5ZXIuZXF1aXA7XG4gICAgICAgIHRoaXMud2VhcG9uID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJpdGVtXCIsIDI0LCAyNClcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNTUsIFNDX0gqMC4zKVxuICAgICAgICAgICAgLnNldFNjYWxlKDEuNSlcbiAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KGVxLndlYXBvblswXSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLndlYXBvbkxhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJcIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjU1KzMyLCBTQ19IKjAuMylcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLndlYXBvbkxhYmVsLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBxZnQuSXRlbUluZm8uZ2V0KGVxLndlYXBvblswXSk7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSBpdGVtLm5hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5saW1pdEZyYW1lID0gMzA7XG5cbiAgICAgICAgdGhpcy5pc0V4aXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy50aW1lID0gMDsgICAgICAgIFxuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDEwICYmICF0aGlzLmlzRXhpdCkge1xuICAgICAgICAgICAgaWYgKGN0LnN0YXJ0IHx8IGN0LnBhdXNlIHx8IGN0Lm1lbnUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRXhpdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC53YWl0KDEwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAucG9wU2NlbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3QucmlnaHQgJiYgdGhpcy5saW1pdEZyYW1lIDwgMCkge1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJjbGlja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lbnVCYXNlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuYnkoe3JvdGF0aW9uOiAtdGhpcy5kZWdfMX0sIDQpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yb3RhdGlvbiA8IDApIHRoaXMucm90YXRpb24gKz0gMzYwO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcy5tZW51QmFzZSkpO1xuICAgICAgICAgICAgICAgIHRoaXMubGltaXRGcmFtZSA9IDU7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUubWVudVNlbGVjdCsrO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRTY2VuZS5tZW51U2VsZWN0ID09IHRoaXMuaWNvbi5sZW5ndGgpIHRoaXMuY3VycmVudFNjZW5lLm1lbnVTZWxlY3QgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN0LmxlZnQgJiYgdGhpcy5saW1pdEZyYW1lIDwgMCkge1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJjbGlja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lbnVCYXNlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuYnkoe3JvdGF0aW9uOiB0aGlzLmRlZ18xfSwgNClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvdGF0aW9uID4gMzYwKSB0aGlzLnJvdGF0aW9uIC09IDM2MDtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMubWVudUJhc2UpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxpbWl0RnJhbWUgPSA1O1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFNjZW5lLm1lbnVTZWxlY3QtLTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50U2NlbmUubWVudVNlbGVjdCA8IDApIHRoaXMuY3VycmVudFNjZW5lLm1lbnVTZWxlY3QgPSB0aGlzLmljb24ubGVuZ3RoLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5saW1pdEZyYW1lLS07XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG5cbiAgICBzZXRJdGVtczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAyNCxcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLm1lbnVCYXNlLnJlbW92ZUNoaWxkcmVuKCk7XG5cbiAgICAgICAgLy/jg6Hjg4vjg6Xjg7zjgqLjgqTjg4bjg6BcbiAgICAgICAgdGhpcy5pY29uID0gW107XG4gICAgICAgIHRoaXMubWVudUl0ZW1zID0gdGhpcy5wbGF5ZXIuaXRlbXMuY2xvbmUoKTtcblxuICAgICAgICB2YXIgcmFkID0gMDtcbiAgICAgICAgdmFyIHJhZF8xID0gKE1hdGguUEkqMikgLyB0aGlzLm1lbnVJdGVtcy5sZW5ndGg7XG4gICAgICAgIHZhciBpZCA9IDA7XG4gICAgICAgIHRoaXMubWVudUl0ZW1zLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyIGljO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGljID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogZX0uJHNhZmUobGFiZWxQYXJhbSkpLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSk7XG4gICAgICAgICAgICAgICAgaWMuc2V0U2NhbGUoMC41KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWMgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIml0ZW1cIiwgMjQsIDI0KVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgICAgICAgICAuc2V0RnJhbWVJbmRleChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGljLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgICAgICBpYy5yYWQgPSByYWQ7XG4gICAgICAgICAgICBpYy5pZCA9IGlkO1xuICAgICAgICAgICAgaWMuZGlzdGFuY2UgPSAwO1xuICAgICAgICAgICAgaWMuaXNDbG9zZSA9IGZhbHNlO1xuICAgICAgICAgICAgaWMudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3RhdGlvbiA9IC10aGF0Lm1lbnVCYXNlLnJvdGF0aW9uO1xuICAgICAgICAgICAgICAgIHRoaXMueCA9ICBNYXRoLnNpbih0aGlzLnJhZCkqdGhpcy5kaXN0YW5jZTtcbiAgICAgICAgICAgICAgICB0aGlzLnkgPSAtTWF0aC5jb3ModGhpcy5yYWQpKnRoaXMuZGlzdGFuY2U7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDbG9zZSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkID09IHRoYXQuY3VycmVudFNjZW5lLm1lbnVTZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKCkudG8oe2Rpc3RhbmNlOiA4OCwgc2NhbGVYOiAzLCBzY2FsZVk6IDN9LCAzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKS50byh7ZGlzdGFuY2U6IDcyLCBzY2FsZVg6IDEsIHNjYWxlWTogMX0sIDMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGljLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKCkudG8oe2Rpc3RhbmNlOiAwLCBzY2FsZVg6IDEsIHNjYWxlWTogMX0sIDMpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNDbG9zZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpYy50d2VlbmVyLmNsZWFyKCkudG8oe2Rpc3RhbmNlOiA0OH0sIDUwMCk7XG4gICAgICAgICAgICB0aGlzLmljb24ucHVzaChpYyk7XG4gICAgICAgICAgICByYWQgKz0gcmFkXzE7XG4gICAgICAgICAgICBpZCsrO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHRoaXMuZGVnXzEgPSAzNjAvIHRoaXMubWVudUl0ZW1zLmxlbmd0aDtcbiAgICAgICAgdGhpcy5tZW51QmFzZS5yb3RhdGlvbiA9IC0odGhpcy5jdXJyZW50U2NlbmUubWVudVNlbGVjdCAqIHRoaXMuZGVnXzEpIC0gOTA7XG4gICAgICAgIHRoaXMubWVudUJhc2UudHdlZW5lci5ieSh7cm90YXRpb246IDkwfSwgMTUsIFwiZWFzZU91dFNpbmVcIik7XG4gICAgfSxcblxuICAgIGNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5tZW51QmFzZS50d2VlbmVyLmNsZWFyKCkuYnkoe3JvdGF0aW9uOiAxODB9LCAxNSwgXCJlYXNlT3V0U2luZVwiKTtcbiAgICAgICAgdGhpcy5pY29uLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgZS5jbG9zZSgpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcblxuIiwiLypcbiAqICBtZXNzYWdlc2NlbmUuanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuIFxucGhpbmEuZGVmaW5lKFwicWZ0Lk1lc3NhZ2VTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oY3VycmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIHRoaXMuY3VycmVudFNjZW5lID0gY3VycmVudFNjZW5lO1xuXG4gICAgICAgIC8v44Oh44OD44K744O844K444Km44Kj44Oz44OJ44KmXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1cqMC44LFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gqMC40LFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuOClcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3R0b2tlV2lkdGg6IDUsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjI1KVxuICAgICAgICAgICAgLnNldFNjYWxlKDEsIDApO1xuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVZOiAxfSwgNTAwLCBcImVhc2VPdXRDdWJlXCIpO1xuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAxNixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGV4dExhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogb3B0aW9ucy5tZXNzYWdlIHx8IFwibm8gbWVzc2FnZVwiLCBmb250U2l6ZTogMjB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC4yNSk7XG5cbiAgICAgICAgdGhpcy5wbGF5ZXIgPSB0aGlzLmN1cnJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHRoaXMubGltaXRGcmFtZSA9IDMwO1xuICAgICAgICB0aGlzLmlzRXhpdCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMudGltZSA9IDA7ICAgICAgICBcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxMCAmJiAhdGhpcy5pc0V4aXQpIHtcbiAgICAgICAgICAgIGlmIChjdC5zdGFydCB8fCBjdC5wYXVzZSB8fCBjdC5tZW51KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0V4aXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC53YWl0KDEwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAucG9wU2NlbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5saW1pdEZyYW1lLS07XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG59KTtcblxuIiwiLypcbiAqICBvcGVuaW5nc2NlbmUuanNcbiAqICAyMDE3LzAyLzA4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuIFxucGhpbmEuZGVmaW5lKFwicWZ0Lk9wZW5pbmdTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgLy/pgLLooYxcbiAgICBzZXE6IDAsXG5cbiAgICBpbml0OiBmdW5jdGlvbihjdXJyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUgPSBjdXJyZW50U2NlbmU7XG5cbiAgICAgICAgLy/vvKLvvKfvvK3lho3nlJ9cbiAgICAgICAgYXBwLnBsYXlCR00oXCJvcGVuaW5nYmdtXCIpO1xuXG4gICAgICAgIHRoaXMudGV4dCA9IFtcbiAgICAgICAgICAgIFwi5LiW55WM44Gu5Lit5b+D44Gr44Gd44Gz44GI44KL5aGUXCIsXG4gICAgICAgICAgICBcIuWhlOOBruacgOS4iumajuOBq+OBr1wiLFxuICAgICAgICAgICAgXCLjgIzmsLjpgaDjga7pg73jgI3jgajlkbzjgbDjgozjgovmpb3lnJLjgYzjgYLjgovjgajjgYTjgYZcIixcbiAgICAgICAgICAgIFwi5ZmC44KS6IGe44GE44Gf5aSa44GP44Gu5YaS6Zm66ICF44GMXCIsXG4gICAgICAgICAgICBcIualveWckuOCkuaxguOCgeOBpuWhlOOBuOOBqOi1tOOBjVwiLFxuICAgICAgICAgICAgXCLjgZ3jga7orI7jgavmjJHjgpPjgafjgYTjgaPjgZ9cIixcbiAgICAgICAgICAgIFwi44GX44GL44GX4oCmXCIsXG4gICAgICAgICAgICBcIuW9vOOCieOBjOaenOOBn+OBl+OBpualveWckuOBq+i+v+OCiuedgOOBhOOBn+OBruOBi1wiLFxuICAgICAgICAgICAgXCLjgZ3jgozjgajjgoLkuJbnlYzjga7mnpzjgabjgaflipvlsL3jgY3jgZ/jga7jgYtcIixcbiAgICAgICAgICAgIFwi44Gd44Gu5pyr6Lev44KS55+l44KL6ICF44Gv44GE44Gq44GEXCIsXG4gICAgICAgICAgICBcIuOBneOBl+OBpuKAplwiLFxuICAgICAgICAgICAgXCLmlrDjgZ/jgarlhpLpmbrogIXjgYzjgb7jgZ/kuIDkurpcIixcbiAgICAgICAgICAgIFwi44GE44G+44Gg6KaL44Gs5qW95ZyS44G444Gu6YGT44Gr5oyR44KC44GG44Go44GX44Gm44GE44GfXCIsXG4gICAgICAgIF07XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6IFNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6IFNDX0gsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSlcblxuICAgICAgICAvL+OCpOODoeODvOOCuOihqOekuueUqOODrOOCpOODpFxuICAgICAgICB0aGlzLmltYWdlTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyh0aGlzKTtcblxuICAgICAgICAvL+ODleOCqeOCouOCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMuZmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSkuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMuZmcuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLmZnLm9ucG9pbnRzdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoYXQuYWxyZWFkeUxvYWQgfHwgdGhhdC5sb2FkZXIgJiYgdGhhdC5sb2FkZXIubG9hZGNvbXBsZXRlKSB0aGF0LmV4aXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5LiK5LiL6buS5bivXG4gICAgICAgIHBhcmFtLmhlaWdodCA9IFNDX0ggKiAwLjE1O1xuICAgICAgICB0aGlzLmJnMSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC4wNylcbiAgICAgICAgdGhpcy5iZzIgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuOTMpXG5cbiAgICAgICAgLy/lrZfluZVcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDE0LFxuICAgICAgICB9O1xuICAgICAgICB2YXIgbnVtID0gMDtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlwifS4kc2FmZShsYWJlbFBhcmFtKSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjkpO1xuICAgICAgICB0aGlzLnRleHRMYWJlbC5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMudGV4dExhYmVsLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0TGFiZWwudGV4dCA9IHRoaXMudGV4dFtudW1dO1xuICAgICAgICAgICAgICAgIG51bSsrO1xuICAgICAgICAgICAgICAgIGlmIChudW0gPT0gdGhpcy50ZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRMYWJlbC50d2VlbmVyLnNldExvb3AoZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC5mYWRlSW4oNTAwKVxuICAgICAgICAgICAgLndhaXQoMzAwMClcbiAgICAgICAgICAgIC5mYWRlT3V0KDUwMClcbiAgICAgICAgICAgIC53YWl0KDEwMDApXG4gICAgICAgICAgICAuc2V0TG9vcCh0cnVlKTtcblxuICAgICAgICAvL+WfuuacrOOCouOCu+ODg+ODiOOCkuODreODvOODiVxuICAgICAgICB0aGlzLmFscmVhZHlMb2FkID0gZmFsc2U7XG4gICAgICAgIGlmIChxZnQuQXNzZXRzLmlzTG9hZGVkKFwiY29tbW9uXCIpKSB7XG4gICAgICAgICAgICAvL+iqrei+vOa4iOOBv+OBquOBruOBp+OCueOCreODg+ODl1xuICAgICAgICAgICAgdGhpcy5hbHJlYWR5TG9hZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgYXNzZXRzID0gcWZ0LkFzc2V0cy5nZXQoe2Fzc2V0VHlwZTogXCJjb21tb25cIn0pO1xuICAgICAgICB0aGlzLmxvYWRlciA9IHBoaW5hLmV4dGVuc2lvbi5Bc3NldExvYWRlckV4KCkubG9hZChhc3NldHMsIGZ1bmN0aW9uKCl7YXBwLnNvdW5kc2V0LnJlYWRBc3NldCgpO30pO1xuICAgICAgICB0aGlzLmxvYWRMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiXCIsIGFsaWduOiBcInJpZ2h0XCIsIGZvbnRTaXplOiAxMn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC45OSwgU0NfSCowLjEpO1xuICAgICAgICB0aGlzLmxvYWRMYWJlbC50aW1lID0gMTsgICAgXG4gICAgICAgIHRoaXMubG9hZExhYmVsLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gXCJMb2FkaW5nLi4uIFwiK01hdGguZmxvb3IodGhhdC5sb2FkZXIubG9hZHByb2dyZXNzICogMTAwKStcIiVcIjtcbiAgICAgICAgICAgIGlmICh0aGF0LmxvYWRlci5sb2FkY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSBcIlB1c2ggYnV0dG9uIHRvIHNraXAuXCI7XG4gICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGltZSAlIDIwID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnRpbWUrKztcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuYWxyZWFkeUxvYWQgfHwgdGhpcy5sb2FkZXIgJiYgdGhpcy5sb2FkZXIubG9hZGNvbXBsZXRlKSB7XG4gICAgICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgICAgIGlmIChjdC5vayB8fCBjdC5jYW5jZWwpIHRoaXMuZXhpdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc2VxID09IDApIHtcbiAgICAgICAgICAgIHRoaXMud29ybGRtYXAoKTtcbiAgICAgICAgICAgIHRoaXMuc2VxKys7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VxID09IDIpIHtcbiAgICAgICAgICAgIHRoaXMudG93ZXJpbWFnZSgpO1xuICAgICAgICAgICAgdGhpcy5zZXErKztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZXEgPT0gNCkge1xuICAgICAgICAgICAgdGhpcy5zZXF1ZW5jZTMoKTtcbiAgICAgICAgICAgIHRoaXMuc2VxKys7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VxID09IDYpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyaW1hZ2UoKTtcbiAgICAgICAgICAgIHRoaXMuc2VxKys7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VxID09IDgpIHtcbiAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v5LiW55WM5Zyw5ZuzXG4gICAgd29ybGRtYXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3ByaXRlMSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwib3BlbmluZ21hcFwiKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5pbWFnZUxheWVyKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cgKiAwLjUsIC1TQ19IICogMC4yNSlcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjgpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC4wKTtcbiAgICAgICAgc3ByaXRlMS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5ieSh7YWxwaGE6IDEuMCwgeTogMjAwfSwgNzAwMClcbiAgICAgICAgICAgIC5ieSh7YWxwaGE6IC0xLjAsIHk6IDIwMH0sIDcwMDApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNwcml0ZTEucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXErKztcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIC8v5aGU5aSW6KazXG4gICAgdG93ZXJpbWFnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzcHJpdGUxID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJiYWNrZ3JvdW5kXCIpLmFkZENoaWxkVG8odGhpcy5pbWFnZUxheWVyKS5zZXRQb3NpdGlvbihTQ19XICogMC41LCBTQ19IICogMC41KTtcbiAgICAgICAgc3ByaXRlMS5hbHBoYSA9IDA7XG4gICAgICAgIHNwcml0ZTEudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNwcml0ZTEuYWxwaGEgPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZmcuYWxwaGEgPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZmcudHdlZW5lci5jbGVhcigpLmZhZGVPdXQoNzAwMCkuZmFkZUluKDcwMDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoMTQwMDApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNwcml0ZTEucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXErKztcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdmFyIHNwcml0ZTIgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm9wZW5pbmd0b3dlclwiKS5hZGRDaGlsZFRvKHRoaXMuaW1hZ2VMYXllcikuc2V0UG9zaXRpb24oU0NfVyAqIDAuNSwgU0NfSCAqIDAuMyk7XG4gICAgICAgIHNwcml0ZTIuYWxwaGEgPSAwO1xuICAgICAgICBzcHJpdGUyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzcHJpdGUyLmFscGhhID0gMTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC5ieSh7eDogLTEwMH0sIDQwMDAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgLndhaXQoMzAwMClcbiAgICAgICAgICAgIC5ieSh7eTogMzAwfSwgNzAwMCwgXCJlYXNlSW5TaW5lXCIpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNwcml0ZTIucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvL+S4ieeVquebruihqOekuu+8iOaaq+Wumu+8iVxuICAgIHNlcXVlbmNlMzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzcHJpdGUxID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJvcGVuaW5nYmFjazJcIikuYWRkQ2hpbGRUbyh0aGlzLmltYWdlTGF5ZXIpLnNldFBvc2l0aW9uKFNDX1cgKiAwLjUsIFNDX0ggKiAwLjMpLnNldFNjYWxlKDEuMSk7XG4gICAgICAgIHNwcml0ZTEuYWxwaGEgPSAwO1xuICAgICAgICBzcHJpdGUxLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzcHJpdGUxLmFscGhhID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmZnLmFscGhhID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuY2xlYXIoKS5mYWRlT3V0KDcwMDApLndhaXQoMTAwMDApLmZhZGVJbig3MDAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC5ieSh7eTogMTUwfSwgMTIwMDAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgLndhaXQoMTIwMDApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNwcml0ZTEucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXErKztcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdmFyIHNwcml0ZTIgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm9wZW5pbmdsaWdodFwiKS5hZGRDaGlsZFRvKHRoaXMuaW1hZ2VMYXllcikuc2V0UG9zaXRpb24oU0NfVyAqIDAuNSwgU0NfSCAqIDAuNSk7XG4gICAgICAgIHNwcml0ZTIuYmxlbmRNb2RlID0gJ2xpZ2h0ZXInO1xuICAgICAgICBzcHJpdGUyLmFscGhhID0gMC4zO1xuICAgICAgICBzcHJpdGUyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMTIwMDApXG4gICAgICAgICAgICAuYnkoe3g6IC01MH0sIDEyMDAwLCBcImVhc2VJbk91dFNpbmVcIik7XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O86KGo56S6XG4gICAgcGxheWVyaW1hZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3ByaXRlMSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwib3BlbmluZ2JhY2tcIikuYWRkQ2hpbGRUbyh0aGlzLmltYWdlTGF5ZXIpLnNldFBvc2l0aW9uKFNDX1cgKiAwLjUsIFNDX0ggKiAwLjM1KS5zZXRTY2FsZSgxLjIpO1xuICAgICAgICBzcHJpdGUxLmFscGhhID0gMDtcbiAgICAgICAgc3ByaXRlMS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc3ByaXRlMS5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5mZy5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5mZy50d2VlbmVyLmNsZWFyKCkuZmFkZU91dCg3MDAwKS53YWl0KDUwMDApLmZhZGVJbig3MDAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDE1MDAwKVxuICAgICAgICAgICAgLmJ5KHt5OiAxNTB9LCA1MDAwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc3ByaXRlMS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcSsrO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICB2YXIgc3ByaXRlMiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwib3BlbmluZ2dyb3VuZFwiKS5hZGRDaGlsZFRvKHRoaXMuaW1hZ2VMYXllcikuc2V0UG9zaXRpb24oU0NfVyAqIDAuNSwgU0NfSCAqIDAuOSk7XG4gICAgICAgIHNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuYnkoe3k6IC01MH0sIDQwMDAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgLndhaXQoMTAwMDApXG4gICAgICAgICAgICAuYnkoe3k6IDIwMH0sIDUwMDAsIFwiZWFzZUluT3V0U2luZVwiKVxuXG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyhzcHJpdGUyKS5zZXRQb3NpdGlvbigwLCAzOCk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICBwbC50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwMDApXG4gICAgICAgICAgICAuYnkoe3k6IC03Nn0sIDUwMDAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBfc3RvcFwiKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg2MDAwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiZG93blwiKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYnkoe3k6IDc2fSwgNTAwMCwgXCJlYXNlSW5PdXRTaW5lXCIpO1xuICAgIH0sXG59KTtcblxuIiwiLypcbiAqICBwcmFjdGljZXNjZW5lLmpzXG4gKiAgMjAxNy8wNC8xNVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cbiBcbnBoaW5hLmRlZmluZShcInFmdC5Db25maWdTY2VuZV9QcmFjdGljZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG5cbiAgICAgICAgdGhpcy5tZW51QmFzZSA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLm1lbnVCYXNlLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy5tZW51QmFzZS50d2VlbmVyLmNsZWFyKCkuZmFkZUluKDUwMCk7XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiA1LFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcInRpdGxlZm9udDFcIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogNzAsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGV4dExhYmVsMSA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiUHJhY3RpY2VcIiwgZm9udFNpemU6IDIwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC4yKTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwyID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJTdGFnZSBzZWxlY3RcIiwgZm9udFNpemU6IDIwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC4zKTtcblxuICAgICAgICAvL+ODoeODi+ODpeODvOODhuOCreOCueODiOihqOekulxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMubWVudSA9IFtcIjFcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIiwgXCI1XCIsIFwiNlwiLCBcIjdcIiwgXCI4XCIsIFwiOVwiLCBcIlBcIl07XG4gICAgICAgIHRoaXMubWVudVRleHQgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1lbnUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbaV0gPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiB0aGlzLm1lbnVbaV0sIGZvbnRTaXplOiA0MH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUrKFNDX1cqMC4wNyppKS0oU0NfVyowLjA3Kih0aGlzLm1lbnUubGVuZ3RoLTEpLzIpLCBTQ19IKjAuNSlcbiAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMC43KTtcblxuICAgICAgICAgICAgLy/jgr/jg4Pjg4HliKTlrprnlKhcbiAgICAgICAgICAgIHZhciBwYXJhbTIgPSB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IDMwLFxuICAgICAgICAgICAgICAgIGhlaWdodDogU0NfSCowLjEwLFxuICAgICAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBjID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbTIpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUrKFNDX1cqMC4wNyppKS0oU0NfVyowLjA3Kih0aGlzLm1lbnUubGVuZ3RoLTEpLzIpLCBTQ19IKjAuNSlcbiAgICAgICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgICAgICBjLmFscGhhID0gMDtcbiAgICAgICAgICAgIGMuc2VsZWN0ID0gaTtcbiAgICAgICAgICAgIGMub25wb2ludHN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuaXNTZWxlY3RlZCB8fCB0aGF0LnRpbWUgPCAxMCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdCA9PSB0aGF0LnNlbGVjdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC52c2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQubWVudVRleHRbdGhhdC5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmV4aXRUZXh0LnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zZWxlY3QgPSB0aGlzLnNlbGVjdDtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5tZW51VGV4dFt0aGF0LnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52c2VsZWN0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmV4aXRUZXh0ID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJFeGl0XCIsIGZvbnRTaXplOiA0MH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNylcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjcpO1xuICAgICAgICAvL+OCv+ODg+ODgeWIpOWumueUqFxuICAgICAgICB2YXIgcGFyYW0yID0ge1xuICAgICAgICAgICAgd2lkdGg6IFNDX1cqMC4zLFxuICAgICAgICAgICAgaGVpZ2h0OiBTQ19IKjAuMTAsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHZhciBjID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbTIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNylcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgYy5hbHBoYSA9IDA7XG4gICAgICAgIGMub25wb2ludHN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhhdC5pc1NlbGVjdGVkIHx8IHRoYXQudGltZSA8IDEwKSByZXR1cm47XG4gICAgICAgICAgICBpZiAodGhhdC52c2VsZWN0ID09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGF0Lm9rID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC5tZW51VGV4dFt0aGF0LnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICB0aGF0LmV4aXRUZXh0LnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgdGhhdC52c2VsZWN0ID0gMTtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy52c2VsZWN0ID0gMDtcbiAgICAgICAgdGhpcy5zZWxlY3QgPSAwO1xuICAgICAgICB0aGlzLmlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZWxlY3RNYXggPSB0aGlzLm1lbnUubGVuZ3RoO1xuICAgICAgICB0aGlzLm1lbnVUZXh0WzBdLnNldFNjYWxlKDEpO1xuICAgICAgICB0aGlzLm9rID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2FuY2VsID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDtcblxuICAgICAgICB0aGlzLm9uKCdyZXN1bWUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMub2sgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuY2Fuc2VsID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKGN0LnJpZ2h0ICYmICFjdC5iZWZvcmUucmlnaHQgJiYgdGhpcy5zZWxlY3QgPCB0aGlzLnNlbGVjdE1heC0xICYmIHRoaXMudnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3QrKztcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMTA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN0LmxlZnQgJiYgIWN0LmJlZm9yZS5sZWZ0ICYmIHRoaXMuc2VsZWN0ID4gMCAgJiYgdGhpcy52c2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdC0tO1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAxMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3QuZG93biAmJiAhY3QuYmVmb3JlLmRvd24gJiYgdGhpcy52c2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgIHRoaXMudnNlbGVjdCsrO1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMuZXhpdFRleHQudHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAxMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3QudXAgJiYgIWN0LmJlZm9yZS51cCAmJiB0aGlzLnZzZWxlY3QgPT0gMSkge1xuICAgICAgICAgICAgdGhpcy52c2VsZWN0LS07XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy5leGl0VGV4dC50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDEwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDE1KSB7XG4gICAgICAgICAgICBpZiAoY3Qub2sgfHwgdGhpcy5vaykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZzZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuTWFpblNjZW5lKHtzdGFydFN0YWdlOiAxLCBpc1ByYWN0aWNlOiB0cnVlfSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ID09IDkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5NYWluU2NlbmUoe3N0YXJ0U3RhZ2U6IDk5OSwgaXNQcmFjdGljZTogdHJ1ZX0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWxlY3QgPT0gOCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LlNjZW5lRmxvdy5SZXN1bWUoe3N0YWdlTnVtYmVyOiAxMCwgaXNQcmFjdGljZTogZmFsc2V9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LlNjZW5lRmxvdy5SZXN1bWUoe3N0YWdlTnVtYmVyOiB0aGlzLnNlbGVjdCsxLCBpc1ByYWN0aWNlOiB0cnVlfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGFwcC5zdG9wQkdNKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZzZWxlY3QgPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiY2FuY2VsXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4aXRNZW51KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3QuY2FuY2VsIHx8IHRoaXMuY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImNhbmNlbFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmV4aXRNZW51KCk7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgZXhpdE1lbnU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLm1lbnVCYXNlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmZhZGVPdXQoNTAwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcblxucGhpbmEuZGVmaW5lKFwicWZ0LlByYWN0aWNlUGxhdGZvcm1cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgICAgIGFzc2V0VHlwZTogXCJzdGFnZTJcIixcbiAgICAgICAgICAgIHN0YXJ0U3RhZ2U6IDIsXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuY291bnQgPSAwO1xuICAgIH0sXG5cbiAgICBvbmVudGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuTG9hZGluZ1NjZW5lKHtcbiAgICAgICAgICAgIGFzc2V0czogcWZ0LkFzc2V0cy5nZXQodGhpcy5vcHRpb25zKSxcbiAgICAgICAgfSkpO1xuICAgIH0sXG5cbiAgICBvbnJlc3VtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuY291bnQrKztcbiAgICAgICAgaWYgKHRoaXMuY291bnQgPT0gMSkge1xuICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuTWFpblNjZW5lKHtzdGFydFN0YWdlOiB0aGlzLm9wdGlvbnMuc3RhcnRTdGFnZSwgaXNQcmFjdGljZTogdHJ1ZX0pKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb3VudCA9PSAyKXtcbiAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG4iLCIvKlxuICogIFNjZW5lRmxvdy5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG4vL+ODoeOCpOODs+OCt+ODvOODs+ODleODreODvFxucGhpbmEuZGVmaW5lKFwicWZ0LlNjZW5lRmxvd1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5nYW1lLk1hbmFnZXJTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgc3RhcnRMYWJlbCA9IG9wdGlvbnMuc3RhcnRMYWJlbCB8fCBcInNwbGFzaFwiO1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7XG4gICAgICAgICAgICBzdGFydExhYmVsOiBzdGFydExhYmVsLFxuICAgICAgICAgICAgc2NlbmVzOiBbe1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcInNwbGFzaFwiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuU3BsYXNoU2NlbmVcIixcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcIm9wZW5pbmdcIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0Lk9wZW5pbmdTY2VuZVwiLFxuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwidGl0bGVcIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0LlRpdGxlU2NlbmVcIixcbiAgICAgICAgICAgICAgICBuZXh0TGFiZWw6IFwib3BlbmluZ1wiLFxuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwibWFpblwiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuTWFpblNjZW5lXCIsXG4gICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0U3RhZ2U6IDEsXG4gICAgICAgICAgICAgICAgICAgIGlzUHJhY3RpY2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbmV4dExhYmVsOiBcInRpdGxlXCIsXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJjb250aW51ZVwiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuU2NlbmVGbG93LlJlc3VtZVwiLFxuICAgICAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICAgICAgICBpc1ByYWN0aWNlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgaXNDb250aW51ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG5leHRMYWJlbDogXCJ0aXRsZVwiLFxuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwiZW5kaW5nXCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5FbmRpbmdTY2VuZVwiLFxuICAgICAgICAgICAgICAgIG5leHRMYWJlbDogXCJtYWluXCIsXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJjb25maWdcIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0LkNvbmZpZ1NjZW5lXCIsXG4gICAgICAgICAgICAgICAgbmV4dExhYmVsOiBcInRpdGxlXCIsXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJwcmFjdGljZVwiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuQ29uZmlnU2NlbmVfUHJhY3RpY2VcIixcbiAgICAgICAgICAgICAgICBuZXh0TGFiZWw6IFwiY29uZmlnXCIsXG4gICAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cbi8v5b6p5biw55SoXG5waGluYS5kZWZpbmUoXCJxZnQuU2NlbmVGbG93LlJlc3VtZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5nYW1lLk1hbmFnZXJTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtzdGFnZU51bWJlcjogMiwgaXNQcmFjdGljZTogZmFsc2UsIGlzQ29udGludWU6IGZhbHNlfSk7XG4gICAgICAgIGlmIChvcHRpb25zLmlzQ29udGludWUpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJzdGFnZVwiKTtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSBKU09OLnBhcnNlKGRhdGEpLiRzYWZlKHtcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VOdW1iZXI6IDEsXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdDogW10sXG4gICAgICAgICAgICAgICAgICAgIHBsYXllclN0YXR1czoge30sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5zdGFnZU51bWJlciA9IGQuc3RhZ2VOdW1iZXI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuc3RhZ2VOdW1iZXIgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBzdGFydExhYmVsID0gXCJzdGFydFwiO1xuICAgICAgICB2YXIgYXNzZXRzID0gcWZ0LkFzc2V0cy5nZXQoe2Fzc2V0VHlwZTogXCJzdGFnZVwiK29wdGlvbnMuc3RhZ2VOdW1iZXJ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe1xuICAgICAgICAgICAgc3RhcnRMYWJlbDogc3RhcnRMYWJlbCxcbiAgICAgICAgICAgIHNjZW5lczogW3tcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJzdGFydFwiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuTG9hZGluZ1NjZW5lXCIsXG4gICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0czogYXNzZXRzLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbmV4dExhYmVsOiBcIm1haW5cIixcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcIm1haW5cIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0Lk1haW5TY2VuZVwiLFxuICAgICAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICAgICAgICBzdGFydFN0YWdlOiBvcHRpb25zLnN0YWdlTnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICBpc1ByYWN0aWNlOiBvcHRpb25zLmlzUHJhY3RpY2UsXG4gICAgICAgICAgICAgICAgICAgIGlzQ29udGludWU6IG9wdGlvbnMuaXNDb250aW51ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfV0sXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgb25maW5pc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICB9XG59KTtcbiIsIi8qXG4gKiAgc3BsYXNoc2NlbmUuanNcbiAqICAyMDE3LzAyLzA4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxucGhpbmEuZGVmaW5lKCdxZnQuU3BsYXNoU2NlbmUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lJyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuXG4gICAgICAgIHRoaXMudW5sb2NrID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9hZGNvbXBsZXRlMSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxvYWRjb21wbGV0ZTIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wcm9ncmVzczEgPSAwO1xuICAgICAgICB0aGlzLnByb2dyZXNzMiA9IDA7XG5cbiAgICAgICAgLy9wcmVsb2FkIGFzc2V0XG4gICAgICAgIHZhciBhc3NldHMgPSBxZnQuQXNzZXRzLmdldCh7YXNzZXRUeXBlOiBcInNwbGFzaFwifSk7XG4gICAgICAgIHRoaXMubG9hZGVyID0gcGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIoKTtcbiAgICAgICAgdGhpcy5sb2FkZXIubG9hZChhc3NldHMpO1xuICAgICAgICB0aGlzLmxvYWRlci5vbignbG9hZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGNvbXBsZXRlMSA9IHRydWU7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMubG9hZGVyLm9uKCdwcm9ncmVzcycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MxID0gTWF0aC5mbG9vcihlLnByb2dyZXNzKjEwMCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgLy9wcmVsb2FkIGFzc2V0MlxuICAgICAgICB2YXIgYXNzZXRzID0gcWZ0LkFzc2V0cy5nZXQoe2Fzc2V0VHlwZTogXCJzcGxhc2gyXCJ9KTtcbiAgICAgICAgdGhpcy5sb2FkZXIyID0gcGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIoKTtcbiAgICAgICAgdGhpcy5sb2FkZXIyLmxvYWQoYXNzZXRzKTtcbiAgICAgICAgdGhpcy5sb2FkZXIyLm9uKCdsb2FkJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkY29tcGxldGUyID0gdHJ1ZTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5sb2FkZXIyLm9uKCdwcm9ncmVzcycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MyID0gTWF0aC5mbG9vcihlLnByb2dyZXNzKjEwMCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgLy9sb2dvXG4gICAgICAgIHZhciB0ZXh0dXJlID0gcGhpbmEuYXNzZXQuVGV4dHVyZSgpO1xuICAgICAgICB0ZXh0dXJlLmxvYWQocWZ0LlNwbGFzaFNjZW5lLmxvZ28pLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLl9pbml0KCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMudGV4dHVyZSA9IHRleHR1cmU7XG4gICAgfSxcblxuICAgIF9pbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZSh0aGlzLnRleHR1cmUpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMuZ3JpZFguY2VudGVyKCksIHRoaXMuZ3JpZFkuY2VudGVyKCkpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMC4zKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuYWxwaGEgPSAwO1xuXG4gICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnRvKHthbHBoYToxfSwgNTAwLCAnZWFzZU91dEN1YmljJylcbiAgICAgICAgICAgIC53YWl0KDUwMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMudW5sb2NrID0gdHJ1ZTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgLy/pgLLmjZfjgrLjg7zjgrhcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICB3aWR0aDogIFNDX1cqMC4xLFxuICAgICAgICAgICAgaGVpZ2h0OiAzLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgZmlsbDogJ3JlZCcsXG4gICAgICAgICAgICBzdHJva2U6ICd3aGl0ZScsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcbiAgICAgICAgICAgIGdhdWdlQ29sb3I6ICdsaW1lJyxcbiAgICAgICAgICAgIGNvcm5lclJhZGl1czogMyxcbiAgICAgICAgICAgIHZhbHVlOiAwLFxuICAgICAgICAgICAgbWF4VmFsdWU6IDEwMCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5wcm9ncmVzc0dhdWdlID0gcGhpbmEudWkuR2F1Z2Uob3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjgpO1xuICAgICAgICB0aGlzLnByb2dyZXNzR2F1Z2UuYmVmb3JlVmFsdWUgPSAwO1xuICAgICAgICB0aGlzLnByb2dyZXNzR2F1Z2UudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhhdC5wcm9ncmVzczEgPT0gdGhpcy5iZWZvcmVWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUrKztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoYXQucHJvZ3Jlc3MxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5iZWZvcmVWYWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnVubG9jayAmJiB0aGlzLmxvYWRjb21wbGV0ZTEgJiYgdGhpcy5sb2FkY29tcGxldGUyKSB7XG4gICAgICAgICAgICB0aGlzLnVubG9jayA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLnRvKHthbHBoYTowfSwgNTAwLCAnZWFzZU91dEN1YmljJylcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLnByb2dyZXNzR2F1Z2UudHdlZW5lci5jbGVhcigpLnRvKHthbHBoYTowfSwgMTAsICdlYXNlT3V0Q3ViaWMnKVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9zdGF0aWM6IHtcbiAgICAgICAgbG9nbzogXCJhc3NldHMvaW1hZ2UvcGhpbmFqc19sb2dvLnBuZ1wiLFxuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgdGl0bGVzY2VuZS5qc1xuICogIDIwMTcvMDIvMDlcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuVGl0bGVTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogJ2JsYWNrJyxcbiAgICAgICAgICAgIHN0cm9rZTogZmFsc2UsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG5cbiAgICAgICAgdmFyIHNwcml0ZTEgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInRpdGxlYmFja1wiKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cgKiAwLjUsIFNDX0ggKiAwLjUpO1xuICAgICAgICBzcHJpdGUxLmFscGhhID0gMDtcbiAgICAgICAgc3ByaXRlMS50d2VlbmVyLmNsZWFyKCkuZmFkZUluKDUwMCk7XG5cbiAgICAgICAgLy/jgr/jgqTjg4jjg6vjg63jgrTjga7ooajnpLpcbiAgICAgICAgdGhpcy5kaXNwVGl0bGVMb2dvKCk7XG5cbiAgICAgICAgLy/jg6Hjg4vjg6Xjg7zjgqLjgqTjg4bjg6DooajnpLpcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDUsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwidGl0bGVmb250MlwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAzMCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tZW51ID0gW1wiU3RhcnRcIiwgXCJDb250aW51ZVwiLCBcIkNvbmZpZ1wiXTtcbiAgICAgICAgdGhpcy5tZW51Q29tbWVudCA9IFtcIuOCsuODvOODoOOCkumWi+Wni+OBl+OBvuOBmVwiLCBcIuWJjeWbnuOCsuODvOODoOOCquODvOODkOODvOOBq+OBquOBo+OBn+OCueODhuODvOOCuOOBruacgOWIneOBi+OCiemWi+Wni+OBl+OBvuOBmVwiLCBcIuioreWumuODoeODi+ODpeODvOOCkumWi+OBjeOBvuOBmVwiXTtcbiAgICAgICAgdGhpcy5tZW51VGV4dCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWVudS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFtpXSA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IHRoaXMubWVudVtpXX0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC42K2kqMzApXG4gICAgICAgICAgICAgICAgLnNldFNjYWxlKDAuNyk7XG5cbiAgICAgICAgICAgIC8v44K/44OD44OB5Yik5a6a55SoXG4gICAgICAgICAgICB2YXIgcGFyYW0yID0ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiBTQ19XKjAuMyxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IFNDX0gqMC4wOCxcbiAgICAgICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0yKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNitpKjMwKVxuICAgICAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgICAgIGMuYWxwaGEgPSAwO1xuICAgICAgICAgICAgYy5zZWxlY3QgPSBpO1xuICAgICAgICAgICAgYy5vbnBvaW50c3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5pc1NlbGVjdGVkIHx8IHRoYXQudGltZSA8IDEwKSByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ID09IHRoYXQuc2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQub2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubWVudVRleHRbdGhhdC5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2VsZWN0ID0gdGhpcy5zZWxlY3Q7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubWVudVRleHRbdGhhdC5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbGVjdCA9IDA7XG4gICAgICAgIHRoaXMuc2VsZWN0TWF4ID0gMztcbiAgICAgICAgdGhpcy5tZW51VGV4dFswXS5zZXRTY2FsZSgxKTtcbiAgICAgICAgdGhpcy5vayA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNhbnNlbCA9IGZhbHNlO1xuXG4gICAgICAgIC8v44Oh44OL44Ol44O844Kz44Oh44Oz44OIXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5jb21tZW50ID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJcIiwgZm9udFNpemU6IDEwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC45KTtcbiAgICAgICAgdGhpcy5jb21tZW50LnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGhhdC5tZW51Q29tbWVudFt0aGF0LnNlbGVjdF07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5mZy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuY2xlYXIoKS5mYWRlT3V0KDE1KTtcblxuICAgICAgICB0aGlzLm9uKCdyZXN1bWUnLCBlID0+IHtcbiAgICAgICAgICAgIHRoaXMuZmcudHdlZW5lci5jbGVhcigpLmZhZGVPdXQoMTUpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5vayA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5jYW5zZWwgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgaWYgKHRoaXMuaXNTZWxlY3RlZCkgcmV0dXJuO1xuXG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAoY3QuZG93biAmJiAhY3QuYmVmb3JlLmRvd24gJiYgdGhpcy5zZWxlY3QgPCB0aGlzLnNlbGVjdE1heC0xKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3QrKztcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAxMDtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN0LnVwICYmICFjdC5iZWZvcmUudXAgJiYgdGhpcy5zZWxlY3QgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3QtLTtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAxMDtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDE1KSB7XG4gICAgICAgICAgICBpZiAoY3Qub2sgfHwgdGhpcy5vayl7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy/pgJrluLjplovlp4tcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJva1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmcudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZhZGVJbigzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4aXQoXCJtYWluXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy/jgrPjg7Pjg4bjgqPjg4vjg6Xjg7xcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJva1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmcudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZhZGVJbigzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic3RhZ2VcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IEpTT04ucGFyc2UoZGF0YSkuJHNhZmUoe3N0YWdlTnVtYmVyOiAxfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5zdGFnZU51bWJlciA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5leGl0KFwibWFpblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuU2NlbmVGbG93LlJlc3VtZSh7aXNQcmFjdGljZTogZmFsc2UsIGlzQ29udGludWU6IHRydWV9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4aXQoXCJtYWluXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICAvL+ioreWumuODoeODi+ODpeODvFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuQ29uZmlnU2NlbmUodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN0LmNhbmNlbCB8fCB0aGlzLmNhbmNlbCkge1xuICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LkNvbmZpZ1NjZW5lKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDMwICogMTIwKSB7XG4gICAgICAgICAgICB0aGlzLmV4aXQoXCJvcGVuaW5nXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG5cbiAgICAvL+OCv+OCpOODiOODq+ODreOCtOihqOekulxuICAgIGRpc3BUaXRsZUxvZ286IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgICAgeCA9IHggfHwgU0NfVyAqIDAuNTtcbiAgICAgICAgeSA9IHkgfHwgU0NfSCAqIDAuNDU7XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxMCxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJ0aXRsZWZvbnQxXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDYwLFxuICAgICAgICB9O1xuICAgICAgICB2YXIgbnVtID0gMDtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlRoZVwiLCBmb250U2l6ZTogMzB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oeC0xODIsIHktODUpO1xuICAgICAgICB0aGlzLnRleHRMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiUXVlc3RcIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbih4LTQ3LCB5LTg1KTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcImZvclwiLCBmb250U2l6ZTogNDB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oeC0xNywgeS00MCk7XG4gICAgICAgIHRoaXMudGV4dExhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJUYW5lbG9yblwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKHgrNDgsIHkpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgdHV0b3JpYWxzY2VuZS5qc1xuICogIDIwMTcvMDYvMDFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG4gXG5waGluYS5kZWZpbmUoXCJxZnQuVHV0b3JpYWxTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgLy/jgrnjgq/jg6rjg7zjg7Pjga7jg57jg4Pjg5flpJbjgbjjga7np7vli5XliLbpmZDjg5Xjg6njgrBcbiAgICBsaW1pdFdpZHRoOiBmYWxzZSxcbiAgICBsaW1pdEhlaWdodDogdHJ1ZSxcblxuICAgIC8v44OX44Os44Kk44Ok44O844K544Kv44Oq44O844Oz5Lit5aSu5Zu65a6a44OV44Op44KwXG4gICAgY2VudGVyUGxheWVyOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6ICdibGFjaycsXG4gICAgICAgICAgICBzdHJva2U6IGZhbHNlLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuXG4gICAgICAgIC8v6IOM5pmvXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJiYWNrZ3JvdW5kXCIpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oMCwgU0NfSCowLjUpLnNldE9yaWdpbigwLCAwLjUpO1xuXG4gICAgICAgIC8v566h55CG55So5Z+65rqW44Os44Kk44OkXG4gICAgICAgIHRoaXMuYmFzZUxheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcyk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgq3jg6Pjg6njgq/jgr9cbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBxZnQuUGxheWVyKHRoaXMpO1xuXG4gICAgICAgLy/jgrnjgq/jg6rjg7zjg7PliJ3mnJ/ljJZcbiAgICAgICAgdGhpcy5zZXR1cFNjcmVlbigpO1xuXG4gICAgICAgIC8v44K544OG44O844K45oOF5aCx5Yid5pyf5YyWXG4gICAgICAgIHRoaXMuc2V0dXBTdGFnZSgpO1xuXG4gICAgICAgIHRoaXMuZmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKS5mYWRlT3V0KDMwKTtcblxuICAgICAgICAvL+ODkOODvOODgeODo+ODq+ODkeODg+ODieOBruWPr+imluWMllxuLy8gICAgICAgIGFwcC52aXJ0dWFsUGFkLmFkZENoaWxkVG8odGhpcyk7XG5cbiAgICAgICAgYXBwLnZvbHVtZUJHTSA9IDAuNTtcbiAgICAgICAgYXBwLnZvbHVtZVNFID0gMC4yO1xuXG4gICAgICAgIC8v44Oh44OD44K744O844K46KGo56S6XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAxNixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5tZXNzYWdlU3RhY2sgPSBbXTtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZS50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlLm5leHRPayA9IHRydWU7XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMubmV4dE9rICYmIHRoYXQubWVzc2FnZVN0YWNrLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5leHRPayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBtc2cgPSB0aGF0Lm1lc3NhZ2VTdGFja1swXTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0ID0gbXNnLnRleHQ7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVJbigxNSkud2FpdCg5MCkuZmFkZU91dCgxNSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQubWVzc2FnZVN0YWNrLnNwbGljZSgwLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgaWYgKHRoaXMudGltZSA9PSAxNSkgdGhpcy5wbGF5ZXIuaXNDb250cm9sID0gdHJ1ZTtcblxuICAgICAgICAvL+OCueOCr+ODquODvOODs+ihqOekuuS9jee9ruOCkuODl+ODrOOCpOODpOODvOS4reW/g+OBq+OBquOCi+anmOOBq+iqv+aVtFxuICAgICAgICBpZiAodGhpcy5jZW50ZXJQbGF5ZXIpIHtcbiAgICAgICAgICAgIHZhciBtYXAgPSB0aGlzLm1hcExheWVyLm1hcDtcbiAgICAgICAgICAgIHRoaXMubWFwTGF5ZXIueCA9IFNDX1cqMC41LXRoaXMucGxheWVyLng7XG4gICAgICAgICAgICB0aGlzLm1hcExheWVyLnkgPSBTQ19IKjAuNS10aGlzLnBsYXllci55O1xuICAgICAgICAgICAgaWYgKHRoaXMubGltaXRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXBMYXllci55ID4gMCkgdGhpcy5tYXBMYXllci55ID0gMDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXBMYXllci55IDwgLShtYXAuaGVpZ2h0LVNDX0gpKSB0aGlzLm1hcExheWVyLnkgPSAtKG1hcC5oZWlnaHQtU0NfSCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5saW1pdFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIueCA+IDApIHRoaXMubWFwTGF5ZXIueCA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIueCA8IC0obWFwLndpZHRoLVNDX1cpKSB0aGlzLm1hcExheWVyLnggPSAtKG1hcC53aWR0aC1TQ19XKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jgrnjgq/jg6rjg7zjg7PluqfmqJlcbiAgICAgICAgICAgIHRoaXMuc2NyZWVuWCA9IC10aGlzLm1hcExheWVyLng7XG4gICAgICAgICAgICB0aGlzLnNjcmVlblkgPSAtdGhpcy5tYXBMYXllci55O1xuXG4gICAgICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODieOBrljluqfmqJnjgpLlhajkvZPjga7libLlkIjjgYvjgonoqIjnrpdcbiAgICAgICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLnggPSAtTWF0aC5mbG9vcih0aGlzLmJhY2tncm91bmRJbWFnZS53aWR0aCAqICh0aGlzLnBsYXllci54IC8gbWFwLndpZHRoKSowLjAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG5cbiAgICAvL+aVteOCreODo+ODqeOCr+OCv+aKleWFpVxuICAgIHNwYXduRW5lbXk6IGZ1bmN0aW9uKHgsIHksIG5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHFmdC5FbmVteVtuYW1lXSh0aGlzLCBvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMuZW5lbXlMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgfSxcblxuICAgIC8v44Ki44Kk44OG44Og5oqV5YWlXG4gICAgc3Bhd25JdGVtOiBmdW5jdGlvbih4LCB5LCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBxZnQuSXRlbSh0aGlzLCBvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgIH0sXG5cbiAgICAvL+OCouOCpOODhuODoOODnOODg+OCr+OCueaKleWFpVxuICAgIHNwYXduSXRlbUJveDogZnVuY3Rpb24oeCwgeSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gcWZ0Lkl0ZW1Cb3godGhpcywgb3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICB9LFxuXG4gICAgLy/jgqjjg5Xjgqfjgq/jg4jmipXlhaVcbiAgICBzcGF3bkVmZmVjdDogZnVuY3Rpb24oeCwgeSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gcWZ0LkVmZmVjdCh0aGlzLCBvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgIH0sXG5cbiAgICAvL+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgIHNwYXduTWVzc2FnZTogZnVuY3Rpb24odGV4dCwgYmV0d2Vlbiwgd2FpdEZyYW1lKSB7XG4gICAgICAgIGJldHdlZW4gPSBiZXR3ZWVuIHx8IDMyO1xuICAgICAgICB3YWl0RnJhbWUgPSB3YWl0RnJhbWUgfHwgMzA7XG4gICAgICAgIHZhciBhcnJheVRleHQgPSB0ZXh0LnNwbGl0KFwiXCIpO1xuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibHVlXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAzMixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHZhciBuID0gMDtcbiAgICAgICAgdmFyIHggPSBTQ19XICogMC41IC0gKGFycmF5VGV4dC5sZW5ndGggKiBiZXR3ZWVuICogMC41KTtcbiAgICAgICAgYXJyYXlUZXh0LmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUgPT0gXCIgXCIpIHtcbiAgICAgICAgICAgICAgICB4ICs9IGJldHdlZW47XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGxiID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogZX0uJHNhZmUobGFiZWxQYXJhbSkpLnNldFBvc2l0aW9uKHgsIFNDX0gqMC41KzMyKS5zZXRTY2FsZSgwLCAxKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICAgICAgbGIudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgICAgIC53YWl0KG4pXG4gICAgICAgICAgICAgICAgLnRvKHtzY2FsZVg6IDEuMCwgYWxwaGE6IDEsIHk6IFNDX0gqMC41fSwgMTUsIFwiZWFzZU91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAud2FpdCh3YWl0RnJhbWUpXG4gICAgICAgICAgICAgICAgLnRvKHtzY2FsZVg6IDAuMCwgeTogU0NfSCowLjUtMzJ9LCAxMCwgXCJlYXNlT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7dGhpcy5yZW1vdmUoKX0uYmluZChsYikpO1xuICAgICAgICAgICAgeCArPSBiZXR3ZWVuO1xuICAgICAgICAgICAgbiArPSA1O1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvL+OCpOODmeODs+ODiOODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgIHNwYXduRXZlbnRNZXNzYWdlOiBmdW5jdGlvbihpZCwgdGV4dCkge1xuICAgICAgICBpZiAoIWlkIHx8ICF0ZXh0KSByZXR1cm47XG4gICAgICAgIC8v44Oh44OD44K744O844K444K544K/44OD44Kv5YaF44Gr5ZCM5LiA77yp77yk44GM44GC44KL5aC05ZCI44Gv5oqV5YWl44GX44Gq44GEXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tZXNzYWdlU3RhY2subGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1lc3NhZ2VTdGFja1tpXS5pZCA9PSBpZCkgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0ZXh0IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgIHRleHQuZm9yRWFjaChmdW5jdGlvbihzdHIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VTdGFjay5wdXNoKHtpZDogaWQsIHRleHQ6IHN0cn0pO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZVN0YWNrLnB1c2goe2lkOiBpZCwgdGV4dDogdGV4dH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44K544Kv44Oq44O844Oz5Yid5pyf5YyWXG4gICAgc2V0dXBTY3JlZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJVYnVudHVNb25vXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJsZWZ0XCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAyMCxcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG5cbiAgICAgICAgLy/kvZPlipvjgrLjg7zjgrhcbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJMSUZFXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKDAsIDEwKTtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICB3aWR0aDogIDI1NixcbiAgICAgICAgICAgIGhlaWdodDogNSxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIGZpbGw6ICdyZWQnLFxuICAgICAgICAgICAgc3Ryb2tlOiAnd2hpdGUnLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgICAgICBnYXVnZUNvbG9yOiAnbGltZScsXG4gICAgICAgICAgICBjb3JuZXJSYWRpdXM6IDAsXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5wbGF5ZXIuaHAsXG4gICAgICAgICAgICBtYXhWYWx1ZTogdGhpcy5wbGF5ZXIuaHAsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubGlmZUdhdWdlID0gcGhpbmEudWkuR2F1Z2Uob3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzKS5zZXRPcmlnaW4oMCwgMC41KS5zZXRQb3NpdGlvbig0MCwgMTApO1xuICAgICAgICB0aGlzLmxpZmVHYXVnZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGF0LnBsYXllci5ocDtcbiAgICAgICAgfTtcblxuICAgICAgICAvL+OCueOCs+OCouihqOekulxuICAgICAgICB0aGlzLnNjb3JlTGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OlwiU0NPUkU6XCIsIGFsaWduOiBcInJpZ2h0XCJ9LiRzYWZlKGxhYmVsUGFyYW0pKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1csIDEwKTtcbiAgICAgICAgdGhpcy5zY29yZUxhYmVsLnNjb3JlID0gMDtcbiAgICAgICAgdGhpcy5zY29yZUxhYmVsLnMgPSAwO1xuICAgICAgICB0aGlzLnNjb3JlTGFiZWwudXBkYXRlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUudGlja2VyLmZyYW1lICUgMTAgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMucyA9IH5+KCh0aGF0LnRvdGFsU2NvcmUtdGhpcy5zY29yZSkvNyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucyA8IDMpIHRoaXMucyA9IDM7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucyA+IDc3NzcpIHRoaXMucyA9IDc3Nzc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNjb3JlICs9IHRoaXMucztcbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3JlID4gdGhhdC50b3RhbFNjb3JlKSB0aGlzLnNjb3JlID0gdGhhdC50b3RhbFNjb3JlO1xuXG4gICAgICAgICAgICB0aGlzLnRleHQgPSBcIlNDT1JFIFwiK3RoaXMuc2NvcmUuY29tbWEoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5Yi26ZmQ5pmC6ZaT6KGo56S6XG4gICAgICAgIHZhciB0bCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiVElNRTpcIiwgYWxpZ246IFwicmlnaHRcIn0uJHNhZmUobGFiZWxQYXJhbSkpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVywgMzApO1xuICAgICAgICB0bC51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiVElNRTpcIitNYXRoLmZsb29yKHRoYXQudGltZUxpbWl0LzMwKTtcbiAgICAgICAgICAgIGlmICh0aGF0LnRpbWVMaW1pdCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxsID0gJ3JlZCc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsbCA9ICd3aGl0ZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOijheWCmeatpuWZqOihqOekulxuICAgICAgICB0aGlzLnBsYXllcldlYXBvbiA9IHFmdC5QbGF5ZXJXZWFwb24odGhpcy5wbGF5ZXIpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVy0zMCwgU0NfSC0zMCk7XG4gICAgfSxcblxuICAgIC8v44Oe44OD44OX5oOF5aCx44Gu5Yid5pyf5YyWXG4gICAgc2V0dXBTdGFnZTogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdGhpcy5iYXNlTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcblxuICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTk5OSh0aGlzKTtcbiAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuXG4gICAgICAgIC8v57WM6YGO5pmC6ZaT5Yid5pyf5YyWXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4joqK3lrppcbiAgICAgICAgdGhpcy50aW1lTGltaXQgPSB0aGlzLnN0YWdlQ29udHJvbGxlci50aW1lTGltaXQ7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zoqK3lrppcbiAgICAgICAgdGhpcy5wbGF5ZXIuaXNDb250cm9sID0gZmFsc2U7XG4gICAgICAgIHRoaXMucGxheWVyLmlzTXV0ZWtpID0gZmFsc2U7XG4gICAgICAgIHRoaXMucGxheWVyLmFscGhhID0gMS4wO1xuXG4gICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyLnBsYXlCR00oKTtcbiAgICB9LFxuXG4gICAgLy/jg57jg4Pjg5fjg6zjgqTjg6Tjga7liIfmm79cbiAgICBzd2l0Y2hNYXA6IGZ1bmN0aW9uKGxheWVyLCB4LCB5KSB7XG4gICAgICAgIGlmICh0aGlzLm1hcExheWVyKSB0aGlzLm1hcExheWVyLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLm1hcExheWVyID0gbGF5ZXI7XG4gICAgICAgIHRoaXMubWFwTGF5ZXIuYWRkQ2hpbGRUbyh0aGlzLmJhc2VMYXllcik7XG4gICAgICAgIHRoaXMubWFwID0gbGF5ZXIubWFwO1xuXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZExheWVyID0gbGF5ZXIuYmFja2dyb3VuZExheWVyO1xuICAgICAgICB0aGlzLmZvcmVncm91bmRMYXllciA9IGxheWVyLmZvcmVncm91bmRMYXllcjtcbiAgICAgICAgdGhpcy5jb2xsaXNpb25MYXllciA9IGxheWVyLmNvbGxpc2lvbkxheWVyO1xuICAgICAgICB0aGlzLmVuZW15TGF5ZXIgPSBsYXllci5lbmVteUxheWVyO1xuICAgICAgICB0aGlzLnBsYXllckxheWVyID0gbGF5ZXIucGxheWVyTGF5ZXI7XG4gICAgICAgIHRoaXMub2JqTGF5ZXIgPSBsYXllci5vYmpMYXllcjtcbiAgICAgICAgdGhpcy5tYXBJbWFnZUxheWVyID0gbGF5ZXIubWFwSW1hZ2VMYXllcjtcbiAgICAgICAgdGhpcy5lZmZlY3RMYXllciA9IGxheWVyLmVmZmVjdExheWVyO1xuXG4gICAgICAgIHRoaXMucGxheWVyLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLnBsYXllci5hZGRDaGlsZFRvKGxheWVyLnBsYXllckxheWVyKTtcbiAgICAgICAgaWYgKHgpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTEuanNcbiAqICAyMDE3LzAxLzI0XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuO+8kVxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlMVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiAxLFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo1LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtMVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlMVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDFcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IHRoaXMucGxheWVyLmtleXM7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA8IDEpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKS5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KS5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkubW92ZUJ5KDE0LCAtMzIsIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuYW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2UxMC5qc1xuICogIDIwMTcvMDkvMTBcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Ko44Oz44OH44Kj44Oz44Kw44K344O844OzXG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2UxMFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiAxMCxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNSxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImVuZGluZ1wiLFxuXG4gICAgLy/nibnmrorjgrnjg4bjg7zjgrjjg5Xjg6njgrBcbiAgICBpc0VuZGluZzogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2UxMFwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjg4Djg5/jg7zjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKVxuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/plovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25FdmVudE1lc3NhZ2UoMSwgXCJDb25ncmF0dXJhdGlvbnMhIVwiKTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcblxuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuc3BlZWQgPSAyO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuc3BlZWRBc2NlbmQgPSAyO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuaXNBdXRvID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkudXAgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCgyMjQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS51cCA9IGZhbHNlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnJpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/nn7PnopHjgb7jgadcbiAgICAgICAgdGhpcy5hZGQoMjU1LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkucmlnaHQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnNldEFscGhhKDApO1xuICAgICAgICAgICAgcGwuYWRkQ2hpbGRUbyh0aGlzLm1hcExheWVyLnBsYXllckxheWVyKTtcbiAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpO1xuICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBfc3RvcFwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWRkKDEyMCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnJpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnNldEFscGhhKDEuMCk7XG4gICAgICAgICAgICBwbC5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/lhaXjgorlj6Pjgb7jgadcbiAgICAgICAgdGhpcy5hZGQoMzMwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkucmlnaHQgPeOAgGZhbHNlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnJpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWRkKDMwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkucmlnaHQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWRkKDMwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkucmlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hZGQoMjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS5yaWdodCA9IGZhbHNlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKCkuc2V0KHthbHBoYTogMH0pLm1vdmVCeSgwLCAtNjAwLCA2MDApO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZ3Jhdml0eSA9IDA7XG5cbiAgICAgICAgICAgIHBsLmFkZENoaWxkVG8odGhpcy5tYXBMYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KTtcbiAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgcGwudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKS5jbGVhcigpXG4gICAgICAgICAgICAgICAgLm1vdmVCeSgwLCAtNjAwLCA2MDApXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJkb3duXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLndhaXQoMTApXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmdXaGl0ZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YWl0KDEyMClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mYWRlSW4oMTIwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoXCJlbmRpbmdcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mZy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YWl0KDE1MClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mYWRlSW4oNjApO1xuXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAubW92ZUJ5KDAsIC02MDAsIDYwMCk7XG4gICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5zdGFnZUNvbnRyb2xsZXIuZmluZE9iamVjdCgxNywgMCwgXCJlbmVteVwiKTtcbiAgICAgICAgICAgIG9iai5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuc3RhZ2VDb250cm9sbGVyLmZpbmRPYmplY3QoMTcsIDAsIFwiZW5lbXlcIik7XG4gICAgICAgICAgICBvYmoudHdlZW5lci5jbGVhcigpLm1vdmVCeSgwLCAtMzAwLCAzMDApO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlMS5qc1xuICogIDIwMTcvMDEvMjRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K477yRXG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2UyXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDIsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjcsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ20yXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlMl8xXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDJcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gdGhpcy5wbGF5ZXIua2V5cztcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoIDwgMikgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlVG8oNDg3LCAyNzEsIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuYW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2UzLmpzXG4gKiAgMjAxNy8wMy8wMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrjvvJFcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTNcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogMyxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqMTAsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ20zXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlM18xXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2UzXzJcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMV0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTNfM1wiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclsyXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSAzXCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IHRoaXMucGxheWVyLmtleXM7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA8IDIpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKS5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KS5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkubW92ZVRvKDg2LCAyNzIsIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuYW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2U0LmpzXG4gKiAgMjAxNy8wMy8wOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrjvvJFcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogNCxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNyxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbTRcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U0XzFcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTRfMlwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclsxXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSA0XCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IHRoaXMucGxheWVyLmtleXM7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA8IDEpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKS5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KS5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkubW92ZVRvKDI5MDMsIDE3NiwgMTAwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTUuanNcbiAqICAyMDE3LzA1LzE0XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuO+8kVxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlNVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiA1LFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo4LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtNVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTVfMVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlNV8yXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzFdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDVcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+mNteWHuuePvlxuICAgICAgICB0aGlzLmFkZEV2ZW50KFwia2V5XCIsICgpID0+IHtcbiAgICAgICAgICAgIHZhciBreCA9IDExOTY7XG4gICAgICAgICAgICB2YXIga3kgPSA2ODg7XG4gICAgICAgICAgICB2YXIga2V5ID0gcWZ0Lkl0ZW0odGhpcy5wYXJlbnRTY2VuZSwge3Byb3BlcnRpZXM6IHtraW5kOiBcImtleVwifX0pXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5vYmpMYXllcilcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oa3gsIGt5KTtcbiAgICAgICAgICAgIGtleS52eSA9IC01O1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wYXVzZVNjZW5lID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2VudGVyUGxheWVyID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNhbWVyYS5zZXRQb3NpdGlvbih0aGlzLnBhcmVudFNjZW5lLnBsYXllci54LCB0aGlzLnBhcmVudFNjZW5lLnBsYXllci55KTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2FtZXJhLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiaG9seTFcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAubW92ZVRvKGt4LCBreSwgMzAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBhdXNlU2NlbmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlRnJvbS54ID0ga3g7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUZyb20ueSA9IGt5O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVSYWlvID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTGVycCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVRvUGxheWVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEpKVxuICAgICAgICAgICAgICAgIC50byh7bW92ZVJhdGlvOiAxfSwgMzAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNlbnRlclBsYXllciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUxlcnAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEpKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSB0aGlzLnBsYXllci5rZXlzO1xuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPCAxKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcikuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSkuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLm1vdmVUbygzNDkzKzE4LCA4MCs4MCwgMTAwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K477yi77yn77yt5YaN55SfXG4gICAgcGxheUJHTTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGFwcC5zZXRWb2x1bWUodGhpcy5iZ20sIDAuNSk7XG4gICAgICAgIGFwcC5wbGF5QkdNKHRoaXMuYmdtKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlNi5qc1xuICogIDIwMTcvMDUvMTRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K477yRXG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2U2XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDYsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjUsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ202XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlNl8xXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTZfMlwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclsxXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSA2XCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5ib3NzZGVhZDEgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5ib3NzZGVhZDIgPSBmYWxzZTtcblxuICAgICAgICAvL+ODnOOCue+8keiojuS8kFxuICAgICAgICB0aGlzLmFkZEV2ZW50KFwiYm9zc2RlYWRfMVwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmJvc3NkZWFkMSA9IHRydWU7XG4gICAgICAgICAgICBpZiAodGhpcy5ib3NzZGVhZDIpIHRoaXMuZmlyZUV2ZW50KFwia2V5XCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy/jg5zjgrnvvJLoqI7kvJBcbiAgICAgICAgdGhpcy5hZGRFdmVudChcImJvc3NkZWFkXzJcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5ib3NzZGVhZDIgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuYm9zc2RlYWQxKSB0aGlzLmZpcmVFdmVudChcImtleVwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/pjbXlh7rnj75cbiAgICAgICAgdGhpcy5hZGRFdmVudChcImtleVwiLCAoKSA9PiB7XG4gICAgICAgICAgICB2YXIga3ggPSAzODQ7XG4gICAgICAgICAgICB2YXIga3kgPSA5NDQ7XG4gICAgICAgICAgICB2YXIga2V5ID0gcWZ0Lkl0ZW0odGhpcy5wYXJlbnRTY2VuZSwge3Byb3BlcnRpZXM6IHtraW5kOiBcImtleVwifX0pXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5vYmpMYXllcilcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oa3gsIGt5KTtcbiAgICAgICAgICAgIGtleS52eSA9IC01O1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wYXVzZVNjZW5lID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2VudGVyUGxheWVyID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNhbWVyYS5zZXRQb3NpdGlvbih0aGlzLnBhcmVudFNjZW5lLnBsYXllci54LCB0aGlzLnBhcmVudFNjZW5lLnBsYXllci55KTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2FtZXJhLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiaG9seTFcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAubW92ZVRvKGt4LCBreSwgMzAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBhdXNlU2NlbmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlRnJvbS54ID0ga3g7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUZyb20ueSA9IGt5O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVSYWlvID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTGVycCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVRvUGxheWVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEpKVxuICAgICAgICAgICAgICAgIC50byh7bW92ZVJhdGlvOiAxfSwgMzAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNlbnRlclBsYXllciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUxlcnAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEpKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSB0aGlzLnBsYXllci5rZXlzO1xuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPCAzKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcikuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSkuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLm1vdmVUbygxMTkgKyAxOOOAgCwgNDQ4ICsgODAsIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuYW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2U3LmpzXG4gKiAgMjAxNy8wNy8yNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrg3XG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2U3XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDYsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjUsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ203XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlN18xXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTdfMlwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclsxXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U3XzNcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMl0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgN1wiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSB0aGlzLnBsYXllci5rZXlzO1xuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPCAxKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcikuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSkuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLm1vdmVUbygxODIgKyAxOCwgMjA4ICsgODAsIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuYW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2U4LmpzXG4gKiAgMjAxNy8wNy8yNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrg4XG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2U4XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDgsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjgsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ204XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlOF8xXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZThfMlwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclsxXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSA4XCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/pjbXlh7rnj75cbiAgICAgICAgdGhpcy5hZGRFdmVudChcImtleVwiLCAoKSA9PiB7XG4gICAgICAgICAgICB2YXIga3ggPSA2NzA7XG4gICAgICAgICAgICB2YXIga3kgPSA4NTM7XG4gICAgICAgICAgICB2YXIga2V5ID0gcWZ0Lkl0ZW0odGhpcy5wYXJlbnRTY2VuZSwge3Byb3BlcnRpZXM6IHtraW5kOiBcImtleVwifX0pXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5vYmpMYXllcilcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oa3gsIGt5KTtcbiAgICAgICAgICAgIGtleS52eSA9IC01O1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wYXVzZVNjZW5lID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2VudGVyUGxheWVyID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNhbWVyYS5zZXRQb3NpdGlvbih0aGlzLnBhcmVudFNjZW5lLnBsYXllci54LCB0aGlzLnBhcmVudFNjZW5lLnBsYXllci55KTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2FtZXJhLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiaG9seTFcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAubW92ZVRvKGt4LCBreSwgMzAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBhdXNlU2NlbmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlRnJvbS54ID0ga3g7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUZyb20ueSA9IGt5O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVSYWlvID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTGVycCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVRvUGxheWVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEpKVxuICAgICAgICAgICAgICAgIC50byh7bW92ZVJhdGlvOiAxfSwgMzAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNlbnRlclBsYXllciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUxlcnAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEpKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSB0aGlzLnBsYXllci5rZXlzO1xuLy8gICAgICAgIGlmIChrZXlzLmxlbmd0aCA8IDEpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKS5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KS5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICAgICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAubW92ZVRvKDc4NCsxNiwgMzA0LTE2LCA1MDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5tb3ZlVG8oNzg0KzE2LCAtMzIsIDUwMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuYW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2U5LmpzXG4gKiAgMjAxNy8wNy8yNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrg5XG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2U5XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDksXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjUsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ205XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlOV8xXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDlcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gdGhpcy5wbGF5ZXIua2V5cztcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoIDwgMSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlVG8oNDg3LCAyNzEsIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuYW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2U5OTkuanNcbiAqICAyMDE3LzA1LzAzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+ODhuOCueODiOOCueODhuODvOOCuFxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlOTk5XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDEsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U5OTlcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL++8ou+8p++8reWGjeeUn1xuICAgICAgICAgICAgYXBwLnBsYXlCR00oXCJiZ20xXCIpO1xuXG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSAxXCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2Vjb250cm9sbGVyLmpzXG4gKiAgMjAxNy8wMS8yNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrjliLblvqFcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZUNvbnRyb2xsZXJcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuYXBwLk9iamVjdDJEXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiAwLFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo1LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtMVwiLFxuXG4gICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICBsaW1pdFdpZHRoOiBmYWxzZSxcbiAgICBsaW1pdEhlaWdodDogdHJ1ZSxcblxuICAgIHBhcmVudFNjZW5lOiBudWxsLFxuICAgIG1hcExheWVyOiBudWxsLFxuICAgIHBsYXllcjogbnVsbCxcbiAgICB0aW1lOiAwLFxuXG4gICAgLy/ntYzpgY7mmYLplpPjg4jjg6rjgqzjgqTjg5njg7Pjg4hcbiAgICBzZXE6IG51bGwsXG4gICAgaW5kZXg6IDAsXG5cbiAgICAvL+ODnuODg+ODl+ODiOODquOCrOOCpOODmeODs+ODiFxuICAgIGV2ZW50OiBudWxsLFxuXG4gICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4noqK3lrppcbiAgICBpc0JhY2tncm91bmRNb3ZlOiB0cnVlLFxuICAgIGJhY2tncm91bmRYOiAtMzIwLFxuXG4gICAgLy/nibnmrorjgrnjg4bjg7zjgrjjg5Xjg6njgrBcbiAgICBpc09wZW5pbmc6IGZhbHNlLFxuICAgIGlzVHV0b3JpYWw6IGZhbHNlLFxuICAgIGlzRW5kaW5nOiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuICAgICAgICB0aGlzLm1hcExheWVyID0gW107XG4gICAgICAgIHRoaXMucGxheWVyID0gcGFyZW50U2NlbmUucGxheWVyO1xuXG4gICAgICAgIHRoaXMuc2VxID0gW107XG4gICAgICAgIHRoaXMuZXZlbnQgPSBbXTtcbiAgICB9LFxuXG4gICAgLy/mmYLplpPjgqTjg5njg7Pjg4jov73liqBcbiAgICBhZGQ6IGZ1bmN0aW9uKHRpbWUsIHZhbHVlLCBvcHRpb24pIHtcbiAgICAgICAgdGhpcy5pbmRleCArPSB0aW1lO1xuICAgICAgICB0aGlzLnNlcVt0aGlzLmluZGV4XSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgIG9wdGlvbjogb3B0aW9uLFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICAvL+aZgumWk+OCpOODmeODs+ODiOWPluW+l1xuICAgIGdldDogZnVuY3Rpb24odGltZSkge1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMuc2VxW3RpbWVdO1xuICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIC8v44Oe44OD44OX44Kk44OZ44Oz44OI6L+95YqgXG4gICAgYWRkRXZlbnQ6IGZ1bmN0aW9uKGlkLCB2YWx1ZSwgb3B0aW9uKSB7XG4gICAgICAgIHRoaXMuZXZlbnRbaWRdID0ge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgb3B0aW9uOiBvcHRpb24sXG4gICAgICAgICAgICBleGVjdXRlZDogZmFsc2UsXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8v44Oe44OD44OX44Kk44OZ44Oz44OI5Y+W5b6XXG4gICAgZ2V0RXZlbnQ6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIHZhciBkYXRhID0gdGhpcy5ldmVudFtpZF07XG4gICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9LFxuXG4gICAgLy/mrKHjgavjgqTjg5njg7Pjg4jjgYznmbrnlJ/jgZnjgovmmYLplpPjgpLlj5blvpdcbiAgICBnZXROZXh0RXZlbnRUaW1lOiBmdW5jdGlvbih0aW1lKSB7XG4gICAgICAgIHZhciBkYXRhID0gdGhpcy5zZXFbdGltZV07XG4gICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGltZSsxO1xuICAgICAgICAgICAgdmFyIHJ0ID0gLTE7XG4gICAgICAgICAgICB0aGlzLnNlcS5zb21lKGZ1bmN0aW9uKHZhbCwgaW5kZXgpe1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcnQgPSBpbmRleDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSx0aGlzLnNlcSk7XG4gICAgICAgICAgICByZXR1cm4gcnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGltZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+OCpOODmeODs+ODiOeZuueBq1xuICAgIGZpcmVFdmVudDogZnVuY3Rpb24oZXZlbnROYW1lKSB7XG4gICAgICAgIHZhciBldmVudCA9IHRoaXMuZXZlbnRbZXZlbnROYW1lXTtcbiAgICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC52YWx1ZS5jYWxsKCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zZXEgPSBbXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K477yi77yn77yt5YaN55SfXG4gICAgcGxheUJHTTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGFwcC5wbGF5QkdNKHRoaXMuYmdtKTtcbiAgICB9LFxuXG4gICAgLy9JROOBi+OCieOCquODluOCuOOCp+OCr+ODiOaknOe0olxuICAgIGZpbmRPYmplY3Q6IGZ1bmN0aW9uKGlkLCBsYXllck51bWJlciwgbGF5ZXJOYW1lKSB7XG4gICAgICAgIGxheWVyTnVtYmVyID0gbGF5ZXJOdW1iZXIgfHwgMDtcbiAgICAgICAgbGF5ZXJOYW1lID0gbGF5ZXJOYW1lIHx8IFwib2JqZWN0XCI7XG4gICAgICAgIHZhciByZXN1bHQgPSBudWxsO1xuICAgICAgICBzd2l0Y2ggKGxheWVyTmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcIm9iamVjdFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubWFwTGF5ZXJbbGF5ZXJOdW1iZXJdLm9iakxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5pZCA9PSBpZCkgcmVzdWx0ID0gZTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImVuZW15XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5tYXBMYXllcltsYXllck51bWJlcl0uZW5lbXlMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuaWQgPT0gaWQpIHJlc3VsdCA9IGU7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG5cbiAgICAvL3RteOOBi+OCieODnuODg+ODl+ODrOOCpOODpOOCkuS9nOaIkOOBmeOCi1xuICAgIGNyZWF0ZU1hcDogZnVuY3Rpb24odG14KSB7XG4gICAgICAgIC8v44Oe44OD44OX44Os44Kk44OkXG4gICAgICAgIHZhciBtYXBMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKTtcblxuICAgICAgICAvL+ODnuODg+ODl+eUu+WDj+eUqOODrOOCpOODpFxuICAgICAgICBtYXBMYXllci5tYXBJbWFnZUxheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8obWFwTGF5ZXIpO1xuXG4gICAgICAgIC8v5Zyw5b2i5Yik5a6a55So44Os44Kk44OkXG4gICAgICAgIG1hcExheWVyLmNvbGxpc2lvbkxheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8obWFwTGF5ZXIpO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJ44Os44Kk44OkXG4gICAgICAgIG1hcExheWVyLmJhY2tncm91bmRMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKG1hcExheWVyKTtcblxuICAgICAgICAvL+OCquODluOCuOOCp+OCr+ODiOeuoeeQhuODrOOCpOODpFxuICAgICAgICBtYXBMYXllci5vYmpMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKG1hcExheWVyKTtcblxuICAgICAgICAvL+W9seihqOekuuODrOOCpOODpFxuICAgICAgICBtYXBMYXllci5zaGFkb3dMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKG1hcExheWVyKTtcblxuICAgICAgICAvL+aVteOCreODo+ODqeOCr+OCv+euoeeQhuODrOOCpOODpFxuICAgICAgICBtYXBMYXllci5lbmVteUxheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8obWFwTGF5ZXIpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O86KGo56S644Os44Kk44OkXG4gICAgICAgIG1hcExheWVyLnBsYXllckxheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8obWFwTGF5ZXIpO1xuXG4gICAgICAgIC8v44Ko44OV44Kn44Kv44OI566h55CG44Os44Kk44OkXG4gICAgICAgIG1hcExheWVyLmVmZmVjdExheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8obWFwTGF5ZXIpO1xuXG4gICAgICAgIC8v44OV44Kp44Ki44Kw44Op44Km44Oz44OJ44Os44Kk44OkXG4gICAgICAgIG1hcExheWVyLmZvcmVncm91bmRMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKG1hcExheWVyKTtcblxuICAgICAgICAvL+ODnuODg+ODl+eUu+WDj+WPluW+l1xuICAgICAgICB2YXIgbWFwSW1hZ2UgPSB0bXguZ2V0SW1hZ2UoXCJtYXBcIiwgXCJiYWNrZ3JvdW5kXCIsIFwiYmFja2dyb3VuZDJcIiwgXCJiYWNrZ3JvdW5kM1wiKTtcbiAgICAgICAgbWFwTGF5ZXIubWFwID0gcGhpbmEuZGlzcGxheS5TcHJpdGUobWFwSW1hZ2UpLmFkZENoaWxkVG8obWFwTGF5ZXIubWFwSW1hZ2VMYXllcikuc2V0T3JpZ2luKDAsIDApO1xuXG4gICAgICAgIC8v44OV44Kp44Ki44Kw44Op44Km44Oz44OJ55S75YOPXG4gICAgICAgIHZhciBmb3JlZ3JvdW5kID0gdG14LmdldEltYWdlKFwiZm9yZWdyb3VuZFwiLCBcImZvcmVncm91bmQyXCIsIFwiZm9yZWdyb3VuZDNcIik7XG4gICAgICAgIHBoaW5hLmRpc3BsYXkuU3ByaXRlKGZvcmVncm91bmQpLmFkZENoaWxkVG8obWFwTGF5ZXIuZm9yZWdyb3VuZExheWVyKS5zZXRPcmlnaW4oMCwgMCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5flvZPjgZ/jgorliKTlrprlj5blvpdcbiAgICAgICAgdmFyIG9iamVjdHMgPSB0bXguZ2V0T2JqZWN0R3JvdXAoXCJjb2xsaXNpb25cIikub2JqZWN0cztcbiAgICAgICAgb2JqZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IGUud2lkdGggfHwgMTY7XG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gZS5oZWlnaHQgfHwgMTY7XG4gICAgICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHR9KVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKG1hcExheWVyLmNvbGxpc2lvbkxheWVyKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihlLngrd2lkdGgvMiwgZS55K2hlaWdodC8yKVxuICAgICAgICAgICAgICAgIC5zZXRWaXNpYmxlKERFQlVHX0NPTExJU0lPTik7XG4gICAgICAgICAgICBjLm9uKCdlbnRlcmZyYW1lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMudng7XG4gICAgICAgICAgICAgICAgdGhpcy55ICs9IHRoaXMudnk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGMuaWQgPSBlLmlkO1xuICAgICAgICAgICAgYy52eCA9IDA7XG4gICAgICAgICAgICBjLnZ5ID0gMDtcbiAgICAgICAgICAgIGMuYWxwaGEgPSAwLjM7XG4gICAgICAgICAgICBjLmlnbm9yZSA9IGZhbHNlO1xuICAgICAgICAgICAgYy5mcmljdGlvbiA9IGUucHJvcGVydGllcy5mcmljdGlvbiA9PSB1bmRlZmluZWQ/IDAuNTogZS5wcm9wZXJ0aWVzLmZyaWN0aW9uO1xuICAgICAgICAgICAgaWYgKGUubmFtZSkgYy5uYW1lID0gZS5uYW1lO1xuICAgICAgICAgICAgaWYgKGUudHlwZSkgYy50eXBlID0gZS50eXBlO1xuICAgICAgICAgICAgYy4kZXh0ZW5kKGUucHJvcGVydGllcyk7XG5cbiAgICAgICAgICAgIC8v5bi45pmC5a6f6KGM44K544Kv44Oq44OX44OIXG4gICAgICAgICAgICBpZiAoYy5zY3JpcHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2MgPSBcIihmdW5jdGlvbihhcHApIHtcIitjLnNjcmlwdCtcIn0pXCI7XG4gICAgICAgICAgICAgICAgdmFyIGYgPSBldmFsKHNjKTtcbiAgICAgICAgICAgICAgICBjLm9uKCdlbnRlcmZyYW1lJywgZik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+W9k+OBn+OCiuWIpOWumuaZguWun+ihjOOCueOCr+ODquODl+ODiFxuICAgICAgICAgICAgaWYgKGMuY29sbGlzaW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNjID0gXCIoZnVuY3Rpb24oZSwgZGlyKSB7XCIrYy5jb2xsaXNpb24rXCJ9KVwiO1xuICAgICAgICAgICAgICAgIGMuY29sbGlzaW9uU2NyaXB0ID0gZXZhbChzYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgLy/jgqTjg5njg7Pjg4jlj5blvpdcbiAgICAgICAgdmFyIGV2ZW50cyA9IHRteC5nZXRPYmplY3RHcm91cChcImV2ZW50XCIpLm9iamVjdHM7XG4gICAgICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciB4ID0gZS54ICsgKGUud2lkdGggfHwgMTYpIC8gMjtcbiAgICAgICAgICAgIHZhciB5ID0gZS55ICsgKGUuaGVpZ2h0IHx8IDE2KSAvIDI7XG4gICAgICAgICAgICBzd2l0Y2ggKGUudHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJwbGF5ZXJcIjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUubmFtZSA9PSBcInN0YXJ0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcExheWVyLnN0YXJ0UG9zaXRpb24gPSB7eDogeCwgeTogeX07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXllci54ID0geDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLnkgPSB5O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuc2NhbGVYID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnByb3BlcnRpZXMuZGlyZWN0aW9uID09IDE4MCkgdGhpcy5wbGF5ZXIuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImVuZW15XCI6XG4gICAgICAgICAgICAgICAgICAgIGlmIChxZnQuRW5lbXlbZS5uYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVuZW15ID0gcWZ0LkVuZW15W2UubmFtZV0odGhpcy5wYXJlbnRTY2VuZSwgZS5wcm9wZXJ0aWVzKS5hZGRDaGlsZFRvKG1hcExheWVyLmVuZW15TGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucHJvcGVydGllcy5kZWFkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjID0gXCIoZnVuY3Rpb24oYXBwKSB7XCIrZS5wcm9wZXJ0aWVzLmRlYWQrXCJ9KVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZXZhbChzYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXkub24oJ2RlYWQnLCBmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8v56e75YuV44OR44K56Kit5a6aXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wcm9wZXJ0aWVzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gZS5wcm9wZXJ0aWVzLnBhdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50c1tpXS5pZCA9PSBpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IGV2ZW50c1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXRoKSBlbmVteS5zZXRQYXRoKHBhdGgsIGUucHJvcGVydGllcy5sb29wIHx8IGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcInVua25vd24gZW5lbXk6IFwiK2UubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIml0ZW1cIjpcbiAgICAgICAgICAgICAgICAgICAgcWZ0Lkl0ZW0odGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpdGVtYm94XCI6XG4gICAgICAgICAgICAgICAgICAgIHFmdC5JdGVtQm94KHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZG9vclwiOlxuICAgICAgICAgICAgICAgICAgICB2YXIgZG9vciA9IHFmdC5NYXBPYmplY3QuRG9vcih0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUubmFtZSA9PSBcImNsZWFyXCIpIG1hcExheWVyLmNsZWFyR2F0ZSA9IGRvb3I7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnByb3BlcnRpZXMuc2NyaXB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2MgPSBcIihmdW5jdGlvbihhcHApIHtcIitlLnByb3BlcnRpZXMuc2NyaXB0K1wifSlcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZXZhbChzYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb29yLm9uKCdlbnRlcmZyYW1lJywgZik7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb29yLnN0YWdlQ29udHJvbGxlciA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb29yLnBsYXllciA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9vci5wYXJlbnRTY2VuZSA9IHRoaXMucGFyZW50U2NlbmU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImJsb2NrXCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBibG9jayA9IHFmdC5NYXBPYmplY3QuQmxvY2sodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLmFkZENvbGxpc2lvbihtYXBMYXllci5jb2xsaXNpb25MYXllcik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJmbG9vclwiOlxuICAgICAgICAgICAgICAgICAgICB2YXIgZmxvb3IgPSBxZnQuTWFwT2JqZWN0LkZsb29yKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICBmbG9vci5hZGRDb2xsaXNpb24obWFwTGF5ZXIuY29sbGlzaW9uTGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5wcm9wZXJ0aWVzLnNjcmlwdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjID0gXCIoZnVuY3Rpb24oYXBwKSB7XCIrZS5wcm9wZXJ0aWVzLnNjcmlwdCtcIn0pXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGV2YWwoc2MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3Iub24oJ2VudGVyZnJhbWUnLCBmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb29yLnN0YWdlQ29udHJvbGxlciA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG9vci5wbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb29yLnBhcmVudFNjZW5lID0gdGhpcy5wYXJlbnRTY2VuZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL+enu+WLleODkeOCueioreWumlxuICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnByb3BlcnRpZXMubW92ZVR5cGUgPT0gJ3BhdGgnICYmIGUucHJvcGVydGllcy5wYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSBlLnByb3BlcnRpZXMucGF0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50c1tpXS5pZCA9PSBpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gZXZlbnRzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsb29yLnNldFBhdGgocGF0aC54LCBwYXRoLnksIHBhdGgucG9seWxpbmUsIGUucHJvcGVydGllcy5sb29wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiY2hlY2tcIjpcbiAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5DaGVja0ljb24odGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSkuc2V0QW5pbWF0aW9uKGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJtZXNzYWdlXCI6XG4gICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QuTWVzc2FnZSh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImV2ZW50XCI6XG4gICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QuRXZlbnQodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJnYXRlXCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBnYXRlID0gcWZ0Lk1hcE9iamVjdC5HYXRlKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5wcm9wZXJ0aWVzLnNjcmlwdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjID0gXCIoZnVuY3Rpb24oYXBwKSB7XCIrZS5wcm9wZXJ0aWVzLnNjcmlwdCtcIn0pXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGV2YWwoc2MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2F0ZS5vbignZW50ZXJmcmFtZScsIGYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2F0ZS5zdGFnZUNvbnRyb2xsZXIgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2F0ZS5wbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdGUucGFyZW50U2NlbmUgPSB0aGlzLnBhcmVudFNjZW5lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJhY2Nlc3NvcnlcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxheWVyID0gZS5wcm9wZXJ0aWVzLmZvcmVncm91bmQ/IG1hcExheWVyLmZvcmVncm91bmRMYXllcjogbWFwTGF5ZXIuYmFja2dyb3VuZExheWVyO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGUubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImxhbXBcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0LkxhbXAodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhsYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYm9uZmlyZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QuQm9uZmlyZSh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKGxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJmbGFtZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QuRmxhbWUodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhsYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiY2FuZGxlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5DYW5kbGUodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhsYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibGFudGhhbnVtXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5MYW50aGFudW0odGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhsYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiY2FuZGxlbGFtcFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QuQ2FuZGxlTGFtcCh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKGxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwidW5rbm93biBtYXAgYWNjZXNzb3J5OiBcIitlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJucGNcIjpcbiAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5ucGModGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5lbmVteUxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcInBhdGhcIjpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwidW5rbm93biBtYXAgb2JqZWN0IGlkOltcIiArIGUuaWQgKyBcIl0gdHlwZTpbXCIgKyBlLnR5cGUgKyBcIl0gbmFtZTpbXCIgKyBlLm5hbWUgKyBcIl1cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiBtYXBMYXllcjtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlMTAuanNcbiAqICAyMDE3LzA5LzEwXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCqOODs+ODh+OCo+ODs+OCsOOCt+ODvOODs1xucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlMTBcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogMTAsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjUsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJlbmRpbmdcIixcblxuICAgIC8v54m55q6K44K544OG44O844K444OV44Op44KwXG4gICAgaXNFbmRpbmc6IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlMTBcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICB9KTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGNoYXJhY3Rlci5iYWxsb29uLmpzXG4gKiAgMjAxNy8wNC8yNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkNoYXJhY3Rlci5iYWxsb29uXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuU3ByaXRlXCIsXG5cbiAgICAvL+Wvv+WRveODleODrOODvOODoFxuICAgIGxpZmVTcGFuOiAzMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDYsXG5cblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoXCJiYWxsb29uXCIsIDI0LCAzMik7XG5cbiAgICAgICAgdGhpcy5wYXR0ZXJuID0gb3B0aW9ucy5wYXR0ZXJuIHx8IFwiIVwiO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbih0aGlzLnBhdHRlcm4pO1xuXG4gICAgICAgIHRoaXMubGlmZVNwYW4gPSBvcHRpb25zLmxpZmVTcGFuIHx8IDYwO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gb3B0aW9ucy5hbmltYXRpb25JbnRlcnZhbCB8fCA2O1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIC8v54m55q6K44OR44K/44O844OzXG4gICAgICAgIGlmICh0aGlzLnBhdHRlcm4gPT0gXCJhbmdlcjJcIikge1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKCkuYnkoe3k6IC0xNiwgYWxwaGE6IC0xfSwgdGhpcy5hbmltYXRpb25JbnRlcnZhbCwgXCJlYXNlSW5TaW5lXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZSA6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy50aW1lICUgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9PSAwKSB0aGlzLmZyYW1lSW5kZXgrKztcblxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IHRoaXMubGlmZVNwYW4pIHRoaXMucmVtb3ZlKCk7XG4gICAgfSxcblxuICAgIHNldEFuaW1hdGlvbjogZnVuY3Rpb24ocGF0dGVybikge1xuICAgICAgICBzd2l0Y2ggKHBhdHRlcm4pIHtcbiAgICAgICAgICAgIGNhc2UgXCIuLi5cIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgMjQsIDEyOCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiP1wiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZyg5NiwgMzIsIDI0LCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiIVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZyg3MiwgNjQsIDcyLCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwienp6XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDAsIDAsIDI0LCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic3R1blwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZygxNDQsIDMyLCA0OCwgMzIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImxpZ2h0XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDE0NCwgNjQsIDQ4LCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibmV3dHlwZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZygxNDQsIDk2LCA3MiwgMzIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImFuZ2VyXCI6XG4gICAgICAgICAgICBjYXNlIFwiYW5nZXIxXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDcyLCA5NiwgMjQsIDMyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJhbmdlcjJcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZyYW1lVHJpbW1pbmcoMTQ0LCAxMjgsIDcyLCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGNoYXJhY3Rlci5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5DaGFyYWN0ZXJcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgLy/jg57jg4Pjg5fjgqrjg5bjgrjjgqfjgq/jg4hJRFxuICAgIGlkOiAtMSxcblxuICAgIC8v5Yqg6YCf5bqmXG4gICAgdng6IDAsXG4gICAgdnk6IDAsXG5cbiAgICAvL+WIneacn+W6p+aomVxuICAgIGZpcnN0WDogMCxcbiAgICBmaXJzdFk6IDAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAuOSxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAuNSxcblxuICAgIC8v5bqK56e75YuV5rib6KGw546HXG4gICAgZmxvb3JGcmljdGlvbjogMC41LFxuXG4gICAgLy/lj43nmbrkv4LmlbBcbiAgICByZWJvdW5kOiAwLFxuXG4gICAgLy/jgrjjg6Pjg7Pjg5fkuK3jg5Xjg6njgrBcbiAgICBpc0p1bXA6IGZhbHNlLFxuXG4gICAgLy/jgrnjg6vjg7zjgZfjgZ/jg5Xjg63jgqJcbiAgICB0aHJvdWdoRmxvb3I6IG51bGwsXG5cbiAgICAvL+W6iuS4iuODleODqeOCsFxuICAgIGlzT25GbG9vcjogZmFsc2UsXG5cbiAgICAvL+S5l+OBo+OBpuOBhOOCi+OCquODluOCuOOCp+OCr+ODiFxuICAgIGZsb29yT2JqZWN0OiBudWxsLFxuXG4gICAgLy/jga/jgZfjgZTkuIrjg5Xjg6njgrBcbiAgICBpc09uTGFkZGVyOiBmYWxzZSxcblxuICAgIC8v6ZqO5q615LiK44OV44Op44KwXG4gICAgaXNPblN0YWlyczogZmFsc2UsXG5cbiAgICAvL+OBr+OBl+OBlOaOtOOBv+ODleODqeOCsFxuICAgIGlzQ2F0Y2hMYWRkZXI6IGZhbHNlLFxuXG4gICAgLy/mrbvkuqHjg5Xjg6njgrBcbiAgICBpc0RlYWQ6IGZhbHNlLFxuXG4gICAgLy/okL3kuIvmrbvkuqHjg5Xjg6njgrBcbiAgICBpc0Ryb3A6IGZhbHNlLFxuXG4gICAgLy/msJfntbbjg5Xjg6njgrBcbiAgICBpc1N0dW46IGZhbHNlLFxuXG4gICAgLy/mk43kvZzlgZzmraLmmYLplpNcbiAgICBzdG9wVGltZTogMCxcblxuICAgIC8v54Sh5pW144OV44Op44KwXG4gICAgaXNNdXRla2k6IGZhbHNlLFxuXG4gICAgLy/nhKHmlbXmmYLplpNcbiAgICBtdXRla2lUaW1lOiAwLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7Pjg5Xjg6njgrBcbiAgICBpc0FuaW1hdGlvbjogdHJ1ZSxcblxuICAgIC8v54++5Zyo5a6f6KGM5Lit44Ki44Kv44K344On44OzXG4gICAgbm93QW5pbWF0aW9uOiBcInN0YW5kXCIsXG5cbiAgICAvL+WJjeODleODrOODvOODoOWun+ihjOOCouOCr+OCt+ODp+ODs1xuICAgIGJlZm9yZUFuaW1hdGlvbjogXCJcIixcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6YCy6KGM5Y+v6IO944OV44Op44KwXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiB0cnVlLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PlpInmm7TmpJznn6Xjg5Xjg6njgrBcbiAgICBpc0NoYW5nZUFuaW1hdGlvbjogZmFsc2UsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiA2LFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IGZhbHNlLFxuXG4gICAgLy/jgrnjgq/jg6rjg7zjg7PlhoXjg5Xjg6njgrBcbiAgICBvblNjcmVlbjogZmFsc2UsXG5cbiAgICAvL+a0u+WLleODleODqeOCsFxuICAgIGlzQWN0aXZlOiB0cnVlLFxuXG4gICAgLy/lvbHooajnpLpcbiAgICBpc1NoYWRvdzogZmFsc2UsXG4gICAgc2hhZG93WTogMCxcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNQbGF5ZXI6IGZhbHNlLFxuICAgIGlzRW5lbXk6IGZhbHNlLFxuICAgIGlzSXRlbUJveDogZmFsc2UsXG4gICAgaXNJdGVtOiBmYWxzZSxcbiAgICBpc0Jsb2NrOiBmYWxzZSxcbiAgICBpc01hcEFjY2Vzc29yeTogZmFsc2UsXG5cbiAgICAvL+e1jOmBjuODleODrOODvOODoFxuICAgIHRpbWU6IDAsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuICAgICAgICB0aGlzLmJvdW5kaW5nVHlwZSA9IFwicmVjdFwiO1xuICAgICAgICB0aGlzLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG5cbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgdGhpcy5zZXR1cEFuaW1hdGlvbigpO1xuXG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkIHx8IC0xO1xuXG4gICAgICAgIC8v5b2T44Gf44KK5Yik5a6a5oOF5aCx5Yid5pyf5YyWXG4gICAgICAgIGlmICghdGhpcy5pc01hcEFjY2Vzc29yeSkgdGhpcy5pbml0Q29sbGlzaW9uKG9wdGlvbnMpO1xuXG4gICAgICAgIC8v5ZC544GN5Ye644GXXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5iYWxsb29uID0gbnVsbDtcbiAgICAgICAgdGhpcy5sYXN0QmFsbG9vbiA9IFwiXCI7XG4gICAgICAgIHRoaXMuYmFsbG9vblRpbWUgPSAwO1xuICAgICAgICB0aGlzLm9uKCdiYWxsb29uJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1N0dW4pIHJldHVybjtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgPiB0aGlzLmJhbGxvb25UaW1lKSB0aGlzLmxhc3RCYWxsb29uID0gXCJcIjtcbiAgICAgICAgICAgIGlmICh0aGlzLmxhc3RCYWxsb29uUGF0dGVybiA9PSBlLnBhdHRlcm4gJiYgIWUuZm9yY2UpIHJldHVybjtcbiAgICAgICAgICAgIGlmICh0aGlzLmJhbGxvb24pIHRoaXMuYmFsbG9vbi5yZW1vdmUoKTtcbiAgICAgICAgICAgIGUuJHNhZmUoe3g6IDAsIHk6IC10aGlzLmhlaWdodC8yLTEwfSk7XG4gICAgICAgICAgICB0aGlzLmJhbGxvb24gPSBxZnQuQ2hhcmFjdGVyLmJhbGxvb24oe3BhdHRlcm46IGUucGF0dGVybiwgbGlmZVNwYW46IGUubGlmZVNwYW4sIGFuaW1hdGlvbkludGVydmFsOiBlLmFuaW1hdGlvbkludGVydmFsfSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihlLngsIGUueSk7XG4gICAgICAgICAgICB0aGlzLmJhbGxvb24ub24oJ3JlbW92ZWQnLCBlID0+IHtcbiAgICAgICAgICAgICAgICB0aGF0LmJhbGxvb24gPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoYXQuZmxhcmUoJ2JhbGxvb25lbmQnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5sYXN0QmFsbG9vblBhdHRlcm4gPSBlLnBhdHRlcm47XG4gICAgICAgICAgICB0aGlzLmJhbGxvb25UaW1lID0gdGhpcy50aW1lICsgMTIwO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5vbignYmFsbG9vbmVyYWNlJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5iYWxsb29uID09IG51bGwpIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuYmFsbG9vbi5yZW1vdmUoKTtcbiAgICAgICAgICAgIHRoaXMuYmFsbG9vbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmJhbGxvb25UaW1lID0gMDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/msJfntbbnirbmhYtcbiAgICAgICAgdGhpcy5vbignc3R1bicsIGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc1N0dW4gPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IGUucG93ZXIgKiAxMDtcbiAgICAgICAgICAgIHRoaXMuYmFsbG9vbiA9IHFmdC5DaGFyYWN0ZXIuYmFsbG9vbih7cGF0dGVybjogXCJzdHVuXCIsIGxpZmVTcGFuOiB0aGlzLnN0b3BUaW1lfSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAtdGhpcy5oZWlnaHQvMi0xMCk7XG4gICAgICAgICAgICB0aGlzLmxhc3RCYWxsb29uID0gZS5wYXR0ZXJuO1xuICAgICAgICAgICAgdGhpcy5iYWxsb29uVGltZSA9IHRoaXMudGltZSArIDEyMDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudFNjZW5lLnBhdXNlU2NlbmUpIHJldHVybjtcblxuICAgICAgICAgICAgLy/liJ3mnJ/luqfmqJnjga7oqJjpjLLjgajliJ3lm57jg5Xjg6zjg7zjg6Dlh6bnkIZcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RYID0gdGhpcy54O1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RZID0gdGhpcy55O1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RGcmFtZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+eUu+mdouWGheWIpOWumlxuICAgICAgICAgICAgdmFyIHBzID0gdGhpcy5wYXJlbnRTY2VuZTtcbiAgICAgICAgICAgIGlmIChwcy5zY3JlZW5YLVNDX1cgPCB0aGlzLnggJiYgdGhpcy54IDwgcHMuc2NyZWVuWCArIFNDX1cqMiAmJiBcbiAgICAgICAgICAgICAgICBwcy5zY3JlZW5ZLVNDX0ggPCB0aGlzLnkgJiYgdGhpcy55IDwgcHMuc2NyZWVuWSArIFNDX0gqMikge1xuICAgICAgICAgICAgICAgIHRoaXMub25TY3JlZW4gPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uU2NyZWVuID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+eUu+mdouWkluOBruWgtOWQiOOBr+WLleS9nOWBnOatolxuLy8gICAgICAgICAgICBpZiAoIXRoaXMub25TY3JlZW4pIHJldHVybjtcblxuICAgICAgICAgICAgLy/mtLvli5Xjg5Xjg6njgrBcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkgcmV0dXJuO1xuXG4gICAgICAgICAgICB0aGlzLnggKz0gdGhpcy52eDtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgICAgIHRoaXMudnggKj0gdGhpcy5mbG9vckZyaWN0aW9uO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IHRoaXMuZnJpY3Rpb247XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2F0Y2hMYWRkZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnkgKz0gdGhpcy52eTtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy55ICs9IHRoaXMudnk7XG4gICAgICAgICAgICAgICAgdGhpcy52eSArPSB0aGlzLmdyYXZpdHk7XG4gICAgICAgICAgICAgICAgLy/okL3kuIvpgJ/luqbkuIrpmZBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52eSA+IDIwKSB0aGlzLnZ5ID0gMjA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoTWF0aC5hYnModGhpcy52eCkgPCAwLjAxKSB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgIGlmIChNYXRoLmFicyh0aGlzLnZ5KSA8IDAuMDEpIHRoaXMudnkgPSAwO1xuXG4gICAgICAgICAgICAvL+W9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzTWFwQWNjZXNzb3J5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldENvbGxpc2lvblBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja01hcENvbGxpc2lvbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+eUu+mdouWkluiQveOBoVxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzRGVhZCAmJiB0aGlzLnkgPiB0aGlzLnBhcmVudC5wYXJlbnQubWFwLmhlaWdodCkgdGhpcy5kcm9wRGVhZCgpO1xuXG4gICAgICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs1xuICAgICAgICAgICAgaWYgKHRoaXMuc3ByaXRlICYmIHRoaXMuaXNBbmltYXRpb24gJiYgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gJiYgdGhpcy50aW1lICUgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbmRleCA9ICh0aGlzLmluZGV4KzEpICUgdGhpcy5mcmFtZVt0aGlzLm5vd0FuaW1hdGlvbl0ubGVuZ3RoO1xuICAgICAgICAgICAgICAgIC8v5qyh44OV44Os44O844Og55Wq5Y+344GM54m55q6K5oyH5a6a44Gu5aC05ZCIXG4gICAgICAgICAgICAgICAgdmFyIG5leHQgPSB0aGlzLmZyYW1lW3RoaXMubm93QW5pbWF0aW9uXVt0aGlzLmluZGV4XTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dCA9PSBcInN0b3BcIikge1xuICAgICAgICAgICAgICAgICAgICAvL+WBnOatolxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4LS07XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXh0ID09IFwicmVtb3ZlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg6rjg6Djg7zjg5ZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBuZXh0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v5oyH5a6a44Ki44OL44Oh44O844K344On44Oz44G45aSJ5pu0XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKG5leHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLmZyYW1lSW5kZXggPSBuZXh0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/nhKHmlbXmmYLplpPlh6bnkIZcbiAgICAgICAgICAgIGlmICh0aGlzLm11dGVraVRpbWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubXV0ZWtpVGltZSAlIDIgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgICAgICAgICB0aGlzLm11dGVraVRpbWUtLTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/mk43kvZzlgZzmraLmmYLplpNcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUtLTtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0b3BUaW1lIDwgMCkgdGhpcy5zdG9wVGltZSA9IDA7XG5cbiAgICAgICAgICAgIC8v5pON5L2c5YGc5q2i5pmC6ZaT44GM57WC44KP44Gj44Gf44KJ5rCX57W26Kej6ZmkXG4gICAgICAgICAgICBpZiAodGhpcy5pc1N0dW4gJiYgdGhpcy5zdG9wVGltZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1N0dW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuYmFsbG9vbikgdGhpcy5iYWxsb29uLnNjYWxlWCA9IHRoaXMuc2NhbGVYO1xuXG4gICAgICAgICAgICAvL+S5l+OBo+OBpuOBhOOCi+W6iuOBruWPluW+l1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbG9vck9iamVjdCA9IHRoaXMuX2NvbGxpc2lvblsyXS5oaXQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxvb3JPYmplY3QgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+W9seWHpueQhlxuICAgICAgICAgICAgaWYgKHRoaXMuc2hhZG93U3ByaXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUueCA9IHRoaXMueDtcbiAgICAgICAgICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS55ID0gdGhpcy5zaGFkb3dZO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnRpbWUrKztcbiAgICAgICAgICAgIHRoaXMuYmVmb3JlQW5pbWF0aW9uID0gdGhpcy5ub3dBbmltYXRpb247XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMub24oJ2FkZGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbmUoJ2VudGVyZnJhbWUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNTaGFkb3cgJiYgIXRoaXMuaWdub3JlQ29sbGlzaW9uKSB0aGlzLnNldHVwU2hhZG93KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5vbigncmVtb3ZlZCcsICgpID0+IHtcbiAgICAgICAgICAgIGlmKHRoaXMuc2hhZG93U3ByaXRlKSB0aGlzLnNoYWRvd1Nwcml0ZS5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v5LiA5Zue55uu44GuZW50ZXJmcmFtZeOBp+S4gOW6puOBoOOBkeWRvOOBsOOCjOOCi1xuICAgIGZpcnN0RnJhbWU6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG5cbiAgICAvL+W9seihqOekuuOCu+ODg+ODiOOCouODg+ODl1xuICAgIHNldHVwU2hhZG93OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgc2MgPSB0aGlzLndpZHRoIC8gMjQ7XG4gICAgICAgIGlmIChzYyA8IDEpIHNjICs9IDAuMjtcbiAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInNoYWRvd1wiLCAyNCwgOClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuc2hhZG93TGF5ZXIpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC41KVxuICAgICAgICAgICAgLnNldFNjYWxlKHNjLCAxLjApO1xuICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuYWxwaGEgPSAwLjU7XG4gICAgICAgICAgICBpZiAodGhhdC5hbHBoYSA8IDAuNSkgdGhpcy5hbHBoYSA9IHRoYXQuYWxwaGE7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprmg4XloLHliJ3mnJ/ljJZcbiAgICBpbml0Q29sbGlzaW9uOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIC8v5b2T44KK5Yik5a6a55So77yIMDrkuIogMTrlj7MgMjrkuIsgMzrlt6bvvIlcbiAgICAgICAgdmFyIHcgPSBNYXRoLmZsb29yKHRoaXMud2lkdGgvNCk7XG4gICAgICAgIHZhciBoID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodC80KTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uID0gW107XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblswXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiB3LCBoZWlnaHQ6IDJ9KTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzFdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDIsIGhlaWdodDogaH0pO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogdywgaGVpZ2h0OiAyfSk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblszXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAyLCBoZWlnaHQ6IGh9KTtcbiAgICAgICAgdGhpcy5jb2xsaXNpb25SZXN1bHQgPSBudWxsO1xuXG4gICAgICAgIC8v5b2T44Gf44KK5Yik5a6a44OB44Kn44OD44Kv5L2N572u44Kq44OV44K744OD44OIXG4gICAgICAgIHRoaXMub2Zmc2V0Q29sbGlzaW9uWCA9IG9wdGlvbnMub2Zmc2V0Q29sbGlzaW9uWCB8fCAwO1xuICAgICAgICB0aGlzLm9mZnNldENvbGxpc2lvblkgPSBvcHRpb25zLm9mZnNldENvbGxpc2lvblkgfHwgMDtcblxuICAgICAgICAvL+W9k+OBn+OCiuWIpOWumuaDheWgseWGjeioreWumlxuICAgICAgICB0aGlzLnNldHVwQ29sbGlzaW9uKCk7XG5cbiAgICAgICAgLy/lvZPjgZ/jgorliKTlrprjg4fjg5Djg4PjgrDnlKhcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikge1xuICAgICAgICAgICAgdGhpcy5vbmUoJ2VudGVyZnJhbWUnLCBlID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMF0uYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMV0uYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0uYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10uYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMF0uYWxwaGEgPSAwLjM7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzFdLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblsyXS5hbHBoYSA9IDAuMztcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10uYWxwaGEgPSAwLjM7XG4gICAgICAgICAgICAgICAgLy/jg4Djg6Hjg7zjgrjlvZPjgZ/jgorliKTlrprooajnpLpcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiB0aGlzLndpZHRoLCBoZWlnaHQ6IHRoaXMuaGVpZ2h0fSkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgICAgICAgICBjLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLm9uZSgncmVtb3ZlZCcsIGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblswXS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMV0ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzJdLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblszXS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/nlLvpnaLlpJbokL3jgaFcbiAgICBkcm9wRGVhZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNEZWFkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0Ryb3AgPSB0cnVlO1xuICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdkZWFkJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+ODjuODg+OCr+ODkOODg+OCr+ODouODvOOCt+ODp+ODs1xuICAgIGtub2NrYmFjazogZnVuY3Rpb24ocG93ZXIsIGRpcmVjdGlvbikge1xuICAgICAgICBwb3dlciA9IHBvd2VyIHx8IDA7XG4gICAgICAgIGlmIChwb3dlciA9PSAwKSByZXR1cm47XG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09IHVuZGVmaW5lZCkgZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcblxuICAgICAgICB2YXIgYmFjayA9IDMyICsgTWF0aC5mbG9vcihwb3dlciAvIDEwKTtcbiAgICAgICAgdmFyIHN4ID0gTWF0aC5jb3MoZGlyZWN0aW9uLnRvUmFkaWFuKCkpO1xuICAgICAgICB2YXIgc3kgPSBNYXRoLnNpbihkaXJlY3Rpb24udG9SYWRpYW4oKSk7XG5cbiAgICAgICAgLy/jg47jg4Pjgq/jg5Djg4Pjgq/lhYjjgavlo4HjgYznhKHjgYTjgYvjg4Hjgqfjg4Pjgq9cbiAgICAgICAgdmFyIGNoayA9IHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCArIHN4ICogYmFjaywgdGhpcy55ICsgc3kgKiBiYWNrLCA4LCA4KTtcbiAgICAgICAgaWYgKGNoaykge1xuICAgICAgICAgICAgLy/lo4HjgavlvZPjgZ/jgovmiYDjgb7jgafjg5Djg4Pjgq/jgZnjgotcbiAgICAgICAgICAgIHZhciBjID0gY2hrWzBdO1xuICAgICAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIGJhY2sgPSAoYy54IC0gYy53aWR0aCAvIDIpIC0gdGhpcy54O1xuICAgICAgICAgICAgICAgICAgICBiYWNrICo9IDAuODtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxODA6XG4gICAgICAgICAgICAgICAgICAgIGJhY2sgPSB0aGlzLnggLSAoYy54ICsgYy53aWR0aCAvIDIpO1xuICAgICAgICAgICAgICAgICAgICBiYWNrICo9IDAuODtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpLmJ5KHt4OiBzeCAqIGJhY2ssIHk6IHN5ICogYmFja30sIDEwLCBcImVhc2VPdXRFbGFzdGljXCIpO1xuICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+WcsOW9ouW9k+OBn+OCiuWIpOWumlxuICAgIGNoZWNrTWFwQ29sbGlzaW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlQ29sbGlzaW9uKSByZXR1cm4gdGhpcztcblxuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMF0uaGl0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzFdLmhpdCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblsyXS5oaXQgPSBudWxsO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10uaGl0ID0gbnVsbDtcblxuICAgICAgICB0aGlzLmlzT25MYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc09uU3RhaXJzID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHRoaXMub25TY3JlZW4gJiYgdGhpcy5zaGFkb3dTcHJpdGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2hhZG93WSA9IDk5OTk5O1xuICAgICAgICAgICAgdmFyIHAxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgIHZhciBwMiA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSArIDEyOCk7XG4gICAgICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WcsOW9ouaOpeinpuWIpOWumlxuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0Ryb3ApIHJldHVybjtcbiAgICAgICAgICAgIGlmIChlLmlnbm9yZSB8fCBlID09IHRoaXMudGhyb3VnaEZsb29yKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgZS50eXBlID09IFwic3RhaXJzXCIpIHJldHVybjtcblxuICAgICAgICAgICAgLy/kuIrlgbRcbiAgICAgICAgICAgIGlmICh0aGlzLnZ5IDwgMCAgJiYgZS5oaXRUZXN0RWxlbWVudCh0aGlzLl9jb2xsaXNpb25bMF0pKSB0aGlzLl9jb2xsaXNpb25bMF0uaGl0ID0gZTtcbiAgICAgICAgICAgIC8v5LiL5YG0XG4gICAgICAgICAgICBpZiAodGhpcy52eSA+PSAwICYmIGUuaGl0VGVzdEVsZW1lbnQodGhpcy5fY29sbGlzaW9uWzJdKSkgdGhpcy5fY29sbGlzaW9uWzJdLmhpdCA9IGU7XG4gICAgICAgICAgICAvL+WPs+WBtFxuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwICAmJiBlLmhpdFRlc3RFbGVtZW50KHRoaXMuX2NvbGxpc2lvblsxXSkpIHRoaXMuX2NvbGxpc2lvblsxXS5oaXQgPSBlO1xuICAgICAgICAgICAgLy/lt6blgbRcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4IDwgMCAgJiYgZS5oaXRUZXN0RWxlbWVudCh0aGlzLl9jb2xsaXNpb25bM10pKSB0aGlzLl9jb2xsaXNpb25bM10uaGl0ID0gZTtcblxuICAgICAgICAgICAgaWYgKHRoaXMub25TY3JlZW4gJiYgdGhpcy5zaGFkb3dTcHJpdGUpIHtcbiAgICAgICAgICAgICAgICAvL+OCreODo+ODqeOCr+OCv+ODvOOBruS4i+aWueWQkeOBq+ODrOOCpOOCkumjm+OBsOOBl+OBpuebtOS4i+OBruWcsOmdouW6p+aomeOCkuWPluOCi1xuICAgICAgICAgICAgICAgIHZhciB4ID0gZS54IC0gZS53aWR0aCAvIDI7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSBlLnkgLSBlLmhlaWdodCAvIDI7XG4gICAgICAgICAgICAgICAgdmFyIHAzID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHgsIHkpO1xuICAgICAgICAgICAgICAgIHZhciBwNCA9IHBoaW5hLmdlb20uVmVjdG9yMih4ICsgZS53aWR0aCwgeSk7XG4gICAgICAgICAgICAgICAgaWYgKHkgPCB0aGlzLnNoYWRvd1kgJiYgcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdExpbmVMaW5lKHAxLCBwMiwgcDMsIHA0KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS5zZXRQb3NpdGlvbih0aGlzLngsIHkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGFkb3dZID0geTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLmlzQ2F0Y2hMYWRkZXIpIHRoaXMuc2hhZG93U3ByaXRlLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICAvL+W9k+OBn+OCiuWIpOWumue1kOaenOWPjeaYoFxuICAgICAgICB0aGlzLmNvbGxpc2lvblByb2Nlc3MoKTtcblxuICAgICAgICAvL+OBr+OBl+OBlOOBruOBv+WIpOWumlxuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZSA9PiB7XG4gICAgICAgICAgICAvL+air+WtkOWIpOWumlxuICAgICAgICAgICAgaWYgKGUudHlwZSA9PSBcImxhZGRlclwiIHx8IGUudHlwZSA9PSBcInN0YWlyc1wiKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGFkZGVyQ29sbGlzaW9uICYmIGUuaGl0VGVzdEVsZW1lbnQodGhpcy5sYWRkZXJDb2xsaXNpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPbkxhZGRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPblN0YWlycyA9IChlLnR5cGUgPT0gXCJzdGFpcnNcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+W9k+OBn+OCiuWIpOWumue1kOaenOWPjeaYoOWHpueQhlxuICAgIGNvbGxpc2lvblByb2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdyA9IE1hdGguZmxvb3IodGhpcy53aWR0aC8yKSs2O1xuICAgICAgICB2YXIgaCA9IE1hdGguZmxvb3IodGhpcy5oZWlnaHQvMikrNjtcbiAgICAgICAgdGhpcy5pc09uRmxvb3IgPSBmYWxzZTtcblxuICAgICAgICAvL+S4iuWBtOaOpeinplxuICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzBdLmhpdCAmJiAhdGhpcy5pc0NhdGNoTGFkZGVyKSB7XG4gICAgICAgICAgICB2YXIgcmV0ID0gdGhpcy5fY29sbGlzaW9uWzBdLmhpdDtcbiAgICAgICAgICAgIHRoaXMueSA9IHJldC55K3JldC5oZWlnaHQqKDEtcmV0Lm9yaWdpblkpK2g7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgIHRoaXMucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgaWYgKHJldC5jb2xsaXNpb25TY3JpcHQpIHtcbiAgICAgICAgICAgICAgICByZXQuY29sbGlzaW9uU2NyaXB0KHRoaXMsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8v5LiL5YG05o6l6KemXG4gICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMl0uaGl0ICYmICF0aGlzLmlzQ2F0Y2hMYWRkZXIpIHtcbiAgICAgICAgICAgIHZhciByZXQgPSB0aGlzLl9jb2xsaXNpb25bMl0uaGl0O1xuICAgICAgICAgICAgdGhpcy55ID0gcmV0LnktcmV0LmhlaWdodCpyZXQub3JpZ2luWS1oO1xuICAgICAgICAgICAgdGhpcy54ICs9IHJldC52eCB8fCAwO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzUGxheWVyICYmIHJldC52eSA+IDApIHRoaXMueSArPSByZXQudnkgfHwgMDtcblxuICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNPbkZsb29yID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZmxvb3JGcmljdGlvbiA9IHJldC5mcmljdGlvbiA9PSB1bmRlZmluZWQ/IDAuNTogcmV0LmZyaWN0aW9uO1xuXG4gICAgICAgICAgICB0aGlzLnRocm91Z2hGbG9vciA9IG51bGw7XG4gICAgICAgICAgICBpZiAodGhpcy5yZWJvdW5kID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLXRoaXMudnkgKiB0aGlzLnJlYm91bmQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnkgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yZXNldENvbGxpc2lvblBvc2l0aW9uKCk7XG4gICAgICAgICAgICBpZiAocmV0LmNvbGxpc2lvblNjcmlwdCkge1xuICAgICAgICAgICAgICAgIHJldC5jb2xsaXNpb25TY3JpcHQodGhpcywgMik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy/lj7PlgbTmjqXop6ZcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQgJiYgIXRoaXMuaXNDYXRjaExhZGRlcikge1xuICAgICAgICAgICAgdmFyIHJldCA9IHRoaXMuX2NvbGxpc2lvblsxXS5oaXQ7XG4gICAgICAgICAgICB0aGlzLnggPSByZXQueC1yZXQud2lkdGgqcmV0Lm9yaWdpblgtdztcbiAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgdGhpcy5yZXNldENvbGxpc2lvblBvc2l0aW9uKCk7XG4gICAgICAgICAgICBpZiAocmV0LmNvbGxpc2lvblNjcmlwdCkge1xuICAgICAgICAgICAgICAgIHJldC5jb2xsaXNpb25TY3JpcHQodGhpcywgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy/lt6blgbTmjqXop6ZcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQgJiYgIXRoaXMuaXNDYXRjaExhZGRlcikge1xuICAgICAgICAgICAgdmFyIHJldCA9IHRoaXMuX2NvbGxpc2lvblszXS5oaXQ7XG4gICAgICAgICAgICB0aGlzLnggPSByZXQueCtyZXQud2lkdGgqKDEtcmV0Lm9yaWdpblgpK3c7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgIHRoaXMucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgaWYgKHJldC5jb2xsaXNpb25TY3JpcHQpIHtcbiAgICAgICAgICAgICAgICByZXQuY29sbGlzaW9uU2NyaXB0KHRoaXMsIDMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+WcsOW9ouW9k+OBn+OCiuWIpOWumu+8iOeJueWumuWcsOeCueODgeOCp+ODg+OCr+OBruOBv++8ieihneeqgeOBl+OBn+OCguOBruOCkumFjeWIl+OBp+i/lOOBmVxuICAgIGNoZWNrTWFwQ29sbGlzaW9uMjogZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICB4ID0geCB8fCB0aGlzLng7XG4gICAgICAgIHkgPSB5IHx8IHRoaXMueTtcbiAgICAgICAgd2lkdGggPSB3aWR0aCB8fCAxO1xuICAgICAgICBoZWlnaHQgPSBoZWlnaHQgfHwgMTtcbiAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KHt3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0fSkuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgIHZhciByZXQgPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUudHlwZSA9PSBcImxhZGRlclwiIHx8IGUudHlwZSA9PSBcInN0YWlyc1wiKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoZS5oaXRUZXN0RWxlbWVudChjKSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXQgPT0gbnVsbCkgcmV0ID0gW107XG4gICAgICAgICAgICAgICAgcmV0LnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH0sXG5cbiAgICAvL+OCreODo+ODqeOCr+OCv+WQjOWjq+W9k+OBn+OCiuWIpOWumu+8iOODluODreODg+OCr+OBruOBv++8iVxuICAgIGNoZWNrQ2hhcmFjdGVyQ29sbGlzaW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlQ29sbGlzaW9uKSByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLmlzRHJvcCkgcmV0dXJuO1xuXG4gICAgICAgIHZhciByZXQgPSBbXTtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKCFlLmlzQmxvY2spIHJldHVybjtcbiAgICAgICAgICAgIGlmIChlLmlzRGVhZCkgcmV0dXJuO1xuXG4gICAgICAgICAgICAvL+S4iuWBtFxuICAgICAgICAgICAgaWYgKHRoYXQudnkgPCAwICYmIGUuaGl0VGVzdEVsZW1lbnQodGhhdC5fY29sbGlzaW9uWzBdKSkge1xuICAgICAgICAgICAgICAgIHRoYXQueSA9IGUueStlLmhlaWdodCooMS1lLm9yaWdpblkpKzE2O1xuICAgICAgICAgICAgICAgIHRoYXQudnkgPSAxO1xuICAgICAgICAgICAgICAgIHJldFswXSA9IGU7XG4gICAgICAgICAgICAgICAgdGhhdC5yZXNldENvbGxpc2lvblBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+S4i+WBtFxuICAgICAgICAgICAgaWYgKHRoYXQudnkgPiAwICYmIGUuaGl0VGVzdEVsZW1lbnQodGhhdC5fY29sbGlzaW9uWzJdKSkge1xuICAgICAgICAgICAgICAgIHRoYXQueSA9IGUueS1lLmhlaWdodCplLm9yaWdpblktMTY7XG4gICAgICAgICAgICAgICAgdGhhdC52eCA9IGUudng7XG4gICAgICAgICAgICAgICAgdGhhdC52eSA9IDA7XG4gICAgICAgICAgICAgICAgdGhhdC5pc0p1bXAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGF0LmlzT25GbG9vciA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhhdC50aHJvdWdoRmxvb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgIHJldFsyXSA9IGU7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQucmVib3VuZCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnZ5ID0gLXRoYXQudnkgKiB0aGF0LnJlYm91bmQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52eSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoYXQucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/lj7PlgbRcbiAgICAgICAgICAgIGlmICh0aGF0LnZ4ID4gMCAmJiBlLmhpdFRlc3RFbGVtZW50KHRoYXQuX2NvbGxpc2lvblsxXSkpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnggPSBlLngtZS53aWR0aCplLm9yaWdpblgtMTA7XG4gICAgICAgICAgICAgICAgdGhhdC52eCA9IDA7XG4gICAgICAgICAgICAgICAgcmV0WzFdID0gZTtcbiAgICAgICAgICAgICAgICB0aGF0LnJlc2V0Q29sbGlzaW9uUG9zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v5bem5YG0XG4gICAgICAgICAgICBpZiAodGhhdC52eCA8IDAgJiYgZS5oaXRUZXN0RWxlbWVudCh0aGF0Ll9jb2xsaXNpb25bM10pKSB7XG4gICAgICAgICAgICAgICAgdGhhdC54ID0gZS54K2Uud2lkdGgqKDEtZS5vcmlnaW5YKSsxMDtcbiAgICAgICAgICAgICAgICB0aGF0LnZ4ID0gMDtcbiAgICAgICAgICAgICAgICByZXRbM10gPSBlO1xuICAgICAgICAgICAgICAgIHRoYXQucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9LFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprnlKjjgqjjg6zjg6Hjg7Pjg4jjga7lho3oqK3lrppcbiAgICBzZXR1cENvbGxpc2lvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+W9k+OBn+OCiuWIpOWumueUqOOCqOODrOODoeODs+ODiOOBruS9jee9ruWGjeOCu+ODg+ODiFxuICAgIHJlc2V0Q29sbGlzaW9uUG9zaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdyA9IE1hdGguZmxvb3IodGhpcy53aWR0aC8yKSArIDYgKyB0aGlzLm9mZnNldENvbGxpc2lvblg7XG4gICAgICAgIHZhciBoID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodC8yKSsgNiArIHRoaXMub2Zmc2V0Q29sbGlzaW9uWTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzBdLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55IC0gaCk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblsxXS5zZXRQb3NpdGlvbih0aGlzLnggKyB3LCB0aGlzLnkpO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0uc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkgKyBoKTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzNdLnNldFBvc2l0aW9uKHRoaXMueCAtIHcsIHRoaXMueSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzEzLCAxNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzAsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFswXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFswLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0QW5pbWF0aW9uOiBmdW5jdGlvbihhbmltTmFtZSkge1xuICAgICAgICBpZiAoIXRoaXMuZnJhbWVbYW5pbU5hbWVdKSByZXR1cm47XG4gICAgICAgIGlmIChhbmltTmFtZSA9PSB0aGlzLm5vd0FuaW1hdGlvbikgcmV0dXJuO1xuICAgICAgICB0aGlzLm5vd0FuaW1hdGlvbiA9IGFuaW1OYW1lO1xuICAgICAgICB0aGlzLmluZGV4ID0gLTE7XG4gICAgICAgIHRoaXMuaXNDaGFuZ2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYvjgonjga7nm7Tnt5rot53pm6JcbiAgICBnZXREaXN0YW5jZVBsYXllcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB4ID0gdGhpcy54LXRoaXMucGFyZW50U2NlbmUucGxheWVyLng7XG4gICAgICAgIHZhciB5ID0gdGhpcy55LXRoaXMucGFyZW50U2NlbmUucGxheWVyLnk7XG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoeCp4K3kqeSk7XG4gICAgfSxcblxuICAgIC8v44Kq44OW44K444Kn44Kv44OI6ZaT44Gu55u057ea6Led6ZuiXG4gICAgZ2V0RGlzdGFuY2U6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHggPSB0aGlzLnggLSBlbGVtZW50Lng7XG4gICAgICAgIHZhciB5ID0gdGhpcy55IC0gZWxlbWVudC55O1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHgqeCt5KnkpO1xuICAgIH0sXG5cbiAgICAvL+iHquWIhuOBqOS7luOCqOODrOODoeODs+ODiOOCkue1kOOBtuebtOe3muOBruinkuW6pu+8iOW8p+W6puazle+8iVxuICAgIGdldEFuZ2xlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgIHZhciBwMiA9IHBoaW5hLmdlb20uVmVjdG9yMihlbGVtZW50LngsIGVsZW1lbnQueSk7XG4gICAgICAgIHZhciBwID0gcDIuc3ViKHAxKTtcbiAgICAgICAgcmV0dXJuIHAudG9EZWdyZWUoKTtcbiAgICB9LFxuXG4gICAgLy/oh6rliIbjgajku5bjgqjjg6zjg6Hjg7Pjg4jjgpLntZDjgbbnm7Tnt5rjga7op5LluqbvvIjjg6njgrjjgqLjg7PvvIlcbiAgICBnZXRBbmdsZVJhZGlhbjogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIoZWxlbWVudC54LCBlbGVtZW50LnkpO1xuICAgICAgICB2YXIgcCA9IHAyLnN1YihwMSk7XG4gICAgICAgIHJldHVybiBwLnRvQW5nbGUoKTtcbiAgICB9LFxuXG4gICAgLy/niannkIbnj77osaHmg4XloLHjga7jgb/jgqrjg5bjgrjjgqfjgq/jg4jjgaflj5blvpdcbiAgICBnZXRQaHlzaWNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZ4OiB0aGlzLnZ4LFxuICAgICAgICAgICAgdnk6IHRoaXMudnksXG4gICAgICAgICAgICBncmF2aXR5OiB0aGlzLmdyYXZpdHksXG4gICAgICAgICAgICBmcmljdGlvbjogdGhpcy5mcmljdGlvbixcbiAgICAgICAgICAgIHJlYm91bmQ6IHRoaXMucmVib3VuZCxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLy/np7vli5Xjg5Hjgrnjga7oqK3lrppcbiAgICBzZXRQYXRoOiBmdW5jdGlvbihwYXRoLCBsb29wKSB7XG4gICAgICAgIHRoaXMucGF0aCA9IFtdO1xuICAgICAgICB0aGlzLmxvb3AgPSBsb29wO1xuXG4gICAgICAgIC8v44OR44K55oOF5aCx44Gu5L2c5oiQXG4gICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICB2YXIgcHRiID0gbnVsbDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLnBvbHlsaW5lLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgcHQgPSBwaGluYS5nZW9tLlZlY3RvcjIocGF0aC54ICsgcGF0aC5wb2x5bGluZVtpXS54LCBwYXRoLnkgKyBwYXRoLnBvbHlsaW5lW2ldLnkpO1xuICAgICAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgc3VtICs9IE1hdGguZmxvb3IocHRiLmRpc3RhbmNlKHB0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwdC50aW1lID0gc3VtO1xuICAgICAgICAgICAgdGhpcy5wYXRoLnB1c2gocHQpO1xuICAgICAgICAgICAgcHRiID0gcHQ7XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODq+ODvOODl+acieOCiuaMh+WumuOBruWgtOWQiOOAgeWni+eCueOBruW6p+aomeOCkue1gueCueOBq+WKoOOBiOOCi1xuICAgICAgICBpZiAobG9vcCkge1xuICAgICAgICAgICAgdmFyIGVuZCA9IHBoaW5hLmdlb20uVmVjdG9yMihwYXRoLnggKyBwYXRoLnBvbHlsaW5lW3BhdGgucG9seWxpbmUubGVuZ3RoIC0gMV0ueCwgcGF0aC55ICsgcGF0aC5wb2x5bGluZVtwYXRoLnBvbHlsaW5lLmxlbmd0aCAtIDFdLnkpO1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHBhdGgueCArIHBhdGgucG9seWxpbmVbMF0ueCwgcGF0aC55ICsgcGF0aC5wb2x5bGluZVswXS55KTtcbiAgICAgICAgICAgIHN1bSArPSBNYXRoLmZsb29yKHN0YXJ0LmRpc3RhbmNlKGVuZCkpO1xuICAgICAgICAgICAgc3RhcnQudGltZSA9IHN1bTtcbiAgICAgICAgICAgIHRoaXMucGF0aC5wdXNoKHN0YXJ0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBhdGgubWF4VGltZSA9IHN1bTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/jg5HjgrnluqfmqJnjga7lj5blvpdcbiAgICBnZXRQYXRoUG9zaXRpb246IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLnBhdGggfHwgdGltZSA8IDApIHJldHVybiBudWxsO1xuICAgICAgICB0aW1lICU9IHRoaXMucGF0aC5tYXhUaW1lO1xuXG4gICAgICAgIHZhciBsZW4gPSB0aGlzLnBhdGgubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgcCA9IHRoaXMucGF0aFtpXTtcbiAgICAgICAgICAgIGlmICh0aW1lID09IHAudGltZSkgcmV0dXJuIHA7XG4gICAgICAgICAgICBpZiAodGltZSA8IHAudGltZSkge1xuICAgICAgICAgICAgICAgIHZhciBwMiA9IHRoaXMucGF0aFtpIC0gMV07XG4gICAgICAgICAgICAgICAgdmFyIHQgPSAodGltZSAtIHAyLnRpbWUpIC8gKHAudGltZSAtIHAyLnRpbWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwaGluYS5nZW9tLlZlY3RvcjIubGVycChwMiwgcCwgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlZmZlY3QuanNcbiAqICAyMDE3LzAxLzEyXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuRWZmZWN0XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnRcIixcblxuICAgIC8v44Kk44Oz44OH44OD44Kv44K55pu05paw6ZaT6ZqUXG4gICAgaW50ZXJ2YWw6IDIsXG5cbiAgICAvL+ePvuWcqOOCpOODs+ODh+ODg+OCr+OCuVxuICAgIGluZGV4OiAwLFxuXG4gICAgLy/plovlp4vjgqTjg7Pjg4fjg4Pjgq/jgrlcbiAgICBzdGFydEluZGV4OiAwLFxuXG4gICAgLy/mnIDlpKfjgqTjg7Pjg4fjg4Pjgq/jgrlcbiAgICBtYXhJbmRleDogOCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6YCy6KGM5Y+v6IO944OV44Op44KwICAgXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiB0cnVlLFxuXG4gICAgLy/ntYzpgY7jg5Xjg6zjg7zjg6BcbiAgICB0aW1lOiAwLFxuXG4gICAgZGVmYXVsdE9wdGlvbnM6IHtcbiAgICAgICAgbmFtZTogXCJleHBsb2RlXCIsXG4gICAgICAgIGFzc2V0TmFtZTogXCJlZmZlY3RcIixcbiAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgIHBvc2l0aW9uOiB7eDogMCwgeTogMH0sXG4gICAgICAgIG9yaWdpbjoge3g6IDAuNSwgeTogMC41fSxcbiAgICAgICAgcm90YXRpb246IDAsXG4gICAgICAgIGFscGhhOiAxLjAsXG4gICAgICAgIHNjYWxlOiB7eDogMS4wLCB5OiAxLjB9LFxuICAgICAgICBibGVuZE1vZGU6IFwic291cmNlLW92ZXJcIixcbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucy4kZXh0ZW5kKHFmdC5FZmZlY3REYXRhLmdldCh0aGlzLm9wdGlvbnMubmFtZSkpO1xuICAgICAgICB0aGlzLnNldHVwKCk7XG5cbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lICUgdGhpcy5pbnRlcnZhbCA9PSAwICYmIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUuZnJhbWVJbmRleCsrO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNwcml0ZS5mcmFtZUluZGV4ID09IDAgfHwgdGhpcy5zcHJpdGUuZnJhbWVJbmRleCA9PSB0aGlzLm1heEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUuZnJhbWVJbmRleCA9IHRoaXMuc3RhcnRJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYW5pbWF0aW9uZW5kJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2V0dXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgb3AgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUob3AuYXNzZXROYW1lLCBvcC53aWR0aCwgb3AuaGVpZ2h0KVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKG9wLnBvc2l0aW9uLngsIG9wLnBvc2l0aW9uLnkpXG4gICAgICAgICAgICAuc2V0T3JpZ2luKG9wLm9yaWdpbi54LCBvcC5vcmlnaW4ueSlcbiAgICAgICAgICAgIC5zZXRTY2FsZShvcC5zY2FsZS54LCBvcC5zY2FsZS55KVxuICAgICAgICAgICAgLnNldFJvdGF0aW9uKG9wLnJvdGF0aW9uKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIGlmIChvcC50cmltbWluZykge1xuICAgICAgICAgICAgdmFyIHQgPSBvcC50cmltbWluZztcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcodC54LCB0LnksIHQud2lkdGgsIHQuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0YXJ0SW5kZXggPSBvcC5zdGFydEluZGV4O1xuICAgICAgICB0aGlzLm1heEluZGV4ID0gb3AubWF4SW5kZXg7XG4gICAgICAgIHRoaXMuc3ByaXRlLmFscGhhID0gb3AuYWxwaGE7XG4gICAgICAgIHRoaXMuc3ByaXRlLmZyYW1lSW5kZXggPSB0aGlzLnN0YXJ0SW5kZXg7XG4gICAgfSxcbn0pO1xuXG5waGluYS5kZWZpbmUoXCJxZnQuRWZmZWN0RGF0YVwiLCB7XG4gICAgX3N0YXRpYzoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJleHBsb2RlX3NtYWxsXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTYsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4OiA4LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDE1LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAyNTYsIHk6IDI1Niwgd2lkdGg6IDEyOCwgaGVpZ2h0OiAzMn0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImV4cGxvZGVfc21hbGwyXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTYsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmltbWluZzoge3g6IDI1NiwgeTogMjU2LCB3aWR0aDogMTI4LCBoZWlnaHQ6IDMyfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZXhwbG9kZVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDY0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA2NCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA4LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAwLCB5OiAwLCB3aWR0aDogNTEyLCBoZWlnaHQ6IDEyOH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImV4cGxvZGVfbGFyZ2VcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiA0OCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDgsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogNyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1taW5nOiB7eDogMCwgeTogMCwgd2lkdGg6IDUxMiwgaGVpZ2h0OiAxMjh9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJleHBsb2RlX2dyb3VuZFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDMyLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0OCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiA0LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA3LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAyNTYsIHk6IDE5Miwgd2lkdGg6IDI1NiwgaGVpZ2h0OiA0OH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInNtb2tlX3NtYWxsXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTYsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmltbWluZzoge3g6IDEyOCwgeTogMTI4LCB3aWR0aDogNjQsIGhlaWdodDogMTZ9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzbW9rZVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDI0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAyNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAxMjgsIHk6IDE2MCwgd2lkdGg6IDEyMCwgaGVpZ2h0OiAyNH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInNtb2tlX2xhcmdlXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMzIsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDgsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmltbWluZzoge3g6IDI1NiwgeTogMTI4LCB3aWR0aDogMTI4LCBoZWlnaHQ6IDY0fSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiaGl0XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldE5hbWU6IFwiZWZmZWN0MlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDcyLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAzMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAwLCB5OiAwLCB3aWR0aDogNzIsIGhlaWdodDogMTI4fSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuYWR2ZW50dXJlci5qc1xuICogIDIwMTcvMDgvMDlcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v5YaS6Zm66ICFXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQWR2ZW50dXJlclwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxOTIsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMzYwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMTAwMDAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiA2LFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMyxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUxCT1gsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyNCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/mrablmajnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy53ZWFwb24gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KDEwICsgTWF0aC5taW4oOSwgdGhpcy5sZXZlbCkpXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDEsIDEpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oLTMsIDMpO1xuICAgICAgICB0aGlzLndlYXBvbi5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMud2VhcG9uLmtpbmQgPSBcInN3b3JkXCI7XG4gICAgICAgIHRoaXMud2VhcG9uLnNjYWxlWCA9IC0xO1xuICAgICAgICB0aGlzLndlYXBvbi5zY2FsZVkgPSAtMTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICBpZiAodGhpcy5ibGFjaykge1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInBsYXllcjFCbGFja1wiLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwicGxheWVyMVwiLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zcHJpdGUuc2NhbGVYID0gLTE7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hdHRhY2tJbnRlcnZhbCA9IDMwO1xuXG4gICAgICAgIC8v6KGM5YuV44OV44Kn44O844K6XG4gICAgICAgIHRoaXMucGhhc2UgPSBcIndhbmRlclwiO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuXG4gICAgICAgIC8v5b6F5qmf54q25oWLXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IFwid2FpdFwiKSB7XG4gICAgICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTV9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gXCJhcHByb2FjaFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/lvpjlvopcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJ3YW5kZXJcIikge1xuICAgICAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTV9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gXCJhcHByb2FjaFwiO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJvdW5kdHJpcEFsZ29yaXRobV9ncm91bmQoZGlzdGFuY2UsIGxvb2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozmjqXov5FcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJhcHByb2FjaFwiKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54IDwgcGxheWVyLngpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0zO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFsb29rKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IFwibG9zdFwiO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMTUwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgNTIgJiYgdGhpcy5hdHRhY2tJbnRlcnZhbCA9PSAwKSB0aGlzLnBoYXNlID0gXCJhdHRhY2tcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O86KaL5aSx44GEXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IFwibG9zdFwiKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZS0tO1xuICAgICAgICAgICAgaWYgKHRoaXMueCA8IHBsYXllci54KSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA8IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIi4uLlwifSk7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IFwid2FpdFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJhdHRhY2tcIikge1xuICAgICAgICAgICAgdGhpcy5hdHRhY2soKTtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNrSW50ZXJ2YWwgPSAzMDtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBoYXNlICE9IFwiYXR0YWNraW5nXCIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJqdW1wXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hdHRhY2tJbnRlcnZhbC0tO1xuICAgICAgICBpZiAodGhpcy5hdHRhY2tJbnRlcnZhbCA8IDApIHRoaXMuYXR0YWNrSW50ZXJ2YWwgPSAwO1xuICAgIH0sXG5cbiAgICAvL+aUu+aSg1xuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAyO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImF0dGFja1wiKTtcbiAgICAgICAgdGhpcy5waGFzZSA9IFwiYXR0YWNraW5nXCI7XG5cbiAgICAgICAgLy/mlLvmkoPliKTlrppcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgYXRrID0gcWZ0LkVuZW15QXR0YWNrKHRoaXMucGFyZW50U2NlbmUsIHt3aWR0aDogMjQsIGhlaWdodDogMjQsIHBvd2VyOiAyMCArIHRoaXMubGV2ZWwgKiA1fSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuZW5lbXlMYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDE4LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC4wKTtcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikgYXRrLnNldEFscGhhKDAuMyk7XG4gICAgICAgIGF0ay5tYXN0ZXIgPSB0aGlzO1xuICAgICAgICBhdGsudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgYXRrLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhhdC54ICsgdGhhdC5zY2FsZVggKiAxODtcbiAgICAgICAgfVxuXG4gICAgICAgIGFwcC5wbGF5U0UoXCJhdHRhY2tcIik7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDIwMCwgYWxwaGE6IDEuMH0pXG4gICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzNjB9LCA2KVxuICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IFwiYXBwcm9hY2hcIjtcbiAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/po5vjgbPpgZPlhbflvL7jgY1cbiAgICBndWFyZDogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMTMsIDE0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMzYsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbIDMsICA0LCAgNSwgIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFsgOSwgMTAsIDExLCAxMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWyAwLCAgMSwgIDIsICAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRlZmVuc2VcIl0gPSBbIDQxLCA0MiwgNDMsIDQ0LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkYW1hZ2VcIl0gPSBbIDE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZHJvcFwiXSA9IFsxOCwgMTksIDIwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRlYWRcIl0gPSBbMTgsIDE5LCAyMCwgMzMsIDM0LCAzNSwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiY2xlYXJcIl0gPSBbMjQsIDI1LCAyNl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdHVuXCJdID0gWyAxOCwgMTksIDIwXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuYXJjaGRlbW9uLmpzXG4gKiAgMjAxNy8wNS8wMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqLjg7zjgq/jg4fjg7zjg6Ljg7NcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5BcmNoRGVtb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMDAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDMwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDE4MCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDE1LFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogNTAwMCxcblxuICAgIC8v6aOb6KGM44Oi44O844OJXG4gICAgZmx5aW5nOiBmYWxzZSxcbiAgICBmbHlpbmdQaGFzZTogMCwgLy/ooYzli5Xjg5Xjgqfjg7zjgrpcbiAgICBmbHlpbmdYOiAwLCAgICAgLy/po5vooYzplovlp4vvvLjluqfmqJlcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDEwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0pFV0VMLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDIsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0pFV0VMQk9YLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMzUsIGhlaWdodDogMzB9KTtcbiAgICAgICAgaWYgKG9wdGlvbnMuc2l6ZSkge1xuICAgICAgICAgICAgdmFyIHNpemUgPSBvcHRpb25zLnNpemUgfHwgMTtcbiAgICAgICAgICAgIG9wdGlvbnMud2lkdGggPSBzaXplICogMzU7XG4gICAgICAgICAgICBvcHRpb25zLmhlaWdodCA9IHNpemUgKiAzMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMXgyXCIsIDI0KjIsIDMyKjIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjE2KjIsIDY0MCoyLCA3MioyLCAxMjgqMikuc2V0UG9zaXRpb24oMCwgLTEwKTtcbiAgICAgICAgaWYgKG9wdGlvbnMuc2l6ZSkge1xuICAgICAgICAgICAgdmFyIHNpemUgPSBvcHRpb25zLnNpemUgfHwgMTtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldFNjYWxlKHNpemUpLnNldFBvc2l0aW9uKDAsIHNpemUgKiAtMTIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCxXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/pgLLooYzmlrnlkJHmsbrlrppcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOeZuuimi+W+jOS4gOWumuaZgumWk+i/vei3oeOBmeOCi1xuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAxMjA7XG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMudnggKj0gMztcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwICYmICF0aGlzLmlzQXR0YWNrICYmIHRoaXMudHVyblRpbWUgPT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDE4MCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnR1cm5UaW1lID0gMTU7XG4gICAgICAgICAgICBpZiAobG9vaykgdGhpcy50dXJuQ291bnQgPSAwO1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgpLopovlpLHjgaPjgZ/nirbmhYvjgafkuInlm57mjK/jgorov5TjgaPjgZ/loLTlkIjjga/ov73ot6HntYLkuoZcbiAgICAgICAgICAgIGlmICh0aGlzLnR1cm5Db3VudCA+IDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+W0luOBo+OBt+OBoeOBp+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBuOOBruaUu+aSg1xuICAgICAgICAgICAgaWYgKGxvb2sgJiYgIXRoaXMuaXNBdHRhY2sgJiYgIXRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpcyA+IDEyOCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmVicmVhdGgoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGxvZGluZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAzMCkgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgIH0sXG5cbiAgICAvL+eBq+eQg+OCkuWQkOOBj1xuICAgIGZpcmViYWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlLCByb3RhdGlvbjogdGhpcy5nZXRQbGF5ZXJBbmdsZSgpLCBwb3dlcjogMzB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg0NSlcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/ngo7jgpLlkJDjgY9cbiAgICBmaXJlYnJlYXRoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSA2MDtcbiAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciByb3QgPSAodGhpcy5zY2FsZVggPT0gMSk/IDA6IDE4MDtcbiAgICAgICAgdmFyIGN0ID0gMDtcbiAgICAgICAgdmFyIHR3ID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54ICsgMjQgKiB0aGlzLnNjYWxlWCwgdGhpcy55LTgsIFwiQnVsbGV0XCIsIHt0eXBlOiBcImV4cGxvZGVcIiwgcG93ZXI6IDEwLCByb3RhdGlvbjogdGhpcy5nZXRQbGF5ZXJBbmdsZSgpLCB2ZWxvY2l0eTogNX0pO1xuICAgICAgICAgICAgICAgIGIuc2V0U2NhbGUoMC4xKTtcbiAgICAgICAgICAgICAgICBiLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKS50byh7c2NhbGVYOiAxLCBzY2FsZVk6IDF9LCAxMCk7XG4gICAgICAgICAgICAgICAgY3QrKztcbiAgICAgICAgICAgICAgICBpZiAoY3QgPT0gNiB8fCB0aGlzLmF0dGFja0NhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICB0dy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFja0NhbmNlbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg1KVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgfSxcblxuICAgIC8v54iG55m6XG4gICAgZXhwbG9kaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gNjA7XG4gICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmZhZGVJbigxNSlcbiAgICAgICAgICAgIC53YWl0KDQ1KVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciByb3QgPSAodGhpcy5zY2FsZVggPT0gMSk/IDA6IDE4MDtcbiAgICAgICAgdmFyIGN0ID0gMDtcbiAgICAgICAgdmFyIHR3ID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIHJhZCA9IHJvdC50b1JhZGlhbigpO1xuICAgICAgICAgICAgICAgIHZhciBleCA9IE1hdGguY29zKHJhZCkgKiAxNjtcbiAgICAgICAgICAgICAgICB2YXIgZXkgPSBNYXRoLnNpbihyYWQpICogMTY7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCArIGV4LCB0aGlzLnkgKyBleSwgXCJCdWxsZXRcIiwge3R5cGU6IFwiZXhwbG9kZVwiLCBwb3dlcjogMTAsIHJvdGF0aW9uOiByb3QsIHZlbG9jaXR5OiAzfSk7XG4gICAgICAgICAgICAgICAgcm90ICs9IDIyLjU7XG4gICAgICAgICAgICAgICAgY3QrKztcbiAgICAgICAgICAgICAgICBpZiAoY3QgPT0gMTYgfHwgdGhpcy5hdHRhY2tDYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdHcucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2tDYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoMSlcbiAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmFyY2hrbmlnaHQuanNcbiAqICAyMDE3LzA1LzE4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCouODvOOCr+ODiuOCpOODiFxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkFyY2hLbmlnaHRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA3MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxOTIsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiA1MDAwLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PplpPpmpRcbiAgICBhbmltYXRpb25JbnRlcnZhbDogMTAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9KRVdFTCxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAzLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9MT05HU1dPUkQsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyNSwgaGVpZ2h0OiA0MH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/mrablmajjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy53ZWFwb24gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KDEwICsgTWF0aC5taW4oOSwgdGhpcy5sZXZlbCkpXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDEsIDEpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oLTYsIDMpXG4gICAgICAgICAgICAuc2V0U2NhbGUoLTEuNSwgMS41KVxuICAgICAgICAgICAgLnNldFJvdGF0aW9uKDQzMCk7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMud2VhcG9uLmtpbmQgPSBcInN3b3JkXCI7XG4gICAgICAgIGlmIChvcHRpb25zLndlYXBvbiA9PSBcImF4XCIpIHtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldEZyYW1lSW5kZXgoMjAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5raW5kID0gXCJheFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLndlYXBvbiA9PSBcInNwZWFyXCIpIHtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldEZyYW1lSW5kZXgoMzAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5raW5kID0gXCJzcGVhclwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMngyXCIsIDI0KjIsIDMyKjIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjE2KjIsIDEyOCoyLCA3MioyLCAxMjgqMik7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldFBvc2l0aW9uKDAsIC01KTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAxMDAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembolxuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O855m66KaL5b6M5LiA5a6a5pmC6ZaT6L+96Leh44GZ44KLXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDAgJiYgIXRoaXMuaXNBdHRhY2sgJiYgdGhpcy50dXJuVGltZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHVyblRpbWUgPSAxNTtcbiAgICAgICAgICAgIGlmIChsb29rKSB0aGlzLnR1cm5Db3VudCA9IDA7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+WkseOBo+OBn+eKtuaFi+OBp+S4ieWbnuaMr+OCiui/lOOBo+OBn+WgtOWQiOOBr+i/vei3oee1guS6hlxuICAgICAgICAgICAgaWYgKHRoaXMudHVybkNvdW50ID4gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/kuIDlrprot53pm6Lku6XkuIrpm6LjgozjgZ/jgonov73ot6Hop6PpmaRcbiAgICAgICAgaWYgKGRpcyA+IDUxMikgdGhpcy5jaGFzZVRpbWUgPSAwO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMC41O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTAuNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmlzSnVtcCkgdGhpcy52eCAqPSAyO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMTIwO1xuICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMCkgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkgdGhpcy52eCAqPSAzO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/jgZPjgozku6XkuIrpgLLjgoHjgarjgYTloLTlkIjjga/mipjjgorov5TjgZlcbiAgICAgICAgICAgIHZhciBpc1JldHVybldhbGwgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBpc1JldHVybkNsaWZmID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkgaXNSZXR1cm5XYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSs0MCwgNSwgNSkgPT0gbnVsbCkgaXNSZXR1cm5DbGlmZiA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudnggPCAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCB8fCBpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOi/vei3oeS4reOBp+auteW3ruOBjOOBguOCi+WgtOWQiOOBr+mjm+OBs+i2iuOBiOOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5XYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafltJbjgYzjgYLjgovloLTlkIjjga/nnYDlnLDngrnjgYzjgYLjgovjgYvoqr/jgbnjgabpo5vjgbPpmY3jgorjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuQ2xpZmYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqdW1wT2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDk2KSkganVtcE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDk2KSkganVtcE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdW1wT2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC01O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+edgOWcsOeCueOBjOeEoeOBhOWgtOWQiOOBr+irpuOCgeOBpuaKmOOCiui/lOOBmVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50dXJuV2FpdCA9IDE1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiLi4uXCJ9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggKj0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA2NCAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86aOb44Gz6YGT5YW344KS5by+44GPXG4gICAgICAgICAgICBpZiAobG9vayAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCt+ODp+ODg+ODiOOBqOOBrui3nembouWIpOWumlxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uICYmIGUudHlwZSA9PSBcImFycm93XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmdldERpc3RhbmNlKGUpIDwgNjQpIHRoYXQuZ3VhcmQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDMwKSB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHdpZHRoID0gMjQsIGhlaWdodCA9IDI0O1xuICAgICAgICB2YXIgYXRrID0gcWZ0LkVuZW15QXR0YWNrKHRoaXMucGFyZW50U2NlbmUsIHt3aWR0aDogMjQsIGhlaWdodDogNDgsIHBvd2VyOiAyMCArIHRoaXMubGV2ZWwgKiA1fSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuZW5lbXlMYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDE4LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC4wKTtcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikgYXRrLnNldEFscGhhKDAuMyk7XG4gICAgICAgIGF0ay5tYXN0ZXIgPSB0aGlzO1xuICAgICAgICBhdGsudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgYXRrLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhhdC54ICsgdGhhdC5zY2FsZVggKiAxODtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLndlYXBvbi5raW5kID09IFwic3dvcmRcIiB8fCB0aGlzLndlYXBvbi5raW5kID09IFwiYXhcIikge1xuICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAyNzB9LCAyKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBhdGsuaXNBY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzU3VwZXJBcm1vciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudnggPSAxNiAqIHRoYXQuc2NhbGVYO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogNDMwfSwgNilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzU3VwZXJBcm1vciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy53ZWFwb24ua2luZCA9PSBcInNwZWFyXCIpIHtcbiAgICAgICAgICAgIGF0ay53aWR0aCA9IDMyO1xuICAgICAgICAgICAgYXRrLmhlaWdodCA9IDg7XG4gICAgICAgICAgICBhdGsuc2V0UG9zaXRpb24odGhpcy54ICsgdGhpcy5zY2FsZVggKiAxLCB0aGlzLnkpO1xuICAgICAgICAgICAgYXRrLnR3ZWVuZXIuY2xlYXIoKS5ieSh7eDogMjAgKiB0aGlzLnNjYWxlWH0sIDEwKS5ieSh7eDogLTIwICogdGhpcy5zY2FsZVh9LCAxMCk7XG4gICAgICAgICAgICBhdGsuaXNBY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQ1LCB4OiAtMjB9KVxuICAgICAgICAgICAgICAgIC53YWl0KDYpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0ay5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNTdXBlckFybW9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52eCA9IDMyICogdGhhdC5zY2FsZVg7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYnkoe3g6IDIwfSwgMylcbiAgICAgICAgICAgICAgICAuYnkoe3g6IC0zMH0sIDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc1N1cGVyQXJtb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYXRrLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQzMCwgeDogLTJ9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgIH0sXG5cbiAgICAvL+mjm+OBs+mBk+WFt+W8vuOBjVxuICAgIGd1YXJkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgd2lkdGggPSAyNCwgaGVpZ2h0ID0gMjQ7XG4gICAgICAgIHZhciBhdGsgPSBxZnQuRW5lbXlBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAyNCwgaGVpZ2h0OiA0OCwgcG93ZXI6IDIwICsgdGhpcy5sZXZlbCAqIDV9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5lbmVteUxheWVyKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCArIHRoaXMuc2NhbGVYICogMTgsIHRoaXMueSlcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjApO1xuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSBhdGsuc2V0QWxwaGEoMC4zKTtcbiAgICAgICAgYXRrLm1hc3RlciA9IHRoaXM7XG4gICAgICAgIGF0ay50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICBhdGsudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGF0LnggKyB0aGF0LnNjYWxlWCAqIDE4O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pc011dGVraSA9IHRydWU7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQzMH0pXG4gICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzMDB9LCAzKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhhdC52eCA9IDQgKiB0aGF0LnNjYWxlWDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudG8oe3JvdGF0aW9uOiA0MzB9LCAzKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoYXQuaXNNdXRla2kgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSBNYXRoLm1pbigwLCA2IC0gdGhpcy5sZXZlbCk7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ0dXJuXCJdID0gWzYsIFwid2Fsa1wiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5hcmNobWFnZS5qc1xuICogIDIwMTcvMDUvMDFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Ki44O844Kv44Oh44Kk44K4XG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQXJjaE1hZ2VcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA1MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAyNTYsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMzYwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogODAwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMzAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIGx2ID0gTWF0aC5taW4odGhpcy5sZXZlbCwgMyk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDNcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKChsdiAlIDIpICogMTQ0ICsgNzIsIE1hdGguZmxvb3IobHYgLyAyKSAqIDEyOCwgNzIsIDEyOCk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMjtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMzAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLnNwZWVkID0gMTtcbiAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcblxuICAgICAgICAvL+aOpei/keaIpue1jOmBjuaZgumWk1xuICAgICAgICB0aGlzLm5lYXJDb3VudCA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuICAgICAgICB2YXIgZGlzdGFuY2UgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG5cbiAgICAgICAgLy/jgZPjgozku6XkuIrpgLLjgoHjgarjgYTloLTlkIjjga/mipjjgorov5TjgZlcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OG44Oq44OI44Oq44O85oyH5a6aXG4gICAgICAgIGlmICh0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgLy/msLTlubPmlrnlkJHjga7jgb/jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIHZhciB0eCA9IHRoaXMueCAtIHRoaXMuZmlyc3RYO1xuICAgICAgICAgICAgaWYgKE1hdGguYWJzKHR4KSA+IHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/pgJrluLjjg5Xjgqfjg7zjgrrjgafjg5fjg6zjgqTjg6Tjg7zjgpLnmbropovjgZfjgZ/jgonorabmiJLjg5Xjgqfjg7zjgrrjgavnp7vjgotcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMCAmJiBsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgICAgICB0aGlzLnBoYXNlID0gMTtcbiAgICAgICAgICAgIHRoaXMuc3BlZWQgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzpm6LjgozjgZ/jgonpgJrluLjjg5Xjgqfjg7zjgrpcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgIT0gMCkge1xuICAgICAgICAgICAgaWYgKGRpc3RhbmNlID4gMTkyIHx8ICFsb29rKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRhZ2dlci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhZ2dlcltpXS5waGFzZSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/pgJrluLhcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy52eCA9IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbGF5ZXIueCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+itpuaIklxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5iYWxsb29uID09IG51bGwpIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIuLi5cIiwgYW5pbWF0aW9uSW50ZXJ2YWwgOiAxNX0pO1xuICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgMTkyKSB0aGlzLnBoYXNlID0gMjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5pS75pKDXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDIpIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRhZ2dlci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGFnZ2VyW2ldLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDkyKSB0aGlzLnBoYXNlID0gMztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAzKSB7XG4gICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5kYWdnZXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhZ2dlcltpXS5waGFzZSA9IDEwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDQgJiYgdGhpcy50aW1lICUgOTAgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMikge1xuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIkJ1bGxldFwiLCB7ZXhwbG9kZTogdHJ1ZX0pO1xuICAgICAgICAgICAgICAgIGIucm90YXRpb24gPSB0aGlzLmdldFBsYXllckFuZ2xlKCkgKyBNYXRoLnJhbmRpbnQoLTMwLCAzMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5waGFzZSA9PSA0KSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlfSk7XG4gICAgICAgICAgICAgICAgICAgIGIucm90YXRpb24gPSB0aGlzLmdldFBsYXllckFuZ2xlKCkgKyBNYXRoLnJhbmRpbnQoLTYwLCA2MCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRpc3RhbmNlIDwgOTYpIHtcbiAgICAgICAgICAgIHRoaXMubmVhckNvdW50Kys7XG4gICAgICAgICAgICBpZiAodGhpcy5uZWFyQ291bnQgPiA5MCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGVsZXBvcnQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5lYXJDb3VudCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm5lYXJDb3VudCAtPSAxMDtcbiAgICAgICAgICAgIGlmICh0aGlzLm5lYXJDb3VudCA8IDApIHRoaXMubmVhckNvdW50ID0gMDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODhuODrOODneODvOODiFxuICAgIHRlbGVwb3J0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRhZ2dlci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5kYWdnZXJbaV0ucGhhc2UgPSAxMDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzAsIDEsIDIsIDFdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZmlyc3RGcmFtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44Oe44K444OD44Kv44OA44Ks44O86KOF5YKZXG4gICAgICAgIHRoaXMuZGFnZ2VyID0gW107XG4gICAgICAgIHRoaXMuZGFnZ2VyWzBdID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIk1hZ2ljRGFnZ2VyXCIsIHtwYXJlbnQ6IHRoaXMsIG9mZnNldFg6ICAxNiwgb2Zmc2V0WTogLTE2LCBvcmRlcjogMCwgbGV2ZWw6IHRoaXMubGV2ZWx9KTtcbiAgICAgICAgdGhpcy5kYWdnZXJbMV0gPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiTWFnaWNEYWdnZXJcIiwge3BhcmVudDogdGhpcywgb2Zmc2V0WDogLTE2LCBvZmZzZXRZOiAtMTYsIG9yZGVyOiAxLCBsZXZlbDogdGhpcy5sZXZlbH0pO1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDIpIHRoaXMuZGFnZ2VyWzJdID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIk1hZ2ljRGFnZ2VyXCIsIHtwYXJlbnQ6IHRoaXMsIG9mZnNldFg6IC0zMiwgb2Zmc2V0WTogLTgsIG9yZGVyOiAyLCBsZXZlbDogdGhpcy5sZXZlbH0pO1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDMpIHRoaXMuZGFnZ2VyWzNdID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIk1hZ2ljRGFnZ2VyXCIsIHtwYXJlbnQ6IHRoaXMsIG9mZnNldFg6ICAzMiwgb2Zmc2V0WTogLTgsIG9yZGVyOiAzLCBsZXZlbDogdGhpcy5sZXZlbH0pO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuYmFieWRlbW9uLmpzXG4gKiAgMjAxNy8wMS8xM1xuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jg5njg5Pjg7zjg4fjg7zjg6Ljg7NcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5CYWJ5RGVtb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA0MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiA1MDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiA1LFxuICAgIGRyb3BJdGVtOiBJVEVNX0pFV0VMLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDIsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0pFV0VMQk9YLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjAsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDAsIDAsIDcyLCAxMjgpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDI7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDEwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembolxuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/msY7nlKjov73ot6HjgqLjg6vjgrTjg6rjgrrjg6BcbiAgICAgICAgdGhpcy5jaGFzZUFsZ29yaXRobShkaXMsIGxvb2spO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6L+R44GP44Gr44GE44Gf44KJ5pS75pKDXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciAmJiBsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA2NCkge1xuICAgICAgICAgICAgLy/po5vjgbPjgYvjgYvjgotcbiAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMudnkgPSAtNjtcbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsb29rIHx8IHRoaXMuY2hhc2VUaW1lID4gMCkge1xuICAgICAgICAgICAgdGhpcy52eCAqPSA0O1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuYmlyZC5qc1xuICogIDIwMTYvMTIvMzFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v6bOlXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQmlyZFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDMwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA2MCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAyMDAsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZUFycm93OiA1LFxuXG4gICAgZGVmYXVsdE9wdGlvbnM6IHtcbiAgICAgICAgc3BlZWQ6IDIsXG4gICAgICAgIGRpcmVjdGlvbjogMCxcbiAgICAgICAgcmV0dXJuVGltZTogMTIwLFxuICAgIH0sXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE4fSk7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zLiRzYWZlKHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIGNhcExldmVsID0gTWF0aC5taW4odGhpcy5sZXZlbCwgNCk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDFcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKGNhcExldmVsICogNzIsIDAsIDcyLCAxMjgpLnNldFNjYWxlKDEgKyBjYXBMZXZlbCAqIDAuMSk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDY7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmlzVmVydGljYWwgPSB0aGlzLm9wdGlvbnMudmVydGljYWwgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gdGhpcy5vcHRpb25zLmRpcmVjdGlvbiB8fCB0aGlzLmlzVmVydGljYWw/IDkwOiAwO1xuICAgICAgICB0aGlzLnNwZWVkID0gdGhpcy5vcHRpb25zLnNwZWVkIHx8IDI7XG4gICAgICAgIHRoaXMucmV0dXJuVGltZSA9IHRoaXMub3B0aW9ucy5yZXR1cm5UaW1lIHx8IDEyMDtcbiAgICAgICAgdGhpcy5ib21iSW50ZXJ2YWwgPSB0aGlzLm9wdGlvbnMuYm9tYkludGVydmFsIHx8IDkwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHJldHVybjtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODgeOCp+ODg+OCr+OBmeOCi+WjgeaxuuWumlxuICAgICAgICB2YXIgY2hrID0gMDtcbiAgICAgICAgaWYgKCF0aGlzLmlzVmVydGljYWwpIGNoayA9IDE7XG5cbiAgICAgICAgLy/lo4HjgavlvZPjgZ/jgovjgYvkuIDlrprmmYLplpPntYzpgY7jgafmipjjgorov5TjgZdcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvbltjaGtdLmhpdCB8fCB0aGlzLl9jb2xsaXNpb25bY2hrKzJdLmhpdCB8fCB0aGlzLnJldHVyblRpbWUgPCAwKSB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICB0aGlzLnJldHVyblRpbWUgPSB0aGlzLm9wdGlvbnMucmV0dXJuVGltZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844KS44G/44Gk44GR44Gf44KJ5Yqg6YCfXG4gICAgICAgIGlmICh0aGlzLmlzTG9va1BsYXllcigpKSB7XG4gICAgICAgICAgICB0aGlzLnNwZWVkID0gNDtcbiAgICAgICAgICAgIHRoaXMucmV0dXJuVGltZSAtPSAyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zcGVlZCA9IDI7XG4gICAgICAgICAgICB0aGlzLnJldHVyblRpbWUtLTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v56e75YuVXG4gICAgICAgIHZhciByYWQgPSB0aGlzLmRpcmVjdGlvbi50b1JhZGlhbigpO1xuICAgICAgICB0aGlzLnZ4ID0gTWF0aC5jb3MocmFkKSAqIHRoaXMuc3BlZWQ7XG4gICAgICAgIHRoaXMudnkgPSBNYXRoLnNpbihyYWQpICogdGhpcy5zcGVlZDtcblxuICAgICAgICAvL+iQveOBl+eJqVxuICAgICAgICBpZiAodGhpcy5vblNjcmVlbiAmJiB0aGlzLnRpbWUgJSB0aGlzLmJvbWJJbnRlcnZhbCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQmlyZEJvbWJcIiwge30pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/lkJHjgY3jga7mjIflrppcbiAgICAgICAgaWYgKHRoaXMudnggIT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwgJiYgdGhpcy5nZXREaXN0YW5jZVBsYXllcigpIDwgMjU2KSB7XG4gICAgICAgICAgICBpZiAodGhpcy54IDwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCkgdGhpcy5zY2FsZVggPSAxOyBlbHNlIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG5cbi8v6bOl44Gu6JC944GX54mpXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQmlyZEJvbWJcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiA1LFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogNSwgaGVpZ2h0OiA1fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYnVsbGV0XCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDcyKTtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDY7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikgdGhpcy5yZW1vdmUoKTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJub3JtYWxcIl0gPSBbNzIsIDczLCA3NCwgNzNdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5idWxsZXQuanNcbiAqICAyMDE3LzAxLzEzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQnVsbGV0XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMSxcblxuICAgIC8v5a+/5ZG9XG4gICAgbGlmZXNwYW46IDc1LFxuXG4gICAgLy/pgJ/luqZcbiAgICB2ZWxvY2l0eTogMixcblxuICAgIC8v5Yqg6YCf5bqmXG4gICAgYWNjZWw6IDEuMDIsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAxLjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAwLFxuXG4gICAgLy/niIbnmbrjg5Xjg6njgrBcbiAgICBleHBsb2RlOiBmYWxzZSxcblxuICAgIC8v5b2x6KGo56S644OV44Op44KwXG4gICAgaXNTaGFkb3c6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjAsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTtcbiAgICAgICAgdGhpcy5wb3dlciA9IG9wdGlvbnMucG93ZXIgfHwgdGhpcy5wb3dlcjtcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IG9wdGlvbnMucm90YXRpb24gfHwgMDtcbiAgICAgICAgdGhpcy52ZWxvY2l0eSA9IG9wdGlvbnMudmVsb2NpdHkgfHwgdGhpcy52ZWxvY2l0eTtcbiAgICAgICAgdGhpcy5saWZlU3BhbiA9IG9wdGlvbnMubGlmZVNwYW4gfHwgdGhpcy5saWZlU3BhbjtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcImV4cGxvZGVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZWZmZWN0XCIsIDQ4LCA0OCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZVRyaW1taW5nKDAsIDE5MiwgMTkyLCA5Nik7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgICAgICAgICAgICAgdGhpcy5leHBsb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5pZ25vcmVDb2xsaXNpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNNdXRla2kgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0dGVybiA9IFwiZXhwbG9kZVwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYnVsbGV0XCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDkpO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgICAgICAgICAgICAgIHRoaXMuZXhwbG9kZSA9IG9wdGlvbnMuZXhwbG9kZSB8fCB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0dGVybiA9IG9wdGlvbnMucGF0dGVybiB8fCBcInBhdHRlcm4xXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbih0aGlzLnBhdHRlcm4pO1xuXG4gICAgICAgIHRoaXMub24oJ2RlYWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmV4cGxvZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRWZmZWN0KHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiYm9tYlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciByYWQgPSB0aGlzLnJvdGF0aW9uLnRvUmFkaWFuKCk7XG4gICAgICAgIHRoaXMudnggPSBNYXRoLmNvcyhyYWQpICogdGhpcy52ZWxvY2l0eTtcbiAgICAgICAgdGhpcy52eSA9IE1hdGguc2luKHJhZCkgKiB0aGlzLnZlbG9jaXR5O1xuICAgICAgICB0aGlzLnZlbG9jaXR5ICo9IHRoaXMuYWNjZWw7XG4gICAgICAgIGlmICh0aGlzLnZ4ID4gMSkgdGhpcy5zcHJpdGUuc2NhbGVYID0gMTsgZWxzZSB0aGlzLnNwcml0ZS5zY2FsZVggPSAtMTtcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IHRoaXMubGlmZXNwYW4pIHRoaXMucmVtb3ZlKCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmlnbm9yZUNvbGxpc2lvbikge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblswXS5oaXQgfHxcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMV0uaGl0IHx8XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzJdLmhpdCB8fFxuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHRoaXMuZmxhcmUoJ2RlYWQnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInBhdHRlcm4xXCJdID0gWzksIDEwLCAxMSwgMTBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjJcIl0gPSBbMTUsIDE2LCAxNywgMTZdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZXhwbG9kZVwiXSA9IFswLCAxLCAyLCAzLCA0LCA1LCA2LCA3LCBcInJlbW92ZVwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGhpdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT0gXCJleHBsb2RlXCIpIHJldHVybjtcblxuICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLmZsYXJlKCdkZWFkJyk7XG4gICAgfSxcblxuICAgIGRyb3BEZWFkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzRHJvcCA9IHRydWU7XG4gICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICB0aGlzLnZ5ID0gLTEwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmRlYXRoLmpzXG4gKiAgMjAxNi8xMi8zMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/mrbvnpZ5cbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5EZWF0aFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDMwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAyMCxcblxuICAgIC8v5rCX57W256K6546HXG4gICAgc3R1blBvd2VyOiAzMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDEyOCxcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAxODAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v44OO44OD44Kv44OQ44OD44Kv44Kt44Oj44Oz44K744OrXG4gICAgaXNTdXBlckFybW9yOiB0cnVlLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogNTAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fU1RPTkUsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogNSxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fU1RPTkUsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZUZpcmU6IDIuMCxcbiAgICBkYW1hZ2VJY2U6IDAuOCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAyXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygwLCAxMjgsIDcyLCAxMjgpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDE7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDEwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm1vdmVcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgICAgICB0aGlzLnNwZWVkID0gMTtcblxuICAgICAgICAvL+ihjOWLleODkeOCv+ODvOODs1xuICAgICAgICB0aGlzLnBhdHRlcm4gPSBvcHRpb25zLnBhdHRlcm4gfHwgXCJsaW5lYXJcIjtcbiAgICAgICAgdGhpcy5tb3ZlTGVuZ3RoID0gb3B0aW9ucy5sZW5ndGggfHwgNDg7XG4gICAgICAgIHRoaXMuZGVncmVlID0gMDtcbiAgICAgICAgdGhpcy5pc1ZlcnRpY2FsID0gZmFsc2U7XG5cbiAgICAgICAgLy/ooqvjg4Djg6Hjg7zjgrjmmYLlh6bnkIZcbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudHdlZW5lcjIgPSBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMpO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIHZhciByYWQgPSB0aGlzLmRlZ3JlZS50b1JhZGlhbigpO1xuICAgICAgICBpZiAodGhpcy5wYXR0ZXJuID09IFwibGluZWFyXCIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gTWF0aC5jb3MocmFkKSAqIDI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSBNYXRoLmNvcyhyYWQpICogMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRlZ3JlZSArPSAyO1xuXG4gICAgICAgIC8v5b6Y5b6K44Oi44O844OJ44Gu5aC05ZCI44Gv6YGp5b2T44Gr5pS75pKDXG4gICAgICAgIGlmICh0aGlzLnRpbWUgJSA5MCA9PSAwKSB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcblxuICAgICAgICAvL+aUu+aSg1xuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiRGVhdGhGbGFtZVwiLCB7cGF0dGVybjogMH0pO1xuICAgICAgICAgICAgYi52eSA9IC0yO1xuICAgICAgICAgICAgYi52eCA9IDIgKiB0aGlzLnNjYWxlWDtcbiAgICAgICAgICAgIHRoaXMuYWN0aW9uV2FpdCA9IDEyMDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm1vdmVcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9IFs2LCA3LCA2LCA4XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSAgIFswLCAxLCAwLCAyXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuXG4vL+eCjlxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkRlYXRoRmxhbWVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjEsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAwLjk4LFxuXG4gICAgLy/msJfntbbnorrnjodcbiAgICBzdHVuUG93ZXI6IDIwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IGZhbHNlLFxuXG4gICAgLy/nhKHmlbXjg5Xjg6njgrBcbiAgICBpc011dGVraTogdHJ1ZSxcblxuICAgIC8v5pS75pKD5b2T44Gf44KK5Yik5a6a5pyJ5Yq544OV44Op44KwXG4gICAgaXNBdHRhY2tDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+Wvv+WRvVxuICAgIGxpZmVTcGFuOiAxMjAsXG5cbiAgICAvL+W9seihqOekuuODleODqeOCsFxuICAgIGlzU2hhZG93OiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDIwfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLnBhdHRlcm4gPSBvcHRpb25zLnBhdHRlcm4gfHwgMDtcbiAgICAgICAgdGhpcy5saWZlU3BhbiA9IG9wdGlvbnMubGlmZVNwYW4gfHwgMTIwO1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuXG4gICAgICAgIHRoaXMuc2V0dXBBbmltYXRpb24odGhpcy5wYXR0ZXJuKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZmxhbWUwM1wiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgMTQ0LCAxMjgpLnNldEZyYW1lSW5kZXgoMTUgKyB0aGlzLnBhdHRlcm4pO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwiYXBwZWFyXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmxpZmVTcGFuID09IDApIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIGlmICh0aGlzLmxpZmVTcGFuIDwgMzApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAyID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDYwKXtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSA1ID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDkwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMTAgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpZmVTcGFuLS07XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICBpbmRleCA9IGluZGV4IHx8IDA7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImFwcGVhclwiXSA9IFsxNStpbmRleCwgOStpbmRleCwgIDMraW5kZXgsIDIxK2luZGV4LCBcIm5vcm1hbFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm5vcm1hbFwiXSA9IFsgMCtpbmRleCwgNitpbmRleCwgMTIraW5kZXgsIDE4K2luZGV4XTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGRyb3BEZWFkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzRHJvcCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuZGVtb24uanNcbiAqICAyMDE3LzAxLzEzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+ODh+ODvOODouODs1xucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkRlbW9uXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMTAwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAzMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDE5MixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA5MCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDUwMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDUsXG4gICAgZHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUxCT1gsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyMCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoTWF0aC5taW4odGhpcy5sZXZlbCwgNCkgKiA3MiwgNjQwLCA3MiwgMTI4KVxuICAgICAgICAgICAgLnNldFNjYWxlKDEuNSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAtOCk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogMTA7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDM7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDMwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgMTYpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgMTYpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOi/keOBj+OBq+OBhOOBn+OCieaUu+aSg1xuICAgICAgICAgICAgaWYgKGxvb2sgJiYgIXRoaXMuaXNKdW1wICYmICF0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpcyA+IDk2KSB7XG4gICAgICAgICAgICAgICAgICAgIC8v54Gr44KS5ZCQ44GPXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZWJhbGwoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL+mjm+OBs+OBi+OBi+OCi1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy52eCAqPSAzO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGRpcyA8IDI1Nikge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/ngavnkIPjgpLlkJDjgY9cbiAgICBmaXJlYmFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcykuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlLCBwb3dlcjogMTAgKyB0aGlzLmxldmVsICogNSwgcm90YXRpb246IHRoaXMuZ2V0UGxheWVyQW5nbGUoKX0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHR3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+eBq+OCkuWQkOOBj1xuICAgIGZsYW1pbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDYwO1xuICAgICAgICB0aGlzLnNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWRlT3V0KDE1KTtcblxuICAgICAgICB2YXIgcm90ID0gKHRoaXMuc2NhbGVYID09IDEpPyAwOiAxODA7XG4gICAgICAgIHZhciBjdCA9IDA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCArIDI0ICogdGhpcy5zY2FsZVgsIHRoaXMueS04LCBcIkJ1bGxldFwiLCB7dHlwZTogXCJleHBsb2RlXCIsIHBvd2VyOiAxMCwgcm90YXRpb246IHRoaXMuZ2V0UGxheWVyQW5nbGUoKSwgdmVsb2NpdHk6IDV9KTtcbiAgICAgICAgICAgICAgICBiLnNldFNjYWxlKDAuMSk7XG4gICAgICAgICAgICAgICAgYi50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJykudG8oe3NjYWxlWDogMSwgc2NhbGVZOiAxfSwgMTApO1xuICAgICAgICAgICAgICAgIGN0Kys7XG4gICAgICAgICAgICAgICAgaWYgKGN0ID09IDYgfHwgdGhpcy5hdHRhY2tDYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdHcucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2tDYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoNSlcbiAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmRldmlsLmpzXG4gKiAgMjAxNy8wNC8yNVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/mgqrprZRcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5EZXZpbFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDMwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/mqKrnp7vli5XmuJvoobDnjodcbiAgICBmcmljdGlvbjogMC4wLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAzNjAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDgwMCxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlQXJyb3c6IDUsXG5cbiAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgICBzcGVlZDogMixcbiAgICAgICAgZGlyZWN0aW9uOiAwLFxuICAgICAgICByZXR1cm5UaW1lOiAxMjAsXG4gICAgfSxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDEwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9TVE9ORSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE4fSkuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAyXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyg3MiwgMCwgNzIsIDEyOCk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogMTA7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDEwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0YW5kXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuaXNWZXJ0aWNhbCA9IHRoaXMub3B0aW9ucy52ZXJ0aWNhbCB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSB0aGlzLm9wdGlvbnMuZGlyZWN0aW9uIHx8IHRoaXMuaXNWZXJ0aWNhbD8gOTA6IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSB0aGlzLm9wdGlvbnMuc3BlZWQgfHwgMjtcbiAgICAgICAgdGhpcy5yZXR1cm5UaW1lID0gdGhpcy5vcHRpb25zLnJldHVyblRpbWUgfHwgMTIwO1xuICAgICAgICB0aGlzLmF0dGFja0ludGVydmFsID0gdGhpcy5vcHRpb25zLmF0dGFja0ludGVydmFsIHx8IDkwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaDheWgsVxuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6L+R44GP44Gr44GE44Gf44KJ5a+E44Gj44Gm44GE44GPXG4gICAgICAgIGlmIChsb29rICYmIGRpcyA+IDMyKSB7XG4gICAgICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICAgICAgdmFyIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHBsLngsIHBsLnkpO1xuICAgICAgICAgICAgdmFyIHAgPSBwMi5zdWIocDEpO1xuICAgICAgICAgICAgcC5ub3JtYWxpemUoKTtcbiAgICAgICAgICAgIHRoaXMudnggPSBwLnggKiAoMSArIHRoaXMubGV2ZWwgKiAwLjIpO1xuICAgICAgICAgICAgdGhpcy52eSA9IHAueSAqICgxICsgdGhpcy5sZXZlbCAqIDAuMik7XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Gu5pa55ZCR44KS5ZCR44GPXG4gICAgICAgICAgICB2YXIgYW5nbGUgPSB0aGlzLmdldFBsYXllckFuZ2xlKCk7XG4gICAgICAgICAgICBpZiAoYW5nbGUgPiAzMTUgfHwgYW5nbGUgPCA0NSkgdGhpcy5zZXRBbmltYXRpb24oJ2hvcml6b24nKTtcbiAgICAgICAgICAgIGlmICggNDUgPCBhbmdsZSAmJiBhbmdsZSA8IDEzNSkgdGhpcy5zZXRBbmltYXRpb24oJ2Rvd24nKTtcbiAgICAgICAgICAgIGlmICgxMzUgPCBhbmdsZSAmJiBhbmdsZSA8IDIyNSkgdGhpcy5zZXRBbmltYXRpb24oJ2hvcml6b24nKTtcbiAgICAgICAgICAgIGlmICgyMjUgPCBhbmdsZSAmJiBhbmdsZSA8IDMxNSkgdGhpcy5zZXRBbmltYXRpb24oJ2Rvd24nKTtcblxuICAgICAgICAgICAgLy/kuIDlrprku6XkuIrov5HjgaXjgYTjgZ/jgonmlLvmkoNcbiAgICAgICAgICAgIGlmIChkaXMgPCA5NikgdGhpcy5pc0F0dGFjayA9IHRydWU7XG5cbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0YW5kXCIpO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgdGhpcy5hdHRhY2soKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhdHRhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIkJ1bGxldFwiLCB7ZXhwbG9kZTogdHJ1ZSwgcG93ZXI6IDEwICsgdGhpcy5sZXZlbCAqIDUsIHJvdGF0aW9uOiB0aGlzLmdldFBsYXllckFuZ2xlKCl9KTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFs2LCA3LCA4LCA3XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gWzAsIDEsIDIsIDFdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFs1LCA2LCA3LCA2XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImhvcml6b25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuZXhwbG9kZS5qc1xuICogIDIwMTcvMDcvMDFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5FeHBsb2RlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMSxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAuOTgsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAwLFxuXG4gICAgLy/nhKHmlbXjg5Xjg6njgrBcbiAgICBpc011dGVraTogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDIwLCBoZWlnaHQ6IDIwfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZWZmZWN0XCIsIDQ4LCA0OClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0RnJhbWVUcmltbWluZygwLCAxOTIsIDE5MiwgOTYpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcblxuICAgICAgICB0aGlzLnBvd2VyID0gb3B0aW9ucy5wb3dlciB8fCB0aGlzLnBvd2VyO1xuXG4gICAgICAgIHRoaXMucGF0dGVybiA9IG9wdGlvbnMucGF0dGVybiB8fCBcInBhdHRlcm4xXCI7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKHRoaXMucGF0dGVybik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5pbmRleCA9PSA4KSB0aGlzLnJlbW92ZSgpO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInBhdHRlcm4xXCJdID0gWzAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5maXJlYmlyZC5qc1xuICogIDIwMTYvMDMvMDlcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v6bOlXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuRmlyZUJpcmRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA1MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAyNTYsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMzAwLFxuXG4gICAgLy/lsZ7mgKfjg4Djg6Hjg7zjgrjlgI3njodcbiAgICBkYW1hZ2VBcnJvdzogNSxcbiAgICBkYW1hZ2VGaXJlOiAwLjUsXG4gICAgZGFtYWdlSWNlOiAyLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAzLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgICBzcGVlZDogMixcbiAgICAgICAgZGlyZWN0aW9uOiAwLFxuICAgICAgICByZXR1cm5UaW1lOiAxMjAsXG4gICAgfSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2LCBvZmZzZXRDb2xsaXNpb25YOiAtNn0pO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucy4kc2FmZSh0aGlzLmRlZmF1bHRPcHRpb25zKTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjg4LCAwLCA3MiwgMTI4KTtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5pc1ZlcnRpY2FsID0gdGhpcy5vcHRpb25zLnZlcnRpY2FsIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMub3B0aW9ucy5kaXJlY3Rpb24gfHwgdGhpcy5pc1ZlcnRpY2FsPyA5MDogMDtcbiAgICAgICAgdGhpcy5zcGVlZCA9IHRoaXMub3B0aW9ucy5zcGVlZCB8fCAyO1xuICAgICAgICB0aGlzLnJldHVyblRpbWUgPSB0aGlzLm9wdGlvbnMucmV0dXJuVGltZSB8fCAxMjA7XG4gICAgICAgIHRoaXMuYm9tYkludGVydmFsID0gdGhpcy5vcHRpb25zLmJvbWJJbnRlcnZhbCB8fCA5MDtcbiAgICAgICAgdGhpcy5hdHRhY2tJbnRlcnZhbCA9IDA7XG4gICAgICAgIHRoaXMuYXR0YWNrQ291bnQgPSA5OTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHJldHVybjtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm9uKCdkZWFkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRWZmZWN0KHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJib21iXCIpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg4Hjgqfjg4Pjgq/jgZnjgovlo4HmsbrlrppcbiAgICAgICAgdmFyIGNoayA9IDE7XG4gICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIGNoayA9IDA7XG5cbiAgICAgICAgLy/lo4HjgavlvZPjgZ/jgovjgYvkuIDlrprmmYLplpPntYzpgY7jgafmipjjgorov5TjgZdcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvbltjaGtdLmhpdCB8fCB0aGlzLl9jb2xsaXNpb25bY2hrKzJdLmhpdCB8fCB0aGlzLnJldHVyblRpbWUgPCAwKSB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICB0aGlzLnJldHVyblRpbWUgPSB0aGlzLm9wdGlvbnMucmV0dXJuVGltZTtcbiAgICAgICAgfVxuICAgICAgICAvL+enu+WLlVxuICAgICAgICB2YXIgcmFkID0gdGhpcy5kaXJlY3Rpb24udG9SYWRpYW4oKTtcbiAgICAgICAgdGhpcy52eCA9IE1hdGguY29zKHJhZCkgKiB0aGlzLnNwZWVkO1xuICAgICAgICB0aGlzLnZ5ID0gTWF0aC5zaW4ocmFkKSAqIHRoaXMuc3BlZWQ7XG4gICAgICAgIHRoaXMucmV0dXJuVGltZS0tO1xuIFxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+OBpOOBkeOBn+OCieaUu+aSg1xuICAgICAgICB2YXIgbG9va1BsYXllciA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG4gICAgICAgIGlmIChsb29rUGxheWVyKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hdHRhY2tJbnRlcnZhbCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnkrNiwgXCJCdWxsZXRcIiwge3BhdHRlcm46IFwicGF0dGVybjJcIiwgZXhwbG9kZTogdHJ1ZSwgdmVsb2NpdHk6IDN9KTtcbiAgICAgICAgICAgICAgICBiLnJvdGF0aW9uID0gdGhpcy5nZXRQbGF5ZXJBbmdsZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrSW50ZXJ2YWwgPSA5MDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFja0ludGVydmFsID0gNjA7XG4gICAgICAgIH1cblxuICAgICAgICAvL+iQveOBl+eJqVxuICAgICAgICBpZiAodGhpcy5vblNjcmVlbiAmJiB0aGlzLnRpbWUgJSB0aGlzLmJvbWJJbnRlcnZhbCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiRmlyZUJpcmRCb21iXCIsIHt9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5ZCR44GN44Gu5oyH5a6aXG4gICAgICAgIGlmICh0aGlzLnZ4ICE9IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4ID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc1ZlcnRpY2FsICYmIHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKSA8IDI1Nikge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA8IHRoaXMucGFyZW50U2NlbmUucGxheWVyLngpIHRoaXMuc2NhbGVYID0gMTsgZWxzZSB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuYXR0YWNrSW50ZXJ2YWwgPiAwKSB0aGlzLmF0dGFja0ludGVydmFsLS07XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgfSxcbn0pO1xuXG4vL+mzpeOBruiQveOBl+eJqVxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkZpcmVCaXJkQm9tYlwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiA1LCBoZWlnaHQ6IDV9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJidWxsZXRcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoNzIpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRWZmZWN0KHRoaXMueCwgdGhpcy55LCB7bmFtZTogXCJleHBsb2RlX2dyb3VuZFwifSk7XG4gICAgICAgICAgICBpZiAodGhpcy5vblNjcmVlbikgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWzcyLCA3MywgNzQsIDczXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGRyb3BEZWFkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzRHJvcCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuZmxhbWUuanNcbiAqICAyMDE2LzEyLzMxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+eCjlxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkZsYW1lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v54Sh5pW144OV44Op44KwXG4gICAgaXNNdXRla2k6IHRydWUsXG5cbiAgICAvL+aUu+aSg+W9k+OBn+OCiuWIpOWumuacieWKueODleODqeOCsFxuICAgIGlzQXR0YWNrQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/lr7/lkb1cbiAgICBsaWZlU3BhbjogMTIwLFxuXG4gICAgLy/lvbHooajnpLrjg5Xjg6njgrBcbiAgICBpc1NoYWRvdzogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5wYXR0ZXJuID0gb3B0aW9ucy5wYXR0ZXJuIHx8IDA7XG4gICAgICAgIHRoaXMubGlmZVNwYW4gPSBvcHRpb25zLmxpZmVTcGFuIHx8IDEyMDtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogNTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZmxhbWUwMlwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoTWF0aC5taW4odGhpcy5wYXR0ZXJuLCAyKSAqIDI0ICsgNzIsIDAsIDI0LCAxMjgpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmxpZmVTcGFuID09IDApIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIGlmICh0aGlzLmxpZmVTcGFuIDwgMzApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAyID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDYwKXtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSA1ID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDkwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMTAgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpZmVTcGFuLS07XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWzAsIDEsIDIsIDNdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5nYXJ1ZGEuanNcbiAqICAyMDE3LzA3LzA3XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+aAqumzpVxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkdhcnVkYVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDgwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAyMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA2MCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAsXG5cbiAgICAvL+OCueODvOODkeODvOOCouODvOODnuODvFxuICAgIGlzU3VwZXJBcm1vcjogdHJ1ZSxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDMwMDAsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZUFycm93OiA1LFxuXG4gICAgZGVmYXVsdE9wdGlvbnM6IHtcbiAgICAgICAgc3BlZWQ6IDIsXG4gICAgICAgIGRpcmVjdGlvbjogMCxcbiAgICAgICAgcmV0dXJuVGltZTogMTIwLFxuICAgIH0sXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE4fSk7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zLiRzYWZlKHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMXgyXCIsIDQ4LCA2NCkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygwLCAwLCA3MiAqIDIsIDEyOCAqIDIpLnNldFNjYWxlKDEuNSkuc2V0UG9zaXRpb24oMCwgMTYpO1xuXG4gICAgICAgIHRoaXMuc3ByaXRlMiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxeDJcIiwgNDgsIDY0KS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZTIuc2V0RnJhbWVUcmltbWluZygyODggKiAyLCAwLCA3MiAqIDIsIDEyOCAqIDIpLnNldFNjYWxlKDEuNSkuc2V0UG9zaXRpb24oMCwgMTYpLnNldEFscGhhKDApO1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMuc3ByaXRlMi51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuZnJhbWVJbmRleCA9IHRoYXQuc3ByaXRlLmZyYW1lSW5kZXg7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5tb3ZlVGltZSA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnBhdGgpIHtcbiAgICAgICAgICAgIHZhciBwID0gdGhpcy5nZXRQYXRoUG9zaXRpb24odGhpcy5tb3ZlVGltZSk7XG4gICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uKHAueCwgcC55KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vdmVUaW1lICs9IDI7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFswLCAxLCAyLCAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbNiwgNywgOCwgN107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmdyZWF0ZXJkZW1vbi5qc1xuICogIDIwMTcvMDUvMDFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Kw44Os44O844K/44O844OH44O844Oi44OzXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuR3JlYXRlckRlbW9uXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMTIwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAyMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAxODAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiAxNSxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDUwMDAsXG5cbiAgICAvL+mjm+ihjOODouODvOODiVxuICAgIGZseWluZzogZmFsc2UsXG4gICAgZmx5aW5nUGhhc2U6IDAsIC8v6KGM5YuV44OV44Kn44O844K6XG4gICAgZmx5aW5nWDogMCwgICAgIC8v6aOb6KGM6ZaL5aeL77y45bqn5qiZXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9KRVdFTCxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAyLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9KRVdFTEJPWCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDM1LCBoZWlnaHQ6IDMwfSk7XG4gICAgICAgIGlmIChvcHRpb25zLnNpemUpIHtcbiAgICAgICAgICAgIHZhciBzaXplID0gb3B0aW9ucy5zaXplIHx8IDE7XG4gICAgICAgICAgICBvcHRpb25zLndpZHRoID0gc2l6ZSAqIDM1O1xuICAgICAgICAgICAgb3B0aW9ucy5oZWlnaHQgPSBzaXplICogMzA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDF4MlwiLCAyNCoyLCAzMioyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDcyKjIqMiwgNjQwKjIsIDcyKjIsIDEyOCoyKS5zZXRQb3NpdGlvbigwLCAtMTApO1xuICAgICAgICBpZiAob3B0aW9ucy5zaXplKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IG9wdGlvbnMuc2l6ZSB8fCAxO1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUuc2V0U2NhbGUoc2l6ZSkuc2V0UG9zaXRpb24oMCwgc2l6ZSAqIC0xMik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNwcml0ZTIgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMXgyXCIsIDI0KjIsIDMyKjIpLmFkZENoaWxkVG8odGhpcykuc2V0QWxwaGEoMCk7XG4gICAgICAgIHRoaXMuc3ByaXRlMi5zZXRGcmFtZVRyaW1taW5nKDI4OCoyLCA2NDAqMiwgNzIqMiwgMTI4KjIpLnNldFBvc2l0aW9uKDAsIC0xMCk7XG4gICAgICAgIHRoaXMuc3ByaXRlMi50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICBpZiAob3B0aW9ucy5zaXplKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IG9wdGlvbnMuc2l6ZSB8fCAxO1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUyLnNldFNjYWxlKHNpemUpLnNldFBvc2l0aW9uKDAsIHNpemUgKiAtMTIpO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5zcHJpdGUyLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5mcmFtZUluZGV4ID0gdGhhdC5zcHJpdGUuZnJhbWVJbmRleDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0F0dGFja0NhbmNlbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgIHRoaXMudHVyblRpbWUgPSAwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB0aGlzLmlzQXR0YWNrQ2FuY2VsID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCxXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/pgLLooYzmlrnlkJHmsbrlrppcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOeZuuimi+W+jOS4gOWumuaZgumWk+i/vei3oeOBmeOCi1xuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAxMjA7XG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMudnggKj0gMztcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwICYmICF0aGlzLmlzQXR0YWNrICYmIHRoaXMudHVyblRpbWUgPT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDE4MCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnR1cm5UaW1lID0gMTU7XG4gICAgICAgICAgICBpZiAobG9vaykgdGhpcy50dXJuQ291bnQgPSAwO1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgpLopovlpLHjgaPjgZ/nirbmhYvjgafkuInlm57mjK/jgorov5TjgaPjgZ/loLTlkIjjga/ov73ot6HntYLkuoZcbiAgICAgICAgICAgIGlmICh0aGlzLnR1cm5Db3VudCA+IDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+W0luOBo+OBt+OBoeOBp+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBuOOBruaUu+aSg1xuICAgICAgICAgICAgaWYgKGxvb2sgJiYgIXRoaXMuaXNBdHRhY2sgJiYgIXRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpcyA+IDEyOCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmVicmVhdGgoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGxvZGluZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAzMCkgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgIH0sXG5cbiAgICAvL+eBq+eQg+OCkuWQkOOBj1xuICAgIGZpcmViYWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgdGhpcy5zcHJpdGUyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmZhZGVJbigxMClcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlLCByb3RhdGlvbjogdGhpcy5nZXRQbGF5ZXJBbmdsZSgpLCBwb3dlcjogMzB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg0NSlcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmZhZGVPdXQoMTApO1xuICAgIH0sXG5cbiAgICAvL+eCjuOCkuWQkOOBj1xuICAgIGZpcmVicmVhdGg6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDYwO1xuICAgICAgICB0aGlzLnNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWRlT3V0KDE1KTtcblxuICAgICAgICB2YXIgcm90ID0gKHRoaXMuc2NhbGVYID09IDEpPyAwOiAxODA7XG4gICAgICAgIHZhciBjdCA9IDA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCArIDI0ICogdGhpcy5zY2FsZVgsIHRoaXMueS04LCBcIkJ1bGxldFwiLCB7dHlwZTogXCJleHBsb2RlXCIsIHBvd2VyOiAxMCwgcm90YXRpb246IHRoaXMuZ2V0UGxheWVyQW5nbGUoKSwgdmVsb2NpdHk6IDV9KTtcbiAgICAgICAgICAgICAgICBiLnNldFNjYWxlKDAuMSk7XG4gICAgICAgICAgICAgICAgYi50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJykudG8oe3NjYWxlWDogMSwgc2NhbGVZOiAxfSwgMTApO1xuICAgICAgICAgICAgICAgIGN0Kys7XG4gICAgICAgICAgICAgICAgaWYgKGN0ID09IDYgfHwgdGhpcy5hdHRhY2tDYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdHcucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2tDYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoNSlcbiAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgIH0sXG5cbiAgICAvL+eIhueZulxuICAgIGV4cGxvZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIGFwcC5wbGF5U0UoXCJib21iXCIpO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDYwO1xuICAgICAgICB0aGlzLnNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLndhaXQoNDUpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWRlT3V0KDE1KTtcblxuICAgICAgICB2YXIgcm90ID0gKHRoaXMuc2NhbGVYID09IDEpPyAwOiAxODA7XG4gICAgICAgIHZhciBjdCA9IDA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciByYWQgPSByb3QudG9SYWRpYW4oKTtcbiAgICAgICAgICAgICAgICB2YXIgZXggPSBNYXRoLmNvcyhyYWQpICogMTY7XG4gICAgICAgICAgICAgICAgdmFyIGV5ID0gTWF0aC5zaW4ocmFkKSAqIDE2O1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLnggKyBleCwgdGhpcy55ICsgZXksIFwiQnVsbGV0XCIsIHt0eXBlOiBcImV4cGxvZGVcIiwgcG93ZXI6IDEwLCByb3RhdGlvbjogcm90LCB2ZWxvY2l0eTogM30pO1xuICAgICAgICAgICAgICAgIHJvdCArPSAyMi41O1xuICAgICAgICAgICAgICAgIGN0Kys7XG4gICAgICAgICAgICAgICAgaWYgKGN0ID09IDE2IHx8IHRoaXMuYXR0YWNrQ2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgIHR3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrQ2FuY2VsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53YWl0KDEpXG4gICAgICAgICAgICAuc2V0TG9vcCh0cnVlKTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5pbnRlbGxpZ2VudHN3b3JkLmpzXG4gKiAgMjAxNy8wNy8xOVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkludGVsbGlnZW50U3dvcmRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAyMCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDEuMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMjAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMzYwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMjAwMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz44OV44Op44KwXG4gICAgaXNBbmltYXRpb246IGZhbHNlLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fTE9OR1NXT1JELFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDEsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0xPTkdTV09SRCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDI0fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoMTAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSlcbiAgICAgICAgICAgIC5zZXRSb3RhdGlvbigyMTUpO1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC50byh7eTogLTJ9LCAxMDAwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgIC50byh7eTogNH0sIDEwMDAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG5cbiAgICAgICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlO1xuICAgICAgICB0aGlzLnBvd2VyID0gb3B0aW9ucy5wb3dlciB8fCB0aGlzLnBvd2VyO1xuICAgICAgICB0aGlzLnJvdGF0aW9uID0gb3B0aW9ucy5yb3RhdGlvbiB8fCAwO1xuICAgICAgICB0aGlzLnZlbG9jaXR5ID0gb3B0aW9ucy52ZWxvY2l0eSB8fCB0aGlzLnZlbG9jaXR5O1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuXG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7ot53pm6JcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAobG9vayAmJiBkaXMgPCA2NCkge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDIpIHtcbiAgICAgICAgICAgIHZhciBhbmcgPSB0aGlzLmdldEFuZ2xlKHBsKTtcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSBhbmcgKyAzMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTUsIHk6IDB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjFcIl0gPSBbMF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBzbmFwOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgLy/lirnmnpzpn7NcbiAgICAgICAgYXBwLnBsYXlTRShcInRpbmtsaW5nXCIpO1xuICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmJ5KHt5OiAtNjQsIHJvdGF0aW9uOiA3MDB9LCAxNSwgXCJlYXNlT3V0UXVhZFwiKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDEwO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmpzXG4gKiAgMjAxNi8xMi8zMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/mlbXjgq3jg6Pjg6njgq/jgr/ln7rmnKzjgq/jg6njgrlcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuQ2hhcmFjdGVyXCIsXG5cbiAgICAvL+itmOWIpeODleODqeOCsFxuICAgIGlzRW5lbXk6IHRydWUsXG5cbiAgICAvL+ODrOODmeODq1xuICAgIGxldmVsOiAwLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMTAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMCxcblxuICAgIC8v56e75YuV6YCf5bqmXG4gICAgc3BlZWQ6IDEsXG5cbiAgICAvL+awl+e1tueiuueOh1xuICAgIHN0dW5Qb3dlcjogMSxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDAsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+mAsuihjOaWueWQke+8iDA65Y+zIDE4MDrlt6YgMjcwOuS4iiA5MDrkuIvvvIlcbiAgICBkaXJlY3Rpb246IDAsXG5cbiAgICAvL+ODneOCpOODs+ODiFxuICAgIHBvaW50OiAwLFxuXG4gICAgLy/mlLvmkoPlvZPjgZ/jgorliKTlrprmnInlirnjg5Xjg6njgrBcbiAgICBpc0VuYWJsZUF0dGFja0NvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v44K544O844OR44O844Ki44O844Oe44O854q25oWL44OV44Op44KwXG4gICAgaXNTdXBlckFybW9yOiBmYWxzZSxcblxuICAgIC8v5b2x6KGo56S644OV44Op44KwXG4gICAgaXNTaGFkb3c6IHRydWUsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZVNsYXNoOiAxLFxuICAgIGRhbWFnZVN0aW5nOiAxLFxuICAgIGRhbWFnZUJsb3c6IDEsXG4gICAgZGFtYWdlQXJyb3c6IDEsXG4gICAgZGFtYWdlRmlyZTogMSxcbiAgICBkYW1hZ2VJY2U6IDEsXG4gICAgZGFtYWdlSG9seTogMSxcbiAgICBkYW1hZ2VEYXJrOiAxLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDAsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIC8v6KGM5YuV44OR44K/44O844Oz55SoXG4gICAgY2hhc2VUaW1lOiAwLFxuICAgIHR1cm5UaW1lOiAwLFxuICAgIHN0b3BUaW1lOiAwLFxuICAgIHR1cm5Db3VudDogMCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc2V0dXBBbmltYXRpb24oKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5sZXZlbCA9IG9wdGlvbnMubGV2ZWwgfHwgMDtcbiAgICAgICAgdGhpcy50ZXJyaXRvcnkgPSBvcHRpb25zLnRlcnJpdG9yeTtcblxuICAgICAgICAvL+ODh+ODkOODg+OCsOaZguimlueVjOOBruWPr+imluWMllxuICAgICAgICBpZiAoREVCVUdfRVlFU0lHSFQpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciB2YSA9ICh0aGlzLnZpZXdBbmdsZSAvIDIpLnRvUmFkaWFuKCk7XG4gICAgICAgICAgICBwaGluYS5kaXNwbGF5LkFyY1NoYXBlKHtyYWRpdXM6IHRoaXMuZXllc2lnaHQsIHN0YXJ0QW5nbGU6IC12YSwgZW5kQW5nbGU6IHZhfSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRBbHBoYSgwLjMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSkgcmV0dXJuO1xuICAgICAgICAgICAgLy/nlLvpnaLlpJbjga7loLTlkIjjga/li5XkvZzlgZzmraJcbiAgICAgICAgICAgIGlmICghdGhpcy5vblNjcmVlbikgcmV0dXJuO1xuXG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcblxuICAgICAgICAgICAgLy/lkJHjgY3jga7mjIflrppcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4ICE9IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouOBruWgtOWQiOOBr+W9k+OBn+OCiuWIpOWumueEoeOBl1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50U2NlbmUuaXNTdGFnZUNsZWFyKSByZXR1cm47XG5cbiAgICAgICAgICAgIC8v5rCX57W25Lit44Gv44Ki44OL44Oh44O844K344On44Oz44GX44Gq44GEXG4gICAgICAgICAgICBpZiAodGhpcy5pc1N0dW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v6KKr44OA44Oh44O844K45b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNNdXRla2kgJiYgdGhpcy5tdXRla2lUaW1lID09IDApIHtcbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaUu+aSg+OBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgICAgIGlmIChwbC5pc0F0dGFjayAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsLmF0dGFja0NvbGxpc2lvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYW1hZ2UocGwuYXR0YWNrQ29sbGlzaW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgrfjg6fjg4Pjg4jjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5QbGF5ZXJBdHRhY2sgJiYgZS5pc0NvbGxpc2lvbiAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLmhpdCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhbWFnZShlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICBpZiAodGhpcy5pc0VuYWJsZUF0dGFja0NvbGxpc2lvbiAmJiB0aGlzLm11dGVraVRpbWUgPT0gMCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0RlYWQgJiYgIXBsLmlzRGVhZCAmJiB0aGlzLnBvd2VyID4gMCAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpdCgpO1xuICAgICAgICAgICAgICAgICAgICBwbC5kYW1hZ2UodGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5zdG9wVGltZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGdvcml0aG0oKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwKSB0aGlzLmNoYXNlVGltZS0tO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnR1cm5UaW1lID4gMCkgdGhpcy50dXJuVGltZS0tO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm9uKCdkZWFkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+eiuuWumuODieODreODg+ODl+OCouOCpOODhuODoFxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduSXRlbSh0aGlzLngsIHRoaXMueSwge2tpbmQ6IHRoaXMub3B0aW9ucy5pdGVtfSk7XG4gICAgICAgICAgICAgICAgaS52eSA9IC01O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaXRlbSA9PSBcImtleVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGkuaXNFbmVteURyb3AgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpLmlzRW5lbXlEcm9wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+ODrOOCouOCouOCpOODhuODoOODieODreODg+ODl+WIpOWumlxuICAgICAgICAgICAgdmFyIGRpY2UgPSBNYXRoLnJhbmRpbnQoMSwgMTAwKTtcbiAgICAgICAgICAgIGlmIChkaWNlIDw9IHRoaXMucmFyZURyb3BSYXRlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduSXRlbSh0aGlzLngsIHRoaXMueSwge2tpbmQ6IHRoaXMucmFyZURyb3BJdGVtfSk7XG4gICAgICAgICAgICAgICAgaS52eSA9IC01O1xuICAgICAgICAgICAgICAgIGkuaXNFbmVteURyb3AgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL+mAmuW4uOOCouOCpOODhuODoOODieODreODg+ODl+WIpOWumlxuICAgICAgICAgICAgICAgIHZhciBkaWNlID0gTWF0aC5yYW5kaW50KDEsIDEwMCk7XG4gICAgICAgICAgICAgICAgaWYgKGRpY2UgPD0gdGhpcy5kcm9wUmF0ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25JdGVtKHRoaXMueCwgdGhpcy55LCB7a2luZDogdGhpcy5kcm9wSXRlbX0pO1xuICAgICAgICAgICAgICAgICAgICBpLnZ5ID0gLTU7XG4gICAgICAgICAgICAgICAgICAgIGkuaXNFbmVteURyb3AgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgIH0sXG5cbiAgICBkYW1hZ2U6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICBpZiAodGhpcy5tdXRla2lUaW1lID4gMCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5pc011dGVraSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIC8v5rCX57W244Kt44Oj44Oz44K744OrXG4gICAgICAgIHRoaXMuaXNTdHVuID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGRpciA9IDA7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBxZnQuUGxheWVyQXR0YWNrKSB7XG4gICAgICAgICAgICBpZiAodGFyZ2V0LnNjYWxlWCA9PSAxKSBkaXIgPSAwOyBlbHNlIGRpciA9IDE4MDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPiB0YXJnZXQueCkgZGlyID0gMDsgZWxzZSBkaXIgPSAxODA7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcG93ZXIgPSB0YXJnZXQucG93ZXI7XG4gICAgICAgIGlmICh0YXJnZXQuaXNTbGFzaCkgcG93ZXIgKj0gdGhpcy5kYW1hZ2VTbGFzaDtcbiAgICAgICAgaWYgKHRhcmdldC5pc1N0aW5nKSBwb3dlciAqPSB0aGlzLmRhbWFnZVN0aW5nO1xuICAgICAgICBpZiAodGFyZ2V0LmlzQmxvdykgcG93ZXIgKj0gdGhpcy5kYW1hZ2VCbG93O1xuICAgICAgICBpZiAodGFyZ2V0LmlzQXJyb3cpIHBvd2VyICo9IHRoaXMuZGFtYWdlQXJyb3c7XG4gICAgICAgIGlmICh0YXJnZXQuaXNGaXJlKSBwb3dlciAqPSB0aGlzLmRhbWFnZUZpcmU7XG4gICAgICAgIGlmICh0YXJnZXQuaXNJY2UpIHBvd2VyICo9IHRoaXMuZGFtYWdlSWNlO1xuICAgICAgICBpZiAodGFyZ2V0LmlzSG9seSkgcG93ZXIgKj0gdGhpcy5kYW1hZ2VIb2x5O1xuICAgICAgICBpZiAodGFyZ2V0LmlzRGFyaykgcG93ZXIgKj0gdGhpcy5kYW1hZ2VEYXJrO1xuICAgICAgICBwb3dlciA9IE1hdGguZmxvb3IocG93ZXIpO1xuICAgICAgICBpZiAoIXRoaXMuaXNTdXBlckFybW9yKSB0aGlzLmtub2NrYmFjayhwb3dlciwgZGlyKTtcbiAgICAgICAgdGhpcy5tdXRla2lUaW1lID0gMTA7XG4gICAgICAgIHRoaXMuaHAgLT0gcG93ZXI7XG4gICAgICAgIGlmICh0aGlzLmhwIDw9IDApIHtcbiAgICAgICAgICAgIHRoaXMuaHAgPSAwO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS50b3RhbFNjb3JlICs9IHRoaXMucG9pbnQ7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnRvdGFsS2lsbCsrO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnZGVhZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnZGFtYWdlZCcsIHtkaXJlY3Rpb246IGRpcn0pO1xuXG4gICAgICAgICAgICAvL+awl+e1tuWIpOWumlxuICAgICAgICAgICAgdmFyIGRpY2UgPSBNYXRoLnJhbmRpbnQoMSwgMTAwKTtcbiAgICAgICAgICAgIGlmIChkaWNlIDw9IHRhcmdldC5zdHVuUG93ZXIpIHRoaXMuZmxhcmUoJ3N0dW4nLCB7cG93ZXI6IHRhcmdldC5wb3dlcn0pO1xuICAgICAgICB9XG4gICAgICAgIGFwcC5wbGF5U0UoXCJoaXRcIik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+ODl+ODrOOCpOODpOODvOOBjOimi+OBiOOCi+S9jee9ruOBq+OBhOOCi+OBruOBi+WIpOWumlxuICAgIGlzTG9va1BsYXllcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v6KaW5Yqb5aSW44Gu5aC05ZCI44Gv6KaL44GI44Gq44GEXG4gICAgICAgIGlmICh0aGlzLmdldERpc3RhbmNlUGxheWVyKCkgPiB0aGlzLmV5ZXNpZ2h0KSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgLy/oppbph47op5LlpJbjga7loLTlkIjjga/opovjgYjjgarjgYRcbiAgICAgICAgaWYgKHRoaXMudmlld0FuZ2xlICE9IDM2MCkge1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7op5LluqbvvIjlj7PjgYwzNjDluqbvvIlcbiAgICAgICAgICAgIHZhciBhbmdsZSA9IE1hdGguZmxvb3IodGhpcy5nZXRQbGF5ZXJBbmdsZSgpKTtcblxuICAgICAgICAgICAgLy/oppbnlYznr4Tlm7LlhoXjga7liKTlrppcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhID0gdGhpcy52aWV3QW5nbGUgLyAyO1xuICAgICAgICAgICAgICAgIGlmICghKDM2MC12YSA8IGFuZ2xlIHx8IGFuZ2xlIDwgdmEpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBkaXIgPSB0aGlzLmRpcmVjdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgdmEgPSB0aGlzLnZpZXdBbmdsZSAvIDI7XG4gICAgICAgICAgICAgICAgaWYgKCEoZGlyLXZhIDwgYW5nbGUgJiYgYW5nbGUgPCBkaXIrdmEpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUuY29sbGlzaW9uTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgdGhpcy50eXBlID09IFwic3RhaXJzXCIpIHJldHVybjtcbiAgICAgICAgICAgIC8v6Ieq5YiG44Go44OX44Os44Kk44Ok44O86ZaT44Gr6YGu6JS954mp77yI5Zyw5b2i5b2T44KK5Yik5a6a77yJ44GM44GC44KL5aC05ZCI6KaL44GI44Gq44GEXG4gICAgICAgICAgICBpZiAocGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdFJlY3RMaW5lKGUsIHRoYXQsIHBsYXllcikpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8v6Ieq5YiG44Go44OX44Os44Kk44Ok44O844KS57WQ44G255u057ea44Gu6KeS5bqm77yI5byn5bqm5rOV77yJXG4gICAgZ2V0UGxheWVyQW5nbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueSk7XG4gICAgICAgIHZhciBwID0gcDIuc3ViKHAxKTtcbiAgICAgICAgcmV0dXJuIHAudG9EZWdyZWUoKTtcbiAgICB9LFxuXG4gICAgLy/oh6rliIbjgajjg5fjg6zjgqTjg6Tjg7zjgpLntZDjgbbnm7Tnt5rjga7op5LluqbvvIjjg6njgrjjgqLjg7PvvIlcbiAgICBnZXRQbGF5ZXJSYWRpYW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueSk7XG4gICAgICAgIHZhciBwID0gcDIuc3ViKHAxKTtcbiAgICAgICAgcmV0dXJuIHAudG9BbmdsZSgpO1xuICAgIH0sXG5cbiAgICAvL+S9k+WKm+OCsuODvOOCuOioree9rlxuICAgIHNldHVwTGlmZUdhdWdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAvL+S9k+WKm+OCsuODvOOCuFxuICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAgMzIsXG4gICAgICAgICAgICBoZWlnaHQ6IDIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICBmaWxsOiAncmVkJyxcbiAgICAgICAgICAgIHN0cm9rZTogJ3doaXRlJyxcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuICAgICAgICAgICAgZ2F1Z2VDb2xvcjogJ2xpbWUnLFxuICAgICAgICAgICAgY29ybmVyUmFkaXVzOiAwLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuaHAsXG4gICAgICAgICAgICBtYXhWYWx1ZTogdGhpcy5ocCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5saWZlR2F1Z2UgPSBwaGluYS51aS5HYXVnZShvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICB0aGlzLmxpZmVHYXVnZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9ICh0aGF0LmhwICE9IHRoaXMubWF4VmFsdWUpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoYXQuaHA7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gLXRoYXQucm90YXRpb247XG4gICAgICAgICAgICB0aGlzLnNjYWxlWCA9IHRoYXQuc2NhbGVYO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5kaXNwVGltZSA+IDE1MCkgdGhpcy52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5iZWZvcmVWYWx1ZSA9PSB0aGlzLnZhbHVlKSB0aGlzLmRpc3BUaW1lKys7IGVsc2UgdGhpcy5kaXNwVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmJlZm9yZVZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5saWZlR2F1Z2UuZGlzcFRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICBoaXQ6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG5cbiAgICAvL+axjueUqOW+gOW+qeOCouODq+OCtOODquOCuuODoO+8iOmZuOS4iu+8iVxuICAgIHJvdW5kdHJpcEFsZ29yaXRobV9ncm91bmQ6IGZ1bmN0aW9uKGRpcywgbG9vaykge1xuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgaWYgKGRpcyA9PT0gdW5kZWZpbmVkKSBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIGlmIChsb29rID09PSB1bmRlZmluZWQpIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/ltJbjgaPjgbfjgaHjgafmipjjgorov5TjgZlcbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODhuODquODiOODquODvOaMh+WumlxuICAgICAgICAgICAgaWYgKCFsb29rICYmIHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgLy/msLTlubPmlrnlkJHjga7jgb/jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgICAgICB2YXIgdHggPSB0aGlzLnggLSB0aGlzLmZpcnN0WDtcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnModHgpID4gdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAgdGhpcy5zcGVlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v5rGO55So5b6A5b6p44Ki44Or44K044Oq44K644Og77yI56m65Lit77yJXG4gICAgcm91bmR0cmlwQWxnb3JpdGhtX2ZseWluZzogZnVuY3Rpb24oZGlzLCBsb29rKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICBpZiAoZGlzID09PSB1bmRlZmluZWQpIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgaWYgKGxvb2sgPT09IHVuZGVmaW5lZCkgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgdmFyIGNoazEgPSAxO1xuICAgICAgICB2YXIgY2hrMiA9IDM7XG4gICAgICAgIGlmICh0aGlzLnZlcnRpY2FsKSB7XG4gICAgICAgICAgICBjaGsxID0gMDtcbiAgICAgICAgICAgIGNoazIgPSAyO1xuICAgICAgICB9XG4gICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgIHZhciB0dXJuID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bY2hrMV0uaGl0IHx8IHRoaXMuX2NvbGxpc2lvbltjaGsyXS5oaXQpIHR1cm4gPSB0cnVlO1xuXG4gICAgICAgIC8v44OG44Oq44OI44Oq44O85oyH5a6aXG4gICAgICAgIGlmICghbG9vayAmJiB0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgaWYgKHRoaXMudmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICAvL+WeguebtOaWueWQkeODgeOCp+ODg+OCr1xuICAgICAgICAgICAgICAgIHZhciB0eSA9IHRoaXMueSAtIHRoaXMuZmlyc3RZO1xuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyh0eSkgPiB0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDI3MDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gOTA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v5rC05bmz5pa55ZCR44OB44Kn44OD44KvXG4gICAgICAgICAgICAgICAgdmFyIHR4ID0gdGhpcy54IC0gdGhpcy5maXJzdFg7XG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHR4KSA+IHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v5rGO55So6L+96Leh44Ki44Or44K044Oq44K644OgXG4gICAgY2hhc2VBbGdvcml0aG06IGZ1bmN0aW9uKGRpcywgbG9vaykge1xuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgaWYgKGRpcyA9PT0gdW5kZWZpbmVkKSBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIGlmIChsb29rID09PSB1bmRlZmluZWQpIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O855m66KaL5b6M5LiA5a6a5pmC6ZaT6L+96Leh44GZ44KLXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDAgJiYgIXRoaXMuaXNBdHRhY2sgJiYgdGhpcy50dXJuVGltZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHVyblRpbWUgPSAxNTtcbiAgICAgICAgICAgIGlmIChsb29rKSB0aGlzLnR1cm5Db3VudCA9IDA7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+WkseOBo+OBn+eKtuaFi+OBp+S4ieWbnuaMr+OCiui/lOOBo+OBn+WgtOWQiOOBr+i/vei3oee1guS6hlxuICAgICAgICAgICAgaWYgKHRoaXMudHVybkNvdW50ID4gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RYID0gdGhpcy54O1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RZID0gdGhpcy55O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/kuIDlrprot53pm6Lku6XkuIrpm6LjgozjgZ/jgonov73ot6Hop6PpmaRcbiAgICAgICAgaWYgKGRpcyA+IDUxMikge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5maXJzdFggPSB0aGlzLng7XG4gICAgICAgICAgICB0aGlzLmZpcnN0WSA9IHRoaXMueTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNKdW1wKSB0aGlzLnZ4ICo9IDE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAxMjA7XG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAwKSB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/jg4bjg6rjg4jjg6rjg7zmjIflrppcbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAwICYmIHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgLy/msLTlubPmlrnlkJHjga7jgb/jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgICAgICB2YXIgdHggPSB0aGlzLnggLSB0aGlzLmZpcnN0WDtcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnModHgpID4gdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44GT44KM5Lul5LiK6YCy44KB44Gq44GE5aC05ZCI44Gv5oqY44KK6L+U44GZXG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5XYWxsID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5DbGlmZiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZ4IDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwgfHwgaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafmrrXlt67jgYzjgYLjgovloLTlkIjjga/po5vjgbPotorjgYjjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafltJbjgYzjgYLjgovloLTlkIjjga/nnYDlnLDngrnjgYzjgYLjgovjgYvoqr/jgbnjgabpo5vjgbPpmY3jgorjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuQ2xpZmYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqdW1wT2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCszMiwgdGhpcy55KzMyLCAxNiwgOTYpKSB7anVtcE9rID0gdHJ1ZTsgdGhpcy52eSA9IC03O31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzMyLCB0aGlzLnktMzIsIDE2LCA5NikpIHtqdW1wT2sgPSB0cnVlOyB0aGlzLnZ5ID0gLTEwO31cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC0zMiwgdGhpcy55KzMyLCAxNiwgOTYpKSB7anVtcE9rID0gdHJ1ZTsgdGhpcy52eSA9IC03O31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTMyLCB0aGlzLnktMzIsIDE2LCA5NikpIHtqdW1wT2sgPSB0cnVlOyB0aGlzLnZ5ID0gLTEwO31cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdW1wT2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v552A5Zyw54K544GM54Sh44GE5aC05ZCI44Gv6Kum44KB44Gm5oqY44KK6L+U44GZXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSA0NTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnR1cm5XYWl0ID0gMTU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIuLi5cIn0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RYID0gdGhpcy54O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RZID0gdGhpcy55O1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMzApIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RYID0gdGhpcy54O1xuICAgICAgICAgICAgdGhpcy5maXJzdFkgPSB0aGlzLnk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/oqZXkvqHplqLmlbBcbiAgICBldmFsdWF0ZTogZnVuY3Rpb24oZGlzLCBsb29rKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICBpZiAoZGlzID09PSB1bmRlZmluZWQpIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgaWYgKGxvb2sgPT09IHVuZGVmaW5lZCkgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/ohIXlqIHluqZcbiAgICAgICAgdmFyIHRocmVhdCA9IDA7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7ot53pm6LjgavjgojjgorohIXlqIHluqbjgpLliqDnrpdcbiAgICAgICAgaWYgKGRpcyA8IDI1NikgdGhyZWF0ICs9IDEwXG4gICAgICAgIGlmIChkaXMgPCAxMjgpIHRocmVhdCArPSAyMFxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O86KaW6KqN5Y+v6IO954q25oWLXG4gICAgICAgIGlmIChsb29rKSB0aHJlYXQgKz0gMzA7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zooYzli5XnirbmhYtcbiAgICAgICAgdmFyIHBsYXllckFjdGlvbiA9IFwiXCI7XG4gICAgICAgIGlmIChwbC54ID09IHBsLmJlZm9yZS54ICYmIHBsLnkgPT0gcGwuYmVmb3JlLnkpIHtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Gv56e75YuV44GX44Gm44GE44Gq44GEXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOmAsuihjOaWueWQke+8iOWPszowIOW3pjoxODDvvIlcbiAgICAgICAgICAgIHZhciBwbGRpciA9IDA7XG4gICAgICAgICAgICBpZiAocGwueCA8IHBsLmJlZm9yZS54KSBwbGRpciA9IDE4MDtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbC54KSB7XG4gICAgICAgICAgICAgICAgaWYgKHByZGlyID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjga/ov5HjgaXjgYTjgabjgYTjgotcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBr+mbouOCjOOBpuOBhOOCi1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHByZGlyID09IDE4MCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBr+i/keOBpeOBhOOBpuOBhOOCi1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Gv6Zui44KM44Gm44GE44KLXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRocmVhdDogdGhyZWF0LFxuICAgICAgICAgICAgcGxheWVyQWN0aW9uOiBwbGF5ZXJBY3Rpb24sXG4gICAgICAgIH07XG4gICAgfSxcbn0pO1xuXG4vL+aVteaUu+aSg+WIpOWumlxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15QXR0YWNrXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGVcIixcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEsXG5cbiAgICAvL+acieWKueODleODqeOCsFxuICAgIGlzQWN0aXZlOiB0cnVlLFxuXG4gICAgLy/lr7/lkb1cbiAgICBsaWZlU3BhbjogMTUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHt3aWR0aDogMzIsIGhlaWdodDogMzJ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUgPSBwYXJlbnRTY2VuZTtcblxuICAgICAgICB0aGlzLiRleHRlbmQob3B0aW9ucyk7XG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGUgPT4ge1xuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lID4gdGhpcy5saWZlU3Bhbikge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzQWN0aXZlKSByZXR1cm47XG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmlLvmkoPjgajlvZPjgZ/jgaPjgZ/loLTlkIjjga/jgqjjg5Xjgqfjgq/jg4jjgpLlh7rjgZfjgabnhKHlirnljJZcbiAgICAgICAgICAgIGlmIChwbC5pc0F0dGFjayAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsLmF0dGFja0NvbGxpc2lvbikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQWN0aWNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5idW1wKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCt+ODp+ODg+ODiOOBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXJMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5QbGF5ZXJBdHRhY2sgJiYgZS5pc0NvbGxpc2lvbiAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGUuc25hcCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgZS5pc0NvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICBpZiAoIXBsLmlzRGVhZCAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsKSkge1xuICAgICAgICAgICAgICAgIHBsLmRhbWFnZSh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikge1xuICAgICAgICAgICAgcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IHRoaXMud2lkdGgsIGhlaWdodDogdGhpcy5oZWlnaHR9KS5hZGRDaGlsZFRvKHRoaXMpLnNldEFscGhhKDAuNSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/liKTlrprlkIzlo6vjgYzjgbbjgaTjgYvjgaPjgZ/loLTlkIjjga7lh6bnkIZcbiAgICBidW1wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVmZmVjdCh0aGlzLngsIHRoaXMueSwge25hbWU6IFwiaGl0XCJ9KTtcbiAgICAgICAgaWYgKHRoaXMubWFzdGVyKSB7XG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgIHBsLmtub2NrYmFjayg1LCB0aGlzLm1hc3Rlci5kaXJlY3Rpb24pO1xuICAgICAgICAgICAgdGhpcy5tYXN0ZXIua25vY2tiYWNrKDUsICh0aGlzLm1hc3Rlci5kaXJlY3Rpb24gKyAxODApICUgMzYwKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJ0aW5rbGluZ1wiKTtcbiAgICAgICAgfVxuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkua25pZ2h0LmpzXG4gKiAgMjAxNy8wNS8wNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jg4rjgqTjg4hcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5LbmlnaHRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA3MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+mAn+W6plxuICAgIHNwZWVkOiAxLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTkyLFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDkwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMTAwMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDcsXG4gICAgZHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fTE9OR1NXT1JELFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjAsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v5q2m5Zmo44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMud2VhcG9uID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0RnJhbWVJbmRleCgxMCArIE1hdGgubWluKDksIHRoaXMubGV2ZWwpKVxuICAgICAgICAgICAgLnNldE9yaWdpbigxLCAxKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKC00LCAyKVxuICAgICAgICAgICAgLnNldFNjYWxlKC0xLCAxKVxuICAgICAgICAgICAgLnNldFJvdGF0aW9uKDQzMCk7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMud2VhcG9uLmtpbmQgPSBcInN3b3JkXCI7XG4gICAgICAgIGlmIChvcHRpb25zLndlYXBvbiA9PSBcImF4XCIpIHtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldEZyYW1lSW5kZXgoMjAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5raW5kID0gXCJheFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLndlYXBvbiA9PSBcInNwZWFyXCIpIHtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldEZyYW1lSW5kZXgoMzAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5raW5kID0gXCJzcGVhclwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMlwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMTQ0LCAxMjgsIDcyLCAxMjgpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRQb3NpdGlvbigwLCAtNSkuc2V0U2NhbGUoMS4zKTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiAxMDtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMTA7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDUwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozkuIDlrprmmYLplpPov73ot6HjgZnjgotcbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCAmJiAhdGhpcy5pc0F0dGFjayAmJiB0aGlzLnR1cm5UaW1lID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50dXJuVGltZSA9IDE1O1xuICAgICAgICAgICAgaWYgKGxvb2spIHRoaXMudHVybkNvdW50ID0gMDtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844KS6KaL5aSx44Gj44Gf54q25oWL44Gn5LiJ5Zue5oyv44KK6L+U44Gj44Gf5aC05ZCI44Gv6L+96Leh57WC5LqGXG4gICAgICAgICAgICBpZiAodGhpcy50dXJuQ291bnQgPiAzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pc0p1bXApIHRoaXMudnggKj0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDEyMDtcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDApIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHRoaXMudnggKj0gMztcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v44GT44KM5Lul5LiK6YCy44KB44Gq44GE5aC05ZCI44Gv5oqY44KK6L+U44GZXG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5XYWxsID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5DbGlmZiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZ4IDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwgfHwgaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafmrrXlt67jgYzjgYLjgovloLTlkIjjga/po5vjgbPotorjgYjjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86L+96Leh5Lit44Gn5bSW44GM44GC44KL5aC05ZCI44Gv552A5Zyw54K544GM44GC44KL44GL6Kq/44G544Gm6aOb44Gz6ZmN44KK44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIganVtcE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoanVtcE9rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nnYDlnLDngrnjgYznhKHjgYTloLTlkIjjga/oq6bjgoHjgabmipjjgorov5TjgZlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIi4uLlwifSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA2NCAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86aOb44Gz6YGT5YW344KS5by+44GP77yI44Os44OZ44Or77yU5Lul5LiK77yJXG4gICAgICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDMgJiYgbG9vayAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCt+ODp+ODg+ODiOOBqOOBrui3nembouWIpOWumlxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uICYmIGUudHlwZSA9PSBcImFycm93XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmdldERpc3RhbmNlKGUpIDwgNjQpIHRoYXQuZ3VhcmQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMzApIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICB9LFxuXG4gICAgYXR0YWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgd2lkdGggPSAyNCwgaGVpZ2h0ID0gMjQ7XG4gICAgICAgIHZhciBhdGsgPSBxZnQuRW5lbXlBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAyNCwgaGVpZ2h0OiAyNCwgcG93ZXI6IDIwICsgdGhpcy5sZXZlbCAqIDV9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5lbmVteUxheWVyKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCArIHRoaXMuc2NhbGVYICogMTgsIHRoaXMueSlcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjApO1xuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSBhdGsuc2V0QWxwaGEoMC4zKTtcbiAgICAgICAgYXRrLm1hc3RlciA9IHRoaXM7XG4gICAgICAgIGF0ay50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICBhdGsudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGF0LnggKyB0aGF0LnNjYWxlWCAqIDE4O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMud2VhcG9uLmtpbmQgPT0gXCJzd29yZFwiIHx8IHRoaXMud2VhcG9uLmtpbmQgPT0gXCJheFwiKSB7XG4gICAgICAgICAgICBhdGsuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC50byh7cm90YXRpb246IDI3MH0sIDMpXG4gICAgICAgICAgICAgICAgLndhaXQoMylcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52eCA9IDE2ICogdGhhdC5zY2FsZVg7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiA0MzB9LCA2KVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGF0ay5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLndlYXBvbi5raW5kID09IFwic3BlYXJcIikge1xuICAgICAgICAgICAgYXRrLndpZHRoID0gMzI7XG4gICAgICAgICAgICBhdGsuaGVpZ2h0ID0gODtcbiAgICAgICAgICAgIGF0ay5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDEsIHRoaXMueSk7XG4gICAgICAgICAgICBhdGsudHdlZW5lci5jbGVhcigpLmJ5KHt4OiAyMCAqIHRoaXMuc2NhbGVYfSwgMTApLmJ5KHt4OiAtMjAgKiB0aGlzLnNjYWxlWH0sIDEwKTtcbiAgICAgICAgICAgIGF0ay5pc0FjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDUsIHg6IC0yMH0pXG4gICAgICAgICAgICAgICAgLndhaXQoMilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc1N1cGVyQXJtb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnZ4ID0gMzIgKiB0aGF0LnNjYWxlWDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5ieSh7eDogMjB9LCAzKVxuICAgICAgICAgICAgICAgIC5ieSh7eDogLTMwfSwgNSlcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzU3VwZXJBcm1vciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDMwLCB4OiAtMn0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgfSxcblxuICAgIC8v6aOb44Gz6YGT5YW35by+44GNXG4gICAgZ3VhcmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciB3aWR0aCA9IDI0LCBoZWlnaHQgPSAyNDtcbiAgICAgICAgdmFyIGF0ayA9IHFmdC5FbmVteUF0dGFjayh0aGlzLnBhcmVudFNjZW5lLCB7d2lkdGg6IDI0LCBoZWlnaHQ6IDI0LCBwb3dlcjogMjAgKyB0aGlzLmxldmVsICogNX0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLmVuZW15TGF5ZXIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy54ICsgdGhpcy5zY2FsZVggKiAxOCwgdGhpcy55KVxuICAgICAgICAgICAgLnNldEFscGhhKDAuMCk7XG4gICAgICAgIGlmIChERUJVR19DT0xMSVNJT04pIGF0ay5zZXRBbHBoYSgwLjMpO1xuICAgICAgICBhdGsubWFzdGVyID0gdGhpcztcbiAgICAgICAgYXRrLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIGF0ay51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoYXQueCArIHRoYXQuc2NhbGVYICogMTg7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDMwfSlcbiAgICAgICAgICAgIC50byh7cm90YXRpb246IDMwMH0sIDMpXG4gICAgICAgICAgICAudG8oe3JvdGF0aW9uOiA0MzB9LCAzKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoYXQuaXNNdXRla2kgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSA2O1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15Lm1hZ2UuanNcbiAqICAyMDE3LzA0LzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+mtlOihk+W4q1xucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lk1hZ2VcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAyMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAyNTYsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMTYwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogNTAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMzAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIGx2ID0gTWF0aC5taW4odGhpcy5sZXZlbCwgNCk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDNcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKChsdiAlIDIpICogMTQ0LCBNYXRoLmZsb29yKGx2IC8gMikgKiAxMjgsIDcyLCAxMjgpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRTY2FsZSgxLjIpLnNldFBvc2l0aW9uKDAsIC0yKTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiAyO1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAyMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuICAgICAgICB2YXIgZGlzdGFuY2UgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOi/keOBj+OBq+OBhOOBn+OCiei3nembouOCkuWPluOCi1xuICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMCAmJiBsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXN0YW5jZSA8IDEyOCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwZWVkID0gMztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/pgIPjgZLjgovjg5Xjgqfjg7zjgrpcbiAgICAgICAgICAgIGlmICh0aGlzLnBoYXNlID09IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCAxMjgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA8IHBsYXllci54KSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BlZWQgPSAzO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbGF5ZXIueCkgdGhpcy5kaXJlY3Rpb24gPSAwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwZWVkID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBsdiA9IE1hdGgubWluKHRoaXMubGV2ZWwsIDQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoKGx2ICUgMikgKiAxNDQsIE1hdGguZmxvb3IobHYgLyAyKSAqIDEyOCwgNzIsIDEyOCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5pS75pKD44OV44Kn44O844K6XG4gICAgICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgOTYpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgaXjgYTjgZ/jgonpgIPjgZLjgotcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzpgaDjgY/jgavjgYTjgovloLTlkIjjga/mlLvmkoNcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+eZuueLguODouODvOODiVxuICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHZhciBsdiA9IE1hdGgubWluKHRoaXMubGV2ZWwsIDQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoKGx2ICUgMikgKiAxNDQgKyA3MiwgTWF0aC5mbG9vcihsdiAvIDIpICogMTI4LCA3MiwgMTI4KTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5waGFzZSA8IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmViYWxsKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDg7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZWJhbGwoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaWueWQkeOCkuWQkeOBj1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbGF5ZXIueCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmV0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jgZPjgozku6XkuIrpgLLjgoHjgarjgYTloLTlkIjjga/mipjjgorov5TjgZlcbiAgICAgICAgICAgIHZhciBjYW50ZXNjYXBlID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCB8fCB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMSkgY2FudGVzY2FwZSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQgfHwgdGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxKSBjYW50ZXNjYXBlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v6YCD44GS44KJ44KM44Gq44GE5aC05ZCI44Gv55m654uC44Oi44O844OJXG4gICAgICAgICAgICBpZiAoY2FudGVzY2FwZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAzO1xuICAgICAgICAgICAgICAgIHRoaXMuc3BlZWQgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOmbouOCjOOBn+OCiemAmuW4uOODleOCp+ODvOOCulxuICAgICAgICAgICAgaWYgKGRpc3RhbmNlID4gMTI4ICsgNjQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbHYgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKChsdiAlIDIpICogMTQ0LCBNYXRoLmZsb29yKGx2IC8gMikgKiAxMjgsIDcyLCAxMjgpO1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuc3BlZWQgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gdGhpcy5zcGVlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICAvL+ODleOCoeOCpOOCouODnOODvOODq1xuICAgIGZpcmViYWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIkJ1bGxldFwiLCB7ZXhwbG9kZTogdHJ1ZSwgcm90YXRpb246IHRoaXMuZ2V0UGxheWVyQW5nbGUoKSArIE1hdGgucmFuZGludCgtNDAsIDQwKX0pO1xuICAgIH0sXG5cbiAgICAvL+eIhueZulxuICAgIGV4cGxvZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHAucGxheVNFKFwiYm9tYlwiKTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICB2YXIgcm90ID0gKHRoaXMuc2NhbGVYID09IDEpPyAwOiAxODA7XG4gICAgICAgIHZhciBjdCA9IDA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciByYWQgPSByb3QudG9SYWRpYW4oKTtcbiAgICAgICAgICAgICAgICB2YXIgZXggPSBNYXRoLmNvcyhyYWQpICogMTY7XG4gICAgICAgICAgICAgICAgdmFyIGV5ID0gTWF0aC5zaW4ocmFkKSAqIDE2O1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLnggKyBleCwgdGhpcy55ICsgZXksIFwiQnVsbGV0XCIsIHt0eXBlOiBcImV4cGxvZGVcIiwgcG93ZXI6IDEwLCByb3RhdGlvbjogcm90LCB2ZWxvY2l0eTogM30pO1xuICAgICAgICAgICAgICAgIHJvdCArPSAyMi41O1xuICAgICAgICAgICAgICAgIGN0Kys7XG4gICAgICAgICAgICAgICAgaWYgKGN0ID09IDMyIHx8IHRoaXMuYXR0YWNrQ2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgIHR3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCgxKVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5tYWdpY2RnZ2VyLmpzXG4gKiAgMjAxNy8wNy8xOVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lk1hZ2ljRGFnZ2VyXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMSxcblxuICAgIC8v5a+/5ZG9XG4gICAgbGlmZXNwYW46IDc1LFxuXG4gICAgLy/pgJ/luqZcbiAgICB2ZWxvY2l0eTogMixcblxuICAgIC8v5Yqg6YCf5bqmXG4gICAgYWNjZWw6IDEuMDIsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAxLjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAwLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTZ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDApO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInBhdHRlcm4xXCIpO1xuXG4gICAgICAgIHRoaXMucG93ZXIgPSBvcHRpb25zLnBvd2VyIHx8IHRoaXMucG93ZXI7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDI7XG5cbiAgICAgICAgdGhpcy5wYXJlbnRVbml0ID0gb3B0aW9ucy5wYXJlbnQgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5vZmZzZXRYID0gb3B0aW9ucy5vZmZzZXRYIHx8IE1hdGgucmFuZGludCgtMTYsIDE2KTtcbiAgICAgICAgdGhpcy5vZmZzZXRZID0gb3B0aW9ucy5vZmZzZXRZIHx8IE1hdGgucmFuZGludCgtMTYsIDE2KTtcbiAgICAgICAgdGhpcy5vcmRlciA9IG9wdGlvbnMub3JkZXIgfHwgMDtcblxuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNBdHRhY2tfYmVmb3JlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNEYW1hZ2VkID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/lvoXmqZ/plovlp4tcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgdmFyIHggPSB0aGlzLnBhcmVudFVuaXQueCArIHRoaXMub2Zmc2V0WDtcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5wYXJlbnRVbml0LnkgKyB0aGlzLm9mZnNldFk7XG4gICAgICAgICAgICB5ICs9IE1hdGguY29zKHRoaXMudGltZS50b1JhZGlhbigpICogNikgKiA1O1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAubW92ZVRvKHgsIHksIDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+W+heapn+S4rVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAyKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGlzLnBhcmVudFVuaXQueCArIHRoaXMub2Zmc2V0WDtcbiAgICAgICAgICAgIHRoaXMueSA9IHRoaXMucGFyZW50VW5pdC55ICsgdGhpcy5vZmZzZXRZO1xuICAgICAgICAgICAgdGhpcy55ICs9IE1hdGguY29zKHRoaXMudGltZS50b1JhZGlhbigpICogNikgKiA1O1xuICAgICAgICAgICAgdGhpcy5yb3RhdGlvbiAtPSAzO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAzO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85pS75pKD6ZaL5aeLXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDMpIHtcbiAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLmdldFBsYXllckFuZ2xlKCkgKyAxMzU7XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5tb3ZlVG8ocGwueCwgcGwueSwgMjAsIFwiZWFzZUluUXVhZFwiKVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/mlLvmkoPntYLkuoZcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gNSkge1xuICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgdGhpcy5pc0VuYWJsZUF0dGFja0NvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIHggPSB0aGlzLnBhcmVudFVuaXQueCArIHRoaXMub2Zmc2V0WDtcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5wYXJlbnRVbml0LnkgKyB0aGlzLm9mZnNldFk7XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5tb3ZlVG8oeCwgeSwgMTUsIFwiZWFzZUluT3V0UXVhZFwiKVxuICAgICAgICAgICAgICAgIC53YWl0KDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0VuYWJsZUF0dGFja0NvbGxpc2lvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+itpuaIkuW+heapn+mWi+Wni1xuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxMCkge1xuICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgdmFyIGRlZyA9IHRoaXMudGltZS50b1JhZGlhbigpICogNiArIHRoaXMub3JkZXIgKiA2MDtcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5wYXJlbnRVbml0LnggKyBNYXRoLmNvcyhkZWcpICogMTY7XG4gICAgICAgICAgICB2YXIgeSA9IHRoaXMucGFyZW50VW5pdC55ICsgTWF0aC5zaW4oZGVnKSAqIDE2O1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAubW92ZVRvKHgsIHksIDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+itpuaIkuW+heapn+S4rVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxMikge1xuICAgICAgICAgICAgdmFyIGRlZyA9IHRoaXMudGltZS50b1JhZGlhbigpICogNiArIHRoaXMub3JkZXIgKiA2MDtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoaXMucGFyZW50VW5pdC54ICsgTWF0aC5jb3MoZGVnKSAqIDE2O1xuICAgICAgICAgICAgdGhpcy55ID0gdGhpcy5wYXJlbnRVbml0LnkgKyBNYXRoLnNpbihkZWcpICogMTY7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uIC09IDY7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDEzO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v6L+R5o6l5pS75pKD6ZaL5aeLXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDEzKSB7XG4gICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC53YWl0KDEwKVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5nZXRQbGF5ZXJBbmdsZSgpICsgMTM1O1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm1vdmVUbyhwbC54LCBwbC55LCA2KVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/ov5HmjqXmlLvmkoNcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMTQpIHtcbiAgICAgICAgICAgIHZhciBkZWcgPSB0aGlzLnRpbWUudG9SYWRpYW4oKSAqIDIwICsgdGhpcy5vcmRlciAqIDYwO1xuICAgICAgICAgICAgdGhpcy54ID0gdGhpcy5wYXJlbnRVbml0LnggKyBNYXRoLmNvcyhkZWcpICogMjQ7XG4gICAgICAgICAgICB0aGlzLnkgPSB0aGlzLnBhcmVudFVuaXQueSArIE1hdGguc2luKGRlZykgKiAyNDtcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gLT0gNjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5pS75pKD57WC5LqGXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDE2KSB7XG4gICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICB0aGlzLmlzRW5hYmxlQXR0YWNrQ29sbGlzaW9uID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgeCA9IHRoaXMucGFyZW50VW5pdC54ICsgdGhpcy5vZmZzZXRYO1xuICAgICAgICAgICAgdmFyIHkgPSB0aGlzLnBhcmVudFVuaXQueSArIHRoaXMub2Zmc2V0WTtcbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLm1vdmVUbyh4LCB5LCAxMClcbiAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0VuYWJsZUF0dGFja0NvbGxpc2lvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+imquODpuODi+ODg+ODiOWQjOacn1xuICAgICAgICBpZiAodGhpcy5wYXJlbnRVbml0KSB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMucGFyZW50VW5pdC5kaXJlY3Rpb247XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnRVbml0LmhwID09IDApIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+mjm+OBs+mBk+WFt+i/juaSg1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBxZnQuUGxheWVyQXR0YWNrICYmIGUuaXNDb2xsaXNpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50eXBlICE9IFwiYXJyb3dcIiAmJiBlLnR5cGUgIT0gXCJtYXNha2FyaVwiKSByZXR1cm47XG4gICAgICAgICAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2UoZSk7XG4gICAgICAgICAgICAgICAgaWYgKGRpcyA8IDY0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAyMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tb3ZlVG8oZS54LCBlLnksIDUpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHRoaXMuaXNBdHRhY2tfYmVmb3JlID0gdGhpcy5pc0F0dGFjaztcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJwYXR0ZXJuMVwiXSA9IFswXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGRhbWFnZTogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIHRoaXMuaXNEYW1hZ2VkID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPCAxMCkgdGhpcy5waGFzZSA9IDY7IGVsc2UgdGhpcy5waGFzZSA9IDE3O1xuXG4gICAgICAgIC8v5Yq55p6c6Z+zXG4gICAgICAgIGFwcC5wbGF5U0UoXCJ0aW5rbGluZ1wiKTtcbiAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5ieSh7eTogLTY0LCByb3RhdGlvbjogNzAwfSwgMTUsIFwiZWFzZU91dFF1YWRcIilcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBoYXNlIDwgMTApIHRoaXMucGhhc2UgPSAwOyBlbHNlIHRoaXMucGhhc2UgPSAxMDtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRGFtYWdlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15Lm9ncmUuanNcbiAqICAyMDE3LzA1LzA2XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCquODvOOCrFxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lk9ncmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA2MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMjAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAxMDAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogNyxcbiAgICBkcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyMCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMlwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjE2LCAwLCA3MiwgMTI4KTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0UG9zaXRpb24oMCwgLTUpLnNldFNjYWxlKDEuMyk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMztcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMzAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozkuIDlrprmmYLplpPov73ot6HjgZnjgotcbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCAmJiAhdGhpcy5pc0F0dGFjayAmJiB0aGlzLnR1cm5UaW1lID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50dXJuVGltZSA9IDE1O1xuICAgICAgICAgICAgaWYgKGxvb2spIHRoaXMudHVybkNvdW50ID0gMDtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844KS6KaL5aSx44Gj44Gf54q25oWL44Gn5LiJ5Zue5oyv44KK6L+U44Gj44Gf5aC05ZCI44Gv6L+96Leh57WC5LqGXG4gICAgICAgICAgICBpZiAodGhpcy50dXJuQ291bnQgPiAzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAwLjU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMC41O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkgdGhpcy52eCAqPSA0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMTUwO1xuICAgICAgICAgICAgdGhpcy50dXJuQ291bnQgPSAwO1xuICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMCkgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v44GT44KM5Lul5LiK6YCy44KB44Gq44GE5aC05ZCI44Gv5oqY44KK6L+U44GZXG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5XYWxsID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5DbGlmZiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZ4IDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzQwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwgfHwgaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafmrrXlt67jgYzjgYLjgovloLTlkIjjga/po5vjgbPotorjgYjjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86L+96Leh5Lit44Gn5bSW44GM44GC44KL5aC05ZCI44Gv552A5Zyw54K544GM44GC44KL44GL6Kq/44G544Gm6aOb44Gz6ZmN44KK44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIganVtcE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoanVtcE9rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nnYDlnLDngrnjgYznhKHjgYTloLTlkIjjga/oq6bjgoHjgabmipjjgorov5TjgZlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIi4uLlwifSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR1cm5XYWl0ID0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDMwKSB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkub3JvY2hpLmpzXG4gKiAgMjAxNy8wNi8xM1xuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/lpKfom4dcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5Pcm9jaGlcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA1MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiA3MDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDMyLCBoZWlnaHQ6IDM2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB2YXIgY2FwTGV2ZWwgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMXgyXCIsIDI0ICogMiwgMzIgKiAyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKGNhcExldmVsICogNzIgKiAyLCAzODQgKiAyLCA3MiAqIDIsIDEyOCAqIDIpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMSArIGNhcExldmVsICogMC4xKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKDAsIGNhcExldmVsICogLTEgLSA0KTtcbiAgICAgICAgdGhpcy53aWR0aCArPSBjYXBMZXZlbCAqIDEwO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDEwO1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAzMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTU7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRGVhZCkgcmV0dXJuO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzEwLCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTEwLCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOi/keOBj+OBq+OBhOOBn+OCieOCuOODo+ODs+ODl+aUu+aSg1xuICAgICAgICAgICAgaWYgKGxvb2sgJiYgIXRoaXMuaXNKdW1wICYmIGRpcyA8IDQwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNjtcbiAgICAgICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLnZ4ICo9IDQ7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTUsIHk6IDB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuc2xpbWUuanNcbiAqICAyMDE2LzEyLzMxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODqeOCpOODoFxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LlNsaW1lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDkwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMTAwLFxuXG4gICAgLy/lsZ7mgKfjg4Djg6Hjg7zjgrjlgI3njodcbiAgICBkYW1hZ2VTdGluZzogMC44LFxuICAgIGRhbWFnZUJsb3c6IDAuNSxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDMwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0NPSU4sXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogNSxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fQkFHLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTZ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHZhciBjYXBMZXZlbCA9IE1hdGgubWluKHRoaXMubGV2ZWwsIDQpO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyhjYXBMZXZlbCAqIDcyLCAyNTYsIDcyLCAxMjgpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMSArIGNhcExldmVsICogMC4yKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKDAsIC0yICsgY2FwTGV2ZWwgKiAtMyk7XG4gICAgICAgIHRoaXMud2lkdGggKz0gY2FwTGV2ZWwgKiA1O1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDEwO1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDMpIHRoaXMuaHAgKz0gMzA7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDIwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcblxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5kaXJlY3Rpb24gPT0gMCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWwgPiAz44CAJiYgdGhpcy5zdG9wVGltZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2soKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiYW5nZXIxXCIsIGxpZmVTcGFuOiA2MCwgeTogMCwgZm9yY2U6IHRydWV9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg4bjg6rjg4jjg6rjg7zmjIflrppcbiAgICAgICAgICAgIGlmICh0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgICAgIC8v5rC05bmz5pa55ZCR44Gu44G/44OB44Kn44OD44KvXG4gICAgICAgICAgICAgICAgdmFyIHR4ID0gdGhpcy54IC0gdGhpcy5maXJzdFg7XG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHR4KSA+IHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5sZXZlbCA8IDQpIHtcbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOi/keOBj+OBq+OBhOOBn+OCieOCuOODo+ODs+ODl+aUu+aSg1xuICAgICAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA0MCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAgMiArIE1hdGguZmxvb3IodGhpcy5sZXZlbCowLjUpICogdGhpcy5zcGVlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgdmFyIHZ4ID0gMTtcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDE4MCkgdnggPSAtMTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxldmVsOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIldpc3BCb21iXCIsIHtwYXR0ZXJuOiAyfSk7XG4gICAgICAgICAgICBiLnZ5ID0gLTg7XG4gICAgICAgICAgICBiLnZ4ID0gaSAqIDIgKiB2eDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByYW5kb21BdHRhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgIHZhciB2eCA9IDE7XG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHZ4ID0gLTE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZXZlbDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJXaXNwQm9tYlwiLCB7cGF0dGVybjogMn0pO1xuICAgICAgICAgICAgYi52eSA9IC04O1xuICAgICAgICAgICAgYi52eCA9IGkgKiAyICogdng7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFswLCAxLCAyLCAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5zbmFrZS5qc1xuICogIDIwMTcvMDEvMjdcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v6JuHXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuU25ha2VcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAyMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAxNTAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE4fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB2YXIgY2FwTGV2ZWwgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoY2FwTGV2ZWwgKiA3MiwgMzg0LCA3MiwgMTI4KVxuICAgICAgICAgICAgLnNldFNjYWxlKDEgKyBjYXBMZXZlbCAqIDAuMSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCBjYXBMZXZlbCAqIC0xKVxuICAgICAgICB0aGlzLndpZHRoICs9IGNhcExldmVsICogNTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiAyO1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAxMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRGVhZCkgcmV0dXJuO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonjgrjjg6Pjg7Pjg5fmlLvmkoNcbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA0MCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTY7XG4gICAgICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy52eCAqPSA0O1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIiwgbGlmZVNwYW46IDE1LCB5OiAwfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LnRpdGFuLmpzXG4gKiAgMjAxNy8wNS8wNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/lt6jkurpcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5UaXRhblwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAzMDAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogNyxcbiAgICBkcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyNSwgaGVpZ2h0OiA0MH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMngyXCIsIDI0KjIsIDMyKjIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjE2KjIsIDAsIDcyKjIsIDEyOCoyKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0UG9zaXRpb24oMCwgLTUpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDEwO1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiA1MDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5kaXJlY3Rpb24gPT0gMCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7ot53pm6JcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOeZuuimi+W+jOS4gOWumuaZgumWk+i/vei3oeOBmeOCi1xuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwICYmICF0aGlzLmlzQXR0YWNrICYmIHRoaXMudHVyblRpbWUgPT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDE4MCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnR1cm5UaW1lID0gMTU7XG4gICAgICAgICAgICBpZiAobG9vaykgdGhpcy50dXJuQ291bnQgPSAwO1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgpLopovlpLHjgaPjgZ/nirbmhYvjgafkuInlm57mjK/jgorov5TjgaPjgZ/loLTlkIjjga/ov73ot6HntYLkuoZcbiAgICAgICAgICAgIGlmICh0aGlzLnR1cm5Db3VudCA+IDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v5LiA5a6a6Led6Zui5Lul5LiK6Zui44KM44Gf44KJ6L+96Leh6Kej6ZmkXG4gICAgICAgIGlmIChkaXMgPiA1MTIpIHRoaXMuY2hhc2VUaW1lID0gMDtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDAuNTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0wLjU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pc0p1bXApIHRoaXMudnggKj0gMS41O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMTIwO1xuICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMCkgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkgdGhpcy52eCAqPSAzO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/jgZPjgozku6XkuIrpgLLjgoHjgarjgYTloLTlkIjjga/mipjjgorov5TjgZlcbiAgICAgICAgICAgIHZhciBpc1JldHVybldhbGwgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBpc1JldHVybkNsaWZmID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkgaXNSZXR1cm5XYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSs0MCwgNSwgNSkgPT0gbnVsbCkgaXNSZXR1cm5DbGlmZiA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudnggPCAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCB8fCBpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOi/vei3oeS4reOBp+auteW3ruOBjOOBguOCi+WgtOWQiOOBr+mjm+OBs+i2iuOBiOOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5XYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafltJbjgYzjgYLjgovloLTlkIjjga/nnYDlnLDngrnjgYzjgYLjgovjgYvoqr/jgbnjgabpo5vjgbPpmY3jgorjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuQ2xpZmYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqdW1wT2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDk2KSkganVtcE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDk2KSkganVtcE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdW1wT2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC01O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+edgOWcsOeCueOBjOeEoeOBhOWgtOWQiOOBr+irpuOCgeOBpuaKmOOCiui/lOOBmVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50dXJuV2FpdCA9IDE1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiLi4uXCJ9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggKj0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA2NCAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDMwKSB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIGF0ayA9IHFmdC5FbmVteUF0dGFjayh0aGlzLnBhcmVudFNjZW5lLCB7d2lkdGg6IDEsIGhlaWdodDogMjQsIHBvd2VyOiA0MCArIHRoaXMubGV2ZWwgKiA1fSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuZW5lbXlMYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDE4LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC4wKTtcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikgYXRrLnNldEFscGhhKDAuMyk7XG4gICAgICAgIGF0ay5tYXN0ZXIgPSB0aGlzO1xuICAgICAgICBhdGsudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgYXRrLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhhdC54ICsgdGhhdC5zY2FsZVggKiAxODtcbiAgICAgICAgfVxuXG4gICAgICAgIGF0ay5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgICBhdGsudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCg2KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGF0LnZ4ID0gMjQgKiB0aGF0LnNjYWxlWDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg2KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGF0ay5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuXG4gICAgICAgIHFmdC5DaGFyYWN0ZXIuYmFsbG9vbih7cGF0dGVybjogXCJhbmdlcjJcIn0pLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oMCwgLXRoaXMuaGVpZ2h0LzItMTApO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15Lndpc3AuanNcbiAqICAyMDE2LzEyLzMxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCpuOCo+OCueODl1xucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lldpc3BcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMzYwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAxMDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9TVE9ORSxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAwLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9TVE9ORSxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlRmlyZTogMC44LFxuICAgIGRhbWFnZUljZTogMixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyhNYXRoLm1pbih0aGlzLmxldmVsLCA0KSAqIDcyLCA1MTIsIDcyLCAxMjgpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDI7XG4gICAgICAgIHRoaXMuZXllc2lnaHQgKz0gdGhpcy5sZXZlbCAqIDY0LFxuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAyMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJzdGFuZFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLm1vdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hdHRhY2tDb3VudCA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonlr4TjgaPjgabjgYTjgY9cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHZhciBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIocGwueCwgcGwueSk7XG4gICAgICAgICAgICB2YXIgcCA9IHAyLnN1YihwMSk7XG4gICAgICAgICAgICBwLm5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgdGhpcy52eCA9IHAueCAqICgxICsgdGhpcy5sZXZlbCAqIDAuMik7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gcC55ICogKDEgKyB0aGlzLmxldmVsICogMC4yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICAvL+aUu+aSg1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDMgJiYgZGlzIDwgMTI4KSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFja0NvdW50LS07XG4gICAgICAgICAgICBpZiAodGhpcy5hdHRhY2tDb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxldmVsOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiV2lzcEJvbWJcIiwge3BhdHRlcm46IDF9KTtcbiAgICAgICAgICAgICAgICAgICAgYi52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgYi52eCA9IChpKjIpICogdGhpcy5zY2FsZVg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrQ291bnQgPSAxODAgLSB0aGlzLmxldmVsICogMTU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFja0NvdW50ID0gNjA7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuXG4vL+OCpuOCo+OCueODl++8iOW8t++8iVxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lldpc3BIYXJkXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMjAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDM2MCxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMzAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fU1RPTkUsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogNSxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZUZpcmU6IDAuNSxcbiAgICBkYW1hZ2VJY2U6IDIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjg4LCA1MTIsIDcyLCAxMjgpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwic3RhbmRcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5tb3ZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYXR0YWNrQ291bnQgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6L+R44GP44Gr44GE44Gf44KJ5a+E44Gj44Gm44GE44GPXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICAgICAgdmFyIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHBsYXllci54LCBwbGF5ZXIueSk7XG4gICAgICAgICAgICB2YXIgcCA9IHAyLnN1YihwMSk7XG4gICAgICAgICAgICBwLm5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgdGhpcy52eCA9IHAueCAvIDI7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gcC55IC8gMjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICAvL+aUu+aSg1xuICAgICAgICBpZiAoZGlzIDwgMTYwKSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFja0NvdW50LS07XG4gICAgICAgICAgICBpZiAodGhpcy5hdHRhY2tDb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxldmVsKzQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJXaXNwQm9tYlwiLCB7cGF0dGVybjogMX0pO1xuICAgICAgICAgICAgICAgICAgICBiLnZ5ID0gLTEwO1xuICAgICAgICAgICAgICAgICAgICBiLnZ4ID0gKGkqMikgKiB0aGlzLnNjYWxlWDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2tDb3VudCA9IDE4MCAtIHRoaXMubGV2ZWwgKiAxNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNrQ291bnQgPSA2MDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG5cbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5XaXNwQm9tYlwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAwLjk5LFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDAsXG5cbiAgICAvL+eEoeaVteODleODqeOCsFxuICAgIGlzTXV0ZWtpOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHt3aWR0aDogMTAsIGhlaWdodDogMTB9KTtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgIHRoaXMuJGV4dGVuZChvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwicGFydGljbGVcIiwgMTYsIDE2KS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoMzEpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcblxuICAgICAgICB0aGlzLnBhdHRlcm4gPSBvcHRpb25zLnBhdHRlcm4gfHwgMTtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJwYXR0ZXJuXCIrdGhpcy5wYXR0ZXJuKTtcblxuICAgICAgICB0aGlzLm9uKCdkZWFkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9uU2NyZWVuKSBhcHAucGxheVNFKFwiYm9tYlwiKTtcbiAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIkZsYW1lXCIsIHtwYXR0ZXJuOiAxfSk7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjFcIl0gPSBbMzEsIDMwLCAyOSwgMjgsIDI3LCAyNiwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjJcIl0gPSBbMzEsIDMwLCAyOSwgMjgsIDI3LCAyNiwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS53aXphcmQuanNcbiAqICAyMDE3LzA4LzA5XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCpuOCo+OCtuODvOODiVxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LldpemFyZFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDUwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAzNjAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAzMDAwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMzAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwM1wiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRGcmFtZVRyaW1taW5nKDAsIDAsIDcyLCAxMjgpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMS4yKTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiAyO1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAzMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSAxO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgLy/ooYzli5Xjg5Xjgqfjg7zjgrpcbiAgICAgICAgdGhpcy5waGFzZSA9IFwid2FpdFwiO1xuXG4gICAgICAgIC8v5o6l6L+R5oim57WM6YGO5pmC6ZaTXG4gICAgICAgIHRoaXMubmVhckNvdW50ID0gMDtcblxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5kaXJlY3Rpb24gPT0gMCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsYXllciA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG4gICAgICAgIHZhciBkaXN0YW5jZSA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcblxuICAgICAgICAvL+W+heapn+S4rVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSBcIndhaXRcIikge1xuICAgICAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTV9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gXCJhcHByb2FjaFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozmjqXov5FcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJhcHByb2FjaFwiKSB7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlzdGFuY2UgPCAxMjgpIHtcbiAgICAgICAgICAgIHRoaXMubmVhckNvdW50KytcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmVhckNvdW50ID0gMDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODhuODrOODneODvOODiOmWi+Wni1xuICAgIHRlbGVwb3J0SW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmZhZGVPdXQoMzApO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgdmFyIHNwID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDNcIiwgMjQsIDMyKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgNzIsIDEyOCk7XG4gICAgICAgICAgICBzcC50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuYnkoe3g6IC02NCArIGkgKiAxNiwgYWxwaGE6IC0xfSwgMzAsXCJlYXNlT3V0U2luZVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODhuODrOODneODvOODiOe1guS6hlxuICAgIHRlbGVwb3J0T3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5mYWRlSW4oMzApO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgdmFyIHNwID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDNcIiwgMjQsIDMyKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgNzIsIDEyOCk7XG4gICAgICAgICAgICBzcC50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuYnkoe3g6IC02NCArIGkgKiAxNiwgYWxwaGE6IC0xfSwgMzAsXCJlYXNlT3V0U2luZVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+WIhui6q1xuICAgIGNsb25lTXlTZWxmOiBmdW5jdGlvbigpIHtcbiAgICB9LFxuXG4gICAgLy/ngavngo7prZTms5VcbiAgICBmbGFtZTogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBmaXJzdEZyYW1lOiBmdW5jdGlvbigpIHtcbiAgICB9LFxufSk7XG5cbi8v44Km44Kj44K244O844OJ5YiG6LqrXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuV2l6YXJkQ2xvbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMCxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAwLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTZ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHZhciBsdiA9IE1hdGgubWluKHRoaXMubGV2ZWwsIDMpO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAzXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygobHYgJSAyKSAqIDE0NCArIDcyLCBNYXRoLmZsb29yKGx2IC8gMikgKiAxMjgsIDcyLCAxMjgpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRTY2FsZSgxLjIpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNUZWxlcG9ydCA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuXG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgaXRlbS5qc1xuICogIDIwMTcvMDEvMDRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Ki44Kk44OG44Og44Kv44Op44K5XG5waGluYS5kZWZpbmUoXCJxZnQuSXRlbVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuQ2hhcmFjdGVyXCIsXG5cbiAgICAvL+itmOWIpeODleODqeOCsFxuICAgIGlzSXRlbTogdHJ1ZSxcblxuICAgIC8v44Ki44Kk44OG44Og56iu5YilXG4gICAga2luZDogMCxcblxuICAgIC8v44Ki44Kk44OG44Og44Os44OZ44OrXG4gICAgbGV2ZWw6IDAsXG5cbiAgICAvL+aNqOOBpuOCouOCpOODhuODoFxuICAgIHRocm93QXdheTogZmFsc2UsXG5cbiAgICAvL+Wkp+OBvuOBi+OBqueoruWIpeODleODqeOCsFxuICAgIGlzV2VhcG9uOiBmYWxzZSxcbiAgICBpc0VxdWlwOiBmYWxzZSxcbiAgICBpc0Zvb2Q6IGZhbHNlLFxuICAgIGlzSXRlbTogZmFsc2UsXG4gICAgaXNLZXk6IGZhbHNlLFxuXG4gICAgLy/mlbXjg4njg63jg4Pjg5fjgqLjgqTjg4bjg6Djg5Xjg6njgrBcbiAgICBpc0VuZW15RHJvcDogZmFsc2UsXG5cbiAgICAvL+OCouOCpOODhuODoOaDheWgsVxuICAgIHN0YXR1czogbnVsbCxcblxuICAgIC8v5Y+N55m65L+C5pWwXG4gICAgcmVib3VuZDogMC4zLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PpgLLooYzlj6/og73jg5Xjg6njgrAgICBcbiAgICBpc0FkdmFuY2VBbmltYXRpb246IGZhbHNlLFxuXG4gICAgLy/lvbHooajnpLrjg5Xjg6njgrBcbiAgICBpc1NoYWRvdzogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwge3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuXG4gICAgICAgIC8v44Ki44Kk44OG44Og44Os44OZ44OrXG4gICAgICAgIHRoaXMubGV2ZWwgPSAwO1xuICAgICAgICB0aGlzLmtpbmQgPSBudWxsO1xuICAgICAgICBpZiAob3B0aW9ucy5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICB0aGlzLmxldmVsID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmxldmVsIHx8IDA7XG4gICAgICAgICAgICB0aGlzLmtpbmQgPSBvcHRpb25zLnByb3BlcnRpZXMua2luZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5raW5kICE9PSB1bmRlZmluZWQpIHRoaXMua2luZCA9IG9wdGlvbnMua2luZDtcblxuICAgICAgICAvL+OCouOCpOODhuODoOeoruWIpVxuICAgICAgICBpZiAodGhpcy5raW5kID09IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLm5hbWUgPT0gXCJmb29kXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmtpbmQgPSBJVEVNX0FQUExFICsgdGhpcy5sZXZlbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBcIklURU1fXCIrb3B0aW9ucy5uYW1lLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5raW5kID0gZXZhbChuYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy5raW5kID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB2YXIgbmFtZSA9IFwiSVRFTV9cIit0aGlzLmtpbmQudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIHRoaXMua2luZCA9IGV2YWwobmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+OCouOCpOODhuODoOOCueODhuODvOOCv+OCueWPluW+l1xuICAgICAgICB0aGlzLiRleHRlbmQocWZ0Lkl0ZW1JbmZvLmdldCh0aGlzLmtpbmQpKTtcblxuICAgICAgICAvL+OCouOCpOODhuODoOOCueODl+ODqeOCpOODiFxuICAgICAgICBpZiAodGhpcy5pc1dlYXBvbikge1xuICAgICAgICAgICAgLy/mrablmajjga7loLTlkIhcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXMua2luZCAqIDEwICsgTWF0aC5taW4odGhpcy5sZXZlbCwgdGhpcy5tYXhJbmRleCk7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleChpbmRleCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsID4gMCkge1xuICAgICAgICAgICAgICAgIC8v5by35YyW44Os44OZ44Or6KGo56S6XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogMTAsXG4gICAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIitcIit0aGlzLmxldmVsfS4kc2FmZShsYWJlbFBhcmFtKSkuc2V0UG9zaXRpb24oNiwgNikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJpdGVtXCIsIDI0LCAyNCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KHRoaXMua2luZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+Wvv+WRvVxuICAgICAgICB0aGlzLmxpZmVTcGFuID0gMTUwO1xuXG4gICAgICAgIC8v44Ki44Kv44OG44Kj44OW44OV44Op44KwXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWN0aXZlID09PSB1bmRlZmluZWQgfHwgdGhpcy5vcHRpb25zLmFjdGl2ZSA9PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub24oJ2VudGVyZnJhbWUnLCBlID0+IHtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgIGlmICh0aGlzLmhpdFRlc3RFbGVtZW50KHBsKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgPiAxMCAmJiAhdGhpcy50aHJvd0F3YXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcGwuZ2V0SXRlbSh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGltZSA+IDMwICYmIHRoaXMudGhyb3dBd2F5KSB0aGlzLnRocm93QXdheSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0VuZW15RHJvcCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxpZmVTcGFuID09IDApIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGlmZVNwYW4gPCAzMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMiA9PSAwKSB0aGlzLnZpc2libGUgPSAhdGhpcy52aXNpYmxlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDYwKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudGltZSAlIDUgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubGlmZVNwYW4gPCA5MCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMTAgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5saWZlU3Bhbi0tO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxufSk7XG5cbnBoaW5hLmRlZmluZShcInFmdC5JdGVtSW5mb1wiLCB7XG4gICAgX3N0YXRpYzoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKGtpbmQpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoa2luZCkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzaG9ydHN3b3JkXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1NIT1JUU1dPUkQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlNIT1JUIFNXT1JEXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN3b3JkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1dlYXBvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzU2xhc2g6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHVuUG93ZXI6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxNCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDMwXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImxvbmdzd29yZFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9MT05HU1dPUkQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkxPTkcgU1dPUkRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3dvcmRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzV2VhcG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTbGFzaDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAxNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA3LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDI0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYXhcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQVg6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkFYXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImF4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1dlYXBvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzU2xhc2g6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0Jyb3c6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHVuUG93ZXI6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAyNlxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzcGVhclwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9TUEVBUjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiU1BFQVJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3BlYXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzV2VhcG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTdGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDM5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYm93XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0JPVzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQk9XXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvd1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNXZWFwb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0Jyb3c6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwicm9kXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1JPRDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiTUFHSUMgUk9EXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInJvZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNXZWFwb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0Jyb3c6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZpcmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogNyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImJvb2tcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQk9PSzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQk9PS1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29rXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1dlYXBvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQnJvdzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSG9seTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogNDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDIwXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInNoaWVsZFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9TSElFTEQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlNISUVMRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJlcXVpcFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNFcXVpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAxMDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJhcm1vclwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9BUk1PUjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQVJNT1JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZXF1aXBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRXF1aXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMzAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogNTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiaGF0XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0hBVDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiSEFUXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVxdWlwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VxdWlwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYm9vdHNcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQk9PVFM6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkJPT1RTXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVxdWlwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VxdWlwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDUwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZ3JvdmVcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fR1JPVkU6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkdST1ZFXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVxdWlwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VxdWlwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDUwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwicmluZ1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9SSU5HOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJSSU5HXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVxdWlwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VxdWlwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDMwMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInNjcm9sbFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9TQ1JPTEw6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlNDUk9MTFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpdGVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0l0ZW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwibGV0dGVyXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0xFVFRFUjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiTEVUVEVSXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAxMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImNhcmRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQ0FSRDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQ0FSRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpdGVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0l0ZW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwia2V5XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0tFWTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiS0VZXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImtleVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNLZXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMjAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY29pblwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9DT0lOOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJDT0lOXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiA1MDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImJhZ1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9CQUc6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkJBR1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpdGVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0l0ZW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwib3JiXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX09SQjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiT1JCXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiA1MDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdG9uZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9TVE9ORTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiU1RPTkVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaXRlbVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNJdGVtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDIwMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImpld2VsXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0pFV0VMOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJKRVdFTFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpdGVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0l0ZW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogNTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiamV3ZWxib3hcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fSkVXRUxCT1g6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkpFV0VMQk9YXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAxMDAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYXBwbGVcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQVBQTEU6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkFQUExFXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImZvb2RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRm9vZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiaGFyYlwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9IQVJCOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJIQVJCXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImZvb2RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRm9vZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiA0MCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwibWVhdFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9NRUFUOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJNRUFUXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImZvb2RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRm9vZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiA2MCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwicG90aW9uXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1BPVElPTjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiUE9USU9OXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImZvb2RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRm9vZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgIH0sXG59KTtcblxuIiwiLypcbiAqICBpdGVtYm94LmpzXG4gKiAgMjAxNy8wMS8wNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqLjgqTjg4bjg6Djg5zjg4Pjgq/jgrnjgq/jg6njgrlcbnBoaW5hLmRlZmluZShcInFmdC5JdGVtQm94XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNJdGVtQm94OiB0cnVlLFxuXG4gICAgLy/ogJDkuYXliptcbiAgICBocDogMSxcblxuICAgIC8v6ZaL44GE44Gf44OV44Op44KwXG4gICAgb3BlbmVkOiBmYWxzZSxcblxuICAgIC8v44Ki44Kk44OG44Og56iu5YilXG4gICAga2luZDogMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDMsXG5cbiAgICAvL+WPjeeZuuS/guaVsFxuICAgIHJlYm91bmQ6IDAuMyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IDI2LCBoZWlnaHQ6IDI2fS4kc2FmZShvcHRpb25zLnByb3BlcnRpZXMpKTtcblxuICAgICAgICAvL+OCouOCpOODhuODoOODnOODg+OCr+OCueOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiaXRlbWJveFwiLCAzMiwgMzIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFNjYWxlKDAuOClcbiAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KDApO1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwiY2xvc2VcIik7XG5cbiAgICAgICAgLy/lhoXlrrnnialcbiAgICAgICAgdGhpcy5uYW1lID0gb3B0aW9ucy5uYW1lO1xuICAgICAgICB0aGlzLmtpbmQgPSBvcHRpb25zLnByb3BlcnRpZXM/IG9wdGlvbnMucHJvcGVydGllcy5raW5kOiB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGV2ZWwgPSBvcHRpb25zLnByb3BlcnRpZXM/IG9wdGlvbnMucHJvcGVydGllcy5sZXZlbDogMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wZW5lZCkge1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmlLvmkoPvvIjlm7rlrprvvInjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgaWYgKHBsLmlzQXR0YWNrICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQocGwuYXR0YWNrQ29sbGlzaW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGFtYWdlKHBsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O85pS75pKD5Yik5a6a44Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYW1hZ2UoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlOyAgICAvL+eCuea7heOCreODo+ODs+OCu+ODq1xuICAgIH0sXG5cbiAgICBkYW1hZ2U6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICBpZiAodGhpcy5vcGVuZWQpIHJldHVybjtcbiAgICAgICAgdGhpcy5ocCAtPSB0YXJnZXQucG93ZXI7XG4gICAgICAgIHRoaXMubXV0ZWtpVGltZSA9IDEwO1xuICAgICAgICBpZiAodGhpcy5ocCA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy54IDwgdGFyZ2V0LngpIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlQnkoLTUsIDAsIDIpLm1vdmVCeSg1LCAwLCAyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlQnkoNSwgMCwgMikubW92ZUJ5KC01LCAwLCAyKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICB0aGlzLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwib3BlblwiKTtcbiAgICAgICAgc3dpdGNoICh0aGlzLm5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJlbXB0eVwiOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIml0ZW1cIjpcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBraW5kOiB0aGlzLmtpbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogdGhpcy5sZXZlbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25JdGVtKHRoaXMueCwgdGhpcy55LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGkudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLndhaXQoMTApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IHRoaXMubGV2ZWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduSXRlbSh0aGlzLngsIHRoaXMueSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpLnZ5ID0gLTU7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY29sb3IgPT0gXCJnb2xkXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJjbG9zZVwiXSA9IFsyXTtcbiAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJvcGVuXCJdID0gWzIsIDYsIDgsIFwic3RvcFwiXTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuY29sb3IgPT0gXCJyZWRcIikge1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlXCJdID0gWzFdO1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5cIl0gPSBbMSwgNCwgNywgXCJzdG9wXCJdO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5jb2xvciA9PSBcImJsdWVcIikge1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlXCJdID0gWzBdO1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5cIl0gPSBbMCwgMywgNiwgXCJzdG9wXCJdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlXCJdID0gWzFdO1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5cIl0gPSBbMSwgNCwgNywgXCJzdG9wXCJdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgbWFwb2JqZWN0LmFjY2Vzc29yeS5qc1xuICogIDIwMTcvMDEvMTRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnFmdC5NYXBPYmplY3QgPSBxZnQuTWFwT2JqZWN0IHx8IHt9O1xuXG4vL+ODnuODg+ODl+ijhemjvuOCouOCr+OCu+OCteODqlxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5BY2Nlc3NvcnlcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+itmOWIpeODleODqeOCsFxuICAgIGlzTWFwQWNjZXNzb3J5OiB0cnVlLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiAyLFxuXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiB0cnVlLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUoe1xuICAgICAgICAgICAgd2lkdGg6IDMyLFxuICAgICAgICAgICAgaGVpZ2h0OiAzMixcbiAgICAgICAgICAgIGluZGV4OiAwLFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwge3dpZHRoOiB0aGlzLm9wdGlvbnMud2lkdGgsIGhlaWdodDogdGhpcy5vcHRpb25zLmhlaWdodH0pO1xuXG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkO1xuICAgICAgICB0aGlzLmxldmVsID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmxldmVsIHx8IDA7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWzIsIDEsIDAsIDNdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsMlwiXSA9IFsxLCAwLCAzLCAyXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuXG4vL+ODqeODs+ODl1xucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5MYW1wXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5NYXBPYmplY3QuQWNjZXNzb3J5XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImZsYW1lMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoMCk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcodGhpcy5sZXZlbCAqIDI0LCAwLCAyNCwgMTI4KTtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICBpZiAodGhpcy5pZCAlIDIpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWwyXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA4O1xuICAgIH0sXG59KTtcblxuLy/jgZ/jgY3ngatcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuQm9uZmlyZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJmbGFtZTAyXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDApO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKHRoaXMubGV2ZWwgKiAyNCwgMTI4LCAyNCwgMTI4KTtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgfSxcbn0pO1xuXG4vL+eCjlxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5GbGFtZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJmbGFtZTAyXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyh0aGlzLmxldmVsICogMjQgKyA3MiwgMCwgMjQsIDEyOCk7XG5cbiAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PoqK3lrppcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgIH0sXG59KTtcblxuLy/ngatcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuRmlyZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJmbGFtZTA1XCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyh0aGlzLmxldmVsICogMjQgKyA3MiwgMCwgMjQsIDEyOCk7XG5cbiAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PoqK3lrppcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgIH0sXG59KTtcblxuLy/nh63lj7BcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuQ2FuZGxlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5NYXBPYmplY3QuQWNjZXNzb3J5XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImZsYW1lMDVcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKHRoaXMubGV2ZWwgKiAyNCArIDcyLCAxMjgsIDI0LCAxMjgpO1xuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44Oz6Kit5a6aXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcbiAgICB9LFxufSk7XG5cbi8v44Op44Oz44K/44OzXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkxhbnRoYW51bVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJhY2Nlc3NvcnkxXCIsIDE2LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygwLCA5NiwgNzIsIDMyKTtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWzAsIDEsIDIsIDFdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG5cbi8v44Op44Oz44OX77ySXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkNhbmRsZUxhbXBcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0Lk1hcE9iamVjdC5BY2Nlc3NvcnlcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYWNjZXNzb3J5MVwiLCAxNiwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMCwgMzIsIDcyLCAzMik7XG5cbiAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PoqK3lrppcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm5vcm1hbFwiXSA9IFswLCAxLCAyLCAxXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QuYmxvY2suanNcbiAqICAyMDE3LzAzLzEzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5xZnQuTWFwT2JqZWN0ID0gcWZ0Lk1hcE9iamVjdCB8fCB7fTtcblxuLy/jg5bjg63jg4Pjgq/jgq/jg6njgrlcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuQmxvY2tcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+iAkOS5heWKm1xuICAgIGhwOiAzMCxcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNCbG9jazogdHJ1ZSxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMC4wLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PplpPpmpRcbiAgICBhbmltYXRpb25JbnRlcnZhbDogMSxcblxuICAgIGlzQWR2YW5jZUFuaW1hdGlvbjogZmFsc2UsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgICAgICB3aWR0aDogMzIsXG4gICAgICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IHRoaXMub3B0aW9ucy53aWR0aCwgaGVpZ2h0OiB0aGlzLm9wdGlvbnMuaGVpZ2h0fSk7XG5cbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5pbmRleCA9IG9wdGlvbnMuaW5kZXg7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJibG9ja1wiLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCh0aGlzLmluZGV4KTtcblxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDogMzIsXG4gICAgICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsIDAsIDAsIDAuMClcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMud2FrdSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICBpZiAob3B0aW9ucy5lbmFibGVGcmFtZSkgdGhpcy53YWt1LmFkZENoaWxkVG8odGhpcyk7XG5cbiAgICAgICAgLy/jgrnjgq/jg6rjg5fjg4hcbiAgICAgICAgaWYgKG9wdGlvbnMucHJvcGVydGllcy5zY3JpcHQpIHtcbiAgICAgICAgICAgIHZhciBzYyA9IFwiKGZ1bmN0aW9uKGFwcCkge1wiK29wdGlvbnMucHJvcGVydGllcy5zY3JpcHQrXCJ9KVwiO1xuICAgICAgICAgICAgdmFyIGYgPSBldmFsKHNjKTtcbiAgICAgICAgICAgIHRoaXMub24oJ2VudGVyZnJhbWUnLCBmKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub24oJ2RlYWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy53YWt1LnJlbW92ZSgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29sbGlzaW9uKSB0aGlzLmNvbGxpc2lvbi5yZW1vdmUoKTtcbiAgICAgICAgICAgIHZhciBzID0gW107XG4gICAgICAgICAgICBzWzBdID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJibG9ja1wiLCAxNiwgMTYpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oLTgsIC04KS5zZXRGcmFtZUluZGV4KHRoaXMuaW5kZXggKiAyICsgMCk7XG4gICAgICAgICAgICBzWzFdID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJibG9ja1wiLCAxNiwgMTYpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oIDgsIC04KS5zZXRGcmFtZUluZGV4KHRoaXMuaW5kZXggKiAyICsgMSk7XG4gICAgICAgICAgICBzWzJdID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJibG9ja1wiLCAxNiwgMTYpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oLTgsICA4KS5zZXRGcmFtZUluZGV4KHRoaXMuaW5kZXggKiAyICsgMTYgKyAwKTtcbiAgICAgICAgICAgIHNbM10gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJsb2NrXCIsIDE2LCAxNikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbiggOCwgIDgpLnNldEZyYW1lSW5kZXgodGhpcy5pbmRleCAqIDIgKyAxNiArIDEpO1xuICAgICAgICAgICAgLy/jgrnjg5fjg6njgqTjg4jjgYzjg5Djg6njg5Djg6njgavlo4rjgozjgovjgohcbiAgICAgICAgICAgICg0KS50aW1lcyhmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICAgICAgc1tpXS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMudng7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueSArPSB0aGlzLnZ5O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IDAuOTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eSArPSAwLjk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm90YXRpb24gKz0gdGhpcy5yb3Q7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWxwaGEgLT0gMC4wNTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc1tpXS52eCA9IDA7XG4gICAgICAgICAgICAgICAgc1tpXS52eSA9IC01O1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIHNbMF0udnggPSAtNjsgc1swXS5yb3QgPSAtMztcbiAgICAgICAgICAgIHNbMV0udnggPSAgNjsgc1sxXS5yb3QgPSAgMztcbiAgICAgICAgICAgIHNbMl0udnggPSAtMzsgc1syXS5yb3QgPSAtMztcbiAgICAgICAgICAgIHNbM10udnggPSAgMzsgc1szXS5yb3QgPSAgMztcbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLndhaXQoMTApXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAodGhpcy5jb2xsaXNpb24pIHtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnggPSB0aGlzLng7XG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvbi55ID0gdGhpcy55O1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5pc0RlYWQpIHtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O85pS75pKD77yI5Zu65a6a77yJ44Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgIGlmIChwbC5pc0F0dGFjayAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsLmF0dGFja0NvbGxpc2lvbikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhbWFnZShwbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaUu+aSg+WIpOWumuOBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXJMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5QbGF5ZXJBdHRhY2sgJiYgZS5pc0NvbGxpc2lvbiAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGFtYWdlKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTsgICAgLy/ngrnmu4Xjgq3jg6Pjg7Pjgrvjg6tcbiAgICB9LFxuXG4gICAgZGFtYWdlOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNEZWFkKSByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLm11dGVraVRpbWUgPiAwKSByZXR1cm47XG4gICAgICAgIHRoaXMuaHAgLT0gdGFyZ2V0LnBvd2VyO1xuICAgICAgICB0aGlzLm11dGVraVRpbWUgPSAxMDtcbiAgICAgICAgaWYgKHRoaXMuaHAgPD0gMCkge1xuICAgICAgICAgICAgdGhpcy5pc0RlYWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnZGVhZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkaXIgPSAyO1xuICAgICAgICBpZiAodGhpcy54IDwgdGFyZ2V0LngpIGRpciA9IC0yO1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5tb3ZlQnkoZGlyLCAwLCAxKVxuICAgICAgICAgICAgLm1vdmVCeSgtZGlyLCAwLCAxKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiaGl0X2JsdW50XCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v5b2T44Gf44KK5Yik5a6a44Gu6L+95YqgXG4gICAgYWRkQ29sbGlzaW9uOiBmdW5jdGlvbiAobGF5ZXIpIHtcbiAgICAgICAgdGhpcy5jb2xsaXNpb24gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMzIsIGhlaWdodDogMzJ9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8obGF5ZXIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0VmlzaWJsZShERUJVR19DT0xMSVNJT04pO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi5hbHBoYSA9IDAuMztcbiAgICAgICAgdGhpcy5jb2xsaXNpb24udnggPSAwO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi52eSA9IDA7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLmlnbm9yZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi50eXBlID0gXCJibG9ja1wiO1xuICAgIH1cbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QuZG9vci5qc1xuICogIDIwMTcvMDEvMTRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnFmdC5NYXBPYmplY3QgPSBxZnQuTWFwT2JqZWN0IHx8IHt9O1xuXG4vL+Wkp+Wei+ODieOCouOCr+ODqeOCuVxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5Eb29yXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIGlkOiBudWxsLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiAzLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+Wun+ihjOa4iOOBv+ODleODqeOCsFxuICAgIGFscmVhZHk6IGZhbHNlLFxuXG4gICAgLy/jg63jg4Pjgq/jgZXjgozjgabjgYTjgovjgYtcbiAgICBpc0xvY2s6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHdpZHRoID0gb3B0aW9ucy53aWR0aCB8fCAzNjtcbiAgICAgICAgdmFyIGhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IDY0O1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwge3dpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHR9KTtcblxuICAgICAgICAvL+OCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZG9vclwiLCAzNiwgNjQpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCgzKTtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJjbG9zZWRcIik7XG5cbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7XG4gICAgICAgIHRoaXMuaXNMb2NrID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmxvY2sgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMubmFtZSA9IG9wdGlvbnMubmFtZTtcbiAgICAgICAgdGhpcy5lbnRlck9mZnNldCA9IG9wdGlvbnMucHJvcGVydGllcy5lbnRlck9mZnNldCB8fCAwO1xuICAgICAgICB0aGlzLnNwcml0ZS52aXNpYmxlID0gb3B0aW9ucy5wcm9wZXJ0aWVzLnZpc2libGUgPT0gdW5kZWZpbmVkPyB0cnVlOiBvcHRpb25zLnByb3BlcnRpZXMudmlzaWJsZTtcblxuICAgICAgICAvL+ODieOCouapn+iDvVxuICAgICAgICB2YXIgcHJvcGVydGllcyA9IG9wdGlvbnMucHJvcGVydGllcztcbiAgICAgICAgc3dpdGNoIChvcHRpb25zLm5hbWUpIHtcbiAgICAgICAgICAgIC8v44Kv44Oq44KiXG4gICAgICAgICAgICBjYXNlIFwiY2xlYXJcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmlzTG9jayA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5vbignZW50ZXJkb29yJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoJ3N0YWdlY2xlYXInKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIC8v44Oe44OD44OX5YaF56e75YuVXG4gICAgICAgICAgICBjYXNlIFwid2FycFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubmV4dElEID0gcHJvcGVydGllcy5uZXh0SUQ7XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSBwcm9wZXJ0aWVzLm9mZnNldCB8fCAwO1xuICAgICAgICAgICAgICAgIHRoaXMub24oJ2VudGVyZG9vcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ihjOOBjeWFiOOBruaknOe0olxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMuZmluZERvb3IodGhpcy5uZXh0SUQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5leHQpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbnRlclBsYXllcigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLndhcnAobmV4dC54LCBuZXh0LnkrbmV4dC5vZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoMTIwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFscmVhZHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0LmxlYXZlUGxheWVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgLy/jg57jg4Pjg5fliIfjgormm7/jgYhcbiAgICAgICAgICAgIGNhc2UgXCJtYXBzd2l0Y2hcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5leHRJRCA9IHByb3BlcnRpZXMubmV4dElEO1xuICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gcHJvcGVydGllcy5vZmZzZXQgfHwgMDtcbiAgICAgICAgICAgICAgICB0aGlzLnRvTGF5ZXJOdW1iZXIgPSBwcm9wZXJ0aWVzLnRvTGF5ZXJOdW1iZXI7XG4gICAgICAgICAgICAgICAgdGhpcy5vbignZW50ZXJkb29yJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXllciA9IHRoaXMucGFyZW50U2NlbmUuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyW3RoaXMudG9MYXllck51bWJlcl07XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gdGhpcy5wYXJlbnRTY2VuZS5zdGFnZUNvbnRyb2xsZXIuZmluZE9iamVjdCh0aGlzLm5leHRJRCwgdGhpcy50b0xheWVyTnVtYmVyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0KSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW50ZXJQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnN3aXRjaE1hcChsYXllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIuc2V0UG9zaXRpb24obmV4dC54LCBuZXh0LnkgKyBuZXh0Lm9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbHJlYWR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dC5sZWF2ZVBsYXllcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mZy50d2VlbmVyLmNsZWFyKCkud2FpdCgzMCkuZmFkZUluKDMwKS5mYWRlT3V0KDMwKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy/ov5HjgY/jgavmnaXjgZ/jgonoh6rli5XnmoTjgavplovjgZHjgotcbiAgICAgICAgaWYgKHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKSA8IDY0KSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNMb2NrKSB0aGlzLm9wZW4oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vd0FuaW1hdGlvbiA9PSBcIm9wZW5cIikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgaGl0ID0gdGhpcy5oaXRUZXN0RWxlbWVudChwbCk7XG4gICAgICAgIGlmIChoaXQgJiYgIXRoaXMuaXNMb2NrICYmICF0aGlzLmFscmVhZHkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm5hbWUgPT0gXCJjbGVhclwiKSB7XG4gICAgICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLjga7miYnjga/nhKHmnaHku7bjgaflhaXjgotcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdlbnRlcmRvb3InKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFscmVhZHkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5kXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlZFwiXSA9IFsyLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJvcGVuXCJdID0gWzIsIDEsIDAsIDMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlXCJdID0gWzMsIDAsIDEsIDIsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIG9wZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm9wZW5cIik7XG4gICAgfSxcblxuICAgIGNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJjbG9zZVwiKTtcbiAgICB9LFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzmiYnjgavlhaXjgotcbiAgICBlbnRlclBsYXllcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBlbnRlck9mZnNldCA9IHRoaXMuZW50ZXJPZmZzZXQ7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgcGxheWVyLmFscGhhID0gMDtcbiAgICAgICAgcGxheWVyLmlzQ29udHJvbCA9IGZhbHNlO1xuICAgICAgICBwbGF5ZXIuaXNNdXRla2kgPSB0cnVlO1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24ocGxheWVyLngsIHBsYXllci55KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgIC5tb3ZlVG8odGhpcy54LCB0aGlzLnkrdGhpcy5oZWlnaHQvMi0xNitlbnRlck9mZnNldCwgMTUpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZmFkZU91dCgxNSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O844GM5omJ44GL44KJ5Ye644KLXG4gICAgbGVhdmVQbGF5ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHBsYXllci5hbHBoYSA9IDA7XG4gICAgICAgIHBsYXllci5pc0NvbnRyb2wgPSBmYWxzZTtcbiAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55KzE2KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgIHBsLmFscGhhID0gMDtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiZG93blwiKTtcbiAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLm1vdmVUbyhwbGF5ZXIueCwgcGxheWVyLnksIDMwKVxuICAgICAgICAgICAgLmZhZGVJbigxMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsYXllci5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgcGxheWVyLmlzQ29udHJvbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcGwucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/ku5bjga7miYnjgpLmpJzntKJcbiAgICBmaW5kRG9vcjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG51bGw7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUub2JqTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5NYXBPYmplY3QuRG9vcikge1xuICAgICAgICAgICAgICAgIGlmIChlLmlkID09IGlkKSByZXN1bHQgPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgbWFwb2JqZWN0LmZsb29yLmpzXG4gKiAgMjAxNy8wMy8yN1xuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucWZ0Lk1hcE9iamVjdCA9IHFmdC5NYXBPYmplY3QgfHwge307XG5cbi8v5Y+v5YuV44OV44Ot44Ki44Kv44Op44K5XG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkZsb29yXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIGlkOiBudWxsLFxuXG4gICAgLy/orZjliKXjg5Xjg6njgrBcbiAgICBpc0Zsb29yOiB0cnVlLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjAsXG5cbiAgICAvL+enu+WLleODleODqeOCsFxuICAgIGlzQWN0aXZlOiB0cnVlLFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzkuIrjgavkuZfjgaPjgabjgovjg5Xjg6njgrBcbiAgICBpc09uUGxheWVyOiBmYWxzZSxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6YCy6KGM5Y+v6IO944OV44Op44KwXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiBmYWxzZSxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/np7vli5Xjg5HjgrlcbiAgICBtb3ZlUGF0aDogbnVsbCxcblxuICAgIC8v56e75YuV44OR44K554++5Zyo5pmC6ZaTKDAtMSlcbiAgICBwYXRoVGltZTogMCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgICAgICB3aWR0aDogMzIsXG4gICAgICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IHRoaXMub3B0aW9ucy53aWR0aCwgaGVpZ2h0OiB0aGlzLm9wdGlvbnMuaGVpZ2h0fSk7XG5cbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7XG5cbiAgICAgICAgdGhpcy5tb3ZlVHlwZSA9IG9wdGlvbnMucHJvcGVydGllcy5tb3ZlVHlwZSB8fCBcImxpbmVhclwiO1xuICAgICAgICB0aGlzLm1vdmVBbmdsZSA9IG9wdGlvbnMucHJvcGVydGllcy5tb3ZlQW5nbGUgfHwgMDtcbiAgICAgICAgdGhpcy5tb3ZlTGVuZ3RoID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm1vdmVMZW5ndGggfHwgMDtcbiAgICAgICAgdGhpcy5tb3ZlUmFkaXVzID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm1vdmVSYWRpdXMgfHwgNjQ7XG4gICAgICAgIHRoaXMubW92ZVNwZWVkID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm1vdmVTcGVlZCB8fCA2MDtcbiAgICAgICAgdGhpcy5tb3ZlV2FpdCA9IChvcHRpb25zLnByb3BlcnRpZXMubW92ZVdhaXQgIT09IHVuZGVmaW5lZCk/IG9wdGlvbnMucHJvcGVydGllcy5tb3ZlV2FpdDogNjA7XG5cbiAgICAgICAgLy/lp4vngrnjgajntYLngrlcbiAgICAgICAgdGhpcy5zdGFydFggPSBvcHRpb25zLnggKyAob3B0aW9ucy53aWR0aCB8fCAxNikgLyAyO1xuICAgICAgICB0aGlzLnN0YXJ0WSA9IG9wdGlvbnMueSArIChvcHRpb25zLmhlaWdodCB8fCAxNikgLyAyO1xuICAgICAgICBpZiAodGhpcy5tb3ZlTGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy/np7vli5Xot53pm6LjgYzoqK3lrprjgZXjgozjgabjgYTjgovloLTlkIhcbiAgICAgICAgICAgIHZhciByYWQgPSB0aGlzLm1vdmVBbmdsZS50b1JhZGlhbigpO1xuICAgICAgICAgICAgdGhpcy5lbmRYID0gdGhpcy5zdGFydFggKyBNYXRoLmNvcyhyYWQpICogdGhpcy5tb3ZlTGVuZ3RoO1xuICAgICAgICAgICAgdGhpcy5lbmRZID0gdGhpcy5zdGFydFkgKyBNYXRoLnNpbihyYWQpICogdGhpcy5tb3ZlTGVuZ3RoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy/ntYLngrnluqfmqJnjgYzoqK3lrprjgZXjgozjgabjgYTjgovloLTlkIhcbiAgICAgICAgICAgIHRoaXMuZW5kWCA9IG9wdGlvbnMucHJvcGVydGllcy5lbmRYIHx8IHRoaXMuc3RhcnRYO1xuICAgICAgICAgICAgdGhpcy5lbmRZID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmVuZFkgfHwgdGhpcy5zdGFydFk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WGhumBi+WLleOBruWgtOWQiOOBr+S4reW/g+OCkuioreWumu+8iOeEoeOBhOWgtOWQiOOBr+e1gueCueOCkuS4reW/g+OBqOOBmeOCi++8iVxuICAgICAgICBpZiAodGhpcy5tb3ZlVHlwZSA9PSBcImNpcmNsZVwiKSB7XG4gICAgICAgICAgICB0aGlzLmNlbnRlclggPSBvcHRpb25zLnByb3BlcnRpZXMuY2VudGVyWCB8fCB0aGlzLmVuZFg7XG4gICAgICAgICAgICB0aGlzLmNlbnRlclkgPSBvcHRpb25zLnByb3BlcnRpZXMuY2VudGVyWSB8fCB0aGlzLmVuZFk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+enu+WLleODkeOCv+ODvOODs1xuICAgICAgICBzd2l0Y2ggKHRoaXMubW92ZVR5cGUpIHtcbiAgICAgICAgICAgIC8v55u057ea6YGL5YuVXG4gICAgICAgICAgICBjYXNlIFwibGluZWFyXCI6XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLm1vdmVUbyh0aGlzLmVuZFgsIHRoaXMuZW5kWSwgdGhpcy5tb3ZlU3BlZWQsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHt0aGlzLmZsYXJlKCdtb3ZlZW5kJyk7fS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCh0aGlzLm1vdmVXYWl0KVxuICAgICAgICAgICAgICAgICAgICAubW92ZVRvKHRoaXMuc3RhcnRYLCB0aGlzLnN0YXJ0WSwgdGhpcy5tb3ZlU3BlZWQsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHt0aGlzLmZsYXJlKCdtb3Zlc3RhcnQnKTt9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC53YWl0KHRoaXMubW92ZVdhaXQpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgLy/lhobpgYvli5VcbiAgICAgICAgICAgIGNhc2UgXCJjaXJjbGVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmFuZ2xlID0gMDtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5wcm9wZXJ0aWVzLmNvdW50ZXJDbG9ja1dpc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/lj43mmYLoqIjlm57jgopcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50byh7YW5nbGU6IC0zNjB9LCB0aGlzLm1vdmVTcGVlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge3RoaXMuZmxhcmUoJ21vdmVlbmQnKTt9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0KHthbmdsZTogMH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0TG9vcCh0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL+aZguioiOWbnuOCilxuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRvKHthbmdsZTogMzYwfSwgdGhpcy5tb3ZlU3BlZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHt0aGlzLmZsYXJlKCdtb3ZlZW5kJyk7fS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldCh7YW5nbGU6IDB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v6Kit5a6a44GV44KM44Gf44OR44K544Gr5rK/44Gj44Gm56e75YuVXG4gICAgICAgICAgICBjYXNlIFwicGF0aFwiOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5pbmRleCA9IG9wdGlvbnMucHJvcGVydGllcy5pbmRleCB8fCAwO1xuICAgICAgICB2YXIgc3cgPSBNYXRoLmZsb29yKHRoaXMud2lkdGggLyAxNik7XG4gICAgICAgIHZhciBzaCA9IE1hdGguZmxvb3IodGhpcy5oZWlnaHQgLyAxNikrMzI7XG4gICAgICAgIHZhciB0b3AgPSB0aGlzLmhlaWdodCAvIDI7XG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgc3c7IHgrKykge1xuICAgICAgICAgICAgdmFyIGlkeCA9ICh4ICUgMikgKyAxO1xuICAgICAgICAgICAgaWYgKHggPT0gMCkgaWR4ID0gMDtcbiAgICAgICAgICAgIGlmICh4ID09IHN3LTEpIGlkeCA9IDM7XG4gICAgICAgICAgICB2YXIgcyA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZmxvb3JcIiwgMTYsIDk2KVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldEZyYW1lVHJpbW1pbmcodGhpcy5pbmRleCAqIDY0LCAzMiwgNjQsIDk2KVxuICAgICAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KGlkeClcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oeCAqIDE2IC0gdGhpcy53aWR0aCAvIDIgKyA4LCAxNi10b3ApO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAodGhpcy5tb3ZlVHlwZSA9PSBcImNpcmNsZVwiKSB7XG4gICAgICAgICAgICB2YXIgcmFkID0gdGhpcy5yYWRpdXMudG9SYWRpYW4oKTtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoaXMuY2VudGVyWCArIE1hdGguY29zKHJhZCkgKiB0aGlzLm1vdmVSYWRpdXM7XG4gICAgICAgICAgICB0aGlzLnkgPSB0aGlzLmNlbnRlclkgKyBNYXRoLnNpbihyYWQpICogdGhpcy5tb3ZlUmFkaXVzO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubW92ZVR5cGUgPT0gJ3BhdGgnKSB7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WBnOatouOBqOWGjeeUn1xuICAgICAgICBpZiAoIXRoaXMuaXNBY3RpdmUpIHRoaXMudHdlZW5lci5wYXVzZSgpO1xuICAgICAgICBpZiAodGhpcy5pc0FjdGl2ZSkgdGhpcy50d2VlbmVyLnBsYXkoKTtcblxuICAgICAgICBpZiAodGhpcy5jb2xsaXNpb24pIHtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnZ4ID0gdGhpcy54IC0gdGhpcy5jb2xsaXNpb24ueDtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnZ5ID0gdGhpcy55IC0gdGhpcy5jb2xsaXNpb24ueTtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnggPSB0aGlzLng7XG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvbi55ID0gdGhpcy55O1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzkuIrjgavkuZfjgaPjgabjgYTjgovjgYvliKTlrppcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHRoaXMuaXNPblBsYXllciA9IGZhbHNlO1xuICAgICAgICBpZiAocGwuZmxvb3JPYmplY3QgJiYgcGwuZmxvb3JPYmplY3QucGFyZW50T2JqZWN0ID09PSB0aGlzKSB7XG4gICAgICAgICAgICB0aGlzLmlzT25QbGF5ZXIgPSB0cnVlO1xuICAgICAgICAgICAgLy/luorjgYzkuIvpmY3jgZfjgabjgYTjgovmmYLjga7jgb9cbiAgICAgICAgICAgIGlmICghcGwuaXNKdW1wICYmIHRoaXMuY29sbGlzaW9uLnZ5ID4gMCkge1xuICAgICAgICAgICAgICAgIHBsLnkgPSB0aGlzLnkgLSB0aGlzLmhlaWdodCAqIDAuNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODleODreOCouW9k+OBn+OCiuWIpOWumuOBrui/veWKoFxuICAgIGFkZENvbGxpc2lvbjogZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IHRoaXMud2lkdGgsIGhlaWdodDogdGhpcy5oZWlnaHR9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8obGF5ZXIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0VmlzaWJsZShERUJVR19DT0xMSVNJT04pO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi5hbHBoYSA9IDAuMztcbiAgICAgICAgdGhpcy5jb2xsaXNpb24udnggPSAwO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi52eSA9IDA7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLmlnbm9yZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi50eXBlID0gXCJtb3ZlZmxvb3JcIjtcbiAgICAgICAgdGhpcy5jb2xsaXNpb24ucGFyZW50T2JqZWN0ID0gdGhpcztcbiAgICB9LFxuXG4gICAgLy/np7vli5Xjg5Hjgrnjga7oqK3lrppcbiAgICBzZXRQYXRoOiBmdW5jdGlvbihzdGFydFgsIHN0YXJ0WSwgcGF0aCwgbG9vcCkge1xuICAgICAgICB0aGlzLnggPSBzdGFydFg7XG4gICAgICAgIHRoaXMueSA9IHN0YXJ0WTtcbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcbiAgICAgICAgdGhpcy5sb29wID0gbG9vcDtcblxuICAgICAgICBpZiAobG9vcCkge1xuICAgICAgICAgICAgLy/ot53pm6LoqIjnrpdcbiAgICAgICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwMSA9IHBhdGhbaV07XG4gICAgICAgICAgICAgICAgdmFyIHAyID0gcGF0aFtpKzFdO1xuICAgICAgICAgICAgICAgIHAyLm1hZ25pdHVkZSA9IE1hdGguc3FydCgocDIueCAtIHAxLngpICogKHAyLnggLSBwMS54KSArIChwMi55IC0gcDEueSkgKiAocDIueSAtIHAxLnkpKTtcbiAgICAgICAgICAgICAgICBzdW0gKz0gcDIubWFnbml0dWRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/ntYLngrnjgYvjgonlp4vngrnjgb7jgafjga7ot53pm6LjgpLliqDnrpdcbiAgICAgICAgICAgIHZhciBwMSA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIHZhciBwMiA9IHBhdGhbMF07XG4gICAgICAgICAgICBwMi5tYWduaXR1ZGUgPSBNYXRoLnNxcnQoKHAyLnggLSBwMS54KSAqIChwMi54IC0gcDEueCkgKyAocDIueSAtIHAxLnkpICogKHAyLnkgLSBwMS55KSk7XG4gICAgICAgICAgICBzdW0gKz0gcDIubWFnbml0dWRlO1xuICAgICAgICAgICAgdmFyIHVuaXQgPSB0aGlzLm1vdmVTcGVlZCAvIHN1bTtcblxuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKCkud2FpdCg2MCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHBhdGgubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcCA9IHBhdGhbaV07XG4gICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBNYXRoLmZsb29yKHAubWFnbml0dWRlICogdW5pdCk7XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLm1vdmVUbyhzdGFydFggKyBwLngsIHN0YXJ0WSArIHAueSwgdGltZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIubW92ZVRvKHN0YXJ0WCArIHBhdGhbMF0ueCwgc3RhcnRZICsgcGF0aFswXS55LCB0aW1lKTtcbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5zZXRMb29wKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy/lvoDot6/ot53pm6LoqIjnrpdcbiAgICAgICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwMSA9IHBhdGhbaV07XG4gICAgICAgICAgICAgICAgdmFyIHAyID0gcGF0aFtpKzFdO1xuICAgICAgICAgICAgICAgIHAyLm1hZ25pdHVkZSA9IE1hdGguc3FydCgocDIueCAtIHAxLngpICogKHAyLnggLSBwMS54KSArIChwMi55IC0gcDEueSkgKiAocDIueSAtIHAxLnkpKTtcbiAgICAgICAgICAgICAgICBzdW0gKz0gcDIubWFnbml0dWRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHVuaXQgPSB0aGlzLm1vdmVTcGVlZCAvIHN1bTtcblxuICAgICAgICAgICAgLy/lvqnot6/ot53pm6LoqIjnrpdcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICB2YXIgcDEgPSBwYXRoW2ldO1xuICAgICAgICAgICAgICAgIHZhciBwMiA9IHBhdGhbaS0xXTtcbiAgICAgICAgICAgICAgICBwMi5tYWduaXR1ZGVfcmV0ID0gTWF0aC5zcXJ0KChwMi54IC0gcDEueCkgKiAocDIueCAtIHAxLngpICsgKHAyLnkgLSBwMS55KSAqIChwMi55IC0gcDEueSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKS53YWl0KDYwKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwID0gcGF0aFtpXTtcbiAgICAgICAgICAgICAgICB2YXIgdGltZSA9IE1hdGguZmxvb3IocC5tYWduaXR1ZGUgKiB1bml0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIubW92ZVRvKHN0YXJ0WCArIHAueCwgc3RhcnRZICsgcC55LCB0aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHdlZW5lci53YWl0KDYwKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBwYXRoLmxlbmd0aCAtIDI7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBwYXRoW2ldO1xuICAgICAgICAgICAgICAgIHZhciB0aW1lID0gTWF0aC5mbG9vcihwLm1hZ25pdHVkZV9yZXQgKiB1bml0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIubW92ZVRvKHN0YXJ0WCArIHAueCwgc3RhcnRZICsgcC55LCB0aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5zZXRMb29wKHRydWUpO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QuZ2F0ZS5qc1xuICogIDIwMTcvMDMvMjBcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnFmdC5NYXBPYmplY3QgPSBxZnQuTWFwT2JqZWN0IHx8IHt9O1xuXG4vL+ODr+ODvOODl+OCsuODvOODiFxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5HYXRlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIGlkOiBudWxsLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5a6f6KGM5riI44G/44OV44Op44KwXG4gICAgYWxyZWFkeTogZmFsc2UsXG5cbiAgICAvL+ODreODg+OCr+OBleOCjOOBpuOBhOOCi+OBi1xuICAgIGlzTG9jazogZmFsc2UsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ODleODqeOCsFxuICAgIGlzQWR2YW5jZUFuaW1hdGlvbjogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgd2lkdGggPSBvcHRpb25zLndpZHRoIHx8IDM2O1xuICAgICAgICB2YXIgaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNjQ7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodH0pO1xuICAgICAgICB0aGlzLndpZHRoX2hhbGYgPSB3aWR0aCAvIDI7XG4gICAgICAgIHRoaXMuaGVpZ2h0X2hhbGYgPSBoZWlnaHQgLyAyO1xuXG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkO1xuICAgICAgICB0aGlzLmlzTG9jayA9IG9wdGlvbnMucHJvcGVydGllcy5sb2NrIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLm5hbWUgPSBvcHRpb25zLm5hbWU7XG4gICAgICAgIHRoaXMuZW50ZXJPZmZzZXQgPSBvcHRpb25zLnByb3BlcnRpZXMuZW50ZXJPZmZzZXQgfHwgMDtcblxuICAgICAgICAvL+OCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IG51bGw7XG5cbiAgICAgICAgLy/jgrLjg7zjg4jmqZ/og71cbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBvcHRpb25zLnByb3BlcnRpZXM7XG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5uYW1lKSB7XG4gICAgICAgICAgICAvL+ODnuODg+ODl+WGheenu+WLlVxuICAgICAgICAgICAgY2FzZSBcIndhcnBcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5leHRJRCA9IHByb3BlcnRpZXMubmV4dElEO1xuICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gcHJvcGVydGllcy5vZmZzZXQgfHwgMDtcbiAgICAgICAgICAgICAgICB0aGlzLm9uKCdlbnRlcmRvb3InLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/ooYzjgY3lhYjjga7mpJzntKJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHQgPSB0aGlzLmZpbmRHYXRlKHRoaXMubmV4dElEKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0KSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW50ZXJQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS53YXJwKG5leHQueCwgbmV4dC55K25leHQub2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YWl0KDEyMClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbHJlYWR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dC5sZWF2ZVBsYXllcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIC8v44Oe44OD44OX5YiH44KK5pu/44GIXG4gICAgICAgICAgICBjYXNlIFwibWFwc3dpdGNoXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0SUQgPSBwcm9wZXJ0aWVzLm5leHRJRDtcbiAgICAgICAgICAgICAgICB0aGlzLm9mZnNldCA9IHByb3BlcnRpZXMub2Zmc2V0IHx8IDA7XG4gICAgICAgICAgICAgICAgdGhpcy50b0xheWVyTnVtYmVyID0gcHJvcGVydGllcy50b0xheWVyTnVtYmVyO1xuICAgICAgICAgICAgICAgIHRoaXMub24oJ2VudGVyZG9vcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclt0aGlzLnRvTGF5ZXJOdW1iZXJdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMucGFyZW50U2NlbmUuc3RhZ2VDb250cm9sbGVyLmZpbmRPYmplY3QodGhpcy5uZXh0SUQsIHRoaXMudG9MYXllck51bWJlcik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbmV4dCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVudGVyUGxheWVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zd2l0Y2hNYXAobGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyLnNldFBvc2l0aW9uKG5leHQueCwgbmV4dC55ICsgbmV4dC5vZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWxyZWFkeSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHQubGVhdmVQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmcudHdlZW5lci5jbGVhcigpLndhaXQoMzApLmZhZGVJbigzMCkuZmFkZU91dCgzMCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODkeODvOODhuOCo+OCr+ODq1xuICAgICAgICBpZiAoIXRoaXMuaXNMb2NrICYmIHRoaXMudGltZSAlIDYgPT0gMCkge1xuICAgICAgICAgICAgKDIpLnRpbWVzKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3AgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInBhcnRpY2xlXCIsIDE2LCAxNilcbiAgICAgICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoMClcbiAgICAgICAgICAgICAgICAgICAgLnNldFNjYWxlKDApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihNYXRoLnJhbmRpbnQoLXRoaXMud2lkdGhfaGFsZiwgdGhpcy53aWR0aF9oYWxmKSwgdGhpcy5oZWlnaHRfaGFsZiArIE1hdGgucmFuZGludCgtNCwgNCkpO1xuICAgICAgICAgICAgICAgIHNwLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgICAgIHNwLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuYnkoe3k6IC00OCwgYWxwaGE6ICAwLjksIHNjYWxlWDogIDAuMywgc2NhbGVZOiAgMC4zfSwgMTAwMCwgXCJlYXNlSW5TaW5lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5ieSh7eTogLTQ4LCBhbHBoYTogLTAuOSwgc2NhbGVYOiAtMC4zLCBzY2FsZVk6IC0wLjN9LCAxMDAwLCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHNwKSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O844GM44Ky44O844OI44Gr5YWl44KLXG4gICAgZW50ZXJQbGF5ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZW50ZXJPZmZzZXQgPSB0aGlzLmVudGVyT2Zmc2V0O1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHBsYXllci5hbHBoYSA9IDA7XG4gICAgICAgIHBsYXllci5pc0NvbnRyb2wgPSBmYWxzZTtcbiAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5zZXRQb3NpdGlvbihwbGF5ZXIueCwgcGxheWVyLnkpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLm1vdmVUbyh0aGlzLngsIHRoaXMueStlbnRlck9mZnNldCwgMTUpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZmFkZU91dCgxNSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O844GM44Ky44O844OI44GL44KJ5Ye644KLXG4gICAgbGVhdmVQbGF5ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHBsYXllci5hbHBoYSA9IDA7XG4gICAgICAgIHBsYXllci5pc0NvbnRyb2wgPSBmYWxzZTtcbiAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSkuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKTtcbiAgICAgICAgcGwuYWxwaGEgPSAwO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLm1vdmVUbyhwbGF5ZXIueCwgcGxheWVyLnksIDMwKVxuICAgICAgICAgICAgLmZhZGVJbigxMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsYXllci5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgcGxheWVyLmlzQ29udHJvbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcGwucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/ku5bjga7jgrLjg7zjg4jjgpLmpJzntKJcbiAgICBmaW5kR2F0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG51bGw7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUub2JqTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5NYXBPYmplY3QuR2F0ZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLmlkID09IGlkKSByZXN1bHQgPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgbWFwb2JqZWN0LmpzXG4gKiAgMjAxNy8wMS8xNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucWZ0Lk1hcE9iamVjdCA9IHFmdC5NYXBPYmplY3QgfHwge307XG5cbi8v44OB44Kn44OD44Kv44Ki44Kk44Kz44OzXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkNoZWNrSWNvblwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuQ2hhcmFjdGVyXCIsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAuMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDMsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IDM2LCBoZWlnaHQ6IDY0fSk7XG4gICAgICAgIHRoaXMuJHNhZmUob3B0aW9ucyk7XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImNoZWNraWNvblwiLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihlKSB7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImluXCJdID0gWzIsIDEsIDBdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSBbNSwgNCwgM107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzgsIDcsIDZdO1xuICAgICAgICB0aGlzLmZyYW1lW1wib3V0XCJdID0gWzExLCAxMCwgOV07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcblxuLy/jg6Hjg4Pjgrvjg7zjgrjooajnpLpcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuTWVzc2FnZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICAvL+OCquODluOCuOOCp+OCr+ODiElEXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+S4gOWbnuOBruOBv+ihqOekuuODleODqeOCsFxuICAgIG9uY2U6IGZhbHNlLFxuXG4gICAgLy/ooajnpLrmuIjjgb/jg5Xjg6njgrBcbiAgICBhbHJlYWR5UmVhZDogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuICAgICAgICB0aGlzLmlkID0gb3B0aW9ucy5pZDtcbiAgICAgICAgdGhpcy5vbmNlID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm9uY2UgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMudGV4dCA9IG9wdGlvbnMucHJvcGVydGllcy50ZXh0IHx8IFwiVEVTVFwiO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBoaXQgPSB0aGlzLmhpdFRlc3RFbGVtZW50KHBsKTtcbiAgICAgICAgaWYgKGhpdCAmJiAhdGhpcy5hbHJlYWR5UmVhZCkge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkV2ZW50TWVzc2FnZSh0aGlzLmlkLCB0aGlzLnRleHQpO1xuICAgICAgICAgICAgdGhpcy5hbHJlYWR5UmVhZCA9IHRydWU7XG5cbiAgICAgICAgICAgIC8v5LiA5Zue44Gu44G/44Gu5aC05ZCI44Gv44Oq44Og44O844OWXG4gICAgICAgICAgICBpZiAodGhpcy5vbmNlKSB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/liKTlrprjgpLlpJbjgozjgZ/jgonooajnpLrmuIjjgb/jg5Xjg6njgrDjgpLlpJbjgZlcbiAgICAgICAgaWYgKCFoaXQgJiYgdGhpcy5hbHJlYWR5UmVhZCkgdGhpcy5hbHJlYWR5UmVhZCA9IGZhbHNlO1xuICAgIH0sXG59KTtcblxuLy/jgqTjg5njg7Pjg4hcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuRXZlbnRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgLy/jgqrjg5bjgrjjgqfjgq/jg4hJRFxuICAgIGlkOiBudWxsLFxuXG4gICAgLy/kuIDlm57jga7jgb/ooajnpLrjg5Xjg6njgrBcbiAgICBvbmNlOiBmYWxzZSxcblxuICAgIC8v5a6f6KGM5riI44G/44OV44Op44KwXG4gICAgYWxyZWFkeTogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuICAgICAgICB0aGlzLmlkID0gb3B0aW9ucy5pZDtcbiAgICAgICAgdGhpcy5vbmNlID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm9uY2UgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMucHJvcGVydGllcyA9IG9wdGlvbnMucHJvcGVydGllcztcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgaGl0ID0gdGhpcy5oaXRUZXN0RWxlbWVudChwbCk7XG4gICAgICAgIGlmIChoaXQgJiYgIXRoaXMuYWxyZWFkeVJlYWQpIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FdmVudE1lc3NhZ2UodGhpcy5pZCwgdGhpcy50ZXh0KTtcbiAgICAgICAgICAgIHRoaXMuYWxyZWFkeSA9IHRydWU7XG5cbiAgICAgICAgICAgIC8v5LiA5Zue44Gu44G/44Gu5aC05ZCI44Gv44Oq44Og44O844OWXG4gICAgICAgICAgICBpZiAodGhpcy5vbmNlKSB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/liKTlrprjgpLlpJbjgozjgZ/jgonlrp/ooYzmuIjjgb/jg5Xjg6njgrDjgpLlpJbjgZlcbiAgICAgICAgaWYgKCFoaXQgJiYgdGhpcy5hbHJlYWR5KSB0aGlzLmFscmVhZHlSZWFkID0gZmFsc2U7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QubnBjLmpzXG4gKiAgMjAxNy8wOC8wOVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/lhpLpmbrogIVcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QubnBjXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIC8v56e75YuV6YCf5bqmXG4gICAgc3BlZWQ6IDIsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiA4LFxuXG4gICAgLy/lvbHooajnpLrjg5Xjg6njgrBcbiAgICBpc1NoYWRvdzogdHJ1ZSxcblxuICAgIC8v56e75YuV44OV44Op44KwXG4gICAgaXNNb3ZlOiB0cnVlLFxuXG4gICAgLy/kuI3li5Xjg5Xjg6njgrBcbiAgICB0b0ZpeDogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyNCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImFjdG9yXCIgKyAob3B0aW9ucy5wcm9wZXJ0aWVzLmFjdG9yIHx8IFwiNDBcIiksIDMyLCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2NhbGVYID0gLTE7XG5cbiAgICAgICAgdGhpcy5zcGVlZCA9IG9wdGlvbnMucHJvcGVydGllcy5zcGVlZCB8fCB0aGlzLnNwZWVkO1xuICAgICAgICB0aGlzLmlzTW92ZSA9IChvcHRpb25zLnByb3BlcnRpZXMuaXNNb3ZlID09PSB1bmRlZmluZWQ/IHRydWU6IG9wdGlvbnMucHJvcGVydGllcy5pc01vdmUpO1xuICAgICAgICB0aGlzLnRlcnJpdG9yeSA9IG9wdGlvbnMucHJvcGVydGllcy50ZXJyaXRvcnkgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBvcHRpb25zLnByb3BlcnRpZXMuZGlyZWN0aW9uIHx8IDA7XG4gICAgICAgIHRoaXMudGV4dCA9IG9wdGlvbnMucHJvcGVydGllcy50ZXh0O1xuXG4gICAgICAgIGlmIChvcHRpb25zLnByb3BlcnRpZXMudG9GaXgpIHtcbiAgICAgICAgICAgIHRoaXMuaWdub3JlQ29sbGlzaW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZ3Jhdml0eSA9IDA7XG4gICAgICAgICAgICB0aGlzLmlzTW92ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy50b0ZpeCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm9uZSgnZW50ZXJmcmFtZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHVwRml4ZWRTaGFkb3coKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuXG4gICAgICAgIHRoaXMud2FpdFRpbWUgPSAwO1xuXG4gICAgICAgIHRoaXMub25lKCdlbnRlcmZyYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzTW92ZSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgOTA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImRvd25cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxODA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjcwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLndhaXRUaW1lID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzTW92ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubW92ZUFsZ29yaXRobSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaUu+aSg+OBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICBpZiAocGwuaXNBdHRhY2sgJiYgdGhpcy5oaXRUZXN0RWxlbWVudChwbC5hdHRhY2tDb2xsaXNpb24pKSB7XG4gICAgICAgICAgICAgICAgLy/oqbHjgZfjgYvjgZHjgZ/kuovjgavjgarjgotcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCg1KVxuICAgICAgICAgICAgICAgICAgICAuY2FsbCgoKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY2VuZSA9IHFmdC5Db252ZXJzYXRpb25TY2VuZSh0aGlzLnBhcmVudFNjZW5lLCB0aGlzLnRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShzY2VuZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMud2FpdFRpbWUgPSAxNTtcblxuICAgICAgICAgICAgICAgIC8v5ZCR44GN44Gu6Kq/5pW0XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMud2FpdFRpbWUtLTtcbiAgICAgICAgaWYgKHRoaXMud2FpdFRpbWUgPCAwKSB0aGlzLndhaXRUaW1lID0gMDtcbiAgICB9LFxuXG4gICAgbW92ZUFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/ltJbjgaPjgbfjgaHjgafmipjjgorov5TjgZlcbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODhuODquODiOODquODvOaMh+WumlxuICAgICAgICAgICAgaWYgKHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgLy/msLTlubPmlrnlkJHjga7jgb/jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgICAgICB2YXIgdHggPSB0aGlzLnggLSB0aGlzLmZpcnN0WDtcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnModHgpID4gdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAgdGhpcy5zcGVlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzEzLCAxNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzM2LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWyAzLCAgNCwgIDUsICA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbIDksIDEwLCAxMSwgMTBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFsgMCwgIDEsICAyLCAgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQxLCA0MiwgNDMsIDQ0LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkZWZlbnNlXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGFtYWdlXCJdID0gWyAxOCwgMTksIDIwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRyb3BcIl0gPSBbMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkZWFkXCJdID0gWzE4LCAxOSwgMjAsIDMzLCAzNCwgMzUsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsZWFyXCJdID0gWzI0LCAyNSwgMjZdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3R1blwiXSA9IFsgMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/lm7rlrprlvbHooajnpLrjgrvjg4Pjg4jjgqLjg4Pjg5dcbiAgICBzZXR1cEZpeGVkU2hhZG93OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgc2MgPSB0aGlzLndpZHRoIC8gMjQ7XG4gICAgICAgIGlmIChzYyA8IDEpIHNjICs9IDAuMjtcbiAgICAgICAgdGhpcy5maXhlZFNoYWRvd1Nwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwic2hhZG93XCIsIDI0LCA4KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5zaGFkb3dMYXllcilcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjUpXG4gICAgICAgICAgICAuc2V0U2NhbGUoc2MsIDEuMCk7XG4gICAgICAgIHRoaXMuZml4ZWRTaGFkb3dTcHJpdGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmFscGhhID0gMC41O1xuICAgICAgICAgICAgaWYgKHRoYXQuYWxwaGEgPCAwLjUpIHRoaXMuYWxwaGEgPSB0aGF0LmFscGhhO1xuICAgICAgICAgICAgdGhpcy54ID0gdGhhdC54O1xuICAgICAgICAgICAgdGhpcy55ID0gdGhhdC55ICsgMTY7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHBsYXllci5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5QbGF5ZXJcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgLy/orZjliKXjg5Xjg6njgrBcbiAgICBpc1BsYXllcjogdHJ1ZSxcblxuICAgIC8v5pyA5aSn44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHBNYXg6IDEwMCxcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/msJfntbbnorrnjodcbiAgICBzdHVuUG93ZXI6IDEsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmVuc2U6IDEwLFxuXG4gICAgLy/np7vli5XpgJ/luqZcbiAgICBzcGVlZDogNSxcblxuICAgIC8v55m75Z2C6YCf5bqmXG4gICAgc3BlZWRBc2NlbmQ6IDQsXG5cbiAgICAvL+S4i+aKvOOBl+mAo+e2muODleODrOODvOODoOaVsFxuICAgIGRvd25GcmFtZTogMCxcblxuICAgIC8v5aSa5q6144K444Oj44Oz44OX5Y+v6IO95Zue5pWwXG4gICAgbnVtSnVtcDogMCxcbiAgICBudW1KdW1wTWF4OiAxLFxuXG4gICAgLy/miYDmjIHoo4XlgpnjgqLjgqTjg4bjg6BcbiAgICBlcXVpcDogbnVsbCxcblxuICAgIC8v44Ki44Kk44OG44Og5omA5oyB5pyA5aSn5pWwXG4gICAgbWF4SXRlbTogMTAsXG5cbiAgICAvL+aJgOaMgeOCouOCpOODhuODoFxuICAgIGl0ZW1zOiBudWxsLFxuXG4gICAgLy/miYDmjIHjgq/jg6rjgqLmnaHku7bjgq3jg7xcbiAgICBrZXlzOiBudWxsLFxuXG4gICAgLy/mk43kvZzlj6/og73jg5Xjg6njgrBcbiAgICBpc0NvbnRyb2w6IHRydWUsXG5cbiAgICAvL+aUu+aSg+S4reODleODqeOCsFxuICAgIGlzQXR0YWNrOiBmYWxzZSxcblxuICAgIC8v6Ziy5b6h5Lit44OV44Op44KwXG4gICAgaXNEZWZlbnNlOiBmYWxzZSxcblxuICAgIC8v44OJ44Ki5LiK44OV44Op44KwXG4gICAgaXNPbkRvb3I6IGZhbHNlLFxuXG4gICAgLy/jg4Djg5/jg7zooajnpLrjgrnjg5fjg6njgqTjg4hcbiAgICBkdW1teTogbnVsbCxcblxuICAgIC8v5b2x6KGo56S644OV44Op44KwXG4gICAgaXNTaGFkb3c6IHRydWUsXG5cbiAgICAvL+OCquODvOODiOODkeOCpOODreODg+ODiFxuICAgIGlzQXV0bzogZmFsc2UsXG4gICAgYXV0b0tleToge1xuICAgICAgICB1cDogZmFsc2UsXG4gICAgICAgIHJpZ2h0OiBmYWxzZSxcbiAgICAgICAgZG93bjogZmFsc2UsXG4gICAgICAgIGxlZnQ6IGZhbHNlLFxuICAgICAgICBhdHRhY2s6IGZhbHNlLFxuICAgICAgICBqdW1wOiBmYWxzZSxcbiAgICB9LFxuXG4gICAgLy/liY3jg5Xjg6zjg7zjg6Djga7mg4XloLFcbiAgICBiZWZvcmU6IHtcbiAgICAgICAgLy/mk43kvZzns7tcbiAgICAgICAgdXA6IGZhbHNlLFxuICAgICAgICBkb3duOiBmYWxzZSxcbiAgICAgICAgYXR0YWNrOiBmYWxzZSxcbiAgICAgICAganVtcDogZmFsc2UsXG4gICAgICAgIGNoYW5nZTogZmFsc2UsXG4gICAgICAgIGlzU3R1bjogZmFsc2UsXG4gICAgICAgIGlzT25GbG9vcjogZmFsc2UsXG4gICAgICAgIHg6IDAsXG4gICAgICAgIHk6IDAsXG4gICAgfSxcblxuICAgIC8v44K544OG44O844K46ZaL5aeL5pmC44K544OG44O844K/44K5XG4gICAgc3RhcnRTdGF0dXM6IG51bGwsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwge3dpZHRoOiAxNiwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4jog4zlvoxcbiAgICAgICAgdGhpcy5iYWNrID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcykuc2V0U2NhbGUoLTEsIDEpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJwbGF5ZXIxXCIsIDMyLCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDApO1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVggPSAtMTtcblxuICAgICAgICAvL+atpuWZqOeUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLndlYXBvbiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLmJhY2spXG4gICAgICAgICAgICAuc2V0RnJhbWVJbmRleCgwKVxuICAgICAgICAgICAgLnNldE9yaWdpbigxLCAxKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKDMsIDMpO1xuICAgICAgICB0aGlzLndlYXBvbi5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMud2VhcG9uLnR5cGUgPSBcInN3b3JkXCI7XG5cbiAgICAgICAgLy/nm75cbiAgICAgICAgdGhpcy5zaGllbGQgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIml0ZW1cIiwgMjQsIDI0KVxuLy8gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoNylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigxMCwgNilcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjgpXG4gICAgICAgICAgICAuc2V0VmlzaWJsZShmYWxzZSk7XG5cbiAgICAgICAgLy/mlLvmkoPliKTlrprnlKhcbiAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMTQsIGhlaWdodDogMjZ9KTtcbiAgICAgICAgLy/lvZPjgZ/jgorliKTlrprjg4fjg5Djg4PjgrDnlKhcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikge1xuICAgICAgICAgICAgdGhpcy5vbmUoJ2VudGVyZnJhbWUnLCBlID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFja0NvbGxpc2lvbi5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUucGxheWVyTGF5ZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrQ29sbGlzaW9uLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLm9uKCdyZW1vdmVkJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24ucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCx44Gu5Yid5pyf5YyWXG4gICAgICAgIHRoaXMucmVzZXQoKTtcblxuICAgICAgICAvL+OBr+OBl+OBlOWIpOWumueUqFxuICAgICAgICB0aGlzLmxhZGRlckNvbGxpc2lvbiA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAxNiwgaGVpZ2h0OiAyMH0pO1xuXG4gICAgICAgIC8v5Yid5pyf44Ki44OL44Oh44O844K344On44Oz6Kit5a6aXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5iZWZvcmVBbmltYXRpb24gPSBcIlwiO1xuXG4gICAgICAgIC8v5q275Lqh5pmC44Kz44O844Or44OQ44OD44KvXG4gICAgICAgIHRoaXMub24oJ2RlYWQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmZsYXJlKCdnYW1lb3ZlcicpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+aZguOCueODhuODvOOCv+OCuVxuICAgICAgICB0aGlzLnNhdmVTdGF0dXMoKTtcblxuICAgICAgICAvL+acgOW+jOOBq+W6iuS4iuOBq+OBhOOBn+WgtOaJgOOCkuS/neWtmFxuICAgICAgICB0aGlzLmxhc3RPbkZsb29yWCA9IDA7XG4gICAgICAgIHRoaXMubGFzdE9uRmxvb3JZID0gMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgaWYgKHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSkgcmV0dXJuO1xuXG4gICAgICAgIC8v44Kq44OW44K444Kn44Kv44OI44Os44Kk44Ok44O85o6l6Kem5Yik5a6aXG4gICAgICAgIHRoaXMuaXNPbkRvb3IgPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgLy/miYnliKTlrppcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0Lk1hcE9iamVjdC5Eb29yIHx8IGUgaW5zdGFuY2VvZiBxZnQuTWFwT2JqZWN0LkdhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS5oaXRUZXN0RWxlbWVudCh0aGlzKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT25Eb29yID0gZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAvL+atu+S6oeaZguOBr+S9leOCguWHuuadpeOBquOBhFxuICAgICAgICBpZiAodGhpcy5pc0RlYWQpIHtcbiAgICAgICAgICAgIC8v44Oe44OD44OX5aSW6JC95LiLXG4gICAgICAgICAgICBpZiAodGhpcy5pc0Ryb3ApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhwID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImRyb3BcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuLy8gICAgICAgIHRoaXMuc2hpZWxkLnNldFZpc2libGUoZmFsc2UpO1xuLy8gICAgICAgIHRoaXMuaXNEZWZlbnNlID0gZmFsc2U7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmk43kvZxcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIC8v44OQ44O844OB44Oj44Or44OR44OD44OJ5oOF5aCx5Y+W5b6XXG4gICAgICAgIHZhciB2cCA9IGFwcC52aXJ0dWFsUGFkO1xuICAgICAgICBpZiAodnAuZ2V0S2V5KFwidXBcIikpIGN0LnVwID0gdHJ1ZTtcbiAgICAgICAgaWYgKHZwLmdldEtleShcInJpZ2h0XCIpKSBjdC5yaWdodCA9IHRydWU7XG4gICAgICAgIGlmICh2cC5nZXRLZXkoXCJkb3duXCIpKSBjdC5kb3duID0gdHJ1ZTtcbiAgICAgICAgaWYgKHZwLmdldEtleShcImxlZnRcIikpIGN0LmxlZnQgPSB0cnVlO1xuICAgICAgICBpZiAodnAuZ2V0S2V5KFwiWlwiKSkgY3QuYXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgaWYgKHZwLmdldEtleShcIlhcIikpIGN0Lmp1bXAgPSB0cnVlO1xuXG4gICAgICAgIC8v44Kq44O844OI44OR44Kk44Ot44OD44OIXG4gICAgICAgIGlmICh0aGlzLmlzQXV0bykge1xuICAgICAgICAgICAgY3QgPSB0aGlzLmF1dG9LZXk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuaXNDb250cm9sKSBjdCA9IHt9O1xuICAgICAgICBpZiAodGhpcy5zdG9wVGltZSA9PSAwKSB7XG4gICAgICAgICAgICAvL+W3puenu+WLlVxuICAgICAgICAgICAgaWYgKGN0LmxlZnQgJiYgIWN0LmRvd24pIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNKdW1wICYmICF0aGlzLmlzQXR0YWNrICYmICF0aGlzLmlzQ2F0Y2hMYWRkZXIpIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgICAgICAvL+OBr+OBl+OBlOaOtOOBv+eKtuaFi+OBp+W3puOBq+WjgeOBjOOBguOCi+WgtOWQiOOBr+S4jeWPr1xuICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5fY29sbGlzaW9uWzNdO1xuICAgICAgICAgICAgICAgIGlmICghKHRoaXMuaXNDYXRjaExhZGRlciAmJiB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMihjLngrNiwgYy55LCBjLndpZHRoLCBjLmhlaWdodCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAtdGhpcy5zcGVlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+WPs+enu+WLlVxuICAgICAgICAgICAgaWYgKGN0LnJpZ2h0ICYmICFjdC5kb3duKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzSnVtcCAmJiAhdGhpcy5pc0F0dGFjayAmJiAhdGhpcy5pc0NhdGNoTGFkZGVyKSB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgICAgICAgICAgLy/jga/jgZfjgZTmjrTjgb/nirbmhYvjgaflj7Pjgavlo4HjgYzjgYLjgovloLTlkIjjga/kuI3lj69cbiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2NvbGxpc2lvblsxXTtcbiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLmlzQ2F0Y2hMYWRkZXIgJiYgdGhpcy5jaGVja01hcENvbGxpc2lvbjIoYy54LTYsIGMueSwgYy53aWR0aCwgYy5oZWlnaHQpKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/poK3kuIrotrPlhYPjga/jgZfjgZTmpJznn6VcbiAgICAgICAgICAgIHZhciBoZWFkTGFkZGVyID0gdGhpcy5jaGVja0hlYWRMYWRkZXIoKTtcbiAgICAgICAgICAgIHZhciBmb290TGFkZGVyID0gdGhpcy5jaGVja0Zvb3RMYWRkZXIoKTtcblxuICAgICAgICAgICAgLy/jga/jgZfjgZTmjrTjgb/nirbmhYvjgafmk43kvZzliIblspBcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2F0Y2hMYWRkZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3QudXApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtdGhpcy5zcGVlZEFzY2VuZDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLl9jb2xsaXNpb25bMF07XG4gICAgICAgICAgICAgICAgICAgIGlmICghaGVhZExhZGRlciAmJiB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMihjLngsIGMueS02LCBjLndpZHRoLCBjLmhlaWdodCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjdC5kb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gdGhpcy5zcGVlZEFzY2VuZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v44K444Oj44Oz44OX44Oc44K/44Oz44Gu44G/XG4gICAgICAgICAgICAgICAgaWYgKGN0Lmp1bXAgJiYgIWN0LnVwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44K444Oj44Oz44OX5LqM5q6155uu5Lul6ZmNXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzSnVtcCAmJiB0aGlzLm51bUp1bXAgPCB0aGlzLm51bUp1bXBNYXggJiYgdGhpcy52eSA+IC01KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTExO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1KdW1wKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/jgrjjg6Pjg7Pjg5dcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoayA9IHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCwgdGhpcy55LTE2LCA1LCAzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzSnVtcCAmJiB0aGlzLmlzT25GbG9vciAmJiAhY2hrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImp1bXBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTExO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1KdW1wID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL+S4iuOCreODvOaKvOS4i1xuICAgICAgICAgICAgICAgIGlmIChjdC51cCkge1xuICAgICAgICAgICAgICAgICAgICAvL+OCuOODo+ODs+ODl+S6jOauteebruS7pemZjVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0p1bXAgJiYgdGhpcy5udW1KdW1wIDwgdGhpcy5udW1KdW1wTWF4ICYmIHRoaXMudnkgPiAtNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubnVtSnVtcCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v44K444Oj44Oz44OXXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGsgPSB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngsIHRoaXMueS0xNiwgNSwgMyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0p1bXAgJiYgdGhpcy5pc09uRmxvb3IgJiYgIXRoaXMuaXNPbkxhZGRlciAmJiAhY2hrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImp1bXBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTExO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1KdW1wID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL+OBr+OBl+OBlOOCkuaYh+OCi++8iOmajuauteOBr+aOpeWcsOaZguOBruOBv++8iVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc09uTGFkZGVyICYmICF0aGlzLmlzT25TdGFpcnMgfHwgdGhpcy5pc09uRmxvb3IgJiYgdGhpcy5pc09uU3RhaXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNDYXRjaExhZGRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRocm91Z2hGbG9vciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/miYnjgavlhaXjgovvvIjmjqXlnLDmmYLvvIblt6blj7Pjgq3jg7zjgqrjg5XmmYLjga7jgb/vvIlcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdC5sZWZ0ICYmICFjdC5yaWdodCAmJiB0aGlzLmlzT25GbG9vciAmJiB0aGlzLmlzT25Eb29yICYmICF0aGlzLmlzT25Eb29yLmlzTG9jayAmJiAhdGhpcy5pc09uRG9vci5hbHJlYWR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09uRG9vci5mbGFyZSgnZW50ZXJkb29yJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT25Eb29yLmFscmVhZHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL+S4i+OCreODvOaKvOS4i1xuICAgICAgICAgICAgICAgIGlmIChjdC5kb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44Gv44GX44GU44KS6ZmN44KK44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChmb290TGFkZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNDYXRjaExhZGRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRocm91Z2hGbG9vciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/luorjgrnjg6vjg7xcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZG93bkZyYW1lID4gNiAmJiAhdGhpcy5qdW1wICYmICFmb290TGFkZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgJiYgIXRoaXMudGhyb3VnaEZsb29yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZsb29yID0gdGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LCB0aGlzLnkrMTYsIDUsIDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmbG9vciAmJiBmbG9vclswXS5lbmFibGVUaHJvdWdoKSB0aGlzLnRocm91Z2hGbG9vciA9IGZsb29yWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v55u+44KS5qeL44GI44KLXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0F0dGFjaykge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNoaWVsZC5zZXRWaXNpYmxlKHRydWUpO1xuLy8gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRGVmZW5zZSA9IHRydWU7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwiZGVmZW5zZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgLy/jga/jgZfjgZTjgYvjgonlpJbjgozjgZ/jgonmoq/lrZDmjrTjgb/nirbmhYvjgq3jg6Pjg7Pjgrvjg6tcbiAgICAgICAgaWYgKHRoaXMuaXNDYXRjaExhZGRlcikge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzT25MYWRkZXIgJiYgIWN0LmRvd24gfHwgdGhpcy5pc09uTGFkZGVyICYmICFmb290TGFkZGVyICYmICFjdC51cCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNDYXRjaExhZGRlciA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgaWYgKCF0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub3dBbmltYXRpb24gIT0gXCJkYW1hZ2VcIiAmJiAhdGhpcy5pc0RlZmVuc2UpIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0NhdGNoTGFkZGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGN0LnVwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdC5kb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT25TdGFpcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwiZG93blwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc1N0dW4gJiYgIXRoaXMuaXNEZWFkKSB0aGlzLnNldEFuaW1hdGlvbihcImp1bXBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3QuYXR0YWNrICYmICF0aGlzLmJlZm9yZS5hdHRhY2sgJiYgdGhpcy5zdG9wVGltZSA9PSAwICYmICEodGhpcy5pc0NhdGNoTGFkZGVyICYmIHRoaXMuaXNPbkxhZGRlcikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImF0dGFja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbkF0dGFjaygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+atpuWZqOOBruWkieabtFxuICAgICAgICAgICAgaWYgKGN0LmNoYW5nZSAmJiAhdGhpcy5iZWZvcmUuY2hhbmdlICYmIHRoaXMuZXF1aXAuc3dpdGNoT2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaFdlYXBvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/msJfntbbnirbmhYtcbiAgICAgICAgaWYgKHRoaXMuaXNTdHVuKSB7XG4gICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0dW5cIik7XG5cbiAgICAgICAgICAgIC8v5qKv5a2Q5o6044G/44Kt44Oj44Oz44K744OrXG4gICAgICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy/jg6zjg5Djgqzjg4Hjg6PjgafmsJfntbblvqnluLDjgpLml6njgoHjgotcbiAgICAgICAgICAgIGlmIChjdC5sZWZ0ICYmICFjdC5iZWZvcmUubGVmdCB8fFxuICAgICAgICAgICAgICAgIGN0LnJpZ2h0ICYmICFjdC5iZWZvcmUucmlnaHQgfHxcbiAgICAgICAgICAgICAgICBjdC51cCAmJiAhY3QuYmVmb3JlLnVwIHx8XG4gICAgICAgICAgICAgICAgY3QuZG93biAmJiAhY3QuYmVmb3JlLmRvd24pIHRoaXMuc3RvcFRpbWUgLT0gMjtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJlZm9yZS5pc1N0dW4pIHtcbiAgICAgICAgICAgIC8v5rCX57W25b6p5biw44GX44Gf44KJ44Ki44OL44Oh44O844K344On44Oz44KS5qiZ5rqW44GrXG4gICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0YW5kXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/mrbvkuqHnirbmhYtcbiAgICAgICAgaWYgKHRoaXMuaXNEZWFkKSB7XG4gICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImRlYWRcIik7XG4gICAgICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44Oz5aSJ5pu044KS5qSc55+lXG4gICAgICAgIGlmICh0aGlzLm5vd0FuaW1hdGlvbiAhPSB0aGlzLmJlZm9yZUFuaW1hdGlvbikge1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uID09IFwiYXR0YWNrXCIpIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAyO1xuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uID09IFwiZGVmZW5zZVwiKSB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8v5q2p6KGM44Ki44OL44Oh44O844K344On44Oz44Gu5aC05ZCI44Gv56e75YuV44GX44Gm44GE44KL5pmC44Gu44G/6YCy44KB44KLXG4gICAgICAgICAgICBpZiAodGhpcy5ub3dBbmltYXRpb24gPT0gXCJ3YWxrXCIgJiYgIWN0LmxlZnQgJiYgIWN0LnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uID09IFwidXBcIiB8fCB0aGlzLm5vd0FuaW1hdGlvbiA9PSBcImRvd25cIikge1xuICAgICAgICAgICAgICAgIGlmIChjdC51cCB8fCBjdC5kb3duIHx8IGN0LmxlZnQgfHwgY3QucmlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/mlLvmkoPliKTlrprov73lvpNcbiAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24ueCA9IHRoaXMueCArIHRoaXMuc2NhbGVYICogMTI7XG4gICAgICAgIHRoaXMuYXR0YWNrQ29sbGlzaW9uLnkgPSB0aGlzLnk7XG5cbiAgICAgICAgLy/jgrPjg7Pjg4jjg63jg7zjg6nku5bmg4XloLHkv53lrZhcbiAgICAgICAgdGhpcy5iZWZvcmUudXAgPSBjdC51cDtcbiAgICAgICAgdGhpcy5iZWZvcmUuZG93biA9IGN0LmRvd247XG4gICAgICAgIHRoaXMuYmVmb3JlLmF0dGFjayA9IGN0LmF0dGFjaztcbiAgICAgICAgdGhpcy5iZWZvcmUuanVtcCA9IGN0LnVwIHx8IGN0Lmp1bXA7XG4gICAgICAgIHRoaXMuYmVmb3JlLmNoYW5nZSA9IGN0LmNoYW5nZTtcbiAgICAgICAgdGhpcy5iZWZvcmUuaXNTdHVuID0gdGhpcy5pc1N0dW47XG4gICAgICAgIHRoaXMuYmVmb3JlLmluT25GbG9vciA9IHRoaXMuaXNPbkZsb29yO1xuICAgICAgICB0aGlzLmJlZm9yZS54ID0gdGhpcy54O1xuICAgICAgICB0aGlzLmJlZm9yZS55ID0gdGhpcy55O1xuXG4gICAgICAgIC8v44OA44Km44Oz44Kt44O86YCj57aa5oq85LiL44OV44Os44O844Og44Kr44Km44Oz44OIXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciAmJiAhdGhpcy5pc0NhdGNoTGFkZGVyICYmIGN0LmRvd24gJiYgIWN0LnJpZ2h0ICYmICFjdC5sZWZ0ICYmICFjdC51cCAmJiAhY3QuYXR0YWNrKSB7XG4gICAgICAgICAgICB0aGlzLmRvd25GcmFtZSsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kb3duRnJhbWUgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/mjqXlnLDmmYLluqfmqJnkv53lrZhcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yICYmIHRoaXMuX2NvbGxpc2lvblsyXS5oaXQudHlwZSAhPSBcIm1vdmVmbG9vclwiKSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RPbkZsb29yWCA9IHRoaXMueDtcbiAgICAgICAgICAgIHRoaXMubGFzdE9uRmxvb3JZID0gdGhpcy55O1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCx44Oq44K744OD44OIXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+enu+WLleaDheWgsVxuICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgdGhpcy52eSA9IDA7XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgr/jgrlcbiAgICAgICAgdGhpcy5ocCA9IHRoaXMuaHBNYXg7XG5cbiAgICAgICAgLy/lkITnqK7jg5Xjg6njgrBcbiAgICAgICAgdGhpcy5pc0p1bXAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0NhdGNoTGFkZGVyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNPbkZsb29yID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pZ25vcmVDb2xsaXNpb24gPSBmYWxzZTtcblxuICAgICAgICAvL+e1jOmBjuaZgumWk+ezu1xuICAgICAgICB0aGlzLm11dGVraVRpbWUgPSAwO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgdGhpcy5kb3duRnJhbWUgPSAwO1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44OzXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5iZWZvcmVBbmltYXRpb24gPSBcIlwiO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcblxuICAgICAgICAvL+aJgOaMgeijheWCmVxuICAgICAgICB0aGlzLmVxdWlwID0ge1xuICAgICAgICAgICAgdXNpbmc6IDAsICAgICAgICAgLy/nj77lnKjkvb/nlKjkuK3vvIh3ZWFwb25z44GuaW5kZXjvvIlcbiAgICAgICAgICAgIHdlYXBvbnM6IFswXSwgICAgIC8v5omA5oyB44Oq44K544OI77yI5pyA5aSn77yT77yJXG4gICAgICAgICAgICBsZXZlbDogWzBdLCAgICAgICAvL+atpuWZqOODrOODmeODq1xuICAgICAgICAgICAgc3dpdGNoT2s6IHRydWUsICAgLy/lpInmm7Tlj6/og73jg5Xjg6njgrBcbiAgICAgICAgfTtcblxuICAgICAgICAvL+atpuWZqOOCu+ODg+ODiFxuICAgICAgICB0aGlzLnNldFdlYXBvbih0aGlzLmVxdWlwLndlYXBvbnNbdGhpcy5lcXVpcC51c2luZ10pO1xuXG4gICAgICAgIC8v5omA5oyB44Ki44Kk44OG44OgXG4gICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcblxuICAgICAgICAvL+aJgOaMgeOCr+ODquOCouadoeS7tuOCreODvFxuICAgICAgICB0aGlzLmtleXMgPSBbXTtcblxuICAgICAgICAvL+aTjeS9nOWPr+iDveODleODqeOCsFxuICAgICAgICB0aGlzLmlzQ29udHJvbCA9IHRydWU7XG5cbiAgICAgICAgLy/lpJrmrrXjgrjjg6Pjg7Pjg5fmnIDlpKflm57mlbBcbiAgICAgICAgdGhpcy5udW1KdW1wTWF4ID0gMDtcblxuICAgICAgICAvL+ODgOODn+ODvOOCueODl+ODqeOCpOODiOmZpOWOu1xuICAgICAgICBpZiAodGhpcy5kdW1teSkge1xuICAgICAgICAgICAgdGhpcy5kdW1teS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHRoaXMuZHVtbXkgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCx44Kz44Oz44OG44Kj44OL44Ol44O855So44Oq44K744OD44OIXG4gICAgY29udGludWVSZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v56e75YuV5oOF5aCxXG4gICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICB0aGlzLnZ5ID0gMDtcblxuICAgICAgICAvL+OCueODhuODvOOCv+OCuVxuICAgICAgICB0aGlzLmhwID0gdGhpcy5ocE1heDtcblxuICAgICAgICAvL+WQhOeoruODleODqeOCsFxuICAgICAgICB0aGlzLmlzSnVtcCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzRGVhZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0Ryb3AgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc09uRmxvb3IgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICB0aGlzLmlnbm9yZUNvbGxpc2lvbiA9IGZhbHNlO1xuXG4gICAgICAgIC8v57WM6YGO5pmC6ZaT57O7XG4gICAgICAgIHRoaXMubXV0ZWtpVGltZSA9IDA7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmRvd25GcmFtZSA9IDA7XG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7NcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmJlZm9yZUFuaW1hdGlvbiA9IFwiXCI7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuXG4gICAgICAgIC8v5pON5L2c5Y+v6IO944OV44Op44KwXG4gICAgICAgIHRoaXMuaXNDb250cm9sID0gdHJ1ZTtcblxuICAgICAgICAvL+WkmuauteOCuOODo+ODs+ODl+acgOWkp+WbnuaVsFxuICAgICAgICB0aGlzLm51bUp1bXBNYXggPSAwO1xuXG4gICAgICAgIC8v44OA44Of44O844K544OX44Op44Kk44OI6Zmk5Y67XG4gICAgICAgIGlmICh0aGlzLmR1bW15KSB7XG4gICAgICAgICAgICB0aGlzLmR1bW15LnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy5kdW1teSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zcHJpdGUudmlzaWJsZSA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44OA44Oh44O844K45Yem55CGXG4gICAgZGFtYWdlOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgaWYgKHRoaXMubXV0ZWtpVGltZSA+IDApIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKHRhcmdldC5wb3dlciA9PSAwKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmlzRGVhZCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5pc011dGVraSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIC8v5rCX57W244Kt44Oj44Oz44K744OrXG4gICAgICAgIHRoaXMuaXNTdHVuID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGRpciA9IDA7XG4gICAgICAgIGlmICh0aGlzLnggPCB0YXJnZXQueCkgZGlyID0gMTgwO1xuICAgICAgICBpZiAoIXRoaXMuaXNDYXRjaExhZGRlcikgdGhpcy5rbm9ja2JhY2sodGFyZ2V0LnBvd2VyLCBkaXIpO1xuXG4gICAgICAgIHRoaXMuaHAgLT0gdGFyZ2V0LnBvd2VyO1xuICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgYXBwLnBsYXlTRShcImRhbWFnZVwiKTtcblxuICAgICAgICBpZiAodGhpcy5ocCA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmRlYWQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubXV0ZWtpVGltZSA9IDYwO1xuICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDE1O1xuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uICE9IFwianVtcFwiKSB0aGlzLnNldEFuaW1hdGlvbihcImRhbWFnZVwiKTtcblxuICAgICAgICAgICAgLy/msJfntbbliKTlrppcbiAgICAgICAgICAgIHZhciBkaWNlID0gTWF0aC5yYW5kaW50KDEsIDEwMCk7XG4gICAgICAgICAgICBpZiAoZGljZSA8PSB0YXJnZXQuc3R1blBvd2VyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnc3R1bicsIHtwb3dlcjogMTB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0dW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v5q275Lqh5pmC5Yem55CGXG4gICAgZGVhZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaHAgPSAwO1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNDYXRjaExhZGRlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgdGhpcy52eSA9IC02O1xuICAgICAgICB2YXIgdHcgPSBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICB0dy5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnZGVhZCcpO1xuICAgICAgICAgICAgICAgIHR3LnJlbW92ZSgpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAvL+ODgOODn+ODvOOCueODl+ODqeOCpOODiOi/veWKoFxuICAgICAgICB0aGlzLnNwcml0ZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZHVtbXkgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcykuc2V0QW5pbWF0aW9uKFwiZGVhZFwiKTtcbiAgICB9LFxuXG4gICAgLy/jgqLjgqTjg4bjg6Dlj5blvpdcbiAgICBnZXRJdGVtOiBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIC8v5q2m5ZmoXG4gICAgICAgIGlmIChpdGVtLmlzV2VhcG9uKSB7XG4gICAgICAgICAgICAvL+aXouOBq+aMgeOBo+OBpuOBhOOCi+atpuWZqOOBi+ODgeOCp+ODg+OCr1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5lcXVpcC53ZWFwb25zLmZpbmRJbmRleChmdW5jdGlvbihlLCBpLCBhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUgPT0gaXRlbS5raW5kO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoaW5kZXggPT0gbnVsbCB8fCBpbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgICAgIC8v5oyB44Gj44Gm54Sh44GE5q2m5Zmo44Gg44Gj44Gf5aC05ZCIXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZXF1aXAud2VhcG9ucy5sZW5ndGggPCAzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44Oq44K544OI44Gr6L+95YqgXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXF1aXAud2VhcG9ucy5wdXNoKGl0ZW0ua2luZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXF1aXAubGV2ZWwucHVzaChpdGVtLmxldmVsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL+ePvuWcqOS9v+eUqOatpuWZqOOBruaJi+WJjeOBruatpuWZqOOCkuaNqOOBpuOCi1xuICAgICAgICAgICAgICAgICAgICB2YXIgZHJvcEluZGV4ID0gdGhpcy5lcXVpcC51c2luZyA9PSAwPyAyOiB0aGlzLmVxdWlwLnVzaW5nIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2luZDogdGhpcy5lcXVpcC53ZWFwb25zW2Ryb3BJbmRleF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IHRoaXMuZXF1aXAubGV2ZWxbZHJvcEluZGV4XSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHZhciBkcm9wID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkl0ZW0odGhpcy54LCB0aGlzLnksIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICBkcm9wLmZyaWN0aW9uID0gMC44O1xuICAgICAgICAgICAgICAgICAgICBkcm9wLnZ4ID0gMCAqIC10aGlzLnNjYWxlWDtcbiAgICAgICAgICAgICAgICAgICAgZHJvcC52eSA9IC01O1xuICAgICAgICAgICAgICAgICAgICBkcm9wLnRocm93QXdheSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXF1aXAud2VhcG9uc1tkcm9wSW5kZXhdID0gaXRlbS5raW5kO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVxdWlwLmxldmVsW2Ryb3BJbmRleF0gPSBpdGVtLmxldmVsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy/miYDmjIHmrablmajjgpLmi77jgaPjgZ/jgonjgZ3jga7mrablmajjga7jg6zjg5njg6vjgYzkuIrjgYzjgotcbiAgICAgICAgICAgICAgICB0aGlzLmVxdWlwLmxldmVsW2luZGV4XSsrO1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHRoaXMuZXF1aXAud2VhcG9uc1t0aGlzLmVxdWlwLnVzaW5nXTtcbiAgICAgICAgICAgICAgICB2YXIgbHYgPSB0aGlzLmVxdWlwLmxldmVsW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0V2VhcG9uKGlkLCBsdik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhcHAucGxheVNFKFwiZ2V0aXRlbVwiKTtcbiAgICAgICAgfVxuICAgICAgICAvL+ijheWCmeWTgVxuICAgICAgICBpZiAoaXRlbS5pc0VxdWlwKSB7XG4gICAgICAgICAgICB0aGlzLmhwTWF4ICs9IChpdGVtLnBvd2VyIHx8IDApO1xuICAgICAgICAgICAgdGhpcy5ocCArPSAoaXRlbS5wb3dlciB8fCAwKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmhwTWF4ID4gMjAwKSB0aGlzLmhwTWF4ID0gMjAwO1xuICAgICAgICAgICAgaWYgKHRoaXMuaHAgPiB0aGlzLmhwTWF4KSB0aGlzLmhwID0gdGhpcy5ocE1heDtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUudG90YWxTY29yZSArPSAoaXRlbS5wb2ludCB8fCAwKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJnZXRpdGVtXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8v6aOf44G554mpXG4gICAgICAgIGlmIChpdGVtLmlzRm9vZCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjpgLLluqbjgavjgojjgaPjgablm57lvqnph4/jgYzlopfliqBcbiAgICAgICAgICAgIHZhciBwb3dlciA9IGl0ZW0ucG93ZXI7XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnRTY2VuZS5zdGFnZU51bWJlciA+IDQpIHBvd2VyICo9IDEuNTtcbiAgICAgICAgICAgIHRoaXMuaHAgKz0gcG93ZXI7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwicmVjb3ZlcnlcIik7XG4gICAgICAgICAgICBpZiAodGhpcy5ocCA+IHRoaXMuaHBNYXgpIHRoaXMuaHAgPSB0aGlzLmhwTWF4O1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS50b3RhbFNjb3JlICs9IChpdGVtLnBvaW50IHx8IDApO1xuICAgICAgICB9XG4gICAgICAgIC8v6Y21XG4gICAgICAgIGlmIChpdGVtLmlzS2V5KSB7XG4gICAgICAgICAgICB0aGlzLmtleXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJnZXRrZXlpdGVtXCIpO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZSgnZ2V0a2V5Jywge2tleTogaXRlbX0pO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS50b3RhbFNjb3JlICs9IChpdGVtLnBvaW50IHx8IDApO1xuICAgICAgICB9XG4gICAgICAgIC8v5b6X54K544Ki44Kk44OG44OgXG4gICAgICAgIGlmIChpdGVtLmlzSXRlbSkge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS50b3RhbFNjb3JlICs9IChpdGVtLnBvaW50IHx8IDApO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcImdldGl0ZW1cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v5L2/55So5q2m5Zmo44Gu5aSJ5pu0XG4gICAgc3dpdGNoV2VhcG9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/miYvmjIHjgaHjga7mrablmajjgYzkuIDlgIvjga7loLTlkIjjga/kvZXjgoLjgZfjgarjgYRcbiAgICAgICAgaWYgKHRoaXMuZXF1aXAud2VhcG9ucy5sZW5ndGggPCAyKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5lcXVpcC5zd2l0Y2hPayA9IGZhbHNlO1xuXG4gICAgICAgIHZhciByb3QgPSAxMjA7XG4gICAgICAgIGlmICh0aGlzLmVxdWlwLndlYXBvbnMubGVuZ3RoID09IDIgJiYgdGhpcy5lcXVpcC51c2luZyA9PSAxKSByb3QgPSAyNDA7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyV2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmJ5KHtyb3RhdGlvbjogcm90fSwgMzAwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcXVpcC5zd2l0Y2hPayA9IHRydWU7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIC8v54++5Zyo5L2/55So5q2m5Zmo6Kit5a6aXG4gICAgICAgIHRoaXMuZXF1aXAudXNpbmcgPSAodGhpcy5lcXVpcC51c2luZyArIDEpICUgdGhpcy5lcXVpcC53ZWFwb25zLmxlbmd0aDtcbiAgICAgICAgdmFyIGlkID0gdGhpcy5lcXVpcC53ZWFwb25zW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICB2YXIgbHYgPSB0aGlzLmVxdWlwLmxldmVsW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICB0aGlzLnNldFdlYXBvbihpZCwgbHYpO1xuXG4gICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgfSxcblxuICAgIC8v5q2m5Zmo5aSJ5pu0XG4gICAgc2V0V2VhcG9uOiBmdW5jdGlvbihraW5kLCBsZXZlbCkge1xuICAgICAgICBraW5kID0ga2luZCB8fCAwO1xuICAgICAgICBsZXZlbCA9IGxldmVsIHx8IDA7XG5cbiAgICAgICAgLy/lsZ7mgKfliJ3mnJ/ljJZcbiAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24uJGV4dGVuZCh7XG4gICAgICAgICAgICBpc1NsYXNoOiBmYWxzZSxcbiAgICAgICAgICAgIGlzU3Rpbmc6IGZhbHNlLFxuICAgICAgICAgICAgaXNCbG93OiBmYWxzZSxcbiAgICAgICAgICAgIGlzQXJyb3c6IGZhbHNlLFxuICAgICAgICAgICAgaXNGaXJlOiBmYWxzZSxcbiAgICAgICAgICAgIGlzSWNlOiBmYWxzZSxcbiAgICAgICAgICAgIHN0dW5Qb3dlcjogMSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jgqLjgqTjg4bjg6Dmg4XloLHlj5blvpdcbiAgICAgICAgdmFyIHNwZWMgPSBxZnQuSXRlbUluZm8uZ2V0KGtpbmQpO1xuICAgICAgICB0aGlzLmF0dGFja0NvbGxpc2lvbi4kZXh0ZW5kKHNwZWMpO1xuICAgICAgICB0aGlzLmF0dGFja0NvbGxpc2lvbi5wb3dlciArPSBsZXZlbCAqIChzcGVjLmxldmVsQm9udXMgfHwgMik7XG5cbiAgICAgICAgc3dpdGNoIChraW5kKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgLy/jgrfjg6fjg7zjg4jjgr3jg7zjg4lcbiAgICAgICAgICAgICAgICBsZXZlbCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRQb3NpdGlvbigtMywgMyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgLy/jg63jg7PjgrDjgr3jg7zjg4lcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldFBvc2l0aW9uKC0zLCAzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAvL+aWp1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQ0LCA0NCwgNDQsIDQzLCA0MywgNDMsIDQyLCA0MiwgNDIsIDQxLCA0MSwgNDEsIFwic3RvcFwiXTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRQb3NpdGlvbigtMywgMyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgLy/mp41cbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgIC8v5byTXG4gICAgICAgICAgICAgICAgbGV2ZWwgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQxLCA0MiwgNDMsIDQ0LCBcInN0b3BcIl07XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24uc2V0UG9zaXRpb24oMCwgMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgLy/prZTms5Xjga7mnZZcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgIC8v6a2U5bCO5pu4XG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFsgNDQsIDQ0LCA0NCwgNDMsIDQzLCA0MywgNDIsIDQyLCA0MiwgNDEsIDQxLCA0MSwgXCJzdG9wXCJdO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldFBvc2l0aW9uKC0zLCAzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5q2m5Zmo55S75YOP6Kit5a6aXG4gICAgICAgIHZhciBpbmRleCA9IGtpbmQgKiAxMCArIE1hdGgubWluKGxldmVsLCBzcGVjLm1heEluZGV4KTtcbiAgICAgICAgdGhpcy53ZWFwb24uc2V0RnJhbWVJbmRleChpbmRleCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v6KOF5YKZ5q2m5Zmo44Gr44KI44KK5pS75pKD44Oi44O844K344On44Oz44KS5aSJ44GI44KLXG4gICAgd2VhcG9uQXR0YWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtpbmQgPSB0aGlzLmVxdWlwLndlYXBvbnNbdGhpcy5lcXVpcC51c2luZ107XG4gICAgICAgIHZhciBsZXZlbCA9IHRoaXMuZXF1aXAubGV2ZWxbdGhpcy5lcXVpcC51c2luZ107XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHN3aXRjaCAoa2luZCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIC8v44K344On44O844OI44K944O844OJXG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImF0dGFja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDIwMCwgYWxwaGE6IDEuMH0pXG4gICAgICAgICAgICAgICAgICAgIC50byh7cm90YXRpb246IDM2MH0sIDUpXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAvL+ODreODs+OCsOOCveODvOODiVxuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJhdHRhY2tcIik7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5zZXQoe3JvdGF0aW9uOiAyMDAsIGFscGhhOiAxLjB9KVxuICAgICAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzNjB9LCA2KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgLy/mlqdcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiYXR0YWNrXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDAwLCBhbHBoYTogMS4wfSlcbiAgICAgICAgICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogMjcwfSwgOClcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIC8v5qeNXG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImF0dGFja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IC00NSwgYWxwaGE6IDEuMH0pXG4gICAgICAgICAgICAgICAgICAgIC5ieSh7eDogLTEwfSwgMilcbiAgICAgICAgICAgICAgICAgICAgLmJ5KHt4OiAxMH0sIDIpXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAvL+W8k1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJhdHRhY2tcIik7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5zZXQoe3JvdGF0aW9uOiAtNDUsIGFscGhhOiAxLjB9KVxuICAgICAgICAgICAgICAgICAgICAuYnkoe3g6IDd9LCAzKVxuICAgICAgICAgICAgICAgICAgICAuYnkoe3g6IC03fSwgMylcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXJyb3dQb3dlciA9IDUgKyBsZXZlbCAqIDI7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcnJvdyA9IHFmdC5QbGF5ZXJBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAxNSwgaGVpZ2h0OiAxMCwgcG93ZXI6IGFycm93UG93ZXIsIHR5cGU6IFwiYXJyb3dcIn0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFNjYWxlKHRoaXMuc2NhbGVYLCAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgICAgICAgICAgYXJyb3cudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKS5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYnkoe3g6ICgxNTAgKyBsZXZlbCAqIDUpICogdGhpcy5zY2FsZVh9LCA3KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZChhcnJvdykpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgIC8v6a2U5rOV44Gu5p2WXG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5zZXQoe3JvdGF0aW9uOiAyMDAsIGFscGhhOiAxLjB9KVxuICAgICAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzNjB9LCA4KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdmFyIG1hZ2ljUG93ZXIgPSAxNSArIGxldmVsICogMjtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWFnaWMgPSBxZnQuUGxheWVyQXR0YWNrKHRoaXMucGFyZW50U2NlbmUsIHt3aWR0aDogMTUsIGhlaWdodDogMTAsIGluZGV4OiAzMCwgcG93ZXI6IG1hZ2ljUG93ZXIsIHR5cGU6IFwiZmxhbWVcIn0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFNjYWxlKHRoaXMuc2NhbGVYLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgbWFnaWMucmFkID0gKDkwIC0gaSAqIDMwKS50b1JhZGlhbigpO1xuICAgICAgICAgICAgICAgICAgICBtYWdpYy5pc0NvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBtYWdpYy52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIG1hZ2ljLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoaSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNDb2xsaXNpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG14ID0gTWF0aC5jb3ModGhpcy5yYWQpICogdGhhdC5zY2FsZVg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG15ID0gTWF0aC5zaW4odGhpcy5yYWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24odGhhdC54ICsgMzIgKiBteCwgdGhhdC55ICsgMzIgKiBteSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQobWFnaWMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoOClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQobWFnaWMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgLy/prZTlsI7mm7hcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiYXR0YWNrXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDAwLCBhbHBoYTogMS4wfSlcbiAgICAgICAgICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogMjcwfSwgOClcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzEzLCAxNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzM2LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWyAzLCAgNCwgIDUsICA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbIDksIDEwLCAxMSwgMTBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFsgMCwgIDEsICAyLCAgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQxLCA0MiwgNDMsIDQ0LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkZWZlbnNlXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGFtYWdlXCJdID0gWyAxOCwgMTksIDIwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRyb3BcIl0gPSBbMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkZWFkXCJdID0gWzE4LCAxOSwgMjAsIDMzLCAzNCwgMzUsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsZWFyXCJdID0gWzI0LCAyNSwgMjZdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3R1blwiXSA9IFsgMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprnlKjjgqjjg6zjg6Hjg7Pjg4jjga7kvY3nva7lho3jgrvjg4Pjg4hcbiAgICByZXNldENvbGxpc2lvblBvc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHcgPSBNYXRoLmZsb29yKHRoaXMud2lkdGgvMikrNjtcbiAgICAgICAgdmFyIGggPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0LzIpKzY7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblswXS5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSAtIGgpO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMV0uc2V0UG9zaXRpb24odGhpcy54ICsgdywgdGhpcy55IC0gNSk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblsyXS5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSArIGgpO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10uc2V0UG9zaXRpb24odGhpcy54IC0gdywgdGhpcy55IC0gNSk7XG4gICAgICAgIHRoaXMubGFkZGVyQ29sbGlzaW9uLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v6aCt5LiK44Gv44GX44GU44OB44Kn44OD44KvXG4gICAgY2hlY2tIZWFkTGFkZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGggPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0LzIpKzEwO1xuICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAyfSkuc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnktaCk7XG4gICAgICAgIHZhciByZXQgPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUuaGl0VGVzdEVsZW1lbnQoYykpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgZS50eXBlID09IFwic3RhaXJzXCIpIHJldCA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcblxuICAgIC8v6Laz5LiL44Gv44GX44GU44OB44Kn44OD44KvXG4gICAgY2hlY2tGb290TGFkZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGggPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0LzIpKzEwO1xuICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAyfSkuc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkraCk7XG4gICAgICAgIHZhciByZXQgPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUuaGl0VGVzdEVsZW1lbnQoYykpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgZS50eXBlID09IFwic3RhaXJzXCIpIHJldCA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcblxuICAgIC8v54++5Zyo44K544OG44O844K/44K55L+d5a2YXG4gICAgc2F2ZVN0YXR1czogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v5omA5oyB5q2m5Zmo44CB44Ki44Kk44OG44Og562J44K544OG44O844K/44K544Gu5Y+W5b6XXG4gICAgICAgIHZhciBlcSA9IHRoaXMuZXF1aXA7XG4gICAgICAgIHZhciBlcXVpcCA9IHtcbiAgICAgICAgICAgIHVzaW5nOiAwLFxuICAgICAgICAgICAgd2VhcG9uczogZXEud2VhcG9ucy5jb25jYXQoKSxcbiAgICAgICAgICAgIGxldmVsOiBlcS5sZXZlbC5jb25jYXQoKSxcbiAgICAgICAgICAgIHN3aXRjaE9rOiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLml0ZW1zLmNvbmNhdCgpO1xuICAgICAgICB2YXIgbnVtSnVtcE1heCA9IHRoaXMubnVtSnVtcE1heDtcblxuICAgICAgICB0aGlzLnN0YXJ0U3RhdHVzID0ge1xuICAgICAgICAgICAgaHBNYXg6IHRoaXMuaHBNYXgsXG4gICAgICAgICAgICBocDogdGhpcy5ocCxcbiAgICAgICAgICAgIHBvd2VyOiB0aGlzLnBvd2VyLFxuICAgICAgICAgICAgZGVmZW5zZTogdGhpcy5kZWZlbnNlLFxuICAgICAgICAgICAgZXF1aXA6IGVxdWlwLFxuICAgICAgICAgICAgaXRlbXM6IGl0ZW1zLFxuICAgICAgICAgICAgbnVtSnVtcE1heDogbnVtSnVtcE1heCxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgr/jgrnlvqnlhYNcbiAgICByZXN0b3JlU3RhdHVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNzID0gdGhpcy5zdGFydFN0YXR1cztcbiAgICAgICAgdGhpcy5ocE1heCA9IHNzLmhwTWF4O1xuICAgICAgICB0aGlzLmhwID0gc3MuaHA7XG4gICAgICAgIHRoaXMucG93ZXIgPSBzcy5wb3dlcjtcbiAgICAgICAgdGhpcy5kZWZlbnNlID0gc3MuZGVmZW5zZTtcbiAgICAgICAgdGhpcy5lcXVpcCA9IHtcbiAgICAgICAgICAgIHVzaW5nOiAwLFxuICAgICAgICAgICAgd2VhcG9uczogc3MuZXF1aXAud2VhcG9ucy5jb25jYXQoKSxcbiAgICAgICAgICAgIGxldmVsOiBzcy5lcXVpcC5sZXZlbC5jb25jYXQoKSxcbiAgICAgICAgICAgIHN3aXRjaE9rOiB0cnVlLFxuICAgICAgICB9XG4gICAgICAgIGlmIChzcy5pdGVtcykge1xuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IHNzLml0ZW1zLmNvbmNhdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pdGVtID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5udW1KdW1wTWF4ID0gc3MubnVtSnVtcE1heDtcblxuICAgICAgICB2YXIgaWQgPSB0aGlzLmVxdWlwLndlYXBvbnNbdGhpcy5lcXVpcC51c2luZ107XG4gICAgICAgIHZhciBsdiA9IHRoaXMuZXF1aXAubGV2ZWxbdGhpcy5lcXVpcC51c2luZ107XG4gICAgICAgIHRoaXMuc2V0V2VhcG9uKGlkLCBsdik7XG4gICAgfSxcbn0pO1xuXG4vL+ODl+ODrOOCpOODpOODvOaUu+aSg+WIpOWumlxucGhpbmEuZGVmaW5lKFwicWZ0LlBsYXllckF0dGFja1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxLFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprnmbrnlJ/jg5Xjg6njgrBcbiAgICBpc0NvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5bGe5oCnXG4gICAgaXNTbGFzaDogZmFsc2UsXG4gICAgaXNTdGluZzogZmFsc2UsXG4gICAgaXNCbG93OiBmYWxzZSxcbiAgICBpc0Fycm93OiBmYWxzZSxcbiAgICBpc0ZpcmU6IGZhbHNlLFxuICAgIGlzSWNlOiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG5cbiAgICAgICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlIHx8IFwiYXJyb3dcIjtcbiAgICAgICAgdGhpcy5wb3dlciA9IG9wdGlvbnMucG93ZXIgfHwgMDtcbiAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG5cbiAgICAgICAgLy/ooajnpLrjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgc3dpdGNoICh0aGlzLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJhcnJvd1wiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDEpO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWUgPSBbMV07XG4gICAgICAgICAgICAgICAgdGhpcy5pc0Fycm93ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU3RpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuc3R1blBvd2VyID0gMTA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZmlyZWJhbGxcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYnVsbGV0XCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDkpO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWUgPSBbOSwgMTAsIDExLCAxMF07XG4gICAgICAgICAgICAgICAgdGhpcy5pc0ZpcmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm1hc2FrYXJpXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoMjApO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWUgPSBbMjBdO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNTbGFzaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0Jyb3cgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuc3R1blBvd2VyID0gNTA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZGFnZ2VyXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoMjApO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLnJvdGF0aW9uID0gMTM1O1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWUgPSBbMF07XG4gICAgICAgICAgICAgICAgdGhpcy5pc1N0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0dW5Qb3dlciA9IDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZmxhbWVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZWZmZWN0XCIsIDQ4LCA0OClcbiAgICAgICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAgICAgLnNldEZyYW1lVHJpbW1pbmcoMCwgMTkyLCAxOTIsIDk2KVxuICAgICAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMC41KTtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lID0gWzAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDhdO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNGaXJlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0dW5Qb3dlciA9IDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSB7XG4gICAgICAgICAgICBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogdGhpcy53aWR0aCwgaGVpZ2h0OiB0aGlzLmhlaWdodH0pLmFkZENoaWxkVG8odGhpcykuc2V0QWxwaGEoMC41KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNDb2xsaXNpb24gfHwgdGhpcy50eXBlID09IFwiZXhwbG9kZVwiKSByZXR1cm47XG5cbiAgICAgICAgaWYgKHRoaXMudGltZSAlIDMgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVJbmRleCh0aGlzLmZyYW1lW3RoaXMuaW5kZXhdKTtcbiAgICAgICAgICAgIHRoaXMuaW5kZXggPSAodGhpcy5pbmRleCArIDEpICUgdGhpcy5mcmFtZS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PSBcImZsYW1lXCIpIHJldHVybjtcblxuICAgICAgICAvL+WcsOW9ouaOpeinpuWIpOWumlxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUuY29sbGlzaW9uTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgZS50eXBlID09IFwic3RhaXJzXCIpIHJldHVybjtcbiAgICAgICAgICAgIGlmICh0aGlzLmhpdFRlc3RFbGVtZW50KGUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0NvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhcnJvd1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGljayhlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZmlyZWJhbGxcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwbG9kZShlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgLy/jg5Ljg4Pjg4jlvozlh6bnkIZcbiAgICBoaXQ6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcImZpcmViYWxsXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5leHBsb2RlKHRhcmdldCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/liLrjgZXjgotcbiAgICBzdGljazogZnVuY3Rpb24oZSkge1xuICAgICAgICAvL+WKueaenOmfs1xuICAgICAgICBzd2l0Y2ggKHRoaXMudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcImFycm93XCI6XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImFycm93c3RpY2tcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibWFzYWthcmlcIjpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNjYWxlWCA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnggPSBlLmxlZnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnggPSBlLnJpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvL+W8vuOBi+OCjOOCi1xuICAgIHNuYXA6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy/lirnmnpzpn7NcbiAgICAgICAgYXBwLnBsYXlTRShcInRpbmtsaW5nXCIpO1xuICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmJ5KHt5OiAtOTIsIHJvdGF0aW9uOiA3MDB9LCAxNSwgXCJlYXNlT3V0UXVhZFwiKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIC8v54iG55m6XG4gICAgZXhwbG9kZTogZnVuY3Rpb24oZSkge1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRWZmZWN0KHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgfSxcbn0pO1xuXG4vL+ODl+ODrOOCpOODpOODvOODgOODn+ODvOOCueODl+ODqeOCpOODiFxucGhpbmEuZGVmaW5lKFwicWZ0LlBsYXllckR1bW15XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuU3ByaXRlXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihhc3NldE5hbWUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoYXNzZXROYW1lLCAzMiwgMzIpO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFsxMywgMTRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFsgMywgIDQsICA1LCAgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrX3N0b3BcIl0gPSBbIDMsICA0LCAgNSwgIDQsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbIDksIDEwLCAxMSwgMTBdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBfc3RvcFwiXSA9ICAgWzEwLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWyAwLCAgMSwgIDIsICAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsZWFyXCJdID0gWzI0LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkYW1hZ2VcIl0gPSBbIDE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGVhZFwiXSA9IFsxOCwgMTksIDIwLCAzMywgMzQsIDM1LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuXG4gICAgICAgIHRoaXMubm93QW5pbWF0aW9uID0gXCJzdGFuZFwiO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbiA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5ieCA9IDA7XG4gICAgICAgIHRoaXMuYnkgPSAwO1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIC8v5b2x44Gu6L+95YqgXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHNjID0gMTYgLyAyNDtcbiAgICAgICAgaWYgKHNjIDwgMSkgc2MgKz0gMC4yO1xuICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwic2hhZG93XCIsIDI0LCA4KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjUpXG4gICAgICAgICAgICAuc2V0U2NhbGUoc2MsIDEuMClcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAxNik7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbiAmJiB0aGlzLnRpbWUgJSA2ID09IDApIHtcbiAgICAgICAgICAgIHRoaXMuaW5kZXggPSAodGhpcy5pbmRleCsxKSAlIHRoaXMuZnJhbWVbdGhpcy5ub3dBbmltYXRpb25dLmxlbmd0aDtcbiAgICAgICAgICAgIGlmICh0aGlzLmZyYW1lW3RoaXMubm93QW5pbWF0aW9uXVt0aGlzLmluZGV4XSA9PSBcInN0b3BcIikgdGhpcy5pbmRleC0tO1xuICAgICAgICAgICAgdGhpcy5mcmFtZUluZGV4ID0gdGhpcy5mcmFtZVt0aGlzLm5vd0FuaW1hdGlvbl1bdGhpcy5pbmRleF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy54IDwgdGhpcy5ieCkgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICBpZiAodGhpcy54ID4gdGhpcy5ieCkgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgdGhpcy5ieCA9IHRoaXMueDtcbiAgICAgICAgdGhpcy5ieSA9IHRoaXMueTtcblxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgc2V0QW5pbWF0aW9uOiBmdW5jdGlvbihhbmltTmFtZSkge1xuICAgICAgICBpZiAoIXRoaXMuZnJhbWVbYW5pbU5hbWVdKSByZXR1cm47XG4gICAgICAgIGlmIChhbmltTmFtZSA9PSB0aGlzLm5vd0FuaW1hdGlvbikgcmV0dXJuO1xuICAgICAgICB0aGlzLm5vd0FuaW1hdGlvbiA9IGFuaW1OYW1lO1xuICAgICAgICB0aGlzLmluZGV4ID0gLTE7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcblxuLy/jg5fjg6zjgqTjg6Tjg7znj77lnKjkvb/nlKjmrablmajooajnpLpcbnBoaW5hLmRlZmluZShcInFmdC5QbGF5ZXJXZWFwb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGxheWVyKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5iYXNlID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuYmFzZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSAtdGhhdC5yb3RhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDogMjUsXG4gICAgICAgICAgICBoZWlnaHQ6IDI1LFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuMClcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJ5ZWxsb3dcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICAvL+S9v+eUqOS4reatpuWZqFxuICAgICAgICBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMuYmFzZSkuc2V0UG9zaXRpb24oMCwgLTE4KTtcbiAgICAgICAgLy/mjajjgabjgaHjgoPjgYbmrablmahcbiAgICAgICAgdGhpcy5kcm9wRnJhbWUgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHtzdHJva2U6IFwicmVkXCJ9LiRzYWZlKHBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMuYmFzZSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigxNCwgMTApXG4gICAgICAgICAgICAuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHRoaXMuZHJvcEZyYW1lLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoYXQucGxheWVyLmVxdWlwLndlYXBvbnMubGVuZ3RoIDwgMykge1xuICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/mrablmajjg6rjgrnjg4jvvIjvvJPjgaTvvIlcbiAgICAgICAgdGhpcy53ZWFwb25zID0gW107XG4gICAgICAgIHZhciByYWQgPSAwO1xuICAgICAgICB2YXIgcmFkXzEgPSAoTWF0aC5QSSoyKSAvIDM7XG4gICAgICAgICgzKS50aW1lcyhmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICB2YXIgeCA9ICBNYXRoLnNpbihyYWQpKjE4O1xuICAgICAgICAgICAgdmFyIHkgPSAtTWF0aC5jb3MocmFkKSoxODtcbiAgICAgICAgICAgIHJhZCAtPSByYWRfMTtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uc1tpXSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbnNbaV0uaW5kZXggPSBpO1xuICAgICAgICAgICAgdGhpcy53ZWFwb25zW2ldLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSAtdGhhdC5yb3RhdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgd2VhcG9ucyA9IHRoYXQucGxheWVyLmVxdWlwLndlYXBvbnM7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXggPCB3ZWFwb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIga2luZCA9IHRoYXQucGxheWVyLmVxdWlwLndlYXBvbnNbdGhpcy5pbmRleF07XG4gICAgICAgICAgICAgICAgICAgIHZhciBsZXZlbCA9IHRoYXQucGxheWVyLmVxdWlwLmxldmVsW3RoaXMuaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3BlYyA9IHFmdC5JdGVtSW5mby5nZXQoa2luZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGtpbmQgKiAxMCArIE1hdGgubWluKGxldmVsLCBzcGVjLm1heEluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZUluZGV4KGluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IDEwLFxuICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy/lvLfljJbjg6zjg5njg6vooajnpLpcbiAgICAgICAgICAgIHRoaXMud2VhcG9uc1tpXS5sZXZlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKS5zZXRQb3NpdGlvbig2LCA2KS5hZGRDaGlsZFRvKHRoaXMud2VhcG9uc1tpXSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbnNbaV0ubGV2ZWwuaW5kZXggPSBpO1xuICAgICAgICAgICAgdGhpcy53ZWFwb25zW2ldLmxldmVsLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBsZXZlbCA9IHRoYXQucGxheWVyLmVxdWlwLmxldmVsW3RoaXMuaW5kZXhdO1xuICAgICAgICAgICAgICAgIGlmIChsZXZlbCAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiK1wiK2xldmVsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBjbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgfSxcbn0pO1xuIl19
