/*
 *  phina.assetloaderex.js
 *  2016/11/25
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//バックグラウンドでアセット読み込み
phina.define("phina.extension.AssetLoaderEx", {

    //進捗
    loadprogress: 0,

    //読み込み終了フラグ
    loadcomplete: false,

    init: function() {
    },

    load: function(assets, callback) {
        this._onLoadAssets = callback || function(){};
        var loader = phina.asset.AssetLoader();
        loader.load(assets);
        loader.on('load', function(e) {
            this.loadcomplete = true;
            this._onLoadAssets();
        }.bind(this));
        loader.onprogress = function(e) {
            this.loadprogress = e.progress;
        }.bind(this);
        return this;
    },
});

/*
 *  phina.extension.js
 *  2016/11/25
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//setAlphaを追加
phina.display.DisplayElement.prototype.setAlpha = function(val) {
    this.alpha = val;
    return this;
};

//スプライト機能拡張
phina.display.Sprite.prototype.setFrameTrimming = function(x, y, width, height) {
  this._frameTrimX = x || 0;
  this._frameTrimY = y || 0;
  this._frameTrimWidth = width || this.image.domElement.width - this._frameTrimX;
  this._frameTrimHeight = height || this.image.domElement.height - this._frameTrimY;
  return this;
}

phina.display.Sprite.prototype.setFrameIndex = function(index, width, height) {
  var sx = this._frameTrimX || 0;
  var sy = this._frameTrimY || 0;
  var sw = this._frameTrimWidth  || (this.image.domElement.width-sx);
  var sh = this._frameTrimHeight || (this.image.domElement.height-sy);

  var tw  = width || this.width;      // tw
  var th  = height || this.height;    // th
  var row = ~~(sw / tw);
  var col = ~~(sh / th);
  var maxIndex = row*col;
  index = index%maxIndex;

  var x   = index%row;
  var y   = ~~(index/row);
  this.srcRect.x = sx+x*tw;
  this.srcRect.y = sy+y*th;
  this.srcRect.width  = tw;
  this.srcRect.height = th;

  this._frameIndex = index;

  return this;
}

//エレメント同士の接触判定
phina.display.DisplayElement.prototype.isHitElement = function(elm) {
    //自分とテスト対象をグローバルへ変換
    var p = this.globalToLocal(elm);
    var target = phina.display.DisplayElement({width: elm.width, height: elm.height}).setPosition(p.x, p.y);

    if (this.boundingType == 'rect') {
        if (elm.boundingType == 'rect') {
            return phina.geom.Collision.testRectRect(this, target);
        } else {
            return phina.geom.Collision.testRectCircle(this, target);
        }
    } else {
        if (elm.boundingType == 'rect') {
            return phina.geom.Collision.testCiecleRect(this, target);
        } else {
            return phina.geom.Collision.testCircleCircle(this, target);
        }
    }
}

//子要素全て切り離し
phina.app.Element.prototype.removeChildren = function(beginIndex) {
    beginIndex = beginIndex || 0;
    var tempChildren = this.children.slice();
    var len = len = tempChildren.length;
    for (var i = beginIndex; i < len; ++i) {
        tempChildren[i].remove();
    }
    this.children = [];
}

/**
 * @method testLineLine
 * @static
 * 2つの線分が重なっているかどうかを判定します
 * 参考：http://www5d.biglobe.ne.jp/~tomoya03/shtml/algorithm/Intersection.htm
 *
 * ### Example
 *     p1 = phina.geom.Vector2(100, 100);
 *     p2 = phina.geom.Vector2(200, 200);
 *     p3 = phina.geom.Vector2(150, 240);
 *     p4 = phina.geom.Vector2(200, 100);
 * phina.geom.Collision.testLineLine(p1, p2, p3, p4); // => true
 *
 * @param {phina.geom.Vector2} p1 線分1の端の座標
 * @param {phina.geom.Vector2} p2 線分1の端の座標
 * @param {phina.geom.Vector2} p3 線分2の端の座標
 * @param {phina.geom.Vector2} p4 線分2の端の座標
 * @return {Boolean} 線分1と線分2が重なっているかどうか
 */
phina.geom.Collision.testLineLine = function(p1, p2, p3, p4) {
  //同一ＸＹ軸上に乗ってる場合の誤判定回避
  if (p1.x == p2.x && p1.x == p3.x && p1.x == p4.x) {
    var min = Math.min(p1.y, p2.y);
    var max = Math.max(p1.y, p2.y);
    if (min <= p3.y && p3.y <= max || min <= p4.y && p4.y <= max) return true;
    return false;
  }
  if (p1.y == p2.y && p1.y == p3.y && p1.y == p4.y) {
    var min = Math.min(p1.x, p2.x);
    var max = Math.max(p1.x, p2.x);
    if (min <= p3.x && p3.x <= max || min <= p4.x && p4.x <= max) return true;
    return false;
  }
  var a = (p1.x - p2.x) * (p3.y - p1.y) + (p1.y - p2.y) * (p1.x - p3.x);
  var b = (p1.x - p2.x) * (p4.y - p1.y) + (p1.y - p2.y) * (p1.x - p4.x);
  var c = (p3.x - p4.x) * (p1.y - p3.y) + (p3.y - p4.y) * (p3.x - p1.x);
  var d = (p3.x - p4.x) * (p2.y - p3.y) + (p3.y - p4.y) * (p3.x - p2.x);
  return a * b <= 0 && c * d <= 0;
}

/**
 * @method testRectLine
 * @static
 * 矩形と線分が重なっているかどうかを判定します
 *
 * ### Example
 *     rect = phina.geom.Rect(120, 130, 40, 50);
 *     p1 = phina.geom.Vector2(100, 100);
 *     p2 = phina.geom.Vector2(200, 200);
 * phina.geom.Collision.testRectLine(rect, p1, p2); // => true
 *
 * @param {phina.geom.Rect} rect 矩形領域オブジェクト
 * @param {phina.geom.Vector2} p1 線分の端の座標
 * @param {phina.geom.Vector2} p2 線分の端の座標
 * @return {Boolean} 矩形と線分が重なっているかどうか
 */
phina.geom.Collision.testRectLine = function(rect, p1, p2) {
    //包含判定(p1が含まれてれば良いのでp2の判定はしない）
    if (rect.left <= p1.x && p1.x <= rect.right && rect.top <= p1.y && p1.y <= rect.bottom ) return true;

    //矩形の４点
    var r1 = phina.geom.Vector2(rect.left, rect.top);     //左上
    var r2 = phina.geom.Vector2(rect.right, rect.top);    //右上
    var r3 = phina.geom.Vector2(rect.right, rect.bottom); //右下
    var r4 = phina.geom.Vector2(rect.left, rect.bottom);  //左下

    //矩形の４辺をなす線分との接触判定
    if (phina.geom.Collision.testLineLine(p1, p2, r1, r2)) return true;
    if (phina.geom.Collision.testLineLine(p1, p2, r2, r3)) return true;
    if (phina.geom.Collision.testLineLine(p1, p2, r3, r4)) return true;
    if (phina.geom.Collision.testLineLine(p1, p2, r1, r4)) return true;
    return false;
}


//円弧の描画
phina.define('phina.display.ArcShape', {
  superClass: 'phina.display.Shape',

  init: function(options) {
    options = ({}).$safe(options, {
      backgroundColor: 'transparent',
      fill: 'red',
      stroke: '#aaa',
      strokeWidth: 4,
      radius: 32,
      startAngle: 0,
      endAngle: 270,

      anticlockwise: false,
    });
    this.superInit(options);

    this.radius = options.radius;
    this.startAngle = options.startAngle;
    this.endAngle = options.endAngle;
    this.anticlockwise = options.anticlockwise;

    this.setBoundingType('circle');
  },

  prerender: function(canvas) {
    canvas.fillPie(0, 0, this.radius, this.startAngle, this.endAngle);
  },
});

/*
 *  phina.tiledmap.js
 *  2016/09/10
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

/**
 * @class phina.asset.TiledMap
 * @extends phina.asset.Asset
 * # TiledMapEditorで作成したtmxファイルを読み込みクラス
 */
phina.define("phina.asset.TiledMap", {
    superClass: "phina.asset.Asset",

    /**
     * @property image
     * 作成されたマップ画像
     */
    image: null,

    /**
     * @property tilesets
     * タイルセット情報
     */
    tilesets: null,

    /**
     * @property layers
     * レイヤー情報が格納されている配列
     */
    layers: null,

    init: function() {
        this.superInit();
    },

    _load: function(resolve) {
        //パス抜き出し
        this.path = "";
        var last = this.src.lastIndexOf("/");
        if (last > 0) {
            this.path = this.src.substring(0, last+1);
        }

        //終了関数保存
        this._resolve = resolve;

        // load
        var self = this;
        var xml = new XMLHttpRequest();
        xml.open('GET', this.src);
        xml.onreadystatechange = function() {
            if (xml.readyState === 4) {
                if ([200, 201, 0].indexOf(xml.status) !== -1) {
                    var data = xml.responseText;
                    data = (new DOMParser()).parseFromString(data, "text/xml");
                    self.dataType = "xml";
                    self.data = data;
                    self._parse(data);
//                    resolve(self);
                }
            }
        };
        xml.send(null);
    },

    /**
     * @method getMapData
     * 指定したマップレイヤーを配列として取得します。
     *
     * @param {String} layerName 対象レイヤー名
     */
    getMapData: function(layerName) {
        //レイヤー検索
        var data = null;
        for(var i = 0; i < this.layers.length; i++) {
            if (this.layers[i].name == layerName) {
                //コピーを返す
                return this.layers[i].data.concat();
            }
        }
        return null;
    },

    /**
     * @method getObjectGroup
     * オブジェクトグループを取得します
     *
     * グループ指定が無い場合、全レイヤーを配列にして返します。
     *
     * @param {String} grounpName 対象オブジェクトグループ名
     */
    getObjectGroup: function(groupName) {
        groupName = groupName || null;
        var ls = [];
        var len = this.layers.length;
        for (var i = 0; i < len; i++) {
            if (this.layers[i].type == "objectgroup") {
                if (groupName == null || groupName == this.layers[i].name) {
                    //レイヤー情報をクローンする
                    var obj = this._cloneObjectLayer(this.layers[i]);
                    if (groupName !== null) return obj;
                }
                ls.push(obj);
            }
        }
        return ls;
    },

    /**
     * @method getMapImage
     * マップイメージの作成
     *
     * 複数のマップレイヤーを指定出来ます。
     * 描画順序はTiledMapEditor側での指定順では無く、引数の順序となります（第一引数が一番下となる）
     *
     * @param {String}  対象レイヤー名
     */
    getImage: function(...args) {
        var numLayer = 0;
        for (var i = 0; i < this.layers.length; i++) {
            if (this.layers[i].type == "layer" || this.layers[i].type == "imagelayer") numLayer++;
        }
        if (numLayer == 0) return null;

        var generated = false;
        var width = this.width * this.tilewidth;
        var height = this.height * this.tileheight;
        var canvas = phina.graphics.Canvas().setSize(width, height);

        for (var i = 0; i < this.layers.length; i++) {
            var find = args.indexOf(this.layers[i].name);
            if (args.length == 0 || find >= 0) {
                //マップレイヤー
                if (this.layers[i].type == "layer" && this.layers[i].visible != "0") {
                    var layer = this.layers[i];
                    var mapdata = layer.data;
                    var width = layer.width;
                    var height = layer.height;
                    var opacity = layer.opacity || 1.0;
                    var count = 0;
                    for (var y = 0; y < height; y++) {
                        for (var x = 0; x < width; x++) {
                            var index = mapdata[count];
                                if (index !== -1) {
                                //マップチップを配置
                                this._setMapChip(canvas, index, x * this.tilewidth, y * this.tileheight, opacity);
                            }
                            count++;
                        }
                    }
                    generated = true;
                }
                //オブジェクトグループ
                if (this.layers[i].type == "objectgroup" && this.layers[i].visible != "0") {
                    var layer = this.layers[i];
                    var opacity = layer.opacity || 1.0;
                    layer.objects.forEach(function(e) {
                        if (e.gid) {
                            this._setMapChip(canvas, e.gid, e.x, e.y, opacity);
                        }
                    }.bind(this));
                    generated = true;
                }
                //イメージレイヤー
                if (this.layers[i].type == "imagelayer" && this.layers[i].visible != "0") {
                    var len = this.layers[i];
                    var image = phina.asset.AssetManager.get('image', this.layers[i].image.source);
                    canvas.context.drawImage(image.domElement, this.layers[i].x, this.layers[i].y);
                    generated = true;
                }
            }
        }

        if (!generated) return null;

        var texture = phina.asset.Texture();
        texture.domElement = canvas.domElement;
        return texture;
    },

    /**
     * @method _cloneObjectLayer
     * 引数として渡されたオブジェクトレイヤーをクローンして返します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _cloneObjectLayer: function(srcLayer) {
        var result = {}.$safe(srcLayer);
        result.objects = [];
        //レイヤー内オブジェクトのコピー
        srcLayer.objects.forEach(function(obj){
            var resObj = {
                properties: {}.$safe(obj.properties),
            }.$extend(obj);
            if (obj.ellipse) resObj.ellipse = obj.ellipse;
            if (obj.gid) resObj.gid = obj.gid;
            if (obj.polygon) resObj.polygon = obj.polygon.clone();
            if (obj.polyline) resObj.polyline = obj.polyline.clone();
            result.objects.push(resObj);
        });
        return result;
    },

    /**
     * @method _parse
     * 取得したTiledMapEditのデータをパースします。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parse: function(data) {
        //タイル属性情報取得
        var map = data.getElementsByTagName('map')[0];
        var attr = this._attrToJSON(map);
        this.$extend(attr);
        this.properties = this._propertiesToJSON(map);

        //タイルセット取得
        this.tilesets = this._parseTilesets(data);

        //タイルセット情報補完
        var defaultAttr = {
            tilewidth: 32,
            tileheight: 32,
            spacing: 0,
            margin: 0,
        };
        this.tilesets.chips = [];
        for (var i = 0; i < this.tilesets.length; i++) {
            //タイルセット属性情報取得
            var attr = this._attrToJSON(data.getElementsByTagName('tileset')[i]);
            attr.$safe(defaultAttr);
            attr.firstgid--;
            this.tilesets[i].$extend(attr);

            //マップチップリスト作成
            var t = this.tilesets[i];
            this.tilesets[i].mapChip = [];
            for (var r = attr.firstgid; r < attr.firstgid+attr.tilecount; r++) {
                var chip = {
                    image: t.image,
                    x: ((r - attr.firstgid) % t.columns) * (t.tilewidth + t.spacing) + t.margin,
                    y: Math.floor((r - attr.firstgid) / t.columns) * (t.tileheight + t.spacing) + t.margin,
                }.$safe(attr);
                this.tilesets.chips[r] = chip;
            }
        }

        //レイヤー取得
        this.layers = this._parseLayers(data);

        //イメージデータ読み込み
        this._checkImage();
    },

    /**
     * @method _checkImage
     * アセットに無いイメージデータをチェックして読み込みを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _checkImage: function() {
        var that = this;
        var imageSource = [];
        var loadImage = [];

        //一覧作成
        for (var i = 0; i < this.tilesets.length; i++) {
            var obj = {
                image: this.tilesets[i].image,
                transR: this.tilesets[i].transR,
                transG: this.tilesets[i].transG,
                transB: this.tilesets[i].transB,
            };
            imageSource.push(obj);
        }
        for (var i = 0; i < this.layers.length; i++) {
            if (this.layers[i].image) {
                var obj = {
                    image: this.layers[i].image.source
                };
                imageSource.push(obj);
            }
        }

        //アセットにあるか確認
        for (var i = 0; i < imageSource.length; i++) {
            var image = phina.asset.AssetManager.get('image', imageSource[i].image);
            if (image) {
                //アセットにある
            } else {
                //なかったのでロードリストに追加
                loadImage.push(imageSource[i]);
            }
        }

        //一括ロード
        //ロードリスト作成
        var assets = {
            image: []
        };
        for (var i = 0; i < loadImage.length; i++) {
            //イメージのパスをマップと同じにする
            assets.image[loadImage[i].image] = this.path+loadImage[i].image;
        }
        if (loadImage.length) {
            var loader = phina.asset.AssetLoader();
            loader.load(assets);
            loader.on('load', function(e) {
                //透過色設定反映
                loadImage.forEach(function(elm) {
                    var image = phina.asset.AssetManager.get('image', elm.image);
                    if (elm.transR !== undefined) {
                        var r = elm.transR, g = elm.transG, b = elm.transB;
                        image.filter(function(pixel, index, x, y, bitmap) {
                            var data = bitmap.data;
                            if (pixel[0] == r && pixel[1] == g && pixel[2] == b) {
                                data[index+3] = 0;
                            }
                        });
                    }
                });
                //読み込み終了
                that._resolve(that);
            }.bind(this));
        } else {
            //読み込み終了
            this._resolve(that);
        }
    },

    /**
     * @method _setMapChip
     * キャンバスの指定した座標にマップチップのイメージをコピーします。
     *
     * 内部で使用している関数です。
     * @private
     */
    _setMapChip: function(canvas, index, x, y, opacity) {
        //タイルセットからマップチップを取得
        var chip = this.tilesets.chips[index];
        if (!chip) {
            return;
        }
        var image = phina.asset.AssetManager.get('image', chip.image);
        if (!image) {
            console.log(chip.image);
        }
        canvas.context.drawImage(
            image.domElement,
            chip.x + chip.margin, chip.y + chip.margin,
            chip.tilewidth, chip.tileheight,
            x, y,
            chip.tilewidth, chip.tileheight);
    },

    /**
     * @method _propertiesToJSON
     * XMLプロパティをJSONに変換します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _propertiesToJSON: function(elm) {
        var properties = elm.getElementsByTagName("properties")[0];
        var obj = {};
        if (properties === undefined) {
            return obj;
        }
        for (var k = 0; k < properties.childNodes.length; k++) {
            var p = properties.childNodes[k];
            if (p.tagName === "property") {
                //propertyにtype指定があったら変換
                var type = p.getAttribute('type');
                var value = p.getAttribute('value');
                if (!value) value = p.textContent;
                if (type == "int") {
                    obj[p.getAttribute('name')] = parseInt(value, 10);
                } else if (type == "float") {
                    obj[p.getAttribute('name')] = parseFloat(value);
                } else if (type == "bool" ) {
                    if (value == "true") obj[p.getAttribute('name')] = true;
                    else obj[p.getAttribute('name')] = false;
                } else {
                    obj[p.getAttribute('name')] = value;
                }
            }
        }
        return obj;
    },

    /**
     * @method _propertiesToJSON
     * XML属性情報をJSONに変換します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _attrToJSON: function(source) {
        var obj = {};
        for (var i = 0; i < source.attributes.length; i++) {
            var val = source.attributes[i].value;
            val = isNaN(parseFloat(val))? val: parseFloat(val);
            obj[source.attributes[i].name] = val;
        }
        return obj;
    },

    /**
     * @method _propertiesToJSON_str
     * XMLプロパティをJSONに変換し、文字列で返します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _attrToJSON_str: function(source) {
        var obj = {};
        for (var i = 0; i < source.attributes.length; i++) {
            var val = source.attributes[i].value;
            obj[source.attributes[i].name] = val;
        }
        return obj;
    },

    /**
     * @method _parseTilesets
     * タイルセットのパースを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parseTilesets: function(xml) {
        var each = Array.prototype.forEach;
        var self = this;
        var data = [];
        var tilesets = xml.getElementsByTagName('tileset');
        each.call(tilesets, function(tileset) {
            var t = {};
            var props = self._propertiesToJSON(tileset);
            if (props.src) {
                t.image = props.src;
            } else {
                t.image = tileset.getElementsByTagName('image')[0].getAttribute('source');
            }
            //透過色設定取得
            t.trans = tileset.getElementsByTagName('image')[0].getAttribute('trans');
            if (t.trans) {
                t.transR = parseInt(t.trans.substring(0, 2), 16);
                t.transG = parseInt(t.trans.substring(2, 4), 16);
                t.transB = parseInt(t.trans.substring(4, 6), 16);
            }

            data.push(t);
        });
        return data;
    },

    /**
     * @method _parseLayers
     * レイヤー情報のパースを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parseLayers: function(xml) {
        var each = Array.prototype.forEach;
        var data = [];

        var map = xml.getElementsByTagName("map")[0];
        var layers = [];
        each.call(map.childNodes, function(elm) {
            if (elm.tagName == "layer" || elm.tagName == "objectgroup" || elm.tagName == "imagelayer") {
                layers.push(elm);
            }
        });

        layers.each(function(layer) {
            switch (layer.tagName) {
                case "layer":
                    //通常レイヤー
                    var d = layer.getElementsByTagName('data')[0];
                    var encoding = d.getAttribute("encoding");
                    var l = {
                        type: "layer",
                        name: layer.getAttribute("name"),
                    };

                    if (encoding == "csv") {
                        l.data = this._parseCSV(d.textContent);
                    } else if (encoding == "base64") {
                        l.data = this._parseBase64(d.textContent);
                    }

                    var attr = this._attrToJSON(layer);
                    l.$extend(attr);
                    l.properties = this._propertiesToJSON(layer);

                    data.push(l);
                    break;

                //オブジェクトレイヤー
                case "objectgroup":
                    var l = {
                        type: "objectgroup",
                        objects: [],
                        name: layer.getAttribute("name"),
                        x: parseFloat(layer.getAttribute("offsetx")) || 0,
                        y: parseFloat(layer.getAttribute("offsety")) || 0,
                        alpha: layer.getAttribute("opacity") || 1,
                        color: layer.getAttribute("color") || null,
                        draworder: layer.getAttribute("draworder") || null,
                    };
                    l.properties = this._propertiesToJSON(layer);

                    //レイヤー内解析
                    each.call(layer.childNodes, function(elm) {
                        if (elm.nodeType == 3) return;
                        var d = this._attrToJSON(elm);
                        if (d.id === undefined) return;
                        d.properties = this._propertiesToJSON(elm);
                        //子要素の解析
                        if (elm.childNodes.length) {
                            elm.childNodes.forEach(function(e) {
                                if (e.nodeType == 3) return;
                                //楕円
                                if (e.nodeName == 'ellipse') {
                                    d.ellipse = true;
                                }
                                //多角形
                                if (e.nodeName == 'polygon') {
                                    d.polygon = [];
                                    var attr = this._attrToJSON_str(e);
                                    var pl = attr.points.split(" ");
                                    pl.forEach(function(str) {
                                        var pts = str.split(",");
                                        d.polygon.push({x: parseFloat(pts[0]), y: parseFloat(pts[1])});
                                    });
                                }
                                //線分
                                if (e.nodeName == 'polyline') {
                                    d.polyline = [];
                                    var attr = this._attrToJSON_str(e);
                                    var pl = attr.points.split(" ");
                                    pl.forEach(function(str) {
                                        var pts = str.split(",");
                                        d.polyline.push({x: parseFloat(pts[0]), y: parseFloat(pts[1])});
                                    });
                                }
                            }.bind(this));
                        }
                        l.objects.push(d);
                    }.bind(this));

                    data.push(l);
                    break;

                //イメージレイヤー
                case "imagelayer":
                    var l = {
                        type: "imagelayer",
                        name: layer.getAttribute("name"),
                        x: parseFloat(layer.getAttribute("offsetx")) || 0,
                        y: parseFloat(layer.getAttribute("offsety")) || 0,
                        alpha: layer.getAttribute("opacity") || 1,
                        visible: (layer.getAttribute("visible") === undefined || layer.getAttribute("visible") != 0),
                    };
                    var imageElm = layer.getElementsByTagName("image")[0];
                    l.image = {source: imageElm.getAttribute("source")};

                    data.push(l);
                    break;
            }
        }.bind(this));
        return data;
    },

    /**
     * @method _perseCSV
     * CSVのパースを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parseCSV: function(data) {
        var dataList = data.split(',');
        var layer = [];

        dataList.each(function(elm, i) {
            var num = parseInt(elm, 10) - 1;
            layer.push(num);
        });

        return layer;
    },

    /**
     * @method _perseCSV
     * BASE64のパースを行います。
     *
     * 内部で使用している関数です。
     * http://thekannon-server.appspot.com/herpity-derpity.appspot.com/pastebin.com/75Kks0WH
     * @private
     */
    _parseBase64: function(data) {
        var dataList = atob(data.trim());
        var rst = [];

        dataList = dataList.split('').map(function(e) {
            return e.charCodeAt(0);
        });

        for (var i=0,len=dataList.length/4; i<len; ++i) {
            var n = dataList[i*4];
            rst[i] = parseInt(n, 10) - 1;
        }

        return rst;
    },
});

//ローダーに追加
phina.asset.AssetLoader.assetLoadFunctions.tmx = function(key, path) {
    var tmx = phina.asset.TiledMap();
    return tmx.load(path);
};

/*
 *  phina.virtualpad.js
 *  2017/06/13
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//バーチャルパッド
phina.define("phina.extension.VirtualPad", {
    superClass: "phina.display.DisplayElement",

    active: true,

    //挿下キー情報
    keyData: {
        up: false,
        down: false,
        left: false,
        right: false,
        a: false,
        b: false,
    },

    defaultOptions: {
        //パッド縦横
        width: 640,
        height: 480,

        //パッド座標
        x: 0,
        y: 0,

        //判定半径
        fingerRadius: 20,
    },

    init: function(options) {
        this.superInit();
        options = (options || {}).$safe(this.defaultOptions);
        this.options = options;

        var param = {
            width: options.width,
            height: options.height,
            fill: "rgba(0,0,0,0.3)",
            stroke: "rgba(0,0,0,0.3)",
            strokeWigth: 0,
            backgroundColor: 'transparent',
        };
        this.mask = phina.display.RectangleShape(param)
//            .addChildTo(this)
            .setOrigin(0, 0)
            .setPosition(options.x, options.y);

        this.analog = phina.extension.VirtualPad.AnalogStick()
            .addChildTo(this)
            .setPosition(82, options.height - 82);

        this.btn = [];
        this.btn[0] = phina.extension.VirtualPad.Button().addChildTo(this).setPosition(options.width * 0.7, options.height * 0.9);
        this.btn[1] = phina.extension.VirtualPad.Button().addChildTo(this).setPosition(options.width * 0.7 + 80, options.height * 0.9);

        //タップ位置表示
        var fingerParam = {
            backgroundColor: 'transparent',
            fill: "rgba(0,0,0,0.2)",
            stroke: "rgba(0,0,0,0.2)",
            strokeWidth: 1,
            radius: options.fingerRadius,
        };
        this.finger = [];
        for (var i = 0; i < 5; i++) {
            this.finger[i] = phina.display.CircleShape(fingerParam).addChildTo(this);
            this.finger[i].visible = false;
        }
    },

    update: function() {
    },

    updateInfo: function() {
        var p = app.mouse;
        if (p.getPointing()) {
            //タップ位置表示
            var ps = app.pointers;
            for (var i = 0; i < 5; i++) {
                if (i < ps.length) {
                    this.finger[i].visible = true;
                    this.finger[i].setPosition(ps[i].x, ps[i].y);
                } else {
                    this.finger[i].visible = false;
                }
            }
        } else {
            for (var i = 0; i < 5; i++) {
                this.finger[i].visible = false;
            }
        }
    },

    getKey: function(code) {
        var ov = 10;
        var angle = this.analog.angle;
        switch (code) {
            case "right":
                return angle && (angle >= 315 - ov || angle <= 45 + ov);
            case "down":
                return angle && (angle >= 45 - ov && angle <= 135 + ov);
            case "left":
                return angle && (angle >= 135 - ov && angle <= 215 + ov);
            case "up":
                return angle && (angle >= 215 - ov && angle <= 315 + ov);
            case "z":
            case "Z":
                return this.btn[0].isOn;
            case "x":
            case "X":
                return this.btn[1].isOn;
            default:
                return false;
        }
    },
});

//バーチャルパッド十字キー
phina.define("phina.extension.VirtualPad.CrossKey", {
    superClass: "phina.display.DisplayElement",

    active: true,

    init: function(options) {
        this.superInit();
        options = (options || {}).$safe(this.defaultOptions);
        this.options = options;

        //十字キー中心点
        var hw = 0;
        var hh = 0;
        var cp = phina.geom.Vector2(0, 0);

        var button = {
            width: 20,
            height: 20,
            fill: "rgba(0,0,0,0.2)",
            stroke: "rgba(0,0,0,0.2)",
            backgroundColor: 'transparent',
        };
        //0:上 1:右上 2:右 3:右下 4:下 5:左下 6:左 7:左上
        this.btn = [];
        this.btn[0] = phina.display.RectangleShape({width: 60, height: 50}.$safe(button)).setPosition(cp.x     , cp.y - 40).addChildTo(this).setInteractive(true);
        this.btn[2] = phina.display.RectangleShape({width: 50, height: 60}.$safe(button)).setPosition(cp.x + 40, cp.y     ).addChildTo(this).setInteractive(true);
        this.btn[4] = phina.display.RectangleShape({width: 60, height: 50}.$safe(button)).setPosition(cp.x     , cp.y + 40).addChildTo(this).setInteractive(true);
        this.btn[6] = phina.display.RectangleShape({width: 50, height: 60}.$safe(button)).setPosition(cp.x - 40, cp.y     ).addChildTo(this).setInteractive(true);

        this.btn[1] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x + 40, cp.y - 40).addChildTo(this).setInteractive(true);
        this.btn[3] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x + 40, cp.y + 40).addChildTo(this).setInteractive(true);
        this.btn[5] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x - 40, cp.y + 40).addChildTo(this).setInteractive(true);
        this.btn[7] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x - 40, cp.y - 40).addChildTo(this).setInteractive(true);

        for (var i = 0; i < this.btn.length; i++) {
            this.btn[i].isOn = false;
            this.btn[i].on('pointover', function() {
                this.isOn = true;
            });
            this.btn[i].on('pointout', function() {
                this.isOn = false;
            });
        }

        //挿下キー情報
        this.keydata = {
            up: false,
            down: false,
            left: false,
            right: false,
        };
    },

    update: function() {
        this.keydata = {
            up: this.btn[0].isOn || this.btn[1].isOn || this.btn[7].isOn,
            right: this.btn[2].isOn || this.btn[1].isOn || this.btn[3].isOn,
            down: this.btn[4].isOn || this.btn[3].isOn || this.btn[5].isOn,
            left: this.btn[6].isOn || this.btn[5].isOn || this.btn[7].isOn,
        };
    },
});

//バーチャルパッドボタン
phina.define("phina.extension.VirtualPad.Button", {
    superClass: "phina.display.DisplayElement",

    active: true,

    init: function(options) {
        this.superInit();
        options = (options || {}).$safe(this.defaultOptions);
        this.options = options;

        var param = {
            radius: options.radius || 30,
            fill: "rgba(0,0,0,0.3)",
            stroke: "rgba(255, 255, 255, 0.3)",
            backgroundColor: 'transparent',
        };
        this.btn = phina.display.CircleShape(param)
            .addChildTo(this)
            .setInteractive(true);
        this.btn.on('pointover', e => {
            this.isOn = true;
        });
        this.btn.on('pointout', e => {
            this.isOn = false;
        });
    },
});

//バーチャルパッドアナログスティック
phina.define("phina.extension.VirtualPad.AnalogStick", {
    superClass: "phina.display.CircleShape",

    active: true,

    init: function(options) {
        this.superInit({
            radius: 80,
            fill: null,
            stroke: "rgba(255, 255, 255, 0.3)",
            backgroundColor: 'transparent',
        });

        //中心点
        var hw = 0;
        var hh = 0;
        var cp = phina.geom.Vector2(0, 0);

        var param = {
            radius: 20,
            fill: "rgba(0,0,0,0.3)",
            stroke: "rgba(0,0,0,0.3)",
            backgroundColor: 'transparent',
        };
        this.inner = phina.display.CircleShape(param)
            .addChildTo(this)
            .setInteractive(true);
        this.vector = phina.geom.Vector2(0, 0);
        this.pt = null;
    },

    update: function() {
        if (!app.pointer.getPointing()) {
            this.vector.set(0, 0);
        }
        var pointers = app.pointers;
        pointers.forEach(pointer => {
            if (pointer.getPointingStart() && this.hitTest(pointer.x, pointer.y)) {
                this.pt = pointer;
            }
        });
        if (this.pt) {
            if (this.pt.getPointing()) {
                this.vector.set(this.pt.x - this.x, this.pt.y - this.y).normalize();
            } else if (this.pt.getPointingEnd()) {
                this.vector.set(0, 0);
            }
        }
        this.inner.x = this.vector.x * this.radius * 0.6;
        this.inner.y = this.vector.y * this.radius * 0.6;

        //角度
        if (this.vector.x == 0 && this.vector.y == 0) {
            this.angle = null;
        } else {
            this.angle = Math.floor(Math.atan2(this.vector.y, this.vector.x).toDegree());
            if (this.angle < 0) this.angle += 360;
        }
    },
});

/*
 *  SoundSet.js
 *  2014/11/28
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//サウンド管理
phina.define("phina.extension.SoundSet", {

    //サウンドが格納される配列
    elements: null,

    //再生中ＢＧＭ
    bgm: null,
    bgmIsPlay: false,

    //マスターボリューム
    volumeBGM: 0.5,
    volumeSE: 0.5,

    init: function() {
        this.elements = [];
    },

    //登録済みアセット読み込み
    readAsset: function() {
        for (var key in phina.asset.AssetManager.assets.sound) {
            var obj = phina.asset.AssetManager.get("sound", key);
            if (obj instanceof phina.asset.Sound) this.add(key);
        }
    },

    //サウンド追加
    add: function(name, url) {
        if (name === undefined) return null;
        url = url || null;
        if (this.find(name)) return true;

        var e = phina.extension.SoundElement(name);
        if (!e.media) return false;
        this.elements.push(e);
        return true;
    },

    //サウンド検索
    find: function(name) {
        if (!this.elements) return null;
        for (var i = 0; i < this.elements.length; i++) {
            if (this.elements[i].name == name) return this.elements[i];
        }
        return null;
    },

    //サウンドをＢＧＭとして再生
    playBGM: function(name, loop, callback) {
        if (loop === undefined) loop = true;
        if (this.bgm) {
            this.bgm.stop();
            this.bgmIsPlay = false;
        }
        var element = this.find(name);
        if (element) {
            var vol = this.volumeBGM * element._volume;
            element.media.volume = vol;
            element.play(loop, callback);
            this.bgm = element;
            this.bgmIsPlay = true;
        } else {
            if (this.add(name)) this.playBGM(name);
        }
        return this;
    },

    //ＢＧＭ停止
    stopBGM: function() {
        if (this.bgm) {
            if (this.bgmIsPlay) {
                this.bgm.stop();
                this.bgmIsPlay = false;
            }
            this.bgm = null;
        }
        return this;
    },

    //ＢＧＭ一時停止
    pauseBGM: function() {
        if (this.bgm) {
            if (this.bgmIsPlay) {
                this.bgm.pause();
                this.bgmIsPlay = false;
            }
        }
        return this;
    },

    //ＢＧＭ再開
    resumeBGM: function() {
        if (this.bgm) {
            if (!this.bgmIsPlay) {
                this.bgm.volume = this.volumeBGM;
                this.bgm.resume();
                this.bgmIsPlay = true;
            }
        }
        return this;
    },

    //ＢＧＭマスターボリューム設定
    setVolumeBGM: function(vol) {
        this.volumeBGM = vol;
        if (this.bgm) {
            this.bgm.pause();
            this.bgm.setVolume(this.volumeBGM * this.bgm._volume);
            this.bgm.resume();
        }
        return this;
    },

    //アセットを指定してボリュームを設定
    setVolume: function(name, vol) {
        var media = this.find(name);
        if (media) {
            media.setVolume(vol);
        }
        return this;
    },

    //サウンドをサウンドエフェクトとして再生
    playSE: function(name, loop, callback) {
        var element = this.find(name);
        if (element) {
            var vol = this.volumeSE * element._volume;
            element.media.volume = vol;
            element.play(loop, callback);
        } else {
            if (this.add(name)) this.playSE(name);
        }
        return this;
    },

    //ループ再生しているSEを停止
    stopSE: function(name) {
        var media = this.find(name);
        if (media) {
            media.stop();
        }
        return this;
    },

    //ＢＧＭ一時停止
    pauseBGM: function() {
        if (this.bgm) {
            if (this.bgmIsPlay) {
                this.bgm.pause();
                this.bgmIsPlay = false;
            }
        }
        return this;
    },

    //ＳＥマスターボリューム設定
    setVolumeSE: function(vol) {
        this.volumeSE = vol;
        return this;
    },
});

//SoundElement Basic
phina.define("phina.extension.SoundElement", {
    //サウンド名
    name: null,

    //ＵＲＬ
    url: null,

    //サウンド本体
    media: null,

    //ボリューム
    _volume: 1,

    //再生終了時のコールバック関数
    callback: null,

    //再生中フラグ
    playing: false,

    init: function(name) {
        this.name = name;
        this.media = phina.asset.AssetManager.get("sound", name);
        if (this.media) {
            this.media.volume = 1;
            this.media.on('ended', function() {
                if (this.media.loop) this.playing = false;
                if (this.callback) this.callback();
            }.bind(this))
        } else {
            console.warn("asset not found. "+name);
        }
    },

    //サウンドの再生
    play: function(loop, callback) {
        if (loop === undefined) loop = false
        if (!this.media) return this;

        //ループ再生の場合多重再生を禁止
        if (loop && this.playing) return;

        this.media.loop = loop;
        this.media.play();
        this.callback = callback;
        this.playing = true;
        return this;
    },

    //サウンド再生再開
    resume: function() {
        if (!this.media) return this;
        this.media.resume();
        this.playing = true;
        return this;
    },

    //サウンド一時停止
    pause: function () {
        if (!this.media) return this;
        this.media.pause();
        this.playing = false;
    },

    //サウンド停止
    stop: function() {
        if (!this.media) return this;
        this.media.stop();
        this.playing = false;
        return this;
    },

    //ボリューム設定
    setVolume: function(vol) {
        if (!this.media) return this;
        if (vol === undefined) vol = 0.5;
        this._volume = vol;
        return this;
    },

    _accessor: {
        volume: {
            "get": function() { return this._volume; },
            "set": function(vol) { this.setVolume(vol); }
        },
        loop: {
            "get": function() { return this.media.loop; },
            "set": function(f) { this.media.loop = f; }
        },
    }
});

/*
 *  application.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

//namespaace Quest For the Tanelorn
var qft = {};

phina.define("qft.Application", {
    superClass: "phina.display.CanvasApp",

    init: function() {
        this.superInit({
            query: '#world',
            width: SC_W,
            height: SC_H,
            backgroundColor: 'rgba(0, 0, 0, 1)',
        });
        this.fps = FPS;

        //ゲームパッド管理
        this.gamepadManager = phina.input.GamepadManager();
        this.gamepad = this.gamepadManager.get(0);

        //バーチャルパッド
        this.virtualPad = phina.extension.VirtualPad({width: SC_W, height: SC_H}).setPosition(0, 0);

        //パッド情報を更新
        this.on('enterframe', function() {
            this.gamepadManager.update();
            this.virtualPad.updateInfo();
            this.updateController();
        });
        this.controller = {};

        //サウンドセット
        this.soundset = phina.extension.SoundSet();

        //Labelデフォルト設定
        phina.display.Label.defaults.$extend({
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        });
    },

    updateController: function() {
        var before = this.controller;
        before.before = null;

        var gp = this.gamepad;
        var kb = this.keyboard;
        var angle1 = gp.getKeyAngle();
        var angle2 = kb.getKeyAngle();
        this.controller = {
            angle: angle1 !== null? angle1: angle2,

            up: gp.getKey("up") || kb.getKey("up"),
            down: gp.getKey("down") || kb.getKey("down"),
            left: gp.getKey("left") || kb.getKey("left"),
            right: gp.getKey("right") || kb.getKey("right"),

            attack: gp.getKey("X") || kb.getKey("Z"),
            jump:   gp.getKey("up") || gp.getKey("A") || kb.getKey("up") || kb.getKey("X"),
            change: gp.getKey("B") || kb.getKey("C"),
            menu:   gp.getKey("start") || kb.getKey("escape"),

            a: gp.getKey("A") || kb.getKey("Z"),
            b: gp.getKey("B") || kb.getKey("X"),
            x: gp.getKey("X") || kb.getKey("C"),
            y: gp.getKey("Y") || kb.getKey("V"),

            ok: gp.getKey("A") || kb.getKey("Z") || kb.getKey("space") || kb.getKey("return"),
            cancel: gp.getKey("B") || kb.getKey("X") || kb.getKey("escape"),

            start: gp.getKey("start") || kb.getKey("return"),
            select: gp.getKey("select"),

            pause: gp.getKey("start") || kb.getKey("escape"),

            analog1: gp.getStickDirection(0),
            analog2: gp.getStickDirection(1),

            //前フレーム情報
            before: before,
        };
    },

    _onLoadAssets: function() {
        this.soundset.readAsset();

        //特殊効果用ビットマップ作成
        [
            "player1",
            "player2",
        ].forEach(function(name) {
            if (!phina.asset.AssetManager.get("image", name)) return;

            //ダメージ用
            if (!phina.asset.AssetManager.get("image", name+"White")) {
                var tex = phina.asset.AssetManager.get("image", name).clone();
                tex.filter( function(pixel, index, x, y, bitmap) {
                    var data = bitmap.data;
                    data[index+0] = (pixel[0] == 0? 0: 128); //r
                    data[index+1] = (pixel[1] == 0? 0: 128); //g
                    data[index+2] = (pixel[2] == 0? 0: 128); //b
                });
                phina.asset.AssetManager.set("image", name+"White", tex);
            }
            //瀕死用
            if (!phina.asset.AssetManager.get("image", name+"Red")) {
                var tex = phina.asset.AssetManager.get("image", name).clone();
                tex.filter( function(pixel, index, x, y, bitmap) {
                    var data = bitmap.data;
                    data[index+0] = pixel[0];
                    data[index+1] = 0;
                    data[index+2] = 0;
                });
                phina.asset.AssetManager.set("image", name+"Red", tex);
            }
            //影用
            if (!phina.asset.AssetManager.get("image", name+"Black")) {
                var tex = phina.asset.AssetManager.get("image", name).clone();
                tex.filter( function(pixel, index, x, y, bitmap) {
                    var data = bitmap.data;
                    data[index+0] = 0;
                    data[index+1] = 0;
                    data[index+2] = 0;
                });
                phina.asset.AssetManager.set("image", name+"Black", tex);
            }
        });
    },

    playBGM: function(asset, loop, callback) {
        if (loop === undefined) loop = true;
        this.soundset.playBGM(asset, loop, callback);
    },

    stopBGM: function(asset) {
        this.soundset.stopBGM();
    },

    setVolumeBGM: function(vol) {
        if (vol > 1) vol = 1;
        if (vol < 0) vol = 0;
        this.soundset.setVolumeBGM(vol);
    },

    playSE: function(asset, loop) {
        if (loop === undefined) loop = false;
        this.soundset.playSE(asset, loop);
    },

    setVolumeSE: function(vol) {
        if (vol > 1) vol = 1;
        if (vol < 0) vol = 0;
        this.soundset.setVolumeSE(vol);
    },

    setVolume: function(asset, vol) {
        this.soundset.setVolume(asset, vol);
    },

    _accessor: {
        volumeBGM: {
            "get": function() { return this.sounds.volumeBGM; },
            "set": function(vol) { this.setVolumeBGM(vol); }
        },
        volumeSE: {
            "get": function() { return this.sounds.volumeSE; },
            "set": function(vol) { this.setVolumeSE(vol); }
        }
    }
});

/*
 *  asset.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Assets", {
    _static: {
        loaded: [],
        isLoaded: function(assetType) {
            return qft.Assets.loaded[assetType]? true: false;
        },
        get: function(options) {
            qft.Assets.loaded[options.assetType] = true;
            switch (options.assetType) {
                case "splash":
                    return {
                        image: {
                            "openingmap":   "assets/image/opening_map.jpg",
                            "openingtower": "assets/image/opening_tower.png",
                            "openingground":"assets/image/opening_ground.png",
                            "openingback":  "assets/image/opening_back.png",
                            "openingback2": "assets/image/opening_bg_jan.jpg",
                            "openinglight": "assets/image/opening_tree_light_yellow.png",
                            "player1":      "assets/image/actor4.png",
                            "background":   "assets/image/back-s03b.png",
                        },
                    };
                case "splash2":
                    return {
                        sound: {
                            "openingbgm":   "assets/sound/DS-070m.mp3",
                        },
                    };
                case "common":
                    return {
                        image: {
                            "actor4":    "assets/image/actor4.png",
                            "actor19":    "assets/image/actor19.png",
                            "actor40":    "assets/image/actor40.png",
                            "actor55":    "assets/image/actor55.png",
                            "actor64":    "assets/image/actor64_a.png",
                            "actor642":    "assets/image/actor64_b.png",
                            "actor108":    "assets/image/actor108.png",
                            "actor111":    "assets/image/actor111.png",
                            "actor112":    "assets/image/actor112.png",
                            "weapons":    "assets/image/weapons.png",
                            "item":       "assets/image/item.png",
                            "itembox":    "assets/image/takarabako.png",
                            "particle":   "assets/image/particle.png",
                            "door":       "assets/image/door.png",
                            "checkicon":  "assets/image/check icon_00.png",
                            "titleback":  "assets/image/titleback.png", 
                            "menuframe":  "assets/image/nc92367.png",

                            "monster01":  "assets/image/monster01.png",
                            "monster02":  "assets/image/char_m_devil01.png",
                            "monster03":  "assets/image/char_m_magi01.png",
                            "monster01x2":  "assets/image/monster01x2.png",
                            "monster02x2":  "assets/image/char_m_devil01x2.png",
                            "bullet":     "assets/image/effect_bullet01.png",
                            "effect":     "assets/image/effect.png",
                            "effect2":    "assets/image/effect01a.png",
                            "gate":       "assets/image/gate.png",
                            "flame02":    "assets/image/object_fire02a.png",
                            "flame03":    "assets/image/object_fire03a.png",
                            "flame05":    "assets/image/object_fire05a.png",
                            "accessory1": "assets/image/map_effect2.png",
                            "block":      "assets/image/block.png",
                            "floor":      "assets/map/TileA4.png",
                            "balloon":    "assets/image/chara09_c1.png",
                            "shadow":     "assets/image/shadow.png",
                        },
                        sound: {
                            "click":      "assets/sound/se_maoudamashii_system44.mp3",
                            "ok":         "assets/sound/se_maoudamashii_system36.mp3",
                            "cancel":     "assets/sound/se_maoudamashii_system43.mp3",
                            "attack":     "assets/sound/sen_ka_katana_sasinuku01.mp3",
                            "hit":        "assets/sound/sen_ka_katana_sasu01.mp3",
                            "hit_blunt":  "assets/sound/sen_blunt.mp3",
                            "damage":     "assets/sound/se_maoudamashii_battle12.mp3",
                            "arrowstick": "assets/sound/sen_ka_ya03.mp3",
                            "stageclear": "assets/sound/DS-030m.mp3",
                            "gameover":   "assets/sound/gameover3.mp3",
                            "getkeyitem": "assets/sound/se_maoudamashii_onepoint23.mp3",
                            "bomb":       "assets/sound/sen_ge_taihou03.mp3",
                            "select":     "assets/sound/se_maoudamashii_system45.mp3",
                            "getitem":    "assets/sound/ata_a49.mp3",
                            "recovery":   "assets/sound/se_maoudamashii_magical01.mp3",
                            "tinkling":   "assets/sound/tinkling.mp3",
                            "holy1":      "assets/sound/holy1.mp3",
                            "bgm1":       "assets/sound/DS-ba01m.mp3",
                        },
                        font: {
                            "UbuntuMono": "assets/font/UbuntuMono-Bold.ttf",
                            "titlefont1": "assets/font/teutonic4.ttf",
                            "titlefont2": "assets/font/GothStencil_Premium.ttf",
                        },
                        tmx: {
                            "stage1": "assets/map/stage1.tmx",
                            "stage999": "assets/map/stage999.tmx",
                        },
                    };
                case "stage2":
                    return {
                        sound: {
                            "bgm2": "assets/sound/DS-035m.mp3",
                        },
                        tmx: {
                            "stage2_1": "assets/map/stage2_1.tmx",
                        },
                    };
                case "stage3":
                    return {
                        sound: {
                            "bgm3": "assets/sound/DS-041m.mp3",
                        },
                        tmx: {
                            "stage3_1": "assets/map/stage3_1.tmx",
                            "stage3_2": "assets/map/stage3_2.tmx",
                            "stage3_3": "assets/map/stage3_3.tmx",
                        },
                    };
                case "stage4":
                    return {
                        sound: {
                            "bgm4": "assets/sound/DS-076m.mp3",
                        },
                        tmx: {
                            "stage4_1": "assets/map/stage4_1.tmx",
                            "stage4_2": "assets/map/stage4_2.tmx",
                        },
                    };
                case "stage5":
                    return {
                        sound: {
                            "bgm5": "assets/sound/DS-089m.mp3",
                        },
                        tmx: {
                            "stage5_1": "assets/map/stage5_1.tmx",
                            "stage5_2": "assets/map/stage5_2.tmx",
                        },
                    };
                case "stage6":
                    return {
                        sound: {
                            "bgm6": "assets/sound/DS-060m.mp3",
                        },
                        tmx: {
                            "stage6_1": "assets/map/stage6_1.tmx",
                            "stage6_2": "assets/map/stage6_2.tmx",
                        },
                    };
                case "stage7":
                    return {
                        sound: {
                            "bgm7": "assets/sound/DS-105m.mp3",
                        },
                        tmx: {
                            "stage7_1": "assets/map/stage7_1.tmx",
                            "stage7_2": "assets/map/stage7_2.tmx",
                            "stage7_3": "assets/map/stage7_3.tmx",
                        },
                    };
                case "stage8":
                    return {
                        sound: {
                            "bgm8": "assets/sound/DS-064m.mp3",
                        },
                        tmx: {
                            "stage8_1": "assets/map/stage8_1.tmx",
                            "stage8_2": "assets/map/stage8_2.tmx",
                        },
                    };
                case "stage9":
                    return {
                        sound: {
                            "bgm9": "assets/sound/DS-064m.mp3",
                        },
                        tmx: {
                            "stage9_1": "assets/map/stage9_1.tmx",
                        },
                    };
                case "stage10":
                    return {
                        sound: {
                            "ending": "assets/sound/DS-071m.mp3",
                        },
                        tmx: {
                            "stage10": "assets/map/stage10.tmx",
                        },
                    };
                default:
                    throw "invalid assetType: " + options.assetType;
            }
        },
    },
});


/*
 *  Benri.js
 *  2014/12/18
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
var toRad = 3.14159/180;    //弧度法toラジアン変換
var toDeg = 180/3.14159;    //ラジアンto弧度法変換

//距離計算
var distance = function(from, to) {
    var x = from.x-to.x;
    var y = from.y-to.y;
    return Math.sqrt(x*x+y*y);
}

//距離計算（ルート無し版）
var distanceSq = function(from, to) {
    var x = from.x - to.x;
    var y = from.y - to.y;
    return x*x+y*y;
}

//数値の制限
var clamp = function(x, min, max) {
    return (x<min)?min:((x>max)?max:x);
};

//乱数生成
var prand = phina.util.Random();
var rand = function(min, max) {
    return prand.randint(min, max);
}

//タイトル無しダイアログ
var AdvanceAlert = function(str) {
    var tmpFrame = document.createElement('iframe');
    tmpFrame.setAttribute('src', 'data:text/plain,');
    document.documentElement.appendChild(tmpFrame);

    window.frames[0].window.alert(str);
    tmpFrame.parentNode.removeChild(tmpFrame);
};
var AdvanceConfirm = function(str) {
    var tmpFrame = document.createElement('iframe');
    tmpFrame.setAttribute('src', 'data:text/plain,');
    document.documentElement.appendChild(tmpFrame);

    var result = window.frames[0].window.confirm(str);
    tmpFrame.parentNode.removeChild(tmpFrame);

    return result;
};

//数値をカンマ編集して文字列として出力
Number.prototype.$method("comma",  function() {
    var str = this+'';
    var len = str.length;
    var out = '';
    for (var i = len-1; i > -1; i--) {
        out = str[i]+out;
        if (i != 0 && (len-i)%3 == 0) out = ','+out;
    }
    return out;
});

/*
 *  main.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

//phina.globalize();

//デバッグフラグ
const DEBUG = false;
const DEBUG_COLLISION = false;
const DEBUG_EYESIGHT = false;
const DEBUG_MOBILE = false;

//定数
const SC_W = 576;
const SC_H = 324;
// SC_W = 480;
// SC_H = 320;

const FPS = 30;

//アイテムＩＤ
const ITEM_SHORTSWORD = 0;
const ITEM_LONGSWORD = 1;
const ITEM_AX = 2;
const ITEM_SPEAR = 3;
const ITEM_BOW = 4;
const ITEM_ROD = 5;
const ITEM_BOOK = 6;
const ITEM_SHIELD = 7;
const ITEM_ARMOR = 8;
const ITEM_HAT = 9;
const ITEM_BOOTS = 10;
const ITEM_GROVE = 11;
const ITEM_RING = 12;
const ITEM_SCROLL = 13;
const ITEM_LETTER = 14;
const ITEM_CARD = 15;
const ITEM_KEY = 16;
const ITEM_COIN = 17;
const ITEM_BAG = 18;
const ITEM_ORB = 19;
const ITEM_STONE = 20;
const ITEM_JEWEL = 21;
const ITEM_JEWELBOX = 22;
const ITEM_APPLE = 24;
const ITEM_HARB = 25;
const ITEM_MEAT = 26;
const ITEM_POTION = 27;

//インスタンス
let app;

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(() => {
          console.log('Service worker registered!');
      })
      .reject(() => {
        console.log('Service worker rejected!');
    });
}

window.onload = function() {
    app = qft.Application();
    app.replaceScene(qft.SceneFlow());

    //モバイル対応
    if (phina.isMobile()) {
        app.domElement.addEventListener('touchend', function dummy() {
            var s = phina.asset.Sound();
            s.loadFromBuffer();
            s.play().stop();
            app.domElement.removeEventListener('touchend', dummy);
        });
    }
    app.domElement.addEventListener('click', function dummy() {
        var context = phina.asset.Sound.getAudioContext();
        context.resume();
    });

    app.run();
//    app.enableStats();
};

/*
 *  configscene.js
 *  2017/03/02
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.ConfigScene", {
    superClass: "phina.display.DisplayScene",

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,0.5)",
            stroke: "rgba(0,0,0,0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.alpha = 0;
        this.bg.tweener.clear().fadeIn(500);

        this.scroll = phina.display.Sprite("menuframe")
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)
            .setScale(0.85, 1.1);
        this.scroll.alpha = 0;
        this.scroll.tweener.clear().fadeIn(500);

        this.menuBase = phina.display.DisplayElement().addChildTo(this.scroll);

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont1",
            align: "center",
            baseline: "middle",
            fontSize: 70,
        };
        this.textLabel = phina.display.Label({text: "Menu", fontSize: 20}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(0, -SC_H*0.3);

        //メニューテキスト表示
        var that = this;
        this.menu = ["System", "Practice", "Exit"];
        this.menuText = [];
        for (var i = 0; i < this.menu.length; i++) {
            this.menuText[i] = phina.display.Label({text: this.menu[i], fontSize: 40}.$safe(labelParam))
                .addChildTo(this.menuBase)
                .setPosition(0, -SC_H*0.15+SC_H*0.15*i)
                .setScale(0.7);

            //タッチ判定用
            var param2 = {
                width: SC_W*0.3,
                height: SC_H*0.10,
                fill: "rgba(0,100,200,0.5)",
                stroke: "rgba(0,100,200,0.5)",
                backgroundColor: 'transparent',
            };
            var c = phina.display.RectangleShape(param2)
                .addChildTo(this.menuBase)
                .setPosition(0, -SC_H*0.15+SC_H*0.15*i)
                .setInteractive(true);
            c.alpha = 0;
            c.select = i;
            c.onpointstart = function() {
                if (that.isSelected || that.time < 10) return;
                if (this.select == that.select) {
                    that.ok = true;
                } else {
                    that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    that.select = this.select;
                    that.menuText[that.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                    app.playSE("select");
                }
            }
        }
        this.isSelected = false;
        this.select = 0;
        this.selectMax = 3;
        this.menuText[0].setScale(1);
        this.ok = false;
        this.cansel = false;

        this.time = 0;

        this.on('resume', function() {
            this.menuBase.tweener.clear().fadeIn(500);
            this.time = 0;
            this.isSelected = false;
            this.ok = false;
            this.cansel = false;
        });
    },

    update: function() {
        var ct = app.controller;
        if (ct.down && !ct.before.down && this.select < this.selectMax-1) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select++;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }
        if (ct.up && !ct.before.up && this.select > 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }

        if (this.time > 15) {
            //決定
            if (ct.ok || this.ok) {
                if (this.select == 0) {
                }
                if (this.select == 1) {
                    app.playSE("ok");
                    this.menuBase.tweener.clear()
                        .fadeOut(500)
                        .call(function() {
                            app.pushScene(qft.ConfigScene_Practice());
                        });
                }
                if (this.select == 2) {
                    app.playSE("cancel");
                    this.exitMenu();
                }
                this.time = 0;
            }

            //キャンセル        
            if (ct.cancel) {
                app.playSE("cancel");
                this.exitMenu();
                this.time = 0;
            }
        }
        this.time++;
    },

    exitMenu: function() {
        this.bg.tweener.clear().fadeOut(500);
        this.scroll.tweener.clear()
            .fadeOut(500)
            .call(function() {
                this.exit();
            }.bind(this));
    }
});

/*
 *  conversationscene.js
 *  2017/08/17
 *  @auther minimo  
 *  This Program is MIT license.
 */

//会話表示シーン 
phina.define("qft.ConversationScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene, text) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //プレイヤーの画面上位置によりフレームの縦位置を変更
        var frameY = SC_H * 0.25;
        var pl = this.currentScene.player;

        //会話表示フレーム
        var param = {
            width:SC_W * 0.95,
            height:SC_H * 0.4,
            fill: "rgba(0, 0, 0, 0.5)",
            stroke: "rgba(1, 1, 1, 0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W * 0.5, frameY)

        //テキスト処理
        if (text === undefined) text = "TEST MESSAGE";
        if (text instanceof Array) {
            this.text = "";
            text.forEach((t) => {
                this.text += (t + "\n");
            });
        } else {
            this.text = text;
        }

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "Orbitron",
            fontSize: 70,

            verticalAlign: 'top',
            align:'start',
            baseline:'top',
            width: SC_W * 0.9,
            height: SC_H * 0.3,
            scrollX: 0,
            scrollY: 0,
        };
        this.textLabel = phina.ui.LabelArea({text: "", fontSize: 20}.$safe(labelParam)).addChildTo(this.bg);

        this.isExit = false;
        this.isFinish = false;
        this.waitTime = 0;
        this.col = 0;
        this.time = 0;
    },

    update: function() {
        if (this.waitTime == 0) {
            this.textLabel.text = this.text.substring(0, this.col);
            if (this.text.substring(this.col, this.col+1) == "\n") this.waitTime = 10;
            this.col++;
            if (this.col > this.text.length) this.isFinish = true;
        }
        if (this.waitTime > 0) this.waitTime--;

        var ct = app.controller;
        if (this.isFinish) {
            if (!this.isExit && this.time > 10 && ct.before.attack && !ct.attack) {
                this.isExit = true;
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
        } else {
            if (ct.attack) {
                this.col = this.text.length;
                this.isFinish = true;
                this.time = 0;
            }
        }
        this.time++;
    },
});


/*
 *  creditscene.js
 *  2017/12/24
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.CreditScene", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.clear()
            .set({alpha: 0})
            .to({alpha: 0.5}, 1000);

        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 26,
            fontWeight: ''
        };
        phina.display.Label({text: "Congraturations!!"}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.2);

        phina.display.Label({text: "Thank you for playing."}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.4);

        phina.display.Label({text: "This game is a test version."}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);

        phina.display.Label({text: "Push button to title.", fontSize: 20}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.8);

        app.playBGM("gameover", false);

        this.time = 0;
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time > 120) {
            if (ct.ok || ct.cancel) {
                app.playBGM("openingbgm");
                this.parentScene.flare('exitgame');
                this.exit();
            }
        }
        this.time++;
    },
});

/*
 *  endingcene.js
 *  2017/02/07
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.EndingScene", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.clear()
            .set({alpha: 0})
            .to({alpha: 0.5}, 1000);

        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 26,
            fontWeight: ''
        };
        phina.display.Label({text: "Thank you for playing."}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.4);

        phina.display.Label({text: "This game is over"}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);

        phina.display.Label({text: "Push button to title.", fontSize: 20}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.8);

        app.playBGM("gameover", false);

        this.time = 0;
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time > 120) {
            if (ct.ok || ct.cancel) {
                app.playBGM("openingbgm");
                this.parentScene.flare('exitgame');
                this.exit();
            }
        }
        this.time++;
    },
});

/*
 *  endingcene.trueending.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

//トゥルーエンディング
phina.define("qft.EndingScene.TrueEnding", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        this.text = [
            "数多の苦難を乗り越え",
            "あなたは遂に楽園「永遠の都」への入り口へと到達した",
            "扉の向こうには階段があり",
            "その階段は遥か天上へと続いている",
            "階段を昇りますか？",
        ];

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.clear()
            .set({alpha: 0})
            .to({alpha: 0.5}, 1000);

        //イメージ表示用レイヤ
        this.imageLayer = phina.display.DisplayElement().addChildTo(this);

        //上下黒帯
        param.height = SC_H * 0.15;
        this.bar1 = phina.display.RectangleShape(param).addChildTo(this).setOrigin(0, 1).setPosition(0, -1);
        this.bar2 = phina.display.RectangleShape(param).addChildTo(this).setOrigin(0, 0).setPosition(0, SC_H + 1);
        this.bar1.tweener.clear().setUpdateType('fps').moveBy(0, SC_H * 0.15, 30, "easeOutSine");
        this.bar2.tweener.clear().setUpdateType('fps').moveBy(0, -SC_H * 0.15, 30, "easeOutSine");

        this.time = 0;

        this.one('enterframe', () => {
            //ＢＧＭ再生
            app.playBGM("endingbgm");
        });
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time > 120) {
            if (ct.ok || ct.cancel) {
                app.playBGM("openingbgm");
                this.parentScene.flare('exitgame');
                this.exit();
            }
        }
        this.time++;
    },
});

/*
 *  GameOverScene.js
 *  2014/06/04
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.GameOverScene", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        //バックグラウンド
        var param = {
            width: SC_W,
            height: SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.5)
        this.bg.alpha = 0;

        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        };
        var x = SC_W * 0.5-32*4;
        var n = 0;
        ["G", "A", "M", "E", "O", "V", "E", "R"].forEach(function(e) {
            var lb = phina.display.Label({text: e}.$safe(labelParam))
                .setPosition(x, SC_H*0.5+32)
                .setScale(0, 1)
                .addChildTo(this);
            lb.tweener.clear()
                .set({alpha: 0})
                .wait(n*50)
                .to({scaleX: 1.0, alpha: 1, y: SC_H*0.5}, 1000, "easeOutSine")
                .wait(1000-n*50)
                .set({alpha: 0})
                .to({scaleX: 0.0, alpha: 0, y: SC_H*0.5-32}, 1000, "easeOutSine")
            var pt = phina.display.Sprite("particle", 16, 16)
                .setFrameIndex(48)
                .setPosition(x, SC_H*0.5)
                .setScale(3, 3)
                .addChildTo(this);
            pt.alpha = 0;
            pt.tweener.clear()
                .wait(n*50+1000)
                .to({alpha: 1}, 1000-n*50, "easeOutSine")
                .to({scaleX: 0.0, alpha: 0, y: SC_H*0.5-32}, 1000, "easeOutSine")
            x += 32;
            n++;
        }.bind(this));

        app.playBGM("gameover", false);

        this.select = 0; //0:YES 1:NO
        this.pushyes = false;
        this.pushno = false;
        this.ok = false;

        this.time = 0;
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time == 90) {
            this.dispContinue();
        }
        if (this.time > 105) {
            if ((ct.left || this.pushyes) && this.select == 1) {
                this.select = 0;
                this.pushyes = false;
                this.yes.tweener.clear().to({scaleX: 1, scaleY: 1}, 500, "easeOutBounce");
                this.no.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                app.playSE("select");
                this.text3.text = "ゲームオーバー地点からコンティニューします（スコアはリセットされます）";
            } else if ((ct.right || this.pushno) && this.select == 0) {
                this.select = 1;
                this.pushno = false;
                this.yes.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                this.no.tweener.clear().to({scaleX: 1, scaleY: 1}, 500, "easeOutBounce");
                app.playSE("select");
                this.text3.text = "タイトルに戻ります";
            }
            if (ct.ok || ct.cancel || this.ok) {
                if (this.select == 0) {
                    this.parentScene.flare('continue');
                    this.exit();
                } else {
                    this.parentScene.flare('exitgame');
                    this.exit();
                }
            }
        }
        this.time++;
    },

    dispContinue: function() {
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 36,
            fontWeight: ''
        };
        this.text1 = phina.display.Label({text: "CONTINUE?"}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.4+10)
            .addChildTo(this);
        this.text1.alpha = 0;
        this.text1.tweener.clear().to({y: SC_H*0.4, alpha: 1}, 500, "easeInSine");

        this.yes = phina.display.Label({text: "YES", fontSize: 30}.$safe(labelParam))
            .setScale(1)
            .setPosition(SC_W*0.4, SC_H*0.6+10)
            .addChildTo(this);
        this.yes.alpha = 0;
        this.yes.tweener.clear().to({y: SC_H*0.6, alpha: 1}, 500, "easeInSine");

        this.no = phina.display.Label({text: "NO", fontSize: 30}.$safe(labelParam))
            .setScale(0.7)
            .setPosition(SC_W*0.6, SC_H*0.6+10)
            .addChildTo(this);
        this.no.alpha = 0;
        this.no.tweener.clear().to({y: SC_H*0.6, alpha: 1}, 500, "easeInSine");

        //タッチ判定用
        var that = this;
        var param2 = {
            width: 80,
            height: SC_H*0.08,
            fill: "rgba(0,100,200,0.5)",
            stroke: "rgba(0,100,200,0.5)",
            backgroundColor: 'transparent',
        };
        var yes = phina.display.RectangleShape(param2)
            .addChildTo(this)
            .setPosition(SC_W*0.4, SC_H*0.6)
            .setInteractive(true);
        yes.alpha = 0;
        yes.onpointstart = function() {
            if (that.select == 0) {
                that.ok = true;
            } else {
                that.pushyes = true;
            }
        }
        var no = phina.display.RectangleShape(param2)
            .addChildTo(this)
            .setPosition(SC_W*0.6, SC_H*0.6)
            .setInteractive(true);
        no.alpha = 0;
        no.onpointstart = function() {
            if (that.select == 1) {
                that.ok = true;
            } else {
                that.pushno = true;
            }
        }

        this.text3 = phina.display.Label({text: "ゲームオーバー地点からコンティニューします（スコアはリセットされます）", fontSize: 10}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.75+10)
            .addChildTo(this);
        this.text3.alpha = 0;
        this.text3.tweener.clear().to({y: SC_H*0.75, alpha: 1}, 500, "easeInSine");

        this.bg.tweener.clear().to({alpha:0.3}, 500, "easeInSine");
    },
});

/*
 *  LoadingScene.js
 *  2015/09/08
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アセットロード用シーン
phina.define("qft.LoadingScene", {
    superClass: "phina.display.DisplayScene",

    init: function(options) {
        options = (options || {}).$safe({
            assets: null,
            width: SC_W,
            height: SC_H,
            lie: false,
            exitType: "auto",
        });
        this.superInit(options);

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)
        this.bg.tweener.setUpdateType('fps');

        //ロードする物が無い場合スキップ
        this.forceExit = false;
        var assets = options.assets;
        if (!assets.$has("sound") &&
            !assets.$has("image") &&
            !assets.$has("font") &&
            !assets.$has("spritesheet") &&
            !assets.$has("script") &&
            !assets.$has("tmx")) {

            this.forceExit = true;
            return;
        }

        var labelParam = {
            text: "Loading",
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 30
        };
        phina.display.Label(labelParam)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);

        this.fromJSON({
            children: {
                gauge: {
                    className: 'phina.ui.Gauge',
                    arguments: {
                        value: 0,
                        width: this.width*0.5,
                        height: 5,
                        color: 'black',
                        stroke: false,
                        gaugeColor: 'blue',
                        padding: 0,
                    },
                    x: this.gridX.center(),
                    y: SC_H*0.5+20,
                    originY: 0,
                }
            }
        });
        this.gauge.update = function(e) {
            this.gaugeColor = 'hsla({0}, 100%, 50%, 0.8)'.format(e.ticker.frame*3);
        }

        var loader = phina.asset.AssetLoader();
        if (options.lie) {
            this.gauge.animationTime = 10*1000;
            this.gauge.value = 90;
            loader.onload = function() {
                this.gauge.animationTime = 1*1000;
                this.gauge.value = 100;
            }.bind(this);
        } else {
            loader.onprogress = function(e) {
                this.gauge.value = e.progress*100;
            }.bind(this);
        }
        this.gauge.onfull = function() {
            if (options.exitType === 'auto') {
                if (this.app._onLoadAssets) this.app._onLoadAssets();
                this.exit();
            }
        }.bind(this);

        loader.load(options.assets);
    },
    update: function() {
        if (this.forceExit) this.exit();
    },    
});

/*
 *  MainScene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.MainScene", {
    superClass: "phina.display.DisplayScene",

    //現在ステージ番号
    stageNumber: 1,

    //最大ステージ番号
    stageNumberMax: 8,

    //残り時間（フレーム単位）
    timeLimit: 120,

    //メッセージスタック
    messageStack: [],

    //ステージクリアフラグ
    isStageClear: false,

    //エンディング進行中フラグ
    isEnding: false,

    //真エンディングフラグ
    isTrueEnding: true,

    //スコア
    totalScore: 0,

    //敵討伐数
    totalKill: 0,

    //コンティニュー回数
    continueCount: 0,

    //ステージクリア時情報
    clearResult: [],

    //スクリーンのマップ外への移動制限フラグ
    limitWidth: false,
    limitHeight: true,

    //スクリーン中心座標
    screenCenterPosition: null,

    //プレイヤースクリーン中央固定フラグ
    centerPlayer: true,

    //シーン内全オブジェクト強制停止
    pauseScene: false,

    init: function(options) {
        this.superInit({width: SC_W, height: SC_H});
        options = (options || {}).$safe({
            startStage: 1,
            isPractice: false,
            isContinue: false,
        })
        this.stageNumber = options.startStage || 1;
        this.isPractice = options.isPractice;
        this.isContinue = options.isContinue;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.setUpdateType('fps');

        //背景
        this.backgroundImage = phina.display.Sprite("background")
            .addChildTo(this).setPosition(0, SC_H*0.5)
            .setOrigin(0, 0.5)
            .setScale(1.0, 1.1);

        //管理用基準レイヤ
        this.baseLayer = phina.display.DisplayElement().addChildTo(this);

        //プレイヤーキャラクタ
        this.player = qft.Player(this);

        //スクリーン初期化
        this.setupScreen();

        //スクリーン中心座標管理用
        var that = this;
        this.camera = phina.app.Object2D().addChildTo(this);
        this.camera.parentScene = this;
        this.camera.tweener.setUpdateType('fps');
        this.camera.moveFrom = phina.geom.Vector2(0, 0);
        this.camera.moveTo = phina.geom.Vector2(0, 0);
        this.camera.moveRatio = 0;
        this.camera.moveLerp = false;
        this.camera.moveToPlayer = false;
        this.camera.update = function() {
            if (that.centerPlayer) {
                this.x = that.player.x;
                this.y = that.player.y;
            } else {
                if (this.moveLerp) {
                    if (this.moveToPlayer) {
                        this.moveTo.x = that.player.x;
                        this.moveTo.y = that.player.y;
                    }
                    var p = phina.geom.Vector2.lerp(this.moveFrom, this.moveTo, this.moveRatio);
                    this.setPosition(p.x, p.y);
                }
            }
        };

        //ステージクリア時情報
        this.clearResult = [];
        this.totalScore = 0;
        this.totalKill = 0;

        //コンティニュー時状態ロード
        if (this.isContinue) this.loadGame();

        //ステージ開始位置
        this.mapstart = phina.geom.Vector2(0, 0);

        //ステージ情報初期化
        this.setupStage();

        this.fgWhite = phina.display.RectangleShape(param.$extend({fill: 'white'}))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fgWhite.alpha = 0;
        this.fgWhite.tweener.setUpdateType('fps').clear();

        this.fg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fg.tweener.setUpdateType('fps').clear().fadeOut(30);

        //バーチャルパッドの可視化
        if (phina.isMobile() || DEBUG_MOBILE) {
            app.virtualPad.addChildTo(this).setPosition(0, 0);
        }

        app.volumeBGM = 0.5;
        app.volumeSE = 0.2;

        //メニューを開く
        this.on('openmenu', function(e) {
            app.pushScene(qft.MenuScene(this));
        });

        //キー取得
        this.on('getkey', function(e) {
            var x = this.mapLayer.x + this.player.x;
            var y = this.mapLayer.y + this.player.y;
            var key = phina.display.DisplayElement()
                .setPosition(x, y)
                .addChildTo(this.baseLayer);
            key.tweener.clear().moveTo(15+(this.player.keys.length-1)*24, 36, 500);
            var sp = phina.display.Sprite("item", 24, 24)
                .setFrameIndex(ITEM_KEY)
                .addChildTo(key);
        });

        //ステージクリア
        this.on('stageclear', this.stageClear);

        //次ステージへ移行
        this.on('nextstage', function(e) {
            if (!this.allClear) {
                this.stageNumber++;
                this.setupStage();
                this.player.saveStatus();
            } else {
                //エンディング分岐
                if (this.isTrueEnding) {
                    this.stageNumber = 10;
                    this.setupStage();
                } else {
                    //仮エンディング
                    app.pushScene(qft.EndingScene(this));
                }
            }
        });

        //エンディングへ移行
        this.on('ending', function(e) {
            app.pushScene(qft.EndingScene(this));
        });

        //ゲームオーバー
        this.on('gameover', function(e) {
            app.pushScene(qft.GameOverScene(this));
        });

        //コンティニュー
        this.on('continue', function(e) {
            this.restart();
        });

        //ゲーム終了
        this._exitGame = false;
        this.on('exitgame', function(e) {
            this._exitGame = true;
            if (!this.isPractice) this.saveGame();
        });
        this.on('exitgame_nosave', function(e) {
            this._exitGame = true;
        });

        //メッセージ表示
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };
        var that = this;
        this.messageStack = [];
        this.eventMessage = phina.display.Label({text: ""}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.2)
            .addChildTo(this);
        this.eventMessage.alpha = 0;
        this.eventMessage.tweener.clear().setUpdateType('fps');
        this.eventMessage.nextOk = true;
        this.eventMessage.update = function() {
            if (this.nextOk && that.messageStack.length > 0) {
                this.nextOk = false;
                var msg = that.messageStack[0];
                this.tweener.clear()
                    .call(function(){
                        this.text = msg.text;
                    }.bind(this))
                    .fadeIn(15).wait(90).fadeOut(15)
                    .call(function(){
                        this.nextOk = true;
                        that.messageStack.splice(0, 1);
                    }.bind(this))
            }
        }

        this.time = 0;
    },

    update: function(app) {
        if (this.time == 15) this.player.isControl = true;

        //ゲーム終了
        if (this._exitGame) {
            this.exitGame();
        }

        var ct = app.controller;
        if (!this.isStageClear) {
            //通常時処理
            //メニューシーンへ移行
            if (this.time > 15) {
                if (ct.pause || ct.menu) {
                    this.flare('openmenu');
                }
            }

            //ステージ進行
            var event = this.stageController.get(this.time);
            if (event) {
                if (typeof(event.value) === 'function') {
                    event.value.call(this, event.option);
                } else {
                    this.enterEnemyUnit(event.value);
                }
            }
            //ステージクリア条件チェック
            if (this.mapLayer.clearGate) {
                if (this.stageController.checkStageClearCondition()) {
                    this.mapLayer.clearGate.isLock = false;
                }
            }

            if (!this.pauseScene) this.timeLimit--;
            if (this.timeLimit < 0) {
                this.timeLimit = 0;
            }
            if (this.timeLimit == 0 && !this.player.isDead) {
//                this.player.dead();
            }
        } else {
            //ステージクリア時処理
            //残りタイムをスコア加算
            if (this.timeLimit >= 60) {
                this.timeLimit -= 60;
                this.totalScore += 20;
                if (this.timeLimit < 60) this.timeLimit = 0;
            }

            //ショートカット
            var ct = app.controller;
            if (ct.ok) {
                if (this.timeLimit >= 60) {
                    this.totalScore += Math.floor(this.timeLimit / 60) * 20;
                }
            }
        }

        //スクリーン表示位置
        var map = this.mapLayer.map;
        this.mapLayer.x = SC_W * 0.5 - this.camera.x;
        this.mapLayer.y = SC_H * 0.5 - this.camera.y;
        if (this.limitHeight) {
            if (this.mapLayer.y > 0) this.mapLayer.y = 0;
            if (this.mapLayer.y < -(map.height-SC_H)) this.mapLayer.y = -(map.height-SC_H);
        }
        if (this.limitWidth) {
            if (this.mapLayer.x > 0) this.mapLayer.x = 0;
            if (this.mapLayer.x < -(map.width-SC_W)) this.mapLayer.x = -(map.width-SC_W);
        }

        //スクリーン座標
        this.screenX = -this.mapLayer.x;
        this.screenY = -this.mapLayer.y;

        if (this.stageController.isBackgroundMove) {
            //バックグラウンドのX座標を全体の割合から計算
            this.backgroundImage.x = -Math.floor(this.backgroundImage.width * (this.player.x / map.width)*0.05);
        } else {
            this.backgroundImage.x = this.stageController.backgroundX;
        }

        this.time++;
    },

    //敵キャラクタ投入
    spawnEnemy: function(x, y, name, options) {
        return qft.Enemy[name](this, options).addChildTo(this.enemyLayer).setPosition(x, y);
    },

    //アイテム投入
    spawnItem: function(x, y, options) {
        return qft.Item(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //アイテムボックス投入
    spawnItemBox: function(x, y, options) {
        return qft.ItemBox(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //エフェクト投入
    spawnEffect: function(x, y, options) {
        return qft.Effect(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //メッセージ投入
    spawnMessage: function(text, between, waitFrame) {
        between = between || 32;
        waitFrame = waitFrame || 30;
        var arrayText = text.split("");
        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        };
        var n = 0;
        var x = SC_W * 0.5 - (arrayText.length * between * 0.5);
        arrayText.forEach(function(e) {
            if (e == " ") {
                x += between;
                return;
            }
            var lb = phina.display.Label({text: e}.$safe(labelParam)).setPosition(x, SC_H*0.5+32).setScale(0, 1).addChildTo(this);
            lb.tweener.clear().setUpdateType('fps')
                .set({alpha: 0})
                .wait(n)
                .to({scaleX: 1.0, alpha: 1, y: SC_H*0.5}, 15, "easeOutSine")
                .wait(waitFrame)
                .to({scaleX: 0.0, y: SC_H*0.5-32}, 10, "easeOutSine")
                .call(function(){this.remove()}.bind(lb));
            x += between;
            n += 5;
        }.bind(this));
    },

    //イベントメッセージ投入
    spawnEventMessage: function(id, text) {
        if (!id || !text) return;
        //メッセージスタック内に同一ＩＤがある場合は投入しない
        for (var i = 0; i < this.messageStack.length; i++) {
            if (this.messageStack[i].id == id) return;
        }
        if (text instanceof Array) {
            text.forEach(function(str) {
                this.messageStack.push({id: id, text: str});
            }.bind(this));
        } else {
            this.messageStack.push({id: id, text: text});
        }
    },

    //スクリーン初期化
    setupScreen: function() {
        var that = this;
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "UbuntuMono",
            align: "left",
            baseline: "middle",
            fontSize: 20,
            fontWeight: ''
        };

        //体力ゲージ
        this.lifeGaugeLabel = phina.display.Label({text: "LIFE"}.$safe(labelParam)).addChildTo(this).setPosition(0, 10);
        var options = {
            width:  200,
            height: 5,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 2,
            gaugeColor: 'lime',
            cornerRadius: 0,
            value: this.player.hp,
            maxValue: this.player.hpMax,
        };
        this.lifeGauge = phina.ui.Gauge(options).addChildTo(this).setOrigin(0, 0.5).setPosition(40, 10);
        this.lifeGauge.update = function() {
            this.value = that.player.hp;
            this.width = that.player.hpMax * 2;
            this.maxValue = that.player.hpMax;
        };

        //スコア表示
        this.scoreLabel = phina.display.Label({text:"SCORE:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 10);
        this.scoreLabel.score = 0;
        this.scoreLabel.s = 0;
        this.scoreLabel.update = function(e) {
            if (e.ticker.frame % 10 == 0) {
                this.s = ~~((that.totalScore-this.score)/7);
                if (this.s < 3) this.s = 3;
                if (this.s > 7777) this.s = 7777;
            }
            this.score += this.s;
            if (this.score > that.totalScore) this.score = that.totalScore;

            this.text = "SCORE "+this.score.comma();
        }

        //制限時間表示
        this.timeLabel = phina.display.Label({text: "TIME:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 30);
        this.timeLabel.update = function() {
            this.text = "TIME:"+Math.floor(that.timeLimit/30);
            if (that.timeLimit == 0) {
                this.fill = 'red';
            } else {
                this.fill = 'white';
            }
        }

        //プレイヤー装備武器表示
        this.playerWeapon = qft.PlayerWeapon(this.player).addChildTo(this).setPosition(SC_W-30, SC_H-30);
        var sw = phina.display.RectangleShape({width: 60, height: 60})
            .addChildTo(this)
            .setPosition(SC_W-30, SC_H-30)
            .setInteractive(true)
            .setAlpha(0.0);
        sw.on('pointstart', e => {
            var pl = that.player;
            if (!pl.before.change && pl.equip.switchOk) pl.switchWeapon();
        });
    },

    //マップ情報の初期化
    setupStage: function() {

        this.baseLayer.removeChildren();

        //登録済みマップの消去
        this.clearMap();

        //ステージ設定読み込み
        switch (this.stageNumber) {
            case 1:
                this.stageController = qft.Stage1(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 2:
                this.stageController = qft.Stage2(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 3:
                this.stageController = qft.Stage3(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 4:
                this.stageController = qft.Stage4(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 5:
                this.stageController = qft.Stage5(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 6:
                this.stageController = qft.Stage6(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 7:
                this.stageController = qft.Stage7(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 8:
                this.stageController = qft.Stage8(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 9:
                this.stageController = qft.Stage9(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 10:
                this.stageController = qft.Stage10(this);
                this.switchMap(this.stageController.mapLayer[0]);
                this.isEnding = true;
                //システム表示のＯＦＦ
                this.lifeGaugeLabel.visible = false;
                this.lifeGauge.visible = false;
                this.scoreLabel.visible = false;
                this.timeLabel.visible = false;
                this.playerWeapon.visible = false;
                break;
            case 999:
                this.stageController = qft.Stage999(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
        };

        //ステージクリアフラグクリア
        this.isStageClear = false;

        //経過時間初期化
        this.time = 0;

        //タイムリミット設定
        this.timeLimit = this.stageController.timeLimit;

        //プレイヤー設定
        this.player.isControl = true;
        this.player.isMuteki = false;
        this.player.alpha = 1.0;

        this.mapstart = phina.geom.Vector2(this.player.x, this.player.y);

        this.stageController.playBGM();
    },

    //ステージイベント発火
    fireStageEvent: function(eventName) {
        return this.stageController.fireEvent(eventName);
    },

    warp: function(x, y, frame) {
        frame = frame || 60;
        this.player.isControl = false;
        this.player.gravity = 0;
        this.player.vx = 0;
        this.player.isMuteki = true;
        this.player.tweener.clear()
            .wait(45)
            .call(function(){
                this.ignoreCollision = true;
            }.bind(this.player))
            .moveTo(x, y, frame, "easeInOutSine")
            .call(function(){
                this.ignoreCollision = false;
                this.gravity = 0.9;
            }.bind(this.player))
            .wait(90)
            .call(function(){
                this.isControl = true;
                this.isMuteki = false;
            }.bind(this.player));
    },

    //マップ情報の消去
    clearMap: function() {
        //当たり判定、オブジェクトの全消去
        if (this.backgroundLayer) this.backgroundLayer.removeChildren();
        if (this.foregroundLayer) this.foregroundLayer.removeChildren();
        if (this.collisionLaye) this.collisionLayer.removeChildren();
        if (this.enemyLayer) this.enemyLayer.removeChildren();
        if (this.objLayer) this.objLayer.removeChildren();
        if (this.mapImageLayer) this.mapImageLayer.removeChildren();
        if (this.effectLayer) this.effectLayer.removeChildren();
        if (this.shadowLayer) this.shadowLayer.removeChildren();
    },

    //マップレイヤの切替
    switchMap: function(layer, x, y) {
        if (this.mapLayer) this.mapLayer.remove();
        this.mapLayer = layer;
        this.mapLayer.addChildTo(this.baseLayer);
        this.map = layer.map;

        this.backgroundLayer = layer.backgroundLayer;
        this.foregroundLayer = layer.foregroundLayer;
        this.collisionLayer = layer.collisionLayer;
        this.enemyLayer = layer.enemyLayer;
        this.playerLayer = layer.playerLayer;
        this.objLayer = layer.objLayer;
        this.mapImageLayer = layer.mapImageLayer;
        this.effectLayer = layer.effectLayer;
        this.shadowLayer = layer.shadowLayer;

        this.player.remove();
        this.player.addChildTo(layer.playerLayer);
        if (x) {
            this.player.setPosition(x, y);
        }
    },

    //リスタート
    restart: function() {
        this.player.continueReset();
        this.player.mutekiTime = 90;
        this.player.addChildTo(this.mapLayer.playerLayer);

        //プレイヤー座標を最後に床にいた場所にする
        this.player.x = this.player.lastOnFloorX;
        this.player.y = this.player.lastOnFloorY;

        //復帰位置安全性確認
        var x = this.player.x;
        var y = this.player.y;
        var c1 = this.player.checkMapCollision2(x, y + 5, 4, 32);   //真下
        var c2 = this.player.checkMapCollision2(x+32, y + 5, 4, 32);//右下
        var c3 = this.player.checkMapCollision2(x-32, y + 5, 4, 32);//左下
        //真下に足場が無い場合は安全な場所にずらす
        if (!c1) {
            if (c2) {
                this.player.x += 32;
            } else if (c3){
                this.player.x -= 32;
            } else {
                //安全に復帰出来ないので直近のスタート地点へ
                this.player.x = this.mapstart.x;
                this.player.y = this.mapstart.y;
            }
        }

        this.totalScore = 0;
        this.totalKill = 0;
        this.continueCount++;

        this.stageController.playBGM();
    },

    //ステージクリア
    stageClear: function() {
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 2,

            fontFamily: "UbuntuMono",
            baseline: "middle",
            fontSize: 20,
            fontWeight: ''
        };

        //オールクリア判定
        this.allClear = false;
        if (!this.isPractice && this.stageNumber >= this.stageNumberMax) this.allClear = true;

        //クリアメッセージ投入
        var text = "STAGE " + this.stageNumber + " CLEAR!";
        if (this.allClear) text = "STAGE ALL CLEAR!";
        this.spawnMessage(text, 24);
        this.player.isControl = false;
        this.stageController.stageClear();
        this.isStageClear = true;

        //プレイヤー所持キークリア
        this.player.keys = [];
        this.player.isMuteki = true;

        //クリアBGM
        var bgmFinish = false;
        app.playBGM("stageclear", false, function() {
            bgmFinish = true;
        });

        var ar = {loadcomplete: true};
        if (!this.isPractice) {
            //クリア時点情報保存
            var data = {
                stage: this.stageNumber,
                score: this.totalScore,
                kill: this.totalKill,
                time: this.stageController.timeLimit - this.timeLimit,
            };
            this.clearResult[this.stageNumber] = data;

            //次ステージのアセット読み込み
            if (this.stageNumber < this.stageNumberMax) {
                var assets = qft.Assets.get({assetType: "stage"+(this.stageNumber+1)});
                var ar = phina.extension.AssetLoaderEx().load(assets, function(){app.soundset.readAsset();});
            } else {
                //オールクリア時はエンディング用ステージへ
                if (this.allClear) {
                    var assets = qft.Assets.get({assetType: "stage10"});
                    var ar = phina.extension.AssetLoaderEx().load(assets, function(){app.soundset.readAsset();});
                }
            }
        }

        //ロード進捗表示
        var that = this;
        var param = {text: "Loading... ", align: "right", fontSize: 20}.$safe(labelParam);
        var progress = phina.display.Label(param).addChildTo(this).setPosition(SC_W, SC_H*0.95);
        progress.time = 0;
        progress.update = function() {
            //ロードが終わったらキー入力で次ステージへ
            if (ar.loadprogress) this.text = "Loading... "+Math.floor(ar.loadprogress * 100)+"%";
            if (bgmFinish && that.timeLimit == 0 && ar.loadcomplete) {
                this.text = "Push button to next stage.";
                if (that.allClear) this.text = "Push button to next...";
                var ct = app.controller;
                if (ct.ok || ct.cancel) {
                    if (that.isPractice) {
                        that._exitGame = true;
                    } else {
                        that.flare('nextstage');
                    }
                    this.remove();
                }
            }
            if (this.time % 30 == 0) this.visible = !this.visible;
            this.time++;
        }
    },

    exitGame: function() {
        app.playBGM("openingbgm");
        if (this.isPractice || this.isContinue) {
            this.exit();
        } else {
            this.exit("title");
        }
    },

    //現在のステータスをローカルストレージへ保存
    saveGame: function() {
        var saveObj = {
            stageNumber: this.stageNumber,
            score: this.totalScore,
            kill: this.totalKill,
            result: this.clearResult,
            playerStatus: this.player.startStatus,
        };
        localStorage.setItem("stage", JSON.stringify(saveObj));
        return saveObj;
    },

    //ローカルストレージから直前の保存状態を読み込み
    loadGame: function() {
        var data = localStorage.getItem("stage");
        if (data) {
            var d = JSON.parse(data).$safe({
                stageNumber: 1,
                result: [],
                playerStatus: {},
            });
            this.stageNumber = d.stageNumber;
            this.totalScore = 0;
            this.totalKill = 0;
            this.clearResult = d.result;

            //プレイヤー情報復元
            this.player.startStatus = d.playerStatus;
            this.player.restoreStatus();
            this.playerWeapon.rotation = 0;
        }
        return d;
    },
});

/*
 *  menuscene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.MenuScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,0.5)",
            stroke: "rgba(0,0,0,0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "left",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };

        this.player = this.currentScene.player;
        this.limitFrame = 30;
        this.isExit = false;

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont2",
            align: "center",
            baseline: "middle",
            fontSize: 70,
        };
        this.textLabel1 = phina.display.Label({text: "PAUSE", fontSize: 20}.$safe(labelParam))
            .addChildTo(this).setPosition(SC_W*0.5, SC_H*0.8);

        this.time = 0;        
    },

    update: function() {
        var ct = app.controller;
        if (this.time > 10 && !this.isExit) {
            if (ct.start || ct.pause || ct.menu) {
                this.isExit = true;
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
        }
        this.limitFrame--;
        this.time++;
    },
});


/*
 *  menuscene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.MenuScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,0.5)",
            stroke: "rgba(0,0,0,0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "left",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };

        this.player = this.currentScene.player;
        var x = SC_W*0.3; //this.player.x + this.currentScene.mapLayer.x;
        var y = SC_H*0.5; //this.player.y + this.currentScene.mapLayer.y;

        //ベースエレメント
        this.menuBase = phina.display.DisplayElement().addChildTo(this).setPosition(x, y);
        this.menuBase.tweener.setUpdateType('fps');

        //メニューアイテム初期化
        this.setItems();

        //現在装備表示
        var eq = this.player.equip;
        this.weapon = phina.display.Sprite("item", 24, 24)
            .setPosition(SC_W*0.55, SC_H*0.3)
            .setScale(1.5)
            .setFrameIndex(eq.weapon[0])
            .addChildTo(this);
        this.weaponLabel = phina.display.Label({text: ""}.$safe(labelParam))
            .setPosition(SC_W*0.55+32, SC_H*0.3)
            .addChildTo(this);
        this.weaponLabel.update = function() {
            var item = qft.ItemInfo.get(eq.weapon[0]);
            this.text = item.name;
        };

        this.limitFrame = 30;

        this.isExit = false;
        this.time = 0;        
    },

    update: function() {
        var ct = app.controller;
        if (this.time > 10 && !this.isExit) {
            if (ct.start || ct.pause || ct.menu) {
                this.isExit = true;
                this.close();
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
            if (ct.right && this.limitFrame < 0) {
                app.playSE("click");
                this.menuBase.tweener.clear()
                    .by({rotation: -this.deg_1}, 4)
                    .call(function(){
                        if (this.rotation < 0) this.rotation += 360;
                    }.bind(this.menuBase));
                this.limitFrame = 5;
                this.currentScene.menuSelect++;
                if (this.currentScene.menuSelect == this.icon.length) this.currentScene.menuSelect = 0;
            }
            if (ct.left && this.limitFrame < 0) {
                app.playSE("click");
                this.menuBase.tweener.clear()
                    .by({rotation: this.deg_1}, 4)
                    .call(function(){
                        if (this.rotation > 360) this.rotation -= 360;
                    }.bind(this.menuBase));
                this.limitFrame = 5;
                this.currentScene.menuSelect--;
                if (this.currentScene.menuSelect < 0) this.currentScene.menuSelect = this.icon.length-1;
            }
        }
        this.limitFrame--;
        this.time++;
    },

    setItems: function() {
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 24,
            fontWeight: ''
        };

        var that = this;
        this.menuBase.removeChildren();

        //メニューアイテム
        this.icon = [];
        this.menuItems = this.player.items.clone();

        var rad = 0;
        var rad_1 = (Math.PI*2) / this.menuItems.length;
        var id = 0;
        this.menuItems.forEach(function(e) {
            var ic;
            if (typeof e === 'string') {
                ic = phina.display.Label({text: e}.$safe(labelParam)).addChildTo(this.menuBase);
                ic.setScale(0.5);
            } else {
                ic = phina.display.Sprite("item", 24, 24)
                    .addChildTo(this.menuBase)
                    .setFrameIndex(e);
            }
            ic.tweener.setUpdateType('fps');
            ic.rad = rad;
            ic.id = id;
            ic.distance = 0;
            ic.isClose = false;
            ic.update = function() {
                this.rotation = -that.menuBase.rotation;
                this.x =  Math.sin(this.rad)*this.distance;
                this.y = -Math.cos(this.rad)*this.distance;
                if (this.isClose) return;
                if (this.id == that.currentScene.menuSelect) {
                    this.tweener.clear().to({distance: 88, scaleX: 3, scaleY: 3}, 3);
                } else {
                    this.tweener.clear().to({distance: 72, scaleX: 1, scaleY: 1}, 3);
                }
            }
            ic.close = function() {
                this.tweener.clear().to({distance: 0, scaleX: 1, scaleY: 1}, 3);
                this.isClose = true;
            }
            ic.tweener.clear().to({distance: 48}, 500);
            this.icon.push(ic);
            rad += rad_1;
            id++;
        }.bind(this));

        this.deg_1 = 360/ this.menuItems.length;
        this.menuBase.rotation = -(this.currentScene.menuSelect * this.deg_1) - 90;
        this.menuBase.tweener.by({rotation: 90}, 15, "easeOutSine");
    },

    close: function() {
        this.menuBase.tweener.clear().by({rotation: 180}, 15, "easeOutSine");
        this.icon.forEach(function(e) {
            e.close();
        }.bind(this));
    },
});


/*
 *  messagescene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.MessageScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //メッセージウィンドウ
        var param = {
            width:SC_W*0.8,
            height:SC_H*0.4,
            fill: "rgba(0,0,0,0.8)",
            stroke: "white",
            sttokeWidth: 5,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.25)
            .setScale(1, 0);
        this.bg.tweener.clear().to({scaleY: 1}, 500, "easeOutCube");

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };
        this.textLabel = phina.display.Label({text: options.message || "no message", fontSize: 20}.$safe(labelParam))
            .addChildTo(this).setPosition(SC_W*0.5, SC_H*0.25);

        this.player = this.currentScene.player;
        this.limitFrame = 30;
        this.isExit = false;

        this.time = 0;        
    },

    update: function() {
        var ct = app.controller;
        if (this.time > 10 && !this.isExit) {
            if (ct.start || ct.pause || ct.menu) {
                this.isExit = true;
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
        }
        this.limitFrame--;
        this.time++;
    },
});


/*
 *  openingscene.js
 *  2017/02/08
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.OpeningScene", {
    superClass: "phina.display.DisplayScene",

    //進行
    seq: 0,

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //ＢＧＭ再生
        app.playBGM("openingbgm");

        this.text = [
            "世界の中心にそびえる塔",
            "塔の最上階には",
            "「永遠の都」と呼ばれる楽園があるという",
            "噂を聞いた多くの冒険者が",
            "楽園を求めて塔へと赴き",
            "その謎に挑んでいった",
            "しかし…",
            "彼らが果たして楽園に辿り着いたのか",
            "それとも世界の果てで力尽きたのか",
            "その末路を知る者はいない",
            "そして…",
            "新たな冒険者がまた一人",
            "いまだ見ぬ楽園への道に挑もうとしていた",
        ];

        //バックグラウンド
        var param = {
            width: SC_W,
            height: SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.5)

        //イメージ表示用レイヤ
        this.imageLayer = phina.display.DisplayElement().addChildTo(this);

        //フォアグラウンド
        var that = this;
        this.fg = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.5).setInteractive(true);
        this.fg.alpha = 0;
        this.fg.onpointstart = function() {
            if (that.alreadyLoad || that.loader && that.loader.loadcomplete) that.exit();
        }

        //上下黒帯
        param.height = SC_H * 0.15;
        this.bg1 = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.07)
        this.bg2 = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.93)

        //字幕
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 14,
        };
        var num = 0;
        this.textLabel = phina.display.Label({text: ""}.$safe(labelParam)).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.9);
        this.textLabel.alpha = 0;
        this.textLabel.tweener.clear()
            .call(function() {
                this.textLabel.text = this.text[num];
                num++;
                if (num == this.text.length) {
                    this.textLabel.tweener.setLoop(false);
                }
            }.bind(this))
            .fadeIn(500)
            .wait(3000)
            .fadeOut(500)
            .wait(1000)
            .setLoop(true);

        //基本アセットをロード
        this.alreadyLoad = false;
        if (qft.Assets.isLoaded("common")) {
            //読込済みなのでスキップ
            this.alreadyLoad = true;
            return;
        }
        var that = this;
        var assets = qft.Assets.get({assetType: "common"});
        this.loader = phina.extension.AssetLoaderEx().load(assets, function(){app.soundset.readAsset();});
        this.loadLabel = phina.display.Label({text: "", align: "right", fontSize: 12}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.99, SC_H*0.1);
        this.loadLabel.time = 1;    
        this.loadLabel.update = function() {
            this.text = "Loading... "+Math.floor(that.loader.loadprogress * 100)+"%";
            if (that.loader.loadcomplete) {
                this.text = "Push button to skip.";
                this.visible = true;
            } else {
                if (this.time % 20 == 0) this.visible = !this.visible;
            }
            this.time++;
        };
    },

    update: function() {
        if (this.alreadyLoad || this.loader && this.loader.loadcomplete) {
            var ct = app.controller;
            if (ct.ok || ct.cancel) this.exit();
        }

        if (this.seq == 0) {
            this.worldmap();
            this.seq++;
        }
        if (this.seq == 2) {
            this.towerimage();
            this.seq++;
        }
        if (this.seq == 4) {
            this.sequence3();
            this.seq++;
        }
        if (this.seq == 6) {
            this.playerimage();
            this.seq++;
        }
        if (this.seq == 8) {
            this.exit();
        }
    },

    //世界地図
    worldmap: function() {
        var sprite1 = phina.display.Sprite("openingmap")
            .addChildTo(this.imageLayer)
            .setPosition(SC_W * 0.5, -SC_H * 0.25)
            .setScale(0.8)
            .setAlpha(0.0);
        sprite1.tweener.clear()
            .by({alpha: 1.0, y: 200}, 7000)
            .by({alpha: -1.0, y: 200}, 7000)
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));
    },

    //塔外観
    towerimage: function() {
        var sprite1 = phina.display.Sprite("background").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.5);
        sprite1.alpha = 0;
        sprite1.tweener.clear()
            .call(function(){
                sprite1.alpha = 1;
                this.fg.alpha = 1;
                this.fg.tweener.clear().fadeOut(7000).fadeIn(7000);
            }.bind(this))
            .wait(14000)
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));

        var sprite2 = phina.display.Sprite("openingtower").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.3);
        sprite2.alpha = 0;
        sprite2.tweener.clear()
            .call(function(){
                sprite2.alpha = 1;
            }.bind(this))
            .by({x: -100}, 4000, "easeInOutSine")
            .wait(3000)
            .by({y: 300}, 7000, "easeInSine")
            .call(function(){
                sprite2.remove();
            }.bind(this));
    },

    //三番目表示（暫定）
    sequence3: function() {
        var sprite1 = phina.display.Sprite("openingback2").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.3).setScale(1.1);
        sprite1.alpha = 0;
        sprite1.tweener.clear()
            .call(function(){
                sprite1.alpha = 1;
                this.fg.alpha = 1;
                this.fg.tweener.clear().fadeOut(7000).wait(10000).fadeIn(7000);
            }.bind(this))
            .by({y: 150}, 12000, "easeInOutSine")
            .wait(12000)
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));

        var sprite2 = phina.display.Sprite("openinglight").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.5);
        sprite2.blendMode = 'lighter';
        sprite2.alpha = 0.3;
        sprite2.tweener.clear()
            .wait(12000)
            .by({x: -50}, 12000, "easeInOutSine");
    },

    //プレイヤー表示
    playerimage: function() {
        var sprite1 = phina.display.Sprite("openingback").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.35).setScale(1.2);
        sprite1.alpha = 0;
        sprite1.tweener.clear()
            .call(function(){
                sprite1.alpha = 1;
                this.fg.alpha = 1;
                this.fg.tweener.clear().fadeOut(7000).wait(5000).fadeIn(7000);
            }.bind(this))
            .wait(15000)
            .by({y: 150}, 5000, "easeInOutSine")
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));

        var sprite2 = phina.display.Sprite("openingground").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.9);
        sprite2.tweener.clear()
            .by({y: -50}, 4000, "easeInOutSine")
            .wait(10000)
            .by({y: 200}, 5000, "easeInOutSine")

        var pl = qft.PlayerDummy("player1").addChildTo(sprite2).setPosition(0, 38);
        pl.setAnimation("up");
        pl.tweener.clear()
            .wait(3000)
            .by({y: -76}, 5000, "easeInOutSine")
            .call(function() {
                pl.setAnimation("up_stop");
            })
            .wait(6000)
            .call(function() {
                pl.setAnimation("down");
            })
            .by({y: 76}, 5000, "easeInOutSine");
    },
});


/*
 *  practicescene.js
 *  2017/04/15
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.ConfigScene_Practice", {
    superClass: "phina.display.DisplayScene",

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        this.menuBase = phina.display.DisplayElement().addChildTo(this);
        this.menuBase.alpha = 0;
        this.menuBase.tweener.clear().fadeIn(500);

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont1",
            align: "center",
            baseline: "middle",
            fontSize: 70,
        };
        this.textLabel1 = phina.display.Label({text: "Practice", fontSize: 20}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.2);
        this.textLabel2 = phina.display.Label({text: "Stage select", fontSize: 20}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.3);

        //メニューテキスト表示
        var that = this;
        this.menu = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "P"];
        this.menuText = [];
        for (var i = 0; i < this.menu.length; i++) {
            this.menuText[i] = phina.display.Label({text: this.menu[i], fontSize: 40}.$safe(labelParam))
                .addChildTo(this.menuBase)
                .setPosition(SC_W*0.5+(SC_W*0.07*i)-(SC_W*0.07*(this.menu.length-1)/2), SC_H*0.5)
                .setScale(0.7);

            //タッチ判定用
            var param2 = {
                width: 30,
                height: SC_H*0.10,
                fill: "rgba(0,100,200,0.5)",
                stroke: "rgba(0,100,200,0.5)",
                backgroundColor: 'transparent',
            };
            var c = phina.display.RectangleShape(param2)
                .addChildTo(this.menuBase)
                .setPosition(SC_W*0.5+(SC_W*0.07*i)-(SC_W*0.07*(this.menu.length-1)/2), SC_H*0.5)
                .setInteractive(true);
            c.alpha = 0;
            c.select = i;
            c.onpointstart = function() {
                if (that.isSelected || that.time < 10) return;
                if (this.select == that.select) {
                    that.ok = true;
                } else {
                    if (that.vselect == 0) {
                        that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    } else {
                        that.exitText.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    }
                    that.select = this.select;
                    that.menuText[that.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                    that.vselect = 0;
                    app.playSE("select");
                }
            }
        }

        this.exitText = phina.display.Label({text: "Exit", fontSize: 40}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.7)
            .setScale(0.7);
        //タッチ判定用
        var param2 = {
            width: SC_W*0.3,
            height: SC_H*0.10,
            fill: "rgba(0,100,200,0.5)",
            stroke: "rgba(0,100,200,0.5)",
            backgroundColor: 'transparent',
        };
        var c = phina.display.RectangleShape(param2)
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.7)
            .setInteractive(true);
        c.alpha = 0;
        c.onpointstart = function() {
            if (that.isSelected || that.time < 10) return;
            if (that.vselect == 1) {
                that.ok = true;
            } else {
                that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                that.exitText.tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                that.vselect = 1;
                app.playSE("select");
            }
        }

        this.vselect = 0;
        this.select = 0;
        this.isSelected = false;
        this.selectMax = this.menu.length;
        this.menuText[0].setScale(1);
        this.ok = false;
        this.cancel = false;

        this.time = 0;

        this.on('resume', function() {
            this.time = 0;
            this.isSelected = false;
            this.ok = false;
            this.cansel = false;
        });
    },

    update: function() {
        var ct = app.controller;
        if (ct.right && !ct.before.right && this.select < this.selectMax-1 && this.vselect == 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select++;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }
        if (ct.left && !ct.before.left && this.select > 0  && this.vselect == 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }
        if (ct.down && !ct.before.down && this.vselect == 0) {
            this.vselect++;
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.exitText.tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }
        if (ct.up && !ct.before.up && this.vselect == 1) {
            this.vselect--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.exitText.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }

        if (this.time > 15) {
            if (ct.ok || this.ok) {
                if (this.vselect == 0) {
                    if (this.select == 0) {
                        app.pushScene(qft.MainScene({startStage: 1, isPractice: true}));
                    } else {
                        if (this.select == 9) {
                            app.pushScene(qft.MainScene({startStage: 999, isPractice: true}));
                        } else if (this.select == 8) {
                            app.pushScene(qft.SceneFlow.Resume({stageNumber: 10, isPractice: false}));
                        } else {
                            app.pushScene(qft.SceneFlow.Resume({stageNumber: this.select+1, isPractice: true}));
                        }
                    }
                    app.stopBGM();
                }
                if (this.vselect == 1) {
                    app.playSE("cancel");
                    this.exitMenu();
                }
                this.time = 0;
            }
            if (ct.cancel || this.cancel) {
                app.playSE("cancel");
                this.exitMenu();
                this.time = 0;
            }
        }
        this.time++;
    },

    exitMenu: function() {
        this.menuBase.tweener.clear()
            .fadeOut(500)
            .call(function() {
                this.exit();
            }.bind(this));
    },
});

phina.define("qft.PracticePlatform", {
    superClass: "phina.display.DisplayScene",

    init: function(options) {
        this.superInit();
        this.options = (options || {}).$safe({
            assetType: "stage2",
            startStage: 2,
        })
        this.count = 0;
    },

    onenter: function() {
        app.pushScene(qft.LoadingScene({
            assets: qft.Assets.get(this.options),
        }));
    },

    onresume: function() {
        this.count++;
        if (this.count == 1) {
            app.pushScene(qft.MainScene({startStage: this.options.startStage, isPractice: true}));
        }
        if (this.count == 2){
            this.exit();
        }
    }
});

/*
 *  SceneFlow.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

//メインシーンフロー
phina.define("qft.SceneFlow", {
    superClass: "phina.game.ManagerScene",

    init: function(options) {
        options = options || {};
        startLabel = options.startLabel || "splash";
        this.superInit({
            startLabel: startLabel,
            scenes: [{
                label: "splash",
                className: "qft.SplashScene",
            },{
                label: "opening",
                className: "qft.OpeningScene",
            },{
                label: "title",
                className: "qft.TitleScene",
                nextLabel: "opening",
            },{
                label: "main",
                className: "qft.MainScene",
                arguments: {
                    startStage: 1,
                    isPractice: false,
                },
                nextLabel: "title",
            },{
                label: "continue",
                className: "qft.SceneFlow.Resume",
                arguments: {
                    isPractice: false,
                    isContinue: true,
                },
                nextLabel: "title",
            },{
                label: "ending",
                className: "qft.EndingScene",
                nextLabel: "main",
            },{
                label: "config",
                className: "qft.ConfigScene",
                nextLabel: "title",
            },{
                label: "practice",
                className: "qft.ConfigScene_Practice",
                nextLabel: "config",
            }],
        });
    }
});

//復帰用
phina.define("qft.SceneFlow.Resume", {
    superClass: "phina.game.ManagerScene",

    init: function(options) {
        options = (options || {}).$safe({stageNumber: 2, isPractice: false, isContinue: false});
        if (options.isContinue) {
            var data = localStorage.getItem("stage");
            if (data) {
                var d = JSON.parse(data).$safe({
                    stageNumber: 1,
                    result: [],
                    playerStatus: {},
                });
                options.stageNumber = d.stageNumber;
            } else {
                options.stageNumber = 1;
            }
        }
        var startLabel = "start";
        var assets = qft.Assets.get({assetType: "stage"+options.stageNumber});
        this.superInit({
            startLabel: startLabel,
            scenes: [{
                label: "start",
                className: "qft.LoadingScene",
                arguments: {
                    assets: assets,
                },
                nextLabel: "main",
            },{
                label: "main",
                className: "qft.MainScene",
                arguments: {
                    startStage: options.stageNumber,
                    isPractice: options.isPractice,
                    isContinue: options.isContinue,
                },
            }],
        });
    },
    onfinish: function() {
        this.exit();
    }
});

/*
 *  splashscene.js
 *  2017/02/08
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define('qft.SplashScene', {
    superClass: 'phina.display.DisplayScene',

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        this.unlock = false;
        this.loadcomplete1 = false;
        this.loadcomplete2 = false;
        this.progress1 = 0;
        this.progress2 = 0;

        //preload asset
        var assets = qft.Assets.get({assetType: "splash"});
        this.loader = phina.asset.AssetLoader();
        this.loader.load(assets);
        this.loader.on('load', function(e) {
            this.loadcomplete1 = true;
        }.bind(this));
        this.loader.on('progress', function(e) {
            this.progress1 = Math.floor(e.progress*100);
        }.bind(this));

        //preload asset2
        var assets = qft.Assets.get({assetType: "splash2"});
        this.loader2 = phina.asset.AssetLoader();
        this.loader2.load(assets);
        this.loader2.on('load', function(e) {
            this.loadcomplete2 = true;
        }.bind(this));
        this.loader2.on('progress', function(e) {
            this.progress2 = Math.floor(e.progress*100);
        }.bind(this));

        //logo
        var texture = phina.asset.Texture();
        texture.load(qft.SplashScene.logo).then(function() {
            this._init();
        }.bind(this));
        this.texture = texture;
    },

    _init: function() {
        this.sprite = phina.display.Sprite(this.texture)
            .addChildTo(this)
            .setPosition(this.gridX.center(), this.gridY.center())
            .setScale(0.3);
        this.sprite.alpha = 0;

        this.sprite.tweener.clear()
            .to({alpha:1}, 500, 'easeOutCubic')
            .wait(500)
            .call(function() {
                this.unlock = true;
            }, this);

        var that = this;
        //進捗ゲージ
        var options = {
            width:  SC_W*0.1,
            height: 3,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 1,
            gaugeColor: 'lime',
            cornerRadius: 3,
            value: 0,
            maxValue: 100,
        };
        this.progressGauge = phina.ui.Gauge(options).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.8);
        this.progressGauge.beforeValue = 0;
        this.progressGauge.update = function() {
            if (that.progress1 == this.beforeValue) {
                this.value++;
            } else {
                this.value = that.progress1;
            }
            this.beforeValue = this.value;
        };
    },

    update: function() {
        if (this.unlock && this.loadcomplete1 && this.loadcomplete2) {
            this.unlock = false;
            this.sprite.tweener.clear()
                .to({alpha:0}, 500, 'easeOutCubic')
                .call(function() {
                    this.exit();
                }, this);
            this.progressGauge.tweener.clear().to({alpha:0}, 10, 'easeOutCubic')
        }
    },

    _static: {
        logo: "assets/image/phinajs_logo.png",
    },
});

/*
 *  titlescene.js
 *  2017/02/09
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.TitleScene", {
    superClass: "phina.display.DisplayScene",

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.setUpdateType('fps');

        var sprite1 = phina.display.Sprite("titleback").addChildTo(this).setPosition(SC_W * 0.5, SC_H * 0.5);
        sprite1.alpha = 0;
        sprite1.tweener.clear().fadeIn(500);

        //タイトルロゴの表示
        this.dispTitleLogo();

        //メニューアイテム表示
        var that = this;
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont2",
            align: "center",
            baseline: "middle",
            fontSize: 30,
        };
        this.menu = ["Start", "Continue", "Config"];
        this.menuComment = ["ゲームを開始します", "前回ゲームオーバーになったステージの最初から開始します", "設定メニューを開きます"];
        this.menuText = [];
        for (var i = 0; i < this.menu.length; i++) {
            this.menuText[i] = phina.display.Label({text: this.menu[i]}.$safe(labelParam))
                .addChildTo(this)
                .setPosition(SC_W*0.5, SC_H*0.6+i*30)
                .setScale(0.7);

            //タッチ判定用
            var param2 = {
                width: SC_W*0.3,
                height: SC_H*0.08,
                fill: "rgba(0,100,200,0.5)",
                stroke: "rgba(0,100,200,0.5)",
                backgroundColor: 'transparent',
            };
            var c = phina.display.RectangleShape(param2)
                .addChildTo(this)
                .setPosition(SC_W*0.5, SC_H*0.6+i*30)
                .setInteractive(true);
            c.alpha = 0;
            c.select = i;
            c.onpointstart = function() {
                if (that.isSelected || that.time < 10) return;
                if (this.select == that.select) {
                    that.ok = true;
                } else {
                    that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    that.select = this.select;
                    that.menuText[that.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                    app.playSE("select");
                }
            }
        }
        this.isSelected = false;
        this.select = 0;
        this.selectMax = 3;
        this.menuText[0].setScale(1);
        this.ok = false;
        this.cansel = false;

        //メニューコメント
        var that = this;
        this.comment = phina.display.Label({text: "", fontSize: 10}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.9);
        this.comment.update = function() {
            this.text = that.menuComment[that.select];
        }

        this.fg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fg.tweener.setUpdateType('fps');
        this.fg.tweener.clear().fadeOut(15);

        this.on('resume', e => {
            this.fg.tweener.clear().fadeOut(15);
            this.time = 0;
            this.isSelected = false;
            this.ok = false;
            this.cansel = false;
        });

        this.time = 0;
    },

    update: function(app) {
        if (this.isSelected) return;

        var ct = app.controller;
        if (ct.down && !ct.before.down && this.select < this.selectMax-1) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select++;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }
        if (ct.up && !ct.before.up && this.select > 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }
        if (this.time > 15) {
            if (ct.ok || this.ok){
                this.isSelected = true;
                this.time = 0;
                switch (this.select) {
                    case 0:
                        //通常開始
                        app.playSE("ok");
                        this.fg.tweener.clear()
                            .fadeIn(3)
                            .call(function() {
                                this.exit("main");
                            }.bind(this));
                        break;
                    case 1:
                        //コンティニュー
                        app.playSE("ok");
                        this.fg.tweener.clear()
                            .fadeIn(3)
                            .call(function() {
                                var data = localStorage.getItem("stage");
                                if (data) {
                                    var d = JSON.parse(data).$safe({stageNumber: 1});
                                    if (d.stageNumber == 1) {
                                        this.exit("main");
                                    } else {
                                        app.pushScene(qft.SceneFlow.Resume({isPractice: false, isContinue: true}));
                                    }
                                } else {
                                    this.exit("main");
                                }
                            }.bind(this));
                        break;
                    case 2:
                        //設定メニュー
                        app.pushScene(qft.ConfigScene(this));
                        break;
                }
            }
            if (ct.cancel || this.cancel) {
                app.pushScene(qft.ConfigScene(this));
                this.isSelected = true;
                this.time = 0;
            }
        }
        if (this.time > 30 * 120) {
            this.exit("opening");
        }
        this.time++;
    },

    //タイトルロゴ表示
    dispTitleLogo: function(x, y) {
        x = x || SC_W * 0.5;
        y = y || SC_H * 0.45;

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 10,

            fontFamily: "titlefont1",
            align: "center",
            baseline: "middle",
            fontSize: 60,
        };
        var num = 0;
        this.textLabel = phina.display.Label({text: "The", fontSize: 30}.$safe(labelParam))
            .addChildTo(this).setPosition(x-182, y-85);
        this.textLabel = phina.display.Label({text: "Quest"}.$safe(labelParam))
            .addChildTo(this).setPosition(x-47, y-85);
        this.textLabel = phina.display.Label({text: "for", fontSize: 40}.$safe(labelParam))
            .addChildTo(this).setPosition(x-17, y-40);
        this.textLabel = phina.display.Label({text: "Tanelorn"}.$safe(labelParam))
            .addChildTo(this).setPosition(x+48, y);
    },
});

/*
 *  tutorialscene.js
 *  2017/06/01
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.TutorialScene", {
    superClass: "phina.display.DisplayScene",

    //スクリーンのマップ外への移動制限フラグ
    limitWidth: false,
    limitHeight: true,

    //プレイヤースクリーン中央固定フラグ
    centerPlayer: true,

    init: function(options) {
        this.superInit({width: SC_W, height: SC_H});

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.setUpdateType('fps');

        //背景
        this.backgroundImage = phina.display.Sprite("background").addChildTo(this).setPosition(0, SC_H*0.5).setOrigin(0, 0.5);

        //管理用基準レイヤ
        this.baseLayer = phina.display.DisplayElement().addChildTo(this);

        //プレイヤーキャラクタ
        this.player = qft.Player(this);

       //スクリーン初期化
        this.setupScreen();

        //ステージ情報初期化
        this.setupStage();

        this.fg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fg.tweener.setUpdateType('fps').clear().fadeOut(30);

        //バーチャルパッドの可視化
//        app.virtualPad.addChildTo(this);

        app.volumeBGM = 0.5;
        app.volumeSE = 0.2;

        //メッセージ表示
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };
        var that = this;
        this.messageStack = [];
        this.eventMessage = phina.display.Label({text: ""}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.2)
            .addChildTo(this);
        this.eventMessage.alpha = 0;
        this.eventMessage.tweener.clear().setUpdateType('fps');
        this.eventMessage.nextOk = true;
        this.eventMessage.update = function() {
            if (this.nextOk && that.messageStack.length > 0) {
                this.nextOk = false;
                var msg = that.messageStack[0];
                this.tweener.clear()
                    .call(function(){
                        this.text = msg.text;
                    }.bind(this))
                    .fadeIn(15).wait(90).fadeOut(15)
                    .call(function(){
                        this.nextOk = true;
                        that.messageStack.splice(0, 1);
                    }.bind(this))
            }
        }

        this.time = 0;
    },

    update: function(app) {
        if (this.time == 15) this.player.isControl = true;

        //スクリーン表示位置をプレイヤー中心になる様に調整
        if (this.centerPlayer) {
            var map = this.mapLayer.map;
            this.mapLayer.x = SC_W*0.5-this.player.x;
            this.mapLayer.y = SC_H*0.5-this.player.y;
            if (this.limitHeight) {
                if (this.mapLayer.y > 0) this.mapLayer.y = 0;
                if (this.mapLayer.y < -(map.height-SC_H)) this.mapLayer.y = -(map.height-SC_H);
            }
            if (this.limitWidth) {
                if (this.mapLayer.x > 0) this.mapLayer.x = 0;
                if (this.mapLayer.x < -(map.width-SC_W)) this.mapLayer.x = -(map.width-SC_W);
            }

            //スクリーン座標
            this.screenX = -this.mapLayer.x;
            this.screenY = -this.mapLayer.y;

            //バックグラウンドのX座標を全体の割合から計算
            this.backgroundImage.x = -Math.floor(this.backgroundImage.width * (this.player.x / map.width)*0.01);
        }

        this.time++;
    },

    //敵キャラクタ投入
    spawnEnemy: function(x, y, name, options) {
        return qft.Enemy[name](this, options).addChildTo(this.enemyLayer).setPosition(x, y);
    },

    //アイテム投入
    spawnItem: function(x, y, options) {
        return qft.Item(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //アイテムボックス投入
    spawnItemBox: function(x, y, options) {
        return qft.ItemBox(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //エフェクト投入
    spawnEffect: function(x, y, options) {
        return qft.Effect(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //メッセージ投入
    spawnMessage: function(text, between, waitFrame) {
        between = between || 32;
        waitFrame = waitFrame || 30;
        var arrayText = text.split("");
        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        };
        var n = 0;
        var x = SC_W * 0.5 - (arrayText.length * between * 0.5);
        arrayText.forEach(function(e) {
            if (e == " ") {
                x += between;
                return;
            }
            var lb = phina.display.Label({text: e}.$safe(labelParam)).setPosition(x, SC_H*0.5+32).setScale(0, 1).addChildTo(this);
            lb.tweener.clear().setUpdateType('fps')
                .set({alpha: 0})
                .wait(n)
                .to({scaleX: 1.0, alpha: 1, y: SC_H*0.5}, 15, "easeOutSine")
                .wait(waitFrame)
                .to({scaleX: 0.0, y: SC_H*0.5-32}, 10, "easeOutSine")
                .call(function(){this.remove()}.bind(lb));
            x += between;
            n += 5;
        }.bind(this));
    },

    //イベントメッセージ投入
    spawnEventMessage: function(id, text) {
        if (!id || !text) return;
        //メッセージスタック内に同一ＩＤがある場合は投入しない
        for (var i = 0; i < this.messageStack.length; i++) {
            if (this.messageStack[i].id == id) return;
        }
        if (text instanceof Array) {
            text.forEach(function(str) {
                this.messageStack.push({id: id, text: str});
            }.bind(this));
        } else {
            this.messageStack.push({id: id, text: text});
        }
    },

    //スクリーン初期化
    setupScreen: function() {
        var that = this;
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "UbuntuMono",
            align: "left",
            baseline: "middle",
            fontSize: 20,
            fontWeight: ''
        };

        //体力ゲージ
        phina.display.Label({text: "LIFE"}.$safe(labelParam)).addChildTo(this).setPosition(0, 10);
        var options = {
            width:  256,
            height: 5,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 2,
            gaugeColor: 'lime',
            cornerRadius: 0,
            value: this.player.hp,
            maxValue: this.player.hp,
        };
        this.lifeGauge = phina.ui.Gauge(options).addChildTo(this).setOrigin(0, 0.5).setPosition(40, 10);
        this.lifeGauge.update = function() {
            this.value = that.player.hp;
        };

        //スコア表示
        this.scoreLabel = phina.display.Label({text:"SCORE:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 10);
        this.scoreLabel.score = 0;
        this.scoreLabel.s = 0;
        this.scoreLabel.update = function(e) {
            if (e.ticker.frame % 10 == 0) {
                this.s = ~~((that.totalScore-this.score)/7);
                if (this.s < 3) this.s = 3;
                if (this.s > 7777) this.s = 7777;
            }
            this.score += this.s;
            if (this.score > that.totalScore) this.score = that.totalScore;

            this.text = "SCORE "+this.score.comma();
        }

        //制限時間表示
        var tl = phina.display.Label({text: "TIME:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 30);
        tl.update = function() {
            this.text = "TIME:"+Math.floor(that.timeLimit/30);
            if (that.timeLimit == 0) {
                this.fill = 'red';
            } else {
                this.fill = 'white';
            }
        }

        //プレイヤー装備武器表示
        this.playerWeapon = qft.PlayerWeapon(this.player).addChildTo(this).setPosition(SC_W-30, SC_H-30);
    },

    //マップ情報の初期化
    setupStage: function() {

        this.baseLayer.removeChildren();

        this.stageController = qft.Stage999(this);
        this.switchMap(this.stageController.mapLayer[0]);

        //経過時間初期化
        this.time = 0;

        //タイムリミット設定
        this.timeLimit = this.stageController.timeLimit;

        //プレイヤー設定
        this.player.isControl = false;
        this.player.isMuteki = false;
        this.player.alpha = 1.0;

        this.stageController.playBGM();
    },

    //マップレイヤの切替
    switchMap: function(layer, x, y) {
        if (this.mapLayer) this.mapLayer.remove();
        this.mapLayer = layer;
        this.mapLayer.addChildTo(this.baseLayer);
        this.map = layer.map;

        this.backgroundLayer = layer.backgroundLayer;
        this.foregroundLayer = layer.foregroundLayer;
        this.collisionLayer = layer.collisionLayer;
        this.enemyLayer = layer.enemyLayer;
        this.playerLayer = layer.playerLayer;
        this.objLayer = layer.objLayer;
        this.mapImageLayer = layer.mapImageLayer;
        this.effectLayer = layer.effectLayer;

        this.player.remove();
        this.player.addChildTo(layer.playerLayer);
        if (x) {
            this.player.setPosition(x, y);
        }
    },
});

/*
 *  stage1.js
 *  2017/01/24
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage1", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 1,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm1",

    init: function(parentScene) {
        this.superInit(parentScene);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage1");
        this.mapLayer[0] = this.createMap(tmx);

       //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 1", 24);

            //マップ表示設定
            this.limitWidth = false;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveBy(14, -32, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage10.js
 *  2017/09/10
 *  @auther minimo  
 *  This Program is MIT license.
 */

//エンディングシーン
phina.define("qft.Stage10", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 10,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "ending",

    //特殊ステージフラグ
    isEnding: true,

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage10");
        this.mapLayer[0] = this.createMap(tmx);

        //プレイヤーダミースプライト
        var pl = qft.PlayerDummy("player1")

        //初期処理
        this.add(1, function() {
            //開始メッセージ投入
            this.spawnEventMessage(1, "Congraturations!!");

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;

            this.player.speed = 2;
            this.player.speedAscend = 2;
            this.player.isAuto = true;
            this.player.autoKey.up = true;
        });

        this.add(224, function() {
            this.player.autoKey.up = false;
        });

        this.add(60, function() {
            this.player.autoKey.right = true;
        });

        //石碑まで
        this.add(255, function() {
            this.player.autoKey.right = false;
            this.player.setAlpha(0);
            pl.addChildTo(this.mapLayer.playerLayer);
            pl.setPosition(this.player.x, this.player.y);
            pl.setAnimation("up_stop");
        });
        this.add(120, function() {
            this.player.autoKey.right = true;
            this.player.setAlpha(1.0);
            pl.remove();
        });

        //入り口まで
        this.add(330, function() {
            this.player.autoKey.right =　false;
        });

        this.add(60, function() {
            this.player.autoKey.right = true;
        });
        this.add(30, function() {
            this.player.autoKey.right = false;
        });
        this.add(30, function() {
            this.player.autoKey.right = true;
        });
        this.add(20, function() {
            this.player.autoKey.right = false;
        });

        this.add(60, function() {
            this.player.tweener.clear().set({alpha: 0}).moveBy(0, -600, 600);
            this.player.gravity = 0;

            pl.addChildTo(this.mapLayer.playerLayer);
            pl.setPosition(this.player.x, this.player.y);
            pl.setAnimation("up");
            pl.tweener.setUpdateType('fps').clear()
                .moveBy(0, -600, 600)
                .call(() => {
                    pl.setAnimation("down");
                })
                .wait(10)
                .call(() => {
                    pl.setAnimation("clear");
                })
                .wait(30)
                .call(() => {
                    pl.setAnimation("up");
                })
                .wait(30)
                .call(() => {
                    this.fgWhite.tweener.clear()
                        .wait(120)
                        .fadeIn(120)
                        .call(() => {
                            this.flare("ending");
                        });
                    this.fg.tweener.clear()
                        .wait(150)
                        .fadeIn(60);

                })
                .moveBy(0, -600, 600);
            var obj = this.stageController.findObject(17, 0, "enemy");
            obj.setAnimation("up");
        });

        this.add(60, function() {
            var obj = this.stageController.findObject(17, 0, "enemy");
            obj.tweener.clear().moveBy(0, -300, 300);
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
    },
});

/*
 *  stage1.js
 *  2017/01/24
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage2", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 2,

    //タイムリミット
    timeLimit: FPS*60*7,

    //BGMアセット名
    bgm: "bgm2",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage2_1");
        this.mapLayer[0] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 2", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 2) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(487, 271, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage3.js
 *  2017/03/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage3", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 3,

    //タイムリミット
    timeLimit: FPS*60*10,

    //BGMアセット名
    bgm: "bgm3",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage3_1");
        this.mapLayer[0] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage3_2");
        this.mapLayer[1] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage3_3");
        this.mapLayer[2] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 3", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 2) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(86, 272, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage4.js
 *  2017/03/08
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage4", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 4,

    //タイムリミット
    timeLimit: FPS*60*7,

    //BGMアセット名
    bgm: "bgm4",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage4_1");
        this.mapLayer[0] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage4_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 4", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(2903, 176, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage5.js
 *  2017/05/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage5", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 5,

    //タイムリミット
    timeLimit: FPS*60*8,

    //BGMアセット名
    bgm: "bgm5",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage5_1");
        this.mapLayer[0] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage5_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 5", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        //鍵出現
        this.addEvent("key", () => {
            var kx = 1196;
            var ky = 688;
            var key = qft.Item(this.parentScene, {properties: {kind: "key"}})
                .addChildTo(this.parentScene.mapLayer.objLayer)
                .setPosition(kx, ky);
            key.vy = -5;
            this.parentScene.pauseScene = true;
            this.parentScene.centerPlayer = false;
            this.parentScene.camera.setPosition(this.parentScene.player.x, this.parentScene.player.y);
            this.parentScene.camera.tweener.clear()
                .call(function() {
                    app.playSE("holy1");
                })
                .moveTo(kx, ky, 30, "easeInOutSine")
                .wait(30)
                .call(function() {
                    this.parentScene.pauseScene = false;
                    this.moveFrom.x = kx;
                    this.moveFrom.y = ky;
                    this.moveRaio = 0;
                    this.moveLerp = true;
                    this.moveToPlayer = true;
                }.bind(this.parentScene.camera))
                .to({moveRatio: 1}, 30, "easeInOutSine")
                .call(function() {
                    this.parentScene.centerPlayer = true;
                    this.moveLerp = false;
                }.bind(this.parentScene.camera));
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(3493+18, 80+80, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },

    //ステージＢＧＭ再生
    playBGM: function() {
        app.setVolume(this.bgm, 0.5);
        app.playBGM(this.bgm);
    },
});

/*
 *  stage6.js
 *  2017/05/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage6", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 6,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm6",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage6_1");
        this.mapLayer[0] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage6_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 6", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.bossdead1 = false;
        this.bossdead2 = false;

        //ボス１討伐
        this.addEvent("bossdead_1", () => {
            this.bossdead1 = true;
            if (this.bossdead2) this.fireEvent("key");
        });
        //ボス２討伐
        this.addEvent("bossdead_2", () => {
            this.bossdead2 = true;
            if (this.bossdead1) this.fireEvent("key");
        });

        //鍵出現
        this.addEvent("key", () => {
            var kx = 384;
            var ky = 944;
            var key = qft.Item(this.parentScene, {properties: {kind: "key"}})
                .addChildTo(this.parentScene.mapLayer.objLayer)
                .setPosition(kx, ky);
            key.vy = -5;
            this.parentScene.pauseScene = true;
            this.parentScene.centerPlayer = false;
            this.parentScene.camera.setPosition(this.parentScene.player.x, this.parentScene.player.y);
            this.parentScene.camera.tweener.clear()
                .call(function() {
                    app.playSE("holy1");
                })
                .moveTo(kx, ky, 30, "easeInOutSine")
                .wait(30)
                .call(function() {
                    this.parentScene.pauseScene = false;
                    this.moveFrom.x = kx;
                    this.moveFrom.y = ky;
                    this.moveRaio = 0;
                    this.moveLerp = true;
                    this.moveToPlayer = true;
                }.bind(this.parentScene.camera))
                .to({moveRatio: 1}, 30, "easeInOutSine")
                .call(function() {
                    this.parentScene.centerPlayer = true;
                    this.moveLerp = false;
                }.bind(this.parentScene.camera));
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 3) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(119 + 18　, 448 + 80, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage7.js
 *  2017/07/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ7
phina.define("qft.Stage7", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 6,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm7",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage7_1");
        this.mapLayer[0] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage7_2");
        this.mapLayer[1] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage7_3");
        this.mapLayer[2] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 7", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(182 + 18, 208 + 80, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage8.js
 *  2017/07/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ8
phina.define("qft.Stage8", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 8,

    //タイムリミット
    timeLimit: FPS*60*8,

    //BGMアセット名
    bgm: "bgm8",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage8_1");
        this.mapLayer[0] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage8_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 8", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        //鍵出現
        this.addEvent("key", () => {
            var kx = 670;
            var ky = 853;
            var key = qft.Item(this.parentScene, {properties: {kind: "key"}})
                .addChildTo(this.parentScene.mapLayer.objLayer)
                .setPosition(kx, ky);
            key.vy = -5;
            this.parentScene.pauseScene = true;
            this.parentScene.centerPlayer = false;
            this.parentScene.camera.setPosition(this.parentScene.player.x, this.parentScene.player.y);
            this.parentScene.camera.tweener.clear()
                .call(function() {
                    app.playSE("holy1");
                })
                .moveTo(kx, ky, 30, "easeInOutSine")
                .wait(30)
                .call(function() {
                    this.parentScene.pauseScene = false;
                    this.moveFrom.x = kx;
                    this.moveFrom.y = ky;
                    this.moveRaio = 0;
                    this.moveLerp = true;
                    this.moveToPlayer = true;
                }.bind(this.parentScene.camera))
                .to({moveRatio: 1}, 30, "easeInOutSine")
                .call(function() {
                    this.parentScene.centerPlayer = true;
                    this.moveLerp = false;
                }.bind(this.parentScene.camera));
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
//        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("walk");
                pl.tweener.clear()
                    .moveTo(784+16, 304-16, 500)
                    .call(function() {
                        pl.setAnimation("up");
                    })
                    .moveTo(784+16, -32, 5000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage9.js
 *  2017/07/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ9
phina.define("qft.Stage9", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 9,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm9",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage9_1");
        this.mapLayer[0] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 9", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(487, 271, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage999.js
 *  2017/05/03
 *  @auther minimo  
 *  This Program is MIT license.
 */

//テストステージ
phina.define("qft.Stage999", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 1,

    //タイムリミット
    timeLimit: FPS*60*5,

    init: function(parentScene) {
        this.superInit(parentScene);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage999");
        this.mapLayer[0] = this.createMap(tmx);

       //初期処理
        this.add(1, function() {
            //ＢＧＭ再生
            app.playBGM("bgm1");

            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 1", 24);

            //マップ表示設定
            this.limitWidth = false;
            this.limitHeight = true;
        });
    },
});

/*
 *  stagecontroller.js
 *  2017/01/24
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ制御
phina.define("qft.StageController", {
    superClass: "phina.app.Object2D",

    //ステージ番号
    stageNumber: 0,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm1",

    //マップ表示設定
    limitWidth: false,
    limitHeight: true,

    parentScene: null,
    mapLayer: null,
    player: null,
    time: 0,

    //経過時間トリガイベント
    seq: null,
    index: 0,

    //マップトリガイベント
    event: null,

    //バックグラウンド設定
    isBackgroundMove: true,
    backgroundX: -320,

    //特殊ステージフラグ
    isOpening: false,
    isTutorial: false,
    isEnding: false,

    init: function(parentScene) {
        this.superInit();

        this.parentScene = parentScene;
        this.mapLayer = [];
        this.player = parentScene.player;

        this.seq = [];
        this.event = [];
    },

    //時間イベント追加
    add: function(time, value, option) {
        this.index += time;
        this.seq[this.index] = {
            value: value,
            option: option,
        };
    },

    //時間イベント取得
    get: function(time) {
        var data = this.seq[time];
        if (data === undefined) return null;
        return data;
    },

    //マップイベント追加
    addEvent: function(id, value, option) {
        this.event[id] = {
            value: value,
            option: option,
            executed: false,
        };
    },

    //マップイベント取得
    getEvent: function(id) {
        var data = this.event[id];
        if (data === undefined) return null;
        return data;
    },

    //次にイベントが発生する時間を取得
    getNextEventTime: function(time) {
        var data = this.seq[time];
        if (data === undefined) {
            var t = time+1;
            var rt = -1;
            this.seq.some(function(val, index){
                if (index > t) {
                    rt = index;
                    return true;
                }
            },this.seq);
            return rt;
        } else {
            return time;
        }
    },

    //イベント発火
    fireEvent: function(eventName) {
        var event = this.event[eventName];
        if (event) {
            event.value.call();
            return true;
        }
        return false;
    },

    clear: function() {
        this.seq = [];
        this.index = 0;
    },

    checkStageClearCondition: function() {
        return false;
    },

    stageClear: function() {
    },

    //ステージＢＧＭ再生
    playBGM: function() {
        app.playBGM(this.bgm);
    },

    //IDからオブジェクト検索
    findObject: function(id, layerNumber, layerName) {
        layerNumber = layerNumber || 0;
        layerName = layerName || "object";
        var result = null;
        switch (layerName) {
            case "object":
                this.mapLayer[layerNumber].objLayer.children.forEach(function(e) {
                    if (e.id == id) result = e;
                }.bind(this));
                break;
            case "enemy":
                this.mapLayer[layerNumber].enemyLayer.children.forEach(function(e) {
                    if (e.id == id) result = e;
                }.bind(this));
                break;
        }
        return result;
    },

    //tmxからマップレイヤを作成する
    createMap: function(tmx) {
        //マップレイヤ
        var mapLayer = phina.display.DisplayElement();

        //マップ画像用レイヤ
        mapLayer.mapImageLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //地形判定用レイヤ
        mapLayer.collisionLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //バックグラウンドレイヤ
        mapLayer.backgroundLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //オブジェクト管理レイヤ
        mapLayer.objLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //影表示レイヤ
        mapLayer.shadowLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //敵キャラクタ管理レイヤ
        mapLayer.enemyLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //プレイヤー表示レイヤ
        mapLayer.playerLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //エフェクト管理レイヤ
        mapLayer.effectLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //フォアグラウンドレイヤ
        mapLayer.foregroundLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //マップ画像取得
        var mapImage = tmx.getImage("map", "background", "background2", "background3");
        mapLayer.map = phina.display.Sprite(mapImage).addChildTo(mapLayer.mapImageLayer).setOrigin(0, 0);

        //フォアグラウンド画像
        var foreground = tmx.getImage("foreground", "foreground2", "foreground3");
        phina.display.Sprite(foreground).addChildTo(mapLayer.foregroundLayer).setOrigin(0, 0);

        //マップ当たり判定取得
        var objects = tmx.getObjectGroup("collision").objects;
        objects.forEach(function(e) {
            var width = e.width || 16;
            var height = e.height || 16;
            var c = phina.display.RectangleShape({width: width, height: height})
                .addChildTo(mapLayer.collisionLayer)
                .setPosition(e.x+width/2, e.y+height/2)
                .setVisible(DEBUG_COLLISION);
            c.on('enterframe', function() {
                this.x += this.vx;
                this.y += this.vy;
            });
            c.id = e.id;
            c.vx = 0;
            c.vy = 0;
            c.alpha = 0.3;
            c.ignore = false;
            c.friction = e.properties.friction == undefined? 0.5: e.properties.friction;
            if (e.name) c.name = e.name;
            if (e.type) c.type = e.type;
            c.$extend(e.properties);

            //常時実行スクリプト
            if (c.script) {
                var sc = "(function(app) {"+c.script+"})";
                var f = eval(sc);
                c.on('enterframe', f);
            }
            //当たり判定時実行スクリプト
            if (c.collision) {
                var sc = "(function(e, dir) {"+c.collision+"})";
                c.collisionScript = eval(sc);
            }
        }.bind(this));

        //イベント取得
        var events = tmx.getObjectGroup("event").objects;
        events.forEach(function(e) {
            var that = this;
            var x = e.x + (e.width || 16) / 2;
            var y = e.y + (e.height || 16) / 2;
            switch (e.type) {
                case "player":
                    if (e.name == "start") {
                        mapLayer.startPosition = {x: x, y: y};
                        this.player.x = x;
                        this.player.y = y;
                        this.player.scaleX = 1;
                        if (e.properties.direction == 180) this.player.scaleX = -1;
                    }
                    break;
                case "enemy":
                    if (qft.Enemy[e.name]) {
                        var enemy = qft.Enemy[e.name](this.parentScene, e.properties).addChildTo(mapLayer.enemyLayer).setPosition(x, y);
                        if (e.properties.dead) {
                            var sc = "(function(app) {"+e.properties.dead+"})";
                            var f = eval(sc);
                            enemy.on('dead', f);
                        }
                        //移動パス設定
                        if (e.properties.path) {
                            var path = null;
                            var id = e.properties.path;
                            for (var i = 0; i < events.length; i++) {
                                if (events[i].id == id) {
                                    path = events[i];
                                    break;
                                }
                            }
                            if (path) enemy.setPath(path, e.properties.loop || false);
                        }
                    } else {
                        console.warn("unknown enemy: "+e.name);
                    }
                    break;
                case "item":
                    qft.Item(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "itembox":
                    qft.ItemBox(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "door":
                    var door = qft.MapObject.Door(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    if (e.name == "clear") mapLayer.clearGate = door;
                    if (e.properties.script) {
                        var sc = "(function(app) {"+e.properties.script+"})";
                        var f = eval(sc);
                        door.on('enterframe', f);
                        door.stageController = this;
                        door.player = this.parentScene.player;
                        door.parentScene = this.parentScene;
                    }
                    break;
                case "block":
                    var block = qft.MapObject.Block(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    block.addCollision(mapLayer.collisionLayer);
                    break;
                case "floor":
                    var floor = qft.MapObject.Floor(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    floor.addCollision(mapLayer.collisionLayer);
                    if (e.properties.script) {
                        var sc = "(function(app) {"+e.properties.script+"})";
                        var f = eval(sc);
                        floor.on('enterframe', f);
                        floor.stageController = this;
                        floor.player = this.parentScene.player;
                        floor.parentScene = this.parentScene;
                    }
                    //移動パス設定
                    var path = null;
                    if (e.properties.moveType == 'path' && e.properties.path) {
                        var id = e.properties.path;
                        for (var i = 0; i < events.length; i++) {
                            if (events[i].id == id) {
                                path = events[i];
                                break;
                            }
                        }
                        if (path) {
                            floor.setPath(path.x, path.y, path.polyline, e.properties.loop);
                        }
                    }
                    break;
                case "check":
                    qft.MapObject.CheckIcon(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y).setAnimation(e.name);
                    break;
                case "message":
                    qft.MapObject.Message(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "event":
                    qft.MapObject.Event(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "gate":
                    var gate = qft.MapObject.Gate(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    if (e.properties.script) {
                        var sc = "(function(app) {"+e.properties.script+"})";
                        var f = eval(sc);
                        gate.on('enterframe', f);
                        gate.stageController = this;
                        gate.player = this.parentScene.player;
                        gate.parentScene = this.parentScene;
                    }
                    break;
                case "accessory":
                    var layer = e.properties.foreground? mapLayer.foregroundLayer: mapLayer.backgroundLayer;
                    switch (e.name) {
                        case "lamp":
                            qft.MapObject.Lamp(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "bonfire":
                            qft.MapObject.Bonfire(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "flame":
                            qft.MapObject.Flame(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "candle":
                            qft.MapObject.Candle(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "lanthanum":
                            qft.MapObject.Lanthanum(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "candlelamp":
                            qft.MapObject.CandleLamp(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        default:
                            console.warn("unknown map accessory: "+e.name);
                    }
                    break;
                case "npc":
                    qft.MapObject.npc(this.parentScene, e).addChildTo(mapLayer.enemyLayer).setPosition(x, y);
                    break;
                case "path":
                    break;
                default:
                    console.warn("unknown map object id:[" + e.id + "] type:[" + e.type + "] name:[" + e.name + "]");
            }
        }.bind(this));
        return mapLayer;
    },
});

/*
 *  stage10.js
 *  2017/09/10
 *  @auther minimo  
 *  This Program is MIT license.
 */

//エンディングシーン
phina.define("qft.Stage10", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 10,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "ending",

    //特殊ステージフラグ
    isEnding: true,

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage10");
        this.mapLayer[0] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },
});

/*
 *  balloon.js
 *  2017/04/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Balloon", {
    superClass: "phina.display.Sprite",

    //寿命フレーム
    lifeSpan: 30,

    //アニメーション間隔
    animationInterval: 6,


    init: function(options) {
        this.superInit("balloon", 24, 32);

        this.pattern = options.pattern || "!";
        this.setAnimation(this.pattern);

        this.lifeSpan = options.lifeSpan || 60;
        this.animationInterval = options.animationInterval || 6;
        this.time = 0;

        //特殊パターン
        if (this.pattern == "anger2") {
            this.tweener.setUpdateType('fps').clear().by({y: -16, alpha: -1}, this.animationInterval, "easeInSine");
        }
    },

    update : function() {
        if (this.time % this.animationInterval == 0) this.frameIndex++;

        this.time++;
        if (this.time > this.lifeSpan) this.remove();
    },

    setAnimation: function(pattern) {
        switch (pattern) {
            case "...":
                this.setFrameTrimming(0, 0, 24, 128);
                break;
            case "?":
                this.setFrameTrimming(96, 32, 24, 32);
                break;
            case "!":
                this.setFrameTrimming(72, 64, 72, 32);
                break;
            case "zzz":
                this.setFrameTrimming(0, 0, 24, 32);
                break;
            case "stun":
                this.setFrameTrimming(144, 32, 48, 32);
                break;
            case "light":
                this.setFrameTrimming(144, 64, 48, 32);
                break;
            case "newtype":
                this.setFrameTrimming(144, 96, 72, 32);
                break;
            case "anger":
            case "anger1":
                this.setFrameTrimming(72, 96, 24, 32);
                break;
            case "anger2":
                this.setFrameTrimming(144, 128, 72, 32);
                break;
        }
    },
});

/*
 *  character.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Character", {
    superClass: "phina.display.DisplayElement",

    //マップオブジェクトID
    id: -1,

    //加速度
    vx: 0,
    vy: 0,

    //初期座標
    firstX: 0,
    firstY: 0,

    //重力加速度
    gravity: 0.9,

    //横移動減衰率
    friction: 0.5,

    //床移動減衰率
    floorFriction: 0.5,

    //反発係数
    rebound: 0,

    //ジャンプ中フラグ
    isJump: false,

    //スルーしたフロア
    throughFloor: null,

    //床上フラグ
    isOnFloor: false,

    //乗っているオブジェクト
    floorObject: null,

    //はしご上フラグ
    isOnLadder: false,

    //階段上フラグ
    isOnStairs: false,

    //はしご掴みフラグ
    isCatchLadder: false,

    //死亡フラグ
    isDead: false,

    //落下死亡フラグ
    isDrop: false,

    //気絶フラグ
    isStun: false,

    //操作停止時間
    stopTime: 0,

    //無敵フラグ
    isMuteki: false,

    //無敵時間
    mutekiTime: 0,

    //アニメーションフラグ
    isAnimation: true,

    //現在実行中アクション
    nowAnimation: "stand",

    //前フレーム実行アクション
    beforeAnimation: "",

    //アニメーション進行可能フラグ
    isAdvanceAnimation: true,

    //アニメーション変更検知フラグ
    isChangeAnimation: false,

    //アニメーション間隔
    animationInterval: 6,

    //地形無視
    ignoreCollision: false,

    //スクリーン内フラグ
    onScreen: false,

    //活動フラグ
    isActive: true,

    //影表示
    isShadow: false,
    shadowY: 0,

    //識別フラグ
    isPlayer: false,
    isEnemy: false,
    isItemBox: false,
    isItem: false,
    isBlock: false,
    isMapAccessory: false,

    //経過フレーム
    time: 0,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;
        this.boundingType = "rect";
        this.tweener.setUpdateType('fps');

        this.options = options || {};
        this.setupAnimation();

        this.id = options.id || -1;

        //当たり判定情報初期化
        if (!this.isMapAccessory) this.initCollision(options);

        //吹き出し
        var that = this;
        this.balloon = null;
        this.lastBalloon = "";
        this.balloonTime = 0;
        this.on('balloon', e => {
            if (this.isStun) return;
            if (this.time > this.balloonTime) this.lastBalloon = "";
            if (this.lastBalloonPattern == e.pattern && !e.force) return;
            if (this.balloon) this.balloon.remove();
            e.$safe({x: 0, y: -this.height/2-10});
            this.balloon = qft.Balloon({pattern: e.pattern, lifeSpan: e.lifeSpan, animationInterval: e.animationInterval})
                .addChildTo(this)
                .setPosition(e.x, e.y);
            this.balloon.on('removed', e => {
                that.balloon = null;
                that.flare('balloonend');
            });
            this.lastBalloonPattern = e.pattern;
            this.balloonTime = this.time + 120;
        });
        this.on('balloonerace', e => {
            if (this.balloon == null) return;
            this.balloon.remove();
            this.balloon = null;
            this.balloonTime = 0;
        });

        //気絶状態
        this.on('stun', e => {
            this.isStun = true;
            this.stopTime = e.power * 10;
            this.balloon = qft.Balloon({pattern: "stun", lifeSpan: this.stopTime})
                .addChildTo(this)
                .setPosition(0, -this.height/2-10);
            this.lastBalloon = e.pattern;
            this.balloonTime = this.time + 120;
        });

        this.on('enterframe', function(e) {
            if (this.parentScene.pauseScene) return;

            //初期座標の記録と初回フレーム処理
            if (this.time == 0) {
                this.firstX = this.x;
                this.firstY = this.y;
                this.firstFrame();
            }

            //画面内判定
            var ps = this.parentScene;
            if (ps.screenX-SC_W < this.x && this.x < ps.screenX + SC_W*2 && 
                ps.screenY-SC_H < this.y && this.y < ps.screenY + SC_H*2) {
                this.onScreen = true;
            } else {
                this.onScreen = false;
            }
            //画面外の場合は動作停止
//            if (!this.onScreen) return;

            //活動フラグ
            if (!this.isActive) return;

            this.x += this.vx;
            if (this.isOnFloor) {
                this.vx *= this.floorFriction;
            } else {
                this.vx *= this.friction;
            }

            if (this.isCatchLadder) {
                this.y += this.vy;
                this.vy = 0;
            } else {
                this.y += this.vy;
                this.vy += this.gravity;
                //落下速度上限
                if (this.vy > 20) this.vy = 20;
            }
            if (Math.abs(this.vx) < 0.01) this.vx = 0;
            if (Math.abs(this.vy) < 0.01) this.vy = 0;

            //当たり判定
            if (!this.isMapAccessory) {
                this.resetCollisionPosition();
                this.checkMapCollision();
            }

            //画面外落ち
            if (!this.isDead && this.y > this.parent.parent.map.height) this.dropDead();

            //アニメーション
            if (this.sprite && this.isAnimation && this.isAdvanceAnimation && this.time % this.animationInterval == 0) {
                this.index = (this.index+1) % this.frame[this.nowAnimation].length;
                //次フレーム番号が特殊指定の場合
                var next = this.frame[this.nowAnimation][this.index];
                if (next == "stop") {
                    //停止
                    this.index--;
                } else if (next == "remove") {
                    //リムーブ
                    this.remove();
                } else if (typeof next === "string") {
                    //指定アニメーションへ変更
                    this.setAnimation(next);
                } else {
                    this.sprite.frameIndex = next;
                }
            }

            //無敵時間処理
            if (this.mutekiTime > 0) {
                if (this.mutekiTime % 2 == 0) this.visible = !this.visible;
                this.mutekiTime--;
            } else {
                this.visible = true;
            }

            //操作停止時間
            this.stopTime--;
            if (this.stopTime < 0) this.stopTime = 0;

            //操作停止時間が終わったら気絶解除
            if (this.isStun && this.stopTime == 0) {
                this.isStun = false;
                this.flare('balloonerace');
            }

            if (this.balloon) this.balloon.scaleX = this.scaleX;

            //乗っている床の取得
            if (this.isOnFloor) {
                this.floorObject = this._collision[2].hit;
            } else {
                this.floorObject = null;
            }

            //影処理
            if (this.shadowSprite) {
                this.shadowSprite.x = this.x;
                this.shadowSprite.y = this.shadowY;
            }

            this.time++;
            this.beforeAnimation = this.nowAnimation;
        });

        this.on('added', () => {
            this.one('enterframe', () => {
                if (this.isShadow && !this.ignoreCollision) this.setupShadow();
            });
        });

        this.on('removed', () => {
            if(this.shadowSprite) this.shadowSprite.remove();
        });
    },

    //一回目のenterframeで一度だけ呼ばれる
    firstFrame: function() {
    },

    //影表示セットアップ
    setupShadow: function() {
        var that = this;
        var sc = this.width / 24;
        if (sc < 1) sc += 0.2;
        this.shadowSprite = phina.display.Sprite("shadow", 24, 8)
            .addChildTo(this.parentScene.shadowLayer)
            .setAlpha(0.5)
            .setScale(sc, 1.0);
        this.shadowSprite.update = function() {
            this.alpha = 0.5;
            if (that.alpha < 0.5) this.alpha = that.alpha;
        }
    },

    //当たり判定情報初期化
    initCollision: function(options) {
        //当り判定用（0:上 1:右 2:下 3:左）
        var w = Math.floor(this.width/4);
        var h = Math.floor(this.height/4);
        this._collision = [];
        this._collision[0] = phina.display.RectangleShape({width: w, height: 2});
        this._collision[1] = phina.display.RectangleShape({width: 2, height: h});
        this._collision[2] = phina.display.RectangleShape({width: w, height: 2});
        this._collision[3] = phina.display.RectangleShape({width: 2, height: h});
        this.collisionResult = null;

        //当たり判定チェック位置オフセット
        this.offsetCollisionX = options.offsetCollisionX || 0;
        this.offsetCollisionY = options.offsetCollisionY || 0;

        //当たり判定情報再設定
        this.setupCollision();

        //当たり判定デバッグ用
        if (DEBUG_COLLISION) {
            this.one('enterframe', e => {
                this._collision[0].addChildTo(this.parentScene.objLayer);
                this._collision[1].addChildTo(this.parentScene.objLayer);
                this._collision[2].addChildTo(this.parentScene.objLayer);
                this._collision[3].addChildTo(this.parentScene.objLayer);
                this._collision[0].alpha = 0.3;
                this._collision[1].alpha = 0.3;
                this._collision[2].alpha = 0.3;
                this._collision[3].alpha = 0.3;
                //ダメージ当たり判定表示
                var c = phina.display.RectangleShape({width: this.width, height: this.height}).addChildTo(this);
                c.alpha = 0.3;
            });
            this.one('removed', e => {
                this._collision[0].remove();
                this._collision[1].remove();
                this._collision[2].remove();
                this._collision[3].remove();
                });
        }
        return this;
    },

    //画面外落ち
    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        this.vx = 0;
        this.vy = -10;
        this.tweener.clear()
            .wait(60)
            .call(function(){
                this.flare('dead');
                this.remove();
            }.bind(this));
        return this;
    },

    //ノックバックモーション
    knockback: function(power, direction) {
        power = power || 0;
        if (power == 0) return;
        if (direction === undefined) direction = (this.direction + 180) % 360;

        var back = 32 + Math.floor(power / 10);
        var sx = Math.cos(direction.toRadian());
        var sy = Math.sin(direction.toRadian());

        //ノックバック先に壁が無いかチェック
        var chk = this.checkMapCollision2(this.x + sx * back, this.y + sy * back, 8, 8);
        if (chk) {
            //壁に当たる所までバックする
            var c = chk[0];
            switch (direction) {
                case 0:
                    back = (c.x - c.width / 2) - this.x;
                    back *= 0.8;
                    break;
                case 180:
                    back = this.x - (c.x + c.width / 2);
                    back *= 0.8;
                    break;
                default:
            }
        }

        this.tweener.clear().by({x: sx * back, y: sy * back}, 10, "easeOutElastic");
        this.vx = 0;
        this.vy = 0;
        return this;
    },

    //地形当たり判定
    checkMapCollision: function() {
        if (this.ignoreCollision) return this;

        this._collision[0].hit = null;
        this._collision[1].hit = null;
        this._collision[2].hit = null;
        this._collision[3].hit = null;

        this.isOnLadder = false;
        this.isOnStairs = false;

        if (this.onScreen && this.shadowSprite) {
            this.shadowY = 99999;
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(this.x, this.y + 128);
            this.shadowSprite.visible = false;
        }

        //地形接触判定
        this.parentScene.collisionLayer.children.forEach(e => {
            if (this.isDrop) return;
            if (e.ignore || e == this.throughFloor) return;
            if (e.type == "ladder" || e.type == "stairs") return;

            //上側
            if (this.vy < 0  && e.hitTestElement(this._collision[0])) this._collision[0].hit = e;
            //下側
            if (this.vy >= 0 && e.hitTestElement(this._collision[2])) this._collision[2].hit = e;
            //右側
            if (this.vx > 0  && e.hitTestElement(this._collision[1])) this._collision[1].hit = e;
            //左側
            if (this.vx < 0  && e.hitTestElement(this._collision[3])) this._collision[3].hit = e;

            if (this.onScreen && this.shadowSprite) {
                //キャラクターの下方向にレイを飛ばして直下の地面座標を取る
                var x = e.x - e.width / 2;
                var y = e.y - e.height / 2;
                var p3 = phina.geom.Vector2(x, y);
                var p4 = phina.geom.Vector2(x + e.width, y);
                if (y < this.shadowY && phina.geom.Collision.testLineLine(p1, p2, p3, p4)) {
                    this.shadowSprite.setPosition(this.x, y);
                    this.shadowSprite.visible = true;
                    this.shadowY = y;
                }
            }
        });

        if (this.isCatchLadder) this.shadowSprite.visible = false;

        //当たり判定結果反映
        this.collisionProcess();

        //はしごのみ判定
        this.parentScene.collisionLayer.children.forEach(e => {
            //梯子判定
            if (e.type == "ladder" || e.type == "stairs") {
                if (this.ladderCollision && e.hitTestElement(this.ladderCollision)) {
                    this.isOnLadder = true;
                    this.isOnStairs = (e.type == "stairs");
                }
                return;
            }
        });
        return this;
    },

    //当たり判定結果反映処理
    collisionProcess: function() {
        var w = Math.floor(this.width/2)+6;
        var h = Math.floor(this.height/2)+6;
        this.isOnFloor = false;

        //上側接触
        if (this._collision[0].hit && !this.isCatchLadder) {
            var ret = this._collision[0].hit;
            this.y = ret.y+ret.height*(1-ret.originY)+h;
            this.vy = 0;
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 0);
            }
        }
        //下側接触
        if (this._collision[2].hit && !this.isCatchLadder) {
            var ret = this._collision[2].hit;
            this.y = ret.y-ret.height*ret.originY-h;
            this.x += ret.vx || 0;
            if (!this.isPlayer && ret.vy > 0) this.y += ret.vy || 0;

            this.isJump = false;
            this.isOnFloor = true;
            this.floorFriction = ret.friction == undefined? 0.5: ret.friction;

            this.throughFloor = null;
            if (this.rebound > 0) {
                this.isJump = true;
                this.vy = -this.vy * this.rebound;
            } else {
                this.vy = 0;
            }
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 2);
            }
        }
        //右側接触
        if (this._collision[1].hit && !this.isCatchLadder) {
            var ret = this._collision[1].hit;
            this.x = ret.x-ret.width*ret.originX-w;
            this.vx = 0;
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 1);
            }
        }
        //左側接触
        if (this._collision[3].hit && !this.isCatchLadder) {
            var ret = this._collision[3].hit;
            this.x = ret.x+ret.width*(1-ret.originX)+w;
            this.vx = 0;
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 3);
            }
        }
        return this;
    },

    //地形当たり判定（特定地点チェックのみ）衝突したものを配列で返す
    checkMapCollision2: function(x, y, width, height) {
        x = x || this.x;
        y = y || this.y;
        width = width || 1;
        height = height || 1;
        var c = phina.display.DisplayElement({width: width, height: height}).setPosition(x, y);
        var ret = null;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.type == "ladder" || e.type == "stairs") return;
            if (e.hitTestElement(c)) {
                if (ret == null) ret = [];
                ret.push(e);
            }
        });
        return ret;
    },

    //キャラクタ同士当たり判定（ブロックのみ）
    checkCharacterCollision: function() {
        if (this.ignoreCollision) return;
        if (this.isDrop) return;

        var ret = [];
        var that = this;
        this.parentScene.objLayer.children.forEach(function(e) {
            if (!e.isBlock) return;
            if (e.isDead) return;

            //上側
            if (that.vy < 0 && e.hitTestElement(that._collision[0])) {
                that.y = e.y+e.height*(1-e.originY)+16;
                that.vy = 1;
                ret[0] = e;
                that.resetCollisionPosition();
            }
            //下側
            if (that.vy > 0 && e.hitTestElement(that._collision[2])) {
                that.y = e.y-e.height*e.originY-16;
                that.vx = e.vx;
                that.vy = 0;
                that.isJump = false;
                that.isOnFloor = true;
                that.throughFloor = null;
                ret[2] = e;
                if (that.rebound > 0) {
                    that.isJump = true;
                    that.vy = -that.vy * that.rebound;
                } else {
                    that.vy = 0;
                }
                that.resetCollisionPosition();
            }
            //右側
            if (that.vx > 0 && e.hitTestElement(that._collision[1])) {
                that.x = e.x-e.width*e.originX-10;
                that.vx = 0;
                ret[1] = e;
                that.resetCollisionPosition();
            }
            //左側
            if (that.vx < 0 && e.hitTestElement(that._collision[3])) {
                that.x = e.x+e.width*(1-e.originX)+10;
                that.vx = 0;
                ret[3] = e;
                that.resetCollisionPosition();
            }
        });
        return ret;
    },

    //当たり判定用エレメントの再設定
    setupCollision: function() {
        return this;
    },

    //当たり判定用エレメントの位置再セット
    resetCollisionPosition: function() {
        var w = Math.floor(this.width/2) + 6 + this.offsetCollisionX;
        var h = Math.floor(this.height/2)+ 6 + this.offsetCollisionY;
        this._collision[0].setPosition(this.x, this.y - h);
        this._collision[1].setPosition(this.x + w, this.y);
        this._collision[2].setPosition(this.x, this.y + h);
        this._collision[3].setPosition(this.x - w, this.y);
        return this;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [0, "stop"];
        this.frame["walk"] = [0];
        this.frame["up"] =   [0];
        this.frame["down"] = [0];
        this.frame["attack"] = [0, "stop"];
        this.index = 0;
        return this;
    },

    setAnimation: function(animName) {
        if (!this.frame[animName]) return;
        if (animName == this.nowAnimation) return;
        this.nowAnimation = animName;
        this.index = -1;
        this.isChangeAnimation = true;
        return this;
    },

    //プレイヤーからの直線距離
    getDistancePlayer: function() {
        var x = this.x-this.parentScene.player.x;
        var y = this.y-this.parentScene.player.y;
        return Math.sqrt(x*x+y*y);
    },

    //オブジェクト間の直線距離
    getDistance: function(element) {
        var x = this.x - element.x;
        var y = this.y - element.y;
        return Math.sqrt(x*x+y*y);
    },

    //自分と他エレメントを結ぶ直線の角度（弧度法）
    getAngle: function(element) {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(element.x, element.y);
        var p = p2.sub(p1);
        return p.toDegree();
    },

    //自分と他エレメントを結ぶ直線の角度（ラジアン）
    getAngleRadian: function(element) {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(element.x, element.y);
        var p = p2.sub(p1);
        return p.toAngle();
    },

    //物理現象情報のみオブジェクトで取得
    getPhysics: function() {
        return {
            vx: this.vx,
            vy: this.vy,
            gravity: this.gravity,
            friction: this.friction,
            rebound: this.rebound,
        };
    },

    //移動パスの設定
    setPath: function(path, loop) {
        this.path = [];
        this.loop = loop;

        //パス情報の作成
        var sum = 0;
        var ptb = null;
        for (var i = 0; i < path.polyline.length; i++) {
            var pt = phina.geom.Vector2(path.x + path.polyline[i].x, path.y + path.polyline[i].y);
            if (i > 0) {
                sum += Math.floor(ptb.distance(pt));
            }
            pt.time = sum;
            this.path.push(pt);
            ptb = pt;
        }

        //ループ有り指定の場合、始点の座標を終点に加える
        if (loop) {
            var end = phina.geom.Vector2(path.x + path.polyline[path.polyline.length - 1].x, path.y + path.polyline[path.polyline.length - 1].y);
            var start = phina.geom.Vector2(path.x + path.polyline[0].x, path.y + path.polyline[0].y);
            sum += Math.floor(start.distance(end));
            start.time = sum;
            this.path.push(start);
        }
        this.path.maxTime = sum;

        return this;
    },

    //パス座標の取得
    getPathPosition: function(time) {
        if (!this.path || time < 0) return null;
        time %= this.path.maxTime;

        var len = this.path.length;
        for (var i = 0; i < len; i++) {
            var p = this.path[i];
            if (time == p.time) return p;
            if (time < p.time) {
                var p2 = this.path[i - 1];
                var t = (time - p2.time) / (p.time - p2.time);
                return phina.geom.Vector2.lerp(p2, p, t);
            }
        }
        return null;
    },
});

/*
 *  effect.js
 *  2017/01/12
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Effect", {
    superClass: "phina.display.DisplayElement",

    //インデックス更新間隔
    interval: 2,

    //現在インデックス
    index: 0,

    //開始インデックス
    startIndex: 0,

    //最大インデックス
    maxIndex: 8,

    //アニメーション進行可能フラグ   
    isAdvanceAnimation: true,

    //経過フレーム
    time: 0,

    defaultOptions: {
        name: "explode",
        assetName: "effect",
        loop: false,
        position: {x: 0, y: 0},
        origin: {x: 0.5, y: 0.5},
        rotation: 0,
        alpha: 1.0,
        scale: {x: 1.0, y: 1.0},
        blendMode: "source-over",
    },

    init: function(parentScene, options) {
        this.superInit();

        this.options = (options || {}).$safe(this.defaultOptions);
        this.options.$extend(qft.EffectData.get(this.options.name));
        this.setup();

        this.on('enterframe', function() {
            this.time++;
            if (this.time % this.interval == 0 && this.isAdvanceAnimation) {
                this.sprite.frameIndex++;
                if (this.sprite.frameIndex == 0 || this.sprite.frameIndex == this.maxIndex) {
                    if (this.options.loop) {
                        this.sprite.frameIndex = this.startIndex;
                    } else {
                        this.remove();
                    }
                    this.flare('animationend');
                }
            }
        });
    },

    setup: function() {
        var op = this.options;
        this.sprite = phina.display.Sprite(op.assetName, op.width, op.height)
            .setPosition(op.position.x, op.position.y)
            .setOrigin(op.origin.x, op.origin.y)
            .setScale(op.scale.x, op.scale.y)
            .setRotation(op.rotation)
            .addChildTo(this);
        if (op.trimming) {
            var t = op.trimming;
            this.sprite.setFrameTrimming(t.x, t.y, t.width, t.height);
        }
        this.startIndex = op.startIndex;
        this.maxIndex = op.maxIndex;
        this.sprite.alpha = op.alpha;
        this.sprite.frameIndex = this.startIndex;
    },
});

phina.define("qft.EffectData", {
    _static: {
        get: function(name) {
            switch (name) {
                case "explode_small":
                    return {
                        width: 16,
                        height: 16,
                        interval: 2,
                        startIndex: 8,
                        maxIndex: 15,
                        trimming: {x: 256, y: 256, width: 128, height: 32},
                    };
                case "explode_small2":
                    return {
                        width: 16,
                        height: 16,
                        interval: 4,
                        startIndex: 0,
                        maxIndex: 7,
                        trimming: {x: 256, y: 256, width: 128, height: 32},
                    };
                case "explode":
                    return {
                        width: 64,
                        height: 64,
                        interval: 1,
                        startIndex: 0,
                        maxIndex: 8,
                        trimming: {x: 0, y: 0, width: 512, height: 128},
                    };
                case "explode_large":
                    return {
                        width: 48,
                        height: 48,
                        interval: 4,
                        startIndex: 0,
                        maxIndex: 7,
                        trimming: {x: 0, y: 0, width: 512, height: 128},
                    };
                case "explode_ground":
                    return {
                        width: 32,
                        height: 48,
                        interval: 4,
                        startIndex: 0,
                        maxIndex: 7,
                        trimming: {x: 256, y: 192, width: 256, height: 48},
                    };
                case "smoke_small":
                    return {
                        width: 16,
                        height: 16,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 4,
                        trimming: {x: 128, y: 128, width: 64, height: 16},
                    };
                case "smoke":
                    return {
                        width: 24,
                        height: 24,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 5,
                        trimming: {x: 128, y: 160, width: 120, height: 24},
                    };
                case "smoke_large":
                    return {
                        width: 32,
                        height: 32,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 8,
                        trimming: {x: 256, y: 128, width: 128, height: 64},
                    };
                case "hit":
                    return {
                        assetName: "effect2",
                        width: 72,
                        height: 32,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 3,
                        trimming: {x: 0, y: 0, width: 72, height: 128},
                    };
                default:
                    return {};
            }
        }
    }
});

/*
 *  enemy.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//敵キャラクタ基本クラス
phina.define("qft.Enemy", {
    superClass: "qft.Character",

    //識別フラグ
    isEnemy: true,

    //レベル
    level: 0,

    //ヒットポイント
    hp: 10,

    //防御力
    deffence: 1,

    //攻撃力
    power: 0,

    //移動速度
    speed: 1,

    //気絶確率
    stunPower: 1,

    //視力
    eyesight: 0,

    //視野角
    viewAngle: 90,

    //進行方向（0:右 180:左 270:上 90:下）
    direction: 0,

    //ポイント
    point: 0,

    //攻撃当たり判定有効フラグ
    isEnableAttackCollision: true,

    //スーパーアーマー状態フラグ
    isSuperArmor: false,

    //影表示フラグ
    isShadow: true,

    //属性ダメージ倍率
    damageSlash: 1,
    damageSting: 1,
    damageBlow: 1,
    damageArrow: 1,
    damageFire: 1,
    damageIce: 1,
    damageHoly: 1,
    damageDark: 1,

    //アイテムドロップ率（％）
    dropRate: 0,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 0,
    rareDropItem: ITEM_BAG,

    //行動パターン用
    chaseTime: 0,
    turnTime: 0,
    stopTime: 0,
    turnCount: 0,

    init: function(parentScene, options) {
        options = options || {};
        this.superInit(parentScene, options);
        this.setupAnimation();
        this.options = options;
        this.level = options.level || 0;
        this.territory = options.territory;

        //デバッグ時視界の可視化
        if (DEBUG_EYESIGHT) {
            var that = this;
            var va = (this.viewAngle / 2).toRadian();
            phina.display.ArcShape({radius: this.eyesight, startAngle: -va, endAngle: va}).addChildTo(this).setAlpha(0.3);
        }

        this.on('enterframe', function() {
            if (this.parentScene.pauseScene) return;
            //画面外の場合は動作停止
            if (!this.onScreen) return;

            var pl = this.parentScene.player;

            //向きの指定
            if (this.vx != 0) {
                if (this.vx > 0) {
                    this.scaleX = 1;
                } else {
                    this.scaleX = -1;
                }
            }

            //ステージクリアの場合は当たり判定無し
            if (this.parentScene.isStageClear) return;

            //気絶中はアニメーションしない
            if (this.isStun) {
                this.isAdvanceAnimation = false;
            } else {
                this.isAdvanceAnimation = true;
            }

            //被ダメージ当たり判定
            if (!this.isMuteki && this.mutekiTime == 0) {
                //プレイヤー攻撃との当たり判定
                if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                    this.damage(pl.attackCollision);
                }
                //プレイヤーショットとの当たり判定
                this.parentScene.playerLayer.children.forEach(function(e) {
                    if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                        e.hit(this);
                        e.remove();
                        this.damage(e);
                    }
                }.bind(this));
            }

            //プレイヤーとの当たり判定
            if (this.isEnableAttackCollision && this.mutekiTime == 0) {
                if (!this.isDead && !pl.isDead && this.power > 0 && this.hitTestElement(pl)) {
                    this.hit();
                    pl.damage(this);
                }
            }

            if (this.stopTime == 0) {
                this.algorithm();
                if (this.chaseTime > 0) this.chaseTime--;
                if (this.turnTime > 0) this.turnTime--;
            }
        });

        this.on('dead', function() {
            //確定ドロップアイテム
            if (this.options.item) {
                var i = this.parentScene.spawnItem(this.x, this.y, {kind: this.options.item});
                i.vy = -5;
                if (this.options.item == "key") {
                    i.isEnemyDrop = false;
                } else {
                    i.isEnemyDrop = true;
                }
                this.remove();
                return;
            }
            //レアアイテムドロップ判定
            var dice = Math.randint(1, 100);
            if (dice <= this.rareDropRate) {
                var i = this.parentScene.spawnItem(this.x, this.y, {kind: this.rareDropItem});
                i.vy = -5;
                i.isEnemyDrop = true;
            } else {
                //通常アイテムドロップ判定
                var dice = Math.randint(1, 100);
                if (dice <= this.dropRate) {
                    var i = this.parentScene.spawnItem(this.x, this.y, {kind: this.dropItem});
                    i.vy = -5;
                    i.isEnemyDrop = true;
                }
            }
            this.remove();
        });
    },

    algorithm: function() {
    },

    damage: function(target) {
        if (this.mutekiTime > 0) return false;
        if (this.isMuteki) return false;

        //気絶キャンセル
        this.isStun = false;

        var dir = 0;
        if (target instanceof qft.PlayerAttack) {
            if (target.scaleX == 1) dir = 0; else dir = 180;
        } else {
            if (this.x > target.x) dir = 0; else dir = 180;
        }

        var power = target.power;
        if (target.isSlash) power *= this.damageSlash;
        if (target.isSting) power *= this.damageSting;
        if (target.isBlow) power *= this.damageBlow;
        if (target.isArrow) power *= this.damageArrow;
        if (target.isFire) power *= this.damageFire;
        if (target.isIce) power *= this.damageIce;
        if (target.isHoly) power *= this.damageHoly;
        if (target.isDark) power *= this.damageDark;
        power = Math.floor(power);
        if (!this.isSuperArmor) this.knockback(power, dir);
        this.mutekiTime = 10;
        this.hp -= power;
        if (this.hp <= 0) {
            this.hp = 0;
            this.parentScene.totalScore += this.point;
            this.parentScene.totalKill++;
            this.flare('dead');
        } else {
            this.flare('damaged', {direction: dir});

            //気絶判定
            var dice = Math.randint(1, 100);
            if (dice <= target.stunPower) this.flare('stun', {power: target.power});
        }
        app.playSE("hit");
        return true;
    },

    //プレイヤーが見える位置にいるのか判定
    isLookPlayer: function() {
        //視力外の場合は見えない
        if (this.getDistancePlayer() > this.eyesight) return false;

        //視野角外の場合は見えない
        if (this.viewAngle != 360) {
            //プレイヤーとの角度（右が360度）
            var angle = Math.floor(this.getPlayerAngle());

            //視界範囲内の判定
            if (this.direction == 0) {
                var va = this.viewAngle / 2;
                if (!(360-va < angle || angle < va)) return false;
            } else {
                var dir = this.direction;
                var va = this.viewAngle / 2;
                if (!(dir-va < angle && angle < dir+va)) return false;
            }
        }

        var result = true;
        var that = this;
        var player = this.parentScene.player;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.type == "ladder" || this.type == "stairs") return;
            //自分とプレイヤー間に遮蔽物（地形当り判定）がある場合見えない
            if (phina.geom.Collision.testRectLine(e, that, player)) {
                result = false;
            }
        });
        return result;
    },

    //自分とプレイヤーを結ぶ直線の角度（弧度法）
    getPlayerAngle: function() {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(this.parentScene.player.x, this.parentScene.player.y);
        var p = p2.sub(p1);
        return p.toDegree();
    },

    //自分とプレイヤーを結ぶ直線の角度（ラジアン）
    getPlayerRadian: function() {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(this.parentScene.player.x, this.parentScene.player.y);
        var p = p2.sub(p1);
        return p.toAngle();
    },

    //体力ゲージ設置
    setupLifeGauge: function() {
        var that = this;
        //体力ゲージ
        var options = {
            width:  32,
            height: 2,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 1,
            gaugeColor: 'lime',
            cornerRadius: 0,
            value: this.hp,
            maxValue: this.hp,
        };
        this.lifeGauge = phina.ui.Gauge(options).addChildTo(this).setPosition(0, 0);
        this.lifeGauge.update = function() {
            this.visible = (that.hp != this.maxValue);
            this.value = that.hp;
            this.rotation = -that.rotation;
            this.scaleX = that.scaleX;

            if (this.dispTime > 150) this.visible = false;
            if (this.beforeValue == this.value) this.dispTime++; else this.dispTime = 0;
            this.beforeValue = this.value;
        };
        this.lifeGauge.dispTime = 0;
    },

    hit: function() {
    },

    //汎用往復アルゴリズム（陸上）
    roundtripAlgorithm_ground: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //テリトリー指定
            if (!look && this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }

        if (this.isOnFloor || this.isJump) {
            this.vx =  this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        }
    },

    //汎用往復アルゴリズム（空中）
    roundtripAlgorithm_flying: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        var chk1 = 1;
        var chk2 = 3;
        if (this.vertical) {
            chk1 = 0;
            chk2 = 2;
        }
        //壁に当たったら折り返す
        var turn = false;
        if (this._collision[chk1].hit || this._collision[chk2].hit) turn = true;

        //テリトリー指定
        if (!look && this.territory) {
            if (this.vertical) {
                //垂直方向チェック
                var ty = this.y - this.firstY;
                if (Math.abs(ty) > this.territory) {
                    if (ty > 0) {
                        this.direction = 270;
                    } else {
                        this.direction = 90;
                    }
                }
            } else {
                //水平方向チェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }
    },

    //汎用追跡アルゴリズム
    chaseAlgorithm: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
                this.firstX = this.x;
                this.firstY = this.y;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) {
            this.chaseTime = 0;
            this.firstX = this.x;
            this.firstY = this.y;
        }

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
            if (this.isJump) this.vx *= 1;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }

        if (this.isOnFloor) {
            //テリトリー指定
            if (this.chaseTime == 0 && this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }

            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        }
                    }

                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+32, this.y+32, 16, 96)) {jumpOk = true; this.vy = -7;}
                            if (this.checkMapCollision2(this.x+32, this.y-32, 16, 96)) {jumpOk = true; this.vy = -10;}
                        } else {
                            if (this.checkMapCollision2(this.x-32, this.y+32, 16, 96)) {jumpOk = true; this.vy = -7;}
                            if (this.checkMapCollision2(this.x-32, this.y-32, 16, 96)) {jumpOk = true; this.vy = -10;}
                        }
                        if (jumpOk) {
                            this.isJump = true;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 45;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                            this.firstX = this.x;
                            this.firstY = this.y;
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                }
            }
        }

        if (this.chaseTime == 30) {
            this.flare('balloon', {pattern: "?"});
            this.firstX = this.x;
            this.firstY = this.y;
        }
    },

    //評価関数
    evaluate: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        //脅威度
        var threat = 0;

        //プレイヤーとの距離により脅威度を加算
        if (dis < 256) threat += 10
        if (dis < 128) threat += 20

        //プレイヤー視認可能状態
        if (look) threat += 30;

        //プレイヤー行動状態
        var playerAction = "";
        if (pl.x == pl.before.x && pl.y == pl.before.y) {
            //プレイヤーは移動していない
        } else {
            //プレイヤー進行方向（右:0 左:180）
            var pldir = 0;
            if (pl.x < pl.before.x) pldir = 180;
            if (this.x < pl.x) {
                if (prdir == 0) {
                    //プレイヤーは近づいている
                } else {
                    //プレイヤーは離れている
                }
            } else {
                if (prdir == 180) {
                    //プレイヤーは近づいている
                } else {
                    //プレイヤーは離れている
                }
            }
        }

        return {
            threat: threat,
            playerAction: playerAction,
        };
    },
});

//敵攻撃判定
phina.define("qft.EnemyAttack", {
    superClass: "phina.display.RectangleShape",

    //攻撃力
    power: 1,

    //有効フラグ
    isActive: true,

    //寿命
    lifeSpan: 15,

    init: function(parentScene, options) {
        options = (options || {}).$safe({width: 32, height: 32});
        this.superInit(options);
        this.parentScene = parentScene;

        this.$extend(options);
        this.time = 0;

        this.on('enterframe', e => {
            this.time++;
            if (this.time > this.lifeSpan) {
                this.remove();
                return;
            }
            if (!this.isActive) return;
            var pl = this.parentScene.player;

            //プレイヤー攻撃と当たった場合はエフェクトを出して無効化
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                this.isActice = false;
                this.bump();
                return;
            }

            //プレイヤーショットとの当たり判定
            this.parentScene.playerLayer.children.forEach(function(e) {
                if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                    e.snap(this);
                    e.isCollision = false;
                }
            }.bind(this));

            //プレイヤーとの当たり判定
            if (!pl.isDead && this.hitTestElement(pl)) {
                pl.damage(this);
            }
        });

        if (DEBUG_COLLISION) {
            phina.display.RectangleShape({width: this.width, height: this.height}).addChildTo(this).setAlpha(0.5);
        }
    },

    //判定同士がぶつかった場合の処理
    bump: function() {
        this.parentScene.spawnEffect(this.x, this.y, {name: "hit"});
        if (this.master) {
            var pl = this.parentScene.player;
            pl.knockback(5, this.master.direction);
            this.master.knockback(5, (this.master.direction + 180) % 360);
            app.playSE("tinkling");
        }
    },
});

/*
 *  item.js
 *  2017/01/04
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アイテムクラス
phina.define("qft.Item", {
    superClass: "qft.Character",

    //識別フラグ
    isItem: true,

    //アイテム種別
    kind: 0,

    //アイテムレベル
    level: 0,

    //捨てアイテム
    throwAway: false,

    //大まかな種別フラグ
    isWeapon: false,
    isEquip: false,
    isFood: false,
    isItem: false,
    isKey: false,

    //敵ドロップアイテムフラグ
    isEnemyDrop: false,

    //アイテム情報
    status: null,

    //反発係数
    rebound: 0.3,

    //アニメーション進行可能フラグ   
    isAdvanceAnimation: false,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 16, height: 16});

        //アイテムレベル
        this.level = 0;
        this.kind = null;
        if (options.properties) {
            this.level = options.properties.level || 0;
            this.kind = options.properties.kind;
        }
        if (options.kind !== undefined) this.kind = options.kind;

        //アイテム種別
        if (this.kind == null) {
            if (options.name == "food") {
                this.kind = ITEM_APPLE + this.level;
            } else {
                var name = "ITEM_"+options.name.toUpperCase();
                this.kind = eval(name);
            }
        } else if (typeof this.kind === "string") {
            var name = "ITEM_"+this.kind.toUpperCase();
            this.kind = eval(name);
        }

        //アイテムステータス取得
        this.$extend(qft.ItemInfo.get(this.kind));

        //アイテムスプライト
        if (this.isWeapon) {
            //武器の場合
            var index = this.kind * 10 + Math.min(this.level, this.maxIndex);
            this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(index);

            if (this.level > 0) {
                //強化レベル表示
                var labelParam = {
                    fill: "white",
                    stroke: "black",
                    strokeWidth: 2,

                    fontFamily: "Orbitron",
                    align: "center",
                    baseline: "middle",
                    fontSize: 10,
                    fontWeight: ''
                };
                phina.display.Label({text: "+"+this.level}.$safe(labelParam)).setPosition(6, 6).addChildTo(this);
            }
        } else {
            this.sprite = phina.display.Sprite("item", 24, 24).addChildTo(this).setFrameIndex(this.kind);
        }

        //寿命
        this.lifeSpan = 150;

        //アクティブフラグ
        if (this.options.active === undefined || this.options.active == true) {
            this.isActive = true;
        } else {
            this.isActive = false;
        }

        this.on('enterframe', e => {
            //プレイヤーとの当たり判定
            var pl = this.parentScene.player;
            if (this.hitTestElement(pl)) {
                if (this.time > 10 && !this.throwAway) {
                    pl.getItem(this);
                    this.remove();
                }
            } else if (this.time > 30 && this.throwAway) this.throwAway = false;

            if (this.isEnemyDrop) {
                if (this.lifeSpan == 0) this.remove();
                if (this.lifeSpan < 30) {
                    if (this.time % 2 == 0) this.visible = !this.visible;
                } else if (this.lifeSpan < 60){
                    if (this.time % 5 == 0) this.visible = !this.visible;
                } else if (this.lifeSpan < 90) {
                    if (this.time % 10 == 0) this.visible = !this.visible;
                }
                this.lifeSpan--;
            }
        });
    },
});

phina.define("qft.ItemInfo", {
    _static: {
        get: function(kind) {
            switch (kind) {
                case "shortsword":
                case ITEM_SHORTSWORD:
                    return {
                        name: "SHORT SWORD",
                        type: "sword",
                        isWeapon: true,
                        isSlash: true,
                        power: 10,
                        stunPower: 1,
                        maxIndex: 0,
                        collision: {
                            width: 14,
                            height: 30
                        }
                    };
                case "longsword":
                case ITEM_LONGSWORD:
                    return {
                        name: "LONG SWORD",
                        type: "sword",
                        isWeapon: true,
                        isSlash: true,
                        power: 15,
                        stunPower: 5,
                        maxIndex: 7,
                        collision: {
                            width: 24,
                            height: 25
                        }
                    };
                case "ax":
                case ITEM_AX:
                    return {
                        name: "AX",
                        type: "ax",
                        isWeapon: true,
                        isSlash: true,
                        isBrow: true,
                        power: 20,
                        stunPower: 20,
                        maxIndex: 4,
                        collision: {
                            width: 14,
                            height: 26
                        }
                    };
                case "spear":
                case ITEM_SPEAR:
                    return {
                        name: "SPEAR",
                        type: "spear",
                        isWeapon: true,
                        isSting: true,
                        power: 10,
                        stunPower: 1,
                        maxIndex: 4,
                        collision: {
                            width: 39,
                            height: 10
                        }
                    };
                case "bow":
                case ITEM_BOW:
                    return {
                        name: "BOW",
                        type: "bow",
                        isWeapon: true,
                        isBrow: true,
                        power: 5,
                        stunPower: 5,
                        maxIndex: 0,
                        collision: {
                            width: 20,
                            height: 10
                        }
                    };
                case "rod":
                case ITEM_ROD:
                    return {
                        name: "MAGIC ROD",
                        type: "rod",
                        isWeapon: true,
                        isBrow: true,
                        isFire: true,
                        power: 5,
                        stunPower: 10,
                        maxIndex: 7,
                        collision: {
                            width: 20,
                            height: 10
                        }
                    };
                case "book":
                case ITEM_BOOK:
                    return {
                        name: "BOOK",
                        type: "book",
                        isWeapon: true,
                        isBrow: true,
                        isHoly: true,
                        power: 10,
                        stunPower: 40,
                        maxIndex: 0,
                        collision: {
                            width: 20,
                            height: 20
                        }
                    };
                case "shield":
                case ITEM_SHIELD:
                    return {
                        name: "SHIELD",
                        type: "equip",
                        isEquip: true,
                        power: 20,
                        point: 1000,
                    };
                case "armor":
                case ITEM_ARMOR:
                    return {
                        name: "ARMOR",
                        type: "equip",
                        isEquip: true,
                        power: 30,
                        point: 5000,
                    };
                case "hat":
                case ITEM_HAT:
                    return {
                        name: "HAT",
                        type: "equip",
                        isEquip: true,
                        power: 10,
                        point: 300,
                    };
                case "boots":
                case ITEM_BOOTS:
                    return {
                        name: "BOOTS",
                        type: "equip",
                        isEquip: true,
                        power: 10,
                        point: 500,
                    };
                case "grove":
                case ITEM_GROVE:
                    return {
                        name: "GROVE",
                        type: "equip",
                        isEquip: true,
                        power: 10,
                        point: 500,
                    };
                case "ring":
                case ITEM_RING:
                    return {
                        name: "RING",
                        type: "equip",
                        isEquip: true,
                        power: 20,
                        point: 3000,
                    };
                case "scroll":
                case ITEM_SCROLL:
                    return {
                        name: "SCROLL",
                        type: "item",
                        isItem: true,
                        point: 1000,
                    };
                case "letter":
                case ITEM_LETTER:
                    return {
                        name: "LETTER",
                        type: "item",
                        isItem: true,
                        point: 100,
                    };
                case "card":
                case ITEM_CARD:
                    return {
                        name: "CARD",
                        type: "item",
                        isItem: true,
                        point: 1000,
                    };
                case "key":
                case ITEM_KEY:
                    return {
                        name: "KEY",
                        type: "key",
                        isKey: true,
                        point: 2000,
                    };
                case "coin":
                case ITEM_COIN:
                    return {
                        name: "COIN",
                        type: "item",
                        isItem: true,
                        point: 500,
                    };
                case "bag":
                case ITEM_BAG:
                    return {
                        name: "BAG",
                        type: "item",
                        isItem: true,
                        point: 1000,
                    };
                case "orb":
                case ITEM_ORB:
                    return {
                        name: "ORB",
                        type: "item",
                        isItem: true,
                        point: 5000,
                    };
                case "stone":
                case ITEM_STONE:
                    return {
                        name: "STONE",
                        type: "item",
                        isItem: true,
                        point: 2000,
                    };
                case "jewel":
                case ITEM_JEWEL:
                    return {
                        name: "JEWEL",
                        type: "item",
                        isItem: true,
                        point: 5000,
                    };
                case "jewelbox":
                case ITEM_JEWELBOX:
                    return {
                        name: "JEWELBOX",
                        type: "item",
                        isItem: true,
                        point: 10000,
                    };
                case "apple":
                case ITEM_APPLE:
                    return {
                        name: "APPLE",
                        type: "food",
                        isFood: true,
                        power: 20,
                    };
                case "harb":
                case ITEM_HARB:
                    return {
                        name: "HARB",
                        type: "food",
                        isFood: true,
                        power: 40,
                    };
                case "meat":
                case ITEM_MEAT:
                    return {
                        name: "MEAT",
                        type: "food",
                        isFood: true,
                        power: 60,
                    };
                case "potion":
                case ITEM_POTION:
                    return {
                        name: "POTION",
                        type: "food",
                        isFood: true,
                        power: 100,
                    };
                default:
                    return {};
            }
        },
    },
});


/*
 *  itembox.js
 *  2017/01/04
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アイテムボックスクラス
phina.define("qft.ItemBox", {
    superClass: "qft.Character",

    //識別フラグ
    isItemBox: true,

    //耐久力
    hp: 1,

    //開いたフラグ
    opened: false,

    //アイテム種別
    kind: 0,

    //アニメーション間隔
    animationInterval: 3,

    //反発係数
    rebound: 0.3,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 26, height: 26}.$safe(options.properties));

        //アイテムボックススプライト
        this.sprite = phina.display.Sprite("itembox", 32, 32)
            .addChildTo(this)
            .setScale(0.8)
            .setFrameIndex(0);
        this.sprite.tweener.setUpdateType('fps');

        this.setAnimation("close");

        //内容物
        this.name = options.name;
        this.kind = options.properties? options.properties.kind: undefined;
        this.level = options.properties? options.properties.level: 0;
    },

    update: function() {
        if (!this.opened) {
            //プレイヤー攻撃（固定）との当たり判定
            var pl = this.parentScene.player;
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                this.damage(pl);
            }
            //プレイヤー攻撃判定との当たり判定
            this.parentScene.playerLayer.children.forEach(function(e) {
                if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                    e.remove();
                    this.damage(e);
                }
            }.bind(this));
        }
        this.visible = true;    //点滅キャンセル
    },

    damage: function(target) {
        if (this.opened) return;
        this.hp -= target.power;
        this.mutekiTime = 10;
        if (this.hp <= 0) {
            this.open();
        }
        if (this.x < target.x) {
            this.sprite.tweener.clear().moveBy(-5, 0, 2).moveBy(5, 0, 2);
        } else {
            this.sprite.tweener.clear().moveBy(5, 0, 2).moveBy(-5, 0, 2);
        }
    },

    open: function() {
        this.isAdvanceAnimation = true;
        this.opened = true;
        this.setAnimation("open");
        switch (this.name) {
            case "empty":
                break;
            case "item":
                this.tweener.clear()
                    .wait(10)
                    .call(function() {
                        var options = {
                            kind: this.kind,
                            properties: {
                                level: this.level
                            }
                        };
                        var i = this.parentScene.spawnItem(this.x, this.y, options);
                        i.vy = -5;
                    }.bind(this));
                break;
            default:
                this.tweener.clear()
                    .wait(10)
                    .call(function() {
                        var options = {
                            name: this.name,
                            properties: {
                                level: this.level
                            }
                        };
                        var i = this.parentScene.spawnItem(this.x, this.y, options);
                        i.vy = -5;
                    }.bind(this));
                break;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        if (this.options.color == "gold") {
            this.frame["close"] = [2];
            this.frame["open"] = [2, 6, 8, "stop"];
        } else if (this.options.color == "red") {
            this.frame["close"] = [1];
            this.frame["open"] = [1, 4, 7, "stop"];
        } else if (this.options.color == "blue") {
            this.frame["close"] = [0];
            this.frame["open"] = [0, 3, 6, "stop"];
        } else {
            this.frame["close"] = [1];
            this.frame["open"] = [1, 4, 7, "stop"];
        }
        this.index = 0;
    },
});

/*
 *  mapobject.js
 *  2017/01/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//チェックアイコン
phina.define("qft.MapObject.CheckIcon", {
    superClass: "qft.Character",

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 3,

    //地形無視
    ignoreCollision: true,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 36, height: 64});
        this.$safe(options);

        //スプライト
        this.sprite = phina.display.Sprite("checkicon", 32, 32).addChildTo(this);
        this.setAnimation("up");
        this.animationInterval = 10;
    },

    update: function(e) {
    },

    setupAnimation: function(options) {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["in"] = [2, 1, 0];
        this.frame["up"] = [5, 4, 3];
        this.frame["down"] = [8, 7, 6];
        this.frame["out"] = [11, 10, 9];
        this.index = 0;
    },
});

//メッセージ表示
phina.define("qft.MapObject.Message", {
    superClass: "phina.display.DisplayElement",

    //オブジェクトID
    id: null,

    //一回のみ表示フラグ
    once: false,

    //表示済みフラグ
    alreadyRead: false,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;
        this.id = options.id;
        this.once = options.properties.once || false;
        this.text = options.properties.text || "TEST";
    },

    update: function(e) {
        //プレイヤーとの当たり判定
        var pl = this.parentScene.player;
        var hit = this.hitTestElement(pl);
        if (hit && !this.alreadyRead) {
            this.parentScene.spawnEventMessage(this.id, this.text);
            this.alreadyRead = true;

            //一回のみの場合はリムーブ
            if (this.once) this.remove();
        }

        //判定を外れたら表示済みフラグを外す
        if (!hit && this.alreadyRead) this.alreadyRead = false;
    },
});

//イベント
phina.define("qft.MapObject.Event", {
    superClass: "phina.display.DisplayElement",

    //オブジェクトID
    id: null,

    //一回のみ表示フラグ
    once: false,

    //実行済みフラグ
    already: false,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;
        this.id = options.id;
        this.once = options.properties.once || false;
        this.properties = options.properties;
    },

    update: function(e) {
        //プレイヤーとの当たり判定
        var pl = this.parentScene.player;
        var hit = this.hitTestElement(pl);
        if (hit && !this.alreadyRead) {
            this.parentScene.spawnEventMessage(this.id, this.text);
            this.already = true;

            //一回のみの場合はリムーブ
            if (this.once) this.remove();
        }

        //判定を外れたら実行済みフラグを外す
        if (!hit && this.already) this.alreadyRead = false;
    },
});

/*
 *  player.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Player", {
    superClass: "qft.Character",

    //識別フラグ
    isPlayer: true,

    //最大ヒットポイント
    hpMax: 100,

    //ヒットポイント
    hp: 100,

    //攻撃力
    power: 10,

    //気絶確率
    stunPower: 1,

    //防御力
    defense: 10,

    //移動速度
    speed: 5,

    //登坂速度
    speedAscend: 4,

    //下押し連続フレーム数
    downFrame: 0,

    //多段ジャンプ可能回数
    numJump: 0,
    numJumpMax: 1,

    //所持装備アイテム
    equip: null,

    //アイテム所持最大数
    maxItem: 10,

    //所持アイテム
    items: null,

    //所持クリア条件キー
    keys: null,

    //操作可能フラグ
    isControl: true,

    //攻撃中フラグ
    isAttack: false,

    //防御中フラグ
    isDefense: false,

    //ドア上フラグ
    isOnDoor: false,

    //ダミー表示スプライト
    dummy: null,

    //影表示フラグ
    isShadow: true,

    //オートパイロット
    isAuto: false,
    autoKey: {
        up: false,
        right: false,
        down: false,
        left: false,
        attack: false,
        jump: false,
    },

    //前フレームの情報
    before: {
        //操作系
        up: false,
        down: false,
        attack: false,
        jump: false,
        change: false,
        isStun: false,
        isOnFloor: false,
        x: 0,
        y: 0,
    },

    //ステージ開始時ステータス
    startStatus: null,

    init: function(parentScene) {
        this.superInit(parentScene, {width: 16, height: 20});
        var that = this;

        //スプライト背後
        this.back = phina.display.DisplayElement().addChildTo(this).setScale(-1, 1);

        //表示用スプライト
        this.sprite = phina.display.Sprite("player1", 32, 32).addChildTo(this).setFrameIndex(0);
        this.sprite.scaleX = -1;

        //武器用スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this.back)
            .setFrameIndex(0)
            .setOrigin(1, 1)
            .setPosition(3, 3);
        this.weapon.alpha = 0;
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.type = "sword";

        //盾
        this.shield = phina.display.Sprite("item", 24, 24)
//            .addChildTo(this)
            .setFrameIndex(7)
            .setPosition(10, 6)
            .setScale(0.8)
            .setVisible(false);

        //攻撃判定用
        this.attackCollision = phina.display.RectangleShape({width: 14, height: 26});
        //当たり判定デバッグ用
        if (DEBUG_COLLISION) {
            this.one('enterframe', e => {
                this.attackCollision.addChildTo(this.parentScene.playerLayer);
                this.attackCollision.alpha = 0.3;
            });
            this.on('removed', e => {
                this.attackCollision.remove();
            });
        }

        //プレイヤー情報の初期化
        this.reset();

        //はしご判定用
        this.ladderCollision = phina.display.RectangleShape({width: 16, height: 20});

        //初期アニメーション設定
        this.setAnimation("walk");
        this.beforeAnimation = "";

        //死亡時コールバック
        this.on('dead', function(e) {
            this.parentScene.flare('gameover');
        });

        //ステージ開始時ステータス
        this.saveStatus();

        //最後に床上にいた場所を保存
        this.lastOnFloorX = 0;
        this.lastOnFloorY = 0;
    },

    update: function(app) {
        if (this.parentScene.pauseScene) return;

        //オブジェクトレイヤー接触判定
        this.isOnDoor = null;
        this.parentScene.objLayer.children.forEach(function(e) {
            //扉判定
            if (e instanceof qft.MapObject.Door || e instanceof qft.MapObject.Gate) {
                if (e.hitTestElement(this)) {
                    this.isOnDoor = e;
                    return;
                }
            }
        }.bind(this));

        //死亡時は何も出来ない
        if (this.isDead) {
            //マップ外落下
            if (this.isDrop) {
                this.hp = 0;
                this.setAnimation("drop");
            }
            return;
        }

//        this.shield.setVisible(false);
//        this.isDefense = false;

        //プレイヤー操作
        var ct = app.controller;
        //バーチャルパッド情報取得
        var vp = app.virtualPad;
        if (vp.getKey("up")) ct.up = true;
        if (vp.getKey("right")) ct.right = true;
        if (vp.getKey("down")) ct.down = true;
        if (vp.getKey("left")) ct.left = true;
        if (vp.getKey("Z")) ct.attack = true;
        if (vp.getKey("X")) ct.jump = true;

        //オートパイロット
        if (this.isAuto) {
            ct = this.autoKey;
        }

        if (!this.isControl) ct = {};
        if (this.stopTime == 0) {
            //左移動
            if (ct.left && !ct.down) {
                if (!this.isJump && !this.isAttack && !this.isCatchLadder) this.setAnimation("walk");
                //はしご掴み状態で左に壁がある場合は不可
                var c = this._collision[3];
                if (!(this.isCatchLadder && this.checkMapCollision2(c.x+6, c.y, c.width, c.height))) {
                    this.scaleX = -1;
                    this.vx = -this.speed;
                }
            }
            //右移動
            if (ct.right && !ct.down) {
                if (!this.isJump && !this.isAttack && !this.isCatchLadder) this.setAnimation("walk");
                //はしご掴み状態で右に壁がある場合は不可
                var c = this._collision[1];
                if (!(this.isCatchLadder && this.checkMapCollision2(c.x-6, c.y, c.width, c.height))) {
                    this.scaleX = 1;
                    this.vx = this.speed;
                }
            }

            //頭上足元はしご検知
            var headLadder = this.checkHeadLadder();
            var footLadder = this.checkFootLadder();

            //はしご掴み状態で操作分岐
            if (this.isCatchLadder) {
                if (ct.up) {
                    this.vx = 0;
                    this.vy = -this.speedAscend;
                    var c = this._collision[0];
                    if (!headLadder && this.checkMapCollision2(c.x, c.y-6, c.width, c.height)) {
                        this.vy = 0;
                    }
                }
                if (ct.down) {
                    this.vx = 0;
                    this.vy = this.speedAscend;
                }
            } else {
                //ジャンプボタンのみ
                if (ct.jump && !ct.up) {
                    //ジャンプ二段目以降
                    if (this.isJump && this.numJump < this.numJumpMax && this.vy > -5) {
                        this.vy = -11;
                        this.numJump++;
                    }
                    //ジャンプ
                    var chk = this.checkMapCollision2(this.x, this.y-16, 5, 3);
                    if (!this.isJump && this.isOnFloor && !chk) {
                        this.setAnimation("jump");
                        this.isJump = true;
                        this.vy = -11;
                        this.numJump = 1;
                    }
                }
                //上キー押下
                if (ct.up) {
                    //ジャンプ二段目以降
                    if (this.isJump && this.numJump < this.numJumpMax && this.vy > -5) {
                        this.vy = -11;
                        this.numJump++;
                    }
                    //ジャンプ
                    var chk = this.checkMapCollision2(this.x, this.y-16, 5, 3);
                    if (!this.isJump && this.isOnFloor && !this.isOnLadder && !chk) {
                        this.setAnimation("jump");
                        this.isJump = true;
                        this.vy = -11;
                        this.numJump = 1;
                    }
                    //はしごを昇る（階段は接地時のみ）
                    if (this.isOnLadder && !this.isOnStairs || this.isOnFloor && this.isOnStairs) {
                        this.setAnimation("up");
                        this.vx = 0;
                        this.vy = 0;
                        this.isCatchLadder = true;
                        this.throughFloor = null;
                    }
                    //扉に入る（接地時＆左右キーオフ時のみ）
                    if (!ct.left && !ct.right && this.isOnFloor && this.isOnDoor && !this.isOnDoor.isLock && !this.isOnDoor.already) {
                        this.vx = 0;
                        this.vy = 0;
                        this.isOnDoor.flare('enterdoor');
                        this.isOnDoor.already = false;
                    }
                }
                //下キー押下
                if (ct.down) {
                    //はしごを降りる
                    if (footLadder) {
                        this.setAnimation("up");
                        this.vx = 0;
                        this.vy = 0;
                        this.isCatchLadder = true;
                        this.throughFloor = null;
                    }
                    //床スルー
                    if (this.downFrame > 6 && !this.jump && !footLadder) {
                        if (this.isOnFloor && !this.throughFloor) {
                            var floor = this.checkMapCollision2(this.x, this.y+16, 5, 5);
                            if (floor && floor[0].enableThrough) this.throughFloor = floor[0];
                        }
                    }
                    //盾を構える
                    if (!this.isAttack) {
//                        this.shield.setVisible(true);
//                        this.isDefense = true;
//                        this.setAnimation("defense");
                    }
                }
            }

        }

        //はしごから外れたら梯子掴み状態キャンセル
        if (this.isCatchLadder) {
            if (!this.isOnLadder && !ct.down || this.isOnLadder && !footLadder && !ct.up) {
                this.isCatchLadder = false;
            }
        }

        //攻撃
        if (!this.isAttack) {
            if (this.isOnFloor) {
                if (this.nowAnimation != "damage" && !this.isDefense) this.setAnimation("walk");
            } else if (this.isCatchLadder) {
                if (ct.up) {
                    this.setAnimation("up");
                } else if (ct.down) {
                    if (this.isOnStairs) {
                        this.setAnimation("down");
                    } else {
                        this.setAnimation("up");
                    }
                }
            } else {
                if (!this.isStun && !this.isDead) this.setAnimation("jump");
            }
            if (ct.attack && !this.before.attack && this.stopTime == 0 && !(this.isCatchLadder && this.isOnLadder)) {
                this.isCatchLadder = false;
                this.setAnimation("attack");
                this.weaponAttack();
            }

            //武器の変更
            if (ct.change && !this.before.change && this.equip.switchOk) {
                this.switchWeapon();
            }
        }

        //気絶状態
        if (this.isStun) {
            this.setAnimation("stun");

            //梯子掴みキャンセル
            this.isCatchLadder = false;

            //レバガチャで気絶復帰を早める
            if (ct.left && !ct.before.left ||
                ct.right && !ct.before.right ||
                ct.up && !ct.before.up ||
                ct.down && !ct.before.down) this.stopTime -= 2;
        } else if (this.before.isStun) {
            //気絶復帰したらアニメーションを標準に
            this.setAnimation("stand");
        }

        //死亡状態
        if (this.isDead) {
            this.setAnimation("dead");
            this.isCatchLadder = false;
        }

        //アニメーション変更を検知
        if (this.nowAnimation != this.beforeAnimation) {
            this.time = 0;
            this.isAdvanceAnimation = true;
            this.animationInterval = 6;
            if (this.nowAnimation == "attack") this.animationInterval = 2;
            if (this.nowAnimation == "defense") this.animationInterval = 1;
        } else {
            //歩行アニメーションの場合は移動している時のみ進める
            if (this.nowAnimation == "walk" && !ct.left && !ct.right) {
                this.isAdvanceAnimation = false;
            } else {
                this.isAdvanceAnimation = true;
            }
            if (this.nowAnimation == "up" || this.nowAnimation == "down") {
                if (ct.up || ct.down || ct.left || ct.right) {
                    this.isAdvanceAnimation = true;
                } else {
                    this.isAdvanceAnimation = false;
                }
            }
        }

        //攻撃判定追従
        this.attackCollision.x = this.x + this.scaleX * 12;
        this.attackCollision.y = this.y;

        //コントローラ他情報保存
        this.before.up = ct.up;
        this.before.down = ct.down;
        this.before.attack = ct.attack;
        this.before.jump = ct.up || ct.jump;
        this.before.change = ct.change;
        this.before.isStun = this.isStun;
        this.before.inOnFloor = this.isOnFloor;
        this.before.x = this.x;
        this.before.y = this.y;

        //ダウンキー連続押下フレームカウント
        if (this.isOnFloor && !this.isCatchLadder && ct.down && !ct.right && !ct.left && !ct.up && !ct.attack) {
            this.downFrame++;
        } else {
            this.downFrame = 0;
        }

        //接地時座標保存
        if (this.isOnFloor && this._collision[2].hit.type != "movefloor") {
            this.lastOnFloorX = this.x;
            this.lastOnFloorY = this.y;
        }
    },

    //プレイヤー情報リセット
    reset: function() {
        //移動情報
        this.vx = 0;
        this.vy = 0;

        //ステータス
        this.hp = this.hpMax;

        //各種フラグ
        this.isJump = false;
        this.isDead = false;
        this.isCatchLadder = false;
        this.isDrop = false;
        this.isOnFloor = false;
        this.isAdvanceAnimation = true;
        this.ignoreCollision = false;

        //経過時間系
        this.mutekiTime = 0;
        this.stopTime = 0;
        this.downFrame = 0;
        this.time = 0;

        //アニメーション
        this.setAnimation("walk");
        this.beforeAnimation = "";
        this.animationInterval = 6;

        //所持装備
        this.equip = {
            using: 0,         //現在使用中（weaponsのindex）
            weapons: [0],     //所持リスト（最大３）
            level: [0],       //武器レベル
            switchOk: true,   //変更可能フラグ
        };

        //武器セット
        this.setWeapon(this.equip.weapons[this.equip.using]);

        //所持アイテム
        this.items = [];

        //所持クリア条件キー
        this.keys = [];

        //操作可能フラグ
        this.isControl = true;

        //多段ジャンプ最大回数
        this.numJumpMax = 0;

        //ダミースプライト除去
        if (this.dummy) {
            this.dummy.remove();
            this.dummy = null;
        }

        return this;
    },

    //プレイヤー情報コンティニュー用リセット
    continueReset: function() {
        //移動情報
        this.vx = 0;
        this.vy = 0;

        //ステータス
        this.hp = this.hpMax;

        //各種フラグ
        this.isJump = false;
        this.isDead = false;
        this.isCatchLadder = false;
        this.isDrop = false;
        this.isOnFloor = false;
        this.isAdvanceAnimation = true;
        this.ignoreCollision = false;

        //経過時間系
        this.mutekiTime = 0;
        this.stopTime = 0;
        this.downFrame = 0;
        this.time = 0;

        //アニメーション
        this.setAnimation("walk");
        this.beforeAnimation = "";
        this.animationInterval = 6;

        //操作可能フラグ
        this.isControl = true;

        //多段ジャンプ最大回数
        this.numJumpMax = 0;

        //ダミースプライト除去
        if (this.dummy) {
            this.dummy.remove();
            this.dummy = null;
        }
        this.sprite.visible = true;

        return this;
    },

    //ダメージ処理
    damage: function(target) {
        if (this.mutekiTime > 0) return false;
        if (target.power == 0) return false;
        if (this.isDead) return false;
        if (this.isMuteki) return false;

        //気絶キャンセル
        this.isStun = false;

        var dir = 0;
        if (this.x < target.x) dir = 180;
        if (!this.isCatchLadder) this.knockback(target.power, dir);

        this.hp -= target.power;
        this.isCatchLadder = false;
        app.playSE("damage");

        if (this.hp <= 0) {
            this.dead();
        } else {
            this.mutekiTime = 60;
            this.stopTime = 15;
            if (this.nowAnimation != "jump") this.setAnimation("damage");

            //気絶判定
            var dice = Math.randint(1, 100);
            if (dice <= target.stunPower) {
                this.flare('stun', {power: 10});
                this.setAnimation("stun");
            }
        }
        return true;
    },

    //死亡時処理
    dead: function() {
        this.hp = 0;
        this.isDead = true;
        this.isCatchLadder = false;
        this.vx = 0;
        this.vy = -6;
        var tw = phina.accessory.Tweener().attachTo(this).setUpdateType('fps');
        tw.clear()
            .wait(60)
            .call(function(){
                this.flare('dead');
                tw.remove();
            }.bind(this));

        //ダミースプライト追加
        this.sprite.visible = false;
        this.dummy = qft.PlayerDummy("player1").addChildTo(this).setAnimation("dead");
    },

    //アイテム取得
    getItem: function(item) {
        //武器
        if (item.isWeapon) {
            //既に持っている武器かチェック
            var index = this.equip.weapons.findIndex(function(e, i, a) {
                return e == item.kind;
            });
            if (index == null || index == -1) {
                //持って無い武器だった場合
                if (this.equip.weapons.length < 3) {
                    //リストに追加
                    this.equip.weapons.push(item.kind);
                    this.equip.level.push(item.level);
                } else {
                    //現在使用武器の手前の武器を捨てる
                    var dropIndex = this.equip.using == 0? 2: this.equip.using - 1;
                    var options = {
                        properties: {
                            kind: this.equip.weapons[dropIndex],
                            level: this.equip.level[dropIndex],
                        },
                    };
                    var drop = this.parentScene.spawnItem(this.x, this.y, options);
                    drop.friction = 0.8;
                    drop.vx = 0 * -this.scaleX;
                    drop.vy = -5;
                    drop.throwAway = true;
                    this.equip.weapons[dropIndex] = item.kind;
                    this.equip.level[dropIndex] = item.level;
                }
            } else {
                //所持武器を拾ったらその武器のレベルが上がる
                this.equip.level[index]++;
                var id = this.equip.weapons[this.equip.using];
                var lv = this.equip.level[this.equip.using];
                this.setWeapon(id, lv);
            }
            app.playSE("getitem");
        }
        //装備品
        if (item.isEquip) {
            this.hpMax += (item.power || 0);
            this.hp += (item.power || 0);
            if (this.hpMax > 200) this.hpMax = 200;
            if (this.hp > this.hpMax) this.hp = this.hpMax;
            this.parentScene.totalScore += (item.point || 0);
            app.playSE("getitem");
        }
        //食べ物
        if (item.isFood) {
            //ステージ進度によって回復量が増加
            var power = item.power;
            if (this.parentScene.stageNumber > 4) power *= 1.5;
            this.hp += power;
            app.playSE("recovery");
            if (this.hp > this.hpMax) this.hp = this.hpMax;
            this.parentScene.totalScore += (item.point || 0);
        }
        //鍵
        if (item.isKey) {
            this.keys.push(item);
            app.playSE("getkeyitem");
            this.parentScene.flare('getkey', {key: item});
            this.parentScene.totalScore += (item.point || 0);
        }
        //得点アイテム
        if (item.isItem) {
            this.parentScene.totalScore += (item.point || 0);
            app.playSE("getitem");
        }
        return this;
    },

    //使用武器の変更
    switchWeapon: function() {
        //手持ちの武器が一個の場合は何もしない
        if (this.equip.weapons.length < 2) return;

        this.equip.switchOk = false;

        var rot = 120;
        if (this.equip.weapons.length == 2 && this.equip.using == 1) rot = 240;
        this.parentScene.playerWeapon.tweener.clear()
            .by({rotation: rot}, 300)
            .call(function() {
                this.equip.switchOk = true;
            }.bind(this));

        //現在使用武器設定
        this.equip.using = (this.equip.using + 1) % this.equip.weapons.length;
        var id = this.equip.weapons[this.equip.using];
        var lv = this.equip.level[this.equip.using];
        this.setWeapon(id, lv);

        app.playSE("select");
    },

    //武器変更
    setWeapon: function(kind, level) {
        kind = kind || 0;
        level = level || 0;

        //属性初期化
        this.attackCollision.$extend({
            isSlash: false,
            isSting: false,
            isBlow: false,
            isArrow: false,
            isFire: false,
            isIce: false,
            stunPower: 1,
        });

        //アイテム情報取得
        var spec = qft.ItemInfo.get(kind);
        this.attackCollision.$extend(spec);
        this.attackCollision.power += level * (spec.levelBonus || 2);

        switch (kind) {
            case 0:
                //ショートソード
                level = 0;
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
            case 1:
                //ロングソード
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
            case 2:
                //斧
                this.frame["attack"] = [ 44, 44, 44, 43, 43, 43, 42, 42, 42, 41, 41, 41, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
            case 3:
                //槍
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(0, 0);
                break;
            case 4:
                //弓
                level = 0;
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(0, 0);
                break;
            case 5:
                //魔法の杖
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(0, 0);
                break;
            case 6:
                //魔導書
                this.frame["attack"] = [ 44, 44, 44, 43, 43, 43, 42, 42, 42, 41, 41, 41, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
        }

        //武器画像設定
        var index = kind * 10 + Math.min(level, spec.maxIndex);
        this.weapon.setFrameIndex(index);

        return this;
    },

    //装備武器により攻撃モーションを変える
    weaponAttack: function() {
        var kind = this.equip.weapons[this.equip.using];
        var level = this.equip.level[this.equip.using];
        this.isAttack = true;
        var that = this;
        switch (kind) {
            case 0:
                //ショートソード
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 200, alpha: 1.0})
                    .to({rotation: 360}, 5)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 1:
                //ロングソード
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 200, alpha: 1.0})
                    .to({rotation: 360}, 6)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 2:
                //斧
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 400, alpha: 1.0})
                    .to({rotation: 270}, 8)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 3:
                //槍
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: -45, alpha: 1.0})
                    .by({x: -10}, 2)
                    .by({x: 10}, 2)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 4:
                //弓
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: -45, alpha: 1.0})
                    .by({x: 7}, 3)
                    .by({x: -7}, 3)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                    var arrowPower = 5 + level * 2;
                    var arrow = qft.PlayerAttack(this.parentScene, {width: 15, height: 10, power: arrowPower, type: "arrow"})
                        .addChildTo(this.parentScene.playerLayer)
                        .setScale(this.scaleX, 1)
                        .setPosition(this.x, this.y);
                    arrow.tweener.setUpdateType('fps').clear()
                        .by({x: (150 + level * 5) * this.scaleX}, 7)
                        .call(function() {
                            this.remove();
                        }.bind(arrow));
                break;
            case 5:
                //魔法の杖
                app.playSE("bomb");
                this.weapon.tweener.clear()
                    .set({rotation: 200, alpha: 1.0})
                    .to({rotation: 360}, 8)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                var magicPower = 15 + level * 2;
                for (var i = 0; i < 6; i++) {
                    var magic = qft.PlayerAttack(this.parentScene, {width: 15, height: 10, index: 30, power: magicPower, type: "flame"})
                        .addChildTo(this.parentScene.playerLayer)
                        .setScale(this.scaleX, 1);
                    magic.rad = (90 - i * 30).toRadian();
                    magic.isCollision = false;
                    magic.visible = false;
                    magic.tweener.setUpdateType('fps').clear()
                        .wait(i)
                        .call(function() {
                            this.isCollision = true;
                            this.visible = true;
                            var mx = Math.cos(this.rad) * that.scaleX;
                            var my = Math.sin(this.rad);
                            this.setPosition(that.x + 32 * mx, that.y + 32 * my);
                        }.bind(magic))
                        .wait(8)
                        .call(function() {
                            this.remove();
                        }.bind(magic));
                }
                break;
            case 6:
                //魔導書
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 400, alpha: 1.0})
                    .to({rotation: 270}, 8)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
        }
        return this;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [36, "stop"];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
        this.frame["defense"] = [ 41, 42, 43, 44, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["drop"] = [18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.frame["clear"] = [24, 25, 26];
        this.frame["stun"] = [ 18, 19, 20];
        this.index = 0;
        return this;
    },

    //当たり判定用エレメントの位置再セット
    resetCollisionPosition: function() {
        var w = Math.floor(this.width/2)+6;
        var h = Math.floor(this.height/2)+6;
        this._collision[0].setPosition(this.x, this.y - h);
        this._collision[1].setPosition(this.x + w, this.y - 5);
        this._collision[2].setPosition(this.x, this.y + h);
        this._collision[3].setPosition(this.x - w, this.y - 5);
        this.ladderCollision.setPosition(this.x, this.y);
        return this;
    },

    //頭上はしごチェック
    checkHeadLadder: function() {
        var h = Math.floor(this.height/2)+10;
        var c = phina.display.DisplayElement({width: 16, height: 2}).setPosition(this.x, this.y-h);
        var ret = null;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.hitTestElement(c)) {
                if (e.type == "ladder" || e.type == "stairs") ret = e;
            }
        }.bind(this));
        return ret;
    },

    //足下はしごチェック
    checkFootLadder: function() {
        var h = Math.floor(this.height/2)+10;
        var c = phina.display.DisplayElement({width: 16, height: 2}).setPosition(this.x, this.y+h);
        var ret = null;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.hitTestElement(c)) {
                if (e.type == "ladder" || e.type == "stairs") ret = e;
            }
        }.bind(this));
        return ret;
    },

    //現在ステータス保存
    saveStatus: function() {
        //所持武器、アイテム等ステータスの取得
        var eq = this.equip;
        var equip = {
            using: 0,
            weapons: eq.weapons.concat(),
            level: eq.level.concat(),
            switchOk: true,
        };
        var items = this.items.concat();
        var numJumpMax = this.numJumpMax;

        this.startStatus = {
            hpMax: this.hpMax,
            hp: this.hp,
            power: this.power,
            defense: this.defense,
            equip: equip,
            items: items,
            numJumpMax: numJumpMax,
        };
    },

    //ステータス復元
    restoreStatus: function() {
        var ss = this.startStatus;
        this.hpMax = ss.hpMax;
        this.hp = ss.hp;
        this.power = ss.power;
        this.defense = ss.defense;
        this.equip = {
            using: 0,
            weapons: ss.equip.weapons.concat(),
            level: ss.equip.level.concat(),
            switchOk: true,
        }
        if (ss.items) {
            this.items = ss.items.concat();
        } else {
            this.item = [];
        }
        this.numJumpMax = ss.numJumpMax;

        var id = this.equip.weapons[this.equip.using];
        var lv = this.equip.level[this.equip.using];
        this.setWeapon(id, lv);
    },
});

//プレイヤー攻撃判定
phina.define("qft.PlayerAttack", {
    superClass: "phina.display.DisplayElement",

    //攻撃力
    power: 1,

    //当たり判定発生フラグ
    isCollision: true,

    //属性
    isSlash: false,
    isSting: false,
    isBlow: false,
    isArrow: false,
    isFire: false,
    isIce: false,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;

        this.type = options.type || "arrow";
        this.power = options.power || 0;
        this.time = 0;
        this.index = 0;

        //表示スプライト
        switch (this.type) {
            case "arrow":
                this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(1);
                this.frame = [1];
                this.isArrow = true;
                this.isSting = true;
                this.stunPower = 10;
                break;
            case "fireball":
                this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(9);
                this.frame = [9, 10, 11, 10];
                this.isFire = true;
                break;
            case "masakari":
                this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(20);
                this.frame = [20];
                this.isSlash = true;
                this.isBrow = true;
                this.stunPower = 50;
                break;
            case "dagger":
                this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(20);
                this.sprite.rotation = 135;
                this.frame = [0];
                this.isSting = true;
                this.stunPower = 1;
                break;
            case "flame":
                this.sprite = phina.display.Sprite("effect", 48, 48)
                    .addChildTo(this)
                    .setFrameTrimming(0, 192, 192, 96)
                    .setScale(0.5);
                this.frame = [0, 1, 2, 3, 4, 5, 6, 7, 8];
                this.isFire = true;
                this.stunPower = 1;
                break;
        }

        if (DEBUG_COLLISION) {
            phina.display.RectangleShape({width: this.width, height: this.height}).addChildTo(this).setAlpha(0.5);
        }
    },

    update: function(app) {
        if (!this.isCollision || this.type == "explode") return;

        if (this.time % 3 == 0) {
            this.sprite.setFrameIndex(this.frame[this.index]);
            this.index = (this.index + 1) % this.frame.length;
        }
        if (this.type == "flame") return;

        //地形接触判定
        var that = this;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.type == "ladder" || e.type == "stairs") return;
            if (this.hitTestElement(e)) {
                this.isCollision = false;
                switch (this.type) {
                    case "arrow":
                        this.stick(e);
                        break;
                    case "fireball":
                        this.explode(e);
                        break;
                }
            }
        }.bind(this));

        this.time++;
    },

    //ヒット後処理
    hit: function(target) {
        switch (this.type) {
            case "fireball":
                this.explode(target);
                break;
        }
    },

    //刺さる
    stick: function(e) {
        //効果音
        switch (this.type) {
            case "arrow":
                app.playSE("arrowstick");
                break;
            case "masakari":
                break;
        }

        if (this.scaleX == 1) {
            this.x = e.left;
        } else {
            this.x = e.right;
        }
        this.tweener.clear()
            .wait(30)
            .call(function() {
                this.remove();
            }.bind(this));
    },

    //弾かれる
    snap: function(e) {
        //効果音
        app.playSE("tinkling");
        this.tweener.clear()
            .by({y: -92, rotation: 700}, 15, "easeOutQuad")
            .call(function() {
                this.remove();
            }.bind(this));
    },

    //爆発
    explode: function(e) {
        this.parentScene.spawnEffect(this.x, this.y);
        app.playSE("bomb");
        this.remove();
    },
});

//プレイヤーダミースプライト
phina.define("qft.PlayerDummy", {
    superClass: "phina.display.Sprite",

    init: function(assetName) {
        this.superInit(assetName, 32, 32);
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["walk_stop"] = [ 3,  4,  5,  4, "stop"];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["up_stop"] =   [10, "stop"];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["clear"] = [24, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.index = 0;

        this.nowAnimation = "stand";
        this.animation = true;

        this.bx = 0;
        this.by = 0;
        this.time = 0;

        //影の追加
        var that = this;
        var sc = 16 / 24;
        if (sc < 1) sc += 0.2;
        this.shadowSprite = phina.display.Sprite("shadow", 24, 8)
            .addChildTo(this)
            .setAlpha(0.5)
            .setScale(sc, 1.0)
            .setPosition(0, 16);
    },

    update: function() {
        if (this.animation && this.time % 6 == 0) {
            this.index = (this.index+1) % this.frame[this.nowAnimation].length;
            if (this.frame[this.nowAnimation][this.index] == "stop") this.index--;
            this.frameIndex = this.frame[this.nowAnimation][this.index];
        }

        if (this.x < this.bx) this.scaleX = 1;
        if (this.x > this.bx) this.scaleX = -1;
        this.bx = this.x;
        this.by = this.y;

        this.time++;
    },

    setAnimation: function(animName) {
        if (!this.frame[animName]) return;
        if (animName == this.nowAnimation) return;
        this.nowAnimation = animName;
        this.index = -1;
        return this;
    },
});

//プレイヤー現在使用武器表示
phina.define("qft.PlayerWeapon", {
    superClass: "phina.display.DisplayElement",

    init: function(player) {
        this.superInit();
        this.player = player;

        var that = this;
        this.base = phina.display.DisplayElement().addChildTo(this);
        this.base.update = function() {
            this.rotation = -that.rotation;
        }
        var param = {
            width: 25,
            height: 25,
            fill: "rgba(0,0,0,0.0)",
            stroke: "yellow",
            strokeWidth: 2,
            backgroundColor: 'transparent',
        };
        //使用中武器
        phina.display.RectangleShape(param).addChildTo(this.base).setPosition(0, -18);
        //捨てちゃう武器
        this.dropFrame = phina.display.RectangleShape({stroke: "red"}.$safe(param))
            .addChildTo(this.base)
            .setPosition(14, 10)
            .setVisible(false);
        this.dropFrame.update = function() {
            if (that.player.equip.weapons.length < 3) {
                this.visible = false;
            } else {
                this.visible = true;
            }
        }

        //武器リスト（３つ）
        this.weapons = [];
        var rad = 0;
        var rad_1 = (Math.PI*2) / 3;
        (3).times(function(i) {
            var x =  Math.sin(rad)*18;
            var y = -Math.cos(rad)*18;
            rad -= rad_1;
            this.weapons[i] = phina.display.Sprite("weapons", 24, 24)
                .addChildTo(this)
                .setPosition(x, y);
            this.weapons[i].index = i;
            this.weapons[i].update = function() {
                this.rotation = -that.rotation;
                var weapons = that.player.equip.weapons;
                if (this.index < weapons.length) {
                    var kind = that.player.equip.weapons[this.index];
                    var level = that.player.equip.level[this.index];
                    var spec = qft.ItemInfo.get(kind);
                    var index = kind * 10 + Math.min(level, spec.maxIndex);
                    this.setFrameIndex(index);
                    this.visible = true;
                } else {
                    this.visible = false;
                }
            }
            var labelParam = {
                fill: "white",
                stroke: "black",
                strokeWidth: 2,

                fontFamily: "Orbitron",
                align: "center",
                baseline: "middle",
                fontSize: 10,
                fontWeight: ''
            };
            //強化レベル表示
            this.weapons[i].level = phina.display.Label({text: ""}.$safe(labelParam)).setPosition(6, 6).addChildTo(this.weapons[i]);
            this.weapons[i].level.index = i;
            this.weapons[i].level.update = function() {
                var level = that.player.equip.level[this.index];
                if (level != 0) {
                    this.text = "+"+level;
                } else {
                    this.text = "";
                }
            }
        }.bind(this));
    },

    clear: function() {
    },
});

/*
 *  enemy.adventurer.js
 *  2017/08/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//冒険者
phina.define("qft.Enemy.Adventurer", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 360,

    //得点
    point: 10000,

    //アニメーション間隔
    animationInterval: 6,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 24, height: 20});
        this.superInit(parentScene, options);

        //武器用スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setOrigin(1, 1)
            .setPosition(-3, 3);
        this.weapon.alpha = 0;
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.kind = "sword";
        this.weapon.scaleX = -1;
        this.weapon.scaleY = -1;

        //表示用スプライト
        if (this.black) {
            this.sprite = phina.display.Sprite("player1Black", 32, 32).addChildTo(this);
        } else {
            this.sprite = phina.display.Sprite("player1", 32, 32).addChildTo(this);
        }
        this.sprite.scaleX = -1;

        this.hp += this.level * 5;
        this.power += this.level * 5;
        this.point += this.level * 1000;

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;
        this.attackInterval = 30;

        //行動フェーズ
        this.phase = "wander";

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        //待機状態
        if (this.phase == "wait") {
            this.isAdvanceAnimation = false;
            if (look) {
                this.flare('balloon', {pattern: "!", lifeSpan: 15});
                this.phase = "approach";
            }
        } else {
            this.isAdvanceAnimation = true;
        }

        //徘徊
        if (this.phase == "wander") {
            if (look) {
                this.flare('balloon', {pattern: "!", lifeSpan: 15});
                this.phase = "approach";
            } else {
                this.roundtripAlgorithm_ground(distance, look);
            }
        }

        //プレイヤー発見後接近
        if (this.phase == "approach") {
            if (this.x < player.x) {
                this.vx = 3;
            } else {
                this.vx = -3;
            }
            if (!look) {
                this.phase = "lost";
                this.chaseTime = 150;
            }
            if (distance < 52 && this.attackInterval == 0) this.phase = "attack";
        }

        //プレイヤー見失い
        if (this.phase == "lost") {
            this.chaseTime--;
            if (this.x < player.x) {
                this.vx = 3;
            } else {
                this.vx = -3;
            }
            if (this.chaseTime < 0) {
                this.chaseTime = 0;
                this.flare('balloon', {pattern: "..."});
                this.phase = "wait";
            }
        }

        //攻撃
        if (this.phase == "attack") {
            this.attack();
            this.attackInterval = 30;
        } else if (this.phase != "attacking") {
            if (this.isOnFloor) {
                this.setAnimation("walk");
            } else {
                this.setAnimation("jump");
            }
        }

        this.attackInterval--;
        if (this.attackInterval < 0) this.attackInterval = 0;
    },

    //攻撃
    attack: function() {
        this.animationInterval = 2;
        this.setAnimation("attack");
        this.phase = "attacking";

        //攻撃判定
        var that = this;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 24, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        app.playSE("attack");
        this.weapon.tweener.clear()
            .set({rotation: 200, alpha: 1.0})
            .to({rotation: 360}, 6)
            .fadeOut(1)
            .call(() => {
                this.animationInterval = 6;
                this.setAnimation("walk");
                this.phase = "approach";
                atk.remove();
            });
    },

    //飛び道具弾き
    guard: function() {
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [36, "stop"];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
        this.frame["defense"] = [ 41, 42, 43, 44, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["drop"] = [18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.frame["clear"] = [24, 25, 26];
        this.frame["stun"] = [ 18, 19, 20];
        this.index = 0;
        return this;
    },
});

/*
 *  enemy.archdemon.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アークデーモン
phina.define("qft.Enemy.ArchDemon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 30,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 180,

    //アニメーション間隔
    animationInterval: 15,

    //得点
    point: 5000,

    //飛行モード
    flying: false,
    flyingPhase: 0, //行動フェーズ
    flyingX: 0,     //飛行開始Ｘ座標

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 35, height: 30});
        if (options.size) {
            var size = options.size || 1;
            options.width = size * 35;
            options.height = size * 30;
        }
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(216*2, 640*2, 72*2, 128*2).setPosition(0, -10);
        if (options.size) {
            var size = options.size || 1;
            this.sprite.setScale(size).setPosition(0, size * -12);
        }

        this.hp += this.level * 5;
        this.power += this.level * 5;
        this.point += this.level * 1000;

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.phase = 0;
        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤー情報
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //進行方向決定
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }

        //プレイヤー発見後一定時間追跡する
        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.vx *= 3;
            this.flare('balloon', {pattern: "!"});
        }
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }
        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this._collision[3].hit) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //プレイヤーへの攻撃
            if (look && !this.isAttack && !this.isJump) {
                if (dis > 128) {
                    this.firebreath();
                } else {
                    this.exploding();
                }
            }
        }

        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    //火球を吐く
    fireball: function() {
        this.isAttack = true;
        this.stopTime = 30;
        this.sprite.tweener.clear()
            .wait(10)
            .call(() => {
                this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, rotation: this.getPlayerAngle(), power: 30});
            })
            .wait(45)
            .call(() => {
                this.isAttack = false;
            });
    },

    //炎を吐く
    firebreath: function() {
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite.tweener.clear()
            .wait(10)
            .wait(60)
            .call(() => {
                this.isAttack = false;
            });

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var b = this.parentScene.spawnEnemy(this.x + 24 * this.scaleX, this.y-8, "Bullet", {type: "explode", power: 10, rotation: this.getPlayerAngle(), velocity: 5});
                b.setScale(0.1);
                b.tweener.clear().setUpdateType('fps').to({scaleX: 1, scaleY: 1}, 10);
                ct++;
                if (ct == 6 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(5)
            .setLoop(true);
    },

    //爆発
    exploding: function() {
        app.playSE("bomb");
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite.tweener.clear()
            .fadeIn(15)
            .wait(45)
            .call(() => {
                this.isAttack = false;
            });

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var rad = rot.toRadian();
                var ex = Math.cos(rad) * 16;
                var ey = Math.sin(rad) * 16;
                this.parentScene.spawnEnemy(this.x + ex, this.y + ey, "Bullet", {type: "explode", power: 10, rotation: rot, velocity: 3});
                rot += 22.5;
                ct++;
                if (ct == 16 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(1)
            .setLoop(true);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.archknight.js
 *  2017/05/18
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アークナイト
phina.define("qft.Enemy.ArchKnight", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 70,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 90,

    //得点
    point: 5000,

    //アニメーション間隔
    animationInterval: 10,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_LONGSWORD,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 25, height: 40});
        this.superInit(parentScene, options);

        //武器スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setOrigin(1, 1)
            .setPosition(-6, 3)
            .setScale(-1.5, 1.5)
            .setRotation(430);
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.kind = "sword";
        if (options.weapon == "ax") {
            this.weapon.setFrameIndex(20 + Math.min(9, this.level));
            this.weapon.kind = "ax";
        }
        if (options.weapon == "spear") {
            this.weapon.setFrameIndex(30 + Math.min(9, this.level));
            this.weapon.kind = "spear";
        }

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(216*2, 128*2, 72*2, 128*2);
        this.sprite.setPosition(0, -5);

        this.hp += this.level * 5;
        this.power += this.level * 5;
        this.point += this.level * 1000;

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 0.5;
            } else {
                this.vx = -0.5;
            }
            if (this.isJump) this.vx *= 2;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }
        if (this.chaseTime > 0) this.vx *= 3;

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+40, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+40, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                    this.turnWait = 1;
                }
            }

            //攻撃
            if (look && !this.isJump && dis < 64 && !this.isAttack) {
                this.attack();
            }

            //プレイヤー飛び道具を弾く
            if (look && !this.isAttack) {
                var that = this;
                //プレイヤーショットとの距離判定
                this.parentScene.playerLayer.children.forEach(function(e) {
                    if (e instanceof qft.PlayerAttack && e.isCollision && e.type == "arrow") {
                        if (that.getDistance(e) < 64) that.guard();
                    }
                }.bind(this));
            }
        }
        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    attack: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 48, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        if (this.weapon.kind == "sword" || this.weapon.kind == "ax") {
            atk.isActive = false;
            this.weapon.tweener.clear()
                .to({rotation: 270}, 2)
                .call(function() {
                    atk.isActive = true;
                    that.isSuperArmor = true;
                    that.vx = 16 * that.scaleX;
                })
                .to({rotation: 430}, 6)
                .call(function() {
                    that.isAttack = false;
                    that.isSuperArmor = false;
                    atk.remove();
                });
        } else if (this.weapon.kind == "spear") {
            atk.width = 32;
            atk.height = 8;
            atk.setPosition(this.x + this.scaleX * 1, this.y);
            atk.tweener.clear().by({x: 20 * this.scaleX}, 10).by({x: -20 * this.scaleX}, 10);
            atk.isActive = false;

            this.weapon.tweener.clear()
                .set({rotation: 45, x: -20})
                .wait(6)
                .call(function() {
                    atk.isActive = true;
                    that.isSuperArmor = true;
                    that.vx = 32 * that.scaleX;
                })
                .by({x: 20}, 3)
                .by({x: -30}, 5)
                .call(function() {
                    that.isAttack = false;
                    that.isSuperArmor = false;
                    atk.remove();
                })
                .set({rotation: 430, x: -2});
        }
        this.isAttack = true;
        this.stopTime = 30;
    },

    //飛び道具弾き
    guard: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 48, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        this.isMuteki = true;
        this.weapon.tweener.clear()
            .set({rotation: 430})
            .to({rotation: 300}, 3)
            .call(function() {
                that.vx = 4 * that.scaleX;
            })
            .to({rotation: 430}, 3)
            .call(function() {
                that.isAttack = false;
                that.isMuteki = false;
                atk.remove();
            });
        this.isAttack = true;
        this.stopTime = Math.min(0, 6 - this.level);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.frame["turn"] = [6, "walk"];
        this.index = 0;
    },
});

/*
 *  enemy.archmage.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アークメイジ
phina.define("qft.Enemy.ArchMage", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 360,

    //得点
    point: 800,

    //重力加速度
    gravity: 0,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var lv = Math.min(this.level, 3);
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming((lv % 2) * 144 + 72, Math.floor(lv / 2) * 128, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.speed = 1;
        this.phase = 0;
        this.isAttack = false;

        //接近戦経過時間
        this.nearCount = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        //これ以上進めない場合は折り返す
        if (this._collision[1].hit) {
            this.direction = 180;
        } else if (this._collision[3].hit) {
            this.direction = 0;
        }

        //テリトリー指定
        if (this.territory) {
            //水平方向のみチェック
            var tx = this.x - this.firstX;
            if (Math.abs(tx) > this.territory) {
                if (tx > 0) {
                    this.direction = 180;
                } else {
                    this.direction = 0;
                }
            }
        }

        //通常フェーズでプレイヤーを発見したら警戒フェーズに移る
        if (this.phase == 0 && look) {
            this.flare('balloon', {pattern: "!"});
            this.phase = 1;
            this.speed = 0;
        }

        //プレイヤーが離れたら通常フェーズ
        if (this.phase != 0) {
            if (distance > 192 || !look) {
                this.flare('balloonerace');
                this.phase = 0;
                this.speed = 1;
                for (var i = 0; i < this.dagger.length; i++) {
                    this.dagger[i].phase = 0;
                }
            }
        }

        //通常
        if (this.phase == 0) {
            this.vx = this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        } else {
            if (this.x < player.x) {
                this.scaleX = 1;
                this.direction = 0;
            } else {
                this.scaleX = -1;
                this.direction = 180;
            }
        }

        //警戒
        if (this.phase == 1) {
            if (this.balloon == null) this.flare('balloon', {pattern: "...", animationInterval : 15});
            if (distance < 192) this.phase = 2;
        }

        //攻撃
        if (this.phase == 2) {
            this.flare('balloonerace');
            for (var i = 0; i < this.dagger.length; i++) {
                this.dagger[i].isAttack = true;
            }
            if (distance < 92) this.phase = 3;
        }
        if (this.phase == 3) {
            this.phase++;
            this.flare('balloonerace');
            for (var i = 0; i < this.dagger.length; i++) {
                this.dagger[i].phase = 10;
            }
        }
        if (this.phase == 4 && this.time % 90 == 0) {
            this.isAttack = true;
        }

        if (this.isAttack) {
            this.isAttack = false;
            if (this.phase == 2) {
                var b = this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true});
                b.rotation = this.getPlayerAngle() + Math.randint(-30, 30);
            }
            if (this.phase == 4) {
                for (var i = 0; i < 4; i++) {
                    var b = this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true});
                    b.rotation = this.getPlayerAngle() + Math.randint(-60, 60);
                }
            }
        }

        if (distance < 96) {
            this.nearCount++;
            if (this.nearCount > 90) {
                this.teleport();
                this.nearCount = 0;
            }
        } else {
            this.nearCount -= 10;
            if (this.nearCount < 0) this.nearCount = 0;
        }
    },

    //テレポート
    teleport: function() {
        for (var i = 0; i < this.dagger.length; i++) {
            this.dagger[i].phase = 10;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },

    firstFrame: function() {
        //マジックダガー装備
        this.dagger = [];
        this.dagger[0] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX:  16, offsetY: -16, order: 0, level: this.level});
        this.dagger[1] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX: -16, offsetY: -16, order: 1, level: this.level});
        if (this.level > 2) this.dagger[2] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX: -32, offsetY: -8, order: 2, level: this.level});
        if (this.level > 3) this.dagger[3] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX:  32, offsetY: -8, order: 3, level: this.level});
    },
});

/*
 *  enemy.babydemon.js
 *  2017/01/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ベビーデーモン
phina.define("qft.Enemy.BabyDemon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 40,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 5,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 0, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 100;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //汎用追跡アルゴリズム
        this.chaseAlgorithm(dis, look);

        //プレイヤーが近くにいたら攻撃
        if (this.isOnFloor && look && !this.isJump && dis < 64) {
            //飛びかかる
            this.isJump = true;
            this.vy = -6;
            var pl = this.parentScene.player;
            if (this.x > pl.x) {
                this.direction = 180;
            } else {
                this.direction = 0;
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look || this.chaseTime > 0) {
            this.vx *= 4;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.bird.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//鳥
phina.define("qft.Enemy.Bird", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 30,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 60,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0,

    //得点
    point: 200,

    //属性ダメージ倍率
    damageArrow: 5,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18});
        options = options.$safe(this.defaultOptions);
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72, 0, 72, 128).setScale(1 + capLevel * 0.1);

        this.hp += this.level * 5;
        this.power += this.level * 1;
        this.point += this.level * 100;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.isVertical = this.options.vertical || false;
        this.direction = this.options.direction || this.isVertical? 90: 0;
        this.speed = this.options.speed || 2;
        this.returnTime = this.options.returnTime || 120;
        this.bombInterval = this.options.bombInterval || 90;

        this.on('damaged', e => {
            if (this.isVertical) return;
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //チェックする壁決定
        var chk = 0;
        if (!this.isVertical) chk = 1;

        //壁に当たるか一定時間経過で折り返し
        if (this._collision[chk].hit || this._collision[chk+2].hit || this.returnTime < 0) {
            this.direction = (this.direction + 180) % 360;
            this.returnTime = this.options.returnTime;
        }

        //プレイヤーをみつけたら加速
        if (this.isLookPlayer()) {
            this.speed = 4;
            this.returnTime -= 2;
        } else {
            this.speed = 2;
            this.returnTime--;
        }

        //移動
        var rad = this.direction.toRadian();
        this.vx = Math.cos(rad) * this.speed;
        this.vy = Math.sin(rad) * this.speed;

        //落し物
        if (this.onScreen && this.time % this.bombInterval == 0) {
            this.parentScene.spawnEnemy(this.x, this.y, "BirdBomb", {});
        }

        //向きの指定
        if (this.vx != 0) {
            if (this.vx > 0) {
                this.scaleX = 1;
            } else {
                this.scaleX = -1;
            }
        }
        if (this.isVertical && this.getDistancePlayer() < 256) {
            if (this.x < this.parentScene.player.x) this.scaleX = 1; else this.scaleX = -1;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["walk"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

//鳥の落し物
phina.define("qft.Enemy.BirdBomb", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //防御力
    deffence: 10,

    //攻撃力
    power: 5,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 5, height: 5});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(72);

        this.setAnimation("normal");
        this.animationInterval = 6;
    },

    update: function() {
        if (this.isOnFloor) this.remove();
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [72, 73, 74, 73];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.bullet.js
 *  2017/01/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.Bullet", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //寿命
    lifespan: 75,

    //速度
    velocity: 2,

    //加速度
    accel: 1.02,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 1.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 0,

    //爆発フラグ
    explode: false,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        this.type = options.type;
        this.power = options.power || this.power;
        this.rotation = options.rotation || 0;
        this.velocity = options.velocity || this.velocity;
        this.lifeSpan = options.lifeSpan || this.lifeSpan;

        //表示用スプライト
        switch (options.type) {
            case "explode":
                this.sprite = phina.display.Sprite("effect", 48, 48).addChildTo(this).setFrameTrimming(0, 192, 192, 96);
                this.animationInterval = 3;
                this.explode = false;
                this.ignoreCollision = true;
                this.isMuteki = true;
                this.pattern = "explode";
                break;
            default:
                this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(9);
                this.animationInterval = 3;
                this.explode = options.explode || true;
                this.pattern = options.pattern || "pattern1";
                break;
        }

        this.setAnimation(this.pattern);

        this.on('dead', function() {
            if (this.explode) {
                this.parentScene.spawnEffect(this.x, this.y);
                app.playSE("bomb");
            }
        });
    },

    algorithm: function() {
        var rad = this.rotation.toRadian();
        this.vx = Math.cos(rad) * this.velocity;
        this.vy = Math.sin(rad) * this.velocity;
        this.velocity *= this.accel;
        if (this.vx > 1) this.sprite.scaleX = 1; else this.sprite.scaleX = -1;
        if (this.time > this.lifespan) this.remove();

        if (!this.ignoreCollision) {
            if (this._collision[0].hit ||
                this._collision[1].hit ||
                this._collision[2].hit ||
                this._collision[3].hit) this.flare('dead');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [9, 10, 11, 10];
        this.frame["pattern2"] = [15, 16, 17, 16];
        this.frame["explode"] = [0, 1, 2, 3, 4, 5, 6, 7, "remove"];
        this.index = 0;
    },

    hit: function() {
        if (this.type == "explode") return;

        this.remove();
        this.flare('dead');
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        this.vx = 0;
        this.vy = -10;
        return this;
    },
});

/*
 *  enemy.death.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//死神
phina.define("qft.Enemy.Death", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 30,

    //重力加速度
    gravity: 0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //気絶確率
    stunPower: 30,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 180,

    //地形無視
    ignoreCollision: true,

    //ノックバックキャンセル
    isSuperArmor: true,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_STONE,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_STONE,

    //属性ダメージ倍率
    damageFire: 2.0,
    damageIce: 0.8,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 128, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 1;
        this.point += this.level * 100;

        this.setAnimation("move");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.phase = 0;
        this.speed = 1;

        //行動パターン
        this.pattern = options.pattern || "linear";
        this.moveLength = options.length || 48;
        this.degree = 0;
        this.isVertical = false;

        //被ダメージ時処理
        this.on('damaged', e => {
            this.phase = 0;
        });

        this.tweener2 = phina.accessory.Tweener().attachTo(this);
    },

    algorithm: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        var rad = this.degree.toRadian();
        if (this.pattern == "linear") {
            if (this.isVertical) {
                this.vy = Math.cos(rad) * 2;
            } else {
                this.vx = Math.cos(rad) * 2;
            }
        }
        this.degree += 2;

        //徘徊モードの場合は適当に攻撃
        if (this.time % 90 == 0) this.isAttack = true;

        //攻撃
        if (this.isAttack) {
            this.isAttack = false;
            var b = this.parentScene.spawnEnemy(this.x, this.y, "DeathFlame", {pattern: 0});
            b.vy = -2;
            b.vx = 2 * this.scaleX;
            this.actionWait = 120;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["move"] = [3, 4, 5, 4];
        this.frame["up"] = [6, 7, 6, 8];
        this.frame["down"] =   [0, 1, 0, 2];
        this.frame["attack"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

//炎
phina.define("qft.Enemy.DeathFlame", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //攻撃力
    power: 10,

    //重力加速度
    gravity: 0.1,

    //横移動減衰率
    friction: 0.98,

    //気絶確率
    stunPower: 20,

    //地形無視
    ignoreCollision: false,

    //無敵フラグ
    isMuteki: true,

    //攻撃当たり判定有効フラグ
    isAttackCollision: true,

    //寿命
    lifeSpan: 120,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 20});
        this.superInit(parentScene, options);

        this.pattern = options.pattern || 0;
        this.lifeSpan = options.lifeSpan || 120;
        this.power += this.level * 5;

        this.setupAnimation(this.pattern);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 0, 144, 128).setFrameIndex(15 + this.pattern);

        this.setAnimation("appear");
        this.animationInterval = 3;

        this.direction = 0;
    },

    algorithm: function() {
        if (this.lifeSpan == 0) this.remove();
        if (this.lifeSpan < 30) {
            if (this.time % 2 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 60){
            if (this.time % 5 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 90) {
            if (this.time % 10 == 0) this.visible = !this.visible;
        }
        this.lifeSpan--;
    },

    setupAnimation: function(index) {
        index = index || 0;
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["appear"] = [15+index, 9+index,  3+index, 21+index, "normal"];
        this.frame["normal"] = [ 0+index, 6+index, 12+index, 18+index];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.demon.js
 *  2017/01/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

//デーモン
phina.define("qft.Enemy.Demon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 30,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 90,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 5,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(Math.min(this.level, 4) * 72, 640, 72, 128)
            .setScale(1.5)
            .setPosition(0, -8);

        this.hp += this.level * 10;
        this.power += this.level * 3;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 16) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 16) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //プレイヤーが近くにいたら攻撃
            if (look && !this.isJump && !this.isAttack) {
                if (dis > 96) {
                    //火を吐く
                    this.fireball();
                } else {
                    //飛びかかる
                    this.isJump = true;
                    this.vy = -6;
                    var pl = this.parentScene.player;
                    if (this.x > pl.x) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look) {
            this.vx *= 3;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (dis < 256) {
                this.flare('balloon', {pattern: "?"});
            } else {
                this.flare('balloonerace');
            }
        }
    },

    //火球を吐く
    fireball: function() {
        this.isAttack = true;
        this.stopTime = 30;
        var tw = phina.accessory.Tweener().attachTo(this).setUpdateType('fps')
            .call(() => {
                this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, power: 10 + this.level * 5, rotation: this.getPlayerAngle()});
            })
            .wait(30)
            .call(() => {
                tw.remove();
                this.isAttack = false;
            });
    },

    //火を吐く
    flaming: function() {
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite2.tweener.clear()
            .fadeIn(15)
            .wait(60)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(15);

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var b = this.parentScene.spawnEnemy(this.x + 24 * this.scaleX, this.y-8, "Bullet", {type: "explode", power: 10, rotation: this.getPlayerAngle(), velocity: 5});
                b.setScale(0.1);
                b.tweener.clear().setUpdateType('fps').to({scaleX: 1, scaleY: 1}, 10);
                ct++;
                if (ct == 6 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(5)
            .setLoop(true);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.devil.js
 *  2017/04/25
 *  @auther minimo  
 *  This Program is MIT license.
 */

//悪魔
phina.define("qft.Enemy.Devil", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 30,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 360,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 800,

    //属性ダメージ倍率
    damageArrow: 5,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_BAG,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_STONE,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18}).$safe(this.defaultOptions);
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(72, 0, 72, 128);

        this.hp += this.level * 10;
        this.power += this.level * 5;
        this.point += this.level * 100;

        this.setAnimation("stand");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.isVertical = this.options.vertical || false;
        this.direction = this.options.direction || this.isVertical? 90: 0;
        this.speed = this.options.speed || 2;
        this.returnTime = this.options.returnTime || 120;
        this.attackInterval = this.options.attackInterval || 90;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤー情報
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤーが近くにいたら寄っていく
        if (look && dis > 32) {
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(pl.x, pl.y);
            var p = p2.sub(p1);
            p.normalize();
            this.vx = p.x * (1 + this.level * 0.2);
            this.vy = p.y * (1 + this.level * 0.2);

            //プレイヤーの方向を向く
            var angle = this.getPlayerAngle();
            if (angle > 315 || angle < 45) this.setAnimation('horizon');
            if ( 45 < angle && angle < 135) this.setAnimation('down');
            if (135 < angle && angle < 225) this.setAnimation('horizon');
            if (225 < angle && angle < 315) this.setAnimation('down');

            //一定以上近づいたら攻撃
            if (dis < 96) this.isAttack = true;

            this.flare('balloon', {pattern: "!"});
        } else {
            this.vx = 0;
            this.vy = 0;
            this.setAnimation("stand");
            this.flare('balloonerace');
        }

        if (this.vx > 0) {
            this.scaleX = 1;
        } else {
            this.scaleX = -1;
        }

        if (this.isAttack) {
            this.attack();
        }
    },

    attack: function() {
        this.stopTime = 30;
        this.isAttack = false;
        this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, power: 10 + this.level * 5, rotation: this.getPlayerAngle()});
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [6, 7, 8, 7];
        this.frame["up"] = [0, 1, 2, 1];
        this.frame["down"] = [5, 6, 7, 6];
        this.frame["horizon"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

/*
 *  enemy.explode.js
 *  2017/07/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.Explode", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0.98,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 0,

    //無敵フラグ
    isMuteki: true,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("effect", 48, 48)
            .addChildTo(this)
            .setFrameTrimming(0, 192, 192, 96);
        this.animationInterval = 3;

        this.power = options.power || this.power;

        this.pattern = options.pattern || "pattern1";
        this.setAnimation(this.pattern);
        this.animationInterval = 3;
    },

    algorithm: function() {
        if (this.index == 8) this.remove();
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [0, 1, 2, 3, 4, 5, 6, 7, 8, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.firebird.js
 *  2016/03/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//鳥
phina.define("qft.Enemy.FireBird", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 90,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0,

    //得点
    point: 300,

    //属性ダメージ倍率
    damageArrow: 5,
    damageFire: 0.5,
    damageIce: 2,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16, offsetCollisionX: -6});
        options = options.$safe(this.defaultOptions);
        this.superInit(parentScene, options);


        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(288, 0, 72, 128);

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.isVertical = this.options.vertical || false;
        this.direction = this.options.direction || this.isVertical? 90: 0;
        this.speed = this.options.speed || 2;
        this.returnTime = this.options.returnTime || 120;
        this.bombInterval = this.options.bombInterval || 90;
        this.attackInterval = 0;
        this.attackCount = 99;
        this.isAttack = false;

        this.on('damaged', e => {
            if (this.isVertical) return;
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
        this.on('dead', function() {
            this.parentScene.spawnEffect(this.x, this.y);
            app.playSE("bomb");
        });
    },

    algorithm: function() {
        //チェックする壁決定
        var chk = 1;
        if (this.isVertical) chk = 0;

        //壁に当たるか一定時間経過で折り返し
        if (this._collision[chk].hit || this._collision[chk+2].hit || this.returnTime < 0) {
            this.direction = (this.direction + 180) % 360;
            this.returnTime = this.options.returnTime;
        }
        //移動
        var rad = this.direction.toRadian();
        this.vx = Math.cos(rad) * this.speed;
        this.vy = Math.sin(rad) * this.speed;
        this.returnTime--;
 
        //プレイヤーを見つけたら攻撃
        var lookPlayer = this.isLookPlayer();
        if (lookPlayer) {
            if (this.attackInterval == 0) {
                var b = this.parentScene.spawnEnemy(this.x, this.y+6, "Bullet", {pattern: "pattern2", explode: true, velocity: 3});
                b.rotation = this.getPlayerAngle();
                this.attackInterval = 90;
            }
        } else {
                this.attackInterval = 60;
        }

        //落し物
        if (this.onScreen && this.time % this.bombInterval == 0) {
            this.parentScene.spawnEnemy(this.x, this.y, "FireBirdBomb", {});
        }

        //向きの指定
        if (this.vx != 0) {
            if (this.vx > 0) {
                this.scaleX = 1;
            } else {
                this.scaleX = -1;
            }
        }
        if (this.isVertical && this.getDistancePlayer() < 256) {
            if (this.x < this.parentScene.player.x) this.scaleX = 1; else this.scaleX = -1;
        }

        if (this.attackInterval > 0) this.attackInterval--;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["walk"] = [3, 4, 5, 4];
        this.index = 0;
    },

    attack: function() {
    },
});

//鳥の落し物
phina.define("qft.Enemy.FireBirdBomb", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //防御力
    deffence: 10,

    //攻撃力
    power: 5,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 5, height: 5});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(72);

        this.setAnimation("normal");
        this.animationInterval = 6;
    },

    update: function() {
        if (this.isOnFloor) {
            this.parentScene.spawnEffect(this.x, this.y, {name: "explode_ground"});
            if (this.onScreen) app.playSE("bomb");
            this.remove();
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [72, 73, 74, 73];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.flame.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//炎
phina.define("qft.Enemy.Flame", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //攻撃力
    power: 10,

    //無敵フラグ
    isMuteki: true,

    //攻撃当たり判定有効フラグ
    isAttackCollision: true,

    //寿命
    lifeSpan: 120,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 20});
        this.superInit(parentScene, options);

        this.pattern = options.pattern || 0;
        this.lifeSpan = options.lifeSpan || 120;
        this.power += this.level * 5;

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(Math.min(this.pattern, 2) * 24 + 72, 0, 24, 128);

        this.setAnimation("normal");
        this.animationInterval = 3;

        this.direction = 0;
    },

    algorithm: function() {
        if (this.lifeSpan == 0) this.remove();
        if (this.lifeSpan < 30) {
            if (this.time % 2 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 60){
            if (this.time % 5 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 90) {
            if (this.time % 10 == 0) this.visible = !this.visible;
        }
        this.lifeSpan--;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [0, 1, 2, 3];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.garuda.js
 *  2017/07/07
 *  @auther minimo  
 *  This Program is MIT license.
 */

//怪鳥
phina.define("qft.Enemy.Garuda", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 80,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 60,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0,

    //スーパーアーマー
    isSuperArmor: true,

    //得点
    point: 3000,

    //属性ダメージ倍率
    damageArrow: 5,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18});
        options = options.$safe(this.defaultOptions);
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01x2", 48, 64).addChildTo(this);
        this.sprite.setFrameTrimming(0, 0, 72 * 2, 128 * 2).setScale(1.5).setPosition(0, 16);

        this.sprite2 = phina.display.Sprite("monster01x2", 48, 64).addChildTo(this);
        this.sprite2.setFrameTrimming(288 * 2, 0, 72 * 2, 128 * 2).setScale(1.5).setPosition(0, 16).setAlpha(0);
        var that = this;
        this.sprite2.update = function() {
            this.frameIndex = that.sprite.frameIndex;
        }

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.moveTime = 0;
    },

    algorithm: function() {
        if (this.path) {
            var p = this.getPathPosition(this.moveTime);
            this.setPosition(p.x, p.y);
        }
        this.moveTime += 2;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["up"] =   [0, 1, 2, 1];
        this.frame["down"] = [6, 7, 8, 7];
        this.frame["walk"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

/*
 *  enemy.greaterdemon.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//グレーターデーモン
phina.define("qft.Enemy.GreaterDemon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 120,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 180,

    //アニメーション間隔
    animationInterval: 15,

    //得点
    point: 5000,

    //飛行モード
    flying: false,
    flyingPhase: 0, //行動フェーズ
    flyingX: 0,     //飛行開始Ｘ座標

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 35, height: 30});
        if (options.size) {
            var size = options.size || 1;
            options.width = size * 35;
            options.height = size * 30;
        }
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(72*2*2, 640*2, 72*2, 128*2).setPosition(0, -10);
        if (options.size) {
            var size = options.size || 1;
            this.sprite.setScale(size).setPosition(0, size * -12);
        }

        this.sprite2 = phina.display.Sprite("monster01x2", 24*2, 32*2).addChildTo(this).setAlpha(0);
        this.sprite2.setFrameTrimming(288*2, 640*2, 72*2, 128*2).setPosition(0, -10);
        this.sprite2.tweener.setUpdateType('fps');
        if (options.size) {
            var size = options.size || 1;
            this.sprite2.setScale(size).setPosition(0, size * -12);
        }
        var that = this;
        this.sprite2.update = function() {
            this.frameIndex = that.sprite.frameIndex;
        }

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.phase = 0;
        this.direction = 0;
        this.isAttack = false;
        this.isAttackCancel = false;
        this.chaseTime = 0;
        this.turnTime = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
            this.isAttackCancel = true;
        });
    },

    algorithm: function() {
        //プレイヤー情報
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //進行方向決定
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }

        //プレイヤー発見後一定時間追跡する
        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.vx *= 3;
            this.flare('balloon', {pattern: "!"});
        }
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }
        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this._collision[3].hit) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //プレイヤーへの攻撃
            if (look && !this.isAttack && !this.isJump) {
                if (dis > 128) {
                    this.firebreath();
                } else {
                    this.exploding();
                }
            }
        }

        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    //火球を吐く
    fireball: function() {
        this.isAttack = true;
        this.stopTime = 30;
        this.sprite2.tweener.clear()
            .fadeIn(10)
            .call(() => {
                this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, rotation: this.getPlayerAngle(), power: 30});
            })
            .wait(45)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(10);
    },

    //炎を吐く
    firebreath: function() {
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite2.tweener.clear()
            .fadeIn(15)
            .wait(60)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(15);

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var b = this.parentScene.spawnEnemy(this.x + 24 * this.scaleX, this.y-8, "Bullet", {type: "explode", power: 10, rotation: this.getPlayerAngle(), velocity: 5});
                b.setScale(0.1);
                b.tweener.clear().setUpdateType('fps').to({scaleX: 1, scaleY: 1}, 10);
                ct++;
                if (ct == 6 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(5)
            .setLoop(true);
    },

    //爆発
    exploding: function() {
        app.playSE("bomb");
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite2.tweener.clear()
            .fadeIn(15)
            .wait(45)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(15);

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var rad = rot.toRadian();
                var ex = Math.cos(rad) * 16;
                var ey = Math.sin(rad) * 16;
                this.parentScene.spawnEnemy(this.x + ex, this.y + ey, "Bullet", {type: "explode", power: 10, rotation: rot, velocity: 3});
                rot += 22.5;
                ct++;
                if (ct == 16 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(1)
            .setLoop(true);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.intelligentsword.js
 *  2017/07/19
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.IntelligentSword", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 1.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 360,

    //得点
    point: 2000,

    //アニメーションフラグ
    isAnimation: false,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_LONGSWORD,

    //レアドロップ率（％）
    rareDropRate: 1,
    rareDropItem: ITEM_LONGSWORD,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 24});
        this.superInit(parentScene, options);

        this.sprite = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setRotation(215);
        this.sprite.tweener.clear()
            .to({y: -2}, 1000, "easeInOutSine")
            .to({y: 4}, 1000, "easeInOutSine")
            .setLoop(true);

        this.type = options.type;
        this.power = options.power || this.power;
        this.rotation = options.rotation || 0;
        this.velocity = options.velocity || this.velocity;

        this.phase = 0;

        this.setupLifeGauge();
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.phase == 0) {
            if (look && dis < 64) {
                this.phase++;
            }
        }

        if (this.phase == 2) {
            var ang = this.getAngle(pl);
            this.rotation = ang + 30;
        }

        if (look) {
            this.flare('balloon', {pattern: "!", lifeSpan: 15, y: 0});
        } else {
            this.flare('balloonerace');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [0];
        this.index = 0;
    },

    snap: function(target) {
        //効果音
        app.playSE("tinkling");
        this.tweener.clear()
            .by({y: -64, rotation: 700}, 15, "easeOutQuad")
            .call(function() {
                this.phase = 10;
            }.bind(this));
    },
});

/*
 *  enemy.knight.js
 *  2017/05/06
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ナイト
phina.define("qft.Enemy.Knight", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 70,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //速度
    speed: 1,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 90,

    //得点
    point: 1000,

    //アイテムドロップ率（％）
    dropRate: 7,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_LONGSWORD,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //武器スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setOrigin(1, 1)
            .setPosition(-4, 2)
            .setScale(-1, 1)
            .setRotation(430);
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.kind = "sword";
        if (options.weapon == "ax") {
            this.weapon.setFrameIndex(20 + Math.min(9, this.level));
            this.weapon.kind = "ax";
        }
        if (options.weapon == "spear") {
            this.weapon.setFrameIndex(30 + Math.min(9, this.level));
            this.weapon.kind = "spear";
        }

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(144, 128, 72, 128);
        this.sprite.setPosition(0, -5).setScale(1.3);

        this.hp += this.level * 10;
        this.power += this.level * 10;
        this.point += this.level * 500;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
            if (this.isJump) this.vx *= 1;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }
        if (this.chaseTime > 0) this.vx *= 3;

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                }
            }

            //攻撃
            if (look && !this.isJump && dis < 64 && !this.isAttack) {
                this.attack();
            }

            //プレイヤー飛び道具を弾く（レベル４以上）
            if (this.level > 3 && look && !this.isAttack) {
                var that = this;
                //プレイヤーショットとの距離判定
                this.parentScene.playerLayer.children.forEach(function(e) {
                    if (e instanceof qft.PlayerAttack && e.isCollision && e.type == "arrow") {
                        if (that.getDistance(e) < 64) that.guard();
                    }
                }.bind(this));
            }
        }

        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    attack: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 24, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        if (this.weapon.kind == "sword" || this.weapon.kind == "ax") {
            atk.isActive = false;
            this.weapon.tweener.clear()
                .to({rotation: 270}, 3)
                .wait(3)
                .call(function() {
                    atk.isActive = true;
                    that.vx = 16 * that.scaleX;
                })
                .to({rotation: 430}, 6)
                .call(function() {
                    that.isAttack = false;
                    atk.remove();
                });
        } else if (this.weapon.kind == "spear") {
            atk.width = 32;
            atk.height = 8;
            atk.setPosition(this.x + this.scaleX * 1, this.y);
            atk.tweener.clear().by({x: 20 * this.scaleX}, 10).by({x: -20 * this.scaleX}, 10);
            atk.isActive = false;

            this.weapon.tweener.clear()
                .set({rotation: 45, x: -20})
                .wait(2)
                .call(function() {
                    atk.isActive = true;
                    that.isSuperArmor = true;
                    that.vx = 32 * that.scaleX;
                })
                .by({x: 20}, 3)
                .by({x: -30}, 5)
                .call(function() {
                    that.isAttack = false;
                    that.isSuperArmor = false;
                    atk.remove();
                })
                .set({rotation: 430, x: -2});
        }
        this.isAttack = true;
        this.stopTime = 30;
    },

    //飛び道具弾き
    guard: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 24, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        this.isMuteki = true;
        this.weapon.tweener.clear()
            .set({rotation: 430})
            .to({rotation: 300}, 3)
            .to({rotation: 430}, 3)
            .call(function() {
                that.isAttack = false;
                that.isMuteki = false;
                atk.remove();
            });
        this.isAttack = true;
        this.stopTime = 6;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.mage.js
 *  2017/04/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

//魔術師
phina.define("qft.Enemy.Mage", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 160,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var lv = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming((lv % 2) * 144, Math.floor(lv / 2) * 128, 72, 128);
        this.sprite.setScale(1.2).setPosition(0, -2);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 200;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.phase = 0;
        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        if (this.isOnFloor) {
            //プレイヤーが近くにいたら距離を取る
            if (this.phase == 0 && look && !this.isJump && distance < 128) {
                this.flare('balloon', {pattern: "!"});
                this.phase = 1;
                this.speed = 3;
            }

            //逃げるフェーズ
            if (this.phase == 1) {
                if (distance < 128) {
                    if (this.x < player.x) this.direction = 180; else this.direction = 0;
                    this.speed = 3;
                } else {
                    if (this.x < player.x) this.direction = 0; else this.direction = 180;
                    this.speed = 0;
                    this.phase = 2;
                }
                var lv = Math.min(this.level, 4);
                this.sprite.setFrameTrimming((lv % 2) * 144, Math.floor(lv / 2) * 128, 72, 128);
            }

            //攻撃フェーズ
            if (this.phase == 2) {
                if (distance < 96) {
                    //プレイヤーが近づいたら逃げる
                    this.phase = 1;
                } else {
                    //プレイヤーが遠くにいる場合は攻撃
                    this.isAttack = true;
                }
            }

            //発狂モード
            if (this.phase == 3) {
                this.isAttack = true;
            }

            if (this.isAttack) {
                var lv = Math.min(this.level, 4);
                this.sprite.setFrameTrimming((lv % 2) * 144 + 72, Math.floor(lv / 2) * 128, 72, 128);
                this.isAttack = false;

                if (this.phase < 3) {
                    this.stopTime = 30;
                    this.fireball();
                } else {
                    this.stopTime = 8;
                    this.fireball();
                }

                //プレイヤー方向を向く
                if (this.x < player.x) {
                    this.diretion = 0;
                    this.scaleX = 1;
                } else {
                    this.direction = 180;
                    this.scaleX = -1;
                }
            }

            //これ以上進めない場合は折り返す
            var cantescape = false;
            if (this._collision[1].hit || this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
                if (this.phase == 1) cantescape = true;
            } else if (this._collision[3].hit || this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
                if (this.phase == 1) cantescape = true;
            }
            //逃げられない場合は発狂モード
            if (cantescape) {
                this.phase = 3;
                this.speed = 0;
            }

            //プレイヤーが離れたら通常フェーズ
            if (distance > 128 + 64) {
                var lv = Math.min(this.level, 4);
                this.sprite.setFrameTrimming((lv % 2) * 144, Math.floor(lv / 2) * 128, 72, 128);
                this.phase = 0;
                this.speed = 1;
            }
        }

        if (this.isOnFloor || this.isJump) {
            this.vx = this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },

    //ファイアボール
    fireball: function() {
        this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, rotation: this.getPlayerAngle() + Math.randint(-40, 40)});
    },

    //爆発
    explode: function() {
        app.playSE("bomb");
        this.isAttack = false;
        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var rad = rot.toRadian();
                var ex = Math.cos(rad) * 16;
                var ey = Math.sin(rad) * 16;
                this.parentScene.spawnEnemy(this.x + ex, this.y + ey, "Bullet", {type: "explode", power: 10, rotation: rot, velocity: 3});
                rot += 22.5;
                ct++;
                if (ct == 32 || this.attackCancel) {
                    tw.remove();
                }
            })
            .wait(1)
            .setLoop(true);
    },
});

/*
 *  enemy.magicdgger.js
 *  2017/07/19
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.MagicDagger", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //寿命
    lifespan: 75,

    //速度
    velocity: 2,

    //加速度
    accel: 1.02,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 1.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 0,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(0);
        this.setAnimation("pattern1");

        this.power = options.power || this.power;
        this.power += this.level * 2;

        this.parentUnit = options.parent || null;
        this.offsetX = options.offsetX || Math.randint(-16, 16);
        this.offsetY = options.offsetY || Math.randint(-16, 16);
        this.order = options.order || 0;

        this.isAttack = false;
        this.isAttack_before = false;
        this.isDamaged = false;

        this.phase = 0;
    },

    algorithm: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //待機開始
        if (this.phase == 0) {
            this.phase++;
            var x = this.parentUnit.x + this.offsetX;
            var y = this.parentUnit.y + this.offsetY;
            y += Math.cos(this.time.toRadian() * 6) * 5;
            this.tweener.clear()
                .moveTo(x, y, 5)
                .call(() => {
                    this.phase++;
                });
        }

        //待機中
        if (this.phase == 2) {
            this.x = this.parentUnit.x + this.offsetX;
            this.y = this.parentUnit.y + this.offsetY;
            this.y += Math.cos(this.time.toRadian() * 6) * 5;
            this.rotation -= 3;

            if (this.isAttack) {
                this.phase = 3;
                this.isAttack = false;
            }
        }

        //プレイヤー攻撃開始
        if (this.phase == 3) {
            this.phase++;
            this.rotation = this.getPlayerAngle() + 135;
            this.tweener.clear()
                .moveTo(pl.x, pl.y, 20, "easeInQuad")
                .call(() => {
                    this.phase++;
                });
        }

        //攻撃終了
        if (this.phase == 5) {
            this.phase++;
            this.isEnableAttackCollision = false;
            var x = this.parentUnit.x + this.offsetX;
            var y = this.parentUnit.y + this.offsetY;
            this.tweener.clear()
                .moveTo(x, y, 15, "easeInOutQuad")
                .wait(5)
                .call(() => {
                    this.phase = 0;
                    this.isEnableAttackCollision = true;
                });
        }

        //警戒待機開始
        if (this.phase == 10) {
            this.phase++;
            var deg = this.time.toRadian() * 6 + this.order * 60;
            var x = this.parentUnit.x + Math.cos(deg) * 16;
            var y = this.parentUnit.y + Math.sin(deg) * 16;
            this.tweener.clear()
                .moveTo(x, y, 5)
                .call(() => {
                    this.phase++;
                });
        }

        //警戒待機中
        if (this.phase == 12) {
            var deg = this.time.toRadian() * 6 + this.order * 60;
            this.x = this.parentUnit.x + Math.cos(deg) * 16;
            this.y = this.parentUnit.y + Math.sin(deg) * 16;
            this.rotation -= 6;

            if (this.isAttack) {
                this.phase = 13;
                this.isAttack = false;
            }
        }

        //近接攻撃開始
        if (this.phase == 13) {
            this.phase++;
            this.tweener.clear()
                .wait(10)
                .call(() => {
                    this.phase++;
                    this.rotation = this.getPlayerAngle() + 135;
                })
                .moveTo(pl.x, pl.y, 6)
                .call(() => {
                    this.phase++;
                });
        }

        //近接攻撃
        if (this.phase == 14) {
            var deg = this.time.toRadian() * 20 + this.order * 60;
            this.x = this.parentUnit.x + Math.cos(deg) * 24;
            this.y = this.parentUnit.y + Math.sin(deg) * 24;
            this.rotation -= 6;
        }

        //攻撃終了
        if (this.phase == 16) {
            this.phase++;
            this.isEnableAttackCollision = false;
            var x = this.parentUnit.x + this.offsetX;
            var y = this.parentUnit.y + this.offsetY;
            this.tweener.clear()
                .moveTo(x, y, 10)
                .call(() => {
                    this.phase = 10;
                    this.isEnableAttackCollision = true;
                });
        }

        //親ユニット同期
        if (this.parentUnit) {
            this.direction = this.parentUnit.direction;
            if (this.parentUnit.hp == 0) this.remove();
        }

        //飛び道具迎撃
        this.parentScene.playerLayer.children.forEach(function(e) {
            if (e instanceof qft.PlayerAttack && e.isCollision) {
                if (e.type != "arrow" && e.type != "masakari") return;
                var dis = this.getDistance(e);
                if (dis < 64) {
                    this.phase = 20;
                    this.tweener.clear()
                        .moveTo(e.x, e.y, 5)
                        .call(() => {
                            this.phase = 10;
                        });
                }
            }
        }.bind(this));

        this.isAttack_before = this.isAttack;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [0];
        this.index = 0;
    },

    damage: function(target) {
        this.isDamaged = true;
        if (this.phase < 10) this.phase = 6; else this.phase = 17;

        //効果音
        app.playSE("tinkling");
        this.tweener.clear()
            .by({y: -64, rotation: 700}, 15, "easeOutQuad")
            .call(function() {
                if (this.phase < 10) this.phase = 0; else this.phase = 10;
                this.isDamaged = false;
            }.bind(this));
    },
});

/*
 *  enemy.ogre.js
 *  2017/05/06
 *  @auther minimo  
 *  This Program is MIT license.
 */

//オーガ
phina.define("qft.Enemy.Ogre", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 60,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 1000,

    //アイテムドロップ率（％）
    dropRate: 7,
    dropItem: ITEM_BAG,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWEL,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(216, 0, 72, 128);
        this.sprite.setPosition(0, -5).setScale(1.3);

        this.hp += this.level * 5;
        this.power += this.level * 3;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 0.5;
            } else {
                this.vx = -0.5;
            }
            if (this.chaseTime > 0) this.vx *= 4;
        }

        if (look) {
            this.chaseTime = 150;
            this.turnCount = 0;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+40, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+40, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                    this.turnWait = 1;
                }
            }
        }
        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.orochi.js
 *  2017/06/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

//大蛇
phina.define("qft.Enemy.Orochi", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 700,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 32, height: 36});
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01x2", 24 * 2, 32 * 2).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72 * 2, 384 * 2, 72 * 2, 128 * 2)
            .setScale(1 + capLevel * 0.1)
            .setPosition(0, capLevel * -1 - 4);
        this.width += capLevel * 10;

        this.hp += this.level * 10;
        this.power += this.level * 5;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 15;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        if (this.isDead) return;

        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+10, this.y+40, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-10, this.y+40, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //プレイヤーが近くにいたらジャンプ攻撃
            if (look && !this.isJump && dis < 40) {
                this.isJump = true;
                this.vy = -6;
                var pl = this.parentScene.player;
                if (this.x > pl.x) {
                    this.direction = 180;
                } else {
                    this.direction = 0;
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look) {
            this.vx *= 4;
            this.flare('balloon', {pattern: "!", lifeSpan: 15, y: 0});
        } else {
            this.flare('balloonerace');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.slime.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//スライム
phina.define("qft.Enemy.Slime", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 100,

    //属性ダメージ倍率
    damageSting: 0.8,
    damageBlow: 0.5,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72, 256, 72, 128)
            .setScale(1 + capLevel * 0.2)
            .setPosition(0, -2 + capLevel * -3);
        this.width += capLevel * 5;

        this.hp += this.level * 10;
        if (this.level > 3) this.hp += 30;
        this.power += this.level * 5;
        this.point += this.level * 200;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
            if (this.level > 3　&& this.stopTime == 0) {
                this.attack();
                this.flare('balloon', {pattern: "anger1", lifeSpan: 60, y: 0, force: true});
            }
        });
    },

    algorithm: function() {
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //テリトリー指定
            if (this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }

            if (this.level < 4) {
                //プレイヤーが近くにいたらジャンプ攻撃
                if (look && !this.isJump && dis < 40) {
                    this.isJump = true;
                    this.vy = -6;
                    var pl = this.parentScene.player;
                    if (this.x > pl.x) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            this.vx =  2 + Math.floor(this.level*0.5) * this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        }
    },

    attack: function() {
        this.stopTime = 30;
        var vx = 1;
        if (this.direction == 180) vx = -1;
        for (var i = 0; i < this.level; i++) {
            var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 2});
            b.vy = -8;
            b.vx = i * 2 * vx;
        }
    },

    randomAttack: function() {
        this.stopTime = 30;
        var vx = 1;
        if (this.direction == 180) vx = -1;
        for (var i = 0; i < this.level; i++) {
            var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 2});
            b.vy = -8;
            b.vx = i * 2 * vx;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.snake.js
 *  2017/01/27
 *  @auther minimo  
 *  This Program is MIT license.
 */

//蛇
phina.define("qft.Enemy.Snake", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 150,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18});
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72, 384, 72, 128)
            .setScale(1 + capLevel * 0.1)
            .setPosition(0, capLevel * -1)
        this.width += capLevel * 5;

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 100;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        if (this.isDead) return;

        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //プレイヤーが近くにいたらジャンプ攻撃
            if (look && !this.isJump && dis < 40) {
                this.isJump = true;
                this.vy = -6;
                var pl = this.parentScene.player;
                if (this.x > pl.x) {
                    this.direction = 180;
                } else {
                    this.direction = 0;
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look) {
            this.vx *= 4;
            this.flare('balloon', {pattern: "!", lifeSpan: 15, y: 0});
        } else {
            this.flare('balloonerace');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.titan.js
 *  2017/05/06
 *  @auther minimo  
 *  This Program is MIT license.
 */

//巨人
phina.define("qft.Enemy.Titan", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 3000,

    //アイテムドロップ率（％）
    dropRate: 7,
    dropItem: ITEM_BAG,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWEL,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 25, height: 40});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(216*2, 0, 72*2, 128*2);
        this.sprite.setPosition(0, -5);

        this.hp += this.level * 10;
        this.power += this.level * 5;
        this.point += this.level * 500;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 0.5;
            } else {
                this.vx = -0.5;
            }
            if (this.isJump) this.vx *= 1.5;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }
        if (this.chaseTime > 0) this.vx *= 3;

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+40, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+40, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                    this.turnWait = 1;
                }
            }

            //攻撃
            if (look && !this.isJump && dis < 64 && !this.isAttack) {
                this.attack();
            }
        }
        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    attack: function() {
        var that = this;
        var atk = qft.EnemyAttack(this.parentScene, {width: 1, height: 24, power: 40 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        atk.isActive = false;
        atk.tweener.clear()
            .wait(6)
            .call(function() {
                atk.isActive = true;
                that.vx = 24 * that.scaleX;
            })
            .wait(6)
            .call(function() {
                that.isAttack = false;
                atk.remove();
            });
        this.isAttack = true;
        this.stopTime = 30;

        qft.Balloon({pattern: "anger2"}).addChildTo(this).setPosition(0, -this.height/2-10);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.wisp.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ウィスプ
phina.define("qft.Enemy.Wisp", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //重力加速度
    gravity: 0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 360,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 100,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_STONE,

    //レアドロップ率（％）
    rareDropRate: 0,
    rareDropItem: ITEM_STONE,

    //属性ダメージ倍率
    damageFire: 0.8,
    damageIce: 2,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(Math.min(this.level, 4) * 72, 512, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.eyesight += this.level * 64,
        this.point += this.level * 200;

        this.setAnimation("stand");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.move = false;
        this.attackCount = 0;
    },

    algorithm: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤーが近くにいたら寄っていく
        if (look) {
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(pl.x, pl.y);
            var p = p2.sub(p1);
            p.normalize();
            this.vx = p.x * (1 + this.level * 0.2);
            this.vy = p.y * (1 + this.level * 0.2);
        } else {
            this.vx = 0;
            this.vy = 0;
        }

        //攻撃
        if (this.level > 3 && dis < 128) {
            this.attackCount--;
            if (this.attackCount == 0) {
                for (var i = 0; i < this.level; i++) {
                    var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 1});
                    b.vy = -10;
                    b.vx = (i*2) * this.scaleX;
                }
                this.attackCount = 180 - this.level * 15;
            }
        } else {
            this.attackCount = 60;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

//ウィスプ（強）
phina.define("qft.Enemy.WispHard", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //重力加速度
    gravity: 0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 360,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 300,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_STONE,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_JEWEL,

    //属性ダメージ倍率
    damageFire: 0.5,
    damageIce: 2,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(288, 512, 72, 128);

        this.setAnimation("stand");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.move = false;
        this.attackCount = 0;
    },

    update: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤーが近くにいたら寄っていく
        if (look) {
            var player = this.parentScene.player;
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(player.x, player.y);
            var p = p2.sub(p1);
            p.normalize();
            this.vx = p.x / 2;
            this.vy = p.y / 2;
        } else {
            this.vx = 0;
            this.vy = 0;
        }

        //攻撃
        if (dis < 160) {
            this.attackCount--;
            if (this.attackCount == 0) {
                for (var i = 0; i < this.level+4; i++) {
                    var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 1});
                    b.vy = -10;
                    b.vx = (i*2) * this.scaleX;
                }
                this.attackCount = 180 - this.level * 15;
            }
        } else {
            this.attackCount = 60;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

phina.define("qft.Enemy.WispBomb", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //横移動減衰率
    friction: 0.99,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //得点
    point: 0,

    //無敵フラグ
    isMuteki: true,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 10, height: 10});
        options = options || {};
        this.$extend(options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("particle", 16, 16).addChildTo(this).setFrameIndex(31);
        this.animationInterval = 3;

        this.pattern = options.pattern || 1;
        this.setAnimation("pattern"+this.pattern);

        this.on('dead', function() {
        });
    },

    update: function() {
        if (this.isOnFloor) {
            if (this.onScreen) app.playSE("bomb");
            var b = this.parentScene.spawnEnemy(this.x, this.y, "Flame", {pattern: 1});
            this.remove();
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [31, 30, 29, 28, 27, 26, "stop"];
        this.frame["pattern2"] = [31, 30, 29, 28, 27, 26, "stop"];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.wizard.js
 *  2017/08/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ウィザード
phina.define("qft.Enemy.Wizard", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 360,

    //得点
    point: 3000,

    //重力加速度
    gravity: 0,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this)
            .setFrameTrimming(0, 0, 72, 128)
            .setScale(1.2);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.speed = 1;
        this.isAttack = false;

        //行動フェーズ
        this.phase = "wait";

        //接近戦経過時間
        this.nearCount = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        //待機中
        if (this.phase == "wait") {
            if (look) {
                this.flare('balloon', {pattern: "!", lifeSpan: 15});
                this.phase = "approach";
            }
        }

        //プレイヤー発見後接近
        if (this.phase == "approach") {
        }

        if (distance < 128) {
            this.nearCount++
        } else {
            this.nearCount = 0;
        }
    },

    //テレポート開始
    teleportIn: function() {
        this.sprite.tweener.fadeOut(30);
        for (var i = 0; i < 7; i++) {
            var sp = phina.display.Sprite("monster03", 24, 32)
                .addChildTo(this)
                .setFrameTrimming(0, 0, 72, 128);
            sp.tweener.setUpdateType('fps').clear()
                .by({x: -64 + i * 16, alpha: -1}, 30,"easeOutSine");
        }
    },

    //テレポート終了
    teleportOut: function() {
        this.sprite.tweener.fadeIn(30);
        for (var i = 0; i < 7; i++) {
            var sp = phina.display.Sprite("monster03", 24, 32)
                .addChildTo(this)
                .setFrameTrimming(0, 0, 72, 128);
            sp.tweener.setUpdateType('fps').clear()
                .by({x: -64 + i * 16, alpha: -1}, 30,"easeOutSine");
        }
    },

    //分身
    cloneMySelf: function() {
    },

    //火炎魔法
    flame: function() {
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },

    firstFrame: function() {
    },
});

//ウィザード分身
phina.define("qft.Enemy.WizardClone", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //得点
    point: 0,

    //重力加速度
    gravity: 0,

    //アイテムドロップ率（％）
    dropRate: 0,

    //レアドロップ率（％）
    rareDropRate: 0,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var lv = Math.min(this.level, 3);
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming((lv % 2) * 144 + 72, Math.floor(lv / 2) * 128, 72, 128);
        this.sprite.setScale(1.2);

        this.setAnimation("walk");
        this.animationInterval = 10;

        this.direction = 0;
        this.speed = 1;
        this.phase = 0;
        this.isAttack = false;
        this.isTeleport = false;
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  mapobject.accessory.js
 *  2017/01/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//マップ装飾アクセサリ
phina.define("qft.MapObject.Accessory", {
    superClass: "qft.Character",

    id: null,

    //識別フラグ
    isMapAccessory: true,

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 2,

    isAdvanceAnimation: true,

    //地形無視
    ignoreCollision: true,

    init: function(parentScene, options) {
        this.options = (options || {}).$safe({
            width: 32,
            height: 32,
            index: 0,
        })
        this.superInit(parentScene, {width: this.options.width, height: this.options.height});

        this.id = options.id;
        this.level = options.properties.level || 0;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [2, 1, 0, 3];
        this.frame["normal2"] = [1, 0, 3, 2];
        this.index = 0;
    },
});

//ランプ
phina.define("qft.MapObject.Lamp", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this).setFrameIndex(0);
        this.sprite.setFrameTrimming(this.level * 24, 0, 24, 128);

        //アニメーション設定
        if (this.id % 2) {
            this.setAnimation("normal");
        } else {
            this.setAnimation("normal2");
        }
        this.animationInterval = 8;
    },
});

//たき火
phina.define("qft.MapObject.Bonfire", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this).setFrameIndex(0);
        this.sprite.setFrameTrimming(this.level * 24, 128, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//炎
phina.define("qft.MapObject.Flame", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(this.level * 24 + 72, 0, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//火
phina.define("qft.MapObject.Fire", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame05", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(this.level * 24 + 72, 0, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//燭台
phina.define("qft.MapObject.Candle", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame05", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(this.level * 24 + 72, 128, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//ランタン
phina.define("qft.MapObject.Lanthanum", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("accessory1", 16, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 96, 72, 32);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [0, 1, 2, 1];
        this.index = 0;
    },
});

//ランプ２
phina.define("qft.MapObject.CandleLamp", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("accessory1", 16, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 32, 72, 32);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [0, 1, 2, 1];
        this.index = 0;
    },
});

/*
 *  mapobject.block.js
 *  2017/03/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//ブロッククラス
phina.define("qft.MapObject.Block", {
    superClass: "qft.Character",

    id: null,

    //耐久力
    hp: 30,

    //識別フラグ
    isBlock: true,

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 1,

    isAdvanceAnimation: false,

    //地形無視
    ignoreCollision: true,

    init: function(parentScene, options) {
        this.options = (options || {}).$safe({
            width: 32,
            height: 32,
            index: 0,
        })
        this.superInit(parentScene, {width: this.options.width, height: this.options.height});

        this.id = options.id;

        //スプライト
        this.index = options.index;
        this.sprite = phina.display.Sprite("block", 32, 32).addChildTo(this).setFrameIndex(this.index);

        var param = {
            width: 32,
            height: 32,
            fill: "rgba(0, 0, 0, 0.0)",
            stroke: "black",
            strokeWidth: 1,
            backgroundColor: 'transparent',
        };
        this.waku = phina.display.RectangleShape(param).setPosition(0, 0);
        if (options.enableFrame) this.waku.addChildTo(this);

        //スクリプト
        if (options.properties.script) {
            var sc = "(function(app) {"+options.properties.script+"})";
            var f = eval(sc);
            this.on('enterframe', f);
        }

        this.on('dead', function() {
            this.sprite.remove();
            this.waku.remove();
            if (this.collision) this.collision.remove();
            var s = [];
            s[0] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition(-8, -8).setFrameIndex(this.index * 2 + 0);
            s[1] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition( 8, -8).setFrameIndex(this.index * 2 + 1);
            s[2] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition(-8,  8).setFrameIndex(this.index * 2 + 16 + 0);
            s[3] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition( 8,  8).setFrameIndex(this.index * 2 + 16 + 1);
            //スプライトがバラバラに壊れるよ
            (4).times(function(i) {
                s[i].update = function() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vx *= 0.9;
                    this.vy += 0.9;
                    this.rotation += this.rot;
                    this.alpha -= 0.05;
                }
                s[i].vx = 0;
                s[i].vy = -5;
            }.bind(this));
            s[0].vx = -6; s[0].rot = -3;
            s[1].vx =  6; s[1].rot =  3;
            s[2].vx = -3; s[2].rot = -3;
            s[3].vx =  3; s[3].rot =  3;
            this.tweener.clear()
                .wait(10)
                .call(function() {
                    this.remove();
                }.bind(this));
        });
    },

    update: function(e) {
        if (this.collision) {
            this.collision.x = this.x;
            this.collision.y = this.y;
        }
        if (!this.isDead) {
            //プレイヤー攻撃（固定）との当たり判定
            var pl = this.parentScene.player;
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                this.damage(pl);
            }
            //プレイヤー攻撃判定との当たり判定
            this.parentScene.playerLayer.children.forEach(function(e) {
                if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                    e.remove();
                    this.damage(e);
                }
            }.bind(this));
        }
        this.visible = true;    //点滅キャンセル
    },

    damage: function(target) {
        if (this.isDead) return;
        if (this.mutekiTime > 0) return;
        this.hp -= target.power;
        this.mutekiTime = 10;
        if (this.hp <= 0) {
            this.isDead = true;
            this.flare('dead');
            return;
        }
        var dir = 2;
        if (this.x < target.x) dir = -2;
        this.sprite.tweener.clear()
            .moveBy(dir, 0, 1)
            .moveBy(-dir, 0, 1)
            .call(function(){
                app.playSE("hit_blunt");
            });
    },

    //当たり判定の追加
    addCollision: function (layer) {
        this.collision = phina.display.RectangleShape({width: 32, height: 32})
            .addChildTo(layer)
            .setPosition(this.x, this.y)
            .setVisible(DEBUG_COLLISION);
        this.collision.alpha = 0.3;
        this.collision.vx = 0;
        this.collision.vy = 0;
        this.collision.ignore = false;
        this.collision.type = "block";
    }
});

/*
 *  mapobject.door.js
 *  2017/01/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//大型ドアクラス
phina.define("qft.MapObject.Door", {
    superClass: "qft.Character",

    id: null,

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 3,

    //地形無視
    ignoreCollision: true,

    //実行済みフラグ
    already: false,

    //ロックされているか
    isLock: false,

    init: function(parentScene, options) {
        var width = options.width || 36;
        var height = options.height || 64;
        this.superInit(parentScene, {width: width, height: height});

        //スプライト
        this.sprite = phina.display.Sprite("door", 36, 64).addChildTo(this).setFrameIndex(3);
        this.setAnimation("closed");

        this.id = options.id;
        this.isLock = options.properties.lock || false;
        this.name = options.name;
        this.enterOffset = options.properties.enterOffset || 0;
        this.sprite.visible = options.properties.visible == undefined? true: options.properties.visible;

        //ドア機能
        var properties = options.properties;
        switch (options.name) {
            //クリア
            case "clear":
                this.isLock = true;
                this.on('enterdoor', function() {
                    this.parentScene.flare('stageclear');
                });
                break;
            //マップ内移動
            case "warp":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.on('enterdoor', function() {
                    //行き先の検索
                    var next = this.findDoor(this.nextID);
                    if (!next) return;
                    this.enterPlayer();
                    this.parentScene.warp(next.x, next.y+next.offset);
                    this.tweener.clear()
                        .wait(120)
                        .call(function(){
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                });
                break;
            //マップ切り替え
            case "mapswitch":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.toLayerNumber = properties.toLayerNumber;
                this.on('enterdoor', function() {
                    var layer = this.parentScene.stageController.mapLayer[this.toLayerNumber];
                    var next = this.parentScene.stageController.findObject(this.nextID, this.toLayerNumber);
                    if (!next) return;
                    this.enterPlayer();
                    this.tweener.clear()
                        .wait(60)
                        .call(function(){
                            this.parentScene.switchMap(layer);
                            this.parentScene.player.setPosition(next.x, next.y + next.offset);
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                    this.parentScene.fg.tweener.clear().wait(30).fadeIn(30).fadeOut(30);
                });
                break;
        }
    },

    update: function(e) {
        //近くに来たら自動的に開ける
        if (this.getDistancePlayer() < 64) {
            if (!this.isLock) this.open();
        } else {
            if (this.nowAnimation == "open") {
                this.close();
            }
        }

        //プレイヤーとの当たり判定
        var pl = this.parentScene.player;
        var hit = this.hitTestElement(pl);
        if (hit && !this.isLock && !this.already) {
            if (this.name == "clear") {
                //ステージクリアの扉は無条件で入る
                this.flare('enterdoor');
                this.already = true;
            }
        }
    },

    setupAnimation: function(options) {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["opend"] = [3, "stop"];
        this.frame["closed"] = [2, "stop"];
        this.frame["open"] = [2, 1, 0, 3, "stop"];
        this.frame["close"] = [3, 0, 1, 2, "stop"];
        this.index = 0;
    },

    open: function() {
        this.setAnimation("open");
    },

    close: function() {
        this.setAnimation("close");
    },

    //プレイヤーが扉に入る
    enterPlayer: function() {
        var enterOffset = this.enterOffset;
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1")
            .setPosition(player.x, player.y)
            .addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.setAnimation("up");
        pl.tweener.clear().setUpdateType('fps')
            .moveTo(this.x, this.y+this.height/2-16+enterOffset, 15)
            .call(function() {
                pl.animation = false;
            })
            .fadeOut(15)
            .call(function() {
                pl.remove();
            });
    },

    //プレイヤーが扉から出る
    leavePlayer: function() {
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1")
            .setPosition(this.x, this.y+16)
            .addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.alpha = 0;
        pl.setAnimation("down");
        pl.tweener.clear().setUpdateType('fps')
            .fadeIn(15)
            .moveTo(player.x, player.y, 30)
            .fadeIn(10)
            .call(function() {
                player.alpha = 1;
                player.isControl = true;
                player.isMuteki = false;
                pl.remove();
            });
    },

    //他の扉を検索
    findDoor: function(id) {
        var result = null;
        this.parentScene.objLayer.children.forEach(function(e) {
            if (e instanceof qft.MapObject.Door) {
                if (e.id == id) result = e;
            }
        }.bind(this));
        return result;
    },
});

/*
 *  mapobject.floor.js
 *  2017/03/27
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//可動フロアクラス
phina.define("qft.MapObject.Floor", {
    superClass: "qft.Character",

    id: null,

    //識別フラグ
    isFloor: true,

    //重力加速度
    gravity: 0.0,

    //移動フラグ
    isActive: true,

    //プレイヤーが上に乗ってるフラグ
    isOnPlayer: false,

    //アニメーション進行可能フラグ
    isAdvanceAnimation: false,

    //地形無視
    ignoreCollision: true,

    //移動パス
    movePath: null,

    //移動パス現在時間(0-1)
    pathTime: 0,

    init: function(parentScene, options) {
        this.options = (options || {}).$safe({
            width: 32,
            height: 32,
            index: 0,
        })
        this.superInit(parentScene, {width: this.options.width, height: this.options.height});

        this.id = options.id;

        this.moveType = options.properties.moveType || "linear";
        this.moveAngle = options.properties.moveAngle || 0;
        this.moveLength = options.properties.moveLength || 0;
        this.moveRadius = options.properties.moveRadius || 64;
        this.moveSpeed = options.properties.moveSpeed || 60;
        this.moveWait = (options.properties.moveWait !== undefined)? options.properties.moveWait: 60;

        //始点と終点
        this.startX = options.x + (options.width || 16) / 2;
        this.startY = options.y + (options.height || 16) / 2;
        if (this.moveLength > 0) {
            //移動距離が設定されている場合
            var rad = this.moveAngle.toRadian();
            this.endX = this.startX + Math.cos(rad) * this.moveLength;
            this.endY = this.startY + Math.sin(rad) * this.moveLength;
        } else {
            //終点座標が設定されている場合
            this.endX = options.properties.endX || this.startX;
            this.endY = options.properties.endY || this.startY;
        }

        //円運動の場合は中心を設定（無い場合は終点を中心とする）
        if (this.moveType == "circle") {
            this.centerX = options.properties.centerX || this.endX;
            this.centerY = options.properties.centerY || this.endY;
        }

        //移動パターン
        switch (this.moveType) {
            //直線運動
            case "linear":
                this.tweener.clear()
                    .moveTo(this.endX, this.endY, this.moveSpeed, "easeInOutSine")
                    .call(function() {this.flare('moveend');}.bind(this))
                    .wait(this.moveWait)
                    .moveTo(this.startX, this.startY, this.moveSpeed, "easeInOutSine")
                    .call(function() {this.flare('movestart');}.bind(this))
                    .wait(this.moveWait)
                    .setLoop(true);
                break;
            //円運動
            case "circle":
                this.angle = 0;
                if (options.properties.counterClockWise) {
                    //反時計回り
                    this.tweener.clear()
                        .to({angle: -360}, this.moveSpeed)
                        .call(function() {this.flare('moveend');}.bind(this))
                        .set({angle: 0})
                        .setLoop(true);
                } else {
                    //時計回り
                    this.tweener.clear()
                        .to({angle: 360}, this.moveSpeed)
                        .call(function() {this.flare('moveend');}.bind(this))
                        .set({angle: 0})
                        .setLoop(true);
                    break;
                }
            //設定されたパスに沿って移動
            case "path":
                break;
        }

        //スプライト
        this.index = options.properties.index || 0;
        var sw = Math.floor(this.width / 16);
        var sh = Math.floor(this.height / 16)+32;
        var top = this.height / 2;
        for (var x = 0; x < sw; x++) {
            var idx = (x % 2) + 1;
            if (x == 0) idx = 0;
            if (x == sw-1) idx = 3;
            var s = phina.display.Sprite("floor", 16, 96)
                .addChildTo(this)
                .setFrameTrimming(this.index * 64, 32, 64, 96)
                .setFrameIndex(idx)
                .setPosition(x * 16 - this.width / 2 + 8, 16-top);
        }
    },

    update: function(e) {
        if (this.moveType == "circle") {
            var rad = this.radius.toRadian();
            this.x = this.centerX + Math.cos(rad) * this.moveRadius;
            this.y = this.centerY + Math.sin(rad) * this.moveRadius;
        } else if (this.moveType == 'path') {
        }

        //停止と再生
        if (!this.isActive) this.tweener.pause();
        if (this.isActive) this.tweener.play();

        if (this.collision) {
            this.collision.vx = this.x - this.collision.x;
            this.collision.vy = this.y - this.collision.y;
            this.collision.x = this.x;
            this.collision.y = this.y;
        }

        //プレイヤーが上に乗っているか判定
        var pl = this.parentScene.player;
        this.isOnPlayer = false;
        if (pl.floorObject && pl.floorObject.parentObject === this) {
            this.isOnPlayer = true;
            //床が下降している時のみ
            if (!pl.isJump && this.collision.vy > 0) {
                pl.y = this.y - this.height * 0.5;
            }
        }
    },

    //フロア当たり判定の追加
    addCollision: function (layer) {
        this.collision = phina.display.RectangleShape({width: this.width, height: this.height})
            .addChildTo(layer)
            .setPosition(this.x, this.y)
            .setVisible(DEBUG_COLLISION);
        this.collision.alpha = 0.3;
        this.collision.vx = 0;
        this.collision.vy = 0;
        this.collision.ignore = false;
        this.collision.type = "movefloor";
        this.collision.parentObject = this;
    },

    //移動パスの設定
    setPath: function(startX, startY, path, loop) {
        this.x = startX;
        this.y = startY;
        this.path = path;
        this.loop = loop;

        if (loop) {
            //距離計算
            var sum = 0;
            for (var i = 0; i < path.length - 1; i++) {
                var p1 = path[i];
                var p2 = path[i+1];
                p2.magnitude = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
                sum += p2.magnitude;
            }
            //終点から始点までの距離を加算
            var p1 = path[path.length - 1];
            var p2 = path[0];
            p2.magnitude = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
            sum += p2.magnitude;
            var unit = this.moveSpeed / sum;

            this.tweener.clear().wait(60);
            for (var i = 1; i < path.length; i++) {
                var p = path[i];
                var time = Math.floor(p.magnitude * unit);
                this.tweener.moveTo(startX + p.x, startY + p.y, time);
            }
            this.tweener.moveTo(startX + path[0].x, startY + path[0].y, time);
            this.tweener.setLoop(true);
        } else {
            //往路距離計算
            var sum = 0;
            for (var i = 0; i < path.length - 1; i++) {
                var p1 = path[i];
                var p2 = path[i+1];
                p2.magnitude = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
                sum += p2.magnitude;
            }
            var unit = this.moveSpeed / sum;

            //復路距離計算
            for (var i = path.length - 1; i > 0; i--) {
                var p1 = path[i];
                var p2 = path[i-1];
                p2.magnitude_ret = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
            }

            this.tweener.clear().wait(60);
            for (var i = 1; i < path.length; i++) {
                var p = path[i];
                var time = Math.floor(p.magnitude * unit);
                this.tweener.moveTo(startX + p.x, startY + p.y, time);
            }
            this.tweener.wait(60);
            for (var i = path.length - 2; i >= 0; i--) {
                var p = path[i];
                var time = Math.floor(p.magnitude_ret * unit);
                this.tweener.moveTo(startX + p.x, startY + p.y, time);
            }
            this.tweener.setLoop(true);
        }
    },
});

/*
 *  mapobject.gate.js
 *  2017/03/20
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//ワープゲート
phina.define("qft.MapObject.Gate", {
    superClass: "qft.Character",

    id: null,

    //重力加速度
    gravity: 0.0,

    //地形無視
    ignoreCollision: true,

    //実行済みフラグ
    already: false,

    //ロックされているか
    isLock: false,

    //アニメーションフラグ
    isAdvanceAnimation: false,

    init: function(parentScene, options) {
        var width = options.width || 36;
        var height = options.height || 64;
        this.superInit(parentScene, {width: width, height: height});
        this.width_half = width / 2;
        this.height_half = height / 2;

        this.id = options.id;
        this.isLock = options.properties.lock || false;
        this.name = options.name;
        this.enterOffset = options.properties.enterOffset || 0;

        //スプライト
        this.sprite = null;

        //ゲート機能
        var properties = options.properties;
        switch (options.name) {
            //マップ内移動
            case "warp":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.on('enterdoor', function() {
                    //行き先の検索
                    var next = this.findGate(this.nextID);
                    if (!next) return;
                    this.enterPlayer();
                    this.parentScene.warp(next.x, next.y+next.offset);
                    this.tweener.clear()
                        .wait(120)
                        .call(function(){
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                });
                break;
            //マップ切り替え
            case "mapswitch":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.toLayerNumber = properties.toLayerNumber;
                this.on('enterdoor', function() {
                    var layer = this.parentScene.stageController.mapLayer[this.toLayerNumber];
                    var next = this.parentScene.stageController.findObject(this.nextID, this.toLayerNumber);
                    if (!next) return;
                    this.enterPlayer();
                    this.tweener.clear()
                        .wait(60)
                        .call(function(){
                            this.parentScene.switchMap(layer);
                            this.parentScene.player.setPosition(next.x, next.y + next.offset);
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                    this.parentScene.fg.tweener.clear().wait(30).fadeIn(30).fadeOut(30);
                });
                break;
        }

        this.time = 0;
    },

    update: function() {
        //パーティクル
        if (!this.isLock && this.time % 6 == 0) {
            (2).times(function(i) {
                var sp = phina.display.Sprite("particle", 16, 16)
                    .addChildTo(this)
                    .setFrameIndex(0)
                    .setScale(0)
                    .setPosition(Math.randint(-this.width_half, this.width_half), this.height_half + Math.randint(-4, 4));
                sp.alpha = 0.3;
                sp.tweener.clear()
                    .by({y: -48, alpha:  0.9, scaleX:  0.3, scaleY:  0.3}, 1000, "easeInSine")
                    .by({y: -48, alpha: -0.9, scaleX: -0.3, scaleY: -0.3}, 1000, "easeOutSine")
                    .call(function() {
                        this.remove();
                    }.bind(sp));
            }.bind(this));
        }
    },

    //プレイヤーがゲートに入る
    enterPlayer: function() {
        var enterOffset = this.enterOffset;
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1").setPosition(player.x, player.y).addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.setAnimation("walk");
        pl.tweener.clear().setUpdateType('fps')
            .moveTo(this.x, this.y+enterOffset, 15)
            .call(function() {
                pl.animation = false;
            })
            .fadeOut(15)
            .call(function() {
                pl.remove();
            });
    },

    //プレイヤーがゲートから出る
    leavePlayer: function() {
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1").setPosition(this.x, this.y).addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.alpha = 0;
        pl.setAnimation("walk");
        pl.animation = false;
        pl.tweener.clear().setUpdateType('fps')
            .fadeIn(15)
            .moveTo(player.x, player.y, 30)
            .fadeIn(10)
            .call(function() {
                player.alpha = 1;
                player.isControl = true;
                player.isMuteki = false;
                pl.remove();
            });
    },

    //他のゲートを検索
    findGate: function(id) {
        var result = null;
        this.parentScene.objLayer.children.forEach(function(e) {
            if (e instanceof qft.MapObject.Gate) {
                if (e.id == id) result = e;
            }
        }.bind(this));
        return result;
    },
});

/*
 *  mapobject.npc.js
 *  2017/08/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//冒険者
phina.define("qft.MapObject.npc", {
    superClass: "qft.Character",

    //移動速度
    speed: 2,

    //アニメーション間隔
    animationInterval: 8,

    //影表示フラグ
    isShadow: true,

    //移動フラグ
    isMove: true,

    //不動フラグ
    toFix: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 24, height: 20});
        this.superInit(parentScene, options);

        this.sprite = phina.display.Sprite("actor" + (options.properties.actor || "40"), 32, 32).addChildTo(this);
        this.sprite.scaleX = -1;

        this.speed = options.properties.speed || this.speed;
        this.isMove = (options.properties.isMove === undefined? true: options.properties.isMove);
        this.territory = options.properties.territory || null;
        this.direction = options.properties.direction || 0;
        this.text = options.properties.text;

        if (options.properties.toFix) {
            this.ignoreCollision = true;
            this.gravity = 0;
            this.isMove = false;
            this.toFix = true;
            this.one('enterframe', () => {
                this.setupFixedShadow();
            });
        }

        this.setAnimation("walk");

        this.waitTime = 0;

        this.one('enterframe', () => {
            if (!this.isMove) {
                switch (this.direction) {
                    case 0:
                        this.setAnimation("walk");
                        this.scaleX = 1;
                        break;
                    case 90:
                        this.setAnimation("down");
                        break;
                    case 180:
                        this.setAnimation("walk");
                        this.scaleX = -1;
                        break;
                    case 270:
                        this.setAnimation("up");
                        break;
                }
            }
        });
    },

    update: function() {
        if (this.waitTime == 0) {
            if (this.isMove) {
                this.moveAlgorithm();
            }

            //プレイヤー攻撃との当たり判定
            var pl = this.parentScene.player;
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                //話しかけた事になる
                this.tweener.clear()
                    .wait(5)
                    .call(()=> {
                        var scene = qft.ConversationScene(this.parentScene, this.text);
                        app.pushScene(scene);
                    });
                this.waitTime = 15;

                //向きの調整
                this.setAnimation("walk");
                if (this.x < pl.x) {
                    this.scaleX = 1;
                } else {
                    this.scaleX = -1;
                }
            }
        }

        this.waitTime--;
        if (this.waitTime < 0) this.waitTime = 0;
    },

    moveAlgorithm: function() {
        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //テリトリー指定
            if (this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }

        if (this.isOnFloor) {
            this.vx =  this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
                this.scaleX = -1;
            } else {
                this.scaleX = 1;
            }
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [36, "stop"];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
        this.frame["defense"] = [ 41, 42, 43, 44, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["drop"] = [18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.frame["clear"] = [24, 25, 26];
        this.frame["stun"] = [ 18, 19, 20];
        this.index = 0;
        return this;
    },

    //固定影表示セットアップ
    setupFixedShadow: function() {
        var that = this;
        var sc = this.width / 24;
        if (sc < 1) sc += 0.2;
        this.fixedShadowSprite = phina.display.Sprite("shadow", 24, 8)
            .addChildTo(this.parentScene.shadowLayer)
            .setAlpha(0.5)
            .setScale(sc, 1.0);
        this.fixedShadowSprite.update = function() {
            this.alpha = 0.5;
            if (that.alpha < 0.5) this.alpha = that.alpha;
            this.x = that.x;
            this.y = that.y + 16;
        }
    },
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAwMF9wbHVnaW5zL3BoaW5hLmFzc2V0bG9hZGVyZXguanMiLCIwMDBfcGx1Z2lucy9waGluYS5leHRlbnNpb24uanMiLCIwMDBfcGx1Z2lucy9waGluYS50aWxlZG1hcC5qcyIsIjAwMF9wbHVnaW5zL3BoaW5hLnZpcnR1YWxwYWQuanMiLCIwMDBfcGx1Z2lucy9zb3VuZHNldC5qcyIsIjAwMV9hcHAvYXBwbGljYXRpb24uanMiLCIwMDFfYXBwL2Fzc2V0cy5qcyIsIjAwMV9hcHAvYmVucmkuanMiLCIwMDFfYXBwL21haW4uanMiLCIwMDJfc2NlbmUvY29uZmlnc2NlbmUuanMiLCIwMDJfc2NlbmUvY29udmVyc2F0aW9uc2NlbmUuanMiLCIwMDJfc2NlbmUvY3JlZGl0c2NlbmUuanMiLCIwMDJfc2NlbmUvZW5kaW5nc2NlbmUuanMiLCIwMDJfc2NlbmUvZW5kaW5nc2NlbmUudHJ1ZWVuZGluZy5qcyIsIjAwMl9zY2VuZS9nYW1lb3ZlcnNjZW5lLmpzIiwiMDAyX3NjZW5lL2xvYWRpbmdzY2VuZS5qcyIsIjAwMl9zY2VuZS9tYWluc2NlbmUuanMiLCIwMDJfc2NlbmUvbWVudXNjZW5lLmpzIiwiMDAyX3NjZW5lL21lbnVzY2VuZV8uanMiLCIwMDJfc2NlbmUvbWVzc2FnZXNjZW5lLmpzIiwiMDAyX3NjZW5lL29wZW5pbmdzY2VuZS5qcyIsIjAwMl9zY2VuZS9wcmFjdGljZXNjZW5lLmpzIiwiMDAyX3NjZW5lL3NjZW5lZmxvdy5qcyIsIjAwMl9zY2VuZS9zcGxhc2hzY2VuZS5qcyIsIjAwMl9zY2VuZS90aXRsZXNjZW5lLmpzIiwiMDAyX3NjZW5lL3R1dG9yaWFsc2NlbmUuanMiLCIwMDNfc3RhZ2Uvc3RhZ2UxLmpzIiwiMDAzX3N0YWdlL3N0YWdlMTAuanMiLCIwMDNfc3RhZ2Uvc3RhZ2UyLmpzIiwiMDAzX3N0YWdlL3N0YWdlMy5qcyIsIjAwM19zdGFnZS9zdGFnZTQuanMiLCIwMDNfc3RhZ2Uvc3RhZ2U1LmpzIiwiMDAzX3N0YWdlL3N0YWdlNi5qcyIsIjAwM19zdGFnZS9zdGFnZTcuanMiLCIwMDNfc3RhZ2Uvc3RhZ2U4LmpzIiwiMDAzX3N0YWdlL3N0YWdlOS5qcyIsIjAwM19zdGFnZS9zdGFnZTk5OS5qcyIsIjAwM19zdGFnZS9zdGFnZWNvbnRyb2xsZXIuanMiLCIwMDNfc3RhZ2Uvc3RhZ2VlbmRpbmcuanMiLCIwMDRfY2hhcmFjdGVyL2JhbGxvb24uanMiLCIwMDRfY2hhcmFjdGVyL2NoYXJhY3Rlci5qcyIsIjAwNF9jaGFyYWN0ZXIvZWZmZWN0LmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5qcyIsIjAwNF9jaGFyYWN0ZXIvaXRlbS5qcyIsIjAwNF9jaGFyYWN0ZXIvaXRlbWJveC5qcyIsIjAwNF9jaGFyYWN0ZXIvbWFwb2JqZWN0LmpzIiwiMDA0X2NoYXJhY3Rlci9wbGF5ZXIuanMiLCIwMDVfZW5lbXkvZW5lbXkuYWR2ZW50dXJlci5qcyIsIjAwNV9lbmVteS9lbmVteS5hcmNoZGVtb24uanMiLCIwMDVfZW5lbXkvZW5lbXkuYXJjaGtuaWdodC5qcyIsIjAwNV9lbmVteS9lbmVteS5hcmNobWFnZS5qcyIsIjAwNV9lbmVteS9lbmVteS5iYWJ5ZGVtb24uanMiLCIwMDVfZW5lbXkvZW5lbXkuYmlyZC5qcyIsIjAwNV9lbmVteS9lbmVteS5idWxsZXQuanMiLCIwMDVfZW5lbXkvZW5lbXkuZGVhdGguanMiLCIwMDVfZW5lbXkvZW5lbXkuZGVtb24uanMiLCIwMDVfZW5lbXkvZW5lbXkuZGV2aWwuanMiLCIwMDVfZW5lbXkvZW5lbXkuZXhwbG9kZS5qcyIsIjAwNV9lbmVteS9lbmVteS5maXJlYmlyZC5qcyIsIjAwNV9lbmVteS9lbmVteS5mbGFtZS5qcyIsIjAwNV9lbmVteS9lbmVteS5nYXJ1ZGEuanMiLCIwMDVfZW5lbXkvZW5lbXkuZ3JlYXRlcmRlbW9uLmpzIiwiMDA1X2VuZW15L2VuZW15LmludGVsbGlnZW50c3dvcmQuanMiLCIwMDVfZW5lbXkvZW5lbXkua25pZ2h0LmpzIiwiMDA1X2VuZW15L2VuZW15Lm1hZ2UuanMiLCIwMDVfZW5lbXkvZW5lbXkubWFnaWNkYWdnZXIuanMiLCIwMDVfZW5lbXkvZW5lbXkub2dyZS5qcyIsIjAwNV9lbmVteS9lbmVteS5vcm9jaGkuanMiLCIwMDVfZW5lbXkvZW5lbXkuc2xpbWUuanMiLCIwMDVfZW5lbXkvZW5lbXkuc25ha2UuanMiLCIwMDVfZW5lbXkvZW5lbXkudGl0YW4uanMiLCIwMDVfZW5lbXkvZW5lbXkud2lzcC5qcyIsIjAwNV9lbmVteS9lbmVteS53aXphcmQuanMiLCIwNjBfbWFwb2JqZWN0L21hcG9iamVjdC5hY2Nlc3NvcnkuanMiLCIwNjBfbWFwb2JqZWN0L21hcG9iamVjdC5ibG9jay5qcyIsIjA2MF9tYXBvYmplY3QvbWFwb2JqZWN0LmRvb3IuanMiLCIwNjBfbWFwb2JqZWN0L21hcG9iamVjdC5mbG9vci5qcyIsIjA2MF9tYXBvYmplY3QvbWFwb2JqZWN0LmdhdGUuanMiLCIwNjBfbWFwb2JqZWN0L21hcG9iamVjdC5ucGMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDelJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbnlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3R0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOW5CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbGFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzd3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDak5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDak5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9MQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN1NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaktBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4UkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDak1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcktBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoicWZ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqICBwaGluYS5hc3NldGxvYWRlcmV4LmpzXG4gKiAgMjAxNi8xMS8yNVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmV4dGVuc2lvbiA9IHBoaW5hLmV4dGVuc2lvbiB8fCB7fTtcblxuLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4njgafjgqLjgrvjg4Pjg4joqq3jgb/ovrzjgb9cbnBoaW5hLmRlZmluZShcInBoaW5hLmV4dGVuc2lvbi5Bc3NldExvYWRlckV4XCIsIHtcblxuICAgIC8v6YCy5o2XXG4gICAgbG9hZHByb2dyZXNzOiAwLFxuXG4gICAgLy/oqq3jgb/ovrzjgb/ntYLkuobjg5Xjg6njgrBcbiAgICBsb2FkY29tcGxldGU6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIGxvYWQ6IGZ1bmN0aW9uKGFzc2V0cywgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fb25Mb2FkQXNzZXRzID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24oKXt9O1xuICAgICAgICB2YXIgbG9hZGVyID0gcGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIoKTtcbiAgICAgICAgbG9hZGVyLmxvYWQoYXNzZXRzKTtcbiAgICAgICAgbG9hZGVyLm9uKCdsb2FkJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkY29tcGxldGUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fb25Mb2FkQXNzZXRzKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIGxvYWRlci5vbnByb2dyZXNzID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkcHJvZ3Jlc3MgPSBlLnByb2dyZXNzO1xuICAgICAgICB9LmJpbmQodGhpcyk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgcGhpbmEuZXh0ZW5zaW9uLmpzXG4gKiAgMjAxNi8xMS8yNVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmV4dGVuc2lvbiA9IHBoaW5hLmV4dGVuc2lvbiB8fCB7fTtcblxuLy9zZXRBbHBoYeOCkui/veWKoFxucGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudC5wcm90b3R5cGUuc2V0QWxwaGEgPSBmdW5jdGlvbih2YWwpIHtcbiAgICB0aGlzLmFscGhhID0gdmFsO1xuICAgIHJldHVybiB0aGlzO1xufTtcblxuLy/jgrnjg5fjg6njgqTjg4jmqZ/og73mi6HlvLVcbnBoaW5hLmRpc3BsYXkuU3ByaXRlLnByb3RvdHlwZS5zZXRGcmFtZVRyaW1taW5nID0gZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICB0aGlzLl9mcmFtZVRyaW1YID0geCB8fCAwO1xuICB0aGlzLl9mcmFtZVRyaW1ZID0geSB8fCAwO1xuICB0aGlzLl9mcmFtZVRyaW1XaWR0aCA9IHdpZHRoIHx8IHRoaXMuaW1hZ2UuZG9tRWxlbWVudC53aWR0aCAtIHRoaXMuX2ZyYW1lVHJpbVg7XG4gIHRoaXMuX2ZyYW1lVHJpbUhlaWdodCA9IGhlaWdodCB8fCB0aGlzLmltYWdlLmRvbUVsZW1lbnQuaGVpZ2h0IC0gdGhpcy5fZnJhbWVUcmltWTtcbiAgcmV0dXJuIHRoaXM7XG59XG5cbnBoaW5hLmRpc3BsYXkuU3ByaXRlLnByb3RvdHlwZS5zZXRGcmFtZUluZGV4ID0gZnVuY3Rpb24oaW5kZXgsIHdpZHRoLCBoZWlnaHQpIHtcbiAgdmFyIHN4ID0gdGhpcy5fZnJhbWVUcmltWCB8fCAwO1xuICB2YXIgc3kgPSB0aGlzLl9mcmFtZVRyaW1ZIHx8IDA7XG4gIHZhciBzdyA9IHRoaXMuX2ZyYW1lVHJpbVdpZHRoICB8fCAodGhpcy5pbWFnZS5kb21FbGVtZW50LndpZHRoLXN4KTtcbiAgdmFyIHNoID0gdGhpcy5fZnJhbWVUcmltSGVpZ2h0IHx8ICh0aGlzLmltYWdlLmRvbUVsZW1lbnQuaGVpZ2h0LXN5KTtcblxuICB2YXIgdHcgID0gd2lkdGggfHwgdGhpcy53aWR0aDsgICAgICAvLyB0d1xuICB2YXIgdGggID0gaGVpZ2h0IHx8IHRoaXMuaGVpZ2h0OyAgICAvLyB0aFxuICB2YXIgcm93ID0gfn4oc3cgLyB0dyk7XG4gIHZhciBjb2wgPSB+fihzaCAvIHRoKTtcbiAgdmFyIG1heEluZGV4ID0gcm93KmNvbDtcbiAgaW5kZXggPSBpbmRleCVtYXhJbmRleDtcblxuICB2YXIgeCAgID0gaW5kZXglcm93O1xuICB2YXIgeSAgID0gfn4oaW5kZXgvcm93KTtcbiAgdGhpcy5zcmNSZWN0LnggPSBzeCt4KnR3O1xuICB0aGlzLnNyY1JlY3QueSA9IHN5K3kqdGg7XG4gIHRoaXMuc3JjUmVjdC53aWR0aCAgPSB0dztcbiAgdGhpcy5zcmNSZWN0LmhlaWdodCA9IHRoO1xuXG4gIHRoaXMuX2ZyYW1lSW5kZXggPSBpbmRleDtcblxuICByZXR1cm4gdGhpcztcbn1cblxuLy/jgqjjg6zjg6Hjg7Pjg4jlkIzlo6vjga7mjqXop6bliKTlrppcbnBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQucHJvdG90eXBlLmlzSGl0RWxlbWVudCA9IGZ1bmN0aW9uKGVsbSkge1xuICAgIC8v6Ieq5YiG44Go44OG44K544OI5a++6LGh44KS44Kw44Ot44O844OQ44Or44G45aSJ5o+bXG4gICAgdmFyIHAgPSB0aGlzLmdsb2JhbFRvTG9jYWwoZWxtKTtcbiAgICB2YXIgdGFyZ2V0ID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCh7d2lkdGg6IGVsbS53aWR0aCwgaGVpZ2h0OiBlbG0uaGVpZ2h0fSkuc2V0UG9zaXRpb24ocC54LCBwLnkpO1xuXG4gICAgaWYgKHRoaXMuYm91bmRpbmdUeXBlID09ICdyZWN0Jykge1xuICAgICAgICBpZiAoZWxtLmJvdW5kaW5nVHlwZSA9PSAncmVjdCcpIHtcbiAgICAgICAgICAgIHJldHVybiBwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0UmVjdFJlY3QodGhpcywgdGFyZ2V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0UmVjdENpcmNsZSh0aGlzLCB0YXJnZXQpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGVsbS5ib3VuZGluZ1R5cGUgPT0gJ3JlY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdENpZWNsZVJlY3QodGhpcywgdGFyZ2V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0Q2lyY2xlQ2lyY2xlKHRoaXMsIHRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8v5a2Q6KaB57Sg5YWo44Gm5YiH44KK6Zui44GXXG5waGluYS5hcHAuRWxlbWVudC5wcm90b3R5cGUucmVtb3ZlQ2hpbGRyZW4gPSBmdW5jdGlvbihiZWdpbkluZGV4KSB7XG4gICAgYmVnaW5JbmRleCA9IGJlZ2luSW5kZXggfHwgMDtcbiAgICB2YXIgdGVtcENoaWxkcmVuID0gdGhpcy5jaGlsZHJlbi5zbGljZSgpO1xuICAgIHZhciBsZW4gPSBsZW4gPSB0ZW1wQ2hpbGRyZW4ubGVuZ3RoO1xuICAgIGZvciAodmFyIGkgPSBiZWdpbkluZGV4OyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgdGVtcENoaWxkcmVuW2ldLnJlbW92ZSgpO1xuICAgIH1cbiAgICB0aGlzLmNoaWxkcmVuID0gW107XG59XG5cbi8qKlxuICogQG1ldGhvZCB0ZXN0TGluZUxpbmVcbiAqIEBzdGF0aWNcbiAqIDLjgaTjga7nt5rliIbjgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYvjgpLliKTlrprjgZfjgb7jgZlcbiAqIOWPguiAg++8mmh0dHA6Ly93d3c1ZC5iaWdsb2JlLm5lLmpwL350b21veWEwMy9zaHRtbC9hbGdvcml0aG0vSW50ZXJzZWN0aW9uLmh0bVxuICpcbiAqICMjIyBFeGFtcGxlXG4gKiAgICAgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMTAwLCAxMDApO1xuICogICAgIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDIwMCwgMjAwKTtcbiAqICAgICBwMyA9IHBoaW5hLmdlb20uVmVjdG9yMigxNTAsIDI0MCk7XG4gKiAgICAgcDQgPSBwaGluYS5nZW9tLlZlY3RvcjIoMjAwLCAxMDApO1xuICogcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdExpbmVMaW5lKHAxLCBwMiwgcDMsIHA0KTsgLy8gPT4gdHJ1ZVxuICpcbiAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBwMSDnt5rliIYx44Gu56uv44Gu5bqn5qiZXG4gKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDIg57ea5YiGMeOBruerr+OBruW6p+aomVxuICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHAzIOe3muWIhjLjga7nq6/jga7luqfmqJlcbiAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBwNCDnt5rliIYy44Gu56uv44Gu5bqn5qiZXG4gKiBAcmV0dXJuIHtCb29sZWFufSDnt5rliIYx44Go57ea5YiGMuOBjOmHjeOBquOBo+OBpuOBhOOCi+OBi+OBqeOBhuOBi1xuICovXG5waGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUgPSBmdW5jdGlvbihwMSwgcDIsIHAzLCBwNCkge1xuICAvL+WQjOS4gO+8uO+8uei7uOS4iuOBq+S5l+OBo+OBpuOCi+WgtOWQiOOBruiqpOWIpOWumuWbnumBv1xuICBpZiAocDEueCA9PSBwMi54ICYmIHAxLnggPT0gcDMueCAmJiBwMS54ID09IHA0LngpIHtcbiAgICB2YXIgbWluID0gTWF0aC5taW4ocDEueSwgcDIueSk7XG4gICAgdmFyIG1heCA9IE1hdGgubWF4KHAxLnksIHAyLnkpO1xuICAgIGlmIChtaW4gPD0gcDMueSAmJiBwMy55IDw9IG1heCB8fCBtaW4gPD0gcDQueSAmJiBwNC55IDw9IG1heCkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmIChwMS55ID09IHAyLnkgJiYgcDEueSA9PSBwMy55ICYmIHAxLnkgPT0gcDQueSkge1xuICAgIHZhciBtaW4gPSBNYXRoLm1pbihwMS54LCBwMi54KTtcbiAgICB2YXIgbWF4ID0gTWF0aC5tYXgocDEueCwgcDIueCk7XG4gICAgaWYgKG1pbiA8PSBwMy54ICYmIHAzLnggPD0gbWF4IHx8IG1pbiA8PSBwNC54ICYmIHA0LnggPD0gbWF4KSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgdmFyIGEgPSAocDEueCAtIHAyLngpICogKHAzLnkgLSBwMS55KSArIChwMS55IC0gcDIueSkgKiAocDEueCAtIHAzLngpO1xuICB2YXIgYiA9IChwMS54IC0gcDIueCkgKiAocDQueSAtIHAxLnkpICsgKHAxLnkgLSBwMi55KSAqIChwMS54IC0gcDQueCk7XG4gIHZhciBjID0gKHAzLnggLSBwNC54KSAqIChwMS55IC0gcDMueSkgKyAocDMueSAtIHA0LnkpICogKHAzLnggLSBwMS54KTtcbiAgdmFyIGQgPSAocDMueCAtIHA0LngpICogKHAyLnkgLSBwMy55KSArIChwMy55IC0gcDQueSkgKiAocDMueCAtIHAyLngpO1xuICByZXR1cm4gYSAqIGIgPD0gMCAmJiBjICogZCA8PSAwO1xufVxuXG4vKipcbiAqIEBtZXRob2QgdGVzdFJlY3RMaW5lXG4gKiBAc3RhdGljXG4gKiDnn6nlvaLjgajnt5rliIbjgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYvjgpLliKTlrprjgZfjgb7jgZlcbiAqXG4gKiAjIyMgRXhhbXBsZVxuICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoMTIwLCAxMzAsIDQwLCA1MCk7XG4gKiAgICAgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMTAwLCAxMDApO1xuICogICAgIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDIwMCwgMjAwKTtcbiAqIHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RSZWN0TGluZShyZWN0LCBwMSwgcDIpOyAvLyA9PiB0cnVlXG4gKlxuICogQHBhcmFtIHtwaGluYS5nZW9tLlJlY3R9IHJlY3Qg55+p5b2i6aCY5Z+f44Kq44OW44K444Kn44Kv44OIXG4gKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDEg57ea5YiG44Gu56uv44Gu5bqn5qiZXG4gKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDIg57ea5YiG44Gu56uv44Gu5bqn5qiZXG4gKiBAcmV0dXJuIHtCb29sZWFufSDnn6nlvaLjgajnt5rliIbjgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYtcbiAqL1xucGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdFJlY3RMaW5lID0gZnVuY3Rpb24ocmVjdCwgcDEsIHAyKSB7XG4gICAgLy/ljIXlkKvliKTlrpoocDHjgYzlkKvjgb7jgozjgabjgozjgbDoia/jgYTjga7jgadwMuOBruWIpOWumuOBr+OBl+OBquOBhO+8iVxuICAgIGlmIChyZWN0LmxlZnQgPD0gcDEueCAmJiBwMS54IDw9IHJlY3QucmlnaHQgJiYgcmVjdC50b3AgPD0gcDEueSAmJiBwMS55IDw9IHJlY3QuYm90dG9tICkgcmV0dXJuIHRydWU7XG5cbiAgICAvL+efqeW9ouOBru+8lOeCuVxuICAgIHZhciByMSA9IHBoaW5hLmdlb20uVmVjdG9yMihyZWN0LmxlZnQsIHJlY3QudG9wKTsgICAgIC8v5bem5LiKXG4gICAgdmFyIHIyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHJlY3QucmlnaHQsIHJlY3QudG9wKTsgICAgLy/lj7PkuIpcbiAgICB2YXIgcjMgPSBwaGluYS5nZW9tLlZlY3RvcjIocmVjdC5yaWdodCwgcmVjdC5ib3R0b20pOyAvL+WPs+S4i1xuICAgIHZhciByNCA9IHBoaW5hLmdlb20uVmVjdG9yMihyZWN0LmxlZnQsIHJlY3QuYm90dG9tKTsgIC8v5bem5LiLXG5cbiAgICAvL+efqeW9ouOBru+8lOi+uuOCkuOBquOBmee3muWIhuOBqOOBruaOpeinpuWIpOWumlxuICAgIGlmIChwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUocDEsIHAyLCByMSwgcjIpKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAocGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdExpbmVMaW5lKHAxLCBwMiwgcjIsIHIzKSkgcmV0dXJuIHRydWU7XG4gICAgaWYgKHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RMaW5lTGluZShwMSwgcDIsIHIzLCByNCkpIHJldHVybiB0cnVlO1xuICAgIGlmIChwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUocDEsIHAyLCByMSwgcjQpKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG59XG5cblxuLy/lhoblvKfjga7mj4/nlLtcbnBoaW5hLmRlZmluZSgncGhpbmEuZGlzcGxheS5BcmNTaGFwZScsIHtcbiAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuU2hhcGUnLFxuXG4gIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gKHt9KS4kc2FmZShvcHRpb25zLCB7XG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICBmaWxsOiAncmVkJyxcbiAgICAgIHN0cm9rZTogJyNhYWEnLFxuICAgICAgc3Ryb2tlV2lkdGg6IDQsXG4gICAgICByYWRpdXM6IDMyLFxuICAgICAgc3RhcnRBbmdsZTogMCxcbiAgICAgIGVuZEFuZ2xlOiAyNzAsXG5cbiAgICAgIGFudGljbG9ja3dpc2U6IGZhbHNlLFxuICAgIH0pO1xuICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgdGhpcy5yYWRpdXMgPSBvcHRpb25zLnJhZGl1cztcbiAgICB0aGlzLnN0YXJ0QW5nbGUgPSBvcHRpb25zLnN0YXJ0QW5nbGU7XG4gICAgdGhpcy5lbmRBbmdsZSA9IG9wdGlvbnMuZW5kQW5nbGU7XG4gICAgdGhpcy5hbnRpY2xvY2t3aXNlID0gb3B0aW9ucy5hbnRpY2xvY2t3aXNlO1xuXG4gICAgdGhpcy5zZXRCb3VuZGluZ1R5cGUoJ2NpcmNsZScpO1xuICB9LFxuXG4gIHByZXJlbmRlcjogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgY2FudmFzLmZpbGxQaWUoMCwgMCwgdGhpcy5yYWRpdXMsIHRoaXMuc3RhcnRBbmdsZSwgdGhpcy5lbmRBbmdsZSk7XG4gIH0sXG59KTtcbiIsIi8qXG4gKiAgcGhpbmEudGlsZWRtYXAuanNcbiAqICAyMDE2LzA5LzEwXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxuLyoqXG4gKiBAY2xhc3MgcGhpbmEuYXNzZXQuVGlsZWRNYXBcbiAqIEBleHRlbmRzIHBoaW5hLmFzc2V0LkFzc2V0XG4gKiAjIFRpbGVkTWFwRWRpdG9y44Gn5L2c5oiQ44GX44GfdG1444OV44Kh44Kk44Or44KS6Kqt44G/6L6844G/44Kv44Op44K5XG4gKi9cbnBoaW5hLmRlZmluZShcInBoaW5hLmFzc2V0LlRpbGVkTWFwXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmFzc2V0LkFzc2V0XCIsXG5cbiAgICAvKipcbiAgICAgKiBAcHJvcGVydHkgaW1hZ2VcbiAgICAgKiDkvZzmiJDjgZXjgozjgZ/jg57jg4Pjg5fnlLvlg49cbiAgICAgKi9cbiAgICBpbWFnZTogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSB0aWxlc2V0c1xuICAgICAqIOOCv+OCpOODq+OCu+ODg+ODiOaDheWgsVxuICAgICAqL1xuICAgIHRpbGVzZXRzOiBudWxsLFxuXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5IGxheWVyc1xuICAgICAqIOODrOOCpOODpOODvOaDheWgseOBjOagvOe0jeOBleOCjOOBpuOBhOOCi+mFjeWIl1xuICAgICAqL1xuICAgIGxheWVyczogbnVsbCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgIH0sXG5cbiAgICBfbG9hZDogZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICAvL+ODkeOCueaKnOOBjeWHuuOBl1xuICAgICAgICB0aGlzLnBhdGggPSBcIlwiO1xuICAgICAgICB2YXIgbGFzdCA9IHRoaXMuc3JjLmxhc3RJbmRleE9mKFwiL1wiKTtcbiAgICAgICAgaWYgKGxhc3QgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnBhdGggPSB0aGlzLnNyYy5zdWJzdHJpbmcoMCwgbGFzdCsxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v57WC5LqG6Zai5pWw5L+d5a2YXG4gICAgICAgIHRoaXMuX3Jlc29sdmUgPSByZXNvbHZlO1xuXG4gICAgICAgIC8vIGxvYWRcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB2YXIgeG1sID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhtbC5vcGVuKCdHRVQnLCB0aGlzLnNyYyk7XG4gICAgICAgIHhtbC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh4bWwucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICAgICAgICAgIGlmIChbMjAwLCAyMDEsIDBdLmluZGV4T2YoeG1sLnN0YXR1cykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0geG1sLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IChuZXcgRE9NUGFyc2VyKCkpLnBhcnNlRnJvbVN0cmluZyhkYXRhLCBcInRleHQveG1sXCIpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmRhdGFUeXBlID0gXCJ4bWxcIjtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcGFyc2UoZGF0YSk7XG4vLyAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzZWxmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHhtbC5zZW5kKG51bGwpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGdldE1hcERhdGFcbiAgICAgKiDmjIflrprjgZfjgZ/jg57jg4Pjg5fjg6zjgqTjg6Tjg7zjgpLphY3liJfjgajjgZfjgablj5blvpfjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsYXllck5hbWUg5a++6LGh44Os44Kk44Ok44O85ZCNXG4gICAgICovXG4gICAgZ2V0TWFwRGF0YTogZnVuY3Rpb24obGF5ZXJOYW1lKSB7XG4gICAgICAgIC8v44Os44Kk44Ok44O85qSc57SiXG4gICAgICAgIHZhciBkYXRhID0gbnVsbDtcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMubGF5ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllcnNbaV0ubmFtZSA9PSBsYXllck5hbWUpIHtcbiAgICAgICAgICAgICAgICAvL+OCs+ODlOODvOOCkui/lOOBmVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxheWVyc1tpXS5kYXRhLmNvbmNhdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGdldE9iamVjdEdyb3VwXG4gICAgICog44Kq44OW44K444Kn44Kv44OI44Kw44Or44O844OX44KS5Y+W5b6X44GX44G+44GZXG4gICAgICpcbiAgICAgKiDjgrDjg6vjg7zjg5fmjIflrprjgYznhKHjgYTloLTlkIjjgIHlhajjg6zjgqTjg6Tjg7zjgpLphY3liJfjgavjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBncm91bnBOYW1lIOWvvuixoeOCquODluOCuOOCp+OCr+ODiOOCsOODq+ODvOODl+WQjVxuICAgICAqL1xuICAgIGdldE9iamVjdEdyb3VwOiBmdW5jdGlvbihncm91cE5hbWUpIHtcbiAgICAgICAgZ3JvdXBOYW1lID0gZ3JvdXBOYW1lIHx8IG51bGw7XG4gICAgICAgIHZhciBscyA9IFtdO1xuICAgICAgICB2YXIgbGVuID0gdGhpcy5sYXllcnMubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllcnNbaV0udHlwZSA9PSBcIm9iamVjdGdyb3VwXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZ3JvdXBOYW1lID09IG51bGwgfHwgZ3JvdXBOYW1lID09IHRoaXMubGF5ZXJzW2ldLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg6zjgqTjg6Tjg7zmg4XloLHjgpLjgq/jg63jg7zjg7PjgZnjgotcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuX2Nsb25lT2JqZWN0TGF5ZXIodGhpcy5sYXllcnNbaV0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBOYW1lICE9PSBudWxsKSByZXR1cm4gb2JqO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBscy5wdXNoKG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGdldE1hcEltYWdlXG4gICAgICog44Oe44OD44OX44Kk44Oh44O844K444Gu5L2c5oiQXG4gICAgICpcbiAgICAgKiDopIfmlbDjga7jg57jg4Pjg5fjg6zjgqTjg6Tjg7zjgpLmjIflrprlh7rmnaXjgb7jgZnjgIJcbiAgICAgKiDmj4/nlLvpoIbluo/jga9UaWxlZE1hcEVkaXRvcuWBtOOBp+OBruaMh+WumumghuOBp+OBr+eEoeOBj+OAgeW8leaVsOOBrumghuW6j+OBqOOBquOCiuOBvuOBme+8iOesrOS4gOW8leaVsOOBjOS4gOeVquS4i+OBqOOBquOCi++8iVxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9ICDlr77osaHjg6zjgqTjg6Tjg7zlkI1cbiAgICAgKi9cbiAgICBnZXRJbWFnZTogZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgICB2YXIgbnVtTGF5ZXIgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGF5ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5sYXllcnNbaV0udHlwZSA9PSBcImxheWVyXCIgfHwgdGhpcy5sYXllcnNbaV0udHlwZSA9PSBcImltYWdlbGF5ZXJcIikgbnVtTGF5ZXIrKztcbiAgICAgICAgfVxuICAgICAgICBpZiAobnVtTGF5ZXIgPT0gMCkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgdmFyIGdlbmVyYXRlZCA9IGZhbHNlO1xuICAgICAgICB2YXIgd2lkdGggPSB0aGlzLndpZHRoICogdGhpcy50aWxld2lkdGg7XG4gICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodCAqIHRoaXMudGlsZWhlaWdodDtcbiAgICAgICAgdmFyIGNhbnZhcyA9IHBoaW5hLmdyYXBoaWNzLkNhbnZhcygpLnNldFNpemUod2lkdGgsIGhlaWdodCk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxheWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGZpbmQgPSBhcmdzLmluZGV4T2YodGhpcy5sYXllcnNbaV0ubmFtZSk7XG4gICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPT0gMCB8fCBmaW5kID49IDApIHtcbiAgICAgICAgICAgICAgICAvL+ODnuODg+ODl+ODrOOCpOODpOODvFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS50eXBlID09IFwibGF5ZXJcIiAmJiB0aGlzLmxheWVyc1tpXS52aXNpYmxlICE9IFwiMFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXllciA9IHRoaXMubGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWFwZGF0YSA9IGxheWVyLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGxheWVyLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gbGF5ZXIuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3BhY2l0eSA9IGxheWVyLm9wYWNpdHkgfHwgMS4wO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBtYXBkYXRhW2NvdW50XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+ODnuODg+ODl+ODgeODg+ODl+OCkumFjee9rlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRNYXBDaGlwKGNhbnZhcywgaW5kZXgsIHggKiB0aGlzLnRpbGV3aWR0aCwgeSAqIHRoaXMudGlsZWhlaWdodCwgb3BhY2l0eSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy/jgqrjg5bjgrjjgqfjgq/jg4jjgrDjg6vjg7zjg5dcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXllcnNbaV0udHlwZSA9PSBcIm9iamVjdGdyb3VwXCIgJiYgdGhpcy5sYXllcnNbaV0udmlzaWJsZSAhPSBcIjBcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGF5ZXIgPSB0aGlzLmxheWVyc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wYWNpdHkgPSBsYXllci5vcGFjaXR5IHx8IDEuMDtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXIub2JqZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmdpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldE1hcENoaXAoY2FudmFzLCBlLmdpZCwgZS54LCBlLnksIG9wYWNpdHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL+OCpOODoeODvOOCuOODrOOCpOODpOODvFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS50eXBlID09IFwiaW1hZ2VsYXllclwiICYmIHRoaXMubGF5ZXJzW2ldLnZpc2libGUgIT0gXCIwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxlbiA9IHRoaXMubGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCdpbWFnZScsIHRoaXMubGF5ZXJzW2ldLmltYWdlLnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZS5kb21FbGVtZW50LCB0aGlzLmxheWVyc1tpXS54LCB0aGlzLmxheWVyc1tpXS55KTtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWdlbmVyYXRlZCkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgdmFyIHRleHR1cmUgPSBwaGluYS5hc3NldC5UZXh0dXJlKCk7XG4gICAgICAgIHRleHR1cmUuZG9tRWxlbWVudCA9IGNhbnZhcy5kb21FbGVtZW50O1xuICAgICAgICByZXR1cm4gdGV4dHVyZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfY2xvbmVPYmplY3RMYXllclxuICAgICAqIOW8leaVsOOBqOOBl+OBpua4oeOBleOCjOOBn+OCquODluOCuOOCp+OCr+ODiOODrOOCpOODpOODvOOCkuOCr+ODreODvOODs+OBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICog5YaF6YOo44Gn5L2/55So44GX44Gm44GE44KL6Zai5pWw44Gn44GZ44CCXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY2xvbmVPYmplY3RMYXllcjogZnVuY3Rpb24oc3JjTGF5ZXIpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHt9LiRzYWZlKHNyY0xheWVyKTtcbiAgICAgICAgcmVzdWx0Lm9iamVjdHMgPSBbXTtcbiAgICAgICAgLy/jg6zjgqTjg6Tjg7zlhoXjgqrjg5bjgrjjgqfjgq/jg4jjga7jgrPjg5Tjg7xcbiAgICAgICAgc3JjTGF5ZXIub2JqZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKG9iail7XG4gICAgICAgICAgICB2YXIgcmVzT2JqID0ge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LiRzYWZlKG9iai5wcm9wZXJ0aWVzKSxcbiAgICAgICAgICAgIH0uJGV4dGVuZChvYmopO1xuICAgICAgICAgICAgaWYgKG9iai5lbGxpcHNlKSByZXNPYmouZWxsaXBzZSA9IG9iai5lbGxpcHNlO1xuICAgICAgICAgICAgaWYgKG9iai5naWQpIHJlc09iai5naWQgPSBvYmouZ2lkO1xuICAgICAgICAgICAgaWYgKG9iai5wb2x5Z29uKSByZXNPYmoucG9seWdvbiA9IG9iai5wb2x5Z29uLmNsb25lKCk7XG4gICAgICAgICAgICBpZiAob2JqLnBvbHlsaW5lKSByZXNPYmoucG9seWxpbmUgPSBvYmoucG9seWxpbmUuY2xvbmUoKTtcbiAgICAgICAgICAgIHJlc3VsdC5vYmplY3RzLnB1c2gocmVzT2JqKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BhcnNlXG4gICAgICog5Y+W5b6X44GX44GfVGlsZWRNYXBFZGl044Gu44OH44O844K/44KS44OR44O844K544GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXJzZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvL+OCv+OCpOODq+WxnuaAp+aDheWgseWPluW+l1xuICAgICAgICB2YXIgbWFwID0gZGF0YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbWFwJylbMF07XG4gICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0clRvSlNPTihtYXApO1xuICAgICAgICB0aGlzLiRleHRlbmQoYXR0cik7XG4gICAgICAgIHRoaXMucHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXNUb0pTT04obWFwKTtcblxuICAgICAgICAvL+OCv+OCpOODq+OCu+ODg+ODiOWPluW+l1xuICAgICAgICB0aGlzLnRpbGVzZXRzID0gdGhpcy5fcGFyc2VUaWxlc2V0cyhkYXRhKTtcblxuICAgICAgICAvL+OCv+OCpOODq+OCu+ODg+ODiOaDheWgseijnOWujFxuICAgICAgICB2YXIgZGVmYXVsdEF0dHIgPSB7XG4gICAgICAgICAgICB0aWxld2lkdGg6IDMyLFxuICAgICAgICAgICAgdGlsZWhlaWdodDogMzIsXG4gICAgICAgICAgICBzcGFjaW5nOiAwLFxuICAgICAgICAgICAgbWFyZ2luOiAwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRpbGVzZXRzLmNoaXBzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50aWxlc2V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy/jgr/jgqTjg6vjgrvjg4Pjg4jlsZ7mgKfmg4XloLHlj5blvpdcbiAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0clRvSlNPTihkYXRhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aWxlc2V0JylbaV0pO1xuICAgICAgICAgICAgYXR0ci4kc2FmZShkZWZhdWx0QXR0cik7XG4gICAgICAgICAgICBhdHRyLmZpcnN0Z2lkLS07XG4gICAgICAgICAgICB0aGlzLnRpbGVzZXRzW2ldLiRleHRlbmQoYXR0cik7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX44OB44OD44OX44Oq44K544OI5L2c5oiQXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMudGlsZXNldHNbaV07XG4gICAgICAgICAgICB0aGlzLnRpbGVzZXRzW2ldLm1hcENoaXAgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIHIgPSBhdHRyLmZpcnN0Z2lkOyByIDwgYXR0ci5maXJzdGdpZCthdHRyLnRpbGVjb3VudDsgcisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNoaXAgPSB7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiB0LmltYWdlLFxuICAgICAgICAgICAgICAgICAgICB4OiAoKHIgLSBhdHRyLmZpcnN0Z2lkKSAlIHQuY29sdW1ucykgKiAodC50aWxld2lkdGggKyB0LnNwYWNpbmcpICsgdC5tYXJnaW4sXG4gICAgICAgICAgICAgICAgICAgIHk6IE1hdGguZmxvb3IoKHIgLSBhdHRyLmZpcnN0Z2lkKSAvIHQuY29sdW1ucykgKiAodC50aWxlaGVpZ2h0ICsgdC5zcGFjaW5nKSArIHQubWFyZ2luLFxuICAgICAgICAgICAgICAgIH0uJHNhZmUoYXR0cik7XG4gICAgICAgICAgICAgICAgdGhpcy50aWxlc2V0cy5jaGlwc1tyXSA9IGNoaXA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODrOOCpOODpOODvOWPluW+l1xuICAgICAgICB0aGlzLmxheWVycyA9IHRoaXMuX3BhcnNlTGF5ZXJzKGRhdGEpO1xuXG4gICAgICAgIC8v44Kk44Oh44O844K444OH44O844K/6Kqt44G/6L6844G/XG4gICAgICAgIHRoaXMuX2NoZWNrSW1hZ2UoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfY2hlY2tJbWFnZVxuICAgICAqIOOCouOCu+ODg+ODiOOBq+eEoeOBhOOCpOODoeODvOOCuOODh+ODvOOCv+OCkuODgeOCp+ODg+OCr+OBl+OBpuiqreOBv+i+vOOBv+OCkuihjOOBhOOBvuOBmeOAglxuICAgICAqXG4gICAgICog5YaF6YOo44Gn5L2/55So44GX44Gm44GE44KL6Zai5pWw44Gn44GZ44CCXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY2hlY2tJbWFnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIGltYWdlU291cmNlID0gW107XG4gICAgICAgIHZhciBsb2FkSW1hZ2UgPSBbXTtcblxuICAgICAgICAvL+S4gOimp+S9nOaIkFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudGlsZXNldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICAgICAgaW1hZ2U6IHRoaXMudGlsZXNldHNbaV0uaW1hZ2UsXG4gICAgICAgICAgICAgICAgdHJhbnNSOiB0aGlzLnRpbGVzZXRzW2ldLnRyYW5zUixcbiAgICAgICAgICAgICAgICB0cmFuc0c6IHRoaXMudGlsZXNldHNbaV0udHJhbnNHLFxuICAgICAgICAgICAgICAgIHRyYW5zQjogdGhpcy50aWxlc2V0c1tpXS50cmFuc0IsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaW1hZ2VTb3VyY2UucHVzaChvYmopO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sYXllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS5pbWFnZSkge1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiB0aGlzLmxheWVyc1tpXS5pbWFnZS5zb3VyY2VcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGltYWdlU291cmNlLnB1c2gob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44Ki44K744OD44OI44Gr44GC44KL44GL56K66KqNXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW1hZ2VTb3VyY2UubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpbWFnZSA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ2ltYWdlJywgaW1hZ2VTb3VyY2VbaV0uaW1hZ2UpO1xuICAgICAgICAgICAgaWYgKGltYWdlKSB7XG4gICAgICAgICAgICAgICAgLy/jgqLjgrvjg4Pjg4jjgavjgYLjgotcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy/jgarjgYvjgaPjgZ/jga7jgafjg63jg7zjg4njg6rjgrnjg4jjgavov73liqBcbiAgICAgICAgICAgICAgICBsb2FkSW1hZ2UucHVzaChpbWFnZVNvdXJjZVtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4gOaLrOODreODvOODiVxuICAgICAgICAvL+ODreODvOODieODquOCueODiOS9nOaIkFxuICAgICAgICB2YXIgYXNzZXRzID0ge1xuICAgICAgICAgICAgaW1hZ2U6IFtdXG4gICAgICAgIH07XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbG9hZEltYWdlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvL+OCpOODoeODvOOCuOOBruODkeOCueOCkuODnuODg+ODl+OBqOWQjOOBmOOBq+OBmeOCi1xuICAgICAgICAgICAgYXNzZXRzLmltYWdlW2xvYWRJbWFnZVtpXS5pbWFnZV0gPSB0aGlzLnBhdGgrbG9hZEltYWdlW2ldLmltYWdlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsb2FkSW1hZ2UubGVuZ3RoKSB7XG4gICAgICAgICAgICB2YXIgbG9hZGVyID0gcGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIoKTtcbiAgICAgICAgICAgIGxvYWRlci5sb2FkKGFzc2V0cyk7XG4gICAgICAgICAgICBsb2FkZXIub24oJ2xvYWQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgLy/pgI/pgY7oibLoqK3lrprlj43mmKBcbiAgICAgICAgICAgICAgICBsb2FkSW1hZ2UuZm9yRWFjaChmdW5jdGlvbihlbG0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgnaW1hZ2UnLCBlbG0uaW1hZ2UpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZWxtLnRyYW5zUiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IGVsbS50cmFuc1IsIGcgPSBlbG0udHJhbnNHLCBiID0gZWxtLnRyYW5zQjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLmZpbHRlcihmdW5jdGlvbihwaXhlbCwgaW5kZXgsIHgsIHksIGJpdG1hcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gYml0bWFwLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsWzBdID09IHIgJiYgcGl4ZWxbMV0gPT0gZyAmJiBwaXhlbFsyXSA9PSBiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrM10gPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy/oqq3jgb/ovrzjgb/ntYLkuoZcbiAgICAgICAgICAgICAgICB0aGF0Ll9yZXNvbHZlKHRoYXQpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8v6Kqt44G/6L6844G/57WC5LqGXG4gICAgICAgICAgICB0aGlzLl9yZXNvbHZlKHRoYXQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3NldE1hcENoaXBcbiAgICAgKiDjgq3jg6Pjg7Pjg5Djgrnjga7mjIflrprjgZfjgZ/luqfmqJnjgavjg57jg4Pjg5fjg4Hjg4Pjg5fjga7jgqTjg6Hjg7zjgrjjgpLjgrPjg5Tjg7zjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NldE1hcENoaXA6IGZ1bmN0aW9uKGNhbnZhcywgaW5kZXgsIHgsIHksIG9wYWNpdHkpIHtcbiAgICAgICAgLy/jgr/jgqTjg6vjgrvjg4Pjg4jjgYvjgonjg57jg4Pjg5fjg4Hjg4Pjg5fjgpLlj5blvpdcbiAgICAgICAgdmFyIGNoaXAgPSB0aGlzLnRpbGVzZXRzLmNoaXBzW2luZGV4XTtcbiAgICAgICAgaWYgKCFjaGlwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGltYWdlID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgnaW1hZ2UnLCBjaGlwLmltYWdlKTtcbiAgICAgICAgaWYgKCFpbWFnZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coY2hpcC5pbWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FudmFzLmNvbnRleHQuZHJhd0ltYWdlKFxuICAgICAgICAgICAgaW1hZ2UuZG9tRWxlbWVudCxcbiAgICAgICAgICAgIGNoaXAueCArIGNoaXAubWFyZ2luLCBjaGlwLnkgKyBjaGlwLm1hcmdpbixcbiAgICAgICAgICAgIGNoaXAudGlsZXdpZHRoLCBjaGlwLnRpbGVoZWlnaHQsXG4gICAgICAgICAgICB4LCB5LFxuICAgICAgICAgICAgY2hpcC50aWxld2lkdGgsIGNoaXAudGlsZWhlaWdodCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Byb3BlcnRpZXNUb0pTT05cbiAgICAgKiBYTUzjg5fjg63jg5Hjg4bjgqPjgpJKU09O44Gr5aSJ5o+b44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wcm9wZXJ0aWVzVG9KU09OOiBmdW5jdGlvbihlbG0pIHtcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBlbG0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJwcm9wZXJ0aWVzXCIpWzBdO1xuICAgICAgICB2YXIgb2JqID0ge307XG4gICAgICAgIGlmIChwcm9wZXJ0aWVzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBwcm9wZXJ0aWVzLmNoaWxkTm9kZXMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIHZhciBwID0gcHJvcGVydGllcy5jaGlsZE5vZGVzW2tdO1xuICAgICAgICAgICAgaWYgKHAudGFnTmFtZSA9PT0gXCJwcm9wZXJ0eVwiKSB7XG4gICAgICAgICAgICAgICAgLy9wcm9wZXJ0eeOBq3R5cGXmjIflrprjgYzjgYLjgaPjgZ/jgonlpInmj5tcbiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IHAuZ2V0QXR0cmlidXRlKCd0eXBlJyk7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gcC5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJyk7XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkgdmFsdWUgPSBwLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgIGlmICh0eXBlID09IFwiaW50XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqW3AuZ2V0QXR0cmlidXRlKCduYW1lJyldID0gcGFyc2VJbnQodmFsdWUsIDEwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJmbG9hdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIG9ialtwLmdldEF0dHJpYnV0ZSgnbmFtZScpXSA9IHBhcnNlRmxvYXQodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImJvb2xcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IFwidHJ1ZVwiKSBvYmpbcC5nZXRBdHRyaWJ1dGUoJ25hbWUnKV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIG9ialtwLmdldEF0dHJpYnV0ZSgnbmFtZScpXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9ialtwLmdldEF0dHJpYnV0ZSgnbmFtZScpXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9wcm9wZXJ0aWVzVG9KU09OXG4gICAgICogWE1M5bGe5oCn5oOF5aCx44KSSlNPTuOBq+WkieaPm+OBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICog5YaF6YOo44Gn5L2/55So44GX44Gm44GE44KL6Zai5pWw44Gn44GZ44CCXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfYXR0clRvSlNPTjogZnVuY3Rpb24oc291cmNlKSB7XG4gICAgICAgIHZhciBvYmogPSB7fTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2UuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHZhbCA9IHNvdXJjZS5hdHRyaWJ1dGVzW2ldLnZhbHVlO1xuICAgICAgICAgICAgdmFsID0gaXNOYU4ocGFyc2VGbG9hdCh2YWwpKT8gdmFsOiBwYXJzZUZsb2F0KHZhbCk7XG4gICAgICAgICAgICBvYmpbc291cmNlLmF0dHJpYnV0ZXNbaV0ubmFtZV0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfcHJvcGVydGllc1RvSlNPTl9zdHJcbiAgICAgKiBYTUzjg5fjg63jg5Hjg4bjgqPjgpJKU09O44Gr5aSJ5o+b44GX44CB5paH5a2X5YiX44Gn6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9hdHRyVG9KU09OX3N0cjogZnVuY3Rpb24oc291cmNlKSB7XG4gICAgICAgIHZhciBvYmogPSB7fTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2UuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHZhbCA9IHNvdXJjZS5hdHRyaWJ1dGVzW2ldLnZhbHVlO1xuICAgICAgICAgICAgb2JqW3NvdXJjZS5hdHRyaWJ1dGVzW2ldLm5hbWVdID0gdmFsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BhcnNlVGlsZXNldHNcbiAgICAgKiDjgr/jgqTjg6vjgrvjg4Pjg4jjga7jg5Hjg7zjgrnjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3BhcnNlVGlsZXNldHM6IGZ1bmN0aW9uKHhtbCkge1xuICAgICAgICB2YXIgZWFjaCA9IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciBkYXRhID0gW107XG4gICAgICAgIHZhciB0aWxlc2V0cyA9IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGlsZXNldCcpO1xuICAgICAgICBlYWNoLmNhbGwodGlsZXNldHMsIGZ1bmN0aW9uKHRpbGVzZXQpIHtcbiAgICAgICAgICAgIHZhciB0ID0ge307XG4gICAgICAgICAgICB2YXIgcHJvcHMgPSBzZWxmLl9wcm9wZXJ0aWVzVG9KU09OKHRpbGVzZXQpO1xuICAgICAgICAgICAgaWYgKHByb3BzLnNyYykge1xuICAgICAgICAgICAgICAgIHQuaW1hZ2UgPSBwcm9wcy5zcmM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHQuaW1hZ2UgPSB0aWxlc2V0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbWFnZScpWzBdLmdldEF0dHJpYnV0ZSgnc291cmNlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+mAj+mBjuiJsuioreWumuWPluW+l1xuICAgICAgICAgICAgdC50cmFucyA9IHRpbGVzZXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltYWdlJylbMF0uZ2V0QXR0cmlidXRlKCd0cmFucycpO1xuICAgICAgICAgICAgaWYgKHQudHJhbnMpIHtcbiAgICAgICAgICAgICAgICB0LnRyYW5zUiA9IHBhcnNlSW50KHQudHJhbnMuc3Vic3RyaW5nKDAsIDIpLCAxNik7XG4gICAgICAgICAgICAgICAgdC50cmFuc0cgPSBwYXJzZUludCh0LnRyYW5zLnN1YnN0cmluZygyLCA0KSwgMTYpO1xuICAgICAgICAgICAgICAgIHQudHJhbnNCID0gcGFyc2VJbnQodC50cmFucy5zdWJzdHJpbmcoNCwgNiksIDE2KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGF0YS5wdXNoKHQpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BhcnNlTGF5ZXJzXG4gICAgICog44Os44Kk44Ok44O85oOF5aCx44Gu44OR44O844K544KS6KGM44GE44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXJzZUxheWVyczogZnVuY3Rpb24oeG1sKSB7XG4gICAgICAgIHZhciBlYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2g7XG4gICAgICAgIHZhciBkYXRhID0gW107XG5cbiAgICAgICAgdmFyIG1hcCA9IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIm1hcFwiKVswXTtcbiAgICAgICAgdmFyIGxheWVycyA9IFtdO1xuICAgICAgICBlYWNoLmNhbGwobWFwLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKGVsbSkge1xuICAgICAgICAgICAgaWYgKGVsbS50YWdOYW1lID09IFwibGF5ZXJcIiB8fCBlbG0udGFnTmFtZSA9PSBcIm9iamVjdGdyb3VwXCIgfHwgZWxtLnRhZ05hbWUgPT0gXCJpbWFnZWxheWVyXCIpIHtcbiAgICAgICAgICAgICAgICBsYXllcnMucHVzaChlbG0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBsYXllcnMuZWFjaChmdW5jdGlvbihsYXllcikge1xuICAgICAgICAgICAgc3dpdGNoIChsYXllci50YWdOYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImxheWVyXCI6XG4gICAgICAgICAgICAgICAgICAgIC8v6YCa5bi444Os44Kk44Ok44O8XG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gbGF5ZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RhdGEnKVswXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuY29kaW5nID0gZC5nZXRBdHRyaWJ1dGUoXCJlbmNvZGluZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImxheWVyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmNvZGluZyA9PSBcImNzdlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsLmRhdGEgPSB0aGlzLl9wYXJzZUNTVihkLnRleHRDb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbmNvZGluZyA9PSBcImJhc2U2NFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsLmRhdGEgPSB0aGlzLl9wYXJzZUJhc2U2NChkLnRleHRDb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0clRvSlNPTihsYXllcik7XG4gICAgICAgICAgICAgICAgICAgIGwuJGV4dGVuZChhdHRyKTtcbiAgICAgICAgICAgICAgICAgICAgbC5wcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllc1RvSlNPTihsYXllcik7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKGwpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIC8v44Kq44OW44K444Kn44Kv44OI44Os44Kk44Ok44O8XG4gICAgICAgICAgICAgICAgY2FzZSBcIm9iamVjdGdyb3VwXCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBsID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJvYmplY3Rncm91cFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0czogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgeDogcGFyc2VGbG9hdChsYXllci5nZXRBdHRyaWJ1dGUoXCJvZmZzZXR4XCIpKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgeTogcGFyc2VGbG9hdChsYXllci5nZXRBdHRyaWJ1dGUoXCJvZmZzZXR5XCIpKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IGxheWVyLmdldEF0dHJpYnV0ZShcIm9wYWNpdHlcIikgfHwgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJjb2xvclwiKSB8fCBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhd29yZGVyOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJkcmF3b3JkZXJcIikgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgbC5wcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllc1RvSlNPTihsYXllcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy/jg6zjgqTjg6Tjg7zlhoXop6PmnpBcbiAgICAgICAgICAgICAgICAgICAgZWFjaC5jYWxsKGxheWVyLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKGVsbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsbS5ub2RlVHlwZSA9PSAzKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2F0dHJUb0pTT04oZWxtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLmlkID09PSB1bmRlZmluZWQpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXNUb0pTT04oZWxtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v5a2Q6KaB57Sg44Gu6Kej5p6QXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxtLmNoaWxkTm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxtLmNoaWxkTm9kZXMuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVUeXBlID09IDMpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/mpZXlhoZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUubm9kZU5hbWUgPT0gJ2VsbGlwc2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmVsbGlwc2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5aSa6KeS5b2iXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVOYW1lID09ICdwb2x5Z29uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wb2x5Z29uID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IHRoaXMuX2F0dHJUb0pTT05fc3RyKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBsID0gYXR0ci5wb2ludHMuc3BsaXQoXCIgXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGwuZm9yRWFjaChmdW5jdGlvbihzdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHRzID0gc3RyLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnBvbHlnb24ucHVzaCh7eDogcGFyc2VGbG9hdChwdHNbMF0pLCB5OiBwYXJzZUZsb2F0KHB0c1sxXSl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v57ea5YiGXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5vZGVOYW1lID09ICdwb2x5bGluZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucG9seWxpbmUgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0clRvSlNPTl9zdHIoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGwgPSBhdHRyLnBvaW50cy5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbC5mb3JFYWNoKGZ1bmN0aW9uKHN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwdHMgPSBzdHIuc3BsaXQoXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucG9seWxpbmUucHVzaCh7eDogcGFyc2VGbG9hdChwdHNbMF0pLCB5OiBwYXJzZUZsb2F0KHB0c1sxXSl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGwub2JqZWN0cy5wdXNoKGQpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChsKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAvL+OCpOODoeODvOOCuOODrOOCpOODpOODvFxuICAgICAgICAgICAgICAgIGNhc2UgXCJpbWFnZWxheWVyXCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBsID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpbWFnZWxheWVyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBsYXllci5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgeDogcGFyc2VGbG9hdChsYXllci5nZXRBdHRyaWJ1dGUoXCJvZmZzZXR4XCIpKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgeTogcGFyc2VGbG9hdChsYXllci5nZXRBdHRyaWJ1dGUoXCJvZmZzZXR5XCIpKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IGxheWVyLmdldEF0dHJpYnV0ZShcIm9wYWNpdHlcIikgfHwgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IChsYXllci5nZXRBdHRyaWJ1dGUoXCJ2aXNpYmxlXCIpID09PSB1bmRlZmluZWQgfHwgbGF5ZXIuZ2V0QXR0cmlidXRlKFwidmlzaWJsZVwiKSAhPSAwKSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlRWxtID0gbGF5ZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpbWFnZVwiKVswXTtcbiAgICAgICAgICAgICAgICAgICAgbC5pbWFnZSA9IHtzb3VyY2U6IGltYWdlRWxtLmdldEF0dHJpYnV0ZShcInNvdXJjZVwiKX07XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKGwpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BlcnNlQ1NWXG4gICAgICogQ1NW44Gu44OR44O844K544KS6KGM44GE44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXJzZUNTVjogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICB2YXIgZGF0YUxpc3QgPSBkYXRhLnNwbGl0KCcsJyk7XG4gICAgICAgIHZhciBsYXllciA9IFtdO1xuXG4gICAgICAgIGRhdGFMaXN0LmVhY2goZnVuY3Rpb24oZWxtLCBpKSB7XG4gICAgICAgICAgICB2YXIgbnVtID0gcGFyc2VJbnQoZWxtLCAxMCkgLSAxO1xuICAgICAgICAgICAgbGF5ZXIucHVzaChudW0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gbGF5ZXI7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3BlcnNlQ1NWXG4gICAgICogQkFTRTY044Gu44OR44O844K544KS6KGM44GE44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBodHRwOi8vdGhla2Fubm9uLXNlcnZlci5hcHBzcG90LmNvbS9oZXJwaXR5LWRlcnBpdHkuYXBwc3BvdC5jb20vcGFzdGViaW4uY29tLzc1S2tzMFdIXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcGFyc2VCYXNlNjQ6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgdmFyIGRhdGFMaXN0ID0gYXRvYihkYXRhLnRyaW0oKSk7XG4gICAgICAgIHZhciByc3QgPSBbXTtcblxuICAgICAgICBkYXRhTGlzdCA9IGRhdGFMaXN0LnNwbGl0KCcnKS5tYXAoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgcmV0dXJuIGUuY2hhckNvZGVBdCgwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yICh2YXIgaT0wLGxlbj1kYXRhTGlzdC5sZW5ndGgvNDsgaTxsZW47ICsraSkge1xuICAgICAgICAgICAgdmFyIG4gPSBkYXRhTGlzdFtpKjRdO1xuICAgICAgICAgICAgcnN0W2ldID0gcGFyc2VJbnQobiwgMTApIC0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByc3Q7XG4gICAgfSxcbn0pO1xuXG4vL+ODreODvOODgOODvOOBq+i/veWKoFxucGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIuYXNzZXRMb2FkRnVuY3Rpb25zLnRteCA9IGZ1bmN0aW9uKGtleSwgcGF0aCkge1xuICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5UaWxlZE1hcCgpO1xuICAgIHJldHVybiB0bXgubG9hZChwYXRoKTtcbn07XG4iLCIvKlxuICogIHBoaW5hLnZpcnR1YWxwYWQuanNcbiAqICAyMDE3LzA2LzEzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxucGhpbmEuZXh0ZW5zaW9uID0gcGhpbmEuZXh0ZW5zaW9uIHx8IHt9O1xuXG4vL+ODkOODvOODgeODo+ODq+ODkeODg+ODiVxucGhpbmEuZGVmaW5lKFwicGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgYWN0aXZlOiB0cnVlLFxuXG4gICAgLy/mjL/kuIvjgq3jg7zmg4XloLFcbiAgICBrZXlEYXRhOiB7XG4gICAgICAgIHVwOiBmYWxzZSxcbiAgICAgICAgZG93bjogZmFsc2UsXG4gICAgICAgIGxlZnQ6IGZhbHNlLFxuICAgICAgICByaWdodDogZmFsc2UsXG4gICAgICAgIGE6IGZhbHNlLFxuICAgICAgICBiOiBmYWxzZSxcbiAgICB9LFxuXG4gICAgZGVmYXVsdE9wdGlvbnM6IHtcbiAgICAgICAgLy/jg5Hjg4Pjg4nnuKbmqKpcbiAgICAgICAgd2lkdGg6IDY0MCxcbiAgICAgICAgaGVpZ2h0OiA0ODAsXG5cbiAgICAgICAgLy/jg5Hjg4Pjg4nluqfmqJlcbiAgICAgICAgeDogMCxcbiAgICAgICAgeTogMCxcblxuICAgICAgICAvL+WIpOWumuWNiuW+hFxuICAgICAgICBmaW5nZXJSYWRpdXM6IDIwLFxuICAgIH0sXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG5cbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6IG9wdGlvbnMud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IG9wdGlvbnMuaGVpZ2h0LFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuMylcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDAuMylcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZ3RoOiAwLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1hc2sgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuLy8gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldE9yaWdpbigwLCAwKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKG9wdGlvbnMueCwgb3B0aW9ucy55KTtcblxuICAgICAgICB0aGlzLmFuYWxvZyA9IHBoaW5hLmV4dGVuc2lvbi5WaXJ0dWFsUGFkLkFuYWxvZ1N0aWNrKClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oODIsIG9wdGlvbnMuaGVpZ2h0IC0gODIpO1xuXG4gICAgICAgIHRoaXMuYnRuID0gW107XG4gICAgICAgIHRoaXMuYnRuWzBdID0gcGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWQuQnV0dG9uKCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihvcHRpb25zLndpZHRoICogMC43LCBvcHRpb25zLmhlaWdodCAqIDAuOSk7XG4gICAgICAgIHRoaXMuYnRuWzFdID0gcGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWQuQnV0dG9uKCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihvcHRpb25zLndpZHRoICogMC43ICsgODAsIG9wdGlvbnMuaGVpZ2h0ICogMC45KTtcblxuICAgICAgICAvL+OCv+ODg+ODl+S9jee9ruihqOekulxuICAgICAgICB2YXIgZmluZ2VyUGFyYW0gPSB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC4yKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMC4yKVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG4gICAgICAgICAgICByYWRpdXM6IG9wdGlvbnMuZmluZ2VyUmFkaXVzLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmZpbmdlciA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5maW5nZXJbaV0gPSBwaGluYS5kaXNwbGF5LkNpcmNsZVNoYXBlKGZpbmdlclBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5maW5nZXJbaV0udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIHVwZGF0ZUluZm86IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcCA9IGFwcC5tb3VzZTtcbiAgICAgICAgaWYgKHAuZ2V0UG9pbnRpbmcoKSkge1xuICAgICAgICAgICAgLy/jgr/jg4Pjg5fkvY3nva7ooajnpLpcbiAgICAgICAgICAgIHZhciBwcyA9IGFwcC5wb2ludGVycztcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGkgPCBwcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5nZXJbaV0udmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZ2VyW2ldLnNldFBvc2l0aW9uKHBzW2ldLngsIHBzW2ldLnkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZ2VyW2ldLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmluZ2VyW2ldLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRLZXk6IGZ1bmN0aW9uKGNvZGUpIHtcbiAgICAgICAgdmFyIG92ID0gMTA7XG4gICAgICAgIHZhciBhbmdsZSA9IHRoaXMuYW5hbG9nLmFuZ2xlO1xuICAgICAgICBzd2l0Y2ggKGNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBhbmdsZSAmJiAoYW5nbGUgPj0gMzE1IC0gb3YgfHwgYW5nbGUgPD0gNDUgKyBvdik7XG4gICAgICAgICAgICBjYXNlIFwiZG93blwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBhbmdsZSAmJiAoYW5nbGUgPj0gNDUgLSBvdiAmJiBhbmdsZSA8PSAxMzUgKyBvdik7XG4gICAgICAgICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBhbmdsZSAmJiAoYW5nbGUgPj0gMTM1IC0gb3YgJiYgYW5nbGUgPD0gMjE1ICsgb3YpO1xuICAgICAgICAgICAgY2FzZSBcInVwXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ2xlICYmIChhbmdsZSA+PSAyMTUgLSBvdiAmJiBhbmdsZSA8PSAzMTUgKyBvdik7XG4gICAgICAgICAgICBjYXNlIFwielwiOlxuICAgICAgICAgICAgY2FzZSBcIlpcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5idG5bMF0uaXNPbjtcbiAgICAgICAgICAgIGNhc2UgXCJ4XCI6XG4gICAgICAgICAgICBjYXNlIFwiWFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ0blsxXS5pc09uO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG5cbi8v44OQ44O844OB44Oj44Or44OR44OD44OJ5Y2B5a2X44Kt44O8XG5waGluYS5kZWZpbmUoXCJwaGluYS5leHRlbnNpb24uVmlydHVhbFBhZC5Dcm9zc0tleVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICBhY3RpdmU6IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG5cbiAgICAgICAgLy/ljYHlrZfjgq3jg7zkuK3lv4PngrlcbiAgICAgICAgdmFyIGh3ID0gMDtcbiAgICAgICAgdmFyIGhoID0gMDtcbiAgICAgICAgdmFyIGNwID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuXG4gICAgICAgIHZhciBidXR0b24gPSB7XG4gICAgICAgICAgICB3aWR0aDogMjAsXG4gICAgICAgICAgICBoZWlnaHQ6IDIwLFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuMilcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDAuMilcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgLy8wOuS4iiAxOuWPs+S4iiAyOuWPsyAzOuWPs+S4iyA0OuS4iyA1OuW3puS4iyA2OuW3piA3OuW3puS4ilxuICAgICAgICB0aGlzLmJ0biA9IFtdO1xuICAgICAgICB0aGlzLmJ0blswXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiA2MCwgaGVpZ2h0OiA1MH0uJHNhZmUoYnV0dG9uKSkuc2V0UG9zaXRpb24oY3AueCAgICAgLCBjcC55IC0gNDApLmFkZENoaWxkVG8odGhpcykuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMuYnRuWzJdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDUwLCBoZWlnaHQ6IDYwfS4kc2FmZShidXR0b24pKS5zZXRQb3NpdGlvbihjcC54ICsgNDAsIGNwLnkgICAgICkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgdGhpcy5idG5bNF0gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogNjAsIGhlaWdodDogNTB9LiRzYWZlKGJ1dHRvbikpLnNldFBvc2l0aW9uKGNwLnggICAgICwgY3AueSArIDQwKS5hZGRDaGlsZFRvKHRoaXMpLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB0aGlzLmJ0bls2XSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiA1MCwgaGVpZ2h0OiA2MH0uJHNhZmUoYnV0dG9uKSkuc2V0UG9zaXRpb24oY3AueCAtIDQwLCBjcC55ICAgICApLmFkZENoaWxkVG8odGhpcykuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG5cbiAgICAgICAgdGhpcy5idG5bMV0gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMzAsIGhlaWdodDogMzB9LiRzYWZlKGJ1dHRvbikpLnNldFBvc2l0aW9uKGNwLnggKyA0MCwgY3AueSAtIDQwKS5hZGRDaGlsZFRvKHRoaXMpLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB0aGlzLmJ0blszXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAzMCwgaGVpZ2h0OiAzMH0uJHNhZmUoYnV0dG9uKSkuc2V0UG9zaXRpb24oY3AueCArIDQwLCBjcC55ICsgNDApLmFkZENoaWxkVG8odGhpcykuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMuYnRuWzVdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDMwLCBoZWlnaHQ6IDMwfS4kc2FmZShidXR0b24pKS5zZXRQb3NpdGlvbihjcC54IC0gNDAsIGNwLnkgKyA0MCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgdGhpcy5idG5bN10gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMzAsIGhlaWdodDogMzB9LiRzYWZlKGJ1dHRvbikpLnNldFBvc2l0aW9uKGNwLnggLSA0MCwgY3AueSAtIDQwKS5hZGRDaGlsZFRvKHRoaXMpLnNldEludGVyYWN0aXZlKHRydWUpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5idG4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuYnRuW2ldLmlzT24gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuYnRuW2ldLm9uKCdwb2ludG92ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzT24gPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmJ0bltpXS5vbigncG9pbnRvdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzT24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/mjL/kuIvjgq3jg7zmg4XloLFcbiAgICAgICAgdGhpcy5rZXlkYXRhID0ge1xuICAgICAgICAgICAgdXA6IGZhbHNlLFxuICAgICAgICAgICAgZG93bjogZmFsc2UsXG4gICAgICAgICAgICBsZWZ0OiBmYWxzZSxcbiAgICAgICAgICAgIHJpZ2h0OiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5rZXlkYXRhID0ge1xuICAgICAgICAgICAgdXA6IHRoaXMuYnRuWzBdLmlzT24gfHwgdGhpcy5idG5bMV0uaXNPbiB8fCB0aGlzLmJ0bls3XS5pc09uLFxuICAgICAgICAgICAgcmlnaHQ6IHRoaXMuYnRuWzJdLmlzT24gfHwgdGhpcy5idG5bMV0uaXNPbiB8fCB0aGlzLmJ0blszXS5pc09uLFxuICAgICAgICAgICAgZG93bjogdGhpcy5idG5bNF0uaXNPbiB8fCB0aGlzLmJ0blszXS5pc09uIHx8IHRoaXMuYnRuWzVdLmlzT24sXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLmJ0bls2XS5pc09uIHx8IHRoaXMuYnRuWzVdLmlzT24gfHwgdGhpcy5idG5bN10uaXNPbixcbiAgICAgICAgfTtcbiAgICB9LFxufSk7XG5cbi8v44OQ44O844OB44Oj44Or44OR44OD44OJ44Oc44K/44OzXG5waGluYS5kZWZpbmUoXCJwaGluYS5leHRlbnNpb24uVmlydHVhbFBhZC5CdXR0b25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgYWN0aXZlOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHJhZGl1czogb3B0aW9ucy5yYWRpdXMgfHwgMzAsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC4zKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJ0biA9IHBoaW5hLmRpc3BsYXkuQ2lyY2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB0aGlzLmJ0bi5vbigncG9pbnRvdmVyJywgZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzT24gPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5idG4ub24oJ3BvaW50b3V0JywgZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzT24gPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfSxcbn0pO1xuXG4vL+ODkOODvOODgeODo+ODq+ODkeODg+ODieOCouODiuODreOCsOOCueODhuOCo+ODg+OCr1xucGhpbmEuZGVmaW5lKFwicGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWQuQW5hbG9nU3RpY2tcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5DaXJjbGVTaGFwZVwiLFxuXG4gICAgYWN0aXZlOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7XG4gICAgICAgICAgICByYWRpdXM6IDgwLFxuICAgICAgICAgICAgZmlsbDogbnVsbCxcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMylcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/kuK3lv4PngrlcbiAgICAgICAgdmFyIGh3ID0gMDtcbiAgICAgICAgdmFyIGhoID0gMDtcbiAgICAgICAgdmFyIGNwID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHJhZGl1czogMjAsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC4zKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMC4zKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmlubmVyID0gcGhpbmEuZGlzcGxheS5DaXJjbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMudmVjdG9yID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuICAgICAgICB0aGlzLnB0ID0gbnVsbDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCFhcHAucG9pbnRlci5nZXRQb2ludGluZygpKSB7XG4gICAgICAgICAgICB0aGlzLnZlY3Rvci5zZXQoMCwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHBvaW50ZXJzID0gYXBwLnBvaW50ZXJzO1xuICAgICAgICBwb2ludGVycy5mb3JFYWNoKHBvaW50ZXIgPT4ge1xuICAgICAgICAgICAgaWYgKHBvaW50ZXIuZ2V0UG9pbnRpbmdTdGFydCgpICYmIHRoaXMuaGl0VGVzdChwb2ludGVyLngsIHBvaW50ZXIueSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnB0ID0gcG9pbnRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLnB0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wdC5nZXRQb2ludGluZygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52ZWN0b3Iuc2V0KHRoaXMucHQueCAtIHRoaXMueCwgdGhpcy5wdC55IC0gdGhpcy55KS5ub3JtYWxpemUoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wdC5nZXRQb2ludGluZ0VuZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52ZWN0b3Iuc2V0KDAsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5uZXIueCA9IHRoaXMudmVjdG9yLnggKiB0aGlzLnJhZGl1cyAqIDAuNjtcbiAgICAgICAgdGhpcy5pbm5lci55ID0gdGhpcy52ZWN0b3IueSAqIHRoaXMucmFkaXVzICogMC42O1xuXG4gICAgICAgIC8v6KeS5bqmXG4gICAgICAgIGlmICh0aGlzLnZlY3Rvci54ID09IDAgJiYgdGhpcy52ZWN0b3IueSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmFuZ2xlID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYW5nbGUgPSBNYXRoLmZsb29yKE1hdGguYXRhbjIodGhpcy52ZWN0b3IueSwgdGhpcy52ZWN0b3IueCkudG9EZWdyZWUoKSk7XG4gICAgICAgICAgICBpZiAodGhpcy5hbmdsZSA8IDApIHRoaXMuYW5nbGUgKz0gMzYwO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBTb3VuZFNldC5qc1xuICogIDIwMTQvMTEvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG5waGluYS5leHRlbnNpb24gPSBwaGluYS5leHRlbnNpb24gfHwge307XG5cbi8v44K144Km44Oz44OJ566h55CGXG5waGluYS5kZWZpbmUoXCJwaGluYS5leHRlbnNpb24uU291bmRTZXRcIiwge1xuXG4gICAgLy/jgrXjgqbjg7Pjg4njgYzmoLzntI3jgZXjgozjgovphY3liJdcbiAgICBlbGVtZW50czogbnVsbCxcblxuICAgIC8v5YaN55Sf5Lit77yi77yn77ytXG4gICAgYmdtOiBudWxsLFxuICAgIGJnbUlzUGxheTogZmFsc2UsXG5cbiAgICAvL+ODnuOCueOCv+ODvOODnOODquODpeODvOODoFxuICAgIHZvbHVtZUJHTTogMC41LFxuICAgIHZvbHVtZVNFOiAwLjUsXG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50cyA9IFtdO1xuICAgIH0sXG5cbiAgICAvL+eZu+mMsua4iOOBv+OCouOCu+ODg+ODiOiqreOBv+i+vOOBv1xuICAgIHJlYWRBc3NldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuYXNzZXRzLnNvdW5kKSB7XG4gICAgICAgICAgICB2YXIgb2JqID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcInNvdW5kXCIsIGtleSk7XG4gICAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgcGhpbmEuYXNzZXQuU291bmQpIHRoaXMuYWRkKGtleSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/jgrXjgqbjg7Pjg4nov73liqBcbiAgICBhZGQ6IGZ1bmN0aW9uKG5hbWUsIHVybCkge1xuICAgICAgICBpZiAobmFtZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gbnVsbDtcbiAgICAgICAgdXJsID0gdXJsIHx8IG51bGw7XG4gICAgICAgIGlmICh0aGlzLmZpbmQobmFtZSkpIHJldHVybiB0cnVlO1xuXG4gICAgICAgIHZhciBlID0gcGhpbmEuZXh0ZW5zaW9uLlNvdW5kRWxlbWVudChuYW1lKTtcbiAgICAgICAgaWYgKCFlLm1lZGlhKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHRoaXMuZWxlbWVudHMucHVzaChlKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K144Km44Oz44OJ5qSc57SiXG4gICAgZmluZDogZnVuY3Rpb24obmFtZSkge1xuICAgICAgICBpZiAoIXRoaXMuZWxlbWVudHMpIHJldHVybiBudWxsO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnRzW2ldLm5hbWUgPT0gbmFtZSkgcmV0dXJuIHRoaXMuZWxlbWVudHNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIC8v44K144Km44Oz44OJ44KS77yi77yn77yt44Go44GX44Gm5YaN55SfXG4gICAgcGxheUJHTTogZnVuY3Rpb24obmFtZSwgbG9vcCwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGxvb3AgPT09IHVuZGVmaW5lZCkgbG9vcCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLmJnbSkge1xuICAgICAgICAgICAgdGhpcy5iZ20uc3RvcCgpO1xuICAgICAgICAgICAgdGhpcy5iZ21Jc1BsYXkgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZmluZChuYW1lKTtcbiAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciB2b2wgPSB0aGlzLnZvbHVtZUJHTSAqIGVsZW1lbnQuX3ZvbHVtZTtcbiAgICAgICAgICAgIGVsZW1lbnQubWVkaWEudm9sdW1lID0gdm9sO1xuICAgICAgICAgICAgZWxlbWVudC5wbGF5KGxvb3AsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIHRoaXMuYmdtID0gZWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMuYmdtSXNQbGF5ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFkZChuYW1lKSkgdGhpcy5wbGF5QkdNKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL++8ou+8p++8reWBnOatolxuICAgIHN0b3BCR006IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5iZ20pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJnbUlzUGxheSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYmdtLnN0b3AoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJnbUlzUGxheSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5iZ20gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL++8ou+8p++8reS4gOaZguWBnOatolxuICAgIHBhdXNlQkdNOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuYmdtKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5iZ21Jc1BsYXkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJnbS5wYXVzZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYmdtSXNQbGF5ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v77yi77yn77yt5YaN6ZaLXG4gICAgcmVzdW1lQkdNOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuYmdtKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYmdtSXNQbGF5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5iZ20udm9sdW1lID0gdGhpcy52b2x1bWVCR007XG4gICAgICAgICAgICAgICAgdGhpcy5iZ20ucmVzdW1lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5iZ21Jc1BsYXkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL++8ou+8p++8reODnuOCueOCv+ODvOODnOODquODpeODvOODoOioreWumlxuICAgIHNldFZvbHVtZUJHTTogZnVuY3Rpb24odm9sKSB7XG4gICAgICAgIHRoaXMudm9sdW1lQkdNID0gdm9sO1xuICAgICAgICBpZiAodGhpcy5iZ20pIHtcbiAgICAgICAgICAgIHRoaXMuYmdtLnBhdXNlKCk7XG4gICAgICAgICAgICB0aGlzLmJnbS5zZXRWb2x1bWUodGhpcy52b2x1bWVCR00gKiB0aGlzLmJnbS5fdm9sdW1lKTtcbiAgICAgICAgICAgIHRoaXMuYmdtLnJlc3VtZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+OCouOCu+ODg+ODiOOCkuaMh+WumuOBl+OBpuODnOODquODpeODvOODoOOCkuioreWumlxuICAgIHNldFZvbHVtZTogZnVuY3Rpb24obmFtZSwgdm9sKSB7XG4gICAgICAgIHZhciBtZWRpYSA9IHRoaXMuZmluZChuYW1lKTtcbiAgICAgICAgaWYgKG1lZGlhKSB7XG4gICAgICAgICAgICBtZWRpYS5zZXRWb2x1bWUodm9sKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/jgrXjgqbjg7Pjg4njgpLjgrXjgqbjg7Pjg4njgqjjg5Xjgqfjgq/jg4jjgajjgZfjgablho3nlJ9cbiAgICBwbGF5U0U6IGZ1bmN0aW9uKG5hbWUsIGxvb3AsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5maW5kKG5hbWUpO1xuICAgICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHZvbCA9IHRoaXMudm9sdW1lU0UgKiBlbGVtZW50Ll92b2x1bWU7XG4gICAgICAgICAgICBlbGVtZW50Lm1lZGlhLnZvbHVtZSA9IHZvbDtcbiAgICAgICAgICAgIGVsZW1lbnQucGxheShsb29wLCBjYWxsYmFjayk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hZGQobmFtZSkpIHRoaXMucGxheVNFKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+ODq+ODvOODl+WGjeeUn+OBl+OBpuOBhOOCi1NF44KS5YGc5q2iXG4gICAgc3RvcFNFOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgIHZhciBtZWRpYSA9IHRoaXMuZmluZChuYW1lKTtcbiAgICAgICAgaWYgKG1lZGlhKSB7XG4gICAgICAgICAgICBtZWRpYS5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v77yi77yn77yt5LiA5pmC5YGc5q2iXG4gICAgcGF1c2VCR006IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5iZ20pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJnbUlzUGxheSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5iZ21Jc1BsYXkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/vvLPvvKXjg57jgrnjgr/jg7zjg5zjg6rjg6Xjg7zjg6DoqK3lrppcbiAgICBzZXRWb2x1bWVTRTogZnVuY3Rpb24odm9sKSB7XG4gICAgICAgIHRoaXMudm9sdW1lU0UgPSB2b2w7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcblxuLy9Tb3VuZEVsZW1lbnQgQmFzaWNcbnBoaW5hLmRlZmluZShcInBoaW5hLmV4dGVuc2lvbi5Tb3VuZEVsZW1lbnRcIiwge1xuICAgIC8v44K144Km44Oz44OJ5ZCNXG4gICAgbmFtZTogbnVsbCxcblxuICAgIC8v77y177yy77ysXG4gICAgdXJsOiBudWxsLFxuXG4gICAgLy/jgrXjgqbjg7Pjg4nmnKzkvZNcbiAgICBtZWRpYTogbnVsbCxcblxuICAgIC8v44Oc44Oq44Ol44O844OgXG4gICAgX3ZvbHVtZTogMSxcblxuICAgIC8v5YaN55Sf57WC5LqG5pmC44Gu44Kz44O844Or44OQ44OD44Kv6Zai5pWwXG4gICAgY2FsbGJhY2s6IG51bGwsXG5cbiAgICAvL+WGjeeUn+S4reODleODqeOCsFxuICAgIHBsYXlpbmc6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24obmFtZSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLm1lZGlhID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcInNvdW5kXCIsIG5hbWUpO1xuICAgICAgICBpZiAodGhpcy5tZWRpYSkge1xuICAgICAgICAgICAgdGhpcy5tZWRpYS52b2x1bWUgPSAxO1xuICAgICAgICAgICAgdGhpcy5tZWRpYS5vbignZW5kZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tZWRpYS5sb29wKSB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYWxsYmFjaykgdGhpcy5jYWxsYmFjaygpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiYXNzZXQgbm90IGZvdW5kLiBcIituYW1lKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+OCteOCpuODs+ODieOBruWGjeeUn1xuICAgIHBsYXk6IGZ1bmN0aW9uKGxvb3AsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmIChsb29wID09PSB1bmRlZmluZWQpIGxvb3AgPSBmYWxzZVxuICAgICAgICBpZiAoIXRoaXMubWVkaWEpIHJldHVybiB0aGlzO1xuXG4gICAgICAgIC8v44Or44O844OX5YaN55Sf44Gu5aC05ZCI5aSa6YeN5YaN55Sf44KS56aB5q2iXG4gICAgICAgIGlmIChsb29wICYmIHRoaXMucGxheWluZykgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMubWVkaWEubG9vcCA9IGxvb3A7XG4gICAgICAgIHRoaXMubWVkaWEucGxheSgpO1xuICAgICAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgICAgIHRoaXMucGxheWluZyA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+OCteOCpuODs+ODieWGjeeUn+WGjemWi1xuICAgIHJlc3VtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghdGhpcy5tZWRpYSkgcmV0dXJuIHRoaXM7XG4gICAgICAgIHRoaXMubWVkaWEucmVzdW1lKCk7XG4gICAgICAgIHRoaXMucGxheWluZyA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+OCteOCpuODs+ODieS4gOaZguWBnOatolxuICAgIHBhdXNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5tZWRpYSkgcmV0dXJuIHRoaXM7XG4gICAgICAgIHRoaXMubWVkaWEucGF1c2UoKTtcbiAgICAgICAgdGhpcy5wbGF5aW5nID0gZmFsc2U7XG4gICAgfSxcblxuICAgIC8v44K144Km44Oz44OJ5YGc5q2iXG4gICAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghdGhpcy5tZWRpYSkgcmV0dXJuIHRoaXM7XG4gICAgICAgIHRoaXMubWVkaWEuc3RvcCgpO1xuICAgICAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44Oc44Oq44Ol44O844Og6Kit5a6aXG4gICAgc2V0Vm9sdW1lOiBmdW5jdGlvbih2b2wpIHtcbiAgICAgICAgaWYgKCF0aGlzLm1lZGlhKSByZXR1cm4gdGhpcztcbiAgICAgICAgaWYgKHZvbCA9PT0gdW5kZWZpbmVkKSB2b2wgPSAwLjU7XG4gICAgICAgIHRoaXMuX3ZvbHVtZSA9IHZvbDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuICAgICAgICB2b2x1bWU6IHtcbiAgICAgICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5fdm9sdW1lOyB9LFxuICAgICAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odm9sKSB7IHRoaXMuc2V0Vm9sdW1lKHZvbCk7IH1cbiAgICAgICAgfSxcbiAgICAgICAgbG9vcDoge1xuICAgICAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLm1lZGlhLmxvb3A7IH0sXG4gICAgICAgICAgICBcInNldFwiOiBmdW5jdGlvbihmKSB7IHRoaXMubWVkaWEubG9vcCA9IGY7IH1cbiAgICAgICAgfSxcbiAgICB9XG59KTtcbiIsIi8qXG4gKiAgYXBwbGljYXRpb24uanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL25hbWVzcGFhY2UgUXVlc3QgRm9yIHRoZSBUYW5lbG9yblxudmFyIHFmdCA9IHt9O1xuXG5waGluYS5kZWZpbmUoXCJxZnQuQXBwbGljYXRpb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5DYW52YXNBcHBcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7XG4gICAgICAgICAgICBxdWVyeTogJyN3b3JsZCcsXG4gICAgICAgICAgICB3aWR0aDogU0NfVyxcbiAgICAgICAgICAgIGhlaWdodDogU0NfSCxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMCwgMCwgMCwgMSknLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5mcHMgPSBGUFM7XG5cbiAgICAgICAgLy/jgrLjg7zjg6Djg5Hjg4Pjg4nnrqHnkIZcbiAgICAgICAgdGhpcy5nYW1lcGFkTWFuYWdlciA9IHBoaW5hLmlucHV0LkdhbWVwYWRNYW5hZ2VyKCk7XG4gICAgICAgIHRoaXMuZ2FtZXBhZCA9IHRoaXMuZ2FtZXBhZE1hbmFnZXIuZ2V0KDApO1xuXG4gICAgICAgIC8v44OQ44O844OB44Oj44Or44OR44OD44OJXG4gICAgICAgIHRoaXMudmlydHVhbFBhZCA9IHBoaW5hLmV4dGVuc2lvbi5WaXJ0dWFsUGFkKHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSkuc2V0UG9zaXRpb24oMCwgMCk7XG5cbiAgICAgICAgLy/jg5Hjg4Pjg4nmg4XloLHjgpLmm7TmlrBcbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5nYW1lcGFkTWFuYWdlci51cGRhdGUoKTtcbiAgICAgICAgICAgIHRoaXMudmlydHVhbFBhZC51cGRhdGVJbmZvKCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2xsZXIoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IHt9O1xuXG4gICAgICAgIC8v44K144Km44Oz44OJ44K744OD44OIXG4gICAgICAgIHRoaXMuc291bmRzZXQgPSBwaGluYS5leHRlbnNpb24uU291bmRTZXQoKTtcblxuICAgICAgICAvL0xhYmVs44OH44OV44Kp44Or44OI6Kit5a6aXG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwuZGVmYXVsdHMuJGV4dGVuZCh7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmx1ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMzIsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdXBkYXRlQ29udHJvbGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBiZWZvcmUgPSB0aGlzLmNvbnRyb2xsZXI7XG4gICAgICAgIGJlZm9yZS5iZWZvcmUgPSBudWxsO1xuXG4gICAgICAgIHZhciBncCA9IHRoaXMuZ2FtZXBhZDtcbiAgICAgICAgdmFyIGtiID0gdGhpcy5rZXlib2FyZDtcbiAgICAgICAgdmFyIGFuZ2xlMSA9IGdwLmdldEtleUFuZ2xlKCk7XG4gICAgICAgIHZhciBhbmdsZTIgPSBrYi5nZXRLZXlBbmdsZSgpO1xuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSB7XG4gICAgICAgICAgICBhbmdsZTogYW5nbGUxICE9PSBudWxsPyBhbmdsZTE6IGFuZ2xlMixcblxuICAgICAgICAgICAgdXA6IGdwLmdldEtleShcInVwXCIpIHx8IGtiLmdldEtleShcInVwXCIpLFxuICAgICAgICAgICAgZG93bjogZ3AuZ2V0S2V5KFwiZG93blwiKSB8fCBrYi5nZXRLZXkoXCJkb3duXCIpLFxuICAgICAgICAgICAgbGVmdDogZ3AuZ2V0S2V5KFwibGVmdFwiKSB8fCBrYi5nZXRLZXkoXCJsZWZ0XCIpLFxuICAgICAgICAgICAgcmlnaHQ6IGdwLmdldEtleShcInJpZ2h0XCIpIHx8IGtiLmdldEtleShcInJpZ2h0XCIpLFxuXG4gICAgICAgICAgICBhdHRhY2s6IGdwLmdldEtleShcIlhcIikgfHwga2IuZ2V0S2V5KFwiWlwiKSxcbiAgICAgICAgICAgIGp1bXA6ICAgZ3AuZ2V0S2V5KFwidXBcIikgfHwgZ3AuZ2V0S2V5KFwiQVwiKSB8fCBrYi5nZXRLZXkoXCJ1cFwiKSB8fCBrYi5nZXRLZXkoXCJYXCIpLFxuICAgICAgICAgICAgY2hhbmdlOiBncC5nZXRLZXkoXCJCXCIpIHx8IGtiLmdldEtleShcIkNcIiksXG4gICAgICAgICAgICBtZW51OiAgIGdwLmdldEtleShcInN0YXJ0XCIpIHx8IGtiLmdldEtleShcImVzY2FwZVwiKSxcblxuICAgICAgICAgICAgYTogZ3AuZ2V0S2V5KFwiQVwiKSB8fCBrYi5nZXRLZXkoXCJaXCIpLFxuICAgICAgICAgICAgYjogZ3AuZ2V0S2V5KFwiQlwiKSB8fCBrYi5nZXRLZXkoXCJYXCIpLFxuICAgICAgICAgICAgeDogZ3AuZ2V0S2V5KFwiWFwiKSB8fCBrYi5nZXRLZXkoXCJDXCIpLFxuICAgICAgICAgICAgeTogZ3AuZ2V0S2V5KFwiWVwiKSB8fCBrYi5nZXRLZXkoXCJWXCIpLFxuXG4gICAgICAgICAgICBvazogZ3AuZ2V0S2V5KFwiQVwiKSB8fCBrYi5nZXRLZXkoXCJaXCIpIHx8IGtiLmdldEtleShcInNwYWNlXCIpIHx8IGtiLmdldEtleShcInJldHVyblwiKSxcbiAgICAgICAgICAgIGNhbmNlbDogZ3AuZ2V0S2V5KFwiQlwiKSB8fCBrYi5nZXRLZXkoXCJYXCIpIHx8IGtiLmdldEtleShcImVzY2FwZVwiKSxcblxuICAgICAgICAgICAgc3RhcnQ6IGdwLmdldEtleShcInN0YXJ0XCIpIHx8IGtiLmdldEtleShcInJldHVyblwiKSxcbiAgICAgICAgICAgIHNlbGVjdDogZ3AuZ2V0S2V5KFwic2VsZWN0XCIpLFxuXG4gICAgICAgICAgICBwYXVzZTogZ3AuZ2V0S2V5KFwic3RhcnRcIikgfHwga2IuZ2V0S2V5KFwiZXNjYXBlXCIpLFxuXG4gICAgICAgICAgICBhbmFsb2cxOiBncC5nZXRTdGlja0RpcmVjdGlvbigwKSxcbiAgICAgICAgICAgIGFuYWxvZzI6IGdwLmdldFN0aWNrRGlyZWN0aW9uKDEpLFxuXG4gICAgICAgICAgICAvL+WJjeODleODrOODvOODoOaDheWgsVxuICAgICAgICAgICAgYmVmb3JlOiBiZWZvcmUsXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIF9vbkxvYWRBc3NldHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNvdW5kc2V0LnJlYWRBc3NldCgpO1xuXG4gICAgICAgIC8v54m55q6K5Yq55p6c55So44OT44OD44OI44Oe44OD44OX5L2c5oiQXG4gICAgICAgIFtcbiAgICAgICAgICAgIFwicGxheWVyMVwiLFxuICAgICAgICAgICAgXCJwbGF5ZXIyXCIsXG4gICAgICAgIF0uZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICBpZiAoIXBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoXCJpbWFnZVwiLCBuYW1lKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAvL+ODgOODoeODvOOCuOeUqFxuICAgICAgICAgICAgaWYgKCFwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KFwiaW1hZ2VcIiwgbmFtZStcIldoaXRlXCIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRleCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoXCJpbWFnZVwiLCBuYW1lKS5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHRleC5maWx0ZXIoIGZ1bmN0aW9uKHBpeGVsLCBpbmRleCwgeCwgeSwgYml0bWFwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gYml0bWFwLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMF0gPSAocGl4ZWxbMF0gPT0gMD8gMDogMTI4KTsgLy9yXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMV0gPSAocGl4ZWxbMV0gPT0gMD8gMDogMTI4KTsgLy9nXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMl0gPSAocGl4ZWxbMl0gPT0gMD8gMDogMTI4KTsgLy9iXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLnNldChcImltYWdlXCIsIG5hbWUrXCJXaGl0ZVwiLCB0ZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/ngJXmrbvnlKhcbiAgICAgICAgICAgIGlmICghcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUrXCJSZWRcIikpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUpLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgdGV4LmZpbHRlciggZnVuY3Rpb24ocGl4ZWwsIGluZGV4LCB4LCB5LCBiaXRtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBiaXRtYXAuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCswXSA9IHBpeGVsWzBdO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2luZGV4KzFdID0gMDtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCsyXSA9IDA7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLnNldChcImltYWdlXCIsIG5hbWUrXCJSZWRcIiwgdGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v5b2x55SoXG4gICAgICAgICAgICBpZiAoIXBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoXCJpbWFnZVwiLCBuYW1lK1wiQmxhY2tcIikpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUpLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgdGV4LmZpbHRlciggZnVuY3Rpb24ocGl4ZWwsIGluZGV4LCB4LCB5LCBiaXRtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBiaXRtYXAuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCswXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMV0gPSAwO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2luZGV4KzJdID0gMDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuc2V0KFwiaW1hZ2VcIiwgbmFtZStcIkJsYWNrXCIsIHRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBwbGF5QkdNOiBmdW5jdGlvbihhc3NldCwgbG9vcCwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGxvb3AgPT09IHVuZGVmaW5lZCkgbG9vcCA9IHRydWU7XG4gICAgICAgIHRoaXMuc291bmRzZXQucGxheUJHTShhc3NldCwgbG9vcCwgY2FsbGJhY2spO1xuICAgIH0sXG5cbiAgICBzdG9wQkdNOiBmdW5jdGlvbihhc3NldCkge1xuICAgICAgICB0aGlzLnNvdW5kc2V0LnN0b3BCR00oKTtcbiAgICB9LFxuXG4gICAgc2V0Vm9sdW1lQkdNOiBmdW5jdGlvbih2b2wpIHtcbiAgICAgICAgaWYgKHZvbCA+IDEpIHZvbCA9IDE7XG4gICAgICAgIGlmICh2b2wgPCAwKSB2b2wgPSAwO1xuICAgICAgICB0aGlzLnNvdW5kc2V0LnNldFZvbHVtZUJHTSh2b2wpO1xuICAgIH0sXG5cbiAgICBwbGF5U0U6IGZ1bmN0aW9uKGFzc2V0LCBsb29wKSB7XG4gICAgICAgIGlmIChsb29wID09PSB1bmRlZmluZWQpIGxvb3AgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zb3VuZHNldC5wbGF5U0UoYXNzZXQsIGxvb3ApO1xuICAgIH0sXG5cbiAgICBzZXRWb2x1bWVTRTogZnVuY3Rpb24odm9sKSB7XG4gICAgICAgIGlmICh2b2wgPiAxKSB2b2wgPSAxO1xuICAgICAgICBpZiAodm9sIDwgMCkgdm9sID0gMDtcbiAgICAgICAgdGhpcy5zb3VuZHNldC5zZXRWb2x1bWVTRSh2b2wpO1xuICAgIH0sXG5cbiAgICBzZXRWb2x1bWU6IGZ1bmN0aW9uKGFzc2V0LCB2b2wpIHtcbiAgICAgICAgdGhpcy5zb3VuZHNldC5zZXRWb2x1bWUoYXNzZXQsIHZvbCk7XG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuICAgICAgICB2b2x1bWVCR006IHtcbiAgICAgICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5zb3VuZHMudm9sdW1lQkdNOyB9LFxuICAgICAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odm9sKSB7IHRoaXMuc2V0Vm9sdW1lQkdNKHZvbCk7IH1cbiAgICAgICAgfSxcbiAgICAgICAgdm9sdW1lU0U6IHtcbiAgICAgICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5zb3VuZHMudm9sdW1lU0U7IH0sXG4gICAgICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2b2wpIHsgdGhpcy5zZXRWb2x1bWVTRSh2b2wpOyB9XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiIsIi8qXG4gKiAgYXNzZXQuanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuQXNzZXRzXCIsIHtcbiAgICBfc3RhdGljOiB7XG4gICAgICAgIGxvYWRlZDogW10sXG4gICAgICAgIGlzTG9hZGVkOiBmdW5jdGlvbihhc3NldFR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybiBxZnQuQXNzZXRzLmxvYWRlZFthc3NldFR5cGVdPyB0cnVlOiBmYWxzZTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgICAgICBxZnQuQXNzZXRzLmxvYWRlZFtvcHRpb25zLmFzc2V0VHlwZV0gPSB0cnVlO1xuICAgICAgICAgICAgc3dpdGNoIChvcHRpb25zLmFzc2V0VHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzcGxhc2hcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJvcGVuaW5nbWFwXCI6ICAgXCJhc3NldHMvaW1hZ2Uvb3BlbmluZ19tYXAuanBnXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJvcGVuaW5ndG93ZXJcIjogXCJhc3NldHMvaW1hZ2Uvb3BlbmluZ190b3dlci5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmdncm91bmRcIjpcImFzc2V0cy9pbWFnZS9vcGVuaW5nX2dyb3VuZC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmdiYWNrXCI6ICBcImFzc2V0cy9pbWFnZS9vcGVuaW5nX2JhY2sucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJvcGVuaW5nYmFjazJcIjogXCJhc3NldHMvaW1hZ2Uvb3BlbmluZ19iZ19qYW4uanBnXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJvcGVuaW5nbGlnaHRcIjogXCJhc3NldHMvaW1hZ2Uvb3BlbmluZ190cmVlX2xpZ2h0X3llbGxvdy5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBsYXllcjFcIjogICAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjQucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiYWNrZ3JvdW5kXCI6ICAgXCJhc3NldHMvaW1hZ2UvYmFjay1zMDNiLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3BsYXNoMlwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291bmQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmdiZ21cIjogICBcImFzc2V0cy9zb3VuZC9EUy0wNzBtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY29tbW9uXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3I0XCI6ICAgIFwiYXNzZXRzL2ltYWdlL2FjdG9yNC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yMTlcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3IxOS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yNDBcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3I0MC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yNTVcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3I1NS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yNjRcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3I2NF9hLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3I2NDJcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3I2NF9iLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3IxMDhcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3IxMDgucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhY3RvcjExMVwiOiAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjExMS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yMTEyXCI6ICAgIFwiYXNzZXRzL2ltYWdlL2FjdG9yMTEyLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwid2VhcG9uc1wiOiAgICBcImFzc2V0cy9pbWFnZS93ZWFwb25zLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXRlbVwiOiAgICAgICBcImFzc2V0cy9pbWFnZS9pdGVtLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXRlbWJveFwiOiAgICBcImFzc2V0cy9pbWFnZS90YWthcmFiYWtvLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGFydGljbGVcIjogICBcImFzc2V0cy9pbWFnZS9wYXJ0aWNsZS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRvb3JcIjogICAgICAgXCJhc3NldHMvaW1hZ2UvZG9vci5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNoZWNraWNvblwiOiAgXCJhc3NldHMvaW1hZ2UvY2hlY2sgaWNvbl8wMC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlYmFja1wiOiAgXCJhc3NldHMvaW1hZ2UvdGl0bGViYWNrLnBuZ1wiLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1lbnVmcmFtZVwiOiAgXCJhc3NldHMvaW1hZ2UvbmM5MjM2Ny5wbmdcIixcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9uc3RlcjAxXCI6ICBcImFzc2V0cy9pbWFnZS9tb25zdGVyMDEucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtb25zdGVyMDJcIjogIFwiYXNzZXRzL2ltYWdlL2NoYXJfbV9kZXZpbDAxLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9uc3RlcjAzXCI6ICBcImFzc2V0cy9pbWFnZS9jaGFyX21fbWFnaTAxLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9uc3RlcjAxeDJcIjogIFwiYXNzZXRzL2ltYWdlL21vbnN0ZXIwMXgyLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibW9uc3RlcjAyeDJcIjogIFwiYXNzZXRzL2ltYWdlL2NoYXJfbV9kZXZpbDAxeDIucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJidWxsZXRcIjogICAgIFwiYXNzZXRzL2ltYWdlL2VmZmVjdF9idWxsZXQwMS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVmZmVjdFwiOiAgICAgXCJhc3NldHMvaW1hZ2UvZWZmZWN0LnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZWZmZWN0MlwiOiAgICBcImFzc2V0cy9pbWFnZS9lZmZlY3QwMWEucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJnYXRlXCI6ICAgICAgIFwiYXNzZXRzL2ltYWdlL2dhdGUucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmbGFtZTAyXCI6ICAgIFwiYXNzZXRzL2ltYWdlL29iamVjdF9maXJlMDJhLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmxhbWUwM1wiOiAgICBcImFzc2V0cy9pbWFnZS9vYmplY3RfZmlyZTAzYS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZsYW1lMDVcIjogICAgXCJhc3NldHMvaW1hZ2Uvb2JqZWN0X2ZpcmUwNWEucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhY2Nlc3NvcnkxXCI6IFwiYXNzZXRzL2ltYWdlL21hcF9lZmZlY3QyLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmxvY2tcIjogICAgICBcImFzc2V0cy9pbWFnZS9ibG9jay5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZsb29yXCI6ICAgICAgXCJhc3NldHMvbWFwL1RpbGVBNC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhbGxvb25cIjogICAgXCJhc3NldHMvaW1hZ2UvY2hhcmEwOV9jMS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNoYWRvd1wiOiAgICAgXCJhc3NldHMvaW1hZ2Uvc2hhZG93LnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjbGlja1wiOiAgICAgIFwiYXNzZXRzL3NvdW5kL3NlX21hb3VkYW1hc2hpaV9zeXN0ZW00NC5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9rXCI6ICAgICAgICAgXCJhc3NldHMvc291bmQvc2VfbWFvdWRhbWFzaGlpX3N5c3RlbTM2Lm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2FuY2VsXCI6ICAgICBcImFzc2V0cy9zb3VuZC9zZV9tYW91ZGFtYXNoaWlfc3lzdGVtNDMubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhdHRhY2tcIjogICAgIFwiYXNzZXRzL3NvdW5kL3Nlbl9rYV9rYXRhbmFfc2FzaW51a3UwMS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhpdFwiOiAgICAgICAgXCJhc3NldHMvc291bmQvc2VuX2thX2thdGFuYV9zYXN1MDEubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJoaXRfYmx1bnRcIjogIFwiYXNzZXRzL3NvdW5kL3Nlbl9ibHVudC5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRhbWFnZVwiOiAgICAgXCJhc3NldHMvc291bmQvc2VfbWFvdWRhbWFzaGlpX2JhdHRsZTEyLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXJyb3dzdGlja1wiOiBcImFzc2V0cy9zb3VuZC9zZW5fa2FfeWEwMy5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YWdlY2xlYXJcIjogXCJhc3NldHMvc291bmQvRFMtMDMwbS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImdhbWVvdmVyXCI6ICAgXCJhc3NldHMvc291bmQvZ2FtZW92ZXIzLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZ2V0a2V5aXRlbVwiOiBcImFzc2V0cy9zb3VuZC9zZV9tYW91ZGFtYXNoaWlfb25lcG9pbnQyMy5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJvbWJcIjogICAgICAgXCJhc3NldHMvc291bmQvc2VuX2dlX3RhaWhvdTAzLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2VsZWN0XCI6ICAgICBcImFzc2V0cy9zb3VuZC9zZV9tYW91ZGFtYXNoaWlfc3lzdGVtNDUubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJnZXRpdGVtXCI6ICAgIFwiYXNzZXRzL3NvdW5kL2F0YV9hNDkubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyZWNvdmVyeVwiOiAgIFwiYXNzZXRzL3NvdW5kL3NlX21hb3VkYW1hc2hpaV9tYWdpY2FsMDEubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aW5rbGluZ1wiOiAgIFwiYXNzZXRzL3NvdW5kL3RpbmtsaW5nLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaG9seTFcIjogICAgICBcImFzc2V0cy9zb3VuZC9ob2x5MS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJnbTFcIjogICAgICAgXCJhc3NldHMvc291bmQvRFMtYmEwMW0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVWJ1bnR1TW9ub1wiOiBcImFzc2V0cy9mb250L1VidW50dU1vbm8tQm9sZC50dGZcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlZm9udDFcIjogXCJhc3NldHMvZm9udC90ZXV0b25pYzQudHRmXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aXRsZWZvbnQyXCI6IFwiYXNzZXRzL2ZvbnQvR290aFN0ZW5jaWxfUHJlbWl1bS50dGZcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0bXg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YWdlMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2UxLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U5OTlcIjogXCJhc3NldHMvbWFwL3N0YWdlOTk5LnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2UyXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtMlwiOiBcImFzc2V0cy9zb3VuZC9EUy0wMzVtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UyXzFcIjogXCJhc3NldHMvbWFwL3N0YWdlMl8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2UzXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtM1wiOiBcImFzc2V0cy9zb3VuZC9EUy0wNDFtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UzXzFcIjogXCJhc3NldHMvbWFwL3N0YWdlM18xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UzXzJcIjogXCJhc3NldHMvbWFwL3N0YWdlM18yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UzXzNcIjogXCJhc3NldHMvbWFwL3N0YWdlM18zLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U0XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtNFwiOiBcImFzc2V0cy9zb3VuZC9EUy0wNzZtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U0XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlNF8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U0XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlNF8yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U1XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtNVwiOiBcImFzc2V0cy9zb3VuZC9EUy0wODltLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U1XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlNV8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U1XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlNV8yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U2XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtNlwiOiBcImFzc2V0cy9zb3VuZC9EUy0wNjBtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U2XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlNl8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U2XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlNl8yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U3XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtN1wiOiBcImFzc2V0cy9zb3VuZC9EUy0xMDVtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U3XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlN18xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U3XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlN18yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U3XzNcIjogXCJhc3NldHMvbWFwL3N0YWdlN18zLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U4XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtOFwiOiBcImFzc2V0cy9zb3VuZC9EUy0wNjRtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U4XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlOF8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U4XzJcIjogXCJhc3NldHMvbWFwL3N0YWdlOF8yLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2U5XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtOVwiOiBcImFzc2V0cy9zb3VuZC9EUy0wNjRtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2U5XzFcIjogXCJhc3NldHMvbWFwL3N0YWdlOV8xLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhZ2UxMFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc291bmQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVuZGluZ1wiOiBcImFzc2V0cy9zb3VuZC9EUy0wNzFtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UxMFwiOiBcImFzc2V0cy9tYXAvc3RhZ2UxMC50bXhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgXCJpbnZhbGlkIGFzc2V0VHlwZTogXCIgKyBvcHRpb25zLmFzc2V0VHlwZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICB9LFxufSk7XG5cbiIsIi8qXG4gKiAgQmVucmkuanNcbiAqICAyMDE0LzEyLzE4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuIFxudmFyIHRvUmFkID0gMy4xNDE1OS8xODA7ICAgIC8v5byn5bqm5rOVdG/jg6njgrjjgqLjg7PlpInmj5tcbnZhciB0b0RlZyA9IDE4MC8zLjE0MTU5OyAgICAvL+ODqeOCuOOCouODs3Rv5byn5bqm5rOV5aSJ5o+bXG5cbi8v6Led6Zui6KiI566XXG52YXIgZGlzdGFuY2UgPSBmdW5jdGlvbihmcm9tLCB0bykge1xuICAgIHZhciB4ID0gZnJvbS54LXRvLng7XG4gICAgdmFyIHkgPSBmcm9tLnktdG8ueTtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KHgqeCt5KnkpO1xufVxuXG4vL+i3nembouioiOeul++8iOODq+ODvOODiOeEoeOBl+eJiO+8iVxudmFyIGRpc3RhbmNlU3EgPSBmdW5jdGlvbihmcm9tLCB0bykge1xuICAgIHZhciB4ID0gZnJvbS54IC0gdG8ueDtcbiAgICB2YXIgeSA9IGZyb20ueSAtIHRvLnk7XG4gICAgcmV0dXJuIHgqeCt5Knk7XG59XG5cbi8v5pWw5YCk44Gu5Yi26ZmQXG52YXIgY2xhbXAgPSBmdW5jdGlvbih4LCBtaW4sIG1heCkge1xuICAgIHJldHVybiAoeDxtaW4pP21pbjooKHg+bWF4KT9tYXg6eCk7XG59O1xuXG4vL+S5seaVsOeUn+aIkFxudmFyIHByYW5kID0gcGhpbmEudXRpbC5SYW5kb20oKTtcbnZhciByYW5kID0gZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICByZXR1cm4gcHJhbmQucmFuZGludChtaW4sIG1heCk7XG59XG5cbi8v44K/44Kk44OI44Or54Sh44GX44OA44Kk44Ki44Ot44KwXG52YXIgQWR2YW5jZUFsZXJ0ID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgdmFyIHRtcEZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgdG1wRnJhbWUuc2V0QXR0cmlidXRlKCdzcmMnLCAnZGF0YTp0ZXh0L3BsYWluLCcpO1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0bXBGcmFtZSk7XG5cbiAgICB3aW5kb3cuZnJhbWVzWzBdLndpbmRvdy5hbGVydChzdHIpO1xuICAgIHRtcEZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodG1wRnJhbWUpO1xufTtcbnZhciBBZHZhbmNlQ29uZmlybSA9IGZ1bmN0aW9uKHN0cikge1xuICAgIHZhciB0bXBGcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgIHRtcEZyYW1lLnNldEF0dHJpYnV0ZSgnc3JjJywgJ2RhdGE6dGV4dC9wbGFpbiwnKTtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodG1wRnJhbWUpO1xuXG4gICAgdmFyIHJlc3VsdCA9IHdpbmRvdy5mcmFtZXNbMF0ud2luZG93LmNvbmZpcm0oc3RyKTtcbiAgICB0bXBGcmFtZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRtcEZyYW1lKTtcblxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG4vL+aVsOWApOOCkuOCq+ODs+ODnue3qOmbhuOBl+OBpuaWh+Wtl+WIl+OBqOOBl+OBpuWHuuWKm1xuTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwiY29tbWFcIiwgIGZ1bmN0aW9uKCkge1xuICAgIHZhciBzdHIgPSB0aGlzKycnO1xuICAgIHZhciBsZW4gPSBzdHIubGVuZ3RoO1xuICAgIHZhciBvdXQgPSAnJztcbiAgICBmb3IgKHZhciBpID0gbGVuLTE7IGkgPiAtMTsgaS0tKSB7XG4gICAgICAgIG91dCA9IHN0cltpXStvdXQ7XG4gICAgICAgIGlmIChpICE9IDAgJiYgKGxlbi1pKSUzID09IDApIG91dCA9ICcsJytvdXQ7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG59KTtcbiIsIi8qXG4gKiAgbWFpbi5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8vcGhpbmEuZ2xvYmFsaXplKCk7XG5cbi8v44OH44OQ44OD44Kw44OV44Op44KwXG5jb25zdCBERUJVRyA9IGZhbHNlO1xuY29uc3QgREVCVUdfQ09MTElTSU9OID0gZmFsc2U7XG5jb25zdCBERUJVR19FWUVTSUdIVCA9IGZhbHNlO1xuY29uc3QgREVCVUdfTU9CSUxFID0gZmFsc2U7XG5cbi8v5a6a5pWwXG5jb25zdCBTQ19XID0gNTc2O1xuY29uc3QgU0NfSCA9IDMyNDtcbi8vIFNDX1cgPSA0ODA7XG4vLyBTQ19IID0gMzIwO1xuXG5jb25zdCBGUFMgPSAzMDtcblxuLy/jgqLjgqTjg4bjg6DvvKnvvKRcbmNvbnN0IElURU1fU0hPUlRTV09SRCA9IDA7XG5jb25zdCBJVEVNX0xPTkdTV09SRCA9IDE7XG5jb25zdCBJVEVNX0FYID0gMjtcbmNvbnN0IElURU1fU1BFQVIgPSAzO1xuY29uc3QgSVRFTV9CT1cgPSA0O1xuY29uc3QgSVRFTV9ST0QgPSA1O1xuY29uc3QgSVRFTV9CT09LID0gNjtcbmNvbnN0IElURU1fU0hJRUxEID0gNztcbmNvbnN0IElURU1fQVJNT1IgPSA4O1xuY29uc3QgSVRFTV9IQVQgPSA5O1xuY29uc3QgSVRFTV9CT09UUyA9IDEwO1xuY29uc3QgSVRFTV9HUk9WRSA9IDExO1xuY29uc3QgSVRFTV9SSU5HID0gMTI7XG5jb25zdCBJVEVNX1NDUk9MTCA9IDEzO1xuY29uc3QgSVRFTV9MRVRURVIgPSAxNDtcbmNvbnN0IElURU1fQ0FSRCA9IDE1O1xuY29uc3QgSVRFTV9LRVkgPSAxNjtcbmNvbnN0IElURU1fQ09JTiA9IDE3O1xuY29uc3QgSVRFTV9CQUcgPSAxODtcbmNvbnN0IElURU1fT1JCID0gMTk7XG5jb25zdCBJVEVNX1NUT05FID0gMjA7XG5jb25zdCBJVEVNX0pFV0VMID0gMjE7XG5jb25zdCBJVEVNX0pFV0VMQk9YID0gMjI7XG5jb25zdCBJVEVNX0FQUExFID0gMjQ7XG5jb25zdCBJVEVNX0hBUkIgPSAyNTtcbmNvbnN0IElURU1fTUVBVCA9IDI2O1xuY29uc3QgSVRFTV9QT1RJT04gPSAyNztcblxuLy/jgqTjg7Pjgrnjgr/jg7PjgrlcbmxldCBhcHA7XG5cbmlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3N3LmpzJylcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnU2VydmljZSB3b3JrZXIgcmVnaXN0ZXJlZCEnKTtcbiAgICAgIH0pXG4gICAgICAucmVqZWN0KCgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ1NlcnZpY2Ugd29ya2VyIHJlamVjdGVkIScpO1xuICAgIH0pO1xufVxuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgYXBwID0gcWZ0LkFwcGxpY2F0aW9uKCk7XG4gICAgYXBwLnJlcGxhY2VTY2VuZShxZnQuU2NlbmVGbG93KCkpO1xuXG4gICAgLy/jg6Ljg5DjgqTjg6vlr77lv5xcbiAgICBpZiAocGhpbmEuaXNNb2JpbGUoKSkge1xuICAgICAgICBhcHAuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGZ1bmN0aW9uIGR1bW15KCkge1xuICAgICAgICAgICAgdmFyIHMgPSBwaGluYS5hc3NldC5Tb3VuZCgpO1xuICAgICAgICAgICAgcy5sb2FkRnJvbUJ1ZmZlcigpO1xuICAgICAgICAgICAgcy5wbGF5KCkuc3RvcCgpO1xuICAgICAgICAgICAgYXBwLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBkdW1teSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhcHAuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIGR1bW15KCkge1xuICAgICAgICB2YXIgY29udGV4dCA9IHBoaW5hLmFzc2V0LlNvdW5kLmdldEF1ZGlvQ29udGV4dCgpO1xuICAgICAgICBjb250ZXh0LnJlc3VtZSgpO1xuICAgIH0pO1xuXG4gICAgYXBwLnJ1bigpO1xuLy8gICAgYXBwLmVuYWJsZVN0YXRzKCk7XG59O1xuIiwiLypcbiAqICBjb25maWdzY2VuZS5qc1xuICogIDIwMTcvMDMvMDJcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG4gXG5waGluYS5kZWZpbmUoXCJxZnQuQ29uZmlnU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwwLjUpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwwLjUpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmJnLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLmNsZWFyKCkuZmFkZUluKDUwMCk7XG5cbiAgICAgICAgdGhpcy5zY3JvbGwgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1lbnVmcmFtZVwiKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMC44NSwgMS4xKTtcbiAgICAgICAgdGhpcy5zY3JvbGwuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLnNjcm9sbC50d2VlbmVyLmNsZWFyKCkuZmFkZUluKDUwMCk7XG5cbiAgICAgICAgdGhpcy5tZW51QmFzZSA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMuc2Nyb2xsKTtcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDUsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwidGl0bGVmb250MVwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiA3MCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIk1lbnVcIiwgZm9udFNpemU6IDIwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oMCwgLVNDX0gqMC4zKTtcblxuICAgICAgICAvL+ODoeODi+ODpeODvOODhuOCreOCueODiOihqOekulxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMubWVudSA9IFtcIlN5c3RlbVwiLCBcIlByYWN0aWNlXCIsIFwiRXhpdFwiXTtcbiAgICAgICAgdGhpcy5tZW51VGV4dCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWVudS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFtpXSA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IHRoaXMubWVudVtpXSwgZm9udFNpemU6IDQwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAtU0NfSCowLjE1K1NDX0gqMC4xNSppKVxuICAgICAgICAgICAgICAgIC5zZXRTY2FsZSgwLjcpO1xuXG4gICAgICAgICAgICAvL+OCv+ODg+ODgeWIpOWumueUqFxuICAgICAgICAgICAgdmFyIHBhcmFtMiA9IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogU0NfVyowLjMsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBTQ19IKjAuMTAsXG4gICAgICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtMilcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAtU0NfSCowLjE1K1NDX0gqMC4xNSppKVxuICAgICAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgICAgIGMuYWxwaGEgPSAwO1xuICAgICAgICAgICAgYy5zZWxlY3QgPSBpO1xuICAgICAgICAgICAgYy5vbnBvaW50c3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5pc1NlbGVjdGVkIHx8IHRoYXQudGltZSA8IDEwKSByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ID09IHRoYXQuc2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQub2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubWVudVRleHRbdGhhdC5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2VsZWN0ID0gdGhpcy5zZWxlY3Q7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubWVudVRleHRbdGhhdC5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbGVjdCA9IDA7XG4gICAgICAgIHRoaXMuc2VsZWN0TWF4ID0gMztcbiAgICAgICAgdGhpcy5tZW51VGV4dFswXS5zZXRTY2FsZSgxKTtcbiAgICAgICAgdGhpcy5vayA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNhbnNlbCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgdGhpcy5vbigncmVzdW1lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVCYXNlLnR3ZWVuZXIuY2xlYXIoKS5mYWRlSW4oNTAwKTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMub2sgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuY2Fuc2VsID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKGN0LmRvd24gJiYgIWN0LmJlZm9yZS5kb3duICYmIHRoaXMuc2VsZWN0IDwgdGhpcy5zZWxlY3RNYXgtMSkge1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Kys7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMTA7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdC51cCAmJiAhY3QuYmVmb3JlLnVwICYmIHRoaXMuc2VsZWN0ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0LS07XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMTA7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDE1KSB7XG4gICAgICAgICAgICAvL+axuuWumlxuICAgICAgICAgICAgaWYgKGN0Lm9rIHx8IHRoaXMub2spIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3QgPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwib2tcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVudUJhc2UudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5Db25maWdTY2VuZV9QcmFjdGljZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3QgPT0gMikge1xuICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiY2FuY2VsXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4aXRNZW51KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44Kt44Oj44Oz44K744OrICAgICAgICBcbiAgICAgICAgICAgIGlmIChjdC5jYW5jZWwpIHtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiY2FuY2VsXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuZXhpdE1lbnUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG5cbiAgICBleGl0TWVudTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5jbGVhcigpLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgdGhpcy5zY3JvbGwudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZU91dCg1MDApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfVxufSk7XG4iLCIvKlxuICogIGNvbnZlcnNhdGlvbnNjZW5lLmpzXG4gKiAgMjAxNy8wOC8xN1xuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/kvJroqbHooajnpLrjgrfjg7zjg7MgXG5waGluYS5kZWZpbmUoXCJxZnQuQ29udmVyc2F0aW9uU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKGN1cnJlbnRTY2VuZSwgdGV4dCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZSA9IGN1cnJlbnRTY2VuZTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBrueUu+mdouS4iuS9jee9ruOBq+OCiOOCiuODleODrOODvOODoOOBrue4puS9jee9ruOCkuWkieabtFxuICAgICAgICB2YXIgZnJhbWVZID0gU0NfSCAqIDAuMjU7XG4gICAgICAgIHZhciBwbCA9IHRoaXMuY3VycmVudFNjZW5lLnBsYXllcjtcblxuICAgICAgICAvL+S8muipseihqOekuuODleODrOODvOODoFxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XICogMC45NSxcbiAgICAgICAgICAgIGhlaWdodDpTQ19IICogMC40LFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsIDAsIDAsIDAuNSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDEsIDEsIDEsIDAuNSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cgKiAwLjUsIGZyYW1lWSlcblxuICAgICAgICAvL+ODhuOCreOCueODiOWHpueQhlxuICAgICAgICBpZiAodGV4dCA9PT0gdW5kZWZpbmVkKSB0ZXh0ID0gXCJURVNUIE1FU1NBR0VcIjtcbiAgICAgICAgaWYgKHRleHQgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gXCJcIjtcbiAgICAgICAgICAgIHRleHQuZm9yRWFjaCgodCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dCArPSAodCArIFwiXFxuXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSB0ZXh0O1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiA1LFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogNzAsXG5cbiAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICd0b3AnLFxuICAgICAgICAgICAgYWxpZ246J3N0YXJ0JyxcbiAgICAgICAgICAgIGJhc2VsaW5lOid0b3AnLFxuICAgICAgICAgICAgd2lkdGg6IFNDX1cgKiAwLjksXG4gICAgICAgICAgICBoZWlnaHQ6IFNDX0ggKiAwLjMsXG4gICAgICAgICAgICBzY3JvbGxYOiAwLFxuICAgICAgICAgICAgc2Nyb2xsWTogMCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwgPSBwaGluYS51aS5MYWJlbEFyZWEoe3RleHQ6IFwiXCIsIGZvbnRTaXplOiAyMH0uJHNhZmUobGFiZWxQYXJhbSkpLmFkZENoaWxkVG8odGhpcy5iZyk7XG5cbiAgICAgICAgdGhpcy5pc0V4aXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0ZpbmlzaCA9IGZhbHNlO1xuICAgICAgICB0aGlzLndhaXRUaW1lID0gMDtcbiAgICAgICAgdGhpcy5jb2wgPSAwO1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy53YWl0VGltZSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRMYWJlbC50ZXh0ID0gdGhpcy50ZXh0LnN1YnN0cmluZygwLCB0aGlzLmNvbCk7XG4gICAgICAgICAgICBpZiAodGhpcy50ZXh0LnN1YnN0cmluZyh0aGlzLmNvbCwgdGhpcy5jb2wrMSkgPT0gXCJcXG5cIikgdGhpcy53YWl0VGltZSA9IDEwO1xuICAgICAgICAgICAgdGhpcy5jb2wrKztcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbCA+IHRoaXMudGV4dC5sZW5ndGgpIHRoaXMuaXNGaW5pc2ggPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLndhaXRUaW1lID4gMCkgdGhpcy53YWl0VGltZS0tO1xuXG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAodGhpcy5pc0ZpbmlzaCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzRXhpdCAmJiB0aGlzLnRpbWUgPiAxMCAmJiBjdC5iZWZvcmUuYXR0YWNrICYmICFjdC5hdHRhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRXhpdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLndhaXQoMTAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wb3BTY2VuZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjdC5hdHRhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbCA9IHRoaXMudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0ZpbmlzaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxufSk7XG5cbiIsIi8qXG4gKiAgY3JlZGl0c2NlbmUuanNcbiAqICAyMDE3LzEyLzI0XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkNyZWRpdFNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG4gICAgXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAudG8oe2FscGhhOiAwLjV9LCAxMDAwKTtcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibHVlXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAyNixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiQ29uZ3JhdHVyYXRpb25zISFcIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuMik7XG5cbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJUaGFuayB5b3UgZm9yIHBsYXlpbmcuXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjQpO1xuXG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiVGhpcyBnYW1lIGlzIGEgdGVzdCB2ZXJzaW9uLlwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcblxuICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlB1c2ggYnV0dG9uIHRvIHRpdGxlLlwiLCBmb250U2l6ZTogMjB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjgpO1xuXG4gICAgICAgIGFwcC5wbGF5QkdNKFwiZ2FtZW92ZXJcIiwgZmFsc2UpO1xuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAodGhpcy50aW1lID4gMTIwKSB7XG4gICAgICAgICAgICBpZiAoY3Qub2sgfHwgY3QuY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlCR00oXCJvcGVuaW5nYmdtXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoJ2V4aXRnYW1lJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmRpbmdjZW5lLmpzXG4gKiAgMjAxNy8wMi8wN1xuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5FbmRpbmdTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuICAgIFxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUgPSBwYXJlbnRTY2VuZTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLnRvKHthbHBoYTogMC41fSwgMTAwMCk7XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmx1ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMjYsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlRoYW5rIHlvdSBmb3IgcGxheWluZy5cIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNCk7XG5cbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJUaGlzIGdhbWUgaXMgb3ZlclwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcblxuICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlB1c2ggYnV0dG9uIHRvIHRpdGxlLlwiLCBmb250U2l6ZTogMjB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjgpO1xuXG4gICAgICAgIGFwcC5wbGF5QkdNKFwiZ2FtZW92ZXJcIiwgZmFsc2UpO1xuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAodGhpcy50aW1lID4gMTIwKSB7XG4gICAgICAgICAgICBpZiAoY3Qub2sgfHwgY3QuY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlCR00oXCJvcGVuaW5nYmdtXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoJ2V4aXRnYW1lJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmRpbmdjZW5lLnRydWVlbmRpbmcuanNcbiAqICAyMDE3LzA1LzAxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxuLy/jg4jjgqXjg6vjg7zjgqjjg7Pjg4fjgqPjg7PjgrBcbnBoaW5hLmRlZmluZShcInFmdC5FbmRpbmdTY2VuZS5UcnVlRW5kaW5nXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG4gICAgXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuXG4gICAgICAgIHRoaXMudGV4dCA9IFtcbiAgICAgICAgICAgIFwi5pWw5aSa44Gu6Ium6Zuj44KS5LmX44KK6LaK44GIXCIsXG4gICAgICAgICAgICBcIuOBguOBquOBn+OBr+mBguOBq+alveWckuOAjOawuOmBoOOBrumDveOAjeOBuOOBruWFpeOCiuWPo+OBuOOBqOWIsOmBlOOBl+OBn1wiLFxuICAgICAgICAgICAgXCLmiYnjga7lkJHjgZPjgYbjgavjga/pmo7mrrXjgYzjgYLjgopcIixcbiAgICAgICAgICAgIFwi44Gd44Gu6ZqO5q6144Gv6YGl44GL5aSp5LiK44G444Go57aa44GE44Gm44GE44KLXCIsXG4gICAgICAgICAgICBcIumajuauteOCkuaYh+OCiuOBvuOBmeOBi++8n1wiLFxuICAgICAgICBdO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAudG8oe2FscGhhOiAwLjV9LCAxMDAwKTtcblxuICAgICAgICAvL+OCpOODoeODvOOCuOihqOekuueUqOODrOOCpOODpFxuICAgICAgICB0aGlzLmltYWdlTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyh0aGlzKTtcblxuICAgICAgICAvL+S4iuS4i+m7kuW4r1xuICAgICAgICBwYXJhbS5oZWlnaHQgPSBTQ19IICogMC4xNTtcbiAgICAgICAgdGhpcy5iYXIxID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRPcmlnaW4oMCwgMSkuc2V0UG9zaXRpb24oMCwgLTEpO1xuICAgICAgICB0aGlzLmJhcjIgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpLnNldE9yaWdpbigwLCAwKS5zZXRQb3NpdGlvbigwLCBTQ19IICsgMSk7XG4gICAgICAgIHRoaXMuYmFyMS50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJykubW92ZUJ5KDAsIFNDX0ggKiAwLjE1LCAzMCwgXCJlYXNlT3V0U2luZVwiKTtcbiAgICAgICAgdGhpcy5iYXIyLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKS5tb3ZlQnkoMCwgLVNDX0ggKiAwLjE1LCAzMCwgXCJlYXNlT3V0U2luZVwiKTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIHRoaXMub25lKCdlbnRlcmZyYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgLy/vvKLvvKfvvK3lho3nlJ9cbiAgICAgICAgICAgIGFwcC5wbGF5QkdNKFwiZW5kaW5nYmdtXCIpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxMjApIHtcbiAgICAgICAgICAgIGlmIChjdC5vayB8fCBjdC5jYW5jZWwpIHtcbiAgICAgICAgICAgICAgICBhcHAucGxheUJHTShcIm9wZW5pbmdiZ21cIik7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZSgnZXhpdGdhbWUnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIEdhbWVPdmVyU2NlbmUuanNcbiAqICAyMDE0LzA2LzA0XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkdhbWVPdmVyU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcbiAgICBcbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6IFNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6IFNDX0gsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSlcbiAgICAgICAgdGhpcy5iZy5hbHBoYSA9IDA7XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmx1ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMzIsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICB2YXIgeCA9IFNDX1cgKiAwLjUtMzIqNDtcbiAgICAgICAgdmFyIG4gPSAwO1xuICAgICAgICBbXCJHXCIsIFwiQVwiLCBcIk1cIiwgXCJFXCIsIFwiT1wiLCBcIlZcIiwgXCJFXCIsIFwiUlwiXS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBsYiA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IGV9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbih4LCBTQ19IKjAuNSszMilcbiAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMCwgMSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgICAgIGxiLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgICAgICAud2FpdChuKjUwKVxuICAgICAgICAgICAgICAgIC50byh7c2NhbGVYOiAxLjAsIGFscGhhOiAxLCB5OiBTQ19IKjAuNX0sIDEwMDAsIFwiZWFzZU91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAud2FpdCgxMDAwLW4qNTApXG4gICAgICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgICAgIC50byh7c2NhbGVYOiAwLjAsIGFscGhhOiAwLCB5OiBTQ19IKjAuNS0zMn0sIDEwMDAsIFwiZWFzZU91dFNpbmVcIilcbiAgICAgICAgICAgIHZhciBwdCA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwicGFydGljbGVcIiwgMTYsIDE2KVxuICAgICAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KDQ4KVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbih4LCBTQ19IKjAuNSlcbiAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMywgMylcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgICAgIHB0LmFscGhhID0gMDtcbiAgICAgICAgICAgIHB0LnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC53YWl0KG4qNTArMTAwMClcbiAgICAgICAgICAgICAgICAudG8oe2FscGhhOiAxfSwgMTAwMC1uKjUwLCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLnRvKHtzY2FsZVg6IDAuMCwgYWxwaGE6IDAsIHk6IFNDX0gqMC41LTMyfSwgMTAwMCwgXCJlYXNlT3V0U2luZVwiKVxuICAgICAgICAgICAgeCArPSAzMjtcbiAgICAgICAgICAgIG4rKztcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICBhcHAucGxheUJHTShcImdhbWVvdmVyXCIsIGZhbHNlKTtcblxuICAgICAgICB0aGlzLnNlbGVjdCA9IDA7IC8vMDpZRVMgMTpOT1xuICAgICAgICB0aGlzLnB1c2h5ZXMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wdXNobm8gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAodGhpcy50aW1lID09IDkwKSB7XG4gICAgICAgICAgICB0aGlzLmRpc3BDb250aW51ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxMDUpIHtcbiAgICAgICAgICAgIGlmICgoY3QubGVmdCB8fCB0aGlzLnB1c2h5ZXMpICYmIHRoaXMuc2VsZWN0ID09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5wdXNoeWVzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy55ZXMudHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEsIHNjYWxlWTogMX0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubm8udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dDMudGV4dCA9IFwi44Ky44O844Og44Kq44O844OQ44O85Zyw54K544GL44KJ44Kz44Oz44OG44Kj44OL44Ol44O844GX44G+44GZ77yI44K544Kz44Ki44Gv44Oq44K744OD44OI44GV44KM44G+44GZ77yJXCI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKChjdC5yaWdodCB8fCB0aGlzLnB1c2hubykgJiYgdGhpcy5zZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLnB1c2hubyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMueWVzLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5uby50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMSwgc2NhbGVZOiAxfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHQzLnRleHQgPSBcIuOCv+OCpOODiOODq+OBq+aIu+OCiuOBvuOBmVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN0Lm9rIHx8IGN0LmNhbmNlbCB8fCB0aGlzLm9rKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZSgnY29udGludWUnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZSgnZXhpdGdhbWUnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG5cbiAgICBkaXNwQ29udGludWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMzYsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRleHQxID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJDT05USU5VRT9cIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC40KzEwKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMudGV4dDEuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLnRleHQxLnR3ZWVuZXIuY2xlYXIoKS50byh7eTogU0NfSCowLjQsIGFscGhhOiAxfSwgNTAwLCBcImVhc2VJblNpbmVcIik7XG5cbiAgICAgICAgdGhpcy55ZXMgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIllFU1wiLCBmb250U2l6ZTogMzB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLnNldFNjYWxlKDEpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjQsIFNDX0gqMC42KzEwKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMueWVzLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy55ZXMudHdlZW5lci5jbGVhcigpLnRvKHt5OiBTQ19IKjAuNiwgYWxwaGE6IDF9LCA1MDAsIFwiZWFzZUluU2luZVwiKTtcblxuICAgICAgICB0aGlzLm5vID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJOT1wiLCBmb250U2l6ZTogMzB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLnNldFNjYWxlKDAuNylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNiwgU0NfSCowLjYrMTApXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5uby5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMubm8udHdlZW5lci5jbGVhcigpLnRvKHt5OiBTQ19IKjAuNiwgYWxwaGE6IDF9LCA1MDAsIFwiZWFzZUluU2luZVwiKTtcblxuICAgICAgICAvL+OCv+ODg+ODgeWIpOWumueUqFxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBwYXJhbTIgPSB7XG4gICAgICAgICAgICB3aWR0aDogODAsXG4gICAgICAgICAgICBoZWlnaHQ6IFNDX0gqMC4wOCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHllcyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0yKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNCwgU0NfSCowLjYpXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHllcy5hbHBoYSA9IDA7XG4gICAgICAgIHllcy5vbnBvaW50c3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGF0LnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5vayA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoYXQucHVzaHllcyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5vID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbTIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC42LCBTQ19IKjAuNilcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgbm8uYWxwaGEgPSAwO1xuICAgICAgICBuby5vbnBvaW50c3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGF0LnNlbGVjdCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5vayA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoYXQucHVzaG5vID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGV4dDMgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIuOCsuODvOODoOOCquODvOODkOODvOWcsOeCueOBi+OCieOCs+ODs+ODhuOCo+ODi+ODpeODvOOBl+OBvuOBme+8iOOCueOCs+OCouOBr+ODquOCu+ODg+ODiOOBleOCjOOBvuOBme+8iVwiLCBmb250U2l6ZTogMTB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNzUrMTApXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy50ZXh0My5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMudGV4dDMudHdlZW5lci5jbGVhcigpLnRvKHt5OiBTQ19IKjAuNzUsIGFscGhhOiAxfSwgNTAwLCBcImVhc2VJblNpbmVcIik7XG5cbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLmNsZWFyKCkudG8oe2FscGhhOjAuM30sIDUwMCwgXCJlYXNlSW5TaW5lXCIpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgTG9hZGluZ1NjZW5lLmpzXG4gKiAgMjAxNS8wOS8wOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqLjgrvjg4Pjg4jjg63jg7zjg4nnlKjjgrfjg7zjg7NcbnBoaW5hLmRlZmluZShcInFmdC5Mb2FkaW5nU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgICAgICBhc3NldHM6IG51bGwsXG4gICAgICAgICAgICB3aWR0aDogU0NfVyxcbiAgICAgICAgICAgIGhlaWdodDogU0NfSCxcbiAgICAgICAgICAgIGxpZTogZmFsc2UsXG4gICAgICAgICAgICBleGl0VHlwZTogXCJhdXRvXCIsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiAnYmxhY2snLFxuICAgICAgICAgICAgc3Ryb2tlOiBmYWxzZSxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSlcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuXG4gICAgICAgIC8v44Ot44O844OJ44GZ44KL54mp44GM54Sh44GE5aC05ZCI44K544Kt44OD44OXXG4gICAgICAgIHRoaXMuZm9yY2VFeGl0ID0gZmFsc2U7XG4gICAgICAgIHZhciBhc3NldHMgPSBvcHRpb25zLmFzc2V0cztcbiAgICAgICAgaWYgKCFhc3NldHMuJGhhcyhcInNvdW5kXCIpICYmXG4gICAgICAgICAgICAhYXNzZXRzLiRoYXMoXCJpbWFnZVwiKSAmJlxuICAgICAgICAgICAgIWFzc2V0cy4kaGFzKFwiZm9udFwiKSAmJlxuICAgICAgICAgICAgIWFzc2V0cy4kaGFzKFwic3ByaXRlc2hlZXRcIikgJiZcbiAgICAgICAgICAgICFhc3NldHMuJGhhcyhcInNjcmlwdFwiKSAmJlxuICAgICAgICAgICAgIWFzc2V0cy4kaGFzKFwidG14XCIpKSB7XG5cbiAgICAgICAgICAgIHRoaXMuZm9yY2VFeGl0ID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgdGV4dDogXCJMb2FkaW5nXCIsXG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmx1ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMzBcbiAgICAgICAgfTtcbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbChsYWJlbFBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuXG4gICAgICAgIHRoaXMuZnJvbUpTT04oe1xuICAgICAgICAgICAgY2hpbGRyZW46IHtcbiAgICAgICAgICAgICAgICBnYXVnZToge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdwaGluYS51aS5HYXVnZScsXG4gICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCowLjUsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ2JsYWNrJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBnYXVnZUNvbG9yOiAnYmx1ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAwLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLmdyaWRYLmNlbnRlcigpLFxuICAgICAgICAgICAgICAgICAgICB5OiBTQ19IKjAuNSsyMCxcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luWTogMCxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmdhdWdlLnVwZGF0ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2F1Z2VDb2xvciA9ICdoc2xhKHswfSwgMTAwJSwgNTAlLCAwLjgpJy5mb3JtYXQoZS50aWNrZXIuZnJhbWUqMyk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbG9hZGVyID0gcGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIoKTtcbiAgICAgICAgaWYgKG9wdGlvbnMubGllKSB7XG4gICAgICAgICAgICB0aGlzLmdhdWdlLmFuaW1hdGlvblRpbWUgPSAxMCoxMDAwO1xuICAgICAgICAgICAgdGhpcy5nYXVnZS52YWx1ZSA9IDkwO1xuICAgICAgICAgICAgbG9hZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2F1Z2UuYW5pbWF0aW9uVGltZSA9IDEqMTAwMDtcbiAgICAgICAgICAgICAgICB0aGlzLmdhdWdlLnZhbHVlID0gMTAwO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbG9hZGVyLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nYXVnZS52YWx1ZSA9IGUucHJvZ3Jlc3MqMTAwO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ2F1Z2Uub25mdWxsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5leGl0VHlwZSA9PT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXBwLl9vbkxvYWRBc3NldHMpIHRoaXMuYXBwLl9vbkxvYWRBc3NldHMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIGxvYWRlci5sb2FkKG9wdGlvbnMuYXNzZXRzKTtcbiAgICB9LFxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmZvcmNlRXhpdCkgdGhpcy5leGl0KCk7XG4gICAgfSwgICAgXG59KTtcbiIsIi8qXG4gKiAgTWFpblNjZW5lLmpzXG4gKiAgMjAxNi8xMi8yOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0Lk1haW5TY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgLy/nj77lnKjjgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogMSxcblxuICAgIC8v5pyA5aSn44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXJNYXg6IDgsXG5cbiAgICAvL+aui+OCiuaZgumWk++8iOODleODrOODvOODoOWNmOS9je+8iVxuICAgIHRpbWVMaW1pdDogMTIwLFxuXG4gICAgLy/jg6Hjg4Pjgrvjg7zjgrjjgrnjgr/jg4Pjgq9cbiAgICBtZXNzYWdlU3RhY2s6IFtdLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLjg5Xjg6njgrBcbiAgICBpc1N0YWdlQ2xlYXI6IGZhbHNlLFxuXG4gICAgLy/jgqjjg7Pjg4fjgqPjg7PjgrDpgLLooYzkuK3jg5Xjg6njgrBcbiAgICBpc0VuZGluZzogZmFsc2UsXG5cbiAgICAvL+ecn+OCqOODs+ODh+OCo+ODs+OCsOODleODqeOCsFxuICAgIGlzVHJ1ZUVuZGluZzogdHJ1ZSxcblxuICAgIC8v44K544Kz44KiXG4gICAgdG90YWxTY29yZTogMCxcblxuICAgIC8v5pW16KiO5LyQ5pWwXG4gICAgdG90YWxLaWxsOiAwLFxuXG4gICAgLy/jgrPjg7Pjg4bjgqPjg4vjg6Xjg7zlm57mlbBcbiAgICBjb250aW51ZUNvdW50OiAwLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmmYLmg4XloLFcbiAgICBjbGVhclJlc3VsdDogW10sXG5cbiAgICAvL+OCueOCr+ODquODvOODs+OBruODnuODg+ODl+WkluOBuOOBruenu+WLleWItumZkOODleODqeOCsFxuICAgIGxpbWl0V2lkdGg6IGZhbHNlLFxuICAgIGxpbWl0SGVpZ2h0OiB0cnVlLFxuXG4gICAgLy/jgrnjgq/jg6rjg7zjg7PkuK3lv4PluqfmqJlcbiAgICBzY3JlZW5DZW50ZXJQb3NpdGlvbjogbnVsbCxcblxuICAgIC8v44OX44Os44Kk44Ok44O844K544Kv44Oq44O844Oz5Lit5aSu5Zu65a6a44OV44Op44KwXG4gICAgY2VudGVyUGxheWVyOiB0cnVlLFxuXG4gICAgLy/jgrfjg7zjg7PlhoXlhajjgqrjg5bjgrjjgqfjgq/jg4jlvLfliLblgZzmraJcbiAgICBwYXVzZVNjZW5lOiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgICAgICBzdGFydFN0YWdlOiAxLFxuICAgICAgICAgICAgaXNQcmFjdGljZTogZmFsc2UsXG4gICAgICAgICAgICBpc0NvbnRpbnVlOiBmYWxzZSxcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5zdGFnZU51bWJlciA9IG9wdGlvbnMuc3RhcnRTdGFnZSB8fCAxO1xuICAgICAgICB0aGlzLmlzUHJhY3RpY2UgPSBvcHRpb25zLmlzUHJhY3RpY2U7XG4gICAgICAgIHRoaXMuaXNDb250aW51ZSA9IG9wdGlvbnMuaXNDb250aW51ZTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiAnYmxhY2snLFxuICAgICAgICAgICAgc3Ryb2tlOiBmYWxzZSxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcblxuICAgICAgICAvL+iDjOaZr1xuICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYmFja2dyb3VuZFwiKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oMCwgU0NfSCowLjUpXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDAsIDAuNSlcbiAgICAgICAgICAgIC5zZXRTY2FsZSgxLjAsIDEuMSk7XG5cbiAgICAgICAgLy/nrqHnkIbnlKjln7rmupbjg6zjgqTjg6RcbiAgICAgICAgdGhpcy5iYXNlTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyh0aGlzKTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCreODo+ODqeOCr+OCv1xuICAgICAgICB0aGlzLnBsYXllciA9IHFmdC5QbGF5ZXIodGhpcyk7XG5cbiAgICAgICAgLy/jgrnjgq/jg6rjg7zjg7PliJ3mnJ/ljJZcbiAgICAgICAgdGhpcy5zZXR1cFNjcmVlbigpO1xuXG4gICAgICAgIC8v44K544Kv44Oq44O844Oz5Lit5b+D5bqn5qiZ566h55CG55SoXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5jYW1lcmEgPSBwaGluYS5hcHAuT2JqZWN0MkQoKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLmNhbWVyYS5wYXJlbnRTY2VuZSA9IHRoaXM7XG4gICAgICAgIHRoaXMuY2FtZXJhLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMuY2FtZXJhLm1vdmVGcm9tID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuICAgICAgICB0aGlzLmNhbWVyYS5tb3ZlVG8gPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG4gICAgICAgIHRoaXMuY2FtZXJhLm1vdmVSYXRpbyA9IDA7XG4gICAgICAgIHRoaXMuY2FtZXJhLm1vdmVMZXJwID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2FtZXJhLm1vdmVUb1BsYXllciA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNhbWVyYS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGF0LmNlbnRlclBsYXllcikge1xuICAgICAgICAgICAgICAgIHRoaXMueCA9IHRoYXQucGxheWVyLng7XG4gICAgICAgICAgICAgICAgdGhpcy55ID0gdGhhdC5wbGF5ZXIueTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW92ZUxlcnApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW92ZVRvUGxheWVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVUby54ID0gdGhhdC5wbGF5ZXIueDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVRvLnkgPSB0aGF0LnBsYXllci55O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gcGhpbmEuZ2VvbS5WZWN0b3IyLmxlcnAodGhpcy5tb3ZlRnJvbSwgdGhpcy5tb3ZlVG8sIHRoaXMubW92ZVJhdGlvKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbihwLngsIHAueSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8v44K544OG44O844K444Kv44Oq44Ki5pmC5oOF5aCxXG4gICAgICAgIHRoaXMuY2xlYXJSZXN1bHQgPSBbXTtcbiAgICAgICAgdGhpcy50b3RhbFNjb3JlID0gMDtcbiAgICAgICAgdGhpcy50b3RhbEtpbGwgPSAwO1xuXG4gICAgICAgIC8v44Kz44Oz44OG44Kj44OL44Ol44O85pmC54q25oWL44Ot44O844OJXG4gICAgICAgIGlmICh0aGlzLmlzQ29udGludWUpIHRoaXMubG9hZEdhbWUoKTtcblxuICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+S9jee9rlxuICAgICAgICB0aGlzLm1hcHN0YXJ0ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuXG4gICAgICAgIC8v44K544OG44O844K45oOF5aCx5Yid5pyf5YyWXG4gICAgICAgIHRoaXMuc2V0dXBTdGFnZSgpO1xuXG4gICAgICAgIHRoaXMuZmdXaGl0ZSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0uJGV4dGVuZCh7ZmlsbDogJ3doaXRlJ30pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmZnV2hpdGUuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLmZnV2hpdGUudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKS5jbGVhcigpO1xuXG4gICAgICAgIHRoaXMuZmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKS5mYWRlT3V0KDMwKTtcblxuICAgICAgICAvL+ODkOODvOODgeODo+ODq+ODkeODg+ODieOBruWPr+imluWMllxuICAgICAgICBpZiAocGhpbmEuaXNNb2JpbGUoKSB8fCBERUJVR19NT0JJTEUpIHtcbiAgICAgICAgICAgIGFwcC52aXJ0dWFsUGFkLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oMCwgMCk7XG4gICAgICAgIH1cblxuICAgICAgICBhcHAudm9sdW1lQkdNID0gMC41O1xuICAgICAgICBhcHAudm9sdW1lU0UgPSAwLjI7XG5cbiAgICAgICAgLy/jg6Hjg4vjg6Xjg7zjgpLplovjgY9cbiAgICAgICAgdGhpcy5vbignb3Blbm1lbnUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5NZW51U2NlbmUodGhpcykpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+OCreODvOWPluW+l1xuICAgICAgICB0aGlzLm9uKCdnZXRrZXknLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgeCA9IHRoaXMubWFwTGF5ZXIueCArIHRoaXMucGxheWVyLng7XG4gICAgICAgICAgICB2YXIgeSA9IHRoaXMubWFwTGF5ZXIueSArIHRoaXMucGxheWVyLnk7XG4gICAgICAgICAgICB2YXIga2V5ID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKHgsIHkpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5iYXNlTGF5ZXIpO1xuICAgICAgICAgICAga2V5LnR3ZWVuZXIuY2xlYXIoKS5tb3ZlVG8oMTUrKHRoaXMucGxheWVyLmtleXMubGVuZ3RoLTEpKjI0LCAzNiwgNTAwKTtcbiAgICAgICAgICAgIHZhciBzcCA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiaXRlbVwiLCAyNCwgMjQpXG4gICAgICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoSVRFTV9LRVkpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8oa2V5KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqJcbiAgICAgICAgdGhpcy5vbignc3RhZ2VjbGVhcicsIHRoaXMuc3RhZ2VDbGVhcik7XG5cbiAgICAgICAgLy/mrKHjgrnjg4bjg7zjgrjjgbjnp7vooYxcbiAgICAgICAgdGhpcy5vbignbmV4dHN0YWdlJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmFsbENsZWFyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZU51bWJlcisrO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0dXBTdGFnZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLnNhdmVTdGF0dXMoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy/jgqjjg7Pjg4fjgqPjg7PjgrDliIblspBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1RydWVFbmRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFnZU51bWJlciA9IDEwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHVwU3RhZ2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL+S7ruOCqOODs+ODh+OCo+ODs+OCsFxuICAgICAgICAgICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5FbmRpbmdTY2VuZSh0aGlzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvL+OCqOODs+ODh+OCo+ODs+OCsOOBuOenu+ihjFxuICAgICAgICB0aGlzLm9uKCdlbmRpbmcnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5FbmRpbmdTY2VuZSh0aGlzKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v44Ky44O844Og44Kq44O844OQ44O8XG4gICAgICAgIHRoaXMub24oJ2dhbWVvdmVyJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuR2FtZU92ZXJTY2VuZSh0aGlzKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v44Kz44Oz44OG44Kj44OL44Ol44O8XG4gICAgICAgIHRoaXMub24oJ2NvbnRpbnVlJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5yZXN0YXJ0KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v44Ky44O844Og57WC5LqGXG4gICAgICAgIHRoaXMuX2V4aXRHYW1lID0gZmFsc2U7XG4gICAgICAgIHRoaXMub24oJ2V4aXRnYW1lJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5fZXhpdEdhbWUgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzUHJhY3RpY2UpIHRoaXMuc2F2ZUdhbWUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub24oJ2V4aXRnYW1lX25vc2F2ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2V4aXRHYW1lID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jg6Hjg4Pjgrvjg7zjgrjooajnpLpcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDE2LFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLm1lc3NhZ2VTdGFjayA9IFtdO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZSA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuMilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZS5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UubmV4dE9rID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5uZXh0T2sgJiYgdGhhdC5tZXNzYWdlU3RhY2subGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMubmV4dE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9IHRoYXQubWVzc2FnZVN0YWNrWzBdO1xuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSBtc2cudGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAuZmFkZUluKDE1KS53YWl0KDkwKS5mYWRlT3V0KDE1KVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0T2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5tZXNzYWdlU3RhY2suc3BsaWNlKDAsIDEpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICBpZiAodGhpcy50aW1lID09IDE1KSB0aGlzLnBsYXllci5pc0NvbnRyb2wgPSB0cnVlO1xuXG4gICAgICAgIC8v44Ky44O844Og57WC5LqGXG4gICAgICAgIGlmICh0aGlzLl9leGl0R2FtZSkge1xuICAgICAgICAgICAgdGhpcy5leGl0R2FtZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICghdGhpcy5pc1N0YWdlQ2xlYXIpIHtcbiAgICAgICAgICAgIC8v6YCa5bi45pmC5Yem55CGXG4gICAgICAgICAgICAvL+ODoeODi+ODpeODvOOCt+ODvOODs+OBuOenu+ihjFxuICAgICAgICAgICAgaWYgKHRoaXMudGltZSA+IDE1KSB7XG4gICAgICAgICAgICAgICAgaWYgKGN0LnBhdXNlIHx8IGN0Lm1lbnUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnb3Blbm1lbnUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44K544OG44O844K46YCy6KGMXG4gICAgICAgICAgICB2YXIgZXZlbnQgPSB0aGlzLnN0YWdlQ29udHJvbGxlci5nZXQodGhpcy50aW1lKTtcbiAgICAgICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoZXZlbnQudmFsdWUpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnZhbHVlLmNhbGwodGhpcywgZXZlbnQub3B0aW9uKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVudGVyRW5lbXlVbml0KGV2ZW50LnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuODgeOCp+ODg+OCr1xuICAgICAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIuY2xlYXJHYXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhZ2VDb250cm9sbGVyLmNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFwTGF5ZXIuY2xlYXJHYXRlLmlzTG9jayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0aGlzLnBhdXNlU2NlbmUpIHRoaXMudGltZUxpbWl0LS07XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lTGltaXQgPCAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lTGltaXQgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMudGltZUxpbWl0ID09IDAgJiYgIXRoaXMucGxheWVyLmlzRGVhZCkge1xuLy8gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZGVhZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmmYLlh6bnkIZcbiAgICAgICAgICAgIC8v5q6L44KK44K/44Kk44Og44KS44K544Kz44Ki5Yqg566XXG4gICAgICAgICAgICBpZiAodGhpcy50aW1lTGltaXQgPj0gNjApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVMaW1pdCAtPSA2MDtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsU2NvcmUgKz0gMjA7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGltZUxpbWl0IDwgNjApIHRoaXMudGltZUxpbWl0ID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jgrfjg6fjg7zjg4jjgqvjg4Pjg4hcbiAgICAgICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICAgICAgaWYgKGN0Lm9rKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGltZUxpbWl0ID49IDYwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxTY29yZSArPSBNYXRoLmZsb29yKHRoaXMudGltZUxpbWl0IC8gNjApICogMjA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jgrnjgq/jg6rjg7zjg7PooajnpLrkvY3nva5cbiAgICAgICAgdmFyIG1hcCA9IHRoaXMubWFwTGF5ZXIubWFwO1xuICAgICAgICB0aGlzLm1hcExheWVyLnggPSBTQ19XICogMC41IC0gdGhpcy5jYW1lcmEueDtcbiAgICAgICAgdGhpcy5tYXBMYXllci55ID0gU0NfSCAqIDAuNSAtIHRoaXMuY2FtZXJhLnk7XG4gICAgICAgIGlmICh0aGlzLmxpbWl0SGVpZ2h0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5tYXBMYXllci55ID4gMCkgdGhpcy5tYXBMYXllci55ID0gMDtcbiAgICAgICAgICAgIGlmICh0aGlzLm1hcExheWVyLnkgPCAtKG1hcC5oZWlnaHQtU0NfSCkpIHRoaXMubWFwTGF5ZXIueSA9IC0obWFwLmhlaWdodC1TQ19IKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5saW1pdFdpZHRoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5tYXBMYXllci54ID4gMCkgdGhpcy5tYXBMYXllci54ID0gMDtcbiAgICAgICAgICAgIGlmICh0aGlzLm1hcExheWVyLnggPCAtKG1hcC53aWR0aC1TQ19XKSkgdGhpcy5tYXBMYXllci54ID0gLShtYXAud2lkdGgtU0NfVyk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+OCueOCr+ODquODvOODs+W6p+aomVxuICAgICAgICB0aGlzLnNjcmVlblggPSAtdGhpcy5tYXBMYXllci54O1xuICAgICAgICB0aGlzLnNjcmVlblkgPSAtdGhpcy5tYXBMYXllci55O1xuXG4gICAgICAgIGlmICh0aGlzLnN0YWdlQ29udHJvbGxlci5pc0JhY2tncm91bmRNb3ZlKSB7XG4gICAgICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODieOBrljluqfmqJnjgpLlhajkvZPjga7libLlkIjjgYvjgonoqIjnrpdcbiAgICAgICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLnggPSAtTWF0aC5mbG9vcih0aGlzLmJhY2tncm91bmRJbWFnZS53aWR0aCAqICh0aGlzLnBsYXllci54IC8gbWFwLndpZHRoKSowLjA1KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLnggPSB0aGlzLnN0YWdlQ29udHJvbGxlci5iYWNrZ3JvdW5kWDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG5cbiAgICAvL+aVteOCreODo+ODqeOCr+OCv+aKleWFpVxuICAgIHNwYXduRW5lbXk6IGZ1bmN0aW9uKHgsIHksIG5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHFmdC5FbmVteVtuYW1lXSh0aGlzLCBvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMuZW5lbXlMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgfSxcblxuICAgIC8v44Ki44Kk44OG44Og5oqV5YWlXG4gICAgc3Bhd25JdGVtOiBmdW5jdGlvbih4LCB5LCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBxZnQuSXRlbSh0aGlzLCBvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgIH0sXG5cbiAgICAvL+OCouOCpOODhuODoOODnOODg+OCr+OCueaKleWFpVxuICAgIHNwYXduSXRlbUJveDogZnVuY3Rpb24oeCwgeSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gcWZ0Lkl0ZW1Cb3godGhpcywgb3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICB9LFxuXG4gICAgLy/jgqjjg5Xjgqfjgq/jg4jmipXlhaVcbiAgICBzcGF3bkVmZmVjdDogZnVuY3Rpb24oeCwgeSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gcWZ0LkVmZmVjdCh0aGlzLCBvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgIH0sXG5cbiAgICAvL+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgIHNwYXduTWVzc2FnZTogZnVuY3Rpb24odGV4dCwgYmV0d2Vlbiwgd2FpdEZyYW1lKSB7XG4gICAgICAgIGJldHdlZW4gPSBiZXR3ZWVuIHx8IDMyO1xuICAgICAgICB3YWl0RnJhbWUgPSB3YWl0RnJhbWUgfHwgMzA7XG4gICAgICAgIHZhciBhcnJheVRleHQgPSB0ZXh0LnNwbGl0KFwiXCIpO1xuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibHVlXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAzMixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHZhciBuID0gMDtcbiAgICAgICAgdmFyIHggPSBTQ19XICogMC41IC0gKGFycmF5VGV4dC5sZW5ndGggKiBiZXR3ZWVuICogMC41KTtcbiAgICAgICAgYXJyYXlUZXh0LmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUgPT0gXCIgXCIpIHtcbiAgICAgICAgICAgICAgICB4ICs9IGJldHdlZW47XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGxiID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogZX0uJHNhZmUobGFiZWxQYXJhbSkpLnNldFBvc2l0aW9uKHgsIFNDX0gqMC41KzMyKS5zZXRTY2FsZSgwLCAxKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICAgICAgbGIudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgICAgIC53YWl0KG4pXG4gICAgICAgICAgICAgICAgLnRvKHtzY2FsZVg6IDEuMCwgYWxwaGE6IDEsIHk6IFNDX0gqMC41fSwgMTUsIFwiZWFzZU91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAud2FpdCh3YWl0RnJhbWUpXG4gICAgICAgICAgICAgICAgLnRvKHtzY2FsZVg6IDAuMCwgeTogU0NfSCowLjUtMzJ9LCAxMCwgXCJlYXNlT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7dGhpcy5yZW1vdmUoKX0uYmluZChsYikpO1xuICAgICAgICAgICAgeCArPSBiZXR3ZWVuO1xuICAgICAgICAgICAgbiArPSA1O1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvL+OCpOODmeODs+ODiOODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgIHNwYXduRXZlbnRNZXNzYWdlOiBmdW5jdGlvbihpZCwgdGV4dCkge1xuICAgICAgICBpZiAoIWlkIHx8ICF0ZXh0KSByZXR1cm47XG4gICAgICAgIC8v44Oh44OD44K744O844K444K544K/44OD44Kv5YaF44Gr5ZCM5LiA77yp77yk44GM44GC44KL5aC05ZCI44Gv5oqV5YWl44GX44Gq44GEXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tZXNzYWdlU3RhY2subGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1lc3NhZ2VTdGFja1tpXS5pZCA9PSBpZCkgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0ZXh0IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgIHRleHQuZm9yRWFjaChmdW5jdGlvbihzdHIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VTdGFjay5wdXNoKHtpZDogaWQsIHRleHQ6IHN0cn0pO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZVN0YWNrLnB1c2goe2lkOiBpZCwgdGV4dDogdGV4dH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44K544Kv44Oq44O844Oz5Yid5pyf5YyWXG4gICAgc2V0dXBTY3JlZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJVYnVudHVNb25vXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJsZWZ0XCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAyMCxcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG5cbiAgICAgICAgLy/kvZPlipvjgrLjg7zjgrhcbiAgICAgICAgdGhpcy5saWZlR2F1Z2VMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiTElGRVwifS4kc2FmZShsYWJlbFBhcmFtKSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbigwLCAxMCk7XG4gICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgd2lkdGg6ICAyMDAsXG4gICAgICAgICAgICBoZWlnaHQ6IDUsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICBmaWxsOiAncmVkJyxcbiAgICAgICAgICAgIHN0cm9rZTogJ3doaXRlJyxcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuICAgICAgICAgICAgZ2F1Z2VDb2xvcjogJ2xpbWUnLFxuICAgICAgICAgICAgY29ybmVyUmFkaXVzOiAwLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMucGxheWVyLmhwLFxuICAgICAgICAgICAgbWF4VmFsdWU6IHRoaXMucGxheWVyLmhwTWF4LFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmxpZmVHYXVnZSA9IHBoaW5hLnVpLkdhdWdlKG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcykuc2V0T3JpZ2luKDAsIDAuNSkuc2V0UG9zaXRpb24oNDAsIDEwKTtcbiAgICAgICAgdGhpcy5saWZlR2F1Z2UudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhhdC5wbGF5ZXIuaHA7XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gdGhhdC5wbGF5ZXIuaHBNYXggKiAyO1xuICAgICAgICAgICAgdGhpcy5tYXhWYWx1ZSA9IHRoYXQucGxheWVyLmhwTWF4O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8v44K544Kz44Ki6KGo56S6XG4gICAgICAgIHRoaXMuc2NvcmVMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6XCJTQ09SRTpcIiwgYWxpZ246IFwicmlnaHRcIn0uJHNhZmUobGFiZWxQYXJhbSkpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVywgMTApO1xuICAgICAgICB0aGlzLnNjb3JlTGFiZWwuc2NvcmUgPSAwO1xuICAgICAgICB0aGlzLnNjb3JlTGFiZWwucyA9IDA7XG4gICAgICAgIHRoaXMuc2NvcmVMYWJlbC51cGRhdGUgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZS50aWNrZXIuZnJhbWUgJSAxMCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zID0gfn4oKHRoYXQudG90YWxTY29yZS10aGlzLnNjb3JlKS83KTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zIDwgMykgdGhpcy5zID0gMztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zID4gNzc3NykgdGhpcy5zID0gNzc3NztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2NvcmUgKz0gdGhpcy5zO1xuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcmUgPiB0aGF0LnRvdGFsU2NvcmUpIHRoaXMuc2NvcmUgPSB0aGF0LnRvdGFsU2NvcmU7XG5cbiAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiU0NPUkUgXCIrdGhpcy5zY29yZS5jb21tYSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/liLbpmZDmmYLplpPooajnpLpcbiAgICAgICAgdGhpcy50aW1lTGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlRJTUU6XCIsIGFsaWduOiBcInJpZ2h0XCJ9LiRzYWZlKGxhYmVsUGFyYW0pKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1csIDMwKTtcbiAgICAgICAgdGhpcy50aW1lTGFiZWwudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSBcIlRJTUU6XCIrTWF0aC5mbG9vcih0aGF0LnRpbWVMaW1pdC8zMCk7XG4gICAgICAgICAgICBpZiAodGhhdC50aW1lTGltaXQgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsbCA9ICdyZWQnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGwgPSAnd2hpdGUnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zoo4XlgpnmrablmajooajnpLpcbiAgICAgICAgdGhpcy5wbGF5ZXJXZWFwb24gPSBxZnQuUGxheWVyV2VhcG9uKHRoaXMucGxheWVyKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1ctMzAsIFNDX0gtMzApO1xuICAgICAgICB2YXIgc3cgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogNjAsIGhlaWdodDogNjB9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XLTMwLCBTQ19ILTMwKVxuICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKHRydWUpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC4wKTtcbiAgICAgICAgc3cub24oJ3BvaW50c3RhcnQnLCBlID0+IHtcbiAgICAgICAgICAgIHZhciBwbCA9IHRoYXQucGxheWVyO1xuICAgICAgICAgICAgaWYgKCFwbC5iZWZvcmUuY2hhbmdlICYmIHBsLmVxdWlwLnN3aXRjaE9rKSBwbC5zd2l0Y2hXZWFwb24oKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44Oe44OD44OX5oOF5aCx44Gu5Yid5pyf5YyWXG4gICAgc2V0dXBTdGFnZTogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdGhpcy5iYXNlTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcblxuICAgICAgICAvL+eZu+mMsua4iOOBv+ODnuODg+ODl+OBrua2iOWOu1xuICAgICAgICB0aGlzLmNsZWFyTWFwKCk7XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgrjoqK3lrproqq3jgb/ovrzjgb9cbiAgICAgICAgc3dpdGNoICh0aGlzLnN0YWdlTnVtYmVyKSB7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2UxKHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTIodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlMyh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2U0KHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTUodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlNih0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2U3KHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTgodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlOSh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlMTAodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNFbmRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8v44K344K544OG44Og6KGo56S644Gu77yv77ym77ymXG4gICAgICAgICAgICAgICAgdGhpcy5saWZlR2F1Z2VMYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5saWZlR2F1Z2UudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2NvcmVMYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lTGFiZWwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyV2VhcG9uLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgOTk5OlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlOTk5KHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfTtcblxuICAgICAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouODleODqeOCsOOCr+ODquOColxuICAgICAgICB0aGlzLmlzU3RhZ2VDbGVhciA9IGZhbHNlO1xuXG4gICAgICAgIC8v57WM6YGO5pmC6ZaT5Yid5pyf5YyWXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4joqK3lrppcbiAgICAgICAgdGhpcy50aW1lTGltaXQgPSB0aGlzLnN0YWdlQ29udHJvbGxlci50aW1lTGltaXQ7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zoqK3lrppcbiAgICAgICAgdGhpcy5wbGF5ZXIuaXNDb250cm9sID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuaXNNdXRla2kgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuYWxwaGEgPSAxLjA7XG5cbiAgICAgICAgdGhpcy5tYXBzdGFydCA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KTtcblxuICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlci5wbGF5QkdNKCk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kk44OZ44Oz44OI55m654GrXG4gICAgZmlyZVN0YWdlRXZlbnQ6IGZ1bmN0aW9uKGV2ZW50TmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFnZUNvbnRyb2xsZXIuZmlyZUV2ZW50KGV2ZW50TmFtZSk7XG4gICAgfSxcblxuICAgIHdhcnA6IGZ1bmN0aW9uKHgsIHksIGZyYW1lKSB7XG4gICAgICAgIGZyYW1lID0gZnJhbWUgfHwgNjA7XG4gICAgICAgIHRoaXMucGxheWVyLmlzQ29udHJvbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBsYXllci5ncmF2aXR5ID0gMDtcbiAgICAgICAgdGhpcy5wbGF5ZXIudnggPSAwO1xuICAgICAgICB0aGlzLnBsYXllci5pc011dGVraSA9IHRydWU7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoNDUpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoaXMuaWdub3JlQ29sbGlzaW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzLnBsYXllcikpXG4gICAgICAgICAgICAubW92ZVRvKHgsIHksIGZyYW1lLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhpcy5pZ25vcmVDb2xsaXNpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyYXZpdHkgPSAwLjk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcy5wbGF5ZXIpKVxuICAgICAgICAgICAgLndhaXQoOTApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoaXMuaXNDb250cm9sID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzTXV0ZWtpID0gZmFsc2U7XG4gICAgICAgICAgICB9LmJpbmQodGhpcy5wbGF5ZXIpKTtcbiAgICB9LFxuXG4gICAgLy/jg57jg4Pjg5fmg4XloLHjga7mtojljrtcbiAgICBjbGVhck1hcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v5b2T44Gf44KK5Yik5a6a44CB44Kq44OW44K444Kn44Kv44OI44Gu5YWo5raI5Y67XG4gICAgICAgIGlmICh0aGlzLmJhY2tncm91bmRMYXllcikgdGhpcy5iYWNrZ3JvdW5kTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICAgICAgaWYgKHRoaXMuZm9yZWdyb3VuZExheWVyKSB0aGlzLmZvcmVncm91bmRMYXllci5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICBpZiAodGhpcy5jb2xsaXNpb25MYXllKSB0aGlzLmNvbGxpc2lvbkxheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG4gICAgICAgIGlmICh0aGlzLmVuZW15TGF5ZXIpIHRoaXMuZW5lbXlMYXllci5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICBpZiAodGhpcy5vYmpMYXllcikgdGhpcy5vYmpMYXllci5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICBpZiAodGhpcy5tYXBJbWFnZUxheWVyKSB0aGlzLm1hcEltYWdlTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICAgICAgaWYgKHRoaXMuZWZmZWN0TGF5ZXIpIHRoaXMuZWZmZWN0TGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICAgICAgaWYgKHRoaXMuc2hhZG93TGF5ZXIpIHRoaXMuc2hhZG93TGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICB9LFxuXG4gICAgLy/jg57jg4Pjg5fjg6zjgqTjg6Tjga7liIfmm79cbiAgICBzd2l0Y2hNYXA6IGZ1bmN0aW9uKGxheWVyLCB4LCB5KSB7XG4gICAgICAgIGlmICh0aGlzLm1hcExheWVyKSB0aGlzLm1hcExheWVyLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLm1hcExheWVyID0gbGF5ZXI7XG4gICAgICAgIHRoaXMubWFwTGF5ZXIuYWRkQ2hpbGRUbyh0aGlzLmJhc2VMYXllcik7XG4gICAgICAgIHRoaXMubWFwID0gbGF5ZXIubWFwO1xuXG4gICAgICAgIHRoaXMuYmFja2dyb3VuZExheWVyID0gbGF5ZXIuYmFja2dyb3VuZExheWVyO1xuICAgICAgICB0aGlzLmZvcmVncm91bmRMYXllciA9IGxheWVyLmZvcmVncm91bmRMYXllcjtcbiAgICAgICAgdGhpcy5jb2xsaXNpb25MYXllciA9IGxheWVyLmNvbGxpc2lvbkxheWVyO1xuICAgICAgICB0aGlzLmVuZW15TGF5ZXIgPSBsYXllci5lbmVteUxheWVyO1xuICAgICAgICB0aGlzLnBsYXllckxheWVyID0gbGF5ZXIucGxheWVyTGF5ZXI7XG4gICAgICAgIHRoaXMub2JqTGF5ZXIgPSBsYXllci5vYmpMYXllcjtcbiAgICAgICAgdGhpcy5tYXBJbWFnZUxheWVyID0gbGF5ZXIubWFwSW1hZ2VMYXllcjtcbiAgICAgICAgdGhpcy5lZmZlY3RMYXllciA9IGxheWVyLmVmZmVjdExheWVyO1xuICAgICAgICB0aGlzLnNoYWRvd0xheWVyID0gbGF5ZXIuc2hhZG93TGF5ZXI7XG5cbiAgICAgICAgdGhpcy5wbGF5ZXIucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMucGxheWVyLmFkZENoaWxkVG8obGF5ZXIucGxheWVyTGF5ZXIpO1xuICAgICAgICBpZiAoeCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/jg6rjgrnjgr/jg7zjg4hcbiAgICByZXN0YXJ0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuY29udGludWVSZXNldCgpO1xuICAgICAgICB0aGlzLnBsYXllci5tdXRla2lUaW1lID0gOTA7XG4gICAgICAgIHRoaXMucGxheWVyLmFkZENoaWxkVG8odGhpcy5tYXBMYXllci5wbGF5ZXJMYXllcik7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zluqfmqJnjgpLmnIDlvozjgavluorjgavjgYTjgZ/loLTmiYDjgavjgZnjgotcbiAgICAgICAgdGhpcy5wbGF5ZXIueCA9IHRoaXMucGxheWVyLmxhc3RPbkZsb29yWDtcbiAgICAgICAgdGhpcy5wbGF5ZXIueSA9IHRoaXMucGxheWVyLmxhc3RPbkZsb29yWTtcblxuICAgICAgICAvL+W+qeW4sOS9jee9ruWuieWFqOaAp+eiuuiqjVxuICAgICAgICB2YXIgeCA9IHRoaXMucGxheWVyLng7XG4gICAgICAgIHZhciB5ID0gdGhpcy5wbGF5ZXIueTtcbiAgICAgICAgdmFyIGMxID0gdGhpcy5wbGF5ZXIuY2hlY2tNYXBDb2xsaXNpb24yKHgsIHkgKyA1LCA0LCAzMik7ICAgLy/nnJ/kuItcbiAgICAgICAgdmFyIGMyID0gdGhpcy5wbGF5ZXIuY2hlY2tNYXBDb2xsaXNpb24yKHgrMzIsIHkgKyA1LCA0LCAzMik7Ly/lj7PkuItcbiAgICAgICAgdmFyIGMzID0gdGhpcy5wbGF5ZXIuY2hlY2tNYXBDb2xsaXNpb24yKHgtMzIsIHkgKyA1LCA0LCAzMik7Ly/lt6bkuItcbiAgICAgICAgLy/nnJ/kuIvjgavotrPloLTjgYznhKHjgYTloLTlkIjjga/lronlhajjgarloLTmiYDjgavjgZrjgonjgZlcbiAgICAgICAgaWYgKCFjMSkge1xuICAgICAgICAgICAgaWYgKGMyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIueCArPSAzMjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYzMpe1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLnggLT0gMzI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v5a6J5YWo44Gr5b6p5biw5Ye65p2l44Gq44GE44Gu44Gn55u06L+R44Gu44K544K/44O844OI5Zyw54K544G4XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIueCA9IHRoaXMubWFwc3RhcnQueDtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci55ID0gdGhpcy5tYXBzdGFydC55O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50b3RhbFNjb3JlID0gMDtcbiAgICAgICAgdGhpcy50b3RhbEtpbGwgPSAwO1xuICAgICAgICB0aGlzLmNvbnRpbnVlQ291bnQrKztcblxuICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlci5wbGF5QkdNKCk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44KiXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJVYnVudHVNb25vXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAyMCxcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG5cbiAgICAgICAgLy/jgqrjg7zjg6vjgq/jg6rjgqLliKTlrppcbiAgICAgICAgdGhpcy5hbGxDbGVhciA9IGZhbHNlO1xuICAgICAgICBpZiAoIXRoaXMuaXNQcmFjdGljZSAmJiB0aGlzLnN0YWdlTnVtYmVyID49IHRoaXMuc3RhZ2VOdW1iZXJNYXgpIHRoaXMuYWxsQ2xlYXIgPSB0cnVlO1xuXG4gICAgICAgIC8v44Kv44Oq44Ki44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgIHZhciB0ZXh0ID0gXCJTVEFHRSBcIiArIHRoaXMuc3RhZ2VOdW1iZXIgKyBcIiBDTEVBUiFcIjtcbiAgICAgICAgaWYgKHRoaXMuYWxsQ2xlYXIpIHRleHQgPSBcIlNUQUdFIEFMTCBDTEVBUiFcIjtcbiAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UodGV4dCwgMjQpO1xuICAgICAgICB0aGlzLnBsYXllci5pc0NvbnRyb2wgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIuc3RhZ2VDbGVhcigpO1xuICAgICAgICB0aGlzLmlzU3RhZ2VDbGVhciA9IHRydWU7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmiYDmjIHjgq3jg7zjgq/jg6rjgqJcbiAgICAgICAgdGhpcy5wbGF5ZXIua2V5cyA9IFtdO1xuICAgICAgICB0aGlzLnBsYXllci5pc011dGVraSA9IHRydWU7XG5cbiAgICAgICAgLy/jgq/jg6rjgqJCR01cbiAgICAgICAgdmFyIGJnbUZpbmlzaCA9IGZhbHNlO1xuICAgICAgICBhcHAucGxheUJHTShcInN0YWdlY2xlYXJcIiwgZmFsc2UsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYmdtRmluaXNoID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGFyID0ge2xvYWRjb21wbGV0ZTogdHJ1ZX07XG4gICAgICAgIGlmICghdGhpcy5pc1ByYWN0aWNlKSB7XG4gICAgICAgICAgICAvL+OCr+ODquOCouaZgueCueaDheWgseS/neWtmFxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgc3RhZ2U6IHRoaXMuc3RhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgc2NvcmU6IHRoaXMudG90YWxTY29yZSxcbiAgICAgICAgICAgICAgICBraWxsOiB0aGlzLnRvdGFsS2lsbCxcbiAgICAgICAgICAgICAgICB0aW1lOiB0aGlzLnN0YWdlQ29udHJvbGxlci50aW1lTGltaXQgLSB0aGlzLnRpbWVMaW1pdCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmNsZWFyUmVzdWx0W3RoaXMuc3RhZ2VOdW1iZXJdID0gZGF0YTtcblxuICAgICAgICAgICAgLy/mrKHjgrnjg4bjg7zjgrjjga7jgqLjgrvjg4Pjg4joqq3jgb/ovrzjgb9cbiAgICAgICAgICAgIGlmICh0aGlzLnN0YWdlTnVtYmVyIDwgdGhpcy5zdGFnZU51bWJlck1heCkge1xuICAgICAgICAgICAgICAgIHZhciBhc3NldHMgPSBxZnQuQXNzZXRzLmdldCh7YXNzZXRUeXBlOiBcInN0YWdlXCIrKHRoaXMuc3RhZ2VOdW1iZXIrMSl9KTtcbiAgICAgICAgICAgICAgICB2YXIgYXIgPSBwaGluYS5leHRlbnNpb24uQXNzZXRMb2FkZXJFeCgpLmxvYWQoYXNzZXRzLCBmdW5jdGlvbigpe2FwcC5zb3VuZHNldC5yZWFkQXNzZXQoKTt9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy/jgqrjg7zjg6vjgq/jg6rjgqLmmYLjga/jgqjjg7Pjg4fjgqPjg7PjgrDnlKjjgrnjg4bjg7zjgrjjgbhcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hbGxDbGVhcikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXNzZXRzID0gcWZ0LkFzc2V0cy5nZXQoe2Fzc2V0VHlwZTogXCJzdGFnZTEwXCJ9KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFyID0gcGhpbmEuZXh0ZW5zaW9uLkFzc2V0TG9hZGVyRXgoKS5sb2FkKGFzc2V0cywgZnVuY3Rpb24oKXthcHAuc291bmRzZXQucmVhZEFzc2V0KCk7fSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jg63jg7zjg4npgLLmjZfooajnpLpcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgcGFyYW0gPSB7dGV4dDogXCJMb2FkaW5nLi4uIFwiLCBhbGlnbjogXCJyaWdodFwiLCBmb250U2l6ZTogMjB9LiRzYWZlKGxhYmVsUGFyYW0pO1xuICAgICAgICB2YXIgcHJvZ3Jlc3MgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1csIFNDX0gqMC45NSk7XG4gICAgICAgIHByb2dyZXNzLnRpbWUgPSAwO1xuICAgICAgICBwcm9ncmVzcy51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44Ot44O844OJ44GM57WC44KP44Gj44Gf44KJ44Kt44O85YWl5Yqb44Gn5qyh44K544OG44O844K444G4XG4gICAgICAgICAgICBpZiAoYXIubG9hZHByb2dyZXNzKSB0aGlzLnRleHQgPSBcIkxvYWRpbmcuLi4gXCIrTWF0aC5mbG9vcihhci5sb2FkcHJvZ3Jlc3MgKiAxMDApK1wiJVwiO1xuICAgICAgICAgICAgaWYgKGJnbUZpbmlzaCAmJiB0aGF0LnRpbWVMaW1pdCA9PSAwICYmIGFyLmxvYWRjb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiUHVzaCBidXR0b24gdG8gbmV4dCBzdGFnZS5cIjtcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5hbGxDbGVhcikgdGhpcy50ZXh0ID0gXCJQdXNoIGJ1dHRvbiB0byBuZXh0Li4uXCI7XG4gICAgICAgICAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgICAgICAgICAgaWYgKGN0Lm9rIHx8IGN0LmNhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5pc1ByYWN0aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9leGl0R2FtZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmZsYXJlKCduZXh0c3RhZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAzMCA9PSAwKSB0aGlzLnZpc2libGUgPSAhdGhpcy52aXNpYmxlO1xuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZXhpdEdhbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHAucGxheUJHTShcIm9wZW5pbmdiZ21cIik7XG4gICAgICAgIGlmICh0aGlzLmlzUHJhY3RpY2UgfHwgdGhpcy5pc0NvbnRpbnVlKSB7XG4gICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXhpdChcInRpdGxlXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v54++5Zyo44Gu44K544OG44O844K/44K544KS44Ot44O844Kr44Or44K544OI44Os44O844K444G45L+d5a2YXG4gICAgc2F2ZUdhbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2F2ZU9iaiA9IHtcbiAgICAgICAgICAgIHN0YWdlTnVtYmVyOiB0aGlzLnN0YWdlTnVtYmVyLFxuICAgICAgICAgICAgc2NvcmU6IHRoaXMudG90YWxTY29yZSxcbiAgICAgICAgICAgIGtpbGw6IHRoaXMudG90YWxLaWxsLFxuICAgICAgICAgICAgcmVzdWx0OiB0aGlzLmNsZWFyUmVzdWx0LFxuICAgICAgICAgICAgcGxheWVyU3RhdHVzOiB0aGlzLnBsYXllci5zdGFydFN0YXR1cyxcbiAgICAgICAgfTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJzdGFnZVwiLCBKU09OLnN0cmluZ2lmeShzYXZlT2JqKSk7XG4gICAgICAgIHJldHVybiBzYXZlT2JqO1xuICAgIH0sXG5cbiAgICAvL+ODreODvOOCq+ODq+OCueODiOODrOODvOOCuOOBi+OCieebtOWJjeOBruS/neWtmOeKtuaFi+OCkuiqreOBv+i+vOOBv1xuICAgIGxvYWRHYW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInN0YWdlXCIpO1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgdmFyIGQgPSBKU09OLnBhcnNlKGRhdGEpLiRzYWZlKHtcbiAgICAgICAgICAgICAgICBzdGFnZU51bWJlcjogMSxcbiAgICAgICAgICAgICAgICByZXN1bHQ6IFtdLFxuICAgICAgICAgICAgICAgIHBsYXllclN0YXR1czoge30sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuc3RhZ2VOdW1iZXIgPSBkLnN0YWdlTnVtYmVyO1xuICAgICAgICAgICAgdGhpcy50b3RhbFNjb3JlID0gMDtcbiAgICAgICAgICAgIHRoaXMudG90YWxLaWxsID0gMDtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJSZXN1bHQgPSBkLnJlc3VsdDtcblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmg4XloLHlvqnlhYNcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnN0YXJ0U3RhdHVzID0gZC5wbGF5ZXJTdGF0dXM7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5yZXN0b3JlU3RhdHVzKCk7XG4gICAgICAgICAgICB0aGlzLnBsYXllcldlYXBvbi5yb3RhdGlvbiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGQ7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtZW51c2NlbmUuanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuIFxucGhpbmEuZGVmaW5lKFwicWZ0Lk1lbnVTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oY3VycmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIHRoaXMuY3VycmVudFNjZW5lID0gY3VycmVudFNjZW5lO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwwLjUpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwwLjUpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpXG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJsZWZ0XCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAxNixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5wbGF5ZXIgPSB0aGlzLmN1cnJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHRoaXMubGltaXRGcmFtZSA9IDMwO1xuICAgICAgICB0aGlzLmlzRXhpdCA9IGZhbHNlO1xuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogNSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJ0aXRsZWZvbnQyXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDcwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRleHRMYWJlbDEgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlBBVVNFXCIsIGZvbnRTaXplOiAyMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjgpO1xuXG4gICAgICAgIHRoaXMudGltZSA9IDA7ICAgICAgICBcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxMCAmJiAhdGhpcy5pc0V4aXQpIHtcbiAgICAgICAgICAgIGlmIChjdC5zdGFydCB8fCBjdC5wYXVzZSB8fCBjdC5tZW51KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0V4aXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC53YWl0KDEwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAucG9wU2NlbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5saW1pdEZyYW1lLS07XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG59KTtcblxuIiwiLypcbiAqICBtZW51c2NlbmUuanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuIFxucGhpbmEuZGVmaW5lKFwicWZ0Lk1lbnVTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oY3VycmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIHRoaXMuY3VycmVudFNjZW5lID0gY3VycmVudFNjZW5lO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwwLjUpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwwLjUpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpXG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJsZWZ0XCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAxNixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5wbGF5ZXIgPSB0aGlzLmN1cnJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciB4ID0gU0NfVyowLjM7IC8vdGhpcy5wbGF5ZXIueCArIHRoaXMuY3VycmVudFNjZW5lLm1hcExheWVyLng7XG4gICAgICAgIHZhciB5ID0gU0NfSCowLjU7IC8vdGhpcy5wbGF5ZXIueSArIHRoaXMuY3VycmVudFNjZW5lLm1hcExheWVyLnk7XG5cbiAgICAgICAgLy/jg5njg7zjgrnjgqjjg6zjg6Hjg7Pjg4hcbiAgICAgICAgdGhpcy5tZW51QmFzZSA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICB0aGlzLm1lbnVCYXNlLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG5cbiAgICAgICAgLy/jg6Hjg4vjg6Xjg7zjgqLjgqTjg4bjg6DliJ3mnJ/ljJZcbiAgICAgICAgdGhpcy5zZXRJdGVtcygpO1xuXG4gICAgICAgIC8v54++5Zyo6KOF5YKZ6KGo56S6XG4gICAgICAgIHZhciBlcSA9IHRoaXMucGxheWVyLmVxdWlwO1xuICAgICAgICB0aGlzLndlYXBvbiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiaXRlbVwiLCAyNCwgMjQpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjU1LCBTQ19IKjAuMylcbiAgICAgICAgICAgIC5zZXRTY2FsZSgxLjUpXG4gICAgICAgICAgICAuc2V0RnJhbWVJbmRleChlcS53ZWFwb25bMF0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy53ZWFwb25MYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41NSszMiwgU0NfSCowLjMpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy53ZWFwb25MYWJlbC51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gcWZ0Lkl0ZW1JbmZvLmdldChlcS53ZWFwb25bMF0pO1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gaXRlbS5uYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMubGltaXRGcmFtZSA9IDMwO1xuXG4gICAgICAgIHRoaXMuaXNFeGl0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMudGltZSA9IDA7ICAgICAgICBcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxMCAmJiAhdGhpcy5pc0V4aXQpIHtcbiAgICAgICAgICAgIGlmIChjdC5zdGFydCB8fCBjdC5wYXVzZSB8fCBjdC5tZW51KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0V4aXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCgxMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnBvcFNjZW5lKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN0LnJpZ2h0ICYmIHRoaXMubGltaXRGcmFtZSA8IDApIHtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiY2xpY2tcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5tZW51QmFzZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLmJ5KHtyb3RhdGlvbjogLXRoaXMuZGVnXzF9LCA0KVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucm90YXRpb24gPCAwKSB0aGlzLnJvdGF0aW9uICs9IDM2MDtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMubWVudUJhc2UpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxpbWl0RnJhbWUgPSA1O1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFNjZW5lLm1lbnVTZWxlY3QrKztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50U2NlbmUubWVudVNlbGVjdCA9PSB0aGlzLmljb24ubGVuZ3RoKSB0aGlzLmN1cnJlbnRTY2VuZS5tZW51U2VsZWN0ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdC5sZWZ0ICYmIHRoaXMubGltaXRGcmFtZSA8IDApIHtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiY2xpY2tcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5tZW51QmFzZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLmJ5KHtyb3RhdGlvbjogdGhpcy5kZWdfMX0sIDQpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yb3RhdGlvbiA+IDM2MCkgdGhpcy5yb3RhdGlvbiAtPSAzNjA7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzLm1lbnVCYXNlKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5saW1pdEZyYW1lID0gNTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZS5tZW51U2VsZWN0LS07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudFNjZW5lLm1lbnVTZWxlY3QgPCAwKSB0aGlzLmN1cnJlbnRTY2VuZS5tZW51U2VsZWN0ID0gdGhpcy5pY29uLmxlbmd0aC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMubGltaXRGcmFtZS0tO1xuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgc2V0SXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMjQsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5tZW51QmFzZS5yZW1vdmVDaGlsZHJlbigpO1xuXG4gICAgICAgIC8v44Oh44OL44Ol44O844Ki44Kk44OG44OgXG4gICAgICAgIHRoaXMuaWNvbiA9IFtdO1xuICAgICAgICB0aGlzLm1lbnVJdGVtcyA9IHRoaXMucGxheWVyLml0ZW1zLmNsb25lKCk7XG5cbiAgICAgICAgdmFyIHJhZCA9IDA7XG4gICAgICAgIHZhciByYWRfMSA9IChNYXRoLlBJKjIpIC8gdGhpcy5tZW51SXRlbXMubGVuZ3RoO1xuICAgICAgICB2YXIgaWQgPSAwO1xuICAgICAgICB0aGlzLm1lbnVJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBpYztcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBpYyA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IGV9LiRzYWZlKGxhYmVsUGFyYW0pKS5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpO1xuICAgICAgICAgICAgICAgIGljLnNldFNjYWxlKDAuNSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGljID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJpdGVtXCIsIDI0LCAyNClcbiAgICAgICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpYy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICAgICAgaWMucmFkID0gcmFkO1xuICAgICAgICAgICAgaWMuaWQgPSBpZDtcbiAgICAgICAgICAgIGljLmRpc3RhbmNlID0gMDtcbiAgICAgICAgICAgIGljLmlzQ2xvc2UgPSBmYWxzZTtcbiAgICAgICAgICAgIGljLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSAtdGhhdC5tZW51QmFzZS5yb3RhdGlvbjtcbiAgICAgICAgICAgICAgICB0aGlzLnggPSAgTWF0aC5zaW4odGhpcy5yYWQpKnRoaXMuZGlzdGFuY2U7XG4gICAgICAgICAgICAgICAgdGhpcy55ID0gLU1hdGguY29zKHRoaXMucmFkKSp0aGlzLmRpc3RhbmNlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQ2xvc2UpIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZCA9PSB0aGF0LmN1cnJlbnRTY2VuZS5tZW51U2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpLnRvKHtkaXN0YW5jZTogODgsIHNjYWxlWDogMywgc2NhbGVZOiAzfSwgMyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKCkudG8oe2Rpc3RhbmNlOiA3Miwgc2NhbGVYOiAxLCBzY2FsZVk6IDF9LCAzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpYy5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpLnRvKHtkaXN0YW5jZTogMCwgc2NhbGVYOiAxLCBzY2FsZVk6IDF9LCAzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQ2xvc2UgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWMudHdlZW5lci5jbGVhcigpLnRvKHtkaXN0YW5jZTogNDh9LCA1MDApO1xuICAgICAgICAgICAgdGhpcy5pY29uLnB1c2goaWMpO1xuICAgICAgICAgICAgcmFkICs9IHJhZF8xO1xuICAgICAgICAgICAgaWQrKztcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICB0aGlzLmRlZ18xID0gMzYwLyB0aGlzLm1lbnVJdGVtcy5sZW5ndGg7XG4gICAgICAgIHRoaXMubWVudUJhc2Uucm90YXRpb24gPSAtKHRoaXMuY3VycmVudFNjZW5lLm1lbnVTZWxlY3QgKiB0aGlzLmRlZ18xKSAtIDkwO1xuICAgICAgICB0aGlzLm1lbnVCYXNlLnR3ZWVuZXIuYnkoe3JvdGF0aW9uOiA5MH0sIDE1LCBcImVhc2VPdXRTaW5lXCIpO1xuICAgIH0sXG5cbiAgICBjbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMubWVudUJhc2UudHdlZW5lci5jbGVhcigpLmJ5KHtyb3RhdGlvbjogMTgwfSwgMTUsIFwiZWFzZU91dFNpbmVcIik7XG4gICAgICAgIHRoaXMuaWNvbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGUuY2xvc2UoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG5cbiIsIi8qXG4gKiAgbWVzc2FnZXNjZW5lLmpzXG4gKiAgMjAxNi8xMi8yOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cbiBcbnBoaW5hLmRlZmluZShcInFmdC5NZXNzYWdlU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKGN1cnJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZSA9IGN1cnJlbnRTY2VuZTtcblxuICAgICAgICAvL+ODoeODg+OCu+ODvOOCuOOCpuOCo+ODs+ODieOCplxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XKjAuOCxcbiAgICAgICAgICAgIGhlaWdodDpTQ19IKjAuNCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwwLjgpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0dG9rZVdpZHRoOiA1LFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC4yNSlcbiAgICAgICAgICAgIC5zZXRTY2FsZSgxLCAwKTtcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWTogMX0sIDUwMCwgXCJlYXNlT3V0Q3ViZVwiKTtcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMTYsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRleHRMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IG9wdGlvbnMubWVzc2FnZSB8fCBcIm5vIG1lc3NhZ2VcIiwgZm9udFNpemU6IDIwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuMjUpO1xuXG4gICAgICAgIHRoaXMucGxheWVyID0gdGhpcy5jdXJyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB0aGlzLmxpbWl0RnJhbWUgPSAzMDtcbiAgICAgICAgdGhpcy5pc0V4aXQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwOyAgICAgICAgXG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAodGhpcy50aW1lID4gMTAgJiYgIXRoaXMuaXNFeGl0KSB7XG4gICAgICAgICAgICBpZiAoY3Quc3RhcnQgfHwgY3QucGF1c2UgfHwgY3QubWVudSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNFeGl0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCgxMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnBvcFNjZW5lKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMubGltaXRGcmFtZS0tO1xuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxufSk7XG5cbiIsIi8qXG4gKiAgb3BlbmluZ3NjZW5lLmpzXG4gKiAgMjAxNy8wMi8wOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cbiBcbnBoaW5hLmRlZmluZShcInFmdC5PcGVuaW5nU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIC8v6YCy6KGMXG4gICAgc2VxOiAwLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oY3VycmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIHRoaXMuY3VycmVudFNjZW5lID0gY3VycmVudFNjZW5lO1xuXG4gICAgICAgIC8v77yi77yn77yt5YaN55SfXG4gICAgICAgIGFwcC5wbGF5QkdNKFwib3BlbmluZ2JnbVwiKTtcblxuICAgICAgICB0aGlzLnRleHQgPSBbXG4gICAgICAgICAgICBcIuS4lueVjOOBruS4reW/g+OBq+OBneOBs+OBiOOCi+WhlFwiLFxuICAgICAgICAgICAgXCLloZTjga7mnIDkuIrpmo7jgavjga9cIixcbiAgICAgICAgICAgIFwi44CM5rC46YGg44Gu6YO944CN44Go5ZG844Gw44KM44KL5qW95ZyS44GM44GC44KL44Go44GE44GGXCIsXG4gICAgICAgICAgICBcIuWZguOCkuiBnuOBhOOBn+WkmuOBj+OBruWGkumZuuiAheOBjFwiLFxuICAgICAgICAgICAgXCLmpb3lnJLjgpLmsYLjgoHjgabloZTjgbjjgajotbTjgY1cIixcbiAgICAgICAgICAgIFwi44Gd44Gu6KyO44Gr5oyR44KT44Gn44GE44Gj44GfXCIsXG4gICAgICAgICAgICBcIuOBl+OBi+OBl+KAplwiLFxuICAgICAgICAgICAgXCLlvbzjgonjgYzmnpzjgZ/jgZfjgabmpb3lnJLjgavovr/jgornnYDjgYTjgZ/jga7jgYtcIixcbiAgICAgICAgICAgIFwi44Gd44KM44Go44KC5LiW55WM44Gu5p6c44Gm44Gn5Yqb5bC944GN44Gf44Gu44GLXCIsXG4gICAgICAgICAgICBcIuOBneOBruacq+i3r+OCkuefpeOCi+iAheOBr+OBhOOBquOBhFwiLFxuICAgICAgICAgICAgXCLjgZ3jgZfjgabigKZcIixcbiAgICAgICAgICAgIFwi5paw44Gf44Gq5YaS6Zm66ICF44GM44G+44Gf5LiA5Lq6XCIsXG4gICAgICAgICAgICBcIuOBhOOBvuOBoOimi+OBrOalveWckuOBuOOBrumBk+OBq+aMkeOCguOBhuOBqOOBl+OBpuOBhOOBn1wiLFxuICAgICAgICBdO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOiBTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OiBTQ19ILFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpXG5cbiAgICAgICAgLy/jgqTjg6Hjg7zjgrjooajnpLrnlKjjg6zjgqTjg6RcbiAgICAgICAgdGhpcy5pbWFnZUxheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcyk7XG5cbiAgICAgICAgLy/jg5XjgqnjgqLjgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLmZnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB0aGlzLmZnLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy5mZy5vbnBvaW50c3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGF0LmFscmVhZHlMb2FkIHx8IHRoYXQubG9hZGVyICYmIHRoYXQubG9hZGVyLmxvYWRjb21wbGV0ZSkgdGhhdC5leGl0KCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4iuS4i+m7kuW4r1xuICAgICAgICBwYXJhbS5oZWlnaHQgPSBTQ19IICogMC4xNTtcbiAgICAgICAgdGhpcy5iZzEgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuMDcpXG4gICAgICAgIHRoaXMuYmcyID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjkzKVxuXG4gICAgICAgIC8v5a2X5bmVXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAxNCxcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG51bSA9IDA7XG4gICAgICAgIHRoaXMudGV4dExhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJcIn0uJHNhZmUobGFiZWxQYXJhbSkpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC45KTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLnRleHRMYWJlbC50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dExhYmVsLnRleHQgPSB0aGlzLnRleHRbbnVtXTtcbiAgICAgICAgICAgICAgICBudW0rKztcbiAgICAgICAgICAgICAgICBpZiAobnVtID09IHRoaXMudGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0TGFiZWwudHdlZW5lci5zZXRMb29wKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAuZmFkZUluKDUwMClcbiAgICAgICAgICAgIC53YWl0KDMwMDApXG4gICAgICAgICAgICAuZmFkZU91dCg1MDApXG4gICAgICAgICAgICAud2FpdCgxMDAwKVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG5cbiAgICAgICAgLy/ln7rmnKzjgqLjgrvjg4Pjg4jjgpLjg63jg7zjg4lcbiAgICAgICAgdGhpcy5hbHJlYWR5TG9hZCA9IGZhbHNlO1xuICAgICAgICBpZiAocWZ0LkFzc2V0cy5pc0xvYWRlZChcImNvbW1vblwiKSkge1xuICAgICAgICAgICAgLy/oqq3ovrzmuIjjgb/jgarjga7jgafjgrnjgq3jg4Pjg5dcbiAgICAgICAgICAgIHRoaXMuYWxyZWFkeUxvYWQgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIGFzc2V0cyA9IHFmdC5Bc3NldHMuZ2V0KHthc3NldFR5cGU6IFwiY29tbW9uXCJ9KTtcbiAgICAgICAgdGhpcy5sb2FkZXIgPSBwaGluYS5leHRlbnNpb24uQXNzZXRMb2FkZXJFeCgpLmxvYWQoYXNzZXRzLCBmdW5jdGlvbigpe2FwcC5zb3VuZHNldC5yZWFkQXNzZXQoKTt9KTtcbiAgICAgICAgdGhpcy5sb2FkTGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlwiLCBhbGlnbjogXCJyaWdodFwiLCBmb250U2l6ZTogMTJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuOTksIFNDX0gqMC4xKTtcbiAgICAgICAgdGhpcy5sb2FkTGFiZWwudGltZSA9IDE7ICAgIFxuICAgICAgICB0aGlzLmxvYWRMYWJlbC51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiTG9hZGluZy4uLiBcIitNYXRoLmZsb29yKHRoYXQubG9hZGVyLmxvYWRwcm9ncmVzcyAqIDEwMCkrXCIlXCI7XG4gICAgICAgICAgICBpZiAodGhhdC5sb2FkZXIubG9hZGNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0ID0gXCJQdXNoIGJ1dHRvbiB0byBza2lwLlwiO1xuICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAyMCA9PSAwKSB0aGlzLnZpc2libGUgPSAhdGhpcy52aXNpYmxlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmFscmVhZHlMb2FkIHx8IHRoaXMubG9hZGVyICYmIHRoaXMubG9hZGVyLmxvYWRjb21wbGV0ZSkge1xuICAgICAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgICAgICBpZiAoY3Qub2sgfHwgY3QuY2FuY2VsKSB0aGlzLmV4aXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNlcSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLndvcmxkbWFwKCk7XG4gICAgICAgICAgICB0aGlzLnNlcSsrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlcSA9PSAyKSB7XG4gICAgICAgICAgICB0aGlzLnRvd2VyaW1hZ2UoKTtcbiAgICAgICAgICAgIHRoaXMuc2VxKys7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VxID09IDQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VxdWVuY2UzKCk7XG4gICAgICAgICAgICB0aGlzLnNlcSsrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlcSA9PSA2KSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllcmltYWdlKCk7XG4gICAgICAgICAgICB0aGlzLnNlcSsrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlcSA9PSA4KSB7XG4gICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+S4lueVjOWcsOWbs1xuICAgIHdvcmxkbWFwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNwcml0ZTEgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm9wZW5pbmdtYXBcIilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMuaW1hZ2VMYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XICogMC41LCAtU0NfSCAqIDAuMjUpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMC44KVxuICAgICAgICAgICAgLnNldEFscGhhKDAuMCk7XG4gICAgICAgIHNwcml0ZTEudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuYnkoe2FscGhhOiAxLjAsIHk6IDIwMH0sIDcwMDApXG4gICAgICAgICAgICAuYnkoe2FscGhhOiAtMS4wLCB5OiAyMDB9LCA3MDAwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzcHJpdGUxLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VxKys7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvL+WhlOWkluims1xuICAgIHRvd2VyaW1hZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3ByaXRlMSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYmFja2dyb3VuZFwiKS5hZGRDaGlsZFRvKHRoaXMuaW1hZ2VMYXllcikuc2V0UG9zaXRpb24oU0NfVyAqIDAuNSwgU0NfSCAqIDAuNSk7XG4gICAgICAgIHNwcml0ZTEuYWxwaGEgPSAwO1xuICAgICAgICBzcHJpdGUxLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzcHJpdGUxLmFscGhhID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmZnLmFscGhhID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuY2xlYXIoKS5mYWRlT3V0KDcwMDApLmZhZGVJbig3MDAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDE0MDAwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzcHJpdGUxLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VxKys7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHZhciBzcHJpdGUyID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJvcGVuaW5ndG93ZXJcIikuYWRkQ2hpbGRUbyh0aGlzLmltYWdlTGF5ZXIpLnNldFBvc2l0aW9uKFNDX1cgKiAwLjUsIFNDX0ggKiAwLjMpO1xuICAgICAgICBzcHJpdGUyLmFscGhhID0gMDtcbiAgICAgICAgc3ByaXRlMi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc3ByaXRlMi5hbHBoYSA9IDE7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAuYnkoe3g6IC0xMDB9LCA0MDAwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgIC53YWl0KDMwMDApXG4gICAgICAgICAgICAuYnkoe3k6IDMwMH0sIDcwMDAsIFwiZWFzZUluU2luZVwiKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzcHJpdGUyLnJlbW92ZSgpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG4gICAgLy/kuInnlarnm67ooajnpLrvvIjmmqvlrprvvIlcbiAgICBzZXF1ZW5jZTM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3ByaXRlMSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwib3BlbmluZ2JhY2syXCIpLmFkZENoaWxkVG8odGhpcy5pbWFnZUxheWVyKS5zZXRQb3NpdGlvbihTQ19XICogMC41LCBTQ19IICogMC4zKS5zZXRTY2FsZSgxLjEpO1xuICAgICAgICBzcHJpdGUxLmFscGhhID0gMDtcbiAgICAgICAgc3ByaXRlMS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc3ByaXRlMS5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5mZy5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5mZy50d2VlbmVyLmNsZWFyKCkuZmFkZU91dCg3MDAwKS53YWl0KDEwMDAwKS5mYWRlSW4oNzAwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAuYnkoe3k6IDE1MH0sIDEyMDAwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgIC53YWl0KDEyMDAwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzcHJpdGUxLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VxKys7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHZhciBzcHJpdGUyID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJvcGVuaW5nbGlnaHRcIikuYWRkQ2hpbGRUbyh0aGlzLmltYWdlTGF5ZXIpLnNldFBvc2l0aW9uKFNDX1cgKiAwLjUsIFNDX0ggKiAwLjUpO1xuICAgICAgICBzcHJpdGUyLmJsZW5kTW9kZSA9ICdsaWdodGVyJztcbiAgICAgICAgc3ByaXRlMi5hbHBoYSA9IDAuMztcbiAgICAgICAgc3ByaXRlMi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDEyMDAwKVxuICAgICAgICAgICAgLmJ5KHt4OiAtNTB9LCAxMjAwMCwgXCJlYXNlSW5PdXRTaW5lXCIpO1xuICAgIH0sXG5cbiAgICAvL+ODl+ODrOOCpOODpOODvOihqOekulxuICAgIHBsYXllcmltYWdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNwcml0ZTEgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm9wZW5pbmdiYWNrXCIpLmFkZENoaWxkVG8odGhpcy5pbWFnZUxheWVyKS5zZXRQb3NpdGlvbihTQ19XICogMC41LCBTQ19IICogMC4zNSkuc2V0U2NhbGUoMS4yKTtcbiAgICAgICAgc3ByaXRlMS5hbHBoYSA9IDA7XG4gICAgICAgIHNwcml0ZTEudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNwcml0ZTEuYWxwaGEgPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZmcuYWxwaGEgPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZmcudHdlZW5lci5jbGVhcigpLmZhZGVPdXQoNzAwMCkud2FpdCg1MDAwKS5mYWRlSW4oNzAwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCgxNTAwMClcbiAgICAgICAgICAgIC5ieSh7eTogMTUwfSwgNTAwMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNwcml0ZTEucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXErKztcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdmFyIHNwcml0ZTIgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm9wZW5pbmdncm91bmRcIikuYWRkQ2hpbGRUbyh0aGlzLmltYWdlTGF5ZXIpLnNldFBvc2l0aW9uKFNDX1cgKiAwLjUsIFNDX0ggKiAwLjkpO1xuICAgICAgICBzcHJpdGUyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmJ5KHt5OiAtNTB9LCA0MDAwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgIC53YWl0KDEwMDAwKVxuICAgICAgICAgICAgLmJ5KHt5OiAyMDB9LCA1MDAwLCBcImVhc2VJbk91dFNpbmVcIilcblxuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8oc3ByaXRlMikuc2V0UG9zaXRpb24oMCwgMzgpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgcGwudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMDAwKVxuICAgICAgICAgICAgLmJ5KHt5OiAtNzZ9LCA1MDAwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwX3N0b3BcIik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoNjAwMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcImRvd25cIik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmJ5KHt5OiA3Nn0sIDUwMDAsIFwiZWFzZUluT3V0U2luZVwiKTtcbiAgICB9LFxufSk7XG5cbiIsIi8qXG4gKiAgcHJhY3RpY2VzY2VuZS5qc1xuICogIDIwMTcvMDQvMTVcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG4gXG5waGluYS5kZWZpbmUoXCJxZnQuQ29uZmlnU2NlbmVfUHJhY3RpY2VcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuXG4gICAgICAgIHRoaXMubWVudUJhc2UgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5tZW51QmFzZS5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMubWVudUJhc2UudHdlZW5lci5jbGVhcigpLmZhZGVJbig1MDApO1xuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogNSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJ0aXRsZWZvbnQxXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDcwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRleHRMYWJlbDEgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlByYWN0aWNlXCIsIGZvbnRTaXplOiAyMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuMik7XG4gICAgICAgIHRoaXMudGV4dExhYmVsMiA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiU3RhZ2Ugc2VsZWN0XCIsIGZvbnRTaXplOiAyMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuMyk7XG5cbiAgICAgICAgLy/jg6Hjg4vjg6Xjg7zjg4bjgq3jgrnjg4jooajnpLpcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLm1lbnUgPSBbXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCIsIFwiOFwiLCBcIjlcIiwgXCJQXCJdO1xuICAgICAgICB0aGlzLm1lbnVUZXh0ID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tZW51Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W2ldID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogdGhpcy5tZW51W2ldLCBmb250U2l6ZTogNDB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41KyhTQ19XKjAuMDcqaSktKFNDX1cqMC4wNyoodGhpcy5tZW51Lmxlbmd0aC0xKS8yKSwgU0NfSCowLjUpXG4gICAgICAgICAgICAgICAgLnNldFNjYWxlKDAuNyk7XG5cbiAgICAgICAgICAgIC8v44K/44OD44OB5Yik5a6a55SoXG4gICAgICAgICAgICB2YXIgcGFyYW0yID0ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiAzMCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IFNDX0gqMC4xMCxcbiAgICAgICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0yKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41KyhTQ19XKjAuMDcqaSktKFNDX1cqMC4wNyoodGhpcy5tZW51Lmxlbmd0aC0xKS8yKSwgU0NfSCowLjUpXG4gICAgICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICAgICAgYy5hbHBoYSA9IDA7XG4gICAgICAgICAgICBjLnNlbGVjdCA9IGk7XG4gICAgICAgICAgICBjLm9ucG9pbnRzdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LmlzU2VsZWN0ZWQgfHwgdGhhdC50aW1lIDwgMTApIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3QgPT0gdGhhdC5zZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5vayA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQudnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lm1lbnVUZXh0W3RoYXQuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5leGl0VGV4dC50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2VsZWN0ID0gdGhpcy5zZWxlY3Q7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubWVudVRleHRbdGhhdC5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudnNlbGVjdCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5leGl0VGV4dCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiRXhpdFwiLCBmb250U2l6ZTogNDB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjcpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMC43KTtcbiAgICAgICAgLy/jgr/jg4Pjg4HliKTlrprnlKhcbiAgICAgICAgdmFyIHBhcmFtMiA9IHtcbiAgICAgICAgICAgIHdpZHRoOiBTQ19XKjAuMyxcbiAgICAgICAgICAgIGhlaWdodDogU0NfSCowLjEwLFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0yKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjcpXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIGMuYWxwaGEgPSAwO1xuICAgICAgICBjLm9ucG9pbnRzdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoYXQuaXNTZWxlY3RlZCB8fCB0aGF0LnRpbWUgPCAxMCkgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKHRoYXQudnNlbGVjdCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5vayA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoYXQubWVudVRleHRbdGhhdC5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgdGhhdC5leGl0VGV4dC50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQudnNlbGVjdCA9IDE7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudnNlbGVjdCA9IDA7XG4gICAgICAgIHRoaXMuc2VsZWN0ID0gMDtcbiAgICAgICAgdGhpcy5pc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2VsZWN0TWF4ID0gdGhpcy5tZW51Lmxlbmd0aDtcbiAgICAgICAgdGhpcy5tZW51VGV4dFswXS5zZXRTY2FsZSgxKTtcbiAgICAgICAgdGhpcy5vayA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNhbmNlbCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgdGhpcy5vbigncmVzdW1lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5pc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm9rID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmNhbnNlbCA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmIChjdC5yaWdodCAmJiAhY3QuYmVmb3JlLnJpZ2h0ICYmIHRoaXMuc2VsZWN0IDwgdGhpcy5zZWxlY3RNYXgtMSAmJiB0aGlzLnZzZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Kys7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDEwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdC5sZWZ0ICYmICFjdC5iZWZvcmUubGVmdCAmJiB0aGlzLnNlbGVjdCA+IDAgICYmIHRoaXMudnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3QtLTtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMTA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN0LmRvd24gJiYgIWN0LmJlZm9yZS5kb3duICYmIHRoaXMudnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnZzZWxlY3QrKztcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLmV4aXRUZXh0LnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMTA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN0LnVwICYmICFjdC5iZWZvcmUudXAgJiYgdGhpcy52c2VsZWN0ID09IDEpIHtcbiAgICAgICAgICAgIHRoaXMudnNlbGVjdC0tO1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMuZXhpdFRleHQudHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAxMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxNSkge1xuICAgICAgICAgICAgaWYgKGN0Lm9rIHx8IHRoaXMub2spIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52c2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0Lk1haW5TY2VuZSh7c3RhcnRTdGFnZTogMSwgaXNQcmFjdGljZTogdHJ1ZX0pKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdCA9PSA5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuTWFpblNjZW5lKHtzdGFydFN0YWdlOiA5OTksIGlzUHJhY3RpY2U6IHRydWV9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2VsZWN0ID09IDgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5TY2VuZUZsb3cuUmVzdW1lKHtzdGFnZU51bWJlcjogMTAsIGlzUHJhY3RpY2U6IGZhbHNlfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5TY2VuZUZsb3cuUmVzdW1lKHtzdGFnZU51bWJlcjogdGhpcy5zZWxlY3QrMSwgaXNQcmFjdGljZTogdHJ1ZX0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhcHAuc3RvcEJHTSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy52c2VsZWN0ID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImNhbmNlbFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGl0TWVudSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN0LmNhbmNlbCB8fCB0aGlzLmNhbmNlbCkge1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJjYW5jZWxcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5leGl0TWVudSgpO1xuICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcblxuICAgIGV4aXRNZW51OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5tZW51QmFzZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5mYWRlT3V0KDUwMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG5cbnBoaW5hLmRlZmluZShcInFmdC5QcmFjdGljZVBsYXRmb3JtXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgICAgICBhc3NldFR5cGU6IFwic3RhZ2UyXCIsXG4gICAgICAgICAgICBzdGFydFN0YWdlOiAyLFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLmNvdW50ID0gMDtcbiAgICB9LFxuXG4gICAgb25lbnRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LkxvYWRpbmdTY2VuZSh7XG4gICAgICAgICAgICBhc3NldHM6IHFmdC5Bc3NldHMuZ2V0KHRoaXMub3B0aW9ucyksXG4gICAgICAgIH0pKTtcbiAgICB9LFxuXG4gICAgb25yZXN1bWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmNvdW50Kys7XG4gICAgICAgIGlmICh0aGlzLmNvdW50ID09IDEpIHtcbiAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0Lk1haW5TY2VuZSh7c3RhcnRTdGFnZTogdGhpcy5vcHRpb25zLnN0YXJ0U3RhZ2UsIGlzUHJhY3RpY2U6IHRydWV9KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY291bnQgPT0gMil7XG4gICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuIiwiLypcbiAqICBTY2VuZUZsb3cuanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxuLy/jg6HjgqTjg7Pjgrfjg7zjg7Pjg5Xjg63jg7xcbnBoaW5hLmRlZmluZShcInFmdC5TY2VuZUZsb3dcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZ2FtZS5NYW5hZ2VyU2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgIHN0YXJ0TGFiZWwgPSBvcHRpb25zLnN0YXJ0TGFiZWwgfHwgXCJzcGxhc2hcIjtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe1xuICAgICAgICAgICAgc3RhcnRMYWJlbDogc3RhcnRMYWJlbCxcbiAgICAgICAgICAgIHNjZW5lczogW3tcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJzcGxhc2hcIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0LlNwbGFzaFNjZW5lXCIsXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJvcGVuaW5nXCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5PcGVuaW5nU2NlbmVcIixcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcInRpdGxlXCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5UaXRsZVNjZW5lXCIsXG4gICAgICAgICAgICAgICAgbmV4dExhYmVsOiBcIm9wZW5pbmdcIixcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcIm1haW5cIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0Lk1haW5TY2VuZVwiLFxuICAgICAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICAgICAgICBzdGFydFN0YWdlOiAxLFxuICAgICAgICAgICAgICAgICAgICBpc1ByYWN0aWNlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG5leHRMYWJlbDogXCJ0aXRsZVwiLFxuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwiY29udGludWVcIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0LlNjZW5lRmxvdy5SZXN1bWVcIixcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgICAgICAgaXNQcmFjdGljZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGlzQ29udGludWU6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBuZXh0TGFiZWw6IFwidGl0bGVcIixcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcImVuZGluZ1wiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuRW5kaW5nU2NlbmVcIixcbiAgICAgICAgICAgICAgICBuZXh0TGFiZWw6IFwibWFpblwiLFxuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwiY29uZmlnXCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5Db25maWdTY2VuZVwiLFxuICAgICAgICAgICAgICAgIG5leHRMYWJlbDogXCJ0aXRsZVwiLFxuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwicHJhY3RpY2VcIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0LkNvbmZpZ1NjZW5lX1ByYWN0aWNlXCIsXG4gICAgICAgICAgICAgICAgbmV4dExhYmVsOiBcImNvbmZpZ1wiLFxuICAgICAgICAgICAgfV0sXG4gICAgICAgIH0pO1xuICAgIH1cbn0pO1xuXG4vL+W+qeW4sOeUqFxucGhpbmEuZGVmaW5lKFwicWZ0LlNjZW5lRmxvdy5SZXN1bWVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZ2FtZS5NYW5hZ2VyU2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7c3RhZ2VOdW1iZXI6IDIsIGlzUHJhY3RpY2U6IGZhbHNlLCBpc0NvbnRpbnVlOiBmYWxzZX0pO1xuICAgICAgICBpZiAob3B0aW9ucy5pc0NvbnRpbnVlKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwic3RhZ2VcIik7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gSlNPTi5wYXJzZShkYXRhKS4kc2FmZSh7XG4gICAgICAgICAgICAgICAgICAgIHN0YWdlTnVtYmVyOiAxLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHQ6IFtdLFxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJTdGF0dXM6IHt9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuc3RhZ2VOdW1iZXIgPSBkLnN0YWdlTnVtYmVyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnN0YWdlTnVtYmVyID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgc3RhcnRMYWJlbCA9IFwic3RhcnRcIjtcbiAgICAgICAgdmFyIGFzc2V0cyA9IHFmdC5Bc3NldHMuZ2V0KHthc3NldFR5cGU6IFwic3RhZ2VcIitvcHRpb25zLnN0YWdlTnVtYmVyfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHtcbiAgICAgICAgICAgIHN0YXJ0TGFiZWw6IHN0YXJ0TGFiZWwsXG4gICAgICAgICAgICBzY2VuZXM6IFt7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwic3RhcnRcIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0LkxvYWRpbmdTY2VuZVwiLFxuICAgICAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICAgICAgICBhc3NldHM6IGFzc2V0cyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG5leHRMYWJlbDogXCJtYWluXCIsXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJtYWluXCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5NYWluU2NlbmVcIixcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRTdGFnZTogb3B0aW9ucy5zdGFnZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgaXNQcmFjdGljZTogb3B0aW9ucy5pc1ByYWN0aWNlLFxuICAgICAgICAgICAgICAgICAgICBpc0NvbnRpbnVlOiBvcHRpb25zLmlzQ29udGludWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIG9uZmluaXNoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgfVxufSk7XG4iLCIvKlxuICogIHNwbGFzaHNjZW5lLmpzXG4gKiAgMjAxNy8wMi8wOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmRlZmluZSgncWZ0LlNwbGFzaFNjZW5lJywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZScsXG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcblxuICAgICAgICB0aGlzLnVubG9jayA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxvYWRjb21wbGV0ZTEgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sb2FkY29tcGxldGUyID0gZmFsc2U7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3MxID0gMDtcbiAgICAgICAgdGhpcy5wcm9ncmVzczIgPSAwO1xuXG4gICAgICAgIC8vcHJlbG9hZCBhc3NldFxuICAgICAgICB2YXIgYXNzZXRzID0gcWZ0LkFzc2V0cy5nZXQoe2Fzc2V0VHlwZTogXCJzcGxhc2hcIn0pO1xuICAgICAgICB0aGlzLmxvYWRlciA9IHBoaW5hLmFzc2V0LkFzc2V0TG9hZGVyKCk7XG4gICAgICAgIHRoaXMubG9hZGVyLmxvYWQoYXNzZXRzKTtcbiAgICAgICAgdGhpcy5sb2FkZXIub24oJ2xvYWQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRjb21wbGV0ZTEgPSB0cnVlO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmxvYWRlci5vbigncHJvZ3Jlc3MnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLnByb2dyZXNzMSA9IE1hdGguZmxvb3IoZS5wcm9ncmVzcyoxMDApO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIC8vcHJlbG9hZCBhc3NldDJcbiAgICAgICAgdmFyIGFzc2V0cyA9IHFmdC5Bc3NldHMuZ2V0KHthc3NldFR5cGU6IFwic3BsYXNoMlwifSk7XG4gICAgICAgIHRoaXMubG9hZGVyMiA9IHBoaW5hLmFzc2V0LkFzc2V0TG9hZGVyKCk7XG4gICAgICAgIHRoaXMubG9hZGVyMi5sb2FkKGFzc2V0cyk7XG4gICAgICAgIHRoaXMubG9hZGVyMi5vbignbG9hZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGNvbXBsZXRlMiA9IHRydWU7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMubG9hZGVyMi5vbigncHJvZ3Jlc3MnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLnByb2dyZXNzMiA9IE1hdGguZmxvb3IoZS5wcm9ncmVzcyoxMDApO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIC8vbG9nb1xuICAgICAgICB2YXIgdGV4dHVyZSA9IHBoaW5hLmFzc2V0LlRleHR1cmUoKTtcbiAgICAgICAgdGV4dHVyZS5sb2FkKHFmdC5TcGxhc2hTY2VuZS5sb2dvKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5faW5pdCgpO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnRleHR1cmUgPSB0ZXh0dXJlO1xuICAgIH0sXG5cbiAgICBfaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUodGhpcy50ZXh0dXJlKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLmdyaWRYLmNlbnRlcigpLCB0aGlzLmdyaWRZLmNlbnRlcigpKVxuICAgICAgICAgICAgLnNldFNjYWxlKDAuMyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLmFscGhhID0gMDtcblxuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC50byh7YWxwaGE6MX0sIDUwMCwgJ2Vhc2VPdXRDdWJpYycpXG4gICAgICAgICAgICAud2FpdCg1MDApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVubG9jayA9IHRydWU7XG4gICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIC8v6YCy5o2X44Ky44O844K4XG4gICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgd2lkdGg6ICBTQ19XKjAuMSxcbiAgICAgICAgICAgIGhlaWdodDogMyxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIGZpbGw6ICdyZWQnLFxuICAgICAgICAgICAgc3Ryb2tlOiAnd2hpdGUnLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG4gICAgICAgICAgICBnYXVnZUNvbG9yOiAnbGltZScsXG4gICAgICAgICAgICBjb3JuZXJSYWRpdXM6IDMsXG4gICAgICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgICAgIG1heFZhbHVlOiAxMDAsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucHJvZ3Jlc3NHYXVnZSA9IHBoaW5hLnVpLkdhdWdlKG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC44KTtcbiAgICAgICAgdGhpcy5wcm9ncmVzc0dhdWdlLmJlZm9yZVZhbHVlID0gMDtcbiAgICAgICAgdGhpcy5wcm9ncmVzc0dhdWdlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoYXQucHJvZ3Jlc3MxID09IHRoaXMuYmVmb3JlVmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlKys7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGF0LnByb2dyZXNzMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYmVmb3JlVmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy51bmxvY2sgJiYgdGhpcy5sb2FkY29tcGxldGUxICYmIHRoaXMubG9hZGNvbXBsZXRlMikge1xuICAgICAgICAgICAgdGhpcy51bmxvY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC50byh7YWxwaGE6MH0sIDUwMCwgJ2Vhc2VPdXRDdWJpYycpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5wcm9ncmVzc0dhdWdlLnR3ZWVuZXIuY2xlYXIoKS50byh7YWxwaGE6MH0sIDEwLCAnZWFzZU91dEN1YmljJylcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICAgIGxvZ286IFwiYXNzZXRzL2ltYWdlL3BoaW5hanNfbG9nby5wbmdcIixcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHRpdGxlc2NlbmUuanNcbiAqICAyMDE3LzAyLzA5XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LlRpdGxlU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOlNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCxcbiAgICAgICAgICAgIGZpbGw6ICdibGFjaycsXG4gICAgICAgICAgICBzdHJva2U6IGZhbHNlLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuXG4gICAgICAgIHZhciBzcHJpdGUxID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ0aXRsZWJhY2tcIikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XICogMC41LCBTQ19IICogMC41KTtcbiAgICAgICAgc3ByaXRlMS5hbHBoYSA9IDA7XG4gICAgICAgIHNwcml0ZTEudHdlZW5lci5jbGVhcigpLmZhZGVJbig1MDApO1xuXG4gICAgICAgIC8v44K/44Kk44OI44Or44Ot44K044Gu6KGo56S6XG4gICAgICAgIHRoaXMuZGlzcFRpdGxlTG9nbygpO1xuXG4gICAgICAgIC8v44Oh44OL44Ol44O844Ki44Kk44OG44Og6KGo56S6XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiA1LFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcInRpdGxlZm9udDJcIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMzAsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWVudSA9IFtcIlN0YXJ0XCIsIFwiQ29udGludWVcIiwgXCJDb25maWdcIl07XG4gICAgICAgIHRoaXMubWVudUNvbW1lbnQgPSBbXCLjgrLjg7zjg6DjgpLplovlp4vjgZfjgb7jgZlcIiwgXCLliY3lm57jgrLjg7zjg6Djgqrjg7zjg5Djg7zjgavjgarjgaPjgZ/jgrnjg4bjg7zjgrjjga7mnIDliJ3jgYvjgonplovlp4vjgZfjgb7jgZlcIiwgXCLoqK3lrprjg6Hjg4vjg6Xjg7zjgpLplovjgY3jgb7jgZlcIl07XG4gICAgICAgIHRoaXMubWVudVRleHQgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1lbnUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbaV0gPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiB0aGlzLm1lbnVbaV19LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNitpKjMwKVxuICAgICAgICAgICAgICAgIC5zZXRTY2FsZSgwLjcpO1xuXG4gICAgICAgICAgICAvL+OCv+ODg+ODgeWIpOWumueUqFxuICAgICAgICAgICAgdmFyIHBhcmFtMiA9IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogU0NfVyowLjMsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBTQ19IKjAuMDgsXG4gICAgICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtMilcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjYraSozMClcbiAgICAgICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgICAgICBjLmFscGhhID0gMDtcbiAgICAgICAgICAgIGMuc2VsZWN0ID0gaTtcbiAgICAgICAgICAgIGMub25wb2ludHN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuaXNTZWxlY3RlZCB8fCB0aGF0LnRpbWUgPCAxMCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdCA9PSB0aGF0LnNlbGVjdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm1lbnVUZXh0W3RoYXQuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnNlbGVjdCA9IHRoaXMuc2VsZWN0O1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm1lbnVUZXh0W3RoYXQuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZWxlY3QgPSAwO1xuICAgICAgICB0aGlzLnNlbGVjdE1heCA9IDM7XG4gICAgICAgIHRoaXMubWVudVRleHRbMF0uc2V0U2NhbGUoMSk7XG4gICAgICAgIHRoaXMub2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jYW5zZWwgPSBmYWxzZTtcblxuICAgICAgICAvL+ODoeODi+ODpeODvOOCs+ODoeODs+ODiFxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMuY29tbWVudCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiXCIsIGZvbnRTaXplOiAxMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuOSk7XG4gICAgICAgIHRoaXMuY29tbWVudC51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IHRoYXQubWVudUNvbW1lbnRbdGhhdC5zZWxlY3RdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5mZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuZmcudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgdGhpcy5mZy50d2VlbmVyLmNsZWFyKCkuZmFkZU91dCgxNSk7XG5cbiAgICAgICAgdGhpcy5vbigncmVzdW1lJywgZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuY2xlYXIoKS5mYWRlT3V0KDE1KTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMub2sgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuY2Fuc2VsID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAgIGlmICh0aGlzLmlzU2VsZWN0ZWQpIHJldHVybjtcblxuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKGN0LmRvd24gJiYgIWN0LmJlZm9yZS5kb3duICYmIHRoaXMuc2VsZWN0IDwgdGhpcy5zZWxlY3RNYXgtMSkge1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Kys7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMTA7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdC51cCAmJiAhY3QuYmVmb3JlLnVwICYmIHRoaXMuc2VsZWN0ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0LS07XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMTA7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxNSkge1xuICAgICAgICAgICAgaWYgKGN0Lm9rIHx8IHRoaXMub2spe1xuICAgICAgICAgICAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v6YCa5bi46ZaL5aeLXG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwib2tcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5mYWRlSW4oMylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5leGl0KFwibWFpblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v44Kz44Oz44OG44Kj44OL44Ol44O8XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwib2tcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5mYWRlSW4oMylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInN0YWdlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBKU09OLnBhcnNlKGRhdGEpLiRzYWZlKHtzdGFnZU51bWJlcjogMX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuc3RhZ2VOdW1iZXIgPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhpdChcIm1haW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LlNjZW5lRmxvdy5SZXN1bWUoe2lzUHJhY3RpY2U6IGZhbHNlLCBpc0NvbnRpbnVlOiB0cnVlfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5leGl0KFwibWFpblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy/oqK3lrprjg6Hjg4vjg6Xjg7xcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LkNvbmZpZ1NjZW5lKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdC5jYW5jZWwgfHwgdGhpcy5jYW5jZWwpIHtcbiAgICAgICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5Db25maWdTY2VuZSh0aGlzKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAzMCAqIDEyMCkge1xuICAgICAgICAgICAgdGhpcy5leGl0KFwib3BlbmluZ1wiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgLy/jgr/jgqTjg4jjg6vjg63jgrTooajnpLpcbiAgICBkaXNwVGl0bGVMb2dvOiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICAgIHggPSB4IHx8IFNDX1cgKiAwLjU7XG4gICAgICAgIHkgPSB5IHx8IFNDX0ggKiAwLjQ1O1xuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMTAsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwidGl0bGVmb250MVwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiA2MCxcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG51bSA9IDA7XG4gICAgICAgIHRoaXMudGV4dExhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJUaGVcIiwgZm9udFNpemU6IDMwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKHgtMTgyLCB5LTg1KTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlF1ZXN0XCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oeC00NywgeS04NSk7XG4gICAgICAgIHRoaXMudGV4dExhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJmb3JcIiwgZm9udFNpemU6IDQwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKHgtMTcsIHktNDApO1xuICAgICAgICB0aGlzLnRleHRMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiVGFuZWxvcm5cIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbih4KzQ4LCB5KTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHR1dG9yaWFsc2NlbmUuanNcbiAqICAyMDE3LzA2LzAxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuIFxucGhpbmEuZGVmaW5lKFwicWZ0LlR1dG9yaWFsU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIC8v44K544Kv44Oq44O844Oz44Gu44Oe44OD44OX5aSW44G444Gu56e75YuV5Yi26ZmQ44OV44Op44KwXG4gICAgbGltaXRXaWR0aDogZmFsc2UsXG4gICAgbGltaXRIZWlnaHQ6IHRydWUsXG5cbiAgICAvL+ODl+ODrOOCpOODpOODvOOCueOCr+ODquODvOODs+S4reWkruWbuuWumuODleODqeOCsFxuICAgIGNlbnRlclBsYXllcjogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiAnYmxhY2snLFxuICAgICAgICAgICAgc3Ryb2tlOiBmYWxzZSxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcblxuICAgICAgICAvL+iDjOaZr1xuICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYmFja2dyb3VuZFwiKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKDAsIFNDX0gqMC41KS5zZXRPcmlnaW4oMCwgMC41KTtcblxuICAgICAgICAvL+euoeeQhueUqOWfuua6luODrOOCpOODpFxuICAgICAgICB0aGlzLmJhc2VMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Kt44Oj44Op44Kv44K/XG4gICAgICAgIHRoaXMucGxheWVyID0gcWZ0LlBsYXllcih0aGlzKTtcblxuICAgICAgIC8v44K544Kv44Oq44O844Oz5Yid5pyf5YyWXG4gICAgICAgIHRoaXMuc2V0dXBTY3JlZW4oKTtcblxuICAgICAgICAvL+OCueODhuODvOOCuOaDheWgseWIneacn+WMllxuICAgICAgICB0aGlzLnNldHVwU3RhZ2UoKTtcblxuICAgICAgICB0aGlzLmZnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5mZy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKCkuZmFkZU91dCgzMCk7XG5cbiAgICAgICAgLy/jg5Djg7zjg4Hjg6Pjg6vjg5Hjg4Pjg4njga7lj6/oppbljJZcbi8vICAgICAgICBhcHAudmlydHVhbFBhZC5hZGRDaGlsZFRvKHRoaXMpO1xuXG4gICAgICAgIGFwcC52b2x1bWVCR00gPSAwLjU7XG4gICAgICAgIGFwcC52b2x1bWVTRSA9IDAuMjtcblxuICAgICAgICAvL+ODoeODg+OCu+ODvOOCuOihqOekulxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMTYsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMubWVzc2FnZVN0YWNrID0gW107XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJcIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC4yKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZS5uZXh0T2sgPSB0cnVlO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm5leHRPayAmJiB0aGF0Lm1lc3NhZ2VTdGFjay5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0T2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gdGhhdC5tZXNzYWdlU3RhY2tbMF07XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IG1zZy50ZXh0O1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlSW4oMTUpLndhaXQoOTApLmZhZGVPdXQoMTUpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5leHRPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lm1lc3NhZ2VTdGFjay5zcGxpY2UoMCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPT0gMTUpIHRoaXMucGxheWVyLmlzQ29udHJvbCA9IHRydWU7XG5cbiAgICAgICAgLy/jgrnjgq/jg6rjg7zjg7PooajnpLrkvY3nva7jgpLjg5fjg6zjgqTjg6Tjg7zkuK3lv4Pjgavjgarjgovmp5jjgavoqr/mlbRcbiAgICAgICAgaWYgKHRoaXMuY2VudGVyUGxheWVyKSB7XG4gICAgICAgICAgICB2YXIgbWFwID0gdGhpcy5tYXBMYXllci5tYXA7XG4gICAgICAgICAgICB0aGlzLm1hcExheWVyLnggPSBTQ19XKjAuNS10aGlzLnBsYXllci54O1xuICAgICAgICAgICAgdGhpcy5tYXBMYXllci55ID0gU0NfSCowLjUtdGhpcy5wbGF5ZXIueTtcbiAgICAgICAgICAgIGlmICh0aGlzLmxpbWl0SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIueSA+IDApIHRoaXMubWFwTGF5ZXIueSA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIueSA8IC0obWFwLmhlaWdodC1TQ19IKSkgdGhpcy5tYXBMYXllci55ID0gLShtYXAuaGVpZ2h0LVNDX0gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMubGltaXRXaWR0aCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hcExheWVyLnggPiAwKSB0aGlzLm1hcExheWVyLnggPSAwO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hcExheWVyLnggPCAtKG1hcC53aWR0aC1TQ19XKSkgdGhpcy5tYXBMYXllci54ID0gLShtYXAud2lkdGgtU0NfVyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44K544Kv44Oq44O844Oz5bqn5qiZXG4gICAgICAgICAgICB0aGlzLnNjcmVlblggPSAtdGhpcy5tYXBMYXllci54O1xuICAgICAgICAgICAgdGhpcy5zY3JlZW5ZID0gLXRoaXMubWFwTGF5ZXIueTtcblxuICAgICAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4njga5Y5bqn5qiZ44KS5YWo5L2T44Gu5Ymy5ZCI44GL44KJ6KiI566XXG4gICAgICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZS54ID0gLU1hdGguZmxvb3IodGhpcy5iYWNrZ3JvdW5kSW1hZ2Uud2lkdGggKiAodGhpcy5wbGF5ZXIueCAvIG1hcC53aWR0aCkqMC4wMSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgLy/mlbXjgq3jg6Pjg6njgq/jgr/mipXlhaVcbiAgICBzcGF3bkVuZW15OiBmdW5jdGlvbih4LCB5LCBuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBxZnQuRW5lbXlbbmFtZV0odGhpcywgb3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzLmVuZW15TGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgIH0sXG5cbiAgICAvL+OCouOCpOODhuODoOaKleWFpVxuICAgIHNwYXduSXRlbTogZnVuY3Rpb24oeCwgeSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gcWZ0Lkl0ZW0odGhpcywgb3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICB9LFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg5zjg4Pjgq/jgrnmipXlhaVcbiAgICBzcGF3bkl0ZW1Cb3g6IGZ1bmN0aW9uKHgsIHksIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHFmdC5JdGVtQm94KHRoaXMsIG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcy5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgfSxcblxuICAgIC8v44Ko44OV44Kn44Kv44OI5oqV5YWlXG4gICAgc3Bhd25FZmZlY3Q6IGZ1bmN0aW9uKHgsIHksIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHFmdC5FZmZlY3QodGhpcywgb3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICB9LFxuXG4gICAgLy/jg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICBzcGF3bk1lc3NhZ2U6IGZ1bmN0aW9uKHRleHQsIGJldHdlZW4sIHdhaXRGcmFtZSkge1xuICAgICAgICBiZXR3ZWVuID0gYmV0d2VlbiB8fCAzMjtcbiAgICAgICAgd2FpdEZyYW1lID0gd2FpdEZyYW1lIHx8IDMwO1xuICAgICAgICB2YXIgYXJyYXlUZXh0ID0gdGV4dC5zcGxpdChcIlwiKTtcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmx1ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMzIsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICB2YXIgbiA9IDA7XG4gICAgICAgIHZhciB4ID0gU0NfVyAqIDAuNSAtIChhcnJheVRleHQubGVuZ3RoICogYmV0d2VlbiAqIDAuNSk7XG4gICAgICAgIGFycmF5VGV4dC5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlID09IFwiIFwiKSB7XG4gICAgICAgICAgICAgICAgeCArPSBiZXR3ZWVuO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBsYiA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IGV9LiRzYWZlKGxhYmVsUGFyYW0pKS5zZXRQb3NpdGlvbih4LCBTQ19IKjAuNSszMikuc2V0U2NhbGUoMCwgMSkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgICAgIGxiLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgICAgICAud2FpdChuKVxuICAgICAgICAgICAgICAgIC50byh7c2NhbGVYOiAxLjAsIGFscGhhOiAxLCB5OiBTQ19IKjAuNX0sIDE1LCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLndhaXQod2FpdEZyYW1lKVxuICAgICAgICAgICAgICAgIC50byh7c2NhbGVYOiAwLjAsIHk6IFNDX0gqMC41LTMyfSwgMTAsIFwiZWFzZU91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe3RoaXMucmVtb3ZlKCl9LmJpbmQobGIpKTtcbiAgICAgICAgICAgIHggKz0gYmV0d2VlbjtcbiAgICAgICAgICAgIG4gKz0gNTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG4gICAgLy/jgqTjg5njg7Pjg4jjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICBzcGF3bkV2ZW50TWVzc2FnZTogZnVuY3Rpb24oaWQsIHRleHQpIHtcbiAgICAgICAgaWYgKCFpZCB8fCAhdGV4dCkgcmV0dXJuO1xuICAgICAgICAvL+ODoeODg+OCu+ODvOOCuOOCueOCv+ODg+OCr+WGheOBq+WQjOS4gO+8qe+8pOOBjOOBguOCi+WgtOWQiOOBr+aKleWFpeOBl+OBquOBhFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWVzc2FnZVN0YWNrLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5tZXNzYWdlU3RhY2tbaV0uaWQgPT0gaWQpIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGV4dCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICB0ZXh0LmZvckVhY2goZnVuY3Rpb24oc3RyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlU3RhY2sucHVzaCh7aWQ6IGlkLCB0ZXh0OiBzdHJ9KTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VTdGFjay5wdXNoKHtpZDogaWQsIHRleHQ6IHRleHR9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+OCueOCr+ODquODvOODs+WIneacn+WMllxuICAgIHNldHVwU2NyZWVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiVWJ1bnR1TW9ub1wiLFxuICAgICAgICAgICAgYWxpZ246IFwibGVmdFwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMjAsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgIC8v5L2T5Yqb44Ky44O844K4XG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiTElGRVwifS4kc2FmZShsYWJlbFBhcmFtKSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbigwLCAxMCk7XG4gICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgd2lkdGg6ICAyNTYsXG4gICAgICAgICAgICBoZWlnaHQ6IDUsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICBmaWxsOiAncmVkJyxcbiAgICAgICAgICAgIHN0cm9rZTogJ3doaXRlJyxcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuICAgICAgICAgICAgZ2F1Z2VDb2xvcjogJ2xpbWUnLFxuICAgICAgICAgICAgY29ybmVyUmFkaXVzOiAwLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMucGxheWVyLmhwLFxuICAgICAgICAgICAgbWF4VmFsdWU6IHRoaXMucGxheWVyLmhwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmxpZmVHYXVnZSA9IHBoaW5hLnVpLkdhdWdlKG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcykuc2V0T3JpZ2luKDAsIDAuNSkuc2V0UG9zaXRpb24oNDAsIDEwKTtcbiAgICAgICAgdGhpcy5saWZlR2F1Z2UudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhhdC5wbGF5ZXIuaHA7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy/jgrnjgrPjgqLooajnpLpcbiAgICAgICAgdGhpcy5zY29yZUxhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDpcIlNDT1JFOlwiLCBhbGlnbjogXCJyaWdodFwifS4kc2FmZShsYWJlbFBhcmFtKSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XLCAxMCk7XG4gICAgICAgIHRoaXMuc2NvcmVMYWJlbC5zY29yZSA9IDA7XG4gICAgICAgIHRoaXMuc2NvcmVMYWJlbC5zID0gMDtcbiAgICAgICAgdGhpcy5zY29yZUxhYmVsLnVwZGF0ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLnRpY2tlci5mcmFtZSAlIDEwID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnMgPSB+figodGhhdC50b3RhbFNjb3JlLXRoaXMuc2NvcmUpLzcpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnMgPCAzKSB0aGlzLnMgPSAzO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnMgPiA3Nzc3KSB0aGlzLnMgPSA3Nzc3O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zY29yZSArPSB0aGlzLnM7XG4gICAgICAgICAgICBpZiAodGhpcy5zY29yZSA+IHRoYXQudG90YWxTY29yZSkgdGhpcy5zY29yZSA9IHRoYXQudG90YWxTY29yZTtcblxuICAgICAgICAgICAgdGhpcy50ZXh0ID0gXCJTQ09SRSBcIit0aGlzLnNjb3JlLmNvbW1hKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WItumZkOaZgumWk+ihqOekulxuICAgICAgICB2YXIgdGwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlRJTUU6XCIsIGFsaWduOiBcInJpZ2h0XCJ9LiRzYWZlKGxhYmVsUGFyYW0pKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1csIDMwKTtcbiAgICAgICAgdGwudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSBcIlRJTUU6XCIrTWF0aC5mbG9vcih0aGF0LnRpbWVMaW1pdC8zMCk7XG4gICAgICAgICAgICBpZiAodGhhdC50aW1lTGltaXQgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsbCA9ICdyZWQnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGwgPSAnd2hpdGUnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zoo4XlgpnmrablmajooajnpLpcbiAgICAgICAgdGhpcy5wbGF5ZXJXZWFwb24gPSBxZnQuUGxheWVyV2VhcG9uKHRoaXMucGxheWVyKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1ctMzAsIFNDX0gtMzApO1xuICAgIH0sXG5cbiAgICAvL+ODnuODg+ODl+aDheWgseOBruWIneacn+WMllxuICAgIHNldHVwU3RhZ2U6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHRoaXMuYmFzZUxheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG5cbiAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2U5OTkodGhpcyk7XG4gICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcblxuICAgICAgICAvL+e1jOmBjuaZgumWk+WIneacn+WMllxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIC8v44K/44Kk44Og44Oq44Of44OD44OI6Kit5a6aXG4gICAgICAgIHRoaXMudGltZUxpbWl0ID0gdGhpcy5zdGFnZUNvbnRyb2xsZXIudGltZUxpbWl0O1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O86Kit5a6aXG4gICAgICAgIHRoaXMucGxheWVyLmlzQ29udHJvbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBsYXllci5pc011dGVraSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBsYXllci5hbHBoYSA9IDEuMDtcblxuICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlci5wbGF5QkdNKCk7XG4gICAgfSxcblxuICAgIC8v44Oe44OD44OX44Os44Kk44Ok44Gu5YiH5pu/XG4gICAgc3dpdGNoTWFwOiBmdW5jdGlvbihsYXllciwgeCwgeSkge1xuICAgICAgICBpZiAodGhpcy5tYXBMYXllcikgdGhpcy5tYXBMYXllci5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5tYXBMYXllciA9IGxheWVyO1xuICAgICAgICB0aGlzLm1hcExheWVyLmFkZENoaWxkVG8odGhpcy5iYXNlTGF5ZXIpO1xuICAgICAgICB0aGlzLm1hcCA9IGxheWVyLm1hcDtcblxuICAgICAgICB0aGlzLmJhY2tncm91bmRMYXllciA9IGxheWVyLmJhY2tncm91bmRMYXllcjtcbiAgICAgICAgdGhpcy5mb3JlZ3JvdW5kTGF5ZXIgPSBsYXllci5mb3JlZ3JvdW5kTGF5ZXI7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uTGF5ZXIgPSBsYXllci5jb2xsaXNpb25MYXllcjtcbiAgICAgICAgdGhpcy5lbmVteUxheWVyID0gbGF5ZXIuZW5lbXlMYXllcjtcbiAgICAgICAgdGhpcy5wbGF5ZXJMYXllciA9IGxheWVyLnBsYXllckxheWVyO1xuICAgICAgICB0aGlzLm9iakxheWVyID0gbGF5ZXIub2JqTGF5ZXI7XG4gICAgICAgIHRoaXMubWFwSW1hZ2VMYXllciA9IGxheWVyLm1hcEltYWdlTGF5ZXI7XG4gICAgICAgIHRoaXMuZWZmZWN0TGF5ZXIgPSBsYXllci5lZmZlY3RMYXllcjtcblxuICAgICAgICB0aGlzLnBsYXllci5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuYWRkQ2hpbGRUbyhsYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgIGlmICh4KSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgfVxuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2UxLmpzXG4gKiAgMjAxNy8wMS8yNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrjvvJFcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTFcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogMSxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNSxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbTFcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lKTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTFcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSAxXCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSB0aGlzLnBsYXllci5rZXlzO1xuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPCAxKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcikuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSkuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLm1vdmVCeSgxNCwgLTMyLCAxMDAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlMTAuanNcbiAqICAyMDE3LzA5LzEwXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCqOODs+ODh+OCo+ODs+OCsOOCt+ODvOODs1xucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlMTBcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogMTAsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjUsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJlbmRpbmdcIixcblxuICAgIC8v54m55q6K44K544OG44O844K444OV44Op44KwXG4gICAgaXNFbmRpbmc6IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlMTBcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844OA44Of44O844K544OX44Op44Kk44OIXG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIilcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v6ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduRXZlbnRNZXNzYWdlKDEsIFwiQ29uZ3JhdHVyYXRpb25zISFcIik7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG5cbiAgICAgICAgICAgIHRoaXMucGxheWVyLnNwZWVkID0gMjtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnNwZWVkQXNjZW5kID0gMjtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmlzQXV0byA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnVwID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoMjI0LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkudXAgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS5yaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v55+z56KR44G+44GnXG4gICAgICAgIHRoaXMuYWRkKDI1NSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnJpZ2h0ID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5zZXRBbHBoYSgwKTtcbiAgICAgICAgICAgIHBsLmFkZENoaWxkVG8odGhpcy5tYXBMYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KTtcbiAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwX3N0b3BcIik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmFkZCgxMjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS5yaWdodCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5zZXRBbHBoYSgxLjApO1xuICAgICAgICAgICAgcGwucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v5YWl44KK5Y+j44G+44GnXG4gICAgICAgIHRoaXMuYWRkKDMzMCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnJpZ2h0ID3jgIBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS5yaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmFkZCgzMCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnJpZ2h0ID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmFkZCgzMCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnJpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWRkKDIwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkucmlnaHQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpLnNldCh7YWxwaGE6IDB9KS5tb3ZlQnkoMCwgLTYwMCwgNjAwKTtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmdyYXZpdHkgPSAwO1xuXG4gICAgICAgICAgICBwbC5hZGRDaGlsZFRvKHRoaXMubWFwTGF5ZXIucGxheWVyTGF5ZXIpO1xuICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSk7XG4gICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgIHBsLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5tb3ZlQnkoMCwgLTYwMCwgNjAwKVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiZG93blwiKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC53YWl0KDEwKVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZnV2hpdGUudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAud2FpdCgxMjApXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmFkZUluKDEyMClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKFwiZW5kaW5nXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmcudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAud2FpdCgxNTApXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmFkZUluKDYwKTtcblxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm1vdmVCeSgwLCAtNjAwLCA2MDApO1xuICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuc3RhZ2VDb250cm9sbGVyLmZpbmRPYmplY3QoMTcsIDAsIFwiZW5lbXlcIik7XG4gICAgICAgICAgICBvYmouc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLnN0YWdlQ29udHJvbGxlci5maW5kT2JqZWN0KDE3LCAwLCBcImVuZW15XCIpO1xuICAgICAgICAgICAgb2JqLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlQnkoMCwgLTMwMCwgMzAwKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTEuanNcbiAqICAyMDE3LzAxLzI0XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuO+8kVxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlMlwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiAyLFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo3LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtMlwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTJfMVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSAyXCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IHRoaXMucGxheWVyLmtleXM7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA8IDIpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKS5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KS5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkubW92ZVRvKDQ4NywgMjcxLCAxMDAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlMy5qc1xuICogIDIwMTcvMDMvMDFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K477yRXG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2UzXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDMsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjEwLFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtM1wiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTNfMVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlM18yXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzFdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2UzXzNcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMl0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgM1wiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSB0aGlzLnBsYXllci5rZXlzO1xuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPCAyKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcikuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSkuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLm1vdmVUbyg4NiwgMjcyLCAxMDAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlNC5qc1xuICogIDIwMTcvMDMvMDhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K477yRXG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2U0XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDQsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjcsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ200XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlNF8xXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U0XzJcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMV0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgNFwiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSB0aGlzLnBsYXllci5rZXlzO1xuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPCAxKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcikuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSkuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLm1vdmVUbygyOTAzLCAxNzYsIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuYW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2U1LmpzXG4gKiAgMjAxNy8wNS8xNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrjvvJFcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogNSxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqOCxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbTVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U1XzFcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTVfMlwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclsxXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSA1XCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/pjbXlh7rnj75cbiAgICAgICAgdGhpcy5hZGRFdmVudChcImtleVwiLCAoKSA9PiB7XG4gICAgICAgICAgICB2YXIga3ggPSAxMTk2O1xuICAgICAgICAgICAgdmFyIGt5ID0gNjg4O1xuICAgICAgICAgICAgdmFyIGtleSA9IHFmdC5JdGVtKHRoaXMucGFyZW50U2NlbmUsIHtwcm9wZXJ0aWVzOiB7a2luZDogXCJrZXlcIn19KVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIub2JqTGF5ZXIpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKGt4LCBreSk7XG4gICAgICAgICAgICBrZXkudnkgPSAtNTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNlbnRlclBsYXllciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEuc2V0UG9zaXRpb24odGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueSk7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNhbWVyYS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImhvbHkxXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm1vdmVUbyhreCwga3ksIDMwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wYXVzZVNjZW5lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUZyb20ueCA9IGt4O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVGcm9tLnkgPSBreTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlUmFpbyA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUxlcnAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVUb1BsYXllciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMucGFyZW50U2NlbmUuY2FtZXJhKSlcbiAgICAgICAgICAgICAgICAudG8oe21vdmVSYXRpbzogMX0sIDMwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jZW50ZXJQbGF5ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVMZXJwID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMucGFyZW50U2NlbmUuY2FtZXJhKSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gdGhpcy5wbGF5ZXIua2V5cztcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoIDwgMSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlVG8oMzQ5MysxOCwgODArODAsIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGwuYW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDUwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuO+8ou+8p++8reWGjeeUn1xuICAgIHBsYXlCR006IGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHAuc2V0Vm9sdW1lKHRoaXMuYmdtLCAwLjUpO1xuICAgICAgICBhcHAucGxheUJHTSh0aGlzLmJnbSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTYuanNcbiAqICAyMDE3LzA1LzE0XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuO+8kVxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlNlwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiA2LFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo1LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtNlwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTZfMVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U2XzJcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMV0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgNlwiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYm9zc2RlYWQxID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYm9zc2RlYWQyID0gZmFsc2U7XG5cbiAgICAgICAgLy/jg5zjgrnvvJHoqI7kvJBcbiAgICAgICAgdGhpcy5hZGRFdmVudChcImJvc3NkZWFkXzFcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5ib3NzZGVhZDEgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuYm9zc2RlYWQyKSB0aGlzLmZpcmVFdmVudChcImtleVwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8v44Oc44K577yS6KiO5LyQXG4gICAgICAgIHRoaXMuYWRkRXZlbnQoXCJib3NzZGVhZF8yXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYm9zc2RlYWQyID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLmJvc3NkZWFkMSkgdGhpcy5maXJlRXZlbnQoXCJrZXlcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v6Y215Ye654++XG4gICAgICAgIHRoaXMuYWRkRXZlbnQoXCJrZXlcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIGt4ID0gMzg0O1xuICAgICAgICAgICAgdmFyIGt5ID0gOTQ0O1xuICAgICAgICAgICAgdmFyIGtleSA9IHFmdC5JdGVtKHRoaXMucGFyZW50U2NlbmUsIHtwcm9wZXJ0aWVzOiB7a2luZDogXCJrZXlcIn19KVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIub2JqTGF5ZXIpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKGt4LCBreSk7XG4gICAgICAgICAgICBrZXkudnkgPSAtNTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNlbnRlclBsYXllciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEuc2V0UG9zaXRpb24odGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueSk7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNhbWVyYS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImhvbHkxXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm1vdmVUbyhreCwga3ksIDMwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wYXVzZVNjZW5lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUZyb20ueCA9IGt4O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVGcm9tLnkgPSBreTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlUmFpbyA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUxlcnAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVUb1BsYXllciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMucGFyZW50U2NlbmUuY2FtZXJhKSlcbiAgICAgICAgICAgICAgICAudG8oe21vdmVSYXRpbzogMX0sIDMwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jZW50ZXJQbGF5ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVMZXJwID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMucGFyZW50U2NlbmUuY2FtZXJhKSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gdGhpcy5wbGF5ZXIua2V5cztcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoIDwgMykgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlVG8oMTE5ICsgMTjjgIAsIDQ0OCArIDgwLCAxMDAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlNy5qc1xuICogIDIwMTcvMDcvMjZcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K4N1xucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlN1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiA2LFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo1LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtN1wiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTdfMVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U3XzJcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMV0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlN18zXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzJdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDdcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gdGhpcy5wbGF5ZXIua2V5cztcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoIDwgMSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlVG8oMTgyICsgMTgsIDIwOCArIDgwLCAxMDAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlOC5qc1xuICogIDIwMTcvMDcvMjZcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K4OFxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlOFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiA4LFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo4LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtOFwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZThfMVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U4XzJcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMV0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgOFwiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v6Y215Ye654++XG4gICAgICAgIHRoaXMuYWRkRXZlbnQoXCJrZXlcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIGt4ID0gNjcwO1xuICAgICAgICAgICAgdmFyIGt5ID0gODUzO1xuICAgICAgICAgICAgdmFyIGtleSA9IHFmdC5JdGVtKHRoaXMucGFyZW50U2NlbmUsIHtwcm9wZXJ0aWVzOiB7a2luZDogXCJrZXlcIn19KVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIub2JqTGF5ZXIpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKGt4LCBreSk7XG4gICAgICAgICAgICBrZXkudnkgPSAtNTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNlbnRlclBsYXllciA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEuc2V0UG9zaXRpb24odGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueSk7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNhbWVyYS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImhvbHkxXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm1vdmVUbyhreCwga3ksIDMwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wYXVzZVNjZW5lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUZyb20ueCA9IGt4O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVGcm9tLnkgPSBreTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlUmFpbyA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZUxlcnAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVUb1BsYXllciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMucGFyZW50U2NlbmUuY2FtZXJhKSlcbiAgICAgICAgICAgICAgICAudG8oe21vdmVSYXRpbzogMX0sIDMwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jZW50ZXJQbGF5ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVMZXJwID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMucGFyZW50U2NlbmUuY2FtZXJhKSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gdGhpcy5wbGF5ZXIua2V5cztcbi8vICAgICAgICBpZiAoa2V5cy5sZW5ndGggPCAxKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcikuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSkuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgICAgICBwbC50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLm1vdmVUbyg3ODQrMTYsIDMwNC0xNiwgNTAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAubW92ZVRvKDc4NCsxNiwgLTMyLCA1MDAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlOS5qc1xuICogIDIwMTcvMDcvMjZcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K4OVxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlOVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiA5LFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo1LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtOVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTlfMVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSA5XCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IHRoaXMucGxheWVyLmtleXM7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA8IDEpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKS5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KS5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkubW92ZVRvKDQ4NywgMjcxLCAxMDAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlOTk5LmpzXG4gKiAgMjAxNy8wNS8wM1xuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jg4bjgrnjg4jjgrnjg4bjg7zjgrhcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTk5OVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiAxLFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo1LFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlOTk5XCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/vvKLvvKfvvK3lho3nlJ9cbiAgICAgICAgICAgIGFwcC5wbGF5QkdNKFwiYmdtMVwiKTtcblxuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgMVwiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlY29udHJvbGxlci5qc1xuICogIDIwMTcvMDEvMjRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K45Yi25b6hXG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmFwcC5PYmplY3QyRFwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogMCxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNSxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbTFcIixcblxuICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgbGltaXRXaWR0aDogZmFsc2UsXG4gICAgbGltaXRIZWlnaHQ6IHRydWUsXG5cbiAgICBwYXJlbnRTY2VuZTogbnVsbCxcbiAgICBtYXBMYXllcjogbnVsbCxcbiAgICBwbGF5ZXI6IG51bGwsXG4gICAgdGltZTogMCxcblxuICAgIC8v57WM6YGO5pmC6ZaT44OI44Oq44Ks44Kk44OZ44Oz44OIXG4gICAgc2VxOiBudWxsLFxuICAgIGluZGV4OiAwLFxuXG4gICAgLy/jg57jg4Pjg5fjg4jjg6rjgqzjgqTjg5njg7Pjg4hcbiAgICBldmVudDogbnVsbCxcblxuICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJ6Kit5a6aXG4gICAgaXNCYWNrZ3JvdW5kTW92ZTogdHJ1ZSxcbiAgICBiYWNrZ3JvdW5kWDogLTMyMCxcblxuICAgIC8v54m55q6K44K544OG44O844K444OV44Op44KwXG4gICAgaXNPcGVuaW5nOiBmYWxzZSxcbiAgICBpc1R1dG9yaWFsOiBmYWxzZSxcbiAgICBpc0VuZGluZzogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCgpO1xuXG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUgPSBwYXJlbnRTY2VuZTtcbiAgICAgICAgdGhpcy5tYXBMYXllciA9IFtdO1xuICAgICAgICB0aGlzLnBsYXllciA9IHBhcmVudFNjZW5lLnBsYXllcjtcblxuICAgICAgICB0aGlzLnNlcSA9IFtdO1xuICAgICAgICB0aGlzLmV2ZW50ID0gW107XG4gICAgfSxcblxuICAgIC8v5pmC6ZaT44Kk44OZ44Oz44OI6L+95YqgXG4gICAgYWRkOiBmdW5jdGlvbih0aW1lLCB2YWx1ZSwgb3B0aW9uKSB7XG4gICAgICAgIHRoaXMuaW5kZXggKz0gdGltZTtcbiAgICAgICAgdGhpcy5zZXFbdGhpcy5pbmRleF0gPSB7XG4gICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICBvcHRpb246IG9wdGlvbixcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLy/mmYLplpPjgqTjg5njg7Pjg4jlj5blvpdcbiAgICBnZXQ6IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLnNlcVt0aW1lXTtcbiAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgcmV0dXJuIG51bGw7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH0sXG5cbiAgICAvL+ODnuODg+ODl+OCpOODmeODs+ODiOi/veWKoFxuICAgIGFkZEV2ZW50OiBmdW5jdGlvbihpZCwgdmFsdWUsIG9wdGlvbikge1xuICAgICAgICB0aGlzLmV2ZW50W2lkXSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICAgIG9wdGlvbjogb3B0aW9uLFxuICAgICAgICAgICAgZXhlY3V0ZWQ6IGZhbHNlLFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICAvL+ODnuODg+ODl+OCpOODmeODs+ODiOWPluW+l1xuICAgIGdldEV2ZW50OiBmdW5jdGlvbihpZCkge1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZXZlbnRbaWRdO1xuICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIC8v5qyh44Gr44Kk44OZ44Oz44OI44GM55m655Sf44GZ44KL5pmC6ZaT44KS5Y+W5b6XXG4gICAgZ2V0TmV4dEV2ZW50VGltZTogZnVuY3Rpb24odGltZSkge1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMuc2VxW3RpbWVdO1xuICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRpbWUrMTtcbiAgICAgICAgICAgIHZhciBydCA9IC0xO1xuICAgICAgICAgICAgdGhpcy5zZXEuc29tZShmdW5jdGlvbih2YWwsIGluZGV4KXtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiB0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJ0ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sdGhpcy5zZXEpO1xuICAgICAgICAgICAgcmV0dXJuIHJ0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRpbWU7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/jgqTjg5njg7Pjg4jnmbrngatcbiAgICBmaXJlRXZlbnQ6IGZ1bmN0aW9uKGV2ZW50TmFtZSkge1xuICAgICAgICB2YXIgZXZlbnQgPSB0aGlzLmV2ZW50W2V2ZW50TmFtZV07XG4gICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgZXZlbnQudmFsdWUuY2FsbCgpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBjbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc2VxID0gW107XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuO+8ou+8p++8reWGjeeUn1xuICAgIHBsYXlCR006IGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHAucGxheUJHTSh0aGlzLmJnbSk7XG4gICAgfSxcblxuICAgIC8vSUTjgYvjgonjgqrjg5bjgrjjgqfjgq/jg4jmpJzntKJcbiAgICBmaW5kT2JqZWN0OiBmdW5jdGlvbihpZCwgbGF5ZXJOdW1iZXIsIGxheWVyTmFtZSkge1xuICAgICAgICBsYXllck51bWJlciA9IGxheWVyTnVtYmVyIHx8IDA7XG4gICAgICAgIGxheWVyTmFtZSA9IGxheWVyTmFtZSB8fCBcIm9iamVjdFwiO1xuICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcbiAgICAgICAgc3dpdGNoIChsYXllck5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJvYmplY3RcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm1hcExheWVyW2xheWVyTnVtYmVyXS5vYmpMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuaWQgPT0gaWQpIHJlc3VsdCA9IGU7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJlbmVteVwiOlxuICAgICAgICAgICAgICAgIHRoaXMubWFwTGF5ZXJbbGF5ZXJOdW1iZXJdLmVuZW15TGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmlkID09IGlkKSByZXN1bHQgPSBlO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuXG4gICAgLy90bXjjgYvjgonjg57jg4Pjg5fjg6zjgqTjg6TjgpLkvZzmiJDjgZnjgotcbiAgICBjcmVhdGVNYXA6IGZ1bmN0aW9uKHRteCkge1xuICAgICAgICAvL+ODnuODg+ODl+ODrOOCpOODpFxuICAgICAgICB2YXIgbWFwTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fnlLvlg4/nlKjjg6zjgqTjg6RcbiAgICAgICAgbWFwTGF5ZXIubWFwSW1hZ2VMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKG1hcExheWVyKTtcblxuICAgICAgICAvL+WcsOW9ouWIpOWumueUqOODrOOCpOODpFxuICAgICAgICBtYXBMYXllci5jb2xsaXNpb25MYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKG1hcExheWVyKTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODieODrOOCpOODpFxuICAgICAgICBtYXBMYXllci5iYWNrZ3JvdW5kTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyhtYXBMYXllcik7XG5cbiAgICAgICAgLy/jgqrjg5bjgrjjgqfjgq/jg4jnrqHnkIbjg6zjgqTjg6RcbiAgICAgICAgbWFwTGF5ZXIub2JqTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyhtYXBMYXllcik7XG5cbiAgICAgICAgLy/lvbHooajnpLrjg6zjgqTjg6RcbiAgICAgICAgbWFwTGF5ZXIuc2hhZG93TGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyhtYXBMYXllcik7XG5cbiAgICAgICAgLy/mlbXjgq3jg6Pjg6njgq/jgr/nrqHnkIbjg6zjgqTjg6RcbiAgICAgICAgbWFwTGF5ZXIuZW5lbXlMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKG1hcExheWVyKTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOihqOekuuODrOOCpOODpFxuICAgICAgICBtYXBMYXllci5wbGF5ZXJMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKG1hcExheWVyKTtcblxuICAgICAgICAvL+OCqOODleOCp+OCr+ODiOeuoeeQhuODrOOCpOODpFxuICAgICAgICBtYXBMYXllci5lZmZlY3RMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKG1hcExheWVyKTtcblxuICAgICAgICAvL+ODleOCqeOCouOCsOODqeOCpuODs+ODieODrOOCpOODpFxuICAgICAgICBtYXBMYXllci5mb3JlZ3JvdW5kTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyhtYXBMYXllcik7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fnlLvlg4/lj5blvpdcbiAgICAgICAgdmFyIG1hcEltYWdlID0gdG14LmdldEltYWdlKFwibWFwXCIsIFwiYmFja2dyb3VuZFwiLCBcImJhY2tncm91bmQyXCIsIFwiYmFja2dyb3VuZDNcIik7XG4gICAgICAgIG1hcExheWVyLm1hcCA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKG1hcEltYWdlKS5hZGRDaGlsZFRvKG1hcExheWVyLm1hcEltYWdlTGF5ZXIpLnNldE9yaWdpbigwLCAwKTtcblxuICAgICAgICAvL+ODleOCqeOCouOCsOODqeOCpuODs+ODieeUu+WDj1xuICAgICAgICB2YXIgZm9yZWdyb3VuZCA9IHRteC5nZXRJbWFnZShcImZvcmVncm91bmRcIiwgXCJmb3JlZ3JvdW5kMlwiLCBcImZvcmVncm91bmQzXCIpO1xuICAgICAgICBwaGluYS5kaXNwbGF5LlNwcml0ZShmb3JlZ3JvdW5kKS5hZGRDaGlsZFRvKG1hcExheWVyLmZvcmVncm91bmRMYXllcikuc2V0T3JpZ2luKDAsIDApO1xuXG4gICAgICAgIC8v44Oe44OD44OX5b2T44Gf44KK5Yik5a6a5Y+W5b6XXG4gICAgICAgIHZhciBvYmplY3RzID0gdG14LmdldE9iamVjdEdyb3VwKFwiY29sbGlzaW9uXCIpLm9iamVjdHM7XG4gICAgICAgIG9iamVjdHMuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgd2lkdGggPSBlLndpZHRoIHx8IDE2O1xuICAgICAgICAgICAgdmFyIGhlaWdodCA9IGUuaGVpZ2h0IHx8IDE2O1xuICAgICAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0fSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyhtYXBMYXllci5jb2xsaXNpb25MYXllcilcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oZS54K3dpZHRoLzIsIGUueStoZWlnaHQvMilcbiAgICAgICAgICAgICAgICAuc2V0VmlzaWJsZShERUJVR19DT0xMSVNJT04pO1xuICAgICAgICAgICAgYy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMueCArPSB0aGlzLnZ4O1xuICAgICAgICAgICAgICAgIHRoaXMueSArPSB0aGlzLnZ5O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjLmlkID0gZS5pZDtcbiAgICAgICAgICAgIGMudnggPSAwO1xuICAgICAgICAgICAgYy52eSA9IDA7XG4gICAgICAgICAgICBjLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgYy5pZ25vcmUgPSBmYWxzZTtcbiAgICAgICAgICAgIGMuZnJpY3Rpb24gPSBlLnByb3BlcnRpZXMuZnJpY3Rpb24gPT0gdW5kZWZpbmVkPyAwLjU6IGUucHJvcGVydGllcy5mcmljdGlvbjtcbiAgICAgICAgICAgIGlmIChlLm5hbWUpIGMubmFtZSA9IGUubmFtZTtcbiAgICAgICAgICAgIGlmIChlLnR5cGUpIGMudHlwZSA9IGUudHlwZTtcbiAgICAgICAgICAgIGMuJGV4dGVuZChlLnByb3BlcnRpZXMpO1xuXG4gICAgICAgICAgICAvL+W4uOaZguWun+ihjOOCueOCr+ODquODl+ODiFxuICAgICAgICAgICAgaWYgKGMuc2NyaXB0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNjID0gXCIoZnVuY3Rpb24oYXBwKSB7XCIrYy5zY3JpcHQrXCJ9KVwiO1xuICAgICAgICAgICAgICAgIHZhciBmID0gZXZhbChzYyk7XG4gICAgICAgICAgICAgICAgYy5vbignZW50ZXJmcmFtZScsIGYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/lvZPjgZ/jgorliKTlrprmmYLlrp/ooYzjgrnjgq/jg6rjg5fjg4hcbiAgICAgICAgICAgIGlmIChjLmNvbGxpc2lvbikge1xuICAgICAgICAgICAgICAgIHZhciBzYyA9IFwiKGZ1bmN0aW9uKGUsIGRpcikge1wiK2MuY29sbGlzaW9uK1wifSlcIjtcbiAgICAgICAgICAgICAgICBjLmNvbGxpc2lvblNjcmlwdCA9IGV2YWwoc2MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIC8v44Kk44OZ44Oz44OI5Y+W5b6XXG4gICAgICAgIHZhciBldmVudHMgPSB0bXguZ2V0T2JqZWN0R3JvdXAoXCJldmVudFwiKS5vYmplY3RzO1xuICAgICAgICBldmVudHMuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgeCA9IGUueCArIChlLndpZHRoIHx8IDE2KSAvIDI7XG4gICAgICAgICAgICB2YXIgeSA9IGUueSArIChlLmhlaWdodCB8fCAxNikgLyAyO1xuICAgICAgICAgICAgc3dpdGNoIChlLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwicGxheWVyXCI6XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLm5hbWUgPT0gXCJzdGFydFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBMYXllci5zdGFydFBvc2l0aW9uID0ge3g6IHgsIHk6IHl9O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIueCA9IHg7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXllci55ID0geTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLnNjYWxlWCA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wcm9wZXJ0aWVzLmRpcmVjdGlvbiA9PSAxODApIHRoaXMucGxheWVyLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJlbmVteVwiOlxuICAgICAgICAgICAgICAgICAgICBpZiAocWZ0LkVuZW15W2UubmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmVteSA9IHFmdC5FbmVteVtlLm5hbWVdKHRoaXMucGFyZW50U2NlbmUsIGUucHJvcGVydGllcykuYWRkQ2hpbGRUbyhtYXBMYXllci5lbmVteUxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnByb3BlcnRpZXMuZGVhZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYyA9IFwiKGZ1bmN0aW9uKGFwcCkge1wiK2UucHJvcGVydGllcy5kZWFkK1wifSlcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGV2YWwoc2MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Lm9uKCdkZWFkJywgZik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvL+enu+WLleODkeOCueioreWumlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucHJvcGVydGllcy5wYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGggPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IGUucHJvcGVydGllcy5wYXRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudHNbaV0uaWQgPT0gaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBldmVudHNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF0aCkgZW5lbXkuc2V0UGF0aChwYXRoLCBlLnByb3BlcnRpZXMubG9vcCB8fCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJ1bmtub3duIGVuZW15OiBcIitlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpdGVtXCI6XG4gICAgICAgICAgICAgICAgICAgIHFmdC5JdGVtKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiaXRlbWJveFwiOlxuICAgICAgICAgICAgICAgICAgICBxZnQuSXRlbUJveCh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRvb3JcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRvb3IgPSBxZnQuTWFwT2JqZWN0LkRvb3IodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLm5hbWUgPT0gXCJjbGVhclwiKSBtYXBMYXllci5jbGVhckdhdGUgPSBkb29yO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5wcm9wZXJ0aWVzLnNjcmlwdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjID0gXCIoZnVuY3Rpb24oYXBwKSB7XCIrZS5wcm9wZXJ0aWVzLnNjcmlwdCtcIn0pXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IGV2YWwoc2MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9vci5vbignZW50ZXJmcmFtZScsIGYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9vci5zdGFnZUNvbnRyb2xsZXIgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9vci5wbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvb3IucGFyZW50U2NlbmUgPSB0aGlzLnBhcmVudFNjZW5lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJibG9ja1wiOlxuICAgICAgICAgICAgICAgICAgICB2YXIgYmxvY2sgPSBxZnQuTWFwT2JqZWN0LkJsb2NrKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICBibG9jay5hZGRDb2xsaXNpb24obWFwTGF5ZXIuY29sbGlzaW9uTGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZmxvb3JcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZsb29yID0gcWZ0Lk1hcE9iamVjdC5GbG9vcih0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgZmxvb3IuYWRkQ29sbGlzaW9uKG1hcExheWVyLmNvbGxpc2lvbkxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUucHJvcGVydGllcy5zY3JpcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYyA9IFwiKGZ1bmN0aW9uKGFwcCkge1wiK2UucHJvcGVydGllcy5zY3JpcHQrXCJ9KVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBldmFsKHNjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb29yLm9uKCdlbnRlcmZyYW1lJywgZik7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG9vci5zdGFnZUNvbnRyb2xsZXIgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3IucGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG9vci5wYXJlbnRTY2VuZSA9IHRoaXMucGFyZW50U2NlbmU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/np7vli5Xjg5HjgrnoqK3lrppcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGggPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5wcm9wZXJ0aWVzLm1vdmVUeXBlID09ICdwYXRoJyAmJiBlLnByb3BlcnRpZXMucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gZS5wcm9wZXJ0aWVzLnBhdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudHNbaV0uaWQgPT0gaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IGV2ZW50c1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9vci5zZXRQYXRoKHBhdGgueCwgcGF0aC55LCBwYXRoLnBvbHlsaW5lLCBlLnByb3BlcnRpZXMubG9vcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNoZWNrXCI6XG4gICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QuQ2hlY2tJY29uKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpLnNldEFuaW1hdGlvbihlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwibWVzc2FnZVwiOlxuICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0Lk1lc3NhZ2UodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJldmVudFwiOlxuICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0LkV2ZW50KHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZ2F0ZVwiOlxuICAgICAgICAgICAgICAgICAgICB2YXIgZ2F0ZSA9IHFmdC5NYXBPYmplY3QuR2F0ZSh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUucHJvcGVydGllcy5zY3JpcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYyA9IFwiKGZ1bmN0aW9uKGFwcCkge1wiK2UucHJvcGVydGllcy5zY3JpcHQrXCJ9KVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBldmFsKHNjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdGUub24oJ2VudGVyZnJhbWUnLCBmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdGUuc3RhZ2VDb250cm9sbGVyID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdGUucGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYXRlLnBhcmVudFNjZW5lID0gdGhpcy5wYXJlbnRTY2VuZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiYWNjZXNzb3J5XCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXllciA9IGUucHJvcGVydGllcy5mb3JlZ3JvdW5kPyBtYXBMYXllci5mb3JlZ3JvdW5kTGF5ZXI6IG1hcExheWVyLmJhY2tncm91bmRMYXllcjtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJsYW1wXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5MYW1wKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJvbmZpcmVcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0LkJvbmZpcmUodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhsYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZmxhbWVcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0LkZsYW1lKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImNhbmRsZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QuQ2FuZGxlKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImxhbnRoYW51bVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QuTGFudGhhbnVtKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImNhbmRsZWxhbXBcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0LkNhbmRsZUxhbXAodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhsYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcInVua25vd24gbWFwIGFjY2Vzc29yeTogXCIrZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwibnBjXCI6XG4gICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QubnBjKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIuZW5lbXlMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJwYXRoXCI6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcInVua25vd24gbWFwIG9iamVjdCBpZDpbXCIgKyBlLmlkICsgXCJdIHR5cGU6W1wiICsgZS50eXBlICsgXCJdIG5hbWU6W1wiICsgZS5uYW1lICsgXCJdXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gbWFwTGF5ZXI7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTEwLmpzXG4gKiAgMjAxNy8wOS8xMFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqjjg7Pjg4fjgqPjg7PjgrDjgrfjg7zjg7NcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTEwXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDEwLFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo1LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiZW5kaW5nXCIsXG5cbiAgICAvL+eJueauiuOCueODhuODvOOCuOODleODqeOCsFxuICAgIGlzRW5kaW5nOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTEwXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBiYWxsb29uLmpzXG4gKiAgMjAxNy8wNC8yNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkJhbGxvb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5TcHJpdGVcIixcblxuICAgIC8v5a+/5ZG944OV44Os44O844OgXG4gICAgbGlmZVNwYW46IDMwLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PplpPpmpRcbiAgICBhbmltYXRpb25JbnRlcnZhbDogNixcblxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChcImJhbGxvb25cIiwgMjQsIDMyKTtcblxuICAgICAgICB0aGlzLnBhdHRlcm4gPSBvcHRpb25zLnBhdHRlcm4gfHwgXCIhXCI7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKHRoaXMucGF0dGVybik7XG5cbiAgICAgICAgdGhpcy5saWZlU3BhbiA9IG9wdGlvbnMubGlmZVNwYW4gfHwgNjA7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSBvcHRpb25zLmFuaW1hdGlvbkludGVydmFsIHx8IDY7XG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgLy/nibnmrorjg5Hjgr/jg7zjg7NcbiAgICAgICAgaWYgKHRoaXMucGF0dGVybiA9PSBcImFuZ2VyMlwiKSB7XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKS5ieSh7eTogLTE2LCBhbHBoYTogLTF9LCB0aGlzLmFuaW1hdGlvbkludGVydmFsLCBcImVhc2VJblNpbmVcIik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlIDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnRpbWUgJSB0aGlzLmFuaW1hdGlvbkludGVydmFsID09IDApIHRoaXMuZnJhbWVJbmRleCsrO1xuXG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgICAgICBpZiAodGhpcy50aW1lID4gdGhpcy5saWZlU3BhbikgdGhpcy5yZW1vdmUoKTtcbiAgICB9LFxuXG4gICAgc2V0QW5pbWF0aW9uOiBmdW5jdGlvbihwYXR0ZXJuKSB7XG4gICAgICAgIHN3aXRjaCAocGF0dGVybikge1xuICAgICAgICAgICAgY2FzZSBcIi4uLlwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZygwLCAwLCAyNCwgMTI4KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCI/XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDk2LCAzMiwgMjQsIDMyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCIhXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDcyLCA2NCwgNzIsIDMyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ6enpcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgMjQsIDMyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzdHVuXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDE0NCwgMzIsIDQ4LCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibGlnaHRcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZyYW1lVHJpbW1pbmcoMTQ0LCA2NCwgNDgsIDMyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJuZXd0eXBlXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDE0NCwgOTYsIDcyLCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiYW5nZXJcIjpcbiAgICAgICAgICAgIGNhc2UgXCJhbmdlcjFcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZyYW1lVHJpbW1pbmcoNzIsIDk2LCAyNCwgMzIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImFuZ2VyMlwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZygxNDQsIDEyOCwgNzIsIDMyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgY2hhcmFjdGVyLmpzXG4gKiAgMjAxNi8xMi8yOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkNoYXJhY3RlclwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICAvL+ODnuODg+ODl+OCquODluOCuOOCp+OCr+ODiElEXG4gICAgaWQ6IC0xLFxuXG4gICAgLy/liqDpgJ/luqZcbiAgICB2eDogMCxcbiAgICB2eTogMCxcblxuICAgIC8v5Yid5pyf5bqn5qiZXG4gICAgZmlyc3RYOiAwLFxuICAgIGZpcnN0WTogMCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMC45LFxuXG4gICAgLy/mqKrnp7vli5XmuJvoobDnjodcbiAgICBmcmljdGlvbjogMC41LFxuXG4gICAgLy/luornp7vli5XmuJvoobDnjodcbiAgICBmbG9vckZyaWN0aW9uOiAwLjUsXG5cbiAgICAvL+WPjeeZuuS/guaVsFxuICAgIHJlYm91bmQ6IDAsXG5cbiAgICAvL+OCuOODo+ODs+ODl+S4reODleODqeOCsFxuICAgIGlzSnVtcDogZmFsc2UsXG5cbiAgICAvL+OCueODq+ODvOOBl+OBn+ODleODreOColxuICAgIHRocm91Z2hGbG9vcjogbnVsbCxcblxuICAgIC8v5bqK5LiK44OV44Op44KwXG4gICAgaXNPbkZsb29yOiBmYWxzZSxcblxuICAgIC8v5LmX44Gj44Gm44GE44KL44Kq44OW44K444Kn44Kv44OIXG4gICAgZmxvb3JPYmplY3Q6IG51bGwsXG5cbiAgICAvL+OBr+OBl+OBlOS4iuODleODqeOCsFxuICAgIGlzT25MYWRkZXI6IGZhbHNlLFxuXG4gICAgLy/pmo7mrrXkuIrjg5Xjg6njgrBcbiAgICBpc09uU3RhaXJzOiBmYWxzZSxcblxuICAgIC8v44Gv44GX44GU5o6044G/44OV44Op44KwXG4gICAgaXNDYXRjaExhZGRlcjogZmFsc2UsXG5cbiAgICAvL+atu+S6oeODleODqeOCsFxuICAgIGlzRGVhZDogZmFsc2UsXG5cbiAgICAvL+iQveS4i+atu+S6oeODleODqeOCsFxuICAgIGlzRHJvcDogZmFsc2UsXG5cbiAgICAvL+awl+e1tuODleODqeOCsFxuICAgIGlzU3R1bjogZmFsc2UsXG5cbiAgICAvL+aTjeS9nOWBnOatouaZgumWk1xuICAgIHN0b3BUaW1lOiAwLFxuXG4gICAgLy/nhKHmlbXjg5Xjg6njgrBcbiAgICBpc011dGVraTogZmFsc2UsXG5cbiAgICAvL+eEoeaVteaZgumWk1xuICAgIG11dGVraVRpbWU6IDAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ODleODqeOCsFxuICAgIGlzQW5pbWF0aW9uOiB0cnVlLFxuXG4gICAgLy/nj77lnKjlrp/ooYzkuK3jgqLjgq/jgrfjg6fjg7NcbiAgICBub3dBbmltYXRpb246IFwic3RhbmRcIixcblxuICAgIC8v5YmN44OV44Os44O844Og5a6f6KGM44Ki44Kv44K344On44OzXG4gICAgYmVmb3JlQW5pbWF0aW9uOiBcIlwiLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PpgLLooYzlj6/og73jg5Xjg6njgrBcbiAgICBpc0FkdmFuY2VBbmltYXRpb246IHRydWUsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+WkieabtOaknOefpeODleODqeOCsFxuICAgIGlzQ2hhbmdlQW5pbWF0aW9uOiBmYWxzZSxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDYsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogZmFsc2UsXG5cbiAgICAvL+OCueOCr+ODquODvOODs+WGheODleODqeOCsFxuICAgIG9uU2NyZWVuOiBmYWxzZSxcblxuICAgIC8v5rS75YuV44OV44Op44KwXG4gICAgaXNBY3RpdmU6IHRydWUsXG5cbiAgICAvL+W9seihqOekulxuICAgIGlzU2hhZG93OiBmYWxzZSxcbiAgICBzaGFkb3dZOiAwLFxuXG4gICAgLy/orZjliKXjg5Xjg6njgrBcbiAgICBpc1BsYXllcjogZmFsc2UsXG4gICAgaXNFbmVteTogZmFsc2UsXG4gICAgaXNJdGVtQm94OiBmYWxzZSxcbiAgICBpc0l0ZW06IGZhbHNlLFxuICAgIGlzQmxvY2s6IGZhbHNlLFxuICAgIGlzTWFwQWNjZXNzb3J5OiBmYWxzZSxcblxuICAgIC8v57WM6YGO44OV44Os44O844OgXG4gICAgdGltZTogMCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG4gICAgICAgIHRoaXMuYm91bmRpbmdUeXBlID0gXCJyZWN0XCI7XG4gICAgICAgIHRoaXMudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICB0aGlzLnNldHVwQW5pbWF0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQgfHwgLTE7XG5cbiAgICAgICAgLy/lvZPjgZ/jgorliKTlrprmg4XloLHliJ3mnJ/ljJZcbiAgICAgICAgaWYgKCF0aGlzLmlzTWFwQWNjZXNzb3J5KSB0aGlzLmluaXRDb2xsaXNpb24ob3B0aW9ucyk7XG5cbiAgICAgICAgLy/lkLnjgY3lh7rjgZdcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLmJhbGxvb24gPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3RCYWxsb29uID0gXCJcIjtcbiAgICAgICAgdGhpcy5iYWxsb29uVGltZSA9IDA7XG4gICAgICAgIHRoaXMub24oJ2JhbGxvb24nLCBlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzU3R1bikgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZSA+IHRoaXMuYmFsbG9vblRpbWUpIHRoaXMubGFzdEJhbGxvb24gPSBcIlwiO1xuICAgICAgICAgICAgaWYgKHRoaXMubGFzdEJhbGxvb25QYXR0ZXJuID09IGUucGF0dGVybiAmJiAhZS5mb3JjZSkgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKHRoaXMuYmFsbG9vbikgdGhpcy5iYWxsb29uLnJlbW92ZSgpO1xuICAgICAgICAgICAgZS4kc2FmZSh7eDogMCwgeTogLXRoaXMuaGVpZ2h0LzItMTB9KTtcbiAgICAgICAgICAgIHRoaXMuYmFsbG9vbiA9IHFmdC5CYWxsb29uKHtwYXR0ZXJuOiBlLnBhdHRlcm4sIGxpZmVTcGFuOiBlLmxpZmVTcGFuLCBhbmltYXRpb25JbnRlcnZhbDogZS5hbmltYXRpb25JbnRlcnZhbH0pXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oZS54LCBlLnkpO1xuICAgICAgICAgICAgdGhpcy5iYWxsb29uLm9uKCdyZW1vdmVkJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhhdC5iYWxsb29uID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGF0LmZsYXJlKCdiYWxsb29uZW5kJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMubGFzdEJhbGxvb25QYXR0ZXJuID0gZS5wYXR0ZXJuO1xuICAgICAgICAgICAgdGhpcy5iYWxsb29uVGltZSA9IHRoaXMudGltZSArIDEyMDtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub24oJ2JhbGxvb25lcmFjZScsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuYmFsbG9vbiA9PSBudWxsKSByZXR1cm47XG4gICAgICAgICAgICB0aGlzLmJhbGxvb24ucmVtb3ZlKCk7XG4gICAgICAgICAgICB0aGlzLmJhbGxvb24gPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5iYWxsb29uVGltZSA9IDA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v5rCX57W254q25oWLXG4gICAgICAgIHRoaXMub24oJ3N0dW4nLCBlID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNTdHVuID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSBlLnBvd2VyICogMTA7XG4gICAgICAgICAgICB0aGlzLmJhbGxvb24gPSBxZnQuQmFsbG9vbih7cGF0dGVybjogXCJzdHVuXCIsIGxpZmVTcGFuOiB0aGlzLnN0b3BUaW1lfSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAtdGhpcy5oZWlnaHQvMi0xMCk7XG4gICAgICAgICAgICB0aGlzLmxhc3RCYWxsb29uID0gZS5wYXR0ZXJuO1xuICAgICAgICAgICAgdGhpcy5iYWxsb29uVGltZSA9IHRoaXMudGltZSArIDEyMDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudFNjZW5lLnBhdXNlU2NlbmUpIHJldHVybjtcblxuICAgICAgICAgICAgLy/liJ3mnJ/luqfmqJnjga7oqJjpjLLjgajliJ3lm57jg5Xjg6zjg7zjg6Dlh6bnkIZcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RYID0gdGhpcy54O1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RZID0gdGhpcy55O1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RGcmFtZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+eUu+mdouWGheWIpOWumlxuICAgICAgICAgICAgdmFyIHBzID0gdGhpcy5wYXJlbnRTY2VuZTtcbiAgICAgICAgICAgIGlmIChwcy5zY3JlZW5YLVNDX1cgPCB0aGlzLnggJiYgdGhpcy54IDwgcHMuc2NyZWVuWCArIFNDX1cqMiAmJiBcbiAgICAgICAgICAgICAgICBwcy5zY3JlZW5ZLVNDX0ggPCB0aGlzLnkgJiYgdGhpcy55IDwgcHMuc2NyZWVuWSArIFNDX0gqMikge1xuICAgICAgICAgICAgICAgIHRoaXMub25TY3JlZW4gPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uU2NyZWVuID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+eUu+mdouWkluOBruWgtOWQiOOBr+WLleS9nOWBnOatolxuLy8gICAgICAgICAgICBpZiAoIXRoaXMub25TY3JlZW4pIHJldHVybjtcblxuICAgICAgICAgICAgLy/mtLvli5Xjg5Xjg6njgrBcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkgcmV0dXJuO1xuXG4gICAgICAgICAgICB0aGlzLnggKz0gdGhpcy52eDtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgICAgIHRoaXMudnggKj0gdGhpcy5mbG9vckZyaWN0aW9uO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IHRoaXMuZnJpY3Rpb247XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2F0Y2hMYWRkZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnkgKz0gdGhpcy52eTtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy55ICs9IHRoaXMudnk7XG4gICAgICAgICAgICAgICAgdGhpcy52eSArPSB0aGlzLmdyYXZpdHk7XG4gICAgICAgICAgICAgICAgLy/okL3kuIvpgJ/luqbkuIrpmZBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52eSA+IDIwKSB0aGlzLnZ5ID0gMjA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoTWF0aC5hYnModGhpcy52eCkgPCAwLjAxKSB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgIGlmIChNYXRoLmFicyh0aGlzLnZ5KSA8IDAuMDEpIHRoaXMudnkgPSAwO1xuXG4gICAgICAgICAgICAvL+W9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzTWFwQWNjZXNzb3J5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldENvbGxpc2lvblBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja01hcENvbGxpc2lvbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+eUu+mdouWkluiQveOBoVxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzRGVhZCAmJiB0aGlzLnkgPiB0aGlzLnBhcmVudC5wYXJlbnQubWFwLmhlaWdodCkgdGhpcy5kcm9wRGVhZCgpO1xuXG4gICAgICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs1xuICAgICAgICAgICAgaWYgKHRoaXMuc3ByaXRlICYmIHRoaXMuaXNBbmltYXRpb24gJiYgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gJiYgdGhpcy50aW1lICUgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbmRleCA9ICh0aGlzLmluZGV4KzEpICUgdGhpcy5mcmFtZVt0aGlzLm5vd0FuaW1hdGlvbl0ubGVuZ3RoO1xuICAgICAgICAgICAgICAgIC8v5qyh44OV44Os44O844Og55Wq5Y+344GM54m55q6K5oyH5a6a44Gu5aC05ZCIXG4gICAgICAgICAgICAgICAgdmFyIG5leHQgPSB0aGlzLmZyYW1lW3RoaXMubm93QW5pbWF0aW9uXVt0aGlzLmluZGV4XTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dCA9PSBcInN0b3BcIikge1xuICAgICAgICAgICAgICAgICAgICAvL+WBnOatolxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4LS07XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXh0ID09IFwicmVtb3ZlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg6rjg6Djg7zjg5ZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBuZXh0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v5oyH5a6a44Ki44OL44Oh44O844K344On44Oz44G45aSJ5pu0XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKG5leHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLmZyYW1lSW5kZXggPSBuZXh0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/nhKHmlbXmmYLplpPlh6bnkIZcbiAgICAgICAgICAgIGlmICh0aGlzLm11dGVraVRpbWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubXV0ZWtpVGltZSAlIDIgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgICAgICAgICB0aGlzLm11dGVraVRpbWUtLTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/mk43kvZzlgZzmraLmmYLplpNcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUtLTtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0b3BUaW1lIDwgMCkgdGhpcy5zdG9wVGltZSA9IDA7XG5cbiAgICAgICAgICAgIC8v5pON5L2c5YGc5q2i5pmC6ZaT44GM57WC44KP44Gj44Gf44KJ5rCX57W26Kej6ZmkXG4gICAgICAgICAgICBpZiAodGhpcy5pc1N0dW4gJiYgdGhpcy5zdG9wVGltZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1N0dW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuYmFsbG9vbikgdGhpcy5iYWxsb29uLnNjYWxlWCA9IHRoaXMuc2NhbGVYO1xuXG4gICAgICAgICAgICAvL+S5l+OBo+OBpuOBhOOCi+W6iuOBruWPluW+l1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbG9vck9iamVjdCA9IHRoaXMuX2NvbGxpc2lvblsyXS5oaXQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxvb3JPYmplY3QgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+W9seWHpueQhlxuICAgICAgICAgICAgaWYgKHRoaXMuc2hhZG93U3ByaXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUueCA9IHRoaXMueDtcbiAgICAgICAgICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS55ID0gdGhpcy5zaGFkb3dZO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnRpbWUrKztcbiAgICAgICAgICAgIHRoaXMuYmVmb3JlQW5pbWF0aW9uID0gdGhpcy5ub3dBbmltYXRpb247XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMub24oJ2FkZGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbmUoJ2VudGVyZnJhbWUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNTaGFkb3cgJiYgIXRoaXMuaWdub3JlQ29sbGlzaW9uKSB0aGlzLnNldHVwU2hhZG93KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5vbigncmVtb3ZlZCcsICgpID0+IHtcbiAgICAgICAgICAgIGlmKHRoaXMuc2hhZG93U3ByaXRlKSB0aGlzLnNoYWRvd1Nwcml0ZS5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v5LiA5Zue55uu44GuZW50ZXJmcmFtZeOBp+S4gOW6puOBoOOBkeWRvOOBsOOCjOOCi1xuICAgIGZpcnN0RnJhbWU6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG5cbiAgICAvL+W9seihqOekuuOCu+ODg+ODiOOCouODg+ODl1xuICAgIHNldHVwU2hhZG93OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgc2MgPSB0aGlzLndpZHRoIC8gMjQ7XG4gICAgICAgIGlmIChzYyA8IDEpIHNjICs9IDAuMjtcbiAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInNoYWRvd1wiLCAyNCwgOClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuc2hhZG93TGF5ZXIpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC41KVxuICAgICAgICAgICAgLnNldFNjYWxlKHNjLCAxLjApO1xuICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuYWxwaGEgPSAwLjU7XG4gICAgICAgICAgICBpZiAodGhhdC5hbHBoYSA8IDAuNSkgdGhpcy5hbHBoYSA9IHRoYXQuYWxwaGE7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprmg4XloLHliJ3mnJ/ljJZcbiAgICBpbml0Q29sbGlzaW9uOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIC8v5b2T44KK5Yik5a6a55So77yIMDrkuIogMTrlj7MgMjrkuIsgMzrlt6bvvIlcbiAgICAgICAgdmFyIHcgPSBNYXRoLmZsb29yKHRoaXMud2lkdGgvNCk7XG4gICAgICAgIHZhciBoID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodC80KTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uID0gW107XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblswXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiB3LCBoZWlnaHQ6IDJ9KTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzFdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDIsIGhlaWdodDogaH0pO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogdywgaGVpZ2h0OiAyfSk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblszXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAyLCBoZWlnaHQ6IGh9KTtcbiAgICAgICAgdGhpcy5jb2xsaXNpb25SZXN1bHQgPSBudWxsO1xuXG4gICAgICAgIC8v5b2T44Gf44KK5Yik5a6a44OB44Kn44OD44Kv5L2N572u44Kq44OV44K744OD44OIXG4gICAgICAgIHRoaXMub2Zmc2V0Q29sbGlzaW9uWCA9IG9wdGlvbnMub2Zmc2V0Q29sbGlzaW9uWCB8fCAwO1xuICAgICAgICB0aGlzLm9mZnNldENvbGxpc2lvblkgPSBvcHRpb25zLm9mZnNldENvbGxpc2lvblkgfHwgMDtcblxuICAgICAgICAvL+W9k+OBn+OCiuWIpOWumuaDheWgseWGjeioreWumlxuICAgICAgICB0aGlzLnNldHVwQ29sbGlzaW9uKCk7XG5cbiAgICAgICAgLy/lvZPjgZ/jgorliKTlrprjg4fjg5Djg4PjgrDnlKhcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikge1xuICAgICAgICAgICAgdGhpcy5vbmUoJ2VudGVyZnJhbWUnLCBlID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMF0uYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMV0uYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0uYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10uYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMF0uYWxwaGEgPSAwLjM7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzFdLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblsyXS5hbHBoYSA9IDAuMztcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10uYWxwaGEgPSAwLjM7XG4gICAgICAgICAgICAgICAgLy/jg4Djg6Hjg7zjgrjlvZPjgZ/jgorliKTlrprooajnpLpcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiB0aGlzLndpZHRoLCBoZWlnaHQ6IHRoaXMuaGVpZ2h0fSkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgICAgICAgICBjLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLm9uZSgncmVtb3ZlZCcsIGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblswXS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMV0ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzJdLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblszXS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/nlLvpnaLlpJbokL3jgaFcbiAgICBkcm9wRGVhZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNEZWFkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0Ryb3AgPSB0cnVlO1xuICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdkZWFkJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+ODjuODg+OCr+ODkOODg+OCr+ODouODvOOCt+ODp+ODs1xuICAgIGtub2NrYmFjazogZnVuY3Rpb24ocG93ZXIsIGRpcmVjdGlvbikge1xuICAgICAgICBwb3dlciA9IHBvd2VyIHx8IDA7XG4gICAgICAgIGlmIChwb3dlciA9PSAwKSByZXR1cm47XG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09IHVuZGVmaW5lZCkgZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcblxuICAgICAgICB2YXIgYmFjayA9IDMyICsgTWF0aC5mbG9vcihwb3dlciAvIDEwKTtcbiAgICAgICAgdmFyIHN4ID0gTWF0aC5jb3MoZGlyZWN0aW9uLnRvUmFkaWFuKCkpO1xuICAgICAgICB2YXIgc3kgPSBNYXRoLnNpbihkaXJlY3Rpb24udG9SYWRpYW4oKSk7XG5cbiAgICAgICAgLy/jg47jg4Pjgq/jg5Djg4Pjgq/lhYjjgavlo4HjgYznhKHjgYTjgYvjg4Hjgqfjg4Pjgq9cbiAgICAgICAgdmFyIGNoayA9IHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCArIHN4ICogYmFjaywgdGhpcy55ICsgc3kgKiBiYWNrLCA4LCA4KTtcbiAgICAgICAgaWYgKGNoaykge1xuICAgICAgICAgICAgLy/lo4HjgavlvZPjgZ/jgovmiYDjgb7jgafjg5Djg4Pjgq/jgZnjgotcbiAgICAgICAgICAgIHZhciBjID0gY2hrWzBdO1xuICAgICAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIGJhY2sgPSAoYy54IC0gYy53aWR0aCAvIDIpIC0gdGhpcy54O1xuICAgICAgICAgICAgICAgICAgICBiYWNrICo9IDAuODtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxODA6XG4gICAgICAgICAgICAgICAgICAgIGJhY2sgPSB0aGlzLnggLSAoYy54ICsgYy53aWR0aCAvIDIpO1xuICAgICAgICAgICAgICAgICAgICBiYWNrICo9IDAuODtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpLmJ5KHt4OiBzeCAqIGJhY2ssIHk6IHN5ICogYmFja30sIDEwLCBcImVhc2VPdXRFbGFzdGljXCIpO1xuICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+WcsOW9ouW9k+OBn+OCiuWIpOWumlxuICAgIGNoZWNrTWFwQ29sbGlzaW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlQ29sbGlzaW9uKSByZXR1cm4gdGhpcztcblxuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMF0uaGl0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzFdLmhpdCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblsyXS5oaXQgPSBudWxsO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10uaGl0ID0gbnVsbDtcblxuICAgICAgICB0aGlzLmlzT25MYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc09uU3RhaXJzID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHRoaXMub25TY3JlZW4gJiYgdGhpcy5zaGFkb3dTcHJpdGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2hhZG93WSA9IDk5OTk5O1xuICAgICAgICAgICAgdmFyIHAxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgIHZhciBwMiA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSArIDEyOCk7XG4gICAgICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WcsOW9ouaOpeinpuWIpOWumlxuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0Ryb3ApIHJldHVybjtcbiAgICAgICAgICAgIGlmIChlLmlnbm9yZSB8fCBlID09IHRoaXMudGhyb3VnaEZsb29yKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgZS50eXBlID09IFwic3RhaXJzXCIpIHJldHVybjtcblxuICAgICAgICAgICAgLy/kuIrlgbRcbiAgICAgICAgICAgIGlmICh0aGlzLnZ5IDwgMCAgJiYgZS5oaXRUZXN0RWxlbWVudCh0aGlzLl9jb2xsaXNpb25bMF0pKSB0aGlzLl9jb2xsaXNpb25bMF0uaGl0ID0gZTtcbiAgICAgICAgICAgIC8v5LiL5YG0XG4gICAgICAgICAgICBpZiAodGhpcy52eSA+PSAwICYmIGUuaGl0VGVzdEVsZW1lbnQodGhpcy5fY29sbGlzaW9uWzJdKSkgdGhpcy5fY29sbGlzaW9uWzJdLmhpdCA9IGU7XG4gICAgICAgICAgICAvL+WPs+WBtFxuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwICAmJiBlLmhpdFRlc3RFbGVtZW50KHRoaXMuX2NvbGxpc2lvblsxXSkpIHRoaXMuX2NvbGxpc2lvblsxXS5oaXQgPSBlO1xuICAgICAgICAgICAgLy/lt6blgbRcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4IDwgMCAgJiYgZS5oaXRUZXN0RWxlbWVudCh0aGlzLl9jb2xsaXNpb25bM10pKSB0aGlzLl9jb2xsaXNpb25bM10uaGl0ID0gZTtcblxuICAgICAgICAgICAgaWYgKHRoaXMub25TY3JlZW4gJiYgdGhpcy5zaGFkb3dTcHJpdGUpIHtcbiAgICAgICAgICAgICAgICAvL+OCreODo+ODqeOCr+OCv+ODvOOBruS4i+aWueWQkeOBq+ODrOOCpOOCkumjm+OBsOOBl+OBpuebtOS4i+OBruWcsOmdouW6p+aomeOCkuWPluOCi1xuICAgICAgICAgICAgICAgIHZhciB4ID0gZS54IC0gZS53aWR0aCAvIDI7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSBlLnkgLSBlLmhlaWdodCAvIDI7XG4gICAgICAgICAgICAgICAgdmFyIHAzID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHgsIHkpO1xuICAgICAgICAgICAgICAgIHZhciBwNCA9IHBoaW5hLmdlb20uVmVjdG9yMih4ICsgZS53aWR0aCwgeSk7XG4gICAgICAgICAgICAgICAgaWYgKHkgPCB0aGlzLnNoYWRvd1kgJiYgcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdExpbmVMaW5lKHAxLCBwMiwgcDMsIHA0KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS5zZXRQb3NpdGlvbih0aGlzLngsIHkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGFkb3dZID0geTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLmlzQ2F0Y2hMYWRkZXIpIHRoaXMuc2hhZG93U3ByaXRlLnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgICAvL+W9k+OBn+OCiuWIpOWumue1kOaenOWPjeaYoFxuICAgICAgICB0aGlzLmNvbGxpc2lvblByb2Nlc3MoKTtcblxuICAgICAgICAvL+OBr+OBl+OBlOOBruOBv+WIpOWumlxuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZSA9PiB7XG4gICAgICAgICAgICAvL+air+WtkOWIpOWumlxuICAgICAgICAgICAgaWYgKGUudHlwZSA9PSBcImxhZGRlclwiIHx8IGUudHlwZSA9PSBcInN0YWlyc1wiKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGFkZGVyQ29sbGlzaW9uICYmIGUuaGl0VGVzdEVsZW1lbnQodGhpcy5sYWRkZXJDb2xsaXNpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPbkxhZGRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPblN0YWlycyA9IChlLnR5cGUgPT0gXCJzdGFpcnNcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+W9k+OBn+OCiuWIpOWumue1kOaenOWPjeaYoOWHpueQhlxuICAgIGNvbGxpc2lvblByb2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdyA9IE1hdGguZmxvb3IodGhpcy53aWR0aC8yKSs2O1xuICAgICAgICB2YXIgaCA9IE1hdGguZmxvb3IodGhpcy5oZWlnaHQvMikrNjtcbiAgICAgICAgdGhpcy5pc09uRmxvb3IgPSBmYWxzZTtcblxuICAgICAgICAvL+S4iuWBtOaOpeinplxuICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzBdLmhpdCAmJiAhdGhpcy5pc0NhdGNoTGFkZGVyKSB7XG4gICAgICAgICAgICB2YXIgcmV0ID0gdGhpcy5fY29sbGlzaW9uWzBdLmhpdDtcbiAgICAgICAgICAgIHRoaXMueSA9IHJldC55K3JldC5oZWlnaHQqKDEtcmV0Lm9yaWdpblkpK2g7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgIHRoaXMucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgaWYgKHJldC5jb2xsaXNpb25TY3JpcHQpIHtcbiAgICAgICAgICAgICAgICByZXQuY29sbGlzaW9uU2NyaXB0KHRoaXMsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8v5LiL5YG05o6l6KemXG4gICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMl0uaGl0ICYmICF0aGlzLmlzQ2F0Y2hMYWRkZXIpIHtcbiAgICAgICAgICAgIHZhciByZXQgPSB0aGlzLl9jb2xsaXNpb25bMl0uaGl0O1xuICAgICAgICAgICAgdGhpcy55ID0gcmV0LnktcmV0LmhlaWdodCpyZXQub3JpZ2luWS1oO1xuICAgICAgICAgICAgdGhpcy54ICs9IHJldC52eCB8fCAwO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzUGxheWVyICYmIHJldC52eSA+IDApIHRoaXMueSArPSByZXQudnkgfHwgMDtcblxuICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNPbkZsb29yID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZmxvb3JGcmljdGlvbiA9IHJldC5mcmljdGlvbiA9PSB1bmRlZmluZWQ/IDAuNTogcmV0LmZyaWN0aW9uO1xuXG4gICAgICAgICAgICB0aGlzLnRocm91Z2hGbG9vciA9IG51bGw7XG4gICAgICAgICAgICBpZiAodGhpcy5yZWJvdW5kID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLXRoaXMudnkgKiB0aGlzLnJlYm91bmQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnkgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yZXNldENvbGxpc2lvblBvc2l0aW9uKCk7XG4gICAgICAgICAgICBpZiAocmV0LmNvbGxpc2lvblNjcmlwdCkge1xuICAgICAgICAgICAgICAgIHJldC5jb2xsaXNpb25TY3JpcHQodGhpcywgMik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy/lj7PlgbTmjqXop6ZcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQgJiYgIXRoaXMuaXNDYXRjaExhZGRlcikge1xuICAgICAgICAgICAgdmFyIHJldCA9IHRoaXMuX2NvbGxpc2lvblsxXS5oaXQ7XG4gICAgICAgICAgICB0aGlzLnggPSByZXQueC1yZXQud2lkdGgqcmV0Lm9yaWdpblgtdztcbiAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgdGhpcy5yZXNldENvbGxpc2lvblBvc2l0aW9uKCk7XG4gICAgICAgICAgICBpZiAocmV0LmNvbGxpc2lvblNjcmlwdCkge1xuICAgICAgICAgICAgICAgIHJldC5jb2xsaXNpb25TY3JpcHQodGhpcywgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy/lt6blgbTmjqXop6ZcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQgJiYgIXRoaXMuaXNDYXRjaExhZGRlcikge1xuICAgICAgICAgICAgdmFyIHJldCA9IHRoaXMuX2NvbGxpc2lvblszXS5oaXQ7XG4gICAgICAgICAgICB0aGlzLnggPSByZXQueCtyZXQud2lkdGgqKDEtcmV0Lm9yaWdpblgpK3c7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgIHRoaXMucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgaWYgKHJldC5jb2xsaXNpb25TY3JpcHQpIHtcbiAgICAgICAgICAgICAgICByZXQuY29sbGlzaW9uU2NyaXB0KHRoaXMsIDMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+WcsOW9ouW9k+OBn+OCiuWIpOWumu+8iOeJueWumuWcsOeCueODgeOCp+ODg+OCr+OBruOBv++8ieihneeqgeOBl+OBn+OCguOBruOCkumFjeWIl+OBp+i/lOOBmVxuICAgIGNoZWNrTWFwQ29sbGlzaW9uMjogZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICB4ID0geCB8fCB0aGlzLng7XG4gICAgICAgIHkgPSB5IHx8IHRoaXMueTtcbiAgICAgICAgd2lkdGggPSB3aWR0aCB8fCAxO1xuICAgICAgICBoZWlnaHQgPSBoZWlnaHQgfHwgMTtcbiAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KHt3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0fSkuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgIHZhciByZXQgPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUudHlwZSA9PSBcImxhZGRlclwiIHx8IGUudHlwZSA9PSBcInN0YWlyc1wiKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoZS5oaXRUZXN0RWxlbWVudChjKSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXQgPT0gbnVsbCkgcmV0ID0gW107XG4gICAgICAgICAgICAgICAgcmV0LnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH0sXG5cbiAgICAvL+OCreODo+ODqeOCr+OCv+WQjOWjq+W9k+OBn+OCiuWIpOWumu+8iOODluODreODg+OCr+OBruOBv++8iVxuICAgIGNoZWNrQ2hhcmFjdGVyQ29sbGlzaW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlQ29sbGlzaW9uKSByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLmlzRHJvcCkgcmV0dXJuO1xuXG4gICAgICAgIHZhciByZXQgPSBbXTtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKCFlLmlzQmxvY2spIHJldHVybjtcbiAgICAgICAgICAgIGlmIChlLmlzRGVhZCkgcmV0dXJuO1xuXG4gICAgICAgICAgICAvL+S4iuWBtFxuICAgICAgICAgICAgaWYgKHRoYXQudnkgPCAwICYmIGUuaGl0VGVzdEVsZW1lbnQodGhhdC5fY29sbGlzaW9uWzBdKSkge1xuICAgICAgICAgICAgICAgIHRoYXQueSA9IGUueStlLmhlaWdodCooMS1lLm9yaWdpblkpKzE2O1xuICAgICAgICAgICAgICAgIHRoYXQudnkgPSAxO1xuICAgICAgICAgICAgICAgIHJldFswXSA9IGU7XG4gICAgICAgICAgICAgICAgdGhhdC5yZXNldENvbGxpc2lvblBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+S4i+WBtFxuICAgICAgICAgICAgaWYgKHRoYXQudnkgPiAwICYmIGUuaGl0VGVzdEVsZW1lbnQodGhhdC5fY29sbGlzaW9uWzJdKSkge1xuICAgICAgICAgICAgICAgIHRoYXQueSA9IGUueS1lLmhlaWdodCplLm9yaWdpblktMTY7XG4gICAgICAgICAgICAgICAgdGhhdC52eCA9IGUudng7XG4gICAgICAgICAgICAgICAgdGhhdC52eSA9IDA7XG4gICAgICAgICAgICAgICAgdGhhdC5pc0p1bXAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGF0LmlzT25GbG9vciA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhhdC50aHJvdWdoRmxvb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgIHJldFsyXSA9IGU7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQucmVib3VuZCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnZ5ID0gLXRoYXQudnkgKiB0aGF0LnJlYm91bmQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52eSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoYXQucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/lj7PlgbRcbiAgICAgICAgICAgIGlmICh0aGF0LnZ4ID4gMCAmJiBlLmhpdFRlc3RFbGVtZW50KHRoYXQuX2NvbGxpc2lvblsxXSkpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnggPSBlLngtZS53aWR0aCplLm9yaWdpblgtMTA7XG4gICAgICAgICAgICAgICAgdGhhdC52eCA9IDA7XG4gICAgICAgICAgICAgICAgcmV0WzFdID0gZTtcbiAgICAgICAgICAgICAgICB0aGF0LnJlc2V0Q29sbGlzaW9uUG9zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v5bem5YG0XG4gICAgICAgICAgICBpZiAodGhhdC52eCA8IDAgJiYgZS5oaXRUZXN0RWxlbWVudCh0aGF0Ll9jb2xsaXNpb25bM10pKSB7XG4gICAgICAgICAgICAgICAgdGhhdC54ID0gZS54K2Uud2lkdGgqKDEtZS5vcmlnaW5YKSsxMDtcbiAgICAgICAgICAgICAgICB0aGF0LnZ4ID0gMDtcbiAgICAgICAgICAgICAgICByZXRbM10gPSBlO1xuICAgICAgICAgICAgICAgIHRoYXQucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9LFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprnlKjjgqjjg6zjg6Hjg7Pjg4jjga7lho3oqK3lrppcbiAgICBzZXR1cENvbGxpc2lvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+W9k+OBn+OCiuWIpOWumueUqOOCqOODrOODoeODs+ODiOOBruS9jee9ruWGjeOCu+ODg+ODiFxuICAgIHJlc2V0Q29sbGlzaW9uUG9zaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdyA9IE1hdGguZmxvb3IodGhpcy53aWR0aC8yKSArIDYgKyB0aGlzLm9mZnNldENvbGxpc2lvblg7XG4gICAgICAgIHZhciBoID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodC8yKSsgNiArIHRoaXMub2Zmc2V0Q29sbGlzaW9uWTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzBdLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55IC0gaCk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblsxXS5zZXRQb3NpdGlvbih0aGlzLnggKyB3LCB0aGlzLnkpO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0uc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkgKyBoKTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzNdLnNldFBvc2l0aW9uKHRoaXMueCAtIHcsIHRoaXMueSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzEzLCAxNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzAsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFswXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFswLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0QW5pbWF0aW9uOiBmdW5jdGlvbihhbmltTmFtZSkge1xuICAgICAgICBpZiAoIXRoaXMuZnJhbWVbYW5pbU5hbWVdKSByZXR1cm47XG4gICAgICAgIGlmIChhbmltTmFtZSA9PSB0aGlzLm5vd0FuaW1hdGlvbikgcmV0dXJuO1xuICAgICAgICB0aGlzLm5vd0FuaW1hdGlvbiA9IGFuaW1OYW1lO1xuICAgICAgICB0aGlzLmluZGV4ID0gLTE7XG4gICAgICAgIHRoaXMuaXNDaGFuZ2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYvjgonjga7nm7Tnt5rot53pm6JcbiAgICBnZXREaXN0YW5jZVBsYXllcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB4ID0gdGhpcy54LXRoaXMucGFyZW50U2NlbmUucGxheWVyLng7XG4gICAgICAgIHZhciB5ID0gdGhpcy55LXRoaXMucGFyZW50U2NlbmUucGxheWVyLnk7XG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoeCp4K3kqeSk7XG4gICAgfSxcblxuICAgIC8v44Kq44OW44K444Kn44Kv44OI6ZaT44Gu55u057ea6Led6ZuiXG4gICAgZ2V0RGlzdGFuY2U6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHggPSB0aGlzLnggLSBlbGVtZW50Lng7XG4gICAgICAgIHZhciB5ID0gdGhpcy55IC0gZWxlbWVudC55O1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHgqeCt5KnkpO1xuICAgIH0sXG5cbiAgICAvL+iHquWIhuOBqOS7luOCqOODrOODoeODs+ODiOOCkue1kOOBtuebtOe3muOBruinkuW6pu+8iOW8p+W6puazle+8iVxuICAgIGdldEFuZ2xlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgIHZhciBwMiA9IHBoaW5hLmdlb20uVmVjdG9yMihlbGVtZW50LngsIGVsZW1lbnQueSk7XG4gICAgICAgIHZhciBwID0gcDIuc3ViKHAxKTtcbiAgICAgICAgcmV0dXJuIHAudG9EZWdyZWUoKTtcbiAgICB9LFxuXG4gICAgLy/oh6rliIbjgajku5bjgqjjg6zjg6Hjg7Pjg4jjgpLntZDjgbbnm7Tnt5rjga7op5LluqbvvIjjg6njgrjjgqLjg7PvvIlcbiAgICBnZXRBbmdsZVJhZGlhbjogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIoZWxlbWVudC54LCBlbGVtZW50LnkpO1xuICAgICAgICB2YXIgcCA9IHAyLnN1YihwMSk7XG4gICAgICAgIHJldHVybiBwLnRvQW5nbGUoKTtcbiAgICB9LFxuXG4gICAgLy/niannkIbnj77osaHmg4XloLHjga7jgb/jgqrjg5bjgrjjgqfjgq/jg4jjgaflj5blvpdcbiAgICBnZXRQaHlzaWNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZ4OiB0aGlzLnZ4LFxuICAgICAgICAgICAgdnk6IHRoaXMudnksXG4gICAgICAgICAgICBncmF2aXR5OiB0aGlzLmdyYXZpdHksXG4gICAgICAgICAgICBmcmljdGlvbjogdGhpcy5mcmljdGlvbixcbiAgICAgICAgICAgIHJlYm91bmQ6IHRoaXMucmVib3VuZCxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLy/np7vli5Xjg5Hjgrnjga7oqK3lrppcbiAgICBzZXRQYXRoOiBmdW5jdGlvbihwYXRoLCBsb29wKSB7XG4gICAgICAgIHRoaXMucGF0aCA9IFtdO1xuICAgICAgICB0aGlzLmxvb3AgPSBsb29wO1xuXG4gICAgICAgIC8v44OR44K55oOF5aCx44Gu5L2c5oiQXG4gICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICB2YXIgcHRiID0gbnVsbDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLnBvbHlsaW5lLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgcHQgPSBwaGluYS5nZW9tLlZlY3RvcjIocGF0aC54ICsgcGF0aC5wb2x5bGluZVtpXS54LCBwYXRoLnkgKyBwYXRoLnBvbHlsaW5lW2ldLnkpO1xuICAgICAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgc3VtICs9IE1hdGguZmxvb3IocHRiLmRpc3RhbmNlKHB0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwdC50aW1lID0gc3VtO1xuICAgICAgICAgICAgdGhpcy5wYXRoLnB1c2gocHQpO1xuICAgICAgICAgICAgcHRiID0gcHQ7XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODq+ODvOODl+acieOCiuaMh+WumuOBruWgtOWQiOOAgeWni+eCueOBruW6p+aomeOCkue1gueCueOBq+WKoOOBiOOCi1xuICAgICAgICBpZiAobG9vcCkge1xuICAgICAgICAgICAgdmFyIGVuZCA9IHBoaW5hLmdlb20uVmVjdG9yMihwYXRoLnggKyBwYXRoLnBvbHlsaW5lW3BhdGgucG9seWxpbmUubGVuZ3RoIC0gMV0ueCwgcGF0aC55ICsgcGF0aC5wb2x5bGluZVtwYXRoLnBvbHlsaW5lLmxlbmd0aCAtIDFdLnkpO1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHBhdGgueCArIHBhdGgucG9seWxpbmVbMF0ueCwgcGF0aC55ICsgcGF0aC5wb2x5bGluZVswXS55KTtcbiAgICAgICAgICAgIHN1bSArPSBNYXRoLmZsb29yKHN0YXJ0LmRpc3RhbmNlKGVuZCkpO1xuICAgICAgICAgICAgc3RhcnQudGltZSA9IHN1bTtcbiAgICAgICAgICAgIHRoaXMucGF0aC5wdXNoKHN0YXJ0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBhdGgubWF4VGltZSA9IHN1bTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/jg5HjgrnluqfmqJnjga7lj5blvpdcbiAgICBnZXRQYXRoUG9zaXRpb246IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLnBhdGggfHwgdGltZSA8IDApIHJldHVybiBudWxsO1xuICAgICAgICB0aW1lICU9IHRoaXMucGF0aC5tYXhUaW1lO1xuXG4gICAgICAgIHZhciBsZW4gPSB0aGlzLnBhdGgubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgcCA9IHRoaXMucGF0aFtpXTtcbiAgICAgICAgICAgIGlmICh0aW1lID09IHAudGltZSkgcmV0dXJuIHA7XG4gICAgICAgICAgICBpZiAodGltZSA8IHAudGltZSkge1xuICAgICAgICAgICAgICAgIHZhciBwMiA9IHRoaXMucGF0aFtpIC0gMV07XG4gICAgICAgICAgICAgICAgdmFyIHQgPSAodGltZSAtIHAyLnRpbWUpIC8gKHAudGltZSAtIHAyLnRpbWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwaGluYS5nZW9tLlZlY3RvcjIubGVycChwMiwgcCwgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlZmZlY3QuanNcbiAqICAyMDE3LzAxLzEyXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuRWZmZWN0XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnRcIixcblxuICAgIC8v44Kk44Oz44OH44OD44Kv44K55pu05paw6ZaT6ZqUXG4gICAgaW50ZXJ2YWw6IDIsXG5cbiAgICAvL+ePvuWcqOOCpOODs+ODh+ODg+OCr+OCuVxuICAgIGluZGV4OiAwLFxuXG4gICAgLy/plovlp4vjgqTjg7Pjg4fjg4Pjgq/jgrlcbiAgICBzdGFydEluZGV4OiAwLFxuXG4gICAgLy/mnIDlpKfjgqTjg7Pjg4fjg4Pjgq/jgrlcbiAgICBtYXhJbmRleDogOCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6YCy6KGM5Y+v6IO944OV44Op44KwICAgXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiB0cnVlLFxuXG4gICAgLy/ntYzpgY7jg5Xjg6zjg7zjg6BcbiAgICB0aW1lOiAwLFxuXG4gICAgZGVmYXVsdE9wdGlvbnM6IHtcbiAgICAgICAgbmFtZTogXCJleHBsb2RlXCIsXG4gICAgICAgIGFzc2V0TmFtZTogXCJlZmZlY3RcIixcbiAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgIHBvc2l0aW9uOiB7eDogMCwgeTogMH0sXG4gICAgICAgIG9yaWdpbjoge3g6IDAuNSwgeTogMC41fSxcbiAgICAgICAgcm90YXRpb246IDAsXG4gICAgICAgIGFscGhhOiAxLjAsXG4gICAgICAgIHNjYWxlOiB7eDogMS4wLCB5OiAxLjB9LFxuICAgICAgICBibGVuZE1vZGU6IFwic291cmNlLW92ZXJcIixcbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucy4kZXh0ZW5kKHFmdC5FZmZlY3REYXRhLmdldCh0aGlzLm9wdGlvbnMubmFtZSkpO1xuICAgICAgICB0aGlzLnNldHVwKCk7XG5cbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lICUgdGhpcy5pbnRlcnZhbCA9PSAwICYmIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUuZnJhbWVJbmRleCsrO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNwcml0ZS5mcmFtZUluZGV4ID09IDAgfHwgdGhpcy5zcHJpdGUuZnJhbWVJbmRleCA9PSB0aGlzLm1heEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUuZnJhbWVJbmRleCA9IHRoaXMuc3RhcnRJbmRleDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYW5pbWF0aW9uZW5kJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2V0dXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgb3AgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUob3AuYXNzZXROYW1lLCBvcC53aWR0aCwgb3AuaGVpZ2h0KVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKG9wLnBvc2l0aW9uLngsIG9wLnBvc2l0aW9uLnkpXG4gICAgICAgICAgICAuc2V0T3JpZ2luKG9wLm9yaWdpbi54LCBvcC5vcmlnaW4ueSlcbiAgICAgICAgICAgIC5zZXRTY2FsZShvcC5zY2FsZS54LCBvcC5zY2FsZS55KVxuICAgICAgICAgICAgLnNldFJvdGF0aW9uKG9wLnJvdGF0aW9uKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIGlmIChvcC50cmltbWluZykge1xuICAgICAgICAgICAgdmFyIHQgPSBvcC50cmltbWluZztcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcodC54LCB0LnksIHQud2lkdGgsIHQuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0YXJ0SW5kZXggPSBvcC5zdGFydEluZGV4O1xuICAgICAgICB0aGlzLm1heEluZGV4ID0gb3AubWF4SW5kZXg7XG4gICAgICAgIHRoaXMuc3ByaXRlLmFscGhhID0gb3AuYWxwaGE7XG4gICAgICAgIHRoaXMuc3ByaXRlLmZyYW1lSW5kZXggPSB0aGlzLnN0YXJ0SW5kZXg7XG4gICAgfSxcbn0pO1xuXG5waGluYS5kZWZpbmUoXCJxZnQuRWZmZWN0RGF0YVwiLCB7XG4gICAgX3N0YXRpYzoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJleHBsb2RlX3NtYWxsXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTYsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4OiA4LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDE1LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAyNTYsIHk6IDI1Niwgd2lkdGg6IDEyOCwgaGVpZ2h0OiAzMn0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImV4cGxvZGVfc21hbGwyXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTYsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmltbWluZzoge3g6IDI1NiwgeTogMjU2LCB3aWR0aDogMTI4LCBoZWlnaHQ6IDMyfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZXhwbG9kZVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDY0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA2NCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA4LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAwLCB5OiAwLCB3aWR0aDogNTEyLCBoZWlnaHQ6IDEyOH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImV4cGxvZGVfbGFyZ2VcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiA0OCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDgsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogNyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1taW5nOiB7eDogMCwgeTogMCwgd2lkdGg6IDUxMiwgaGVpZ2h0OiAxMjh9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJleHBsb2RlX2dyb3VuZFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDMyLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA0OCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiA0LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA3LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAyNTYsIHk6IDE5Miwgd2lkdGg6IDI1NiwgaGVpZ2h0OiA0OH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInNtb2tlX3NtYWxsXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTYsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmltbWluZzoge3g6IDEyOCwgeTogMTI4LCB3aWR0aDogNjQsIGhlaWdodDogMTZ9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzbW9rZVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDI0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAyNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAxMjgsIHk6IDE2MCwgd2lkdGg6IDEyMCwgaGVpZ2h0OiAyNH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInNtb2tlX2xhcmdlXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMzIsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDgsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmltbWluZzoge3g6IDI1NiwgeTogMTI4LCB3aWR0aDogMTI4LCBoZWlnaHQ6IDY0fSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiaGl0XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldE5hbWU6IFwiZWZmZWN0MlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDcyLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAzMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAwLCB5OiAwLCB3aWR0aDogNzIsIGhlaWdodDogMTI4fSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuanNcbiAqICAyMDE2LzEyLzMxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+aVteOCreODo+ODqeOCr+OCv+WfuuacrOOCr+ODqeOCuVxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNFbmVteTogdHJ1ZSxcblxuICAgIC8v44Os44OZ44OrXG4gICAgbGV2ZWw6IDAsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAwLFxuXG4gICAgLy/np7vli5XpgJ/luqZcbiAgICBzcGVlZDogMSxcblxuICAgIC8v5rCX57W256K6546HXG4gICAgc3R1blBvd2VyOiAxLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMCxcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA5MCxcblxuICAgIC8v6YCy6KGM5pa55ZCR77yIMDrlj7MgMTgwOuW3piAyNzA65LiKIDkwOuS4i++8iVxuICAgIGRpcmVjdGlvbjogMCxcblxuICAgIC8v44Od44Kk44Oz44OIXG4gICAgcG9pbnQ6IDAsXG5cbiAgICAvL+aUu+aSg+W9k+OBn+OCiuWIpOWumuacieWKueODleODqeOCsFxuICAgIGlzRW5hYmxlQXR0YWNrQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/jgrnjg7zjg5Hjg7zjgqLjg7zjg57jg7znirbmhYvjg5Xjg6njgrBcbiAgICBpc1N1cGVyQXJtb3I6IGZhbHNlLFxuXG4gICAgLy/lvbHooajnpLrjg5Xjg6njgrBcbiAgICBpc1NoYWRvdzogdHJ1ZSxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlU2xhc2g6IDEsXG4gICAgZGFtYWdlU3Rpbmc6IDEsXG4gICAgZGFtYWdlQmxvdzogMSxcbiAgICBkYW1hZ2VBcnJvdzogMSxcbiAgICBkYW1hZ2VGaXJlOiAxLFxuICAgIGRhbWFnZUljZTogMSxcbiAgICBkYW1hZ2VIb2x5OiAxLFxuICAgIGRhbWFnZURhcms6IDEsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0NPSU4sXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMCxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fQkFHLFxuXG4gICAgLy/ooYzli5Xjg5Hjgr/jg7zjg7PnlKhcbiAgICBjaGFzZVRpbWU6IDAsXG4gICAgdHVyblRpbWU6IDAsXG4gICAgc3RvcFRpbWU6IDAsXG4gICAgdHVybkNvdW50OiAwLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5zZXR1cEFuaW1hdGlvbigpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmxldmVsID0gb3B0aW9ucy5sZXZlbCB8fCAwO1xuICAgICAgICB0aGlzLnRlcnJpdG9yeSA9IG9wdGlvbnMudGVycml0b3J5O1xuXG4gICAgICAgIC8v44OH44OQ44OD44Kw5pmC6KaW55WM44Gu5Y+v6KaW5YyWXG4gICAgICAgIGlmIChERUJVR19FWUVTSUdIVCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIHZhID0gKHRoaXMudmlld0FuZ2xlIC8gMikudG9SYWRpYW4oKTtcbiAgICAgICAgICAgIHBoaW5hLmRpc3BsYXkuQXJjU2hhcGUoe3JhZGl1czogdGhpcy5leWVzaWdodCwgc3RhcnRBbmdsZTogLXZhLCBlbmRBbmdsZTogdmF9KS5hZGRDaGlsZFRvKHRoaXMpLnNldEFscGhhKDAuMyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9uKCdlbnRlcmZyYW1lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnRTY2VuZS5wYXVzZVNjZW5lKSByZXR1cm47XG4gICAgICAgICAgICAvL+eUu+mdouWkluOBruWgtOWQiOOBr+WLleS9nOWBnOatolxuICAgICAgICAgICAgaWYgKCF0aGlzLm9uU2NyZWVuKSByZXR1cm47XG5cbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuXG4gICAgICAgICAgICAvL+WQkeOBjeOBruaMh+WumlxuICAgICAgICAgICAgaWYgKHRoaXMudnggIT0gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZ4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IDE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44K544OG44O844K444Kv44Oq44Ki44Gu5aC05ZCI44Gv5b2T44Gf44KK5Yik5a6a54Sh44GXXG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnRTY2VuZS5pc1N0YWdlQ2xlYXIpIHJldHVybjtcblxuICAgICAgICAgICAgLy/msJfntbbkuK3jga/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PjgZfjgarjgYRcbiAgICAgICAgICAgIGlmICh0aGlzLmlzU3R1bikge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/ooqvjg4Djg6Hjg7zjgrjlvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIGlmICghdGhpcy5pc011dGVraSAmJiB0aGlzLm11dGVraVRpbWUgPT0gMCkge1xuICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O85pS75pKD44Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICAgICAgaWYgKHBsLmlzQXR0YWNrICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQocGwuYXR0YWNrQ29sbGlzaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhbWFnZShwbC5hdHRhY2tDb2xsaXNpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCt+ODp+ODg+ODiOOBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuaGl0KHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGFtYWdlKGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIGlmICh0aGlzLmlzRW5hYmxlQXR0YWNrQ29sbGlzaW9uICYmIHRoaXMubXV0ZWtpVGltZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzRGVhZCAmJiAhcGwuaXNEZWFkICYmIHRoaXMucG93ZXIgPiAwICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQocGwpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGl0KCk7XG4gICAgICAgICAgICAgICAgICAgIHBsLmRhbWFnZSh0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnN0b3BUaW1lID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFsZ29yaXRobSgpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHRoaXMuY2hhc2VUaW1lLS07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudHVyblRpbWUgPiAwKSB0aGlzLnR1cm5UaW1lLS07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMub24oJ2RlYWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v56K65a6a44OJ44Ot44OD44OX44Ki44Kk44OG44OgXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLml0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25JdGVtKHRoaXMueCwgdGhpcy55LCB7a2luZDogdGhpcy5vcHRpb25zLml0ZW19KTtcbiAgICAgICAgICAgICAgICBpLnZ5ID0gLTU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pdGVtID09IFwia2V5XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaS5pc0VuZW15RHJvcCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGkuaXNFbmVteURyb3AgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v44Os44Ki44Ki44Kk44OG44Og44OJ44Ot44OD44OX5Yik5a6aXG4gICAgICAgICAgICB2YXIgZGljZSA9IE1hdGgucmFuZGludCgxLCAxMDApO1xuICAgICAgICAgICAgaWYgKGRpY2UgPD0gdGhpcy5yYXJlRHJvcFJhdGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25JdGVtKHRoaXMueCwgdGhpcy55LCB7a2luZDogdGhpcy5yYXJlRHJvcEl0ZW19KTtcbiAgICAgICAgICAgICAgICBpLnZ5ID0gLTU7XG4gICAgICAgICAgICAgICAgaS5pc0VuZW15RHJvcCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v6YCa5bi444Ki44Kk44OG44Og44OJ44Ot44OD44OX5Yik5a6aXG4gICAgICAgICAgICAgICAgdmFyIGRpY2UgPSBNYXRoLnJhbmRpbnQoMSwgMTAwKTtcbiAgICAgICAgICAgICAgICBpZiAoZGljZSA8PSB0aGlzLmRyb3BSYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkl0ZW0odGhpcy54LCB0aGlzLnksIHtraW5kOiB0aGlzLmRyb3BJdGVtfSk7XG4gICAgICAgICAgICAgICAgICAgIGkudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgaS5pc0VuZW15RHJvcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIGRhbWFnZTogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIGlmICh0aGlzLm11dGVraVRpbWUgPiAwKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmlzTXV0ZWtpKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgLy/msJfntbbjgq3jg6Pjg7Pjgrvjg6tcbiAgICAgICAgdGhpcy5pc1N0dW4gPSBmYWxzZTtcblxuICAgICAgICB2YXIgZGlyID0gMDtcbiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIHFmdC5QbGF5ZXJBdHRhY2spIHtcbiAgICAgICAgICAgIGlmICh0YXJnZXQuc2NhbGVYID09IDEpIGRpciA9IDA7IGVsc2UgZGlyID0gMTgwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA+IHRhcmdldC54KSBkaXIgPSAwOyBlbHNlIGRpciA9IDE4MDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwb3dlciA9IHRhcmdldC5wb3dlcjtcbiAgICAgICAgaWYgKHRhcmdldC5pc1NsYXNoKSBwb3dlciAqPSB0aGlzLmRhbWFnZVNsYXNoO1xuICAgICAgICBpZiAodGFyZ2V0LmlzU3RpbmcpIHBvd2VyICo9IHRoaXMuZGFtYWdlU3Rpbmc7XG4gICAgICAgIGlmICh0YXJnZXQuaXNCbG93KSBwb3dlciAqPSB0aGlzLmRhbWFnZUJsb3c7XG4gICAgICAgIGlmICh0YXJnZXQuaXNBcnJvdykgcG93ZXIgKj0gdGhpcy5kYW1hZ2VBcnJvdztcbiAgICAgICAgaWYgKHRhcmdldC5pc0ZpcmUpIHBvd2VyICo9IHRoaXMuZGFtYWdlRmlyZTtcbiAgICAgICAgaWYgKHRhcmdldC5pc0ljZSkgcG93ZXIgKj0gdGhpcy5kYW1hZ2VJY2U7XG4gICAgICAgIGlmICh0YXJnZXQuaXNIb2x5KSBwb3dlciAqPSB0aGlzLmRhbWFnZUhvbHk7XG4gICAgICAgIGlmICh0YXJnZXQuaXNEYXJrKSBwb3dlciAqPSB0aGlzLmRhbWFnZURhcms7XG4gICAgICAgIHBvd2VyID0gTWF0aC5mbG9vcihwb3dlcik7XG4gICAgICAgIGlmICghdGhpcy5pc1N1cGVyQXJtb3IpIHRoaXMua25vY2tiYWNrKHBvd2VyLCBkaXIpO1xuICAgICAgICB0aGlzLm11dGVraVRpbWUgPSAxMDtcbiAgICAgICAgdGhpcy5ocCAtPSBwb3dlcjtcbiAgICAgICAgaWYgKHRoaXMuaHAgPD0gMCkge1xuICAgICAgICAgICAgdGhpcy5ocCA9IDA7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnRvdGFsU2NvcmUgKz0gdGhpcy5wb2ludDtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUudG90YWxLaWxsKys7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdkZWFkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdkYW1hZ2VkJywge2RpcmVjdGlvbjogZGlyfSk7XG5cbiAgICAgICAgICAgIC8v5rCX57W25Yik5a6aXG4gICAgICAgICAgICB2YXIgZGljZSA9IE1hdGgucmFuZGludCgxLCAxMDApO1xuICAgICAgICAgICAgaWYgKGRpY2UgPD0gdGFyZ2V0LnN0dW5Qb3dlcikgdGhpcy5mbGFyZSgnc3R1bicsIHtwb3dlcjogdGFyZ2V0LnBvd2VyfSk7XG4gICAgICAgIH1cbiAgICAgICAgYXBwLnBsYXlTRShcImhpdFwiKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O844GM6KaL44GI44KL5L2N572u44Gr44GE44KL44Gu44GL5Yik5a6aXG4gICAgaXNMb29rUGxheWVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/oppblipvlpJbjga7loLTlkIjjga/opovjgYjjgarjgYRcbiAgICAgICAgaWYgKHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKSA+IHRoaXMuZXllc2lnaHQpIHJldHVybiBmYWxzZTtcblxuICAgICAgICAvL+imlumHjuinkuWkluOBruWgtOWQiOOBr+imi+OBiOOBquOBhFxuICAgICAgICBpZiAodGhpcy52aWV3QW5nbGUgIT0gMzYwKSB7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBruinkuW6pu+8iOWPs+OBjDM2MOW6pu+8iVxuICAgICAgICAgICAgdmFyIGFuZ2xlID0gTWF0aC5mbG9vcih0aGlzLmdldFBsYXllckFuZ2xlKCkpO1xuXG4gICAgICAgICAgICAvL+imlueVjOevhOWbsuWGheOBruWIpOWumlxuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgdmEgPSB0aGlzLnZpZXdBbmdsZSAvIDI7XG4gICAgICAgICAgICAgICAgaWYgKCEoMzYwLXZhIDwgYW5nbGUgfHwgYW5nbGUgPCB2YSkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGRpciA9IHRoaXMuZGlyZWN0aW9uO1xuICAgICAgICAgICAgICAgIHZhciB2YSA9IHRoaXMudmlld0FuZ2xlIC8gMjtcbiAgICAgICAgICAgICAgICBpZiAoIShkaXItdmEgPCBhbmdsZSAmJiBhbmdsZSA8IGRpcit2YSkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZXN1bHQgPSB0cnVlO1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jb2xsaXNpb25MYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLnR5cGUgPT0gXCJsYWRkZXJcIiB8fCB0aGlzLnR5cGUgPT0gXCJzdGFpcnNcIikgcmV0dXJuO1xuICAgICAgICAgICAgLy/oh6rliIbjgajjg5fjg6zjgqTjg6Tjg7zplpPjgavpga7olL3nianvvIjlnLDlvaLlvZPjgorliKTlrprvvInjgYzjgYLjgovloLTlkIjopovjgYjjgarjgYRcbiAgICAgICAgICAgIGlmIChwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0UmVjdExpbmUoZSwgdGhhdCwgcGxheWVyKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuXG4gICAgLy/oh6rliIbjgajjg5fjg6zjgqTjg6Tjg7zjgpLntZDjgbbnm7Tnt5rjga7op5LluqbvvIjlvKfluqbms5XvvIlcbiAgICBnZXRQbGF5ZXJBbmdsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgIHZhciBwMiA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLnBhcmVudFNjZW5lLnBsYXllci54LCB0aGlzLnBhcmVudFNjZW5lLnBsYXllci55KTtcbiAgICAgICAgdmFyIHAgPSBwMi5zdWIocDEpO1xuICAgICAgICByZXR1cm4gcC50b0RlZ3JlZSgpO1xuICAgIH0sXG5cbiAgICAvL+iHquWIhuOBqOODl+ODrOOCpOODpOODvOOCkue1kOOBtuebtOe3muOBruinkuW6pu+8iOODqeOCuOOCouODs++8iVxuICAgIGdldFBsYXllclJhZGlhbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgIHZhciBwMiA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLnBhcmVudFNjZW5lLnBsYXllci54LCB0aGlzLnBhcmVudFNjZW5lLnBsYXllci55KTtcbiAgICAgICAgdmFyIHAgPSBwMi5zdWIocDEpO1xuICAgICAgICByZXR1cm4gcC50b0FuZ2xlKCk7XG4gICAgfSxcblxuICAgIC8v5L2T5Yqb44Ky44O844K46Kit572uXG4gICAgc2V0dXBMaWZlR2F1Z2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIC8v5L2T5Yqb44Ky44O844K4XG4gICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgd2lkdGg6ICAzMixcbiAgICAgICAgICAgIGhlaWdodDogMixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIGZpbGw6ICdyZWQnLFxuICAgICAgICAgICAgc3Ryb2tlOiAnd2hpdGUnLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG4gICAgICAgICAgICBnYXVnZUNvbG9yOiAnbGltZScsXG4gICAgICAgICAgICBjb3JuZXJSYWRpdXM6IDAsXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5ocCxcbiAgICAgICAgICAgIG1heFZhbHVlOiB0aGlzLmhwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmxpZmVHYXVnZSA9IHBoaW5hLnVpLkdhdWdlKG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oMCwgMCk7XG4gICAgICAgIHRoaXMubGlmZUdhdWdlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gKHRoYXQuaHAgIT0gdGhpcy5tYXhWYWx1ZSk7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhhdC5ocDtcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSAtdGhhdC5yb3RhdGlvbjtcbiAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gdGhhdC5zY2FsZVg7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmRpc3BUaW1lID4gMTUwKSB0aGlzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0aGlzLmJlZm9yZVZhbHVlID09IHRoaXMudmFsdWUpIHRoaXMuZGlzcFRpbWUrKzsgZWxzZSB0aGlzLmRpc3BUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuYmVmb3JlVmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmxpZmVHYXVnZS5kaXNwVGltZSA9IDA7XG4gICAgfSxcblxuICAgIGhpdDogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIC8v5rGO55So5b6A5b6p44Ki44Or44K044Oq44K644Og77yI6Zm45LiK77yJXG4gICAgcm91bmR0cmlwQWxnb3JpdGhtX2dyb3VuZDogZnVuY3Rpb24oZGlzLCBsb29rKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICBpZiAoZGlzID09PSB1bmRlZmluZWQpIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgaWYgKGxvb2sgPT09IHVuZGVmaW5lZCkgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+W0luOBo+OBt+OBoeOBp+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/lo4HjgavlvZPjgZ/jgaPjgZ/jgonmipjjgorov5TjgZlcbiAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMV0uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OG44Oq44OI44Oq44O85oyH5a6aXG4gICAgICAgICAgICBpZiAoIWxvb2sgJiYgdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAvL+awtOW5s+aWueWQkeOBruOBv+ODgeOCp+ODg+OCr1xuICAgICAgICAgICAgICAgIHZhciB0eCA9IHRoaXMueCAtIHRoaXMuZmlyc3RYO1xuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyh0eCkgPiB0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgdGhpcy52eCA9ICB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDE4MCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggKj0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/msY7nlKjlvoDlvqnjgqLjg6vjgrTjg6rjgrrjg6DvvIjnqbrkuK3vvIlcbiAgICByb3VuZHRyaXBBbGdvcml0aG1fZmx5aW5nOiBmdW5jdGlvbihkaXMsIGxvb2spIHtcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIGlmIChkaXMgPT09IHVuZGVmaW5lZCkgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICBpZiAobG9vayA9PT0gdW5kZWZpbmVkKSBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICB2YXIgY2hrMSA9IDE7XG4gICAgICAgIHZhciBjaGsyID0gMztcbiAgICAgICAgaWYgKHRoaXMudmVydGljYWwpIHtcbiAgICAgICAgICAgIGNoazEgPSAwO1xuICAgICAgICAgICAgY2hrMiA9IDI7XG4gICAgICAgIH1cbiAgICAgICAgLy/lo4HjgavlvZPjgZ/jgaPjgZ/jgonmipjjgorov5TjgZlcbiAgICAgICAgdmFyIHR1cm4gPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvbltjaGsxXS5oaXQgfHwgdGhpcy5fY29sbGlzaW9uW2NoazJdLmhpdCkgdHVybiA9IHRydWU7XG5cbiAgICAgICAgLy/jg4bjg6rjg4jjg6rjg7zmjIflrppcbiAgICAgICAgaWYgKCFsb29rICYmIHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICBpZiAodGhpcy52ZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgIC8v5Z6C55u05pa55ZCR44OB44Kn44OD44KvXG4gICAgICAgICAgICAgICAgdmFyIHR5ID0gdGhpcy55IC0gdGhpcy5maXJzdFk7XG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHR5KSA+IHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMjcwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSA5MDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy/msLTlubPmlrnlkJHjg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgICAgICB2YXIgdHggPSB0aGlzLnggLSB0aGlzLmZpcnN0WDtcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnModHgpID4gdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/msY7nlKjov73ot6HjgqLjg6vjgrTjg6rjgrrjg6BcbiAgICBjaGFzZUFsZ29yaXRobTogZnVuY3Rpb24oZGlzLCBsb29rKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICBpZiAoZGlzID09PSB1bmRlZmluZWQpIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgaWYgKGxvb2sgPT09IHVuZGVmaW5lZCkgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozkuIDlrprmmYLplpPov73ot6HjgZnjgotcbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCAmJiAhdGhpcy5pc0F0dGFjayAmJiB0aGlzLnR1cm5UaW1lID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50dXJuVGltZSA9IDE1O1xuICAgICAgICAgICAgaWYgKGxvb2spIHRoaXMudHVybkNvdW50ID0gMDtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844KS6KaL5aSx44Gj44Gf54q25oWL44Gn5LiJ5Zue5oyv44KK6L+U44Gj44Gf5aC05ZCI44Gv6L+96Leh57WC5LqGXG4gICAgICAgICAgICBpZiAodGhpcy50dXJuQ291bnQgPiAzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJzdFggPSB0aGlzLng7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJzdFkgPSB0aGlzLnk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmZpcnN0WCA9IHRoaXMueDtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RZID0gdGhpcy55O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pc0p1bXApIHRoaXMudnggKj0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDEyMDtcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDApIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+ODhuODquODiOODquODvOaMh+WumlxuICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDAgJiYgdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAvL+awtOW5s+aWueWQkeOBruOBv+ODgeOCp+ODg+OCr1xuICAgICAgICAgICAgICAgIHZhciB0eCA9IHRoaXMueCAtIHRoaXMuZmlyc3RYO1xuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyh0eCkgPiB0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jgZPjgozku6XkuIrpgLLjgoHjgarjgYTloLTlkIjjga/mipjjgorov5TjgZlcbiAgICAgICAgICAgIHZhciBpc1JldHVybldhbGwgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBpc1JldHVybkNsaWZmID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkgaXNSZXR1cm5XYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkgaXNSZXR1cm5DbGlmZiA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudnggPCAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCB8fCBpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOi/vei3oeS4reOBp+auteW3ruOBjOOBguOCi+WgtOWQiOOBr+mjm+OBs+i2iuOBiOOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5XYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOi/vei3oeS4reOBp+W0luOBjOOBguOCi+WgtOWQiOOBr+edgOWcsOeCueOBjOOBguOCi+OBi+iqv+OBueOBpumjm+OBs+mZjeOCiuOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGp1bXBPayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzMyLCB0aGlzLnkrMzIsIDE2LCA5NikpIHtqdW1wT2sgPSB0cnVlOyB0aGlzLnZ5ID0gLTc7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrMzIsIHRoaXMueS0zMiwgMTYsIDk2KSkge2p1bXBPayA9IHRydWU7IHRoaXMudnkgPSAtMTA7fVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTMyLCB0aGlzLnkrMzIsIDE2LCA5NikpIHtqdW1wT2sgPSB0cnVlOyB0aGlzLnZ5ID0gLTc7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtMzIsIHRoaXMueS0zMiwgMTYsIDk2KSkge2p1bXBPayA9IHRydWU7IHRoaXMudnkgPSAtMTA7fVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp1bXBPaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nnYDlnLDngrnjgYznhKHjgYTloLTlkIjjga/oq6bjgoHjgabmipjjgorov5TjgZlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDQ1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIi4uLlwifSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJzdFggPSB0aGlzLng7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJzdFkgPSB0aGlzLnk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAzMCkge1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgICAgICAgICAgdGhpcy5maXJzdFggPSB0aGlzLng7XG4gICAgICAgICAgICB0aGlzLmZpcnN0WSA9IHRoaXMueTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ipleS+oemWouaVsFxuICAgIGV2YWx1YXRlOiBmdW5jdGlvbihkaXMsIGxvb2spIHtcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIGlmIChkaXMgPT09IHVuZGVmaW5lZCkgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICBpZiAobG9vayA9PT0gdW5kZWZpbmVkKSBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICAvL+iEheWogeW6plxuICAgICAgICB2YXIgdGhyZWF0ID0gMDtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembouOBq+OCiOOCiuiEheWogeW6puOCkuWKoOeul1xuICAgICAgICBpZiAoZGlzIDwgMjU2KSB0aHJlYXQgKz0gMTBcbiAgICAgICAgaWYgKGRpcyA8IDEyOCkgdGhyZWF0ICs9IDIwXG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zoppboqo3lj6/og73nirbmhYtcbiAgICAgICAgaWYgKGxvb2spIHRocmVhdCArPSAzMDtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOihjOWLleeKtuaFi1xuICAgICAgICB2YXIgcGxheWVyQWN0aW9uID0gXCJcIjtcbiAgICAgICAgaWYgKHBsLnggPT0gcGwuYmVmb3JlLnggJiYgcGwueSA9PSBwbC5iZWZvcmUueSkge1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjga/np7vli5XjgZfjgabjgYTjgarjgYRcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86YCy6KGM5pa55ZCR77yI5Y+zOjAg5bemOjE4MO+8iVxuICAgICAgICAgICAgdmFyIHBsZGlyID0gMDtcbiAgICAgICAgICAgIGlmIChwbC54IDwgcGwuYmVmb3JlLngpIHBsZGlyID0gMTgwO1xuICAgICAgICAgICAgaWYgKHRoaXMueCA8IHBsLngpIHtcbiAgICAgICAgICAgICAgICBpZiAocHJkaXIgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBr+i/keOBpeOBhOOBpuOBhOOCi1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Gv6Zui44KM44Gm44GE44KLXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAocHJkaXIgPT0gMTgwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Gv6L+R44Gl44GE44Gm44GE44KLXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjga/pm6LjgozjgabjgYTjgotcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGhyZWF0OiB0aHJlYXQsXG4gICAgICAgICAgICBwbGF5ZXJBY3Rpb246IHBsYXllckFjdGlvbixcbiAgICAgICAgfTtcbiAgICB9LFxufSk7XG5cbi8v5pW15pS75pKD5Yik5a6aXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXlBdHRhY2tcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZVwiLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMSxcblxuICAgIC8v5pyJ5Yq544OV44Op44KwXG4gICAgaXNBY3RpdmU6IHRydWUsXG5cbiAgICAvL+Wvv+WRvVxuICAgIGxpZmVTcGFuOiAxNSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUoe3dpZHRoOiAzMiwgaGVpZ2h0OiAzMn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuXG4gICAgICAgIHRoaXMuJGV4dGVuZChvcHRpb25zKTtcbiAgICAgICAgdGhpcy50aW1lID0gMDtcblxuICAgICAgICB0aGlzLm9uKCdlbnRlcmZyYW1lJywgZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRpbWUrKztcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgPiB0aGlzLmxpZmVTcGFuKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNBY3RpdmUpIHJldHVybjtcbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaUu+aSg+OBqOW9k+OBn+OBo+OBn+WgtOWQiOOBr+OCqOODleOCp+OCr+ODiOOCkuWHuuOBl+OBpueEoeWKueWMllxuICAgICAgICAgICAgaWYgKHBsLmlzQXR0YWNrICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQocGwuYXR0YWNrQ29sbGlzaW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBY3RpY2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1bXAoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844K344On44OD44OI44Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5zbmFwKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBlLmlzQ29sbGlzaW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIGlmICghcGwuaXNEZWFkICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQocGwpKSB7XG4gICAgICAgICAgICAgICAgcGwuZGFtYWdlKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSB7XG4gICAgICAgICAgICBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogdGhpcy53aWR0aCwgaGVpZ2h0OiB0aGlzLmhlaWdodH0pLmFkZENoaWxkVG8odGhpcykuc2V0QWxwaGEoMC41KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+WIpOWumuWQjOWjq+OBjOOBtuOBpOOBi+OBo+OBn+WgtOWQiOOBruWHpueQhlxuICAgIGJ1bXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRWZmZWN0KHRoaXMueCwgdGhpcy55LCB7bmFtZTogXCJoaXRcIn0pO1xuICAgICAgICBpZiAodGhpcy5tYXN0ZXIpIHtcbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgcGwua25vY2tiYWNrKDUsIHRoaXMubWFzdGVyLmRpcmVjdGlvbik7XG4gICAgICAgICAgICB0aGlzLm1hc3Rlci5rbm9ja2JhY2soNSwgKHRoaXMubWFzdGVyLmRpcmVjdGlvbiArIDE4MCkgJSAzNjApO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInRpbmtsaW5nXCIpO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBpdGVtLmpzXG4gKiAgMjAxNy8wMS8wNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqLjgqTjg4bjg6Djgq/jg6njgrlcbnBoaW5hLmRlZmluZShcInFmdC5JdGVtXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNJdGVtOiB0cnVlLFxuXG4gICAgLy/jgqLjgqTjg4bjg6DnqK7liKVcbiAgICBraW5kOiAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg6zjg5njg6tcbiAgICBsZXZlbDogMCxcblxuICAgIC8v5o2o44Gm44Ki44Kk44OG44OgXG4gICAgdGhyb3dBd2F5OiBmYWxzZSxcblxuICAgIC8v5aSn44G+44GL44Gq56iu5Yil44OV44Op44KwXG4gICAgaXNXZWFwb246IGZhbHNlLFxuICAgIGlzRXF1aXA6IGZhbHNlLFxuICAgIGlzRm9vZDogZmFsc2UsXG4gICAgaXNJdGVtOiBmYWxzZSxcbiAgICBpc0tleTogZmFsc2UsXG5cbiAgICAvL+aVteODieODreODg+ODl+OCouOCpOODhuODoOODleODqeOCsFxuICAgIGlzRW5lbXlEcm9wOiBmYWxzZSxcblxuICAgIC8v44Ki44Kk44OG44Og5oOF5aCxXG4gICAgc3RhdHVzOiBudWxsLFxuXG4gICAgLy/lj43nmbrkv4LmlbBcbiAgICByZWJvdW5kOiAwLjMsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mAsuihjOWPr+iDveODleODqeOCsCAgIFxuICAgIGlzQWR2YW5jZUFuaW1hdGlvbjogZmFsc2UsXG5cbiAgICAvL+W9seihqOekuuODleODqeOCsFxuICAgIGlzU2hhZG93OiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG5cbiAgICAgICAgLy/jgqLjgqTjg4bjg6Djg6zjg5njg6tcbiAgICAgICAgdGhpcy5sZXZlbCA9IDA7XG4gICAgICAgIHRoaXMua2luZCA9IG51bGw7XG4gICAgICAgIGlmIChvcHRpb25zLnByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIHRoaXMubGV2ZWwgPSBvcHRpb25zLnByb3BlcnRpZXMubGV2ZWwgfHwgMDtcbiAgICAgICAgICAgIHRoaXMua2luZCA9IG9wdGlvbnMucHJvcGVydGllcy5raW5kO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmtpbmQgIT09IHVuZGVmaW5lZCkgdGhpcy5raW5kID0gb3B0aW9ucy5raW5kO1xuXG4gICAgICAgIC8v44Ki44Kk44OG44Og56iu5YilXG4gICAgICAgIGlmICh0aGlzLmtpbmQgPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubmFtZSA9PSBcImZvb2RcIikge1xuICAgICAgICAgICAgICAgIHRoaXMua2luZCA9IElURU1fQVBQTEUgKyB0aGlzLmxldmVsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IFwiSVRFTV9cIitvcHRpb25zLm5hbWUudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmtpbmQgPSBldmFsKG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0aGlzLmtpbmQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHZhciBuYW1lID0gXCJJVEVNX1wiK3RoaXMua2luZC50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgdGhpcy5raW5kID0gZXZhbChuYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44Ki44Kk44OG44Og44K544OG44O844K/44K55Y+W5b6XXG4gICAgICAgIHRoaXMuJGV4dGVuZChxZnQuSXRlbUluZm8uZ2V0KHRoaXMua2luZCkpO1xuXG4gICAgICAgIC8v44Ki44Kk44OG44Og44K544OX44Op44Kk44OIXG4gICAgICAgIGlmICh0aGlzLmlzV2VhcG9uKSB7XG4gICAgICAgICAgICAvL+atpuWZqOOBruWgtOWQiFxuICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5raW5kICogMTAgKyBNYXRoLm1pbih0aGlzLmxldmVsLCB0aGlzLm1heEluZGV4KTtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KGluZGV4KTtcblxuICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWwgPiAwKSB7XG4gICAgICAgICAgICAgICAgLy/lvLfljJbjg6zjg5njg6vooajnpLpcbiAgICAgICAgICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiK1wiK3RoaXMubGV2ZWx9LiRzYWZlKGxhYmVsUGFyYW0pKS5zZXRQb3NpdGlvbig2LCA2KS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIml0ZW1cIiwgMjQsIDI0KS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgodGhpcy5raW5kKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5a+/5ZG9XG4gICAgICAgIHRoaXMubGlmZVNwYW4gPSAxNTA7XG5cbiAgICAgICAgLy/jgqLjgq/jg4bjgqPjg5bjg5Xjg6njgrBcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hY3RpdmUgPT09IHVuZGVmaW5lZCB8fCB0aGlzLm9wdGlvbnMuYWN0aXZlID09IHRydWUpIHtcbiAgICAgICAgICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGUgPT4ge1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgaWYgKHRoaXMuaGl0VGVzdEVsZW1lbnQocGwpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGltZSA+IDEwICYmICF0aGlzLnRocm93QXdheSkge1xuICAgICAgICAgICAgICAgICAgICBwbC5nZXRJdGVtKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy50aW1lID4gMzAgJiYgdGhpcy50aHJvd0F3YXkpIHRoaXMudGhyb3dBd2F5ID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzRW5lbXlEcm9wKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGlmZVNwYW4gPT0gMCkgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5saWZlU3BhbiA8IDMwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAyID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmxpZmVTcGFuIDwgNjApe1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lICUgNSA9PSAwKSB0aGlzLnZpc2libGUgPSAhdGhpcy52aXNpYmxlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDkwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAxMCA9PSAwKSB0aGlzLnZpc2libGUgPSAhdGhpcy52aXNpYmxlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmxpZmVTcGFuLS07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG59KTtcblxucGhpbmEuZGVmaW5lKFwicWZ0Lkl0ZW1JbmZvXCIsIHtcbiAgICBfc3RhdGljOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oa2luZCkge1xuICAgICAgICAgICAgc3dpdGNoIChraW5kKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInNob3J0c3dvcmRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fU0hPUlRTV09SRDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiU0hPUlQgU1dPUkRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3dvcmRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzV2VhcG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTbGFzaDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDE0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMzBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwibG9uZ3N3b3JkXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0xPTkdTV09SRDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiTE9ORyBTV09SRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzd29yZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNXZWFwb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1NsYXNoOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDE1LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1blBvd2VyOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDcsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAyNVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJheFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9BWDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQVhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYXhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzV2VhcG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTbGFzaDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQnJvdzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxNCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDI2XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInNwZWFyXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1NQRUFSOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJTUEVBUlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzcGVhclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNXZWFwb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1N0aW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1blBvd2VyOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMzksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJib3dcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQk9XOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJCT1dcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYm93XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1dlYXBvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQnJvdzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1blBvd2VyOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJyb2RcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fUk9EOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJNQUdJQyBST0RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwicm9kXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1dlYXBvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQnJvdzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRmlyZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1blBvd2VyOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA3LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYm9va1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9CT09LOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJCT09LXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvb2tcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzV2VhcG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNCcm93OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNIb2x5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R1blBvd2VyOiA0MCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic2hpZWxkXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1NISUVMRDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiU0hJRUxEXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVxdWlwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VxdWlwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDEwMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImFybW9yXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0FSTU9SOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJBUk1PUlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJlcXVpcFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNFcXVpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAzMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiA1MDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJoYXRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fSEFUOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJIQVRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZXF1aXBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRXF1aXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMzAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJib290c1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9CT09UUzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQk9PVFNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZXF1aXBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRXF1aXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogNTAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJncm92ZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9HUk9WRTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiR1JPVkVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZXF1aXBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRXF1aXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogNTAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJyaW5nXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1JJTkc6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlJJTkdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZXF1aXBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRXF1aXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMzAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic2Nyb2xsXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1NDUk9MTDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiU0NST0xMXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAxMDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJsZXR0ZXJcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fTEVUVEVSOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJMRVRURVJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaXRlbVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNJdGVtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY2FyZFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9DQVJEOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJDQVJEXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAxMDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJrZXlcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fS0VZOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJLRVlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwia2V5XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0tleTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAyMDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjb2luXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0NPSU46XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkNPSU5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaXRlbVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNJdGVtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDUwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYmFnXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0JBRzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQkFHXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAxMDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJvcmJcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fT1JCOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJPUkJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaXRlbVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNJdGVtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDUwMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInN0b25lXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1NUT05FOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJTVE9ORVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpdGVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0l0ZW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMjAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiamV3ZWxcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fSkVXRUw6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkpFV0VMXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiA1MDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJqZXdlbGJveFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9KRVdFTEJPWDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiSkVXRUxCT1hcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaXRlbVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNJdGVtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDEwMDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJhcHBsZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9BUFBMRTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQVBQTEVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZm9vZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNGb29kOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDIwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJoYXJiXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0hBUkI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkhBUkJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZm9vZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNGb29kOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDQwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJtZWF0XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX01FQVQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIk1FQVRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZm9vZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNGb29kOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDYwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJwb3Rpb25cIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fUE9USU9OOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJQT1RJT05cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZm9vZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNGb29kOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgfSxcbn0pO1xuXG4iLCIvKlxuICogIGl0ZW1ib3guanNcbiAqICAyMDE3LzAxLzA0XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCouOCpOODhuODoOODnOODg+OCr+OCueOCr+ODqeOCuVxucGhpbmEuZGVmaW5lKFwicWZ0Lkl0ZW1Cb3hcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgLy/orZjliKXjg5Xjg6njgrBcbiAgICBpc0l0ZW1Cb3g6IHRydWUsXG5cbiAgICAvL+iAkOS5heWKm1xuICAgIGhwOiAxLFxuXG4gICAgLy/plovjgYTjgZ/jg5Xjg6njgrBcbiAgICBvcGVuZWQ6IGZhbHNlLFxuXG4gICAgLy/jgqLjgqTjg4bjg6DnqK7liKVcbiAgICBraW5kOiAwLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PplpPpmpRcbiAgICBhbmltYXRpb25JbnRlcnZhbDogMyxcblxuICAgIC8v5Y+N55m65L+C5pWwXG4gICAgcmVib3VuZDogMC4zLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHt3aWR0aDogMjYsIGhlaWdodDogMjZ9LiRzYWZlKG9wdGlvbnMucHJvcGVydGllcykpO1xuXG4gICAgICAgIC8v44Ki44Kk44OG44Og44Oc44OD44Kv44K544K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJpdGVtYm94XCIsIDMyLCAzMilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMC44KVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoMCk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJjbG9zZVwiKTtcblxuICAgICAgICAvL+WGheWuueeJqVxuICAgICAgICB0aGlzLm5hbWUgPSBvcHRpb25zLm5hbWU7XG4gICAgICAgIHRoaXMua2luZCA9IG9wdGlvbnMucHJvcGVydGllcz8gb3B0aW9ucy5wcm9wZXJ0aWVzLmtpbmQ6IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sZXZlbCA9IG9wdGlvbnMucHJvcGVydGllcz8gb3B0aW9ucy5wcm9wZXJ0aWVzLmxldmVsOiAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMub3BlbmVkKSB7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaUu+aSg++8iOWbuuWumu+8ieOBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICBpZiAocGwuaXNBdHRhY2sgJiYgdGhpcy5oaXRUZXN0RWxlbWVudChwbC5hdHRhY2tDb2xsaXNpb24pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYW1hZ2UocGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmlLvmkoPliKTlrprjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBxZnQuUGxheWVyQXR0YWNrICYmIGUuaXNDb2xsaXNpb24gJiYgdGhpcy5oaXRUZXN0RWxlbWVudChlKSkge1xuICAgICAgICAgICAgICAgICAgICBlLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhbWFnZShlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7ICAgIC8v54K55ruF44Kt44Oj44Oz44K744OrXG4gICAgfSxcblxuICAgIGRhbWFnZTogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIGlmICh0aGlzLm9wZW5lZCkgcmV0dXJuO1xuICAgICAgICB0aGlzLmhwIC09IHRhcmdldC5wb3dlcjtcbiAgICAgICAgdGhpcy5tdXRla2lUaW1lID0gMTA7XG4gICAgICAgIGlmICh0aGlzLmhwIDw9IDApIHtcbiAgICAgICAgICAgIHRoaXMub3BlbigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnggPCB0YXJnZXQueCkge1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5jbGVhcigpLm1vdmVCeSgtNSwgMCwgMikubW92ZUJ5KDUsIDAsIDIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5jbGVhcigpLm1vdmVCeSg1LCAwLCAyKS5tb3ZlQnkoLTUsIDAsIDIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9wZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IHRydWU7XG4gICAgICAgIHRoaXMub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJvcGVuXCIpO1xuICAgICAgICBzd2l0Y2ggKHRoaXMubmFtZSkge1xuICAgICAgICAgICAgY2FzZSBcImVtcHR5XCI6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiaXRlbVwiOlxuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC53YWl0KDEwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ6IHRoaXMua2luZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsOiB0aGlzLmxldmVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkl0ZW0odGhpcy54LCB0aGlzLnksIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaS52eSA9IC01O1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogdGhpcy5sZXZlbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25JdGVtKHRoaXMueCwgdGhpcy55LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGkudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb2xvciA9PSBcImdvbGRcIikge1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlXCJdID0gWzJdO1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5cIl0gPSBbMiwgNiwgOCwgXCJzdG9wXCJdO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5jb2xvciA9PSBcInJlZFwiKSB7XG4gICAgICAgICAgICB0aGlzLmZyYW1lW1wiY2xvc2VcIl0gPSBbMV07XG4gICAgICAgICAgICB0aGlzLmZyYW1lW1wib3BlblwiXSA9IFsxLCA0LCA3LCBcInN0b3BcIl07XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLmNvbG9yID09IFwiYmx1ZVwiKSB7XG4gICAgICAgICAgICB0aGlzLmZyYW1lW1wiY2xvc2VcIl0gPSBbMF07XG4gICAgICAgICAgICB0aGlzLmZyYW1lW1wib3BlblwiXSA9IFswLCAzLCA2LCBcInN0b3BcIl07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZyYW1lW1wiY2xvc2VcIl0gPSBbMV07XG4gICAgICAgICAgICB0aGlzLmZyYW1lW1wib3BlblwiXSA9IFsxLCA0LCA3LCBcInN0b3BcIl07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QuanNcbiAqICAyMDE3LzAxLzE0XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5xZnQuTWFwT2JqZWN0ID0gcWZ0Lk1hcE9iamVjdCB8fCB7fTtcblxuLy/jg4Hjgqfjg4Pjgq/jgqLjgqTjgrPjg7NcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuQ2hlY2tJY29uXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMC4wLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PplpPpmpRcbiAgICBhbmltYXRpb25JbnRlcnZhbDogMyxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHt3aWR0aDogMzYsIGhlaWdodDogNjR9KTtcbiAgICAgICAgdGhpcy4kc2FmZShvcHRpb25zKTtcblxuICAgICAgICAvL+OCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiY2hlY2tpY29uXCIsIDMyLCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGUpIHtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiaW5cIl0gPSBbMiwgMSwgMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9IFs1LCA0LCAzXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbOCwgNywgNl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJvdXRcIl0gPSBbMTEsIDEwLCA5XTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuXG4vL+ODoeODg+OCu+ODvOOCuOihqOekulxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5NZXNzYWdlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnRcIixcblxuICAgIC8v44Kq44OW44K444Kn44Kv44OISURcbiAgICBpZDogbnVsbCxcblxuICAgIC8v5LiA5Zue44Gu44G/6KGo56S644OV44Op44KwXG4gICAgb25jZTogZmFsc2UsXG5cbiAgICAvL+ihqOekuua4iOOBv+ODleODqeOCsFxuICAgIGFscmVhZHlSZWFkOiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkO1xuICAgICAgICB0aGlzLm9uY2UgPSBvcHRpb25zLnByb3BlcnRpZXMub25jZSB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy50ZXh0ID0gb3B0aW9ucy5wcm9wZXJ0aWVzLnRleHQgfHwgXCJURVNUXCI7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGhpdCA9IHRoaXMuaGl0VGVzdEVsZW1lbnQocGwpO1xuICAgICAgICBpZiAoaGl0ICYmICF0aGlzLmFscmVhZHlSZWFkKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRXZlbnRNZXNzYWdlKHRoaXMuaWQsIHRoaXMudGV4dCk7XG4gICAgICAgICAgICB0aGlzLmFscmVhZHlSZWFkID0gdHJ1ZTtcblxuICAgICAgICAgICAgLy/kuIDlm57jga7jgb/jga7loLTlkIjjga/jg6rjg6Djg7zjg5ZcbiAgICAgICAgICAgIGlmICh0aGlzLm9uY2UpIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WIpOWumuOCkuWkluOCjOOBn+OCieihqOekuua4iOOBv+ODleODqeOCsOOCkuWkluOBmVxuICAgICAgICBpZiAoIWhpdCAmJiB0aGlzLmFscmVhZHlSZWFkKSB0aGlzLmFscmVhZHlSZWFkID0gZmFsc2U7XG4gICAgfSxcbn0pO1xuXG4vL+OCpOODmeODs+ODiFxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5FdmVudFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICAvL+OCquODluOCuOOCp+OCr+ODiElEXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+S4gOWbnuOBruOBv+ihqOekuuODleODqeOCsFxuICAgIG9uY2U6IGZhbHNlLFxuXG4gICAgLy/lrp/ooYzmuIjjgb/jg5Xjg6njgrBcbiAgICBhbHJlYWR5OiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkO1xuICAgICAgICB0aGlzLm9uY2UgPSBvcHRpb25zLnByb3BlcnRpZXMub25jZSB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gb3B0aW9ucy5wcm9wZXJ0aWVzO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBoaXQgPSB0aGlzLmhpdFRlc3RFbGVtZW50KHBsKTtcbiAgICAgICAgaWYgKGhpdCAmJiAhdGhpcy5hbHJlYWR5UmVhZCkge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkV2ZW50TWVzc2FnZSh0aGlzLmlkLCB0aGlzLnRleHQpO1xuICAgICAgICAgICAgdGhpcy5hbHJlYWR5ID0gdHJ1ZTtcblxuICAgICAgICAgICAgLy/kuIDlm57jga7jgb/jga7loLTlkIjjga/jg6rjg6Djg7zjg5ZcbiAgICAgICAgICAgIGlmICh0aGlzLm9uY2UpIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WIpOWumuOCkuWkluOCjOOBn+OCieWun+ihjOa4iOOBv+ODleODqeOCsOOCkuWkluOBmVxuICAgICAgICBpZiAoIWhpdCAmJiB0aGlzLmFscmVhZHkpIHRoaXMuYWxyZWFkeVJlYWQgPSBmYWxzZTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHBsYXllci5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5QbGF5ZXJcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgLy/orZjliKXjg5Xjg6njgrBcbiAgICBpc1BsYXllcjogdHJ1ZSxcblxuICAgIC8v5pyA5aSn44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHBNYXg6IDEwMCxcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/msJfntbbnorrnjodcbiAgICBzdHVuUG93ZXI6IDEsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmVuc2U6IDEwLFxuXG4gICAgLy/np7vli5XpgJ/luqZcbiAgICBzcGVlZDogNSxcblxuICAgIC8v55m75Z2C6YCf5bqmXG4gICAgc3BlZWRBc2NlbmQ6IDQsXG5cbiAgICAvL+S4i+aKvOOBl+mAo+e2muODleODrOODvOODoOaVsFxuICAgIGRvd25GcmFtZTogMCxcblxuICAgIC8v5aSa5q6144K444Oj44Oz44OX5Y+v6IO95Zue5pWwXG4gICAgbnVtSnVtcDogMCxcbiAgICBudW1KdW1wTWF4OiAxLFxuXG4gICAgLy/miYDmjIHoo4XlgpnjgqLjgqTjg4bjg6BcbiAgICBlcXVpcDogbnVsbCxcblxuICAgIC8v44Ki44Kk44OG44Og5omA5oyB5pyA5aSn5pWwXG4gICAgbWF4SXRlbTogMTAsXG5cbiAgICAvL+aJgOaMgeOCouOCpOODhuODoFxuICAgIGl0ZW1zOiBudWxsLFxuXG4gICAgLy/miYDmjIHjgq/jg6rjgqLmnaHku7bjgq3jg7xcbiAgICBrZXlzOiBudWxsLFxuXG4gICAgLy/mk43kvZzlj6/og73jg5Xjg6njgrBcbiAgICBpc0NvbnRyb2w6IHRydWUsXG5cbiAgICAvL+aUu+aSg+S4reODleODqeOCsFxuICAgIGlzQXR0YWNrOiBmYWxzZSxcblxuICAgIC8v6Ziy5b6h5Lit44OV44Op44KwXG4gICAgaXNEZWZlbnNlOiBmYWxzZSxcblxuICAgIC8v44OJ44Ki5LiK44OV44Op44KwXG4gICAgaXNPbkRvb3I6IGZhbHNlLFxuXG4gICAgLy/jg4Djg5/jg7zooajnpLrjgrnjg5fjg6njgqTjg4hcbiAgICBkdW1teTogbnVsbCxcblxuICAgIC8v5b2x6KGo56S644OV44Op44KwXG4gICAgaXNTaGFkb3c6IHRydWUsXG5cbiAgICAvL+OCquODvOODiOODkeOCpOODreODg+ODiFxuICAgIGlzQXV0bzogZmFsc2UsXG4gICAgYXV0b0tleToge1xuICAgICAgICB1cDogZmFsc2UsXG4gICAgICAgIHJpZ2h0OiBmYWxzZSxcbiAgICAgICAgZG93bjogZmFsc2UsXG4gICAgICAgIGxlZnQ6IGZhbHNlLFxuICAgICAgICBhdHRhY2s6IGZhbHNlLFxuICAgICAgICBqdW1wOiBmYWxzZSxcbiAgICB9LFxuXG4gICAgLy/liY3jg5Xjg6zjg7zjg6Djga7mg4XloLFcbiAgICBiZWZvcmU6IHtcbiAgICAgICAgLy/mk43kvZzns7tcbiAgICAgICAgdXA6IGZhbHNlLFxuICAgICAgICBkb3duOiBmYWxzZSxcbiAgICAgICAgYXR0YWNrOiBmYWxzZSxcbiAgICAgICAganVtcDogZmFsc2UsXG4gICAgICAgIGNoYW5nZTogZmFsc2UsXG4gICAgICAgIGlzU3R1bjogZmFsc2UsXG4gICAgICAgIGlzT25GbG9vcjogZmFsc2UsXG4gICAgICAgIHg6IDAsXG4gICAgICAgIHk6IDAsXG4gICAgfSxcblxuICAgIC8v44K544OG44O844K46ZaL5aeL5pmC44K544OG44O844K/44K5XG4gICAgc3RhcnRTdGF0dXM6IG51bGwsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwge3dpZHRoOiAxNiwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4jog4zlvoxcbiAgICAgICAgdGhpcy5iYWNrID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcykuc2V0U2NhbGUoLTEsIDEpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJwbGF5ZXIxXCIsIDMyLCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDApO1xuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVggPSAtMTtcblxuICAgICAgICAvL+atpuWZqOeUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLndlYXBvbiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLmJhY2spXG4gICAgICAgICAgICAuc2V0RnJhbWVJbmRleCgwKVxuICAgICAgICAgICAgLnNldE9yaWdpbigxLCAxKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKDMsIDMpO1xuICAgICAgICB0aGlzLndlYXBvbi5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMud2VhcG9uLnR5cGUgPSBcInN3b3JkXCI7XG5cbiAgICAgICAgLy/nm75cbiAgICAgICAgdGhpcy5zaGllbGQgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIml0ZW1cIiwgMjQsIDI0KVxuLy8gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoNylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigxMCwgNilcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjgpXG4gICAgICAgICAgICAuc2V0VmlzaWJsZShmYWxzZSk7XG5cbiAgICAgICAgLy/mlLvmkoPliKTlrprnlKhcbiAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMTQsIGhlaWdodDogMjZ9KTtcbiAgICAgICAgLy/lvZPjgZ/jgorliKTlrprjg4fjg5Djg4PjgrDnlKhcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikge1xuICAgICAgICAgICAgdGhpcy5vbmUoJ2VudGVyZnJhbWUnLCBlID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFja0NvbGxpc2lvbi5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUucGxheWVyTGF5ZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrQ29sbGlzaW9uLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLm9uKCdyZW1vdmVkJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24ucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCx44Gu5Yid5pyf5YyWXG4gICAgICAgIHRoaXMucmVzZXQoKTtcblxuICAgICAgICAvL+OBr+OBl+OBlOWIpOWumueUqFxuICAgICAgICB0aGlzLmxhZGRlckNvbGxpc2lvbiA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAxNiwgaGVpZ2h0OiAyMH0pO1xuXG4gICAgICAgIC8v5Yid5pyf44Ki44OL44Oh44O844K344On44Oz6Kit5a6aXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5iZWZvcmVBbmltYXRpb24gPSBcIlwiO1xuXG4gICAgICAgIC8v5q275Lqh5pmC44Kz44O844Or44OQ44OD44KvXG4gICAgICAgIHRoaXMub24oJ2RlYWQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmZsYXJlKCdnYW1lb3ZlcicpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+aZguOCueODhuODvOOCv+OCuVxuICAgICAgICB0aGlzLnNhdmVTdGF0dXMoKTtcblxuICAgICAgICAvL+acgOW+jOOBq+W6iuS4iuOBq+OBhOOBn+WgtOaJgOOCkuS/neWtmFxuICAgICAgICB0aGlzLmxhc3RPbkZsb29yWCA9IDA7XG4gICAgICAgIHRoaXMubGFzdE9uRmxvb3JZID0gMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgaWYgKHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSkgcmV0dXJuO1xuXG4gICAgICAgIC8v44Kq44OW44K444Kn44Kv44OI44Os44Kk44Ok44O85o6l6Kem5Yik5a6aXG4gICAgICAgIHRoaXMuaXNPbkRvb3IgPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLm9iakxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgLy/miYnliKTlrppcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0Lk1hcE9iamVjdC5Eb29yIHx8IGUgaW5zdGFuY2VvZiBxZnQuTWFwT2JqZWN0LkdhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS5oaXRUZXN0RWxlbWVudCh0aGlzKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT25Eb29yID0gZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAvL+atu+S6oeaZguOBr+S9leOCguWHuuadpeOBquOBhFxuICAgICAgICBpZiAodGhpcy5pc0RlYWQpIHtcbiAgICAgICAgICAgIC8v44Oe44OD44OX5aSW6JC95LiLXG4gICAgICAgICAgICBpZiAodGhpcy5pc0Ryb3ApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhwID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImRyb3BcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuLy8gICAgICAgIHRoaXMuc2hpZWxkLnNldFZpc2libGUoZmFsc2UpO1xuLy8gICAgICAgIHRoaXMuaXNEZWZlbnNlID0gZmFsc2U7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmk43kvZxcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIC8v44OQ44O844OB44Oj44Or44OR44OD44OJ5oOF5aCx5Y+W5b6XXG4gICAgICAgIHZhciB2cCA9IGFwcC52aXJ0dWFsUGFkO1xuICAgICAgICBpZiAodnAuZ2V0S2V5KFwidXBcIikpIGN0LnVwID0gdHJ1ZTtcbiAgICAgICAgaWYgKHZwLmdldEtleShcInJpZ2h0XCIpKSBjdC5yaWdodCA9IHRydWU7XG4gICAgICAgIGlmICh2cC5nZXRLZXkoXCJkb3duXCIpKSBjdC5kb3duID0gdHJ1ZTtcbiAgICAgICAgaWYgKHZwLmdldEtleShcImxlZnRcIikpIGN0LmxlZnQgPSB0cnVlO1xuICAgICAgICBpZiAodnAuZ2V0S2V5KFwiWlwiKSkgY3QuYXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgaWYgKHZwLmdldEtleShcIlhcIikpIGN0Lmp1bXAgPSB0cnVlO1xuXG4gICAgICAgIC8v44Kq44O844OI44OR44Kk44Ot44OD44OIXG4gICAgICAgIGlmICh0aGlzLmlzQXV0bykge1xuICAgICAgICAgICAgY3QgPSB0aGlzLmF1dG9LZXk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuaXNDb250cm9sKSBjdCA9IHt9O1xuICAgICAgICBpZiAodGhpcy5zdG9wVGltZSA9PSAwKSB7XG4gICAgICAgICAgICAvL+W3puenu+WLlVxuICAgICAgICAgICAgaWYgKGN0LmxlZnQgJiYgIWN0LmRvd24pIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNKdW1wICYmICF0aGlzLmlzQXR0YWNrICYmICF0aGlzLmlzQ2F0Y2hMYWRkZXIpIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgICAgICAvL+OBr+OBl+OBlOaOtOOBv+eKtuaFi+OBp+W3puOBq+WjgeOBjOOBguOCi+WgtOWQiOOBr+S4jeWPr1xuICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5fY29sbGlzaW9uWzNdO1xuICAgICAgICAgICAgICAgIGlmICghKHRoaXMuaXNDYXRjaExhZGRlciAmJiB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMihjLngrNiwgYy55LCBjLndpZHRoLCBjLmhlaWdodCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAtdGhpcy5zcGVlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+WPs+enu+WLlVxuICAgICAgICAgICAgaWYgKGN0LnJpZ2h0ICYmICFjdC5kb3duKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzSnVtcCAmJiAhdGhpcy5pc0F0dGFjayAmJiAhdGhpcy5pc0NhdGNoTGFkZGVyKSB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgICAgICAgICAgLy/jga/jgZfjgZTmjrTjgb/nirbmhYvjgaflj7Pjgavlo4HjgYzjgYLjgovloLTlkIjjga/kuI3lj69cbiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2NvbGxpc2lvblsxXTtcbiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLmlzQ2F0Y2hMYWRkZXIgJiYgdGhpcy5jaGVja01hcENvbGxpc2lvbjIoYy54LTYsIGMueSwgYy53aWR0aCwgYy5oZWlnaHQpKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSB0aGlzLnNwZWVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/poK3kuIrotrPlhYPjga/jgZfjgZTmpJznn6VcbiAgICAgICAgICAgIHZhciBoZWFkTGFkZGVyID0gdGhpcy5jaGVja0hlYWRMYWRkZXIoKTtcbiAgICAgICAgICAgIHZhciBmb290TGFkZGVyID0gdGhpcy5jaGVja0Zvb3RMYWRkZXIoKTtcblxuICAgICAgICAgICAgLy/jga/jgZfjgZTmjrTjgb/nirbmhYvjgafmk43kvZzliIblspBcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2F0Y2hMYWRkZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3QudXApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtdGhpcy5zcGVlZEFzY2VuZDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLl9jb2xsaXNpb25bMF07XG4gICAgICAgICAgICAgICAgICAgIGlmICghaGVhZExhZGRlciAmJiB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMihjLngsIGMueS02LCBjLndpZHRoLCBjLmhlaWdodCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjdC5kb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gdGhpcy5zcGVlZEFzY2VuZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v44K444Oj44Oz44OX44Oc44K/44Oz44Gu44G/XG4gICAgICAgICAgICAgICAgaWYgKGN0Lmp1bXAgJiYgIWN0LnVwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44K444Oj44Oz44OX5LqM5q6155uu5Lul6ZmNXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzSnVtcCAmJiB0aGlzLm51bUp1bXAgPCB0aGlzLm51bUp1bXBNYXggJiYgdGhpcy52eSA+IC01KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTExO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1KdW1wKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/jgrjjg6Pjg7Pjg5dcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoayA9IHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCwgdGhpcy55LTE2LCA1LCAzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzSnVtcCAmJiB0aGlzLmlzT25GbG9vciAmJiAhY2hrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImp1bXBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTExO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1KdW1wID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL+S4iuOCreODvOaKvOS4i1xuICAgICAgICAgICAgICAgIGlmIChjdC51cCkge1xuICAgICAgICAgICAgICAgICAgICAvL+OCuOODo+ODs+ODl+S6jOauteebruS7pemZjVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0p1bXAgJiYgdGhpcy5udW1KdW1wIDwgdGhpcy5udW1KdW1wTWF4ICYmIHRoaXMudnkgPiAtNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubnVtSnVtcCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v44K444Oj44Oz44OXXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGsgPSB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngsIHRoaXMueS0xNiwgNSwgMyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0p1bXAgJiYgdGhpcy5pc09uRmxvb3IgJiYgIXRoaXMuaXNPbkxhZGRlciAmJiAhY2hrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImp1bXBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTExO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1KdW1wID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL+OBr+OBl+OBlOOCkuaYh+OCi++8iOmajuauteOBr+aOpeWcsOaZguOBruOBv++8iVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc09uTGFkZGVyICYmICF0aGlzLmlzT25TdGFpcnMgfHwgdGhpcy5pc09uRmxvb3IgJiYgdGhpcy5pc09uU3RhaXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNDYXRjaExhZGRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRocm91Z2hGbG9vciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/miYnjgavlhaXjgovvvIjmjqXlnLDmmYLvvIblt6blj7Pjgq3jg7zjgqrjg5XmmYLjga7jgb/vvIlcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdC5sZWZ0ICYmICFjdC5yaWdodCAmJiB0aGlzLmlzT25GbG9vciAmJiB0aGlzLmlzT25Eb29yICYmICF0aGlzLmlzT25Eb29yLmlzTG9jayAmJiAhdGhpcy5pc09uRG9vci5hbHJlYWR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09uRG9vci5mbGFyZSgnZW50ZXJkb29yJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT25Eb29yLmFscmVhZHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL+S4i+OCreODvOaKvOS4i1xuICAgICAgICAgICAgICAgIGlmIChjdC5kb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44Gv44GX44GU44KS6ZmN44KK44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChmb290TGFkZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNDYXRjaExhZGRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRocm91Z2hGbG9vciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/luorjgrnjg6vjg7xcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZG93bkZyYW1lID4gNiAmJiAhdGhpcy5qdW1wICYmICFmb290TGFkZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgJiYgIXRoaXMudGhyb3VnaEZsb29yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZsb29yID0gdGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LCB0aGlzLnkrMTYsIDUsIDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmbG9vciAmJiBmbG9vclswXS5lbmFibGVUaHJvdWdoKSB0aGlzLnRocm91Z2hGbG9vciA9IGZsb29yWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v55u+44KS5qeL44GI44KLXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0F0dGFjaykge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNoaWVsZC5zZXRWaXNpYmxlKHRydWUpO1xuLy8gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRGVmZW5zZSA9IHRydWU7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwiZGVmZW5zZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgLy/jga/jgZfjgZTjgYvjgonlpJbjgozjgZ/jgonmoq/lrZDmjrTjgb/nirbmhYvjgq3jg6Pjg7Pjgrvjg6tcbiAgICAgICAgaWYgKHRoaXMuaXNDYXRjaExhZGRlcikge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzT25MYWRkZXIgJiYgIWN0LmRvd24gfHwgdGhpcy5pc09uTGFkZGVyICYmICFmb290TGFkZGVyICYmICFjdC51cCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNDYXRjaExhZGRlciA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgaWYgKCF0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub3dBbmltYXRpb24gIT0gXCJkYW1hZ2VcIiAmJiAhdGhpcy5pc0RlZmVuc2UpIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0NhdGNoTGFkZGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGN0LnVwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdC5kb3duKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT25TdGFpcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwiZG93blwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc1N0dW4gJiYgIXRoaXMuaXNEZWFkKSB0aGlzLnNldEFuaW1hdGlvbihcImp1bXBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3QuYXR0YWNrICYmICF0aGlzLmJlZm9yZS5hdHRhY2sgJiYgdGhpcy5zdG9wVGltZSA9PSAwICYmICEodGhpcy5pc0NhdGNoTGFkZGVyICYmIHRoaXMuaXNPbkxhZGRlcikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImF0dGFja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbkF0dGFjaygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+atpuWZqOOBruWkieabtFxuICAgICAgICAgICAgaWYgKGN0LmNoYW5nZSAmJiAhdGhpcy5iZWZvcmUuY2hhbmdlICYmIHRoaXMuZXF1aXAuc3dpdGNoT2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaFdlYXBvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/msJfntbbnirbmhYtcbiAgICAgICAgaWYgKHRoaXMuaXNTdHVuKSB7XG4gICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0dW5cIik7XG5cbiAgICAgICAgICAgIC8v5qKv5a2Q5o6044G/44Kt44Oj44Oz44K744OrXG4gICAgICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy/jg6zjg5Djgqzjg4Hjg6PjgafmsJfntbblvqnluLDjgpLml6njgoHjgotcbiAgICAgICAgICAgIGlmIChjdC5sZWZ0ICYmICFjdC5iZWZvcmUubGVmdCB8fFxuICAgICAgICAgICAgICAgIGN0LnJpZ2h0ICYmICFjdC5iZWZvcmUucmlnaHQgfHxcbiAgICAgICAgICAgICAgICBjdC51cCAmJiAhY3QuYmVmb3JlLnVwIHx8XG4gICAgICAgICAgICAgICAgY3QuZG93biAmJiAhY3QuYmVmb3JlLmRvd24pIHRoaXMuc3RvcFRpbWUgLT0gMjtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJlZm9yZS5pc1N0dW4pIHtcbiAgICAgICAgICAgIC8v5rCX57W25b6p5biw44GX44Gf44KJ44Ki44OL44Oh44O844K344On44Oz44KS5qiZ5rqW44GrXG4gICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0YW5kXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/mrbvkuqHnirbmhYtcbiAgICAgICAgaWYgKHRoaXMuaXNEZWFkKSB7XG4gICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImRlYWRcIik7XG4gICAgICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44Oz5aSJ5pu044KS5qSc55+lXG4gICAgICAgIGlmICh0aGlzLm5vd0FuaW1hdGlvbiAhPSB0aGlzLmJlZm9yZUFuaW1hdGlvbikge1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uID09IFwiYXR0YWNrXCIpIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAyO1xuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uID09IFwiZGVmZW5zZVwiKSB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8v5q2p6KGM44Ki44OL44Oh44O844K344On44Oz44Gu5aC05ZCI44Gv56e75YuV44GX44Gm44GE44KL5pmC44Gu44G/6YCy44KB44KLXG4gICAgICAgICAgICBpZiAodGhpcy5ub3dBbmltYXRpb24gPT0gXCJ3YWxrXCIgJiYgIWN0LmxlZnQgJiYgIWN0LnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uID09IFwidXBcIiB8fCB0aGlzLm5vd0FuaW1hdGlvbiA9PSBcImRvd25cIikge1xuICAgICAgICAgICAgICAgIGlmIChjdC51cCB8fCBjdC5kb3duIHx8IGN0LmxlZnQgfHwgY3QucmlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/mlLvmkoPliKTlrprov73lvpNcbiAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24ueCA9IHRoaXMueCArIHRoaXMuc2NhbGVYICogMTI7XG4gICAgICAgIHRoaXMuYXR0YWNrQ29sbGlzaW9uLnkgPSB0aGlzLnk7XG5cbiAgICAgICAgLy/jgrPjg7Pjg4jjg63jg7zjg6nku5bmg4XloLHkv53lrZhcbiAgICAgICAgdGhpcy5iZWZvcmUudXAgPSBjdC51cDtcbiAgICAgICAgdGhpcy5iZWZvcmUuZG93biA9IGN0LmRvd247XG4gICAgICAgIHRoaXMuYmVmb3JlLmF0dGFjayA9IGN0LmF0dGFjaztcbiAgICAgICAgdGhpcy5iZWZvcmUuanVtcCA9IGN0LnVwIHx8IGN0Lmp1bXA7XG4gICAgICAgIHRoaXMuYmVmb3JlLmNoYW5nZSA9IGN0LmNoYW5nZTtcbiAgICAgICAgdGhpcy5iZWZvcmUuaXNTdHVuID0gdGhpcy5pc1N0dW47XG4gICAgICAgIHRoaXMuYmVmb3JlLmluT25GbG9vciA9IHRoaXMuaXNPbkZsb29yO1xuICAgICAgICB0aGlzLmJlZm9yZS54ID0gdGhpcy54O1xuICAgICAgICB0aGlzLmJlZm9yZS55ID0gdGhpcy55O1xuXG4gICAgICAgIC8v44OA44Km44Oz44Kt44O86YCj57aa5oq85LiL44OV44Os44O844Og44Kr44Km44Oz44OIXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciAmJiAhdGhpcy5pc0NhdGNoTGFkZGVyICYmIGN0LmRvd24gJiYgIWN0LnJpZ2h0ICYmICFjdC5sZWZ0ICYmICFjdC51cCAmJiAhY3QuYXR0YWNrKSB7XG4gICAgICAgICAgICB0aGlzLmRvd25GcmFtZSsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kb3duRnJhbWUgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/mjqXlnLDmmYLluqfmqJnkv53lrZhcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yICYmIHRoaXMuX2NvbGxpc2lvblsyXS5oaXQudHlwZSAhPSBcIm1vdmVmbG9vclwiKSB7XG4gICAgICAgICAgICB0aGlzLmxhc3RPbkZsb29yWCA9IHRoaXMueDtcbiAgICAgICAgICAgIHRoaXMubGFzdE9uRmxvb3JZID0gdGhpcy55O1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCx44Oq44K744OD44OIXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+enu+WLleaDheWgsVxuICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgdGhpcy52eSA9IDA7XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgr/jgrlcbiAgICAgICAgdGhpcy5ocCA9IHRoaXMuaHBNYXg7XG5cbiAgICAgICAgLy/lkITnqK7jg5Xjg6njgrBcbiAgICAgICAgdGhpcy5pc0p1bXAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0NhdGNoTGFkZGVyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNPbkZsb29yID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pZ25vcmVDb2xsaXNpb24gPSBmYWxzZTtcblxuICAgICAgICAvL+e1jOmBjuaZgumWk+ezu1xuICAgICAgICB0aGlzLm11dGVraVRpbWUgPSAwO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgdGhpcy5kb3duRnJhbWUgPSAwO1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44OzXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5iZWZvcmVBbmltYXRpb24gPSBcIlwiO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcblxuICAgICAgICAvL+aJgOaMgeijheWCmVxuICAgICAgICB0aGlzLmVxdWlwID0ge1xuICAgICAgICAgICAgdXNpbmc6IDAsICAgICAgICAgLy/nj77lnKjkvb/nlKjkuK3vvIh3ZWFwb25z44GuaW5kZXjvvIlcbiAgICAgICAgICAgIHdlYXBvbnM6IFswXSwgICAgIC8v5omA5oyB44Oq44K544OI77yI5pyA5aSn77yT77yJXG4gICAgICAgICAgICBsZXZlbDogWzBdLCAgICAgICAvL+atpuWZqOODrOODmeODq1xuICAgICAgICAgICAgc3dpdGNoT2s6IHRydWUsICAgLy/lpInmm7Tlj6/og73jg5Xjg6njgrBcbiAgICAgICAgfTtcblxuICAgICAgICAvL+atpuWZqOOCu+ODg+ODiFxuICAgICAgICB0aGlzLnNldFdlYXBvbih0aGlzLmVxdWlwLndlYXBvbnNbdGhpcy5lcXVpcC51c2luZ10pO1xuXG4gICAgICAgIC8v5omA5oyB44Ki44Kk44OG44OgXG4gICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcblxuICAgICAgICAvL+aJgOaMgeOCr+ODquOCouadoeS7tuOCreODvFxuICAgICAgICB0aGlzLmtleXMgPSBbXTtcblxuICAgICAgICAvL+aTjeS9nOWPr+iDveODleODqeOCsFxuICAgICAgICB0aGlzLmlzQ29udHJvbCA9IHRydWU7XG5cbiAgICAgICAgLy/lpJrmrrXjgrjjg6Pjg7Pjg5fmnIDlpKflm57mlbBcbiAgICAgICAgdGhpcy5udW1KdW1wTWF4ID0gMDtcblxuICAgICAgICAvL+ODgOODn+ODvOOCueODl+ODqeOCpOODiOmZpOWOu1xuICAgICAgICBpZiAodGhpcy5kdW1teSkge1xuICAgICAgICAgICAgdGhpcy5kdW1teS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHRoaXMuZHVtbXkgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCx44Kz44Oz44OG44Kj44OL44Ol44O855So44Oq44K744OD44OIXG4gICAgY29udGludWVSZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v56e75YuV5oOF5aCxXG4gICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICB0aGlzLnZ5ID0gMDtcblxuICAgICAgICAvL+OCueODhuODvOOCv+OCuVxuICAgICAgICB0aGlzLmhwID0gdGhpcy5ocE1heDtcblxuICAgICAgICAvL+WQhOeoruODleODqeOCsFxuICAgICAgICB0aGlzLmlzSnVtcCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzRGVhZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0Ryb3AgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc09uRmxvb3IgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICB0aGlzLmlnbm9yZUNvbGxpc2lvbiA9IGZhbHNlO1xuXG4gICAgICAgIC8v57WM6YGO5pmC6ZaT57O7XG4gICAgICAgIHRoaXMubXV0ZWtpVGltZSA9IDA7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmRvd25GcmFtZSA9IDA7XG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7NcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmJlZm9yZUFuaW1hdGlvbiA9IFwiXCI7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuXG4gICAgICAgIC8v5pON5L2c5Y+v6IO944OV44Op44KwXG4gICAgICAgIHRoaXMuaXNDb250cm9sID0gdHJ1ZTtcblxuICAgICAgICAvL+WkmuauteOCuOODo+ODs+ODl+acgOWkp+WbnuaVsFxuICAgICAgICB0aGlzLm51bUp1bXBNYXggPSAwO1xuXG4gICAgICAgIC8v44OA44Of44O844K544OX44Op44Kk44OI6Zmk5Y67XG4gICAgICAgIGlmICh0aGlzLmR1bW15KSB7XG4gICAgICAgICAgICB0aGlzLmR1bW15LnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy5kdW1teSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zcHJpdGUudmlzaWJsZSA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44OA44Oh44O844K45Yem55CGXG4gICAgZGFtYWdlOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgaWYgKHRoaXMubXV0ZWtpVGltZSA+IDApIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKHRhcmdldC5wb3dlciA9PSAwKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmlzRGVhZCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5pc011dGVraSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIC8v5rCX57W244Kt44Oj44Oz44K744OrXG4gICAgICAgIHRoaXMuaXNTdHVuID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGRpciA9IDA7XG4gICAgICAgIGlmICh0aGlzLnggPCB0YXJnZXQueCkgZGlyID0gMTgwO1xuICAgICAgICBpZiAoIXRoaXMuaXNDYXRjaExhZGRlcikgdGhpcy5rbm9ja2JhY2sodGFyZ2V0LnBvd2VyLCBkaXIpO1xuXG4gICAgICAgIHRoaXMuaHAgLT0gdGFyZ2V0LnBvd2VyO1xuICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgYXBwLnBsYXlTRShcImRhbWFnZVwiKTtcblxuICAgICAgICBpZiAodGhpcy5ocCA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmRlYWQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubXV0ZWtpVGltZSA9IDYwO1xuICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDE1O1xuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uICE9IFwianVtcFwiKSB0aGlzLnNldEFuaW1hdGlvbihcImRhbWFnZVwiKTtcblxuICAgICAgICAgICAgLy/msJfntbbliKTlrppcbiAgICAgICAgICAgIHZhciBkaWNlID0gTWF0aC5yYW5kaW50KDEsIDEwMCk7XG4gICAgICAgICAgICBpZiAoZGljZSA8PSB0YXJnZXQuc3R1blBvd2VyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnc3R1bicsIHtwb3dlcjogMTB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0dW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v5q275Lqh5pmC5Yem55CGXG4gICAgZGVhZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaHAgPSAwO1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNDYXRjaExhZGRlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgdGhpcy52eSA9IC02O1xuICAgICAgICB2YXIgdHcgPSBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICB0dy5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnZGVhZCcpO1xuICAgICAgICAgICAgICAgIHR3LnJlbW92ZSgpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAvL+ODgOODn+ODvOOCueODl+ODqeOCpOODiOi/veWKoFxuICAgICAgICB0aGlzLnNwcml0ZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZHVtbXkgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcykuc2V0QW5pbWF0aW9uKFwiZGVhZFwiKTtcbiAgICB9LFxuXG4gICAgLy/jgqLjgqTjg4bjg6Dlj5blvpdcbiAgICBnZXRJdGVtOiBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIC8v5q2m5ZmoXG4gICAgICAgIGlmIChpdGVtLmlzV2VhcG9uKSB7XG4gICAgICAgICAgICAvL+aXouOBq+aMgeOBo+OBpuOBhOOCi+atpuWZqOOBi+ODgeOCp+ODg+OCr1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5lcXVpcC53ZWFwb25zLmZpbmRJbmRleChmdW5jdGlvbihlLCBpLCBhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUgPT0gaXRlbS5raW5kO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoaW5kZXggPT0gbnVsbCB8fCBpbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgICAgIC8v5oyB44Gj44Gm54Sh44GE5q2m5Zmo44Gg44Gj44Gf5aC05ZCIXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZXF1aXAud2VhcG9ucy5sZW5ndGggPCAzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44Oq44K544OI44Gr6L+95YqgXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXF1aXAud2VhcG9ucy5wdXNoKGl0ZW0ua2luZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXF1aXAubGV2ZWwucHVzaChpdGVtLmxldmVsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL+ePvuWcqOS9v+eUqOatpuWZqOOBruaJi+WJjeOBruatpuWZqOOCkuaNqOOBpuOCi1xuICAgICAgICAgICAgICAgICAgICB2YXIgZHJvcEluZGV4ID0gdGhpcy5lcXVpcC51c2luZyA9PSAwPyAyOiB0aGlzLmVxdWlwLnVzaW5nIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2luZDogdGhpcy5lcXVpcC53ZWFwb25zW2Ryb3BJbmRleF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IHRoaXMuZXF1aXAubGV2ZWxbZHJvcEluZGV4XSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHZhciBkcm9wID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkl0ZW0odGhpcy54LCB0aGlzLnksIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICBkcm9wLmZyaWN0aW9uID0gMC44O1xuICAgICAgICAgICAgICAgICAgICBkcm9wLnZ4ID0gMCAqIC10aGlzLnNjYWxlWDtcbiAgICAgICAgICAgICAgICAgICAgZHJvcC52eSA9IC01O1xuICAgICAgICAgICAgICAgICAgICBkcm9wLnRocm93QXdheSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXF1aXAud2VhcG9uc1tkcm9wSW5kZXhdID0gaXRlbS5raW5kO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVxdWlwLmxldmVsW2Ryb3BJbmRleF0gPSBpdGVtLmxldmVsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy/miYDmjIHmrablmajjgpLmi77jgaPjgZ/jgonjgZ3jga7mrablmajjga7jg6zjg5njg6vjgYzkuIrjgYzjgotcbiAgICAgICAgICAgICAgICB0aGlzLmVxdWlwLmxldmVsW2luZGV4XSsrO1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHRoaXMuZXF1aXAud2VhcG9uc1t0aGlzLmVxdWlwLnVzaW5nXTtcbiAgICAgICAgICAgICAgICB2YXIgbHYgPSB0aGlzLmVxdWlwLmxldmVsW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0V2VhcG9uKGlkLCBsdik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhcHAucGxheVNFKFwiZ2V0aXRlbVwiKTtcbiAgICAgICAgfVxuICAgICAgICAvL+ijheWCmeWTgVxuICAgICAgICBpZiAoaXRlbS5pc0VxdWlwKSB7XG4gICAgICAgICAgICB0aGlzLmhwTWF4ICs9IChpdGVtLnBvd2VyIHx8IDApO1xuICAgICAgICAgICAgdGhpcy5ocCArPSAoaXRlbS5wb3dlciB8fCAwKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmhwTWF4ID4gMjAwKSB0aGlzLmhwTWF4ID0gMjAwO1xuICAgICAgICAgICAgaWYgKHRoaXMuaHAgPiB0aGlzLmhwTWF4KSB0aGlzLmhwID0gdGhpcy5ocE1heDtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUudG90YWxTY29yZSArPSAoaXRlbS5wb2ludCB8fCAwKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJnZXRpdGVtXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8v6aOf44G554mpXG4gICAgICAgIGlmIChpdGVtLmlzRm9vZCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjpgLLluqbjgavjgojjgaPjgablm57lvqnph4/jgYzlopfliqBcbiAgICAgICAgICAgIHZhciBwb3dlciA9IGl0ZW0ucG93ZXI7XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnRTY2VuZS5zdGFnZU51bWJlciA+IDQpIHBvd2VyICo9IDEuNTtcbiAgICAgICAgICAgIHRoaXMuaHAgKz0gcG93ZXI7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwicmVjb3ZlcnlcIik7XG4gICAgICAgICAgICBpZiAodGhpcy5ocCA+IHRoaXMuaHBNYXgpIHRoaXMuaHAgPSB0aGlzLmhwTWF4O1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS50b3RhbFNjb3JlICs9IChpdGVtLnBvaW50IHx8IDApO1xuICAgICAgICB9XG4gICAgICAgIC8v6Y21XG4gICAgICAgIGlmIChpdGVtLmlzS2V5KSB7XG4gICAgICAgICAgICB0aGlzLmtleXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJnZXRrZXlpdGVtXCIpO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZSgnZ2V0a2V5Jywge2tleTogaXRlbX0pO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS50b3RhbFNjb3JlICs9IChpdGVtLnBvaW50IHx8IDApO1xuICAgICAgICB9XG4gICAgICAgIC8v5b6X54K544Ki44Kk44OG44OgXG4gICAgICAgIGlmIChpdGVtLmlzSXRlbSkge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS50b3RhbFNjb3JlICs9IChpdGVtLnBvaW50IHx8IDApO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcImdldGl0ZW1cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v5L2/55So5q2m5Zmo44Gu5aSJ5pu0XG4gICAgc3dpdGNoV2VhcG9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/miYvmjIHjgaHjga7mrablmajjgYzkuIDlgIvjga7loLTlkIjjga/kvZXjgoLjgZfjgarjgYRcbiAgICAgICAgaWYgKHRoaXMuZXF1aXAud2VhcG9ucy5sZW5ndGggPCAyKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5lcXVpcC5zd2l0Y2hPayA9IGZhbHNlO1xuXG4gICAgICAgIHZhciByb3QgPSAxMjA7XG4gICAgICAgIGlmICh0aGlzLmVxdWlwLndlYXBvbnMubGVuZ3RoID09IDIgJiYgdGhpcy5lcXVpcC51c2luZyA9PSAxKSByb3QgPSAyNDA7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyV2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmJ5KHtyb3RhdGlvbjogcm90fSwgMzAwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcXVpcC5zd2l0Y2hPayA9IHRydWU7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIC8v54++5Zyo5L2/55So5q2m5Zmo6Kit5a6aXG4gICAgICAgIHRoaXMuZXF1aXAudXNpbmcgPSAodGhpcy5lcXVpcC51c2luZyArIDEpICUgdGhpcy5lcXVpcC53ZWFwb25zLmxlbmd0aDtcbiAgICAgICAgdmFyIGlkID0gdGhpcy5lcXVpcC53ZWFwb25zW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICB2YXIgbHYgPSB0aGlzLmVxdWlwLmxldmVsW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICB0aGlzLnNldFdlYXBvbihpZCwgbHYpO1xuXG4gICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgfSxcblxuICAgIC8v5q2m5Zmo5aSJ5pu0XG4gICAgc2V0V2VhcG9uOiBmdW5jdGlvbihraW5kLCBsZXZlbCkge1xuICAgICAgICBraW5kID0ga2luZCB8fCAwO1xuICAgICAgICBsZXZlbCA9IGxldmVsIHx8IDA7XG5cbiAgICAgICAgLy/lsZ7mgKfliJ3mnJ/ljJZcbiAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24uJGV4dGVuZCh7XG4gICAgICAgICAgICBpc1NsYXNoOiBmYWxzZSxcbiAgICAgICAgICAgIGlzU3Rpbmc6IGZhbHNlLFxuICAgICAgICAgICAgaXNCbG93OiBmYWxzZSxcbiAgICAgICAgICAgIGlzQXJyb3c6IGZhbHNlLFxuICAgICAgICAgICAgaXNGaXJlOiBmYWxzZSxcbiAgICAgICAgICAgIGlzSWNlOiBmYWxzZSxcbiAgICAgICAgICAgIHN0dW5Qb3dlcjogMSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jgqLjgqTjg4bjg6Dmg4XloLHlj5blvpdcbiAgICAgICAgdmFyIHNwZWMgPSBxZnQuSXRlbUluZm8uZ2V0KGtpbmQpO1xuICAgICAgICB0aGlzLmF0dGFja0NvbGxpc2lvbi4kZXh0ZW5kKHNwZWMpO1xuICAgICAgICB0aGlzLmF0dGFja0NvbGxpc2lvbi5wb3dlciArPSBsZXZlbCAqIChzcGVjLmxldmVsQm9udXMgfHwgMik7XG5cbiAgICAgICAgc3dpdGNoIChraW5kKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgLy/jgrfjg6fjg7zjg4jjgr3jg7zjg4lcbiAgICAgICAgICAgICAgICBsZXZlbCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRQb3NpdGlvbigtMywgMyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgLy/jg63jg7PjgrDjgr3jg7zjg4lcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldFBvc2l0aW9uKC0zLCAzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAvL+aWp1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQ0LCA0NCwgNDQsIDQzLCA0MywgNDMsIDQyLCA0MiwgNDIsIDQxLCA0MSwgNDEsIFwic3RvcFwiXTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRQb3NpdGlvbigtMywgMyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgLy/mp41cbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgIC8v5byTXG4gICAgICAgICAgICAgICAgbGV2ZWwgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQxLCA0MiwgNDMsIDQ0LCBcInN0b3BcIl07XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24uc2V0UG9zaXRpb24oMCwgMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgLy/prZTms5Xjga7mnZZcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgIC8v6a2U5bCO5pu4XG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFsgNDQsIDQ0LCA0NCwgNDMsIDQzLCA0MywgNDIsIDQyLCA0MiwgNDEsIDQxLCA0MSwgXCJzdG9wXCJdO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldFBvc2l0aW9uKC0zLCAzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5q2m5Zmo55S75YOP6Kit5a6aXG4gICAgICAgIHZhciBpbmRleCA9IGtpbmQgKiAxMCArIE1hdGgubWluKGxldmVsLCBzcGVjLm1heEluZGV4KTtcbiAgICAgICAgdGhpcy53ZWFwb24uc2V0RnJhbWVJbmRleChpbmRleCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v6KOF5YKZ5q2m5Zmo44Gr44KI44KK5pS75pKD44Oi44O844K344On44Oz44KS5aSJ44GI44KLXG4gICAgd2VhcG9uQXR0YWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtpbmQgPSB0aGlzLmVxdWlwLndlYXBvbnNbdGhpcy5lcXVpcC51c2luZ107XG4gICAgICAgIHZhciBsZXZlbCA9IHRoaXMuZXF1aXAubGV2ZWxbdGhpcy5lcXVpcC51c2luZ107XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHN3aXRjaCAoa2luZCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIC8v44K344On44O844OI44K944O844OJXG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImF0dGFja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDIwMCwgYWxwaGE6IDEuMH0pXG4gICAgICAgICAgICAgICAgICAgIC50byh7cm90YXRpb246IDM2MH0sIDUpXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAvL+ODreODs+OCsOOCveODvOODiVxuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJhdHRhY2tcIik7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5zZXQoe3JvdGF0aW9uOiAyMDAsIGFscGhhOiAxLjB9KVxuICAgICAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzNjB9LCA2KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgLy/mlqdcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiYXR0YWNrXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDAwLCBhbHBoYTogMS4wfSlcbiAgICAgICAgICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogMjcwfSwgOClcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIC8v5qeNXG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImF0dGFja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IC00NSwgYWxwaGE6IDEuMH0pXG4gICAgICAgICAgICAgICAgICAgIC5ieSh7eDogLTEwfSwgMilcbiAgICAgICAgICAgICAgICAgICAgLmJ5KHt4OiAxMH0sIDIpXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAvL+W8k1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJhdHRhY2tcIik7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5zZXQoe3JvdGF0aW9uOiAtNDUsIGFscGhhOiAxLjB9KVxuICAgICAgICAgICAgICAgICAgICAuYnkoe3g6IDd9LCAzKVxuICAgICAgICAgICAgICAgICAgICAuYnkoe3g6IC03fSwgMylcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXJyb3dQb3dlciA9IDUgKyBsZXZlbCAqIDI7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcnJvdyA9IHFmdC5QbGF5ZXJBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAxNSwgaGVpZ2h0OiAxMCwgcG93ZXI6IGFycm93UG93ZXIsIHR5cGU6IFwiYXJyb3dcIn0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFNjYWxlKHRoaXMuc2NhbGVYLCAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgICAgICAgICAgYXJyb3cudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKS5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYnkoe3g6ICgxNTAgKyBsZXZlbCAqIDUpICogdGhpcy5zY2FsZVh9LCA3KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZChhcnJvdykpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgIC8v6a2U5rOV44Gu5p2WXG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5zZXQoe3JvdGF0aW9uOiAyMDAsIGFscGhhOiAxLjB9KVxuICAgICAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzNjB9LCA4KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdmFyIG1hZ2ljUG93ZXIgPSAxNSArIGxldmVsICogMjtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWFnaWMgPSBxZnQuUGxheWVyQXR0YWNrKHRoaXMucGFyZW50U2NlbmUsIHt3aWR0aDogMTUsIGhlaWdodDogMTAsIGluZGV4OiAzMCwgcG93ZXI6IG1hZ2ljUG93ZXIsIHR5cGU6IFwiZmxhbWVcIn0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFNjYWxlKHRoaXMuc2NhbGVYLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgbWFnaWMucmFkID0gKDkwIC0gaSAqIDMwKS50b1JhZGlhbigpO1xuICAgICAgICAgICAgICAgICAgICBtYWdpYy5pc0NvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBtYWdpYy52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIG1hZ2ljLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoaSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNDb2xsaXNpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG14ID0gTWF0aC5jb3ModGhpcy5yYWQpICogdGhhdC5zY2FsZVg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG15ID0gTWF0aC5zaW4odGhpcy5yYWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24odGhhdC54ICsgMzIgKiBteCwgdGhhdC55ICsgMzIgKiBteSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQobWFnaWMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoOClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQobWFnaWMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgLy/prZTlsI7mm7hcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiYXR0YWNrXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDAwLCBhbHBoYTogMS4wfSlcbiAgICAgICAgICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogMjcwfSwgOClcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzEzLCAxNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzM2LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWyAzLCAgNCwgIDUsICA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbIDksIDEwLCAxMSwgMTBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFsgMCwgIDEsICAyLCAgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQxLCA0MiwgNDMsIDQ0LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkZWZlbnNlXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGFtYWdlXCJdID0gWyAxOCwgMTksIDIwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRyb3BcIl0gPSBbMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkZWFkXCJdID0gWzE4LCAxOSwgMjAsIDMzLCAzNCwgMzUsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsZWFyXCJdID0gWzI0LCAyNSwgMjZdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3R1blwiXSA9IFsgMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprnlKjjgqjjg6zjg6Hjg7Pjg4jjga7kvY3nva7lho3jgrvjg4Pjg4hcbiAgICByZXNldENvbGxpc2lvblBvc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHcgPSBNYXRoLmZsb29yKHRoaXMud2lkdGgvMikrNjtcbiAgICAgICAgdmFyIGggPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0LzIpKzY7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblswXS5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSAtIGgpO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMV0uc2V0UG9zaXRpb24odGhpcy54ICsgdywgdGhpcy55IC0gNSk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblsyXS5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSArIGgpO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10uc2V0UG9zaXRpb24odGhpcy54IC0gdywgdGhpcy55IC0gNSk7XG4gICAgICAgIHRoaXMubGFkZGVyQ29sbGlzaW9uLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v6aCt5LiK44Gv44GX44GU44OB44Kn44OD44KvXG4gICAgY2hlY2tIZWFkTGFkZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGggPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0LzIpKzEwO1xuICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAyfSkuc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnktaCk7XG4gICAgICAgIHZhciByZXQgPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUuaGl0VGVzdEVsZW1lbnQoYykpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgZS50eXBlID09IFwic3RhaXJzXCIpIHJldCA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcblxuICAgIC8v6Laz5LiL44Gv44GX44GU44OB44Kn44OD44KvXG4gICAgY2hlY2tGb290TGFkZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGggPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0LzIpKzEwO1xuICAgICAgICB2YXIgYyA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAyfSkuc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkraCk7XG4gICAgICAgIHZhciByZXQgPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUuaGl0VGVzdEVsZW1lbnQoYykpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgZS50eXBlID09IFwic3RhaXJzXCIpIHJldCA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcblxuICAgIC8v54++5Zyo44K544OG44O844K/44K55L+d5a2YXG4gICAgc2F2ZVN0YXR1czogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v5omA5oyB5q2m5Zmo44CB44Ki44Kk44OG44Og562J44K544OG44O844K/44K544Gu5Y+W5b6XXG4gICAgICAgIHZhciBlcSA9IHRoaXMuZXF1aXA7XG4gICAgICAgIHZhciBlcXVpcCA9IHtcbiAgICAgICAgICAgIHVzaW5nOiAwLFxuICAgICAgICAgICAgd2VhcG9uczogZXEud2VhcG9ucy5jb25jYXQoKSxcbiAgICAgICAgICAgIGxldmVsOiBlcS5sZXZlbC5jb25jYXQoKSxcbiAgICAgICAgICAgIHN3aXRjaE9rOiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLml0ZW1zLmNvbmNhdCgpO1xuICAgICAgICB2YXIgbnVtSnVtcE1heCA9IHRoaXMubnVtSnVtcE1heDtcblxuICAgICAgICB0aGlzLnN0YXJ0U3RhdHVzID0ge1xuICAgICAgICAgICAgaHBNYXg6IHRoaXMuaHBNYXgsXG4gICAgICAgICAgICBocDogdGhpcy5ocCxcbiAgICAgICAgICAgIHBvd2VyOiB0aGlzLnBvd2VyLFxuICAgICAgICAgICAgZGVmZW5zZTogdGhpcy5kZWZlbnNlLFxuICAgICAgICAgICAgZXF1aXA6IGVxdWlwLFxuICAgICAgICAgICAgaXRlbXM6IGl0ZW1zLFxuICAgICAgICAgICAgbnVtSnVtcE1heDogbnVtSnVtcE1heCxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgr/jgrnlvqnlhYNcbiAgICByZXN0b3JlU3RhdHVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNzID0gdGhpcy5zdGFydFN0YXR1cztcbiAgICAgICAgdGhpcy5ocE1heCA9IHNzLmhwTWF4O1xuICAgICAgICB0aGlzLmhwID0gc3MuaHA7XG4gICAgICAgIHRoaXMucG93ZXIgPSBzcy5wb3dlcjtcbiAgICAgICAgdGhpcy5kZWZlbnNlID0gc3MuZGVmZW5zZTtcbiAgICAgICAgdGhpcy5lcXVpcCA9IHtcbiAgICAgICAgICAgIHVzaW5nOiAwLFxuICAgICAgICAgICAgd2VhcG9uczogc3MuZXF1aXAud2VhcG9ucy5jb25jYXQoKSxcbiAgICAgICAgICAgIGxldmVsOiBzcy5lcXVpcC5sZXZlbC5jb25jYXQoKSxcbiAgICAgICAgICAgIHN3aXRjaE9rOiB0cnVlLFxuICAgICAgICB9XG4gICAgICAgIGlmIChzcy5pdGVtcykge1xuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IHNzLml0ZW1zLmNvbmNhdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pdGVtID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5udW1KdW1wTWF4ID0gc3MubnVtSnVtcE1heDtcblxuICAgICAgICB2YXIgaWQgPSB0aGlzLmVxdWlwLndlYXBvbnNbdGhpcy5lcXVpcC51c2luZ107XG4gICAgICAgIHZhciBsdiA9IHRoaXMuZXF1aXAubGV2ZWxbdGhpcy5lcXVpcC51c2luZ107XG4gICAgICAgIHRoaXMuc2V0V2VhcG9uKGlkLCBsdik7XG4gICAgfSxcbn0pO1xuXG4vL+ODl+ODrOOCpOODpOODvOaUu+aSg+WIpOWumlxucGhpbmEuZGVmaW5lKFwicWZ0LlBsYXllckF0dGFja1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxLFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprnmbrnlJ/jg5Xjg6njgrBcbiAgICBpc0NvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5bGe5oCnXG4gICAgaXNTbGFzaDogZmFsc2UsXG4gICAgaXNTdGluZzogZmFsc2UsXG4gICAgaXNCbG93OiBmYWxzZSxcbiAgICBpc0Fycm93OiBmYWxzZSxcbiAgICBpc0ZpcmU6IGZhbHNlLFxuICAgIGlzSWNlOiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG5cbiAgICAgICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlIHx8IFwiYXJyb3dcIjtcbiAgICAgICAgdGhpcy5wb3dlciA9IG9wdGlvbnMucG93ZXIgfHwgMDtcbiAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG5cbiAgICAgICAgLy/ooajnpLrjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgc3dpdGNoICh0aGlzLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJhcnJvd1wiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDEpO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWUgPSBbMV07XG4gICAgICAgICAgICAgICAgdGhpcy5pc0Fycm93ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU3RpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuc3R1blBvd2VyID0gMTA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZmlyZWJhbGxcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYnVsbGV0XCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDkpO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWUgPSBbOSwgMTAsIDExLCAxMF07XG4gICAgICAgICAgICAgICAgdGhpcy5pc0ZpcmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm1hc2FrYXJpXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoMjApO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWUgPSBbMjBdO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNTbGFzaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0Jyb3cgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuc3R1blBvd2VyID0gNTA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZGFnZ2VyXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoMjApO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLnJvdGF0aW9uID0gMTM1O1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWUgPSBbMF07XG4gICAgICAgICAgICAgICAgdGhpcy5pc1N0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0dW5Qb3dlciA9IDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZmxhbWVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZWZmZWN0XCIsIDQ4LCA0OClcbiAgICAgICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAgICAgLnNldEZyYW1lVHJpbW1pbmcoMCwgMTkyLCAxOTIsIDk2KVxuICAgICAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMC41KTtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lID0gWzAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDhdO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNGaXJlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0dW5Qb3dlciA9IDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSB7XG4gICAgICAgICAgICBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogdGhpcy53aWR0aCwgaGVpZ2h0OiB0aGlzLmhlaWdodH0pLmFkZENoaWxkVG8odGhpcykuc2V0QWxwaGEoMC41KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNDb2xsaXNpb24gfHwgdGhpcy50eXBlID09IFwiZXhwbG9kZVwiKSByZXR1cm47XG5cbiAgICAgICAgaWYgKHRoaXMudGltZSAlIDMgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVJbmRleCh0aGlzLmZyYW1lW3RoaXMuaW5kZXhdKTtcbiAgICAgICAgICAgIHRoaXMuaW5kZXggPSAodGhpcy5pbmRleCArIDEpICUgdGhpcy5mcmFtZS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PSBcImZsYW1lXCIpIHJldHVybjtcblxuICAgICAgICAvL+WcsOW9ouaOpeinpuWIpOWumlxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUuY29sbGlzaW9uTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgZS50eXBlID09IFwic3RhaXJzXCIpIHJldHVybjtcbiAgICAgICAgICAgIGlmICh0aGlzLmhpdFRlc3RFbGVtZW50KGUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0NvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhcnJvd1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGljayhlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZmlyZWJhbGxcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwbG9kZShlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgLy/jg5Ljg4Pjg4jlvozlh6bnkIZcbiAgICBoaXQ6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcImZpcmViYWxsXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5leHBsb2RlKHRhcmdldCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/liLrjgZXjgotcbiAgICBzdGljazogZnVuY3Rpb24oZSkge1xuICAgICAgICAvL+WKueaenOmfs1xuICAgICAgICBzd2l0Y2ggKHRoaXMudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcImFycm93XCI6XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImFycm93c3RpY2tcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibWFzYWthcmlcIjpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNjYWxlWCA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnggPSBlLmxlZnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnggPSBlLnJpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvL+W8vuOBi+OCjOOCi1xuICAgIHNuYXA6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy/lirnmnpzpn7NcbiAgICAgICAgYXBwLnBsYXlTRShcInRpbmtsaW5nXCIpO1xuICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmJ5KHt5OiAtOTIsIHJvdGF0aW9uOiA3MDB9LCAxNSwgXCJlYXNlT3V0UXVhZFwiKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIC8v54iG55m6XG4gICAgZXhwbG9kZTogZnVuY3Rpb24oZSkge1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRWZmZWN0KHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgfSxcbn0pO1xuXG4vL+ODl+ODrOOCpOODpOODvOODgOODn+ODvOOCueODl+ODqeOCpOODiFxucGhpbmEuZGVmaW5lKFwicWZ0LlBsYXllckR1bW15XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuU3ByaXRlXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihhc3NldE5hbWUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoYXNzZXROYW1lLCAzMiwgMzIpO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFsxMywgMTRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFsgMywgIDQsICA1LCAgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrX3N0b3BcIl0gPSBbIDMsICA0LCAgNSwgIDQsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbIDksIDEwLCAxMSwgMTBdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBfc3RvcFwiXSA9ICAgWzEwLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWyAwLCAgMSwgIDIsICAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsZWFyXCJdID0gWzI0LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkYW1hZ2VcIl0gPSBbIDE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGVhZFwiXSA9IFsxOCwgMTksIDIwLCAzMywgMzQsIDM1LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuXG4gICAgICAgIHRoaXMubm93QW5pbWF0aW9uID0gXCJzdGFuZFwiO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbiA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5ieCA9IDA7XG4gICAgICAgIHRoaXMuYnkgPSAwO1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIC8v5b2x44Gu6L+95YqgXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHNjID0gMTYgLyAyNDtcbiAgICAgICAgaWYgKHNjIDwgMSkgc2MgKz0gMC4yO1xuICAgICAgICB0aGlzLnNoYWRvd1Nwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwic2hhZG93XCIsIDI0LCA4KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjUpXG4gICAgICAgICAgICAuc2V0U2NhbGUoc2MsIDEuMClcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAxNik7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbiAmJiB0aGlzLnRpbWUgJSA2ID09IDApIHtcbiAgICAgICAgICAgIHRoaXMuaW5kZXggPSAodGhpcy5pbmRleCsxKSAlIHRoaXMuZnJhbWVbdGhpcy5ub3dBbmltYXRpb25dLmxlbmd0aDtcbiAgICAgICAgICAgIGlmICh0aGlzLmZyYW1lW3RoaXMubm93QW5pbWF0aW9uXVt0aGlzLmluZGV4XSA9PSBcInN0b3BcIikgdGhpcy5pbmRleC0tO1xuICAgICAgICAgICAgdGhpcy5mcmFtZUluZGV4ID0gdGhpcy5mcmFtZVt0aGlzLm5vd0FuaW1hdGlvbl1bdGhpcy5pbmRleF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy54IDwgdGhpcy5ieCkgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICBpZiAodGhpcy54ID4gdGhpcy5ieCkgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgdGhpcy5ieCA9IHRoaXMueDtcbiAgICAgICAgdGhpcy5ieSA9IHRoaXMueTtcblxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgc2V0QW5pbWF0aW9uOiBmdW5jdGlvbihhbmltTmFtZSkge1xuICAgICAgICBpZiAoIXRoaXMuZnJhbWVbYW5pbU5hbWVdKSByZXR1cm47XG4gICAgICAgIGlmIChhbmltTmFtZSA9PSB0aGlzLm5vd0FuaW1hdGlvbikgcmV0dXJuO1xuICAgICAgICB0aGlzLm5vd0FuaW1hdGlvbiA9IGFuaW1OYW1lO1xuICAgICAgICB0aGlzLmluZGV4ID0gLTE7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcblxuLy/jg5fjg6zjgqTjg6Tjg7znj77lnKjkvb/nlKjmrablmajooajnpLpcbnBoaW5hLmRlZmluZShcInFmdC5QbGF5ZXJXZWFwb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGxheWVyKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5iYXNlID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuYmFzZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSAtdGhhdC5yb3RhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDogMjUsXG4gICAgICAgICAgICBoZWlnaHQ6IDI1LFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDAuMClcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJ5ZWxsb3dcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICAvL+S9v+eUqOS4reatpuWZqFxuICAgICAgICBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKS5hZGRDaGlsZFRvKHRoaXMuYmFzZSkuc2V0UG9zaXRpb24oMCwgLTE4KTtcbiAgICAgICAgLy/mjajjgabjgaHjgoPjgYbmrablmahcbiAgICAgICAgdGhpcy5kcm9wRnJhbWUgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHtzdHJva2U6IFwicmVkXCJ9LiRzYWZlKHBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMuYmFzZSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigxNCwgMTApXG4gICAgICAgICAgICAuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHRoaXMuZHJvcEZyYW1lLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoYXQucGxheWVyLmVxdWlwLndlYXBvbnMubGVuZ3RoIDwgMykge1xuICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/mrablmajjg6rjgrnjg4jvvIjvvJPjgaTvvIlcbiAgICAgICAgdGhpcy53ZWFwb25zID0gW107XG4gICAgICAgIHZhciByYWQgPSAwO1xuICAgICAgICB2YXIgcmFkXzEgPSAoTWF0aC5QSSoyKSAvIDM7XG4gICAgICAgICgzKS50aW1lcyhmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICB2YXIgeCA9ICBNYXRoLnNpbihyYWQpKjE4O1xuICAgICAgICAgICAgdmFyIHkgPSAtTWF0aC5jb3MocmFkKSoxODtcbiAgICAgICAgICAgIHJhZCAtPSByYWRfMTtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uc1tpXSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbnNbaV0uaW5kZXggPSBpO1xuICAgICAgICAgICAgdGhpcy53ZWFwb25zW2ldLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSAtdGhhdC5yb3RhdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgd2VhcG9ucyA9IHRoYXQucGxheWVyLmVxdWlwLndlYXBvbnM7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXggPCB3ZWFwb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIga2luZCA9IHRoYXQucGxheWVyLmVxdWlwLndlYXBvbnNbdGhpcy5pbmRleF07XG4gICAgICAgICAgICAgICAgICAgIHZhciBsZXZlbCA9IHRoYXQucGxheWVyLmVxdWlwLmxldmVsW3RoaXMuaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3BlYyA9IHFmdC5JdGVtSW5mby5nZXQoa2luZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGtpbmQgKiAxMCArIE1hdGgubWluKGxldmVsLCBzcGVjLm1heEluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZUluZGV4KGluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IDEwLFxuICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy/lvLfljJbjg6zjg5njg6vooajnpLpcbiAgICAgICAgICAgIHRoaXMud2VhcG9uc1tpXS5sZXZlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKS5zZXRQb3NpdGlvbig2LCA2KS5hZGRDaGlsZFRvKHRoaXMud2VhcG9uc1tpXSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbnNbaV0ubGV2ZWwuaW5kZXggPSBpO1xuICAgICAgICAgICAgdGhpcy53ZWFwb25zW2ldLmxldmVsLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBsZXZlbCA9IHRoYXQucGxheWVyLmVxdWlwLmxldmVsW3RoaXMuaW5kZXhdO1xuICAgICAgICAgICAgICAgIGlmIChsZXZlbCAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiK1wiK2xldmVsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBjbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5hZHZlbnR1cmVyLmpzXG4gKiAgMjAxNy8wOC8wOVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/lhpLpmbrogIVcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5BZHZlbnR1cmVyXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMTAwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDE5MixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAzNjAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAxMDAwMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDYsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9KRVdFTCxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAzLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9KRVdFTEJPWCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDI0LCBoZWlnaHQ6IDIwfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+atpuWZqOeUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLndlYXBvbiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoMTAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSlcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMSwgMSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigtMywgMyk7XG4gICAgICAgIHRoaXMud2VhcG9uLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgdGhpcy53ZWFwb24ua2luZCA9IFwic3dvcmRcIjtcbiAgICAgICAgdGhpcy53ZWFwb24uc2NhbGVYID0gLTE7XG4gICAgICAgIHRoaXMud2VhcG9uLnNjYWxlWSA9IC0xO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIGlmICh0aGlzLmJsYWNrKSB7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwicGxheWVyMUJsYWNrXCIsIDMyLCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJwbGF5ZXIxXCIsIDMyLCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNwcml0ZS5zY2FsZVggPSAtMTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAxMDAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICB0aGlzLmF0dGFja0ludGVydmFsID0gMzA7XG5cbiAgICAgICAgLy/ooYzli5Xjg5Xjgqfjg7zjgrpcbiAgICAgICAgdGhpcy5waGFzZSA9IFwid2FuZGVyXCI7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuICAgICAgICB2YXIgZGlzdGFuY2UgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG5cbiAgICAgICAgLy/lvoXmqZ/nirbmhYtcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJ3YWl0XCIpIHtcbiAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCIsIGxpZmVTcGFuOiAxNX0pO1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSBcImFwcHJvYWNoXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvL+W+mOW+ilxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSBcIndhbmRlclwiKSB7XG4gICAgICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCIsIGxpZmVTcGFuOiAxNX0pO1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSBcImFwcHJvYWNoXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucm91bmR0cmlwQWxnb3JpdGhtX2dyb3VuZChkaXN0YW5jZSwgbG9vayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOeZuuimi+W+jOaOpei/kVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSBcImFwcHJvYWNoXCIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbGF5ZXIueCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWxvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gXCJsb3N0XCI7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAxNTA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCA1MiAmJiB0aGlzLmF0dGFja0ludGVydmFsID09IDApIHRoaXMucGhhc2UgPSBcImF0dGFja1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zopovlpLHjgYRcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJsb3N0XCIpIHtcbiAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lLS07XG4gICAgICAgICAgICBpZiAodGhpcy54IDwgcGxheWVyLngpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0zO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lIDwgMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiLi4uXCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gXCJ3YWl0XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+aUu+aSg1xuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSBcImF0dGFja1wiKSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFjaygpO1xuICAgICAgICAgICAgdGhpcy5hdHRhY2tJbnRlcnZhbCA9IDMwO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGhhc2UgIT0gXCJhdHRhY2tpbmdcIikge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImp1bXBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmF0dGFja0ludGVydmFsLS07XG4gICAgICAgIGlmICh0aGlzLmF0dGFja0ludGVydmFsIDwgMCkgdGhpcy5hdHRhY2tJbnRlcnZhbCA9IDA7XG4gICAgfSxcblxuICAgIC8v5pS75pKDXG4gICAgYXR0YWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDI7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwiYXR0YWNrXCIpO1xuICAgICAgICB0aGlzLnBoYXNlID0gXCJhdHRhY2tpbmdcIjtcblxuICAgICAgICAvL+aUu+aSg+WIpOWumlxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBhdGsgPSBxZnQuRW5lbXlBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAyNCwgaGVpZ2h0OiAyNCwgcG93ZXI6IDIwICsgdGhpcy5sZXZlbCAqIDV9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5lbmVteUxheWVyKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCArIHRoaXMuc2NhbGVYICogMTgsIHRoaXMueSlcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjApO1xuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSBhdGsuc2V0QWxwaGEoMC4zKTtcbiAgICAgICAgYXRrLm1hc3RlciA9IHRoaXM7XG4gICAgICAgIGF0ay50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICBhdGsudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGF0LnggKyB0aGF0LnNjYWxlWCAqIDE4O1xuICAgICAgICB9XG5cbiAgICAgICAgYXBwLnBsYXlTRShcImF0dGFja1wiKTtcbiAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogMjAwLCBhbHBoYTogMS4wfSlcbiAgICAgICAgICAgIC50byh7cm90YXRpb246IDM2MH0sIDYpXG4gICAgICAgICAgICAuZmFkZU91dCgxKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gXCJhcHByb2FjaFwiO1xuICAgICAgICAgICAgICAgIGF0ay5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+mjm+OBs+mBk+WFt+W8vuOBjVxuICAgIGd1YXJkOiBmdW5jdGlvbigpIHtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFsxMywgMTRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszNiwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFsgMywgIDQsICA1LCAgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWyA5LCAxMCwgMTEsIDEwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbIDAsICAxLCAgMiwgIDFdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGVmZW5zZVwiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRhbWFnZVwiXSA9IFsgMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkcm9wXCJdID0gWzE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGVhZFwiXSA9IFsxOCwgMTksIDIwLCAzMywgMzQsIDM1LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJjbGVhclwiXSA9IFsyNCwgMjUsIDI2XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0dW5cIl0gPSBbIDE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5hcmNoZGVtb24uanNcbiAqICAyMDE3LzA1LzAxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCouODvOOCr+ODh+ODvOODouODs1xucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkFyY2hEZW1vblwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMzAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMTgwLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PplpPpmpRcbiAgICBhbmltYXRpb25JbnRlcnZhbDogMTUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiA1MDAwLFxuXG4gICAgLy/po5vooYzjg6Ljg7zjg4lcbiAgICBmbHlpbmc6IGZhbHNlLFxuICAgIGZseWluZ1BoYXNlOiAwLCAvL+ihjOWLleODleOCp+ODvOOCulxuICAgIGZseWluZ1g6IDAsICAgICAvL+mjm+ihjOmWi+Wni++8uOW6p+aomVxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUxCT1gsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAzNSwgaGVpZ2h0OiAzMH0pO1xuICAgICAgICBpZiAob3B0aW9ucy5zaXplKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IG9wdGlvbnMuc2l6ZSB8fCAxO1xuICAgICAgICAgICAgb3B0aW9ucy53aWR0aCA9IHNpemUgKiAzNTtcbiAgICAgICAgICAgIG9wdGlvbnMuaGVpZ2h0ID0gc2l6ZSAqIDMwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxeDJcIiwgMjQqMiwgMzIqMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygyMTYqMiwgNjQwKjIsIDcyKjIsIDEyOCoyKS5zZXRQb3NpdGlvbigwLCAtMTApO1xuICAgICAgICBpZiAob3B0aW9ucy5zaXplKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IG9wdGlvbnMuc2l6ZSB8fCAxO1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUuc2V0U2NhbGUoc2l6ZSkuc2V0UG9zaXRpb24oMCwgc2l6ZSAqIC0xMik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAxMDAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5kaXJlY3Rpb24gPT0gMCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmg4XloLFcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICAvL+mAsuihjOaWueWQkeaxuuWumlxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O855m66KaL5b6M5LiA5a6a5pmC6ZaT6L+96Leh44GZ44KLXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDEyMDtcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy52eCAqPSAzO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDAgJiYgIXRoaXMuaXNBdHRhY2sgJiYgdGhpcy50dXJuVGltZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHVyblRpbWUgPSAxNTtcbiAgICAgICAgICAgIGlmIChsb29rKSB0aGlzLnR1cm5Db3VudCA9IDA7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+WkseOBo+OBn+eKtuaFi+OBp+S4ieWbnuaMr+OCiui/lOOBo+OBn+WgtOWQiOOBr+i/vei3oee1guS6hlxuICAgICAgICAgICAgaWYgKHRoaXMudHVybkNvdW50ID4gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8v5LiA5a6a6Led6Zui5Lul5LiK6Zui44KM44Gf44KJ6L+96Leh6Kej6ZmkXG4gICAgICAgIGlmIChkaXMgPiA1MTIpIHRoaXMuY2hhc2VUaW1lID0gMDtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844G444Gu5pS75pKDXG4gICAgICAgICAgICBpZiAobG9vayAmJiAhdGhpcy5pc0F0dGFjayAmJiAhdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgICAgICBpZiAoZGlzID4gMTI4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZWJyZWF0aCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwbG9kaW5nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDMwKSB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgfSxcblxuICAgIC8v54Gr55CD44KS5ZCQ44GPXG4gICAgZmlyZWJhbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDEwKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJCdWxsZXRcIiwge2V4cGxvZGU6IHRydWUsIHJvdGF0aW9uOiB0aGlzLmdldFBsYXllckFuZ2xlKCksIHBvd2VyOiAzMH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53YWl0KDQ1KVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+eCjuOCkuWQkOOBj1xuICAgIGZpcmVicmVhdGg6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDYwO1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDEwKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIHJvdCA9ICh0aGlzLnNjYWxlWCA9PSAxKT8gMDogMTgwO1xuICAgICAgICB2YXIgY3QgPSAwO1xuICAgICAgICB2YXIgdHcgPSBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLnggKyAyNCAqIHRoaXMuc2NhbGVYLCB0aGlzLnktOCwgXCJCdWxsZXRcIiwge3R5cGU6IFwiZXhwbG9kZVwiLCBwb3dlcjogMTAsIHJvdGF0aW9uOiB0aGlzLmdldFBsYXllckFuZ2xlKCksIHZlbG9jaXR5OiA1fSk7XG4gICAgICAgICAgICAgICAgYi5zZXRTY2FsZSgwLjEpO1xuICAgICAgICAgICAgICAgIGIudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLnRvKHtzY2FsZVg6IDEsIHNjYWxlWTogMX0sIDEwKTtcbiAgICAgICAgICAgICAgICBjdCsrO1xuICAgICAgICAgICAgICAgIGlmIChjdCA9PSA2IHx8IHRoaXMuYXR0YWNrQ2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgIHR3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrQ2FuY2VsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53YWl0KDUpXG4gICAgICAgICAgICAuc2V0TG9vcCh0cnVlKTtcbiAgICB9LFxuXG4gICAgLy/niIbnmbpcbiAgICBleHBsb2Rpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHAucGxheVNFKFwiYm9tYlwiKTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSA2MDtcbiAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLndhaXQoNDUpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIHJvdCA9ICh0aGlzLnNjYWxlWCA9PSAxKT8gMDogMTgwO1xuICAgICAgICB2YXIgY3QgPSAwO1xuICAgICAgICB2YXIgdHcgPSBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgcmFkID0gcm90LnRvUmFkaWFuKCk7XG4gICAgICAgICAgICAgICAgdmFyIGV4ID0gTWF0aC5jb3MocmFkKSAqIDE2O1xuICAgICAgICAgICAgICAgIHZhciBleSA9IE1hdGguc2luKHJhZCkgKiAxNjtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54ICsgZXgsIHRoaXMueSArIGV5LCBcIkJ1bGxldFwiLCB7dHlwZTogXCJleHBsb2RlXCIsIHBvd2VyOiAxMCwgcm90YXRpb246IHJvdCwgdmVsb2NpdHk6IDN9KTtcbiAgICAgICAgICAgICAgICByb3QgKz0gMjIuNTtcbiAgICAgICAgICAgICAgICBjdCsrO1xuICAgICAgICAgICAgICAgIGlmIChjdCA9PSAxNiB8fCB0aGlzLmF0dGFja0NhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICB0dy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFja0NhbmNlbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCgxKVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuYXJjaGtuaWdodC5qc1xuICogIDIwMTcvMDUvMThcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Ki44O844Kv44OK44Kk44OIXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQXJjaEtuaWdodFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDcwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDE5MixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA5MCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDUwMDAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiAxMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDEwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0pFV0VMLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0xPTkdTV09SRCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDI1LCBoZWlnaHQ6IDQwfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+atpuWZqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLndlYXBvbiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoMTAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSlcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMSwgMSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigtNiwgMylcbiAgICAgICAgICAgIC5zZXRTY2FsZSgtMS41LCAxLjUpXG4gICAgICAgICAgICAuc2V0Um90YXRpb24oNDMwKTtcbiAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgdGhpcy53ZWFwb24ua2luZCA9IFwic3dvcmRcIjtcbiAgICAgICAgaWYgKG9wdGlvbnMud2VhcG9uID09IFwiYXhcIikge1xuICAgICAgICAgICAgdGhpcy53ZWFwb24uc2V0RnJhbWVJbmRleCgyMCArIE1hdGgubWluKDksIHRoaXMubGV2ZWwpKTtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLmtpbmQgPSBcImF4XCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMud2VhcG9uID09IFwic3BlYXJcIikge1xuICAgICAgICAgICAgdGhpcy53ZWFwb24uc2V0RnJhbWVJbmRleCgzMCArIE1hdGgubWluKDksIHRoaXMubGV2ZWwpKTtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLmtpbmQgPSBcInNwZWFyXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAyeDJcIiwgMjQqMiwgMzIqMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygyMTYqMiwgMTI4KjIsIDcyKjIsIDEyOCoyKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0UG9zaXRpb24oMCwgLTUpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDEwMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozkuIDlrprmmYLplpPov73ot6HjgZnjgotcbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCAmJiAhdGhpcy5pc0F0dGFjayAmJiB0aGlzLnR1cm5UaW1lID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50dXJuVGltZSA9IDE1O1xuICAgICAgICAgICAgaWYgKGxvb2spIHRoaXMudHVybkNvdW50ID0gMDtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844KS6KaL5aSx44Gj44Gf54q25oWL44Gn5LiJ5Zue5oyv44KK6L+U44Gj44Gf5aC05ZCI44Gv6L+96Leh57WC5LqGXG4gICAgICAgICAgICBpZiAodGhpcy50dXJuQ291bnQgPiAzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAwLjU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMC41O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNKdW1wKSB0aGlzLnZ4ICo9IDI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAxMjA7XG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAwKSB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwKSB0aGlzLnZ4ICo9IDM7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+OBk+OCjOS7peS4iumAsuOCgeOBquOBhOWgtOWQiOOBr+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgdmFyIGlzUmV0dXJuV2FsbCA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGlzUmV0dXJuQ2xpZmYgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4ID4gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMV0uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzQwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy52eCA8IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkgaXNSZXR1cm5XYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSs0MCwgNSwgNSkgPT0gbnVsbCkgaXNSZXR1cm5DbGlmZiA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNSZXR1cm5XYWxsIHx8IGlzUmV0dXJuQ2xpZmYpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86L+96Leh5Lit44Gn5q615beu44GM44GC44KL5aC05ZCI44Gv6aOb44Gz6LaK44GI44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA8IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOi/vei3oeS4reOBp+W0luOBjOOBguOCi+WgtOWQiOOBr+edgOWcsOeCueOBjOOBguOCi+OBi+iqv+OBueOBpumjm+OBs+mZjeOCiuOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGp1bXBPayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgOTYpKSBqdW1wT2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgOTYpKSBqdW1wT2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp1bXBPaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v552A5Zyw54K544GM54Sh44GE5aC05ZCI44Gv6Kum44KB44Gm5oqY44KK6L+U44GZXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnR1cm5XYWl0ID0gMTU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIuLi5cIn0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50dXJuV2FpdCA9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+aUu+aSg1xuICAgICAgICAgICAgaWYgKGxvb2sgJiYgIXRoaXMuaXNKdW1wICYmIGRpcyA8IDY0ICYmICF0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2soKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zpo5vjgbPpgZPlhbfjgpLlvL7jgY9cbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844K344On44OD44OI44Go44Gu6Led6Zui5Yik5a6aXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXJMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBxZnQuUGxheWVyQXR0YWNrICYmIGUuaXNDb2xsaXNpb24gJiYgZS50eXBlID09IFwiYXJyb3dcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuZ2V0RGlzdGFuY2UoZSkgPCA2NCkgdGhhdC5ndWFyZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMzApIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICB9LFxuXG4gICAgYXR0YWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgd2lkdGggPSAyNCwgaGVpZ2h0ID0gMjQ7XG4gICAgICAgIHZhciBhdGsgPSBxZnQuRW5lbXlBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAyNCwgaGVpZ2h0OiA0OCwgcG93ZXI6IDIwICsgdGhpcy5sZXZlbCAqIDV9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5lbmVteUxheWVyKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCArIHRoaXMuc2NhbGVYICogMTgsIHRoaXMueSlcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjApO1xuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSBhdGsuc2V0QWxwaGEoMC4zKTtcbiAgICAgICAgYXRrLm1hc3RlciA9IHRoaXM7XG4gICAgICAgIGF0ay50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICBhdGsudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGF0LnggKyB0aGF0LnNjYWxlWCAqIDE4O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMud2VhcG9uLmtpbmQgPT0gXCJzd29yZFwiIHx8IHRoaXMud2VhcG9uLmtpbmQgPT0gXCJheFwiKSB7XG4gICAgICAgICAgICBhdGsuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC50byh7cm90YXRpb246IDI3MH0sIDIpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0ay5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNTdXBlckFybW9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52eCA9IDE2ICogdGhhdC5zY2FsZVg7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiA0MzB9LCA2KVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNTdXBlckFybW9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGF0ay5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLndlYXBvbi5raW5kID09IFwic3BlYXJcIikge1xuICAgICAgICAgICAgYXRrLndpZHRoID0gMzI7XG4gICAgICAgICAgICBhdGsuaGVpZ2h0ID0gODtcbiAgICAgICAgICAgIGF0ay5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDEsIHRoaXMueSk7XG4gICAgICAgICAgICBhdGsudHdlZW5lci5jbGVhcigpLmJ5KHt4OiAyMCAqIHRoaXMuc2NhbGVYfSwgMTApLmJ5KHt4OiAtMjAgKiB0aGlzLnNjYWxlWH0sIDEwKTtcbiAgICAgICAgICAgIGF0ay5pc0FjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDUsIHg6IC0yMH0pXG4gICAgICAgICAgICAgICAgLndhaXQoNilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc1N1cGVyQXJtb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnZ4ID0gMzIgKiB0aGF0LnNjYWxlWDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5ieSh7eDogMjB9LCAzKVxuICAgICAgICAgICAgICAgIC5ieSh7eDogLTMwfSwgNSlcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzU3VwZXJBcm1vciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDMwLCB4OiAtMn0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgfSxcblxuICAgIC8v6aOb44Gz6YGT5YW35by+44GNXG4gICAgZ3VhcmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciB3aWR0aCA9IDI0LCBoZWlnaHQgPSAyNDtcbiAgICAgICAgdmFyIGF0ayA9IHFmdC5FbmVteUF0dGFjayh0aGlzLnBhcmVudFNjZW5lLCB7d2lkdGg6IDI0LCBoZWlnaHQ6IDQ4LCBwb3dlcjogMjAgKyB0aGlzLmxldmVsICogNX0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLmVuZW15TGF5ZXIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy54ICsgdGhpcy5zY2FsZVggKiAxOCwgdGhpcy55KVxuICAgICAgICAgICAgLnNldEFscGhhKDAuMCk7XG4gICAgICAgIGlmIChERUJVR19DT0xMSVNJT04pIGF0ay5zZXRBbHBoYSgwLjMpO1xuICAgICAgICBhdGsubWFzdGVyID0gdGhpcztcbiAgICAgICAgYXRrLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIGF0ay51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoYXQueCArIHRoYXQuc2NhbGVYICogMTg7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDMwfSlcbiAgICAgICAgICAgIC50byh7cm90YXRpb246IDMwMH0sIDMpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnZ4ID0gNCAqIHRoYXQuc2NhbGVYO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50byh7cm90YXRpb246IDQzMH0sIDMpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhhdC5pc011dGVraSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGF0ay5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IE1hdGgubWluKDAsIDYgLSB0aGlzLmxldmVsKTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInR1cm5cIl0gPSBbNiwgXCJ3YWxrXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmFyY2htYWdlLmpzXG4gKiAgMjAxNy8wNS8wMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqLjg7zjgq/jg6HjgqTjgrhcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5BcmNoTWFnZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDUwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAzNjAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiA4MDAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAzMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDUsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB2YXIgbHYgPSBNYXRoLm1pbih0aGlzLmxldmVsLCAzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwM1wiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoKGx2ICUgMikgKiAxNDQgKyA3MiwgTWF0aC5mbG9vcihsdiAvIDIpICogMTI4LCA3MiwgMTI4KTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiAyO1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAzMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSAxO1xuICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIC8v5o6l6L+R5oim57WM6YGO5pmC6ZaTXG4gICAgICAgIHRoaXMubmVhckNvdW50ID0gMDtcblxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5kaXJlY3Rpb24gPT0gMCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsYXllciA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG4gICAgICAgIHZhciBkaXN0YW5jZSA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcblxuICAgICAgICAvL+OBk+OCjOS7peS4iumAsuOCgeOBquOBhOWgtOWQiOOBr+aKmOOCiui/lOOBmVxuICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkge1xuICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jg4bjg6rjg4jjg6rjg7zmjIflrppcbiAgICAgICAgaWYgKHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAvL+awtOW5s+aWueWQkeOBruOBv+ODgeOCp+ODg+OCr1xuICAgICAgICAgICAgdmFyIHR4ID0gdGhpcy54IC0gdGhpcy5maXJzdFg7XG4gICAgICAgICAgICBpZiAoTWF0aC5hYnModHgpID4gdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICBpZiAodHggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+mAmuW4uOODleOCp+ODvOOCuuOBp+ODl+ODrOOCpOODpOODvOOCkueZuuimi+OBl+OBn+OCieitpuaIkuODleOCp+ODvOOCuuOBq+enu+OCi1xuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAwICYmIGxvb2spIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgICAgIHRoaXMucGhhc2UgPSAxO1xuICAgICAgICAgICAgdGhpcy5zcGVlZCA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOmbouOCjOOBn+OCiemAmuW4uOODleOCp+ODvOOCulxuICAgICAgICBpZiAodGhpcy5waGFzZSAhPSAwKSB7XG4gICAgICAgICAgICBpZiAoZGlzdGFuY2UgPiAxOTIgfHwgIWxvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLnNwZWVkID0gMTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZGFnZ2VyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGFnZ2VyW2ldLnBoYXNlID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+mAmuW4uFxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gdGhpcy5zcGVlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA8IHBsYXllci54KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v6K2m5oiSXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDEpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJhbGxvb24gPT0gbnVsbCkgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIi4uLlwiLCBhbmltYXRpb25JbnRlcnZhbCA6IDE1fSk7XG4gICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCAxOTIpIHRoaXMucGhhc2UgPSAyO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMikge1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZGFnZ2VyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYWdnZXJbaV0uaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgOTIpIHRoaXMucGhhc2UgPSAzO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDMpIHtcbiAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRhZ2dlci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGFnZ2VyW2ldLnBoYXNlID0gMTA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gNCAmJiB0aGlzLnRpbWUgJSA5MCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlfSk7XG4gICAgICAgICAgICAgICAgYi5yb3RhdGlvbiA9IHRoaXMuZ2V0UGxheWVyQW5nbGUoKSArIE1hdGgucmFuZGludCgtMzAsIDMwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnBoYXNlID09IDQpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJCdWxsZXRcIiwge2V4cGxvZGU6IHRydWV9KTtcbiAgICAgICAgICAgICAgICAgICAgYi5yb3RhdGlvbiA9IHRoaXMuZ2V0UGxheWVyQW5nbGUoKSArIE1hdGgucmFuZGludCgtNjAsIDYwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlzdGFuY2UgPCA5Nikge1xuICAgICAgICAgICAgdGhpcy5uZWFyQ291bnQrKztcbiAgICAgICAgICAgIGlmICh0aGlzLm5lYXJDb3VudCA+IDkwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZWxlcG9ydCgpO1xuICAgICAgICAgICAgICAgIHRoaXMubmVhckNvdW50ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmVhckNvdW50IC09IDEwO1xuICAgICAgICAgICAgaWYgKHRoaXMubmVhckNvdW50IDwgMCkgdGhpcy5uZWFyQ291bnQgPSAwO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44OG44Os44Od44O844OIXG4gICAgdGVsZXBvcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZGFnZ2VyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmRhZ2dlcltpXS5waGFzZSA9IDEwO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBmaXJzdEZyYW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg57jgrjjg4Pjgq/jg4Djgqzjg7zoo4XlgplcbiAgICAgICAgdGhpcy5kYWdnZXIgPSBbXTtcbiAgICAgICAgdGhpcy5kYWdnZXJbMF0gPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiTWFnaWNEYWdnZXJcIiwge3BhcmVudDogdGhpcywgb2Zmc2V0WDogIDE2LCBvZmZzZXRZOiAtMTYsIG9yZGVyOiAwLCBsZXZlbDogdGhpcy5sZXZlbH0pO1xuICAgICAgICB0aGlzLmRhZ2dlclsxXSA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJNYWdpY0RhZ2dlclwiLCB7cGFyZW50OiB0aGlzLCBvZmZzZXRYOiAtMTYsIG9mZnNldFk6IC0xNiwgb3JkZXI6IDEsIGxldmVsOiB0aGlzLmxldmVsfSk7XG4gICAgICAgIGlmICh0aGlzLmxldmVsID4gMikgdGhpcy5kYWdnZXJbMl0gPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiTWFnaWNEYWdnZXJcIiwge3BhcmVudDogdGhpcywgb2Zmc2V0WDogLTMyLCBvZmZzZXRZOiAtOCwgb3JkZXI6IDIsIGxldmVsOiB0aGlzLmxldmVsfSk7XG4gICAgICAgIGlmICh0aGlzLmxldmVsID4gMykgdGhpcy5kYWdnZXJbM10gPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiTWFnaWNEYWdnZXJcIiwge3BhcmVudDogdGhpcywgb2Zmc2V0WDogIDMyLCBvZmZzZXRZOiAtOCwgb3JkZXI6IDMsIGxldmVsOiB0aGlzLmxldmVsfSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5iYWJ5ZGVtb24uanNcbiAqICAyMDE3LzAxLzEzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+ODmeODk+ODvOODh+ODvOODouODs1xucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkJhYnlEZW1vblwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDQwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDEyOCxcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA5MCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDUwMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDUsXG4gICAgZHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUxCT1gsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyMCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMlwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgNzIsIDEyOCk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMjtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDY7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICAvL+axjueUqOi/vei3oeOCouODq+OCtOODquOCuuODoFxuICAgICAgICB0aGlzLmNoYXNlQWxnb3JpdGhtKGRpcywgbG9vayk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonmlLvmkoNcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yICYmIGxvb2sgJiYgIXRoaXMuaXNKdW1wICYmIGRpcyA8IDY0KSB7XG4gICAgICAgICAgICAvL+mjm+OBs+OBi+OBi+OCi1xuICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy52eSA9IC02O1xuICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxvb2sgfHwgdGhpcy5jaGFzZVRpbWUgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnZ4ICo9IDQ7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5iaXJkLmpzXG4gKiAgMjAxNi8xMi8zMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/ps6VcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5CaXJkXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMzAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMjU2LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDYwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/mqKrnp7vli5XmuJvoobDnjodcbiAgICBmcmljdGlvbjogMCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDIwMCxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlQXJyb3c6IDUsXG5cbiAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgICBzcGVlZDogMixcbiAgICAgICAgZGlyZWN0aW9uOiAwLFxuICAgICAgICByZXR1cm5UaW1lOiAxMjAsXG4gICAgfSxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDEwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0NPSU4sXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMyxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fQkFHLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTh9KTtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB2YXIgY2FwTGV2ZWwgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoY2FwTGV2ZWwgKiA3MiwgMCwgNzIsIDEyOCkuc2V0U2NhbGUoMSArIGNhcExldmVsICogMC4xKTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiAxO1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAxMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuaXNWZXJ0aWNhbCA9IHRoaXMub3B0aW9ucy52ZXJ0aWNhbCB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSB0aGlzLm9wdGlvbnMuZGlyZWN0aW9uIHx8IHRoaXMuaXNWZXJ0aWNhbD8gOTA6IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSB0aGlzLm9wdGlvbnMuc3BlZWQgfHwgMjtcbiAgICAgICAgdGhpcy5yZXR1cm5UaW1lID0gdGhpcy5vcHRpb25zLnJldHVyblRpbWUgfHwgMTIwO1xuICAgICAgICB0aGlzLmJvbWJJbnRlcnZhbCA9IHRoaXMub3B0aW9ucy5ib21iSW50ZXJ2YWwgfHwgOTA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OB44Kn44OD44Kv44GZ44KL5aOB5rG65a6aXG4gICAgICAgIHZhciBjaGsgPSAwO1xuICAgICAgICBpZiAoIXRoaXMuaXNWZXJ0aWNhbCkgY2hrID0gMTtcblxuICAgICAgICAvL+WjgeOBq+W9k+OBn+OCi+OBi+S4gOWumuaZgumWk+e1jOmBjuOBp+aKmOOCiui/lOOBl1xuICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uW2Noa10uaGl0IHx8IHRoaXMuX2NvbGxpc2lvbltjaGsrMl0uaGl0IHx8IHRoaXMucmV0dXJuVGltZSA8IDApIHtcbiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgIHRoaXMucmV0dXJuVGltZSA9IHRoaXMub3B0aW9ucy5yZXR1cm5UaW1lO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgpLjgb/jgaTjgZHjgZ/jgonliqDpgJ9cbiAgICAgICAgaWYgKHRoaXMuaXNMb29rUGxheWVyKCkpIHtcbiAgICAgICAgICAgIHRoaXMuc3BlZWQgPSA0O1xuICAgICAgICAgICAgdGhpcy5yZXR1cm5UaW1lIC09IDI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNwZWVkID0gMjtcbiAgICAgICAgICAgIHRoaXMucmV0dXJuVGltZS0tO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/np7vli5VcbiAgICAgICAgdmFyIHJhZCA9IHRoaXMuZGlyZWN0aW9uLnRvUmFkaWFuKCk7XG4gICAgICAgIHRoaXMudnggPSBNYXRoLmNvcyhyYWQpICogdGhpcy5zcGVlZDtcbiAgICAgICAgdGhpcy52eSA9IE1hdGguc2luKHJhZCkgKiB0aGlzLnNwZWVkO1xuXG4gICAgICAgIC8v6JC944GX54mpXG4gICAgICAgIGlmICh0aGlzLm9uU2NyZWVuICYmIHRoaXMudGltZSAlIHRoaXMuYm9tYkludGVydmFsID09IDApIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJCaXJkQm9tYlwiLCB7fSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WQkeOBjeOBruaMh+WumlxuICAgICAgICBpZiAodGhpcy52eCAhPSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCAmJiB0aGlzLmdldERpc3RhbmNlUGxheWVyKCkgPCAyNTYpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPCB0aGlzLnBhcmVudFNjZW5lLnBsYXllci54KSB0aGlzLnNjYWxlWCA9IDE7IGVsc2UgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcblxuLy/ps6Xjga7okL3jgZfnialcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5CaXJkQm9tYlwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiA1LCBoZWlnaHQ6IDV9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJidWxsZXRcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoNzIpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB0aGlzLnJlbW92ZSgpO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm5vcm1hbFwiXSA9IFs3MiwgNzMsIDc0LCA3M107XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBkcm9wRGVhZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNEZWFkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0Ryb3AgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmJ1bGxldC5qc1xuICogIDIwMTcvMDEvMTNcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5CdWxsZXRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxLFxuXG4gICAgLy/lr7/lkb1cbiAgICBsaWZlc3BhbjogNzUsXG5cbiAgICAvL+mAn+W6plxuICAgIHZlbG9jaXR5OiAyLFxuXG4gICAgLy/liqDpgJ/luqZcbiAgICBhY2NlbDogMS4wMixcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDEuMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDAsXG5cbiAgICAvL+eIhueZuuODleODqeOCsFxuICAgIGV4cGxvZGU6IGZhbHNlLFxuXG4gICAgLy/lvbHooajnpLrjg5Xjg6njgrBcbiAgICBpc1NoYWRvdzogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyMCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlO1xuICAgICAgICB0aGlzLnBvd2VyID0gb3B0aW9ucy5wb3dlciB8fCB0aGlzLnBvd2VyO1xuICAgICAgICB0aGlzLnJvdGF0aW9uID0gb3B0aW9ucy5yb3RhdGlvbiB8fCAwO1xuICAgICAgICB0aGlzLnZlbG9jaXR5ID0gb3B0aW9ucy52ZWxvY2l0eSB8fCB0aGlzLnZlbG9jaXR5O1xuICAgICAgICB0aGlzLmxpZmVTcGFuID0gb3B0aW9ucy5saWZlU3BhbiB8fCB0aGlzLmxpZmVTcGFuO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiZXhwbG9kZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJlZmZlY3RcIiwgNDgsIDQ4KS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lVHJpbW1pbmcoMCwgMTkyLCAxOTIsIDk2KTtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcbiAgICAgICAgICAgICAgICB0aGlzLmV4cGxvZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmlnbm9yZUNvbGxpc2lvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5pc011dGVraSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXR0ZXJuID0gXCJleHBsb2RlXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJidWxsZXRcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoOSk7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgICAgICAgICAgICAgdGhpcy5leHBsb2RlID0gb3B0aW9ucy5leHBsb2RlIHx8IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXR0ZXJuID0gb3B0aW9ucy5wYXR0ZXJuIHx8IFwicGF0dGVybjFcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKHRoaXMucGF0dGVybik7XG5cbiAgICAgICAgdGhpcy5vbignZGVhZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZXhwbG9kZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FZmZlY3QodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJib21iXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHJhZCA9IHRoaXMucm90YXRpb24udG9SYWRpYW4oKTtcbiAgICAgICAgdGhpcy52eCA9IE1hdGguY29zKHJhZCkgKiB0aGlzLnZlbG9jaXR5O1xuICAgICAgICB0aGlzLnZ5ID0gTWF0aC5zaW4ocmFkKSAqIHRoaXMudmVsb2NpdHk7XG4gICAgICAgIHRoaXMudmVsb2NpdHkgKj0gdGhpcy5hY2NlbDtcbiAgICAgICAgaWYgKHRoaXMudnggPiAxKSB0aGlzLnNwcml0ZS5zY2FsZVggPSAxOyBlbHNlIHRoaXMuc3ByaXRlLnNjYWxlWCA9IC0xO1xuICAgICAgICBpZiAodGhpcy50aW1lID4gdGhpcy5saWZlc3BhbikgdGhpcy5yZW1vdmUoKTtcblxuICAgICAgICBpZiAoIXRoaXMuaWdub3JlQ29sbGlzaW9uKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzBdLmhpdCB8fFxuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblsxXS5oaXQgfHxcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0uaGl0IHx8XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzNdLmhpdCkgdGhpcy5mbGFyZSgnZGVhZCcpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjFcIl0gPSBbOSwgMTAsIDExLCAxMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJwYXR0ZXJuMlwiXSA9IFsxNSwgMTYsIDE3LCAxNl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJleHBsb2RlXCJdID0gWzAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIFwicmVtb3ZlXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgaGl0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PSBcImV4cGxvZGVcIikgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMuZmxhcmUoJ2RlYWQnKTtcbiAgICB9LFxuXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgIHRoaXMudnkgPSAtMTA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuZGVhdGguanNcbiAqICAyMDE2LzEyLzMxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+atu+elnlxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkRlYXRoXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMzAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDIwLFxuXG4gICAgLy/msJfntbbnorrnjodcbiAgICBzdHVuUG93ZXI6IDMwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDE4MCxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/jg47jg4Pjgq/jg5Djg4Pjgq/jgq3jg6Pjg7Pjgrvjg6tcbiAgICBpc1N1cGVyQXJtb3I6IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiA1MDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9TVE9ORSxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9TVE9ORSxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlRmlyZTogMi4wLFxuICAgIGRhbWFnZUljZTogMC44LFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTZ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDAsIDEyOCwgNzIsIDEyOCk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibW92ZVwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSAxO1xuXG4gICAgICAgIC8v6KGM5YuV44OR44K/44O844OzXG4gICAgICAgIHRoaXMucGF0dGVybiA9IG9wdGlvbnMucGF0dGVybiB8fCBcImxpbmVhclwiO1xuICAgICAgICB0aGlzLm1vdmVMZW5ndGggPSBvcHRpb25zLmxlbmd0aCB8fCA0ODtcbiAgICAgICAgdGhpcy5kZWdyZWUgPSAwO1xuICAgICAgICB0aGlzLmlzVmVydGljYWwgPSBmYWxzZTtcblxuICAgICAgICAvL+iiq+ODgOODoeODvOOCuOaZguWHpueQhlxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy50d2VlbmVyMiA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcyk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgdmFyIHJhZCA9IHRoaXMuZGVncmVlLnRvUmFkaWFuKCk7XG4gICAgICAgIGlmICh0aGlzLnBhdHRlcm4gPT0gXCJsaW5lYXJcIikge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnkgPSBNYXRoLmNvcyhyYWQpICogMjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IE1hdGguY29zKHJhZCkgKiAyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGVncmVlICs9IDI7XG5cbiAgICAgICAgLy/lvpjlvorjg6Ljg7zjg4njga7loLTlkIjjga/pganlvZPjgavmlLvmkoNcbiAgICAgICAgaWYgKHRoaXMudGltZSAlIDkwID09IDApIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuXG4gICAgICAgIC8v5pS75pKDXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJEZWF0aEZsYW1lXCIsIHtwYXR0ZXJuOiAwfSk7XG4gICAgICAgICAgICBiLnZ5ID0gLTI7XG4gICAgICAgICAgICBiLnZ4ID0gMiAqIHRoaXMuc2NhbGVYO1xuICAgICAgICAgICAgdGhpcy5hY3Rpb25XYWl0ID0gMTIwO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibW92ZVwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gWzYsIDcsIDYsIDhdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9ICAgWzAsIDEsIDAsIDJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG5cbi8v54KOXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuRGVhdGhGbGFtZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAuMSxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAuOTgsXG5cbiAgICAvL+awl+e1tueiuueOh1xuICAgIHN0dW5Qb3dlcjogMjAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogZmFsc2UsXG5cbiAgICAvL+eEoeaVteODleODqeOCsFxuICAgIGlzTXV0ZWtpOiB0cnVlLFxuXG4gICAgLy/mlLvmkoPlvZPjgZ/jgorliKTlrprmnInlirnjg5Xjg6njgrBcbiAgICBpc0F0dGFja0NvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5a+/5ZG9XG4gICAgbGlmZVNwYW46IDEyMCxcblxuICAgIC8v5b2x6KGo56S644OV44Op44KwXG4gICAgaXNTaGFkb3c6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMucGF0dGVybiA9IG9wdGlvbnMucGF0dGVybiB8fCAwO1xuICAgICAgICB0aGlzLmxpZmVTcGFuID0gb3B0aW9ucy5saWZlU3BhbiB8fCAxMjA7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDU7XG5cbiAgICAgICAgdGhpcy5zZXR1cEFuaW1hdGlvbih0aGlzLnBhdHRlcm4pO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJmbGFtZTAzXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygwLCAwLCAxNDQsIDEyOCkuc2V0RnJhbWVJbmRleCgxNSArIHRoaXMucGF0dGVybik7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJhcHBlYXJcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMubGlmZVNwYW4gPT0gMCkgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgaWYgKHRoaXMubGlmZVNwYW4gPCAzMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZSAlIDIgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmxpZmVTcGFuIDwgNjApe1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZSAlIDUgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmxpZmVTcGFuIDwgOTApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAxMCA9PSAwKSB0aGlzLnZpc2libGUgPSAhdGhpcy52aXNpYmxlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGlmZVNwYW4tLTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgIGluZGV4ID0gaW5kZXggfHwgMDtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXBwZWFyXCJdID0gWzE1K2luZGV4LCA5K2luZGV4LCAgMytpbmRleCwgMjEraW5kZXgsIFwibm9ybWFsXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWyAwK2luZGV4LCA2K2luZGV4LCAxMitpbmRleCwgMTgraW5kZXhdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5kZW1vbi5qc1xuICogIDIwMTcvMDEvMTNcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44OH44O844Oi44OzXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuRGVtb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMDAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDMwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTkyLFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDkwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogNTAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogNSxcbiAgICBkcm9wSXRlbTogSVRFTV9KRVdFTCxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAyLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9KRVdFTEJPWCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDIwLCBoZWlnaHQ6IDIwfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyhNYXRoLm1pbih0aGlzLmxldmVsLCA0KSAqIDcyLCA2NDAsIDcyLCAxMjgpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMS41KVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKDAsIC04KTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiAxMDtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMztcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMzAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDY7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5kaXJlY3Rpb24gPT0gMCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7ot53pm6JcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/ltJbjgaPjgbfjgaHjgafmipjjgorov5TjgZlcbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCAxNikgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCAxNikgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/lo4HjgavlvZPjgZ/jgaPjgZ/jgonmipjjgorov5TjgZlcbiAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMV0uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6L+R44GP44Gr44GE44Gf44KJ5pS75pKDXG4gICAgICAgICAgICBpZiAobG9vayAmJiAhdGhpcy5pc0p1bXAgJiYgIXRoaXMuaXNBdHRhY2spIHtcbiAgICAgICAgICAgICAgICBpZiAoZGlzID4gOTYpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/ngavjgpLlkJDjgY9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlYmFsbCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8v6aOb44Gz44GL44GL44KLXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC02O1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLnZ4ICo9IDM7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZGlzIDwgMjU2KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+eBq+eQg+OCkuWQkOOBj1xuICAgIGZpcmViYWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgdmFyIHR3ID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0aGlzKS5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJCdWxsZXRcIiwge2V4cGxvZGU6IHRydWUsIHBvd2VyOiAxMCArIHRoaXMubGV2ZWwgKiA1LCByb3RhdGlvbjogdGhpcy5nZXRQbGF5ZXJBbmdsZSgpfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdHcucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v54Gr44KS5ZCQ44GPXG4gICAgZmxhbWluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gNjA7XG4gICAgICAgIHRoaXMuc3ByaXRlMi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5mYWRlSW4oMTUpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmZhZGVPdXQoMTUpO1xuXG4gICAgICAgIHZhciByb3QgPSAodGhpcy5zY2FsZVggPT0gMSk/IDA6IDE4MDtcbiAgICAgICAgdmFyIGN0ID0gMDtcbiAgICAgICAgdmFyIHR3ID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54ICsgMjQgKiB0aGlzLnNjYWxlWCwgdGhpcy55LTgsIFwiQnVsbGV0XCIsIHt0eXBlOiBcImV4cGxvZGVcIiwgcG93ZXI6IDEwLCByb3RhdGlvbjogdGhpcy5nZXRQbGF5ZXJBbmdsZSgpLCB2ZWxvY2l0eTogNX0pO1xuICAgICAgICAgICAgICAgIGIuc2V0U2NhbGUoMC4xKTtcbiAgICAgICAgICAgICAgICBiLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKS50byh7c2NhbGVYOiAxLCBzY2FsZVk6IDF9LCAxMCk7XG4gICAgICAgICAgICAgICAgY3QrKztcbiAgICAgICAgICAgICAgICBpZiAoY3QgPT0gNiB8fCB0aGlzLmF0dGFja0NhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICB0dy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFja0NhbmNlbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg1KVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuZGV2aWwuanNcbiAqICAyMDE3LzA0LzI1XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+aCqumtlFxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkRldmlsXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMzAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAwLjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMjU2LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDM2MCxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogODAwLFxuXG4gICAgLy/lsZ7mgKfjg4Djg6Hjg7zjgrjlgI3njodcbiAgICBkYW1hZ2VBcnJvdzogNSxcblxuICAgIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgICAgIHNwZWVkOiAyLFxuICAgICAgICBkaXJlY3Rpb246IDAsXG4gICAgICAgIHJldHVyblRpbWU6IDEyMCxcbiAgICB9LFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fQkFHLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDUsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX1NUT05FLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTh9KS4kc2FmZSh0aGlzLmRlZmF1bHRPcHRpb25zKTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDcyLCAwLCA3MiwgMTI4KTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiAxMDtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwic3RhbmRcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5pc1ZlcnRpY2FsID0gdGhpcy5vcHRpb25zLnZlcnRpY2FsIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMub3B0aW9ucy5kaXJlY3Rpb24gfHwgdGhpcy5pc1ZlcnRpY2FsPyA5MDogMDtcbiAgICAgICAgdGhpcy5zcGVlZCA9IHRoaXMub3B0aW9ucy5zcGVlZCB8fCAyO1xuICAgICAgICB0aGlzLnJldHVyblRpbWUgPSB0aGlzLm9wdGlvbnMucmV0dXJuVGltZSB8fCAxMjA7XG4gICAgICAgIHRoaXMuYXR0YWNrSW50ZXJ2YWwgPSB0aGlzLm9wdGlvbnMuYXR0YWNrSW50ZXJ2YWwgfHwgOTA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCxXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonlr4TjgaPjgabjgYTjgY9cbiAgICAgICAgaWYgKGxvb2sgJiYgZGlzID4gMzIpIHtcbiAgICAgICAgICAgIHZhciBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIocGwueCwgcGwueSk7XG4gICAgICAgICAgICB2YXIgcCA9IHAyLnN1YihwMSk7XG4gICAgICAgICAgICBwLm5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgdGhpcy52eCA9IHAueCAqICgxICsgdGhpcy5sZXZlbCAqIDAuMik7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gcC55ICogKDEgKyB0aGlzLmxldmVsICogMC4yKTtcblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjga7mlrnlkJHjgpLlkJHjgY9cbiAgICAgICAgICAgIHZhciBhbmdsZSA9IHRoaXMuZ2V0UGxheWVyQW5nbGUoKTtcbiAgICAgICAgICAgIGlmIChhbmdsZSA+IDMxNSB8fCBhbmdsZSA8IDQ1KSB0aGlzLnNldEFuaW1hdGlvbignaG9yaXpvbicpO1xuICAgICAgICAgICAgaWYgKCA0NSA8IGFuZ2xlICYmIGFuZ2xlIDwgMTM1KSB0aGlzLnNldEFuaW1hdGlvbignZG93bicpO1xuICAgICAgICAgICAgaWYgKDEzNSA8IGFuZ2xlICYmIGFuZ2xlIDwgMjI1KSB0aGlzLnNldEFuaW1hdGlvbignaG9yaXpvbicpO1xuICAgICAgICAgICAgaWYgKDIyNSA8IGFuZ2xlICYmIGFuZ2xlIDwgMzE1KSB0aGlzLnNldEFuaW1hdGlvbignZG93bicpO1xuXG4gICAgICAgICAgICAvL+S4gOWumuS7peS4iui/keOBpeOBhOOBn+OCieaUu+aSg1xuICAgICAgICAgICAgaWYgKGRpcyA8IDk2KSB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcblxuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwic3RhbmRcIik7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnZ4ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFjaygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlLCBwb3dlcjogMTAgKyB0aGlzLmxldmVsICogNSwgcm90YXRpb246IHRoaXMuZ2V0UGxheWVyQW5nbGUoKX0pO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzYsIDcsIDgsIDddO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzUsIDYsIDcsIDZdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiaG9yaXpvblwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5leHBsb2RlLmpzXG4gKiAgMjAxNy8wNy8wMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkV4cGxvZGVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/mqKrnp7vli5XmuJvoobDnjodcbiAgICBmcmljdGlvbjogMC45OCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDAsXG5cbiAgICAvL+eEoeaVteODleODqeOCsFxuICAgIGlzTXV0ZWtpOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjAsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJlZmZlY3RcIiwgNDgsIDQ4KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRGcmFtZVRyaW1taW5nKDAsIDE5MiwgMTkyLCA5Nik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuXG4gICAgICAgIHRoaXMucG93ZXIgPSBvcHRpb25zLnBvd2VyIHx8IHRoaXMucG93ZXI7XG5cbiAgICAgICAgdGhpcy5wYXR0ZXJuID0gb3B0aW9ucy5wYXR0ZXJuIHx8IFwicGF0dGVybjFcIjtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24odGhpcy5wYXR0ZXJuKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmluZGV4ID09IDgpIHRoaXMucmVtb3ZlKCk7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjFcIl0gPSBbMCwgMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmZpcmViaXJkLmpzXG4gKiAgMjAxNi8wMy8wOVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/ps6VcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5GaXJlQmlyZFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDUwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA5MCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAzMDAsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZUFycm93OiA1LFxuICAgIGRhbWFnZUZpcmU6IDAuNSxcbiAgICBkYW1hZ2VJY2U6IDIsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgICAgIHNwZWVkOiAyLFxuICAgICAgICBkaXJlY3Rpb246IDAsXG4gICAgICAgIHJldHVyblRpbWU6IDEyMCxcbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTYsIG9mZnNldENvbGxpc2lvblg6IC02fSk7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zLiRzYWZlKHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygyODgsIDAsIDcyLCAxMjgpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDY7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmlzVmVydGljYWwgPSB0aGlzLm9wdGlvbnMudmVydGljYWwgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gdGhpcy5vcHRpb25zLmRpcmVjdGlvbiB8fCB0aGlzLmlzVmVydGljYWw/IDkwOiAwO1xuICAgICAgICB0aGlzLnNwZWVkID0gdGhpcy5vcHRpb25zLnNwZWVkIHx8IDI7XG4gICAgICAgIHRoaXMucmV0dXJuVGltZSA9IHRoaXMub3B0aW9ucy5yZXR1cm5UaW1lIHx8IDEyMDtcbiAgICAgICAgdGhpcy5ib21iSW50ZXJ2YWwgPSB0aGlzLm9wdGlvbnMuYm9tYkludGVydmFsIHx8IDkwO1xuICAgICAgICB0aGlzLmF0dGFja0ludGVydmFsID0gMDtcbiAgICAgICAgdGhpcy5hdHRhY2tDb3VudCA9IDk5O1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub24oJ2RlYWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FZmZlY3QodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODgeOCp+ODg+OCr+OBmeOCi+WjgeaxuuWumlxuICAgICAgICB2YXIgY2hrID0gMTtcbiAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkgY2hrID0gMDtcblxuICAgICAgICAvL+WjgeOBq+W9k+OBn+OCi+OBi+S4gOWumuaZgumWk+e1jOmBjuOBp+aKmOOCiui/lOOBl1xuICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uW2Noa10uaGl0IHx8IHRoaXMuX2NvbGxpc2lvbltjaGsrMl0uaGl0IHx8IHRoaXMucmV0dXJuVGltZSA8IDApIHtcbiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgIHRoaXMucmV0dXJuVGltZSA9IHRoaXMub3B0aW9ucy5yZXR1cm5UaW1lO1xuICAgICAgICB9XG4gICAgICAgIC8v56e75YuVXG4gICAgICAgIHZhciByYWQgPSB0aGlzLmRpcmVjdGlvbi50b1JhZGlhbigpO1xuICAgICAgICB0aGlzLnZ4ID0gTWF0aC5jb3MocmFkKSAqIHRoaXMuc3BlZWQ7XG4gICAgICAgIHRoaXMudnkgPSBNYXRoLnNpbihyYWQpICogdGhpcy5zcGVlZDtcbiAgICAgICAgdGhpcy5yZXR1cm5UaW1lLS07XG4gXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844KS6KaL44Gk44GR44Gf44KJ5pS75pKDXG4gICAgICAgIHZhciBsb29rUGxheWVyID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcbiAgICAgICAgaWYgKGxvb2tQbGF5ZXIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmF0dGFja0ludGVydmFsID09IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSs2LCBcIkJ1bGxldFwiLCB7cGF0dGVybjogXCJwYXR0ZXJuMlwiLCBleHBsb2RlOiB0cnVlLCB2ZWxvY2l0eTogM30pO1xuICAgICAgICAgICAgICAgIGIucm90YXRpb24gPSB0aGlzLmdldFBsYXllckFuZ2xlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2tJbnRlcnZhbCA9IDkwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrSW50ZXJ2YWwgPSA2MDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v6JC944GX54mpXG4gICAgICAgIGlmICh0aGlzLm9uU2NyZWVuICYmIHRoaXMudGltZSAlIHRoaXMuYm9tYkludGVydmFsID09IDApIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJGaXJlQmlyZEJvbWJcIiwge30pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/lkJHjgY3jga7mjIflrppcbiAgICAgICAgaWYgKHRoaXMudnggIT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwgJiYgdGhpcy5nZXREaXN0YW5jZVBsYXllcigpIDwgMjU2KSB7XG4gICAgICAgICAgICBpZiAodGhpcy54IDwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCkgdGhpcy5zY2FsZVggPSAxOyBlbHNlIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5hdHRhY2tJbnRlcnZhbCA+IDApIHRoaXMuYXR0YWNrSW50ZXJ2YWwtLTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgYXR0YWNrOiBmdW5jdGlvbigpIHtcbiAgICB9LFxufSk7XG5cbi8v6bOl44Gu6JC944GX54mpXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuRmlyZUJpcmRCb21iXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMSxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogNSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDUsIGhlaWdodDogNX0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJ1bGxldFwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCg3Mik7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FZmZlY3QodGhpcy54LCB0aGlzLnksIHtuYW1lOiBcImV4cGxvZGVfZ3JvdW5kXCJ9KTtcbiAgICAgICAgICAgIGlmICh0aGlzLm9uU2NyZWVuKSBhcHAucGxheVNFKFwiYm9tYlwiKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJub3JtYWxcIl0gPSBbNzIsIDczLCA3NCwgNzNdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5mbGFtZS5qc1xuICogIDIwMTYvMTIvMzFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v54KOXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuRmxhbWVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/nhKHmlbXjg5Xjg6njgrBcbiAgICBpc011dGVraTogdHJ1ZSxcblxuICAgIC8v5pS75pKD5b2T44Gf44KK5Yik5a6a5pyJ5Yq544OV44Op44KwXG4gICAgaXNBdHRhY2tDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+Wvv+WRvVxuICAgIGxpZmVTcGFuOiAxMjAsXG5cbiAgICAvL+W9seihqOekuuODleODqeOCsFxuICAgIGlzU2hhZG93OiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDIwfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLnBhdHRlcm4gPSBvcHRpb25zLnBhdHRlcm4gfHwgMDtcbiAgICAgICAgdGhpcy5saWZlU3BhbiA9IG9wdGlvbnMubGlmZVNwYW4gfHwgMTIwO1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJmbGFtZTAyXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyhNYXRoLm1pbih0aGlzLnBhdHRlcm4sIDIpICogMjQgKyA3MiwgMCwgMjQsIDEyOCk7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMubGlmZVNwYW4gPT0gMCkgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgaWYgKHRoaXMubGlmZVNwYW4gPCAzMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZSAlIDIgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmxpZmVTcGFuIDwgNjApe1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZSAlIDUgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmxpZmVTcGFuIDwgOTApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAxMCA9PSAwKSB0aGlzLnZpc2libGUgPSAhdGhpcy52aXNpYmxlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGlmZVNwYW4tLTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJub3JtYWxcIl0gPSBbMCwgMSwgMiwgM107XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBkcm9wRGVhZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNEZWFkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0Ryb3AgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmdhcnVkYS5qc1xuICogIDIwMTcvMDcvMDdcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v5oCq6bOlXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuR2FydWRhXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogODAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDIwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMjU2LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDYwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/mqKrnp7vli5XmuJvoobDnjodcbiAgICBmcmljdGlvbjogMCxcblxuICAgIC8v44K544O844OR44O844Ki44O844Oe44O8XG4gICAgaXNTdXBlckFybW9yOiB0cnVlLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMzAwMCxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlQXJyb3c6IDUsXG5cbiAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgICBzcGVlZDogMixcbiAgICAgICAgZGlyZWN0aW9uOiAwLFxuICAgICAgICByZXR1cm5UaW1lOiAxMjAsXG4gICAgfSxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDEwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0NPSU4sXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMyxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fQkFHLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTh9KTtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxeDJcIiwgNDgsIDY0KS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDAsIDAsIDcyICogMiwgMTI4ICogMikuc2V0U2NhbGUoMS41KS5zZXRQb3NpdGlvbigwLCAxNik7XG5cbiAgICAgICAgdGhpcy5zcHJpdGUyID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDF4MlwiLCA0OCwgNjQpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlMi5zZXRGcmFtZVRyaW1taW5nKDI4OCAqIDIsIDAsIDcyICogMiwgMTI4ICogMikuc2V0U2NhbGUoMS41KS5zZXRQb3NpdGlvbigwLCAxNikuc2V0QWxwaGEoMCk7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5zcHJpdGUyLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5mcmFtZUluZGV4ID0gdGhhdC5zcHJpdGUuZnJhbWVJbmRleDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDY7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLm1vdmVUaW1lID0gMDtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMucGF0aCkge1xuICAgICAgICAgICAgdmFyIHAgPSB0aGlzLmdldFBhdGhQb3NpdGlvbih0aGlzLm1vdmVUaW1lKTtcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24ocC54LCBwLnkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubW92ZVRpbWUgKz0gMjtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzAsIDEsIDIsIDFdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFs2LCA3LCA4LCA3XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuZ3JlYXRlcmRlbW9uLmpzXG4gKiAgMjAxNy8wNS8wMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrDjg6zjg7zjgr/jg7zjg4fjg7zjg6Ljg7NcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5HcmVhdGVyRGVtb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDIwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMjU2LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDE4MCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDE1LFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogNTAwMCxcblxuICAgIC8v6aOb6KGM44Oi44O844OJXG4gICAgZmx5aW5nOiBmYWxzZSxcbiAgICBmbHlpbmdQaGFzZTogMCwgLy/ooYzli5Xjg5Xjgqfjg7zjgrpcbiAgICBmbHlpbmdYOiAwLCAgICAgLy/po5vooYzplovlp4vvvLjluqfmqJlcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDEwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0pFV0VMLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDIsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0pFV0VMQk9YLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMzUsIGhlaWdodDogMzB9KTtcbiAgICAgICAgaWYgKG9wdGlvbnMuc2l6ZSkge1xuICAgICAgICAgICAgdmFyIHNpemUgPSBvcHRpb25zLnNpemUgfHwgMTtcbiAgICAgICAgICAgIG9wdGlvbnMud2lkdGggPSBzaXplICogMzU7XG4gICAgICAgICAgICBvcHRpb25zLmhlaWdodCA9IHNpemUgKiAzMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMXgyXCIsIDI0KjIsIDMyKjIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoNzIqMioyLCA2NDAqMiwgNzIqMiwgMTI4KjIpLnNldFBvc2l0aW9uKDAsIC0xMCk7XG4gICAgICAgIGlmIChvcHRpb25zLnNpemUpIHtcbiAgICAgICAgICAgIHZhciBzaXplID0gb3B0aW9ucy5zaXplIHx8IDE7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZS5zZXRTY2FsZShzaXplKS5zZXRQb3NpdGlvbigwLCBzaXplICogLTEyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc3ByaXRlMiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxeDJcIiwgMjQqMiwgMzIqMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRBbHBoYSgwKTtcbiAgICAgICAgdGhpcy5zcHJpdGUyLnNldEZyYW1lVHJpbW1pbmcoMjg4KjIsIDY0MCoyLCA3MioyLCAxMjgqMikuc2V0UG9zaXRpb24oMCwgLTEwKTtcbiAgICAgICAgdGhpcy5zcHJpdGUyLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIGlmIChvcHRpb25zLnNpemUpIHtcbiAgICAgICAgICAgIHZhciBzaXplID0gb3B0aW9ucy5zaXplIHx8IDE7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZTIuc2V0U2NhbGUoc2l6ZSkuc2V0UG9zaXRpb24oMCwgc2l6ZSAqIC0xMik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLnNwcml0ZTIudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmZyYW1lSW5kZXggPSB0aGF0LnNwcml0ZS5mcmFtZUluZGV4O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzQXR0YWNrQ2FuY2VsID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgdGhpcy50dXJuVGltZSA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIHRoaXMuaXNBdHRhY2tDYW5jZWwgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmg4XloLFcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICAvL+mAsuihjOaWueWQkeaxuuWumlxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O855m66KaL5b6M5LiA5a6a5pmC6ZaT6L+96Leh44GZ44KLXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDEyMDtcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy52eCAqPSAzO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDAgJiYgIXRoaXMuaXNBdHRhY2sgJiYgdGhpcy50dXJuVGltZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHVyblRpbWUgPSAxNTtcbiAgICAgICAgICAgIGlmIChsb29rKSB0aGlzLnR1cm5Db3VudCA9IDA7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+WkseOBo+OBn+eKtuaFi+OBp+S4ieWbnuaMr+OCiui/lOOBo+OBn+WgtOWQiOOBr+i/vei3oee1guS6hlxuICAgICAgICAgICAgaWYgKHRoaXMudHVybkNvdW50ID4gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8v5LiA5a6a6Led6Zui5Lul5LiK6Zui44KM44Gf44KJ6L+96Leh6Kej6ZmkXG4gICAgICAgIGlmIChkaXMgPiA1MTIpIHRoaXMuY2hhc2VUaW1lID0gMDtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844G444Gu5pS75pKDXG4gICAgICAgICAgICBpZiAobG9vayAmJiAhdGhpcy5pc0F0dGFjayAmJiAhdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgICAgICBpZiAoZGlzID4gMTI4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZWJyZWF0aCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwbG9kaW5nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDMwKSB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgfSxcblxuICAgIC8v54Gr55CD44KS5ZCQ44GPXG4gICAgZmlyZWJhbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICB0aGlzLnNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZUluKDEwKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJCdWxsZXRcIiwge2V4cGxvZGU6IHRydWUsIHJvdGF0aW9uOiB0aGlzLmdldFBsYXllckFuZ2xlKCksIHBvd2VyOiAzMH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53YWl0KDQ1KVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZmFkZU91dCgxMCk7XG4gICAgfSxcblxuICAgIC8v54KO44KS5ZCQ44GPXG4gICAgZmlyZWJyZWF0aDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gNjA7XG4gICAgICAgIHRoaXMuc3ByaXRlMi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5mYWRlSW4oMTUpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmZhZGVPdXQoMTUpO1xuXG4gICAgICAgIHZhciByb3QgPSAodGhpcy5zY2FsZVggPT0gMSk/IDA6IDE4MDtcbiAgICAgICAgdmFyIGN0ID0gMDtcbiAgICAgICAgdmFyIHR3ID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54ICsgMjQgKiB0aGlzLnNjYWxlWCwgdGhpcy55LTgsIFwiQnVsbGV0XCIsIHt0eXBlOiBcImV4cGxvZGVcIiwgcG93ZXI6IDEwLCByb3RhdGlvbjogdGhpcy5nZXRQbGF5ZXJBbmdsZSgpLCB2ZWxvY2l0eTogNX0pO1xuICAgICAgICAgICAgICAgIGIuc2V0U2NhbGUoMC4xKTtcbiAgICAgICAgICAgICAgICBiLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKS50byh7c2NhbGVYOiAxLCBzY2FsZVk6IDF9LCAxMCk7XG4gICAgICAgICAgICAgICAgY3QrKztcbiAgICAgICAgICAgICAgICBpZiAoY3QgPT0gNiB8fCB0aGlzLmF0dGFja0NhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICB0dy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFja0NhbmNlbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg1KVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgfSxcblxuICAgIC8v54iG55m6XG4gICAgZXhwbG9kaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gNjA7XG4gICAgICAgIHRoaXMuc3ByaXRlMi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5mYWRlSW4oMTUpXG4gICAgICAgICAgICAud2FpdCg0NSlcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmZhZGVPdXQoMTUpO1xuXG4gICAgICAgIHZhciByb3QgPSAodGhpcy5zY2FsZVggPT0gMSk/IDA6IDE4MDtcbiAgICAgICAgdmFyIGN0ID0gMDtcbiAgICAgICAgdmFyIHR3ID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIHJhZCA9IHJvdC50b1JhZGlhbigpO1xuICAgICAgICAgICAgICAgIHZhciBleCA9IE1hdGguY29zKHJhZCkgKiAxNjtcbiAgICAgICAgICAgICAgICB2YXIgZXkgPSBNYXRoLnNpbihyYWQpICogMTY7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCArIGV4LCB0aGlzLnkgKyBleSwgXCJCdWxsZXRcIiwge3R5cGU6IFwiZXhwbG9kZVwiLCBwb3dlcjogMTAsIHJvdGF0aW9uOiByb3QsIHZlbG9jaXR5OiAzfSk7XG4gICAgICAgICAgICAgICAgcm90ICs9IDIyLjU7XG4gICAgICAgICAgICAgICAgY3QrKztcbiAgICAgICAgICAgICAgICBpZiAoY3QgPT0gMTYgfHwgdGhpcy5hdHRhY2tDYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdHcucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2tDYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoMSlcbiAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmludGVsbGlnZW50c3dvcmQuanNcbiAqICAyMDE3LzA3LzE5XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuSW50ZWxsaWdlbnRTd29yZFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDIwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/mqKrnp7vli5XmuJvoobDnjodcbiAgICBmcmljdGlvbjogMS4wLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAyMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDEyOCxcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAzNjAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAyMDAwLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7Pjg5Xjg6njgrBcbiAgICBpc0FuaW1hdGlvbjogZmFsc2UsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9MT05HU1dPUkQsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMSxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fTE9OR1NXT1JELFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMjR9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0RnJhbWVJbmRleCgxMCArIE1hdGgubWluKDksIHRoaXMubGV2ZWwpKVxuICAgICAgICAgICAgLnNldFJvdGF0aW9uKDIxNSk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnRvKHt5OiAtMn0sIDEwMDAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgLnRvKHt5OiA0fSwgMTAwMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAuc2V0TG9vcCh0cnVlKTtcblxuICAgICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGU7XG4gICAgICAgIHRoaXMucG93ZXIgPSBvcHRpb25zLnBvd2VyIHx8IHRoaXMucG93ZXI7XG4gICAgICAgIHRoaXMucm90YXRpb24gPSBvcHRpb25zLnJvdGF0aW9uIHx8IDA7XG4gICAgICAgIHRoaXMudmVsb2NpdHkgPSBvcHRpb25zLnZlbG9jaXR5IHx8IHRoaXMudmVsb2NpdHk7XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IDA7XG5cbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembolxuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDApIHtcbiAgICAgICAgICAgIGlmIChsb29rICYmIGRpcyA8IDY0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMikge1xuICAgICAgICAgICAgdmFyIGFuZyA9IHRoaXMuZ2V0QW5nbGUocGwpO1xuICAgICAgICAgICAgdGhpcy5yb3RhdGlvbiA9IGFuZyArIDMwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCIsIGxpZmVTcGFuOiAxNSwgeTogMH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJwYXR0ZXJuMVwiXSA9IFswXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIHNuYXA6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAvL+WKueaenOmfs1xuICAgICAgICBhcHAucGxheVNFKFwidGlua2xpbmdcIik7XG4gICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuYnkoe3k6IC02NCwgcm90YXRpb246IDcwMH0sIDE1LCBcImVhc2VPdXRRdWFkXCIpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMTA7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkua25pZ2h0LmpzXG4gKiAgMjAxNy8wNS8wNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jg4rjgqTjg4hcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5LbmlnaHRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA3MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+mAn+W6plxuICAgIHNwZWVkOiAxLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTkyLFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDkwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMTAwMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDcsXG4gICAgZHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fTE9OR1NXT1JELFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjAsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v5q2m5Zmo44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMud2VhcG9uID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0RnJhbWVJbmRleCgxMCArIE1hdGgubWluKDksIHRoaXMubGV2ZWwpKVxuICAgICAgICAgICAgLnNldE9yaWdpbigxLCAxKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKC00LCAyKVxuICAgICAgICAgICAgLnNldFNjYWxlKC0xLCAxKVxuICAgICAgICAgICAgLnNldFJvdGF0aW9uKDQzMCk7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMud2VhcG9uLmtpbmQgPSBcInN3b3JkXCI7XG4gICAgICAgIGlmIChvcHRpb25zLndlYXBvbiA9PSBcImF4XCIpIHtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldEZyYW1lSW5kZXgoMjAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5raW5kID0gXCJheFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLndlYXBvbiA9PSBcInNwZWFyXCIpIHtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldEZyYW1lSW5kZXgoMzAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5raW5kID0gXCJzcGVhclwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMlwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMTQ0LCAxMjgsIDcyLCAxMjgpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRQb3NpdGlvbigwLCAtNSkuc2V0U2NhbGUoMS4zKTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiAxMDtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMTA7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDUwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozkuIDlrprmmYLplpPov73ot6HjgZnjgotcbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCAmJiAhdGhpcy5pc0F0dGFjayAmJiB0aGlzLnR1cm5UaW1lID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50dXJuVGltZSA9IDE1O1xuICAgICAgICAgICAgaWYgKGxvb2spIHRoaXMudHVybkNvdW50ID0gMDtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844KS6KaL5aSx44Gj44Gf54q25oWL44Gn5LiJ5Zue5oyv44KK6L+U44Gj44Gf5aC05ZCI44Gv6L+96Leh57WC5LqGXG4gICAgICAgICAgICBpZiAodGhpcy50dXJuQ291bnQgPiAzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pc0p1bXApIHRoaXMudnggKj0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDEyMDtcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDApIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHRoaXMudnggKj0gMztcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v44GT44KM5Lul5LiK6YCy44KB44Gq44GE5aC05ZCI44Gv5oqY44KK6L+U44GZXG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5XYWxsID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5DbGlmZiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZ4IDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwgfHwgaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafmrrXlt67jgYzjgYLjgovloLTlkIjjga/po5vjgbPotorjgYjjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86L+96Leh5Lit44Gn5bSW44GM44GC44KL5aC05ZCI44Gv552A5Zyw54K544GM44GC44KL44GL6Kq/44G544Gm6aOb44Gz6ZmN44KK44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIganVtcE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoanVtcE9rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nnYDlnLDngrnjgYznhKHjgYTloLTlkIjjga/oq6bjgoHjgabmipjjgorov5TjgZlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIi4uLlwifSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA2NCAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86aOb44Gz6YGT5YW344KS5by+44GP77yI44Os44OZ44Or77yU5Lul5LiK77yJXG4gICAgICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDMgJiYgbG9vayAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCt+ODp+ODg+ODiOOBqOOBrui3nembouWIpOWumlxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uICYmIGUudHlwZSA9PSBcImFycm93XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmdldERpc3RhbmNlKGUpIDwgNjQpIHRoYXQuZ3VhcmQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMzApIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICB9LFxuXG4gICAgYXR0YWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgd2lkdGggPSAyNCwgaGVpZ2h0ID0gMjQ7XG4gICAgICAgIHZhciBhdGsgPSBxZnQuRW5lbXlBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAyNCwgaGVpZ2h0OiAyNCwgcG93ZXI6IDIwICsgdGhpcy5sZXZlbCAqIDV9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5lbmVteUxheWVyKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCArIHRoaXMuc2NhbGVYICogMTgsIHRoaXMueSlcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjApO1xuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSBhdGsuc2V0QWxwaGEoMC4zKTtcbiAgICAgICAgYXRrLm1hc3RlciA9IHRoaXM7XG4gICAgICAgIGF0ay50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICBhdGsudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGF0LnggKyB0aGF0LnNjYWxlWCAqIDE4O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMud2VhcG9uLmtpbmQgPT0gXCJzd29yZFwiIHx8IHRoaXMud2VhcG9uLmtpbmQgPT0gXCJheFwiKSB7XG4gICAgICAgICAgICBhdGsuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC50byh7cm90YXRpb246IDI3MH0sIDMpXG4gICAgICAgICAgICAgICAgLndhaXQoMylcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52eCA9IDE2ICogdGhhdC5zY2FsZVg7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiA0MzB9LCA2KVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGF0ay5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLndlYXBvbi5raW5kID09IFwic3BlYXJcIikge1xuICAgICAgICAgICAgYXRrLndpZHRoID0gMzI7XG4gICAgICAgICAgICBhdGsuaGVpZ2h0ID0gODtcbiAgICAgICAgICAgIGF0ay5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDEsIHRoaXMueSk7XG4gICAgICAgICAgICBhdGsudHdlZW5lci5jbGVhcigpLmJ5KHt4OiAyMCAqIHRoaXMuc2NhbGVYfSwgMTApLmJ5KHt4OiAtMjAgKiB0aGlzLnNjYWxlWH0sIDEwKTtcbiAgICAgICAgICAgIGF0ay5pc0FjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDUsIHg6IC0yMH0pXG4gICAgICAgICAgICAgICAgLndhaXQoMilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc1N1cGVyQXJtb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnZ4ID0gMzIgKiB0aGF0LnNjYWxlWDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5ieSh7eDogMjB9LCAzKVxuICAgICAgICAgICAgICAgIC5ieSh7eDogLTMwfSwgNSlcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzU3VwZXJBcm1vciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDMwLCB4OiAtMn0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgfSxcblxuICAgIC8v6aOb44Gz6YGT5YW35by+44GNXG4gICAgZ3VhcmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciB3aWR0aCA9IDI0LCBoZWlnaHQgPSAyNDtcbiAgICAgICAgdmFyIGF0ayA9IHFmdC5FbmVteUF0dGFjayh0aGlzLnBhcmVudFNjZW5lLCB7d2lkdGg6IDI0LCBoZWlnaHQ6IDI0LCBwb3dlcjogMjAgKyB0aGlzLmxldmVsICogNX0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLmVuZW15TGF5ZXIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy54ICsgdGhpcy5zY2FsZVggKiAxOCwgdGhpcy55KVxuICAgICAgICAgICAgLnNldEFscGhhKDAuMCk7XG4gICAgICAgIGlmIChERUJVR19DT0xMSVNJT04pIGF0ay5zZXRBbHBoYSgwLjMpO1xuICAgICAgICBhdGsubWFzdGVyID0gdGhpcztcbiAgICAgICAgYXRrLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIGF0ay51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoYXQueCArIHRoYXQuc2NhbGVYICogMTg7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogNDMwfSlcbiAgICAgICAgICAgIC50byh7cm90YXRpb246IDMwMH0sIDMpXG4gICAgICAgICAgICAudG8oe3JvdGF0aW9uOiA0MzB9LCAzKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoYXQuaXNNdXRla2kgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSA2O1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15Lm1hZ2UuanNcbiAqICAyMDE3LzA0LzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+mtlOihk+W4q1xucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lk1hZ2VcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAyMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAyNTYsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMTYwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogNTAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMzAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIGx2ID0gTWF0aC5taW4odGhpcy5sZXZlbCwgNCk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDNcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKChsdiAlIDIpICogMTQ0LCBNYXRoLmZsb29yKGx2IC8gMikgKiAxMjgsIDcyLCAxMjgpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRTY2FsZSgxLjIpLnNldFBvc2l0aW9uKDAsIC0yKTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiAyO1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAyMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuICAgICAgICB2YXIgZGlzdGFuY2UgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOi/keOBj+OBq+OBhOOBn+OCiei3nembouOCkuWPluOCi1xuICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMCAmJiBsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXN0YW5jZSA8IDEyOCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwZWVkID0gMztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/pgIPjgZLjgovjg5Xjgqfjg7zjgrpcbiAgICAgICAgICAgIGlmICh0aGlzLnBoYXNlID09IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCAxMjgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA8IHBsYXllci54KSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BlZWQgPSAzO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbGF5ZXIueCkgdGhpcy5kaXJlY3Rpb24gPSAwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwZWVkID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBsdiA9IE1hdGgubWluKHRoaXMubGV2ZWwsIDQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoKGx2ICUgMikgKiAxNDQsIE1hdGguZmxvb3IobHYgLyAyKSAqIDEyOCwgNzIsIDEyOCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5pS75pKD44OV44Kn44O844K6XG4gICAgICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgOTYpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgaXjgYTjgZ/jgonpgIPjgZLjgotcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzpgaDjgY/jgavjgYTjgovloLTlkIjjga/mlLvmkoNcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+eZuueLguODouODvOODiVxuICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHZhciBsdiA9IE1hdGgubWluKHRoaXMubGV2ZWwsIDQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoKGx2ICUgMikgKiAxNDQgKyA3MiwgTWF0aC5mbG9vcihsdiAvIDIpICogMTI4LCA3MiwgMTI4KTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5waGFzZSA8IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmViYWxsKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDg7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZWJhbGwoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaWueWQkeOCkuWQkeOBj1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbGF5ZXIueCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmV0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jgZPjgozku6XkuIrpgLLjgoHjgarjgYTloLTlkIjjga/mipjjgorov5TjgZlcbiAgICAgICAgICAgIHZhciBjYW50ZXNjYXBlID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCB8fCB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMSkgY2FudGVzY2FwZSA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQgfHwgdGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxKSBjYW50ZXNjYXBlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v6YCD44GS44KJ44KM44Gq44GE5aC05ZCI44Gv55m654uC44Oi44O844OJXG4gICAgICAgICAgICBpZiAoY2FudGVzY2FwZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAzO1xuICAgICAgICAgICAgICAgIHRoaXMuc3BlZWQgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOmbouOCjOOBn+OCiemAmuW4uOODleOCp+ODvOOCulxuICAgICAgICAgICAgaWYgKGRpc3RhbmNlID4gMTI4ICsgNjQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbHYgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKChsdiAlIDIpICogMTQ0LCBNYXRoLmZsb29yKGx2IC8gMikgKiAxMjgsIDcyLCAxMjgpO1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuc3BlZWQgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gdGhpcy5zcGVlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICAvL+ODleOCoeOCpOOCouODnOODvOODq1xuICAgIGZpcmViYWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIkJ1bGxldFwiLCB7ZXhwbG9kZTogdHJ1ZSwgcm90YXRpb246IHRoaXMuZ2V0UGxheWVyQW5nbGUoKSArIE1hdGgucmFuZGludCgtNDAsIDQwKX0pO1xuICAgIH0sXG5cbiAgICAvL+eIhueZulxuICAgIGV4cGxvZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHAucGxheVNFKFwiYm9tYlwiKTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICB2YXIgcm90ID0gKHRoaXMuc2NhbGVYID09IDEpPyAwOiAxODA7XG4gICAgICAgIHZhciBjdCA9IDA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciByYWQgPSByb3QudG9SYWRpYW4oKTtcbiAgICAgICAgICAgICAgICB2YXIgZXggPSBNYXRoLmNvcyhyYWQpICogMTY7XG4gICAgICAgICAgICAgICAgdmFyIGV5ID0gTWF0aC5zaW4ocmFkKSAqIDE2O1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLnggKyBleCwgdGhpcy55ICsgZXksIFwiQnVsbGV0XCIsIHt0eXBlOiBcImV4cGxvZGVcIiwgcG93ZXI6IDEwLCByb3RhdGlvbjogcm90LCB2ZWxvY2l0eTogM30pO1xuICAgICAgICAgICAgICAgIHJvdCArPSAyMi41O1xuICAgICAgICAgICAgICAgIGN0Kys7XG4gICAgICAgICAgICAgICAgaWYgKGN0ID09IDMyIHx8IHRoaXMuYXR0YWNrQ2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgIHR3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCgxKVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5tYWdpY2RnZ2VyLmpzXG4gKiAgMjAxNy8wNy8xOVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lk1hZ2ljRGFnZ2VyXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMSxcblxuICAgIC8v5a+/5ZG9XG4gICAgbGlmZXNwYW46IDc1LFxuXG4gICAgLy/pgJ/luqZcbiAgICB2ZWxvY2l0eTogMixcblxuICAgIC8v5Yqg6YCf5bqmXG4gICAgYWNjZWw6IDEuMDIsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAxLjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAwLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTZ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDApO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInBhdHRlcm4xXCIpO1xuXG4gICAgICAgIHRoaXMucG93ZXIgPSBvcHRpb25zLnBvd2VyIHx8IHRoaXMucG93ZXI7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDI7XG5cbiAgICAgICAgdGhpcy5wYXJlbnRVbml0ID0gb3B0aW9ucy5wYXJlbnQgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5vZmZzZXRYID0gb3B0aW9ucy5vZmZzZXRYIHx8IE1hdGgucmFuZGludCgtMTYsIDE2KTtcbiAgICAgICAgdGhpcy5vZmZzZXRZID0gb3B0aW9ucy5vZmZzZXRZIHx8IE1hdGgucmFuZGludCgtMTYsIDE2KTtcbiAgICAgICAgdGhpcy5vcmRlciA9IG9wdGlvbnMub3JkZXIgfHwgMDtcblxuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNBdHRhY2tfYmVmb3JlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNEYW1hZ2VkID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/lvoXmqZ/plovlp4tcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgdmFyIHggPSB0aGlzLnBhcmVudFVuaXQueCArIHRoaXMub2Zmc2V0WDtcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5wYXJlbnRVbml0LnkgKyB0aGlzLm9mZnNldFk7XG4gICAgICAgICAgICB5ICs9IE1hdGguY29zKHRoaXMudGltZS50b1JhZGlhbigpICogNikgKiA1O1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAubW92ZVRvKHgsIHksIDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+W+heapn+S4rVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAyKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGlzLnBhcmVudFVuaXQueCArIHRoaXMub2Zmc2V0WDtcbiAgICAgICAgICAgIHRoaXMueSA9IHRoaXMucGFyZW50VW5pdC55ICsgdGhpcy5vZmZzZXRZO1xuICAgICAgICAgICAgdGhpcy55ICs9IE1hdGguY29zKHRoaXMudGltZS50b1JhZGlhbigpICogNikgKiA1O1xuICAgICAgICAgICAgdGhpcy5yb3RhdGlvbiAtPSAzO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAzO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85pS75pKD6ZaL5aeLXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDMpIHtcbiAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLmdldFBsYXllckFuZ2xlKCkgKyAxMzU7XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5tb3ZlVG8ocGwueCwgcGwueSwgMjAsIFwiZWFzZUluUXVhZFwiKVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/mlLvmkoPntYLkuoZcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gNSkge1xuICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgdGhpcy5pc0VuYWJsZUF0dGFja0NvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIHggPSB0aGlzLnBhcmVudFVuaXQueCArIHRoaXMub2Zmc2V0WDtcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5wYXJlbnRVbml0LnkgKyB0aGlzLm9mZnNldFk7XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5tb3ZlVG8oeCwgeSwgMTUsIFwiZWFzZUluT3V0UXVhZFwiKVxuICAgICAgICAgICAgICAgIC53YWl0KDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0VuYWJsZUF0dGFja0NvbGxpc2lvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+itpuaIkuW+heapn+mWi+Wni1xuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxMCkge1xuICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgdmFyIGRlZyA9IHRoaXMudGltZS50b1JhZGlhbigpICogNiArIHRoaXMub3JkZXIgKiA2MDtcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5wYXJlbnRVbml0LnggKyBNYXRoLmNvcyhkZWcpICogMTY7XG4gICAgICAgICAgICB2YXIgeSA9IHRoaXMucGFyZW50VW5pdC55ICsgTWF0aC5zaW4oZGVnKSAqIDE2O1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAubW92ZVRvKHgsIHksIDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+itpuaIkuW+heapn+S4rVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxMikge1xuICAgICAgICAgICAgdmFyIGRlZyA9IHRoaXMudGltZS50b1JhZGlhbigpICogNiArIHRoaXMub3JkZXIgKiA2MDtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoaXMucGFyZW50VW5pdC54ICsgTWF0aC5jb3MoZGVnKSAqIDE2O1xuICAgICAgICAgICAgdGhpcy55ID0gdGhpcy5wYXJlbnRVbml0LnkgKyBNYXRoLnNpbihkZWcpICogMTY7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uIC09IDY7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDEzO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v6L+R5o6l5pS75pKD6ZaL5aeLXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDEzKSB7XG4gICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC53YWl0KDEwKVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5nZXRQbGF5ZXJBbmdsZSgpICsgMTM1O1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm1vdmVUbyhwbC54LCBwbC55LCA2KVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/ov5HmjqXmlLvmkoNcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMTQpIHtcbiAgICAgICAgICAgIHZhciBkZWcgPSB0aGlzLnRpbWUudG9SYWRpYW4oKSAqIDIwICsgdGhpcy5vcmRlciAqIDYwO1xuICAgICAgICAgICAgdGhpcy54ID0gdGhpcy5wYXJlbnRVbml0LnggKyBNYXRoLmNvcyhkZWcpICogMjQ7XG4gICAgICAgICAgICB0aGlzLnkgPSB0aGlzLnBhcmVudFVuaXQueSArIE1hdGguc2luKGRlZykgKiAyNDtcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gLT0gNjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5pS75pKD57WC5LqGXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDE2KSB7XG4gICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICB0aGlzLmlzRW5hYmxlQXR0YWNrQ29sbGlzaW9uID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgeCA9IHRoaXMucGFyZW50VW5pdC54ICsgdGhpcy5vZmZzZXRYO1xuICAgICAgICAgICAgdmFyIHkgPSB0aGlzLnBhcmVudFVuaXQueSArIHRoaXMub2Zmc2V0WTtcbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLm1vdmVUbyh4LCB5LCAxMClcbiAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0VuYWJsZUF0dGFja0NvbGxpc2lvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+imquODpuODi+ODg+ODiOWQjOacn1xuICAgICAgICBpZiAodGhpcy5wYXJlbnRVbml0KSB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMucGFyZW50VW5pdC5kaXJlY3Rpb247XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnRVbml0LmhwID09IDApIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+mjm+OBs+mBk+WFt+i/juaSg1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBxZnQuUGxheWVyQXR0YWNrICYmIGUuaXNDb2xsaXNpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50eXBlICE9IFwiYXJyb3dcIiAmJiBlLnR5cGUgIT0gXCJtYXNha2FyaVwiKSByZXR1cm47XG4gICAgICAgICAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2UoZSk7XG4gICAgICAgICAgICAgICAgaWYgKGRpcyA8IDY0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAyMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tb3ZlVG8oZS54LCBlLnksIDUpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHRoaXMuaXNBdHRhY2tfYmVmb3JlID0gdGhpcy5pc0F0dGFjaztcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJwYXR0ZXJuMVwiXSA9IFswXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGRhbWFnZTogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIHRoaXMuaXNEYW1hZ2VkID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPCAxMCkgdGhpcy5waGFzZSA9IDY7IGVsc2UgdGhpcy5waGFzZSA9IDE3O1xuXG4gICAgICAgIC8v5Yq55p6c6Z+zXG4gICAgICAgIGFwcC5wbGF5U0UoXCJ0aW5rbGluZ1wiKTtcbiAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5ieSh7eTogLTY0LCByb3RhdGlvbjogNzAwfSwgMTUsIFwiZWFzZU91dFF1YWRcIilcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBoYXNlIDwgMTApIHRoaXMucGhhc2UgPSAwOyBlbHNlIHRoaXMucGhhc2UgPSAxMDtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRGFtYWdlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15Lm9ncmUuanNcbiAqICAyMDE3LzA1LzA2XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCquODvOOCrFxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lk9ncmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA2MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMjAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAxMDAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogNyxcbiAgICBkcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyMCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMlwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjE2LCAwLCA3MiwgMTI4KTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0UG9zaXRpb24oMCwgLTUpLnNldFNjYWxlKDEuMyk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMztcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMzAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozkuIDlrprmmYLplpPov73ot6HjgZnjgotcbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCAmJiAhdGhpcy5pc0F0dGFjayAmJiB0aGlzLnR1cm5UaW1lID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50dXJuVGltZSA9IDE1O1xuICAgICAgICAgICAgaWYgKGxvb2spIHRoaXMudHVybkNvdW50ID0gMDtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844KS6KaL5aSx44Gj44Gf54q25oWL44Gn5LiJ5Zue5oyv44KK6L+U44Gj44Gf5aC05ZCI44Gv6L+96Leh57WC5LqGXG4gICAgICAgICAgICBpZiAodGhpcy50dXJuQ291bnQgPiAzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAwLjU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMC41O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkgdGhpcy52eCAqPSA0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMTUwO1xuICAgICAgICAgICAgdGhpcy50dXJuQ291bnQgPSAwO1xuICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMCkgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v44GT44KM5Lul5LiK6YCy44KB44Gq44GE5aC05ZCI44Gv5oqY44KK6L+U44GZXG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5XYWxsID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5DbGlmZiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZ4IDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzQwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwgfHwgaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafmrrXlt67jgYzjgYLjgovloLTlkIjjga/po5vjgbPotorjgYjjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86L+96Leh5Lit44Gn5bSW44GM44GC44KL5aC05ZCI44Gv552A5Zyw54K544GM44GC44KL44GL6Kq/44G544Gm6aOb44Gz6ZmN44KK44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIganVtcE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoanVtcE9rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nnYDlnLDngrnjgYznhKHjgYTloLTlkIjjga/oq6bjgoHjgabmipjjgorov5TjgZlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIi4uLlwifSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR1cm5XYWl0ID0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDMwKSB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkub3JvY2hpLmpzXG4gKiAgMjAxNy8wNi8xM1xuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/lpKfom4dcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5Pcm9jaGlcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA1MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiA3MDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDMyLCBoZWlnaHQ6IDM2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB2YXIgY2FwTGV2ZWwgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMXgyXCIsIDI0ICogMiwgMzIgKiAyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKGNhcExldmVsICogNzIgKiAyLCAzODQgKiAyLCA3MiAqIDIsIDEyOCAqIDIpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMSArIGNhcExldmVsICogMC4xKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKDAsIGNhcExldmVsICogLTEgLSA0KTtcbiAgICAgICAgdGhpcy53aWR0aCArPSBjYXBMZXZlbCAqIDEwO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDEwO1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAzMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTU7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRGVhZCkgcmV0dXJuO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzEwLCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTEwLCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOi/keOBj+OBq+OBhOOBn+OCieOCuOODo+ODs+ODl+aUu+aSg1xuICAgICAgICAgICAgaWYgKGxvb2sgJiYgIXRoaXMuaXNKdW1wICYmIGRpcyA8IDQwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNjtcbiAgICAgICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLnZ4ICo9IDQ7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTUsIHk6IDB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuc2xpbWUuanNcbiAqICAyMDE2LzEyLzMxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODqeOCpOODoFxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LlNsaW1lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDkwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMTAwLFxuXG4gICAgLy/lsZ7mgKfjg4Djg6Hjg7zjgrjlgI3njodcbiAgICBkYW1hZ2VTdGluZzogMC44LFxuICAgIGRhbWFnZUJsb3c6IDAuNSxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDMwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0NPSU4sXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogNSxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fQkFHLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTZ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHZhciBjYXBMZXZlbCA9IE1hdGgubWluKHRoaXMubGV2ZWwsIDQpO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyhjYXBMZXZlbCAqIDcyLCAyNTYsIDcyLCAxMjgpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMSArIGNhcExldmVsICogMC4yKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKDAsIC0yICsgY2FwTGV2ZWwgKiAtMyk7XG4gICAgICAgIHRoaXMud2lkdGggKz0gY2FwTGV2ZWwgKiA1O1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDEwO1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDMpIHRoaXMuaHAgKz0gMzA7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDIwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcblxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5kaXJlY3Rpb24gPT0gMCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWwgPiAz44CAJiYgdGhpcy5zdG9wVGltZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2soKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiYW5nZXIxXCIsIGxpZmVTcGFuOiA2MCwgeTogMCwgZm9yY2U6IHRydWV9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg4bjg6rjg4jjg6rjg7zmjIflrppcbiAgICAgICAgICAgIGlmICh0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgICAgIC8v5rC05bmz5pa55ZCR44Gu44G/44OB44Kn44OD44KvXG4gICAgICAgICAgICAgICAgdmFyIHR4ID0gdGhpcy54IC0gdGhpcy5maXJzdFg7XG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHR4KSA+IHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5sZXZlbCA8IDQpIHtcbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOi/keOBj+OBq+OBhOOBn+OCieOCuOODo+ODs+ODl+aUu+aSg1xuICAgICAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA0MCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAgMiArIE1hdGguZmxvb3IodGhpcy5sZXZlbCowLjUpICogdGhpcy5zcGVlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgdmFyIHZ4ID0gMTtcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDE4MCkgdnggPSAtMTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxldmVsOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIldpc3BCb21iXCIsIHtwYXR0ZXJuOiAyfSk7XG4gICAgICAgICAgICBiLnZ5ID0gLTg7XG4gICAgICAgICAgICBiLnZ4ID0gaSAqIDIgKiB2eDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByYW5kb21BdHRhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgIHZhciB2eCA9IDE7XG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHZ4ID0gLTE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZXZlbDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJXaXNwQm9tYlwiLCB7cGF0dGVybjogMn0pO1xuICAgICAgICAgICAgYi52eSA9IC04O1xuICAgICAgICAgICAgYi52eCA9IGkgKiAyICogdng7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFswLCAxLCAyLCAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5zbmFrZS5qc1xuICogIDIwMTcvMDEvMjdcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v6JuHXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuU25ha2VcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAyMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAxNTAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE4fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB2YXIgY2FwTGV2ZWwgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoY2FwTGV2ZWwgKiA3MiwgMzg0LCA3MiwgMTI4KVxuICAgICAgICAgICAgLnNldFNjYWxlKDEgKyBjYXBMZXZlbCAqIDAuMSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCBjYXBMZXZlbCAqIC0xKVxuICAgICAgICB0aGlzLndpZHRoICs9IGNhcExldmVsICogNTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiAyO1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAxMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRGVhZCkgcmV0dXJuO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonjgrjjg6Pjg7Pjg5fmlLvmkoNcbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA0MCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTY7XG4gICAgICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy52eCAqPSA0O1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIiwgbGlmZVNwYW46IDE1LCB5OiAwfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LnRpdGFuLmpzXG4gKiAgMjAxNy8wNS8wNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/lt6jkurpcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5UaXRhblwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAzMDAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogNyxcbiAgICBkcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyNSwgaGVpZ2h0OiA0MH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMngyXCIsIDI0KjIsIDMyKjIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjE2KjIsIDAsIDcyKjIsIDEyOCoyKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0UG9zaXRpb24oMCwgLTUpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDEwO1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiA1MDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5kaXJlY3Rpb24gPT0gMCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7ot53pm6JcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOeZuuimi+W+jOS4gOWumuaZgumWk+i/vei3oeOBmeOCi1xuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwICYmICF0aGlzLmlzQXR0YWNrICYmIHRoaXMudHVyblRpbWUgPT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDE4MCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnR1cm5UaW1lID0gMTU7XG4gICAgICAgICAgICBpZiAobG9vaykgdGhpcy50dXJuQ291bnQgPSAwO1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgpLopovlpLHjgaPjgZ/nirbmhYvjgafkuInlm57mjK/jgorov5TjgaPjgZ/loLTlkIjjga/ov73ot6HntYLkuoZcbiAgICAgICAgICAgIGlmICh0aGlzLnR1cm5Db3VudCA+IDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v5LiA5a6a6Led6Zui5Lul5LiK6Zui44KM44Gf44KJ6L+96Leh6Kej6ZmkXG4gICAgICAgIGlmIChkaXMgPiA1MTIpIHRoaXMuY2hhc2VUaW1lID0gMDtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDAuNTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0wLjU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pc0p1bXApIHRoaXMudnggKj0gMS41O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMTIwO1xuICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMCkgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkgdGhpcy52eCAqPSAzO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/jgZPjgozku6XkuIrpgLLjgoHjgarjgYTloLTlkIjjga/mipjjgorov5TjgZlcbiAgICAgICAgICAgIHZhciBpc1JldHVybldhbGwgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBpc1JldHVybkNsaWZmID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkgaXNSZXR1cm5XYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSs0MCwgNSwgNSkgPT0gbnVsbCkgaXNSZXR1cm5DbGlmZiA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudnggPCAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCB8fCBpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOi/vei3oeS4reOBp+auteW3ruOBjOOBguOCi+WgtOWQiOOBr+mjm+OBs+i2iuOBiOOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5XYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafltJbjgYzjgYLjgovloLTlkIjjga/nnYDlnLDngrnjgYzjgYLjgovjgYvoqr/jgbnjgabpo5vjgbPpmY3jgorjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuQ2xpZmYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqdW1wT2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDk2KSkganVtcE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDk2KSkganVtcE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdW1wT2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC01O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+edgOWcsOeCueOBjOeEoeOBhOWgtOWQiOOBr+irpuOCgeOBpuaKmOOCiui/lOOBmVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50dXJuV2FpdCA9IDE1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiLi4uXCJ9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggKj0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA2NCAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDMwKSB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIGF0ayA9IHFmdC5FbmVteUF0dGFjayh0aGlzLnBhcmVudFNjZW5lLCB7d2lkdGg6IDEsIGhlaWdodDogMjQsIHBvd2VyOiA0MCArIHRoaXMubGV2ZWwgKiA1fSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuZW5lbXlMYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDE4LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC4wKTtcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikgYXRrLnNldEFscGhhKDAuMyk7XG4gICAgICAgIGF0ay5tYXN0ZXIgPSB0aGlzO1xuICAgICAgICBhdGsudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgYXRrLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhhdC54ICsgdGhhdC5zY2FsZVggKiAxODtcbiAgICAgICAgfVxuXG4gICAgICAgIGF0ay5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgICBhdGsudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCg2KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGF0LnZ4ID0gMjQgKiB0aGF0LnNjYWxlWDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg2KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGF0ay5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuXG4gICAgICAgIHFmdC5CYWxsb29uKHtwYXR0ZXJuOiBcImFuZ2VyMlwifSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbigwLCAtdGhpcy5oZWlnaHQvMi0xMCk7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkud2lzcC5qc1xuICogIDIwMTYvMTIvMzFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Km44Kj44K544OXXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuV2lzcFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDEyOCxcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAzNjAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDEwMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDEwLFxuICAgIGRyb3BJdGVtOiBJVEVNX1NUT05FLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDAsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX1NUT05FLFxuXG4gICAgLy/lsZ7mgKfjg4Djg6Hjg7zjgrjlgI3njodcbiAgICBkYW1hZ2VGaXJlOiAwLjgsXG4gICAgZGFtYWdlSWNlOiAyLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTZ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDFcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKE1hdGgubWluKHRoaXMubGV2ZWwsIDQpICogNzIsIDUxMiwgNzIsIDEyOCk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMjtcbiAgICAgICAgdGhpcy5leWVzaWdodCArPSB0aGlzLmxldmVsICogNjQsXG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDIwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0YW5kXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMubW92ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmF0dGFja0NvdW50ID0gMDtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOi/keOBj+OBq+OBhOOBn+OCieWvhOOBo+OBpuOBhOOBj1xuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdmFyIHAxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgIHZhciBwMiA9IHBoaW5hLmdlb20uVmVjdG9yMihwbC54LCBwbC55KTtcbiAgICAgICAgICAgIHZhciBwID0gcDIuc3ViKHAxKTtcbiAgICAgICAgICAgIHAubm9ybWFsaXplKCk7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gcC54ICogKDEgKyB0aGlzLmxldmVsICogMC4yKTtcbiAgICAgICAgICAgIHRoaXMudnkgPSBwLnkgKiAoMSArIHRoaXMubGV2ZWwgKiAwLjIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5pS75pKDXG4gICAgICAgIGlmICh0aGlzLmxldmVsID4gMyAmJiBkaXMgPCAxMjgpIHtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNrQ291bnQtLTtcbiAgICAgICAgICAgIGlmICh0aGlzLmF0dGFja0NvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGV2ZWw7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJXaXNwQm9tYlwiLCB7cGF0dGVybjogMX0pO1xuICAgICAgICAgICAgICAgICAgICBiLnZ5ID0gLTEwO1xuICAgICAgICAgICAgICAgICAgICBiLnZ4ID0gKGkqMikgKiB0aGlzLnNjYWxlWDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2tDb3VudCA9IDE4MCAtIHRoaXMubGV2ZWwgKiAxNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNrQ291bnQgPSA2MDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG5cbi8v44Km44Kj44K544OX77yI5by377yJXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuV2lzcEhhcmRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAyMCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMzYwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAzMDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9TVE9ORSxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9KRVdFTCxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlRmlyZTogMC41LFxuICAgIGRhbWFnZUljZTogMixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygyODgsIDUxMiwgNzIsIDEyOCk7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJzdGFuZFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLm1vdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hdHRhY2tDb3VudCA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonlr4TjgaPjgabjgYTjgY9cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgIHZhciBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIocGxheWVyLngsIHBsYXllci55KTtcbiAgICAgICAgICAgIHZhciBwID0gcDIuc3ViKHAxKTtcbiAgICAgICAgICAgIHAubm9ybWFsaXplKCk7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gcC54IC8gMjtcbiAgICAgICAgICAgIHRoaXMudnkgPSBwLnkgLyAyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5pS75pKDXG4gICAgICAgIGlmIChkaXMgPCAxNjApIHtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNrQ291bnQtLTtcbiAgICAgICAgICAgIGlmICh0aGlzLmF0dGFja0NvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGV2ZWwrNDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIldpc3BCb21iXCIsIHtwYXR0ZXJuOiAxfSk7XG4gICAgICAgICAgICAgICAgICAgIGIudnkgPSAtMTA7XG4gICAgICAgICAgICAgICAgICAgIGIudnggPSAoaSoyKSAqIHRoaXMuc2NhbGVYO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFja0NvdW50ID0gMTgwIC0gdGhpcy5sZXZlbCAqIDE1O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hdHRhY2tDb3VudCA9IDYwO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcblxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lldpc3BCb21iXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMSxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAuOTksXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMCxcblxuICAgIC8v54Sh5pW144OV44Op44KwXG4gICAgaXNNdXRla2k6IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwge3dpZHRoOiAxMCwgaGVpZ2h0OiAxMH0pO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgdGhpcy4kZXh0ZW5kKG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJwYXJ0aWNsZVwiLCAxNiwgMTYpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCgzMSk7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuXG4gICAgICAgIHRoaXMucGF0dGVybiA9IG9wdGlvbnMucGF0dGVybiB8fCAxO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInBhdHRlcm5cIit0aGlzLnBhdHRlcm4pO1xuXG4gICAgICAgIHRoaXMub24oJ2RlYWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgaWYgKHRoaXMub25TY3JlZW4pIGFwcC5wbGF5U0UoXCJib21iXCIpO1xuICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiRmxhbWVcIiwge3BhdHRlcm46IDF9KTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJwYXR0ZXJuMVwiXSA9IFszMSwgMzAsIDI5LCAyOCwgMjcsIDI2LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJwYXR0ZXJuMlwiXSA9IFszMSwgMzAsIDI5LCAyOCwgMjcsIDI2LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBkcm9wRGVhZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNEZWFkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0Ryb3AgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LndpemFyZC5qc1xuICogIDIwMTcvMDgvMDlcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Km44Kj44K244O844OJXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuV2l6YXJkXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogNTAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMjU2LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDM2MCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDMwMDAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAzMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDUsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAzXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgNzIsIDEyOClcbiAgICAgICAgICAgIC5zZXRTY2FsZSgxLjIpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDI7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDMwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcblxuICAgICAgICAvL+ihjOWLleODleOCp+ODvOOCulxuICAgICAgICB0aGlzLnBoYXNlID0gXCJ3YWl0XCI7XG5cbiAgICAgICAgLy/mjqXov5HmiKbntYzpgY7mmYLplpNcbiAgICAgICAgdGhpcy5uZWFyQ291bnQgPSAwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuXG4gICAgICAgIC8v5b6F5qmf5LitXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IFwid2FpdFwiKSB7XG4gICAgICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCIsIGxpZmVTcGFuOiAxNX0pO1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSBcImFwcHJvYWNoXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOeZuuimi+W+jOaOpei/kVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSBcImFwcHJvYWNoXCIpIHtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkaXN0YW5jZSA8IDEyOCkge1xuICAgICAgICAgICAgdGhpcy5uZWFyQ291bnQrK1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uZWFyQ291bnQgPSAwO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44OG44Os44Od44O844OI6ZaL5aeLXG4gICAgdGVsZXBvcnRJbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuZmFkZU91dCgzMCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNzsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgc3AgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwM1wiLCAyNCwgMzIpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAuc2V0RnJhbWVUcmltbWluZygwLCAwLCA3MiwgMTI4KTtcbiAgICAgICAgICAgIHNwLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5ieSh7eDogLTY0ICsgaSAqIDE2LCBhbHBoYTogLTF9LCAzMCxcImVhc2VPdXRTaW5lXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44OG44Os44Od44O844OI57WC5LqGXG4gICAgdGVsZXBvcnRPdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmZhZGVJbigzMCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNzsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgc3AgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwM1wiLCAyNCwgMzIpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAuc2V0RnJhbWVUcmltbWluZygwLCAwLCA3MiwgMTI4KTtcbiAgICAgICAgICAgIHNwLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5ieSh7eDogLTY0ICsgaSAqIDE2LCBhbHBoYTogLTF9LCAzMCxcImVhc2VPdXRTaW5lXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v5YiG6LqrXG4gICAgY2xvbmVNeVNlbGY6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG5cbiAgICAvL+eBq+eCjumtlOazlVxuICAgIGZsYW1lOiBmdW5jdGlvbigpIHtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFswLCAxLCAyLCAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGZpcnN0RnJhbWU6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG59KTtcblxuLy/jgqbjgqPjgrbjg7zjg4nliIbouqtcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5XaXphcmRDbG9uZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAwLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDAsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIGx2ID0gTWF0aC5taW4odGhpcy5sZXZlbCwgMyk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDNcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKChsdiAlIDIpICogMTQ0ICsgNzIsIE1hdGguZmxvb3IobHYgLyAyKSAqIDEyOCwgNzIsIDEyOCk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldFNjYWxlKDEuMik7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLnNwZWVkID0gMTtcbiAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc1RlbGVwb3J0ID0gZmFsc2U7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuICAgICAgICB2YXIgZGlzdGFuY2UgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG5cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFswLCAxLCAyLCAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QuYWNjZXNzb3J5LmpzXG4gKiAgMjAxNy8wMS8xNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucWZ0Lk1hcE9iamVjdCA9IHFmdC5NYXBPYmplY3QgfHwge307XG5cbi8v44Oe44OD44OX6KOF6aO+44Ki44Kv44K744K144OqXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuQ2hhcmFjdGVyXCIsXG5cbiAgICBpZDogbnVsbCxcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNNYXBBY2Nlc3Nvcnk6IHRydWUsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAuMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDIsXG5cbiAgICBpc0FkdmFuY2VBbmltYXRpb246IHRydWUsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgICAgICB3aWR0aDogMzIsXG4gICAgICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IHRoaXMub3B0aW9ucy53aWR0aCwgaGVpZ2h0OiB0aGlzLm9wdGlvbnMuaGVpZ2h0fSk7XG5cbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7XG4gICAgICAgIHRoaXMubGV2ZWwgPSBvcHRpb25zLnByb3BlcnRpZXMubGV2ZWwgfHwgMDtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJub3JtYWxcIl0gPSBbMiwgMSwgMCwgM107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJub3JtYWwyXCJdID0gWzEsIDAsIDMsIDJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG5cbi8v44Op44Oz44OXXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkxhbXBcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0Lk1hcE9iamVjdC5BY2Nlc3NvcnlcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+OCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZmxhbWUwMlwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCgwKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyh0aGlzLmxldmVsICogMjQsIDAsIDI0LCAxMjgpO1xuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44Oz6Kit5a6aXG4gICAgICAgIGlmICh0aGlzLmlkICUgMikge1xuICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbDJcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDg7XG4gICAgfSxcbn0pO1xuXG4vL+OBn+OBjeeBq1xucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5Cb25maXJlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5NYXBPYmplY3QuQWNjZXNzb3J5XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImZsYW1lMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoMCk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcodGhpcy5sZXZlbCAqIDI0LCAxMjgsIDI0LCAxMjgpO1xuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44Oz6Kit5a6aXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcbiAgICB9LFxufSk7XG5cbi8v54KOXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkZsYW1lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5NYXBPYmplY3QuQWNjZXNzb3J5XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImZsYW1lMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKHRoaXMubGV2ZWwgKiAyNCArIDcyLCAwLCAyNCwgMTI4KTtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgfSxcbn0pO1xuXG4vL+eBq1xucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5GaXJlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5NYXBPYmplY3QuQWNjZXNzb3J5XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImZsYW1lMDVcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKHRoaXMubGV2ZWwgKiAyNCArIDcyLCAwLCAyNCwgMTI4KTtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgfSxcbn0pO1xuXG4vL+eHreWPsFxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5DYW5kbGVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0Lk1hcE9iamVjdC5BY2Nlc3NvcnlcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZmxhbWUwNVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcodGhpcy5sZXZlbCAqIDI0ICsgNzIsIDEyOCwgMjQsIDEyOCk7XG5cbiAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PoqK3lrppcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgIH0sXG59KTtcblxuLy/jg6njg7Pjgr/jg7NcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuTGFudGhhbnVtXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5NYXBPYmplY3QuQWNjZXNzb3J5XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImFjY2Vzc29yeTFcIiwgMTYsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDAsIDk2LCA3MiwgMzIpO1xuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44Oz6Kit5a6aXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJub3JtYWxcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcblxuLy/jg6njg7Pjg5fvvJJcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuQ2FuZGxlTGFtcFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJhY2Nlc3NvcnkxXCIsIDE2LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygwLCAzMiwgNzIsIDMyKTtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWzAsIDEsIDIsIDFdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIG1hcG9iamVjdC5ibG9jay5qc1xuICogIDIwMTcvMDMvMTNcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnFmdC5NYXBPYmplY3QgPSBxZnQuTWFwT2JqZWN0IHx8IHt9O1xuXG4vL+ODluODreODg+OCr+OCr+ODqeOCuVxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5CbG9ja1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuQ2hhcmFjdGVyXCIsXG5cbiAgICBpZDogbnVsbCxcblxuICAgIC8v6ICQ5LmF5YqbXG4gICAgaHA6IDMwLFxuXG4gICAgLy/orZjliKXjg5Xjg6njgrBcbiAgICBpc0Jsb2NrOiB0cnVlLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiAxLFxuXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiBmYWxzZSxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgICAgIHdpZHRoOiAzMixcbiAgICAgICAgICAgIGhlaWdodDogMzIsXG4gICAgICAgICAgICBpbmRleDogMCxcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHt3aWR0aDogdGhpcy5vcHRpb25zLndpZHRoLCBoZWlnaHQ6IHRoaXMub3B0aW9ucy5oZWlnaHR9KTtcblxuICAgICAgICB0aGlzLmlkID0gb3B0aW9ucy5pZDtcblxuICAgICAgICAvL+OCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLmluZGV4ID0gb3B0aW9ucy5pbmRleDtcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJsb2NrXCIsIDMyLCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KHRoaXMuaW5kZXgpO1xuXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAzMixcbiAgICAgICAgICAgIGhlaWdodDogMzIsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwgMCwgMCwgMC4wKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy53YWt1ID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSkuc2V0UG9zaXRpb24oMCwgMCk7XG4gICAgICAgIGlmIChvcHRpb25zLmVuYWJsZUZyYW1lKSB0aGlzLndha3UuYWRkQ2hpbGRUbyh0aGlzKTtcblxuICAgICAgICAvL+OCueOCr+ODquODl+ODiFxuICAgICAgICBpZiAob3B0aW9ucy5wcm9wZXJ0aWVzLnNjcmlwdCkge1xuICAgICAgICAgICAgdmFyIHNjID0gXCIoZnVuY3Rpb24oYXBwKSB7XCIrb3B0aW9ucy5wcm9wZXJ0aWVzLnNjcmlwdCtcIn0pXCI7XG4gICAgICAgICAgICB2YXIgZiA9IGV2YWwoc2MpO1xuICAgICAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGYpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vbignZGVhZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUucmVtb3ZlKCk7XG4gICAgICAgICAgICB0aGlzLndha3UucmVtb3ZlKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5jb2xsaXNpb24pIHRoaXMuY29sbGlzaW9uLnJlbW92ZSgpO1xuICAgICAgICAgICAgdmFyIHMgPSBbXTtcbiAgICAgICAgICAgIHNbMF0gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJsb2NrXCIsIDE2LCAxNikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbigtOCwgLTgpLnNldEZyYW1lSW5kZXgodGhpcy5pbmRleCAqIDIgKyAwKTtcbiAgICAgICAgICAgIHNbMV0gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJsb2NrXCIsIDE2LCAxNikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbiggOCwgLTgpLnNldEZyYW1lSW5kZXgodGhpcy5pbmRleCAqIDIgKyAxKTtcbiAgICAgICAgICAgIHNbMl0gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJsb2NrXCIsIDE2LCAxNikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbigtOCwgIDgpLnNldEZyYW1lSW5kZXgodGhpcy5pbmRleCAqIDIgKyAxNiArIDApO1xuICAgICAgICAgICAgc1szXSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYmxvY2tcIiwgMTYsIDE2KS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKCA4LCAgOCkuc2V0RnJhbWVJbmRleCh0aGlzLmluZGV4ICogMiArIDE2ICsgMSk7XG4gICAgICAgICAgICAvL+OCueODl+ODqeOCpOODiOOBjOODkOODqeODkOODqeOBq+WjiuOCjOOCi+OCiFxuICAgICAgICAgICAgKDQpLnRpbWVzKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgICAgICAgICBzW2ldLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnggKz0gdGhpcy52eDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55ICs9IHRoaXMudnk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggKj0gMC45O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ICs9IDAuOTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3RhdGlvbiArPSB0aGlzLnJvdDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbHBoYSAtPSAwLjA1O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzW2ldLnZ4ID0gMDtcbiAgICAgICAgICAgICAgICBzW2ldLnZ5ID0gLTU7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgc1swXS52eCA9IC02OyBzWzBdLnJvdCA9IC0zO1xuICAgICAgICAgICAgc1sxXS52eCA9ICA2OyBzWzFdLnJvdCA9ICAzO1xuICAgICAgICAgICAgc1syXS52eCA9IC0zOyBzWzJdLnJvdCA9IC0zO1xuICAgICAgICAgICAgc1szXS52eCA9ICAzOyBzWzNdLnJvdCA9ICAzO1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbGxpc2lvbikge1xuICAgICAgICAgICAgdGhpcy5jb2xsaXNpb24ueCA9IHRoaXMueDtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnkgPSB0aGlzLnk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmlzRGVhZCkge1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmlLvmkoPvvIjlm7rlrprvvInjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgaWYgKHBsLmlzQXR0YWNrICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQocGwuYXR0YWNrQ29sbGlzaW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGFtYWdlKHBsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O85pS75pKD5Yik5a6a44Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYW1hZ2UoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlOyAgICAvL+eCuea7heOCreODo+ODs+OCu+ODq1xuICAgIH0sXG5cbiAgICBkYW1hZ2U6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICBpZiAodGhpcy5pc0RlYWQpIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMubXV0ZWtpVGltZSA+IDApIHJldHVybjtcbiAgICAgICAgdGhpcy5ocCAtPSB0YXJnZXQucG93ZXI7XG4gICAgICAgIHRoaXMubXV0ZWtpVGltZSA9IDEwO1xuICAgICAgICBpZiAodGhpcy5ocCA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdkZWFkJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGRpciA9IDI7XG4gICAgICAgIGlmICh0aGlzLnggPCB0YXJnZXQueCkgZGlyID0gLTI7XG4gICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLm1vdmVCeShkaXIsIDAsIDEpXG4gICAgICAgICAgICAubW92ZUJ5KC1kaXIsIDAsIDEpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJoaXRfYmx1bnRcIik7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprjga7ov73liqBcbiAgICBhZGRDb2xsaXNpb246IGZ1bmN0aW9uIChsYXllcikge1xuICAgICAgICB0aGlzLmNvbGxpc2lvbiA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAzMiwgaGVpZ2h0OiAzMn0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyhsYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSlcbiAgICAgICAgICAgIC5zZXRWaXNpYmxlKERFQlVHX0NPTExJU0lPTik7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLmFscGhhID0gMC4zO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi52eCA9IDA7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLnZ5ID0gMDtcbiAgICAgICAgdGhpcy5jb2xsaXNpb24uaWdub3JlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLnR5cGUgPSBcImJsb2NrXCI7XG4gICAgfVxufSk7XG4iLCIvKlxuICogIG1hcG9iamVjdC5kb29yLmpzXG4gKiAgMjAxNy8wMS8xNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucWZ0Lk1hcE9iamVjdCA9IHFmdC5NYXBPYmplY3QgfHwge307XG5cbi8v5aSn5Z6L44OJ44Ki44Kv44Op44K5XG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkRvb3JcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAuMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDMsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5a6f6KGM5riI44G/44OV44Op44KwXG4gICAgYWxyZWFkeTogZmFsc2UsXG5cbiAgICAvL+ODreODg+OCr+OBleOCjOOBpuOBhOOCi+OBi1xuICAgIGlzTG9jazogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgd2lkdGggPSBvcHRpb25zLndpZHRoIHx8IDM2O1xuICAgICAgICB2YXIgaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNjQ7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodH0pO1xuXG4gICAgICAgIC8v44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJkb29yXCIsIDM2LCA2NCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDMpO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImNsb3NlZFwiKTtcblxuICAgICAgICB0aGlzLmlkID0gb3B0aW9ucy5pZDtcbiAgICAgICAgdGhpcy5pc0xvY2sgPSBvcHRpb25zLnByb3BlcnRpZXMubG9jayB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy5uYW1lID0gb3B0aW9ucy5uYW1lO1xuICAgICAgICB0aGlzLmVudGVyT2Zmc2V0ID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmVudGVyT2Zmc2V0IHx8IDA7XG4gICAgICAgIHRoaXMuc3ByaXRlLnZpc2libGUgPSBvcHRpb25zLnByb3BlcnRpZXMudmlzaWJsZSA9PSB1bmRlZmluZWQ/IHRydWU6IG9wdGlvbnMucHJvcGVydGllcy52aXNpYmxlO1xuXG4gICAgICAgIC8v44OJ44Ki5qmf6IO9XG4gICAgICAgIHZhciBwcm9wZXJ0aWVzID0gb3B0aW9ucy5wcm9wZXJ0aWVzO1xuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMubmFtZSkge1xuICAgICAgICAgICAgLy/jgq/jg6rjgqJcbiAgICAgICAgICAgIGNhc2UgXCJjbGVhclwiOlxuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2NrID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uKCdlbnRlcmRvb3InLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZSgnc3RhZ2VjbGVhcicpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgLy/jg57jg4Pjg5flhoXnp7vli5VcbiAgICAgICAgICAgIGNhc2UgXCJ3YXJwXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0SUQgPSBwcm9wZXJ0aWVzLm5leHRJRDtcbiAgICAgICAgICAgICAgICB0aGlzLm9mZnNldCA9IHByb3BlcnRpZXMub2Zmc2V0IHx8IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5vbignZW50ZXJkb29yJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v6KGM44GN5YWI44Gu5qSc57SiXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gdGhpcy5maW5kRG9vcih0aGlzLm5leHRJRCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbmV4dCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVudGVyUGxheWVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUud2FycChuZXh0LngsIG5leHQueStuZXh0Lm9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAud2FpdCgxMjApXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWxyZWFkeSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHQubGVhdmVQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAvL+ODnuODg+ODl+WIh+OCiuabv+OBiFxuICAgICAgICAgICAgY2FzZSBcIm1hcHN3aXRjaFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubmV4dElEID0gcHJvcGVydGllcy5uZXh0SUQ7XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSBwcm9wZXJ0aWVzLm9mZnNldCB8fCAwO1xuICAgICAgICAgICAgICAgIHRoaXMudG9MYXllck51bWJlciA9IHByb3BlcnRpZXMudG9MYXllck51bWJlcjtcbiAgICAgICAgICAgICAgICB0aGlzLm9uKCdlbnRlcmRvb3InLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbdGhpcy50b0xheWVyTnVtYmVyXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHQgPSB0aGlzLnBhcmVudFNjZW5lLnN0YWdlQ29udHJvbGxlci5maW5kT2JqZWN0KHRoaXMubmV4dElELCB0aGlzLnRvTGF5ZXJOdW1iZXIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5leHQpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbnRlclBsYXllcigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3dpdGNoTWFwKGxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllci5zZXRQb3NpdGlvbihuZXh0LngsIG5leHQueSArIG5leHQub2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFscmVhZHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0LmxlYXZlUGxheWVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmZnLnR3ZWVuZXIuY2xlYXIoKS53YWl0KDMwKS5mYWRlSW4oMzApLmZhZGVPdXQoMzApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICAvL+i/keOBj+OBq+adpeOBn+OCieiHquWLleeahOOBq+mWi+OBkeOCi1xuICAgICAgICBpZiAodGhpcy5nZXREaXN0YW5jZVBsYXllcigpIDwgNjQpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0xvY2spIHRoaXMub3BlbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uID09IFwib3BlblwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBoaXQgPSB0aGlzLmhpdFRlc3RFbGVtZW50KHBsKTtcbiAgICAgICAgaWYgKGhpdCAmJiAhdGhpcy5pc0xvY2sgJiYgIXRoaXMuYWxyZWFkeSkge1xuICAgICAgICAgICAgaWYgKHRoaXMubmFtZSA9PSBcImNsZWFyXCIpIHtcbiAgICAgICAgICAgICAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouOBruaJieOBr+eEoeadoeS7tuOBp+WFpeOCi1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2VudGVyZG9vcicpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWxyZWFkeSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wib3BlbmRcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiY2xvc2VkXCJdID0gWzIsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5cIl0gPSBbMiwgMSwgMCwgMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiY2xvc2VcIl0gPSBbMywgMCwgMSwgMiwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgb3BlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwib3BlblwiKTtcbiAgICB9LFxuXG4gICAgY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImNsb3NlXCIpO1xuICAgIH0sXG5cbiAgICAvL+ODl+ODrOOCpOODpOODvOOBjOaJieOBq+WFpeOCi1xuICAgIGVudGVyUGxheWVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGVudGVyT2Zmc2V0ID0gdGhpcy5lbnRlck9mZnNldDtcbiAgICAgICAgdmFyIHBsYXllciA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICBwbGF5ZXIuYWxwaGEgPSAwO1xuICAgICAgICBwbGF5ZXIuaXNDb250cm9sID0gZmFsc2U7XG4gICAgICAgIHBsYXllci5pc011dGVraSA9IHRydWU7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihwbGF5ZXIueCwgcGxheWVyLnkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLm1vdmVUbyh0aGlzLngsIHRoaXMueSt0aGlzLmhlaWdodC8yLTE2K2VudGVyT2Zmc2V0LCAxNSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWRlT3V0KDE1KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzmiYnjgYvjgonlh7rjgotcbiAgICBsZWF2ZVBsYXllcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgcGxheWVyLmFscGhhID0gMDtcbiAgICAgICAgcGxheWVyLmlzQ29udHJvbCA9IGZhbHNlO1xuICAgICAgICBwbGF5ZXIuaXNNdXRla2kgPSB0cnVlO1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkrMTYpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKTtcbiAgICAgICAgcGwuYWxwaGEgPSAwO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJkb3duXCIpO1xuICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgIC5mYWRlSW4oMTUpXG4gICAgICAgICAgICAubW92ZVRvKHBsYXllci54LCBwbGF5ZXIueSwgMzApXG4gICAgICAgICAgICAuZmFkZUluKDEwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGxheWVyLmFscGhhID0gMTtcbiAgICAgICAgICAgICAgICBwbGF5ZXIuaXNDb250cm9sID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBwbGF5ZXIuaXNNdXRla2kgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBwbC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+S7luOBruaJieOCkuaknOe0olxuICAgIGZpbmREb29yOiBmdW5jdGlvbihpZCkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5vYmpMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0Lk1hcE9iamVjdC5Eb29yKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUuaWQgPT0gaWQpIHJlc3VsdCA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QuZmxvb3IuanNcbiAqICAyMDE3LzAzLzI3XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5xZnQuTWFwT2JqZWN0ID0gcWZ0Lk1hcE9iamVjdCB8fCB7fTtcblxuLy/lj6/li5Xjg5Xjg63jgqLjgq/jg6njgrlcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuRmxvb3JcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+itmOWIpeODleODqeOCsFxuICAgIGlzRmxvb3I6IHRydWUsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAuMCxcblxuICAgIC8v56e75YuV44OV44Op44KwXG4gICAgaXNBY3RpdmU6IHRydWUsXG5cbiAgICAvL+ODl+ODrOOCpOODpOODvOOBjOS4iuOBq+S5l+OBo+OBpuOCi+ODleODqeOCsFxuICAgIGlzT25QbGF5ZXI6IGZhbHNlLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PpgLLooYzlj6/og73jg5Xjg6njgrBcbiAgICBpc0FkdmFuY2VBbmltYXRpb246IGZhbHNlLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+enu+WLleODkeOCuVxuICAgIG1vdmVQYXRoOiBudWxsLFxuXG4gICAgLy/np7vli5Xjg5Hjgrnnj77lnKjmmYLplpMoMC0xKVxuICAgIHBhdGhUaW1lOiAwLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgICAgIHdpZHRoOiAzMixcbiAgICAgICAgICAgIGhlaWdodDogMzIsXG4gICAgICAgICAgICBpbmRleDogMCxcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHt3aWR0aDogdGhpcy5vcHRpb25zLndpZHRoLCBoZWlnaHQ6IHRoaXMub3B0aW9ucy5oZWlnaHR9KTtcblxuICAgICAgICB0aGlzLmlkID0gb3B0aW9ucy5pZDtcblxuICAgICAgICB0aGlzLm1vdmVUeXBlID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm1vdmVUeXBlIHx8IFwibGluZWFyXCI7XG4gICAgICAgIHRoaXMubW92ZUFuZ2xlID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm1vdmVBbmdsZSB8fCAwO1xuICAgICAgICB0aGlzLm1vdmVMZW5ndGggPSBvcHRpb25zLnByb3BlcnRpZXMubW92ZUxlbmd0aCB8fCAwO1xuICAgICAgICB0aGlzLm1vdmVSYWRpdXMgPSBvcHRpb25zLnByb3BlcnRpZXMubW92ZVJhZGl1cyB8fCA2NDtcbiAgICAgICAgdGhpcy5tb3ZlU3BlZWQgPSBvcHRpb25zLnByb3BlcnRpZXMubW92ZVNwZWVkIHx8IDYwO1xuICAgICAgICB0aGlzLm1vdmVXYWl0ID0gKG9wdGlvbnMucHJvcGVydGllcy5tb3ZlV2FpdCAhPT0gdW5kZWZpbmVkKT8gb3B0aW9ucy5wcm9wZXJ0aWVzLm1vdmVXYWl0OiA2MDtcblxuICAgICAgICAvL+Wni+eCueOBqOe1gueCuVxuICAgICAgICB0aGlzLnN0YXJ0WCA9IG9wdGlvbnMueCArIChvcHRpb25zLndpZHRoIHx8IDE2KSAvIDI7XG4gICAgICAgIHRoaXMuc3RhcnRZID0gb3B0aW9ucy55ICsgKG9wdGlvbnMuaGVpZ2h0IHx8IDE2KSAvIDI7XG4gICAgICAgIGlmICh0aGlzLm1vdmVMZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAvL+enu+WLlei3nembouOBjOioreWumuOBleOCjOOBpuOBhOOCi+WgtOWQiFxuICAgICAgICAgICAgdmFyIHJhZCA9IHRoaXMubW92ZUFuZ2xlLnRvUmFkaWFuKCk7XG4gICAgICAgICAgICB0aGlzLmVuZFggPSB0aGlzLnN0YXJ0WCArIE1hdGguY29zKHJhZCkgKiB0aGlzLm1vdmVMZW5ndGg7XG4gICAgICAgICAgICB0aGlzLmVuZFkgPSB0aGlzLnN0YXJ0WSArIE1hdGguc2luKHJhZCkgKiB0aGlzLm1vdmVMZW5ndGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL+e1gueCueW6p+aomeOBjOioreWumuOBleOCjOOBpuOBhOOCi+WgtOWQiFxuICAgICAgICAgICAgdGhpcy5lbmRYID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmVuZFggfHwgdGhpcy5zdGFydFg7XG4gICAgICAgICAgICB0aGlzLmVuZFkgPSBvcHRpb25zLnByb3BlcnRpZXMuZW5kWSB8fCB0aGlzLnN0YXJ0WTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5YaG6YGL5YuV44Gu5aC05ZCI44Gv5Lit5b+D44KS6Kit5a6a77yI54Sh44GE5aC05ZCI44Gv57WC54K544KS5Lit5b+D44Go44GZ44KL77yJXG4gICAgICAgIGlmICh0aGlzLm1vdmVUeXBlID09IFwiY2lyY2xlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuY2VudGVyWCA9IG9wdGlvbnMucHJvcGVydGllcy5jZW50ZXJYIHx8IHRoaXMuZW5kWDtcbiAgICAgICAgICAgIHRoaXMuY2VudGVyWSA9IG9wdGlvbnMucHJvcGVydGllcy5jZW50ZXJZIHx8IHRoaXMuZW5kWTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v56e75YuV44OR44K/44O844OzXG4gICAgICAgIHN3aXRjaCAodGhpcy5tb3ZlVHlwZSkge1xuICAgICAgICAgICAgLy/nm7Tnt5rpgYvli5VcbiAgICAgICAgICAgIGNhc2UgXCJsaW5lYXJcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAubW92ZVRvKHRoaXMuZW5kWCwgdGhpcy5lbmRZLCB0aGlzLm1vdmVTcGVlZCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge3RoaXMuZmxhcmUoJ21vdmVlbmQnKTt9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC53YWl0KHRoaXMubW92ZVdhaXQpXG4gICAgICAgICAgICAgICAgICAgIC5tb3ZlVG8odGhpcy5zdGFydFgsIHRoaXMuc3RhcnRZLCB0aGlzLm1vdmVTcGVlZCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge3RoaXMuZmxhcmUoJ21vdmVzdGFydCcpO30uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLndhaXQodGhpcy5tb3ZlV2FpdClcbiAgICAgICAgICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAvL+WGhumBi+WLlVxuICAgICAgICAgICAgY2FzZSBcImNpcmNsZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuYW5nbGUgPSAwO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnByb3BlcnRpZXMuY291bnRlckNsb2NrV2lzZSkge1xuICAgICAgICAgICAgICAgICAgICAvL+WPjeaZguioiOWbnuOCilxuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRvKHthbmdsZTogLTM2MH0sIHRoaXMubW92ZVNwZWVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7dGhpcy5mbGFyZSgnbW92ZWVuZCcpO30uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXQoe2FuZ2xlOiAwfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8v5pmC6KiI5Zue44KKXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAudG8oe2FuZ2xlOiAzNjB9LCB0aGlzLm1vdmVTcGVlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge3RoaXMuZmxhcmUoJ21vdmVlbmQnKTt9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0KHthbmdsZTogMH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0TG9vcCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/oqK3lrprjgZXjgozjgZ/jg5Hjgrnjgavmsr/jgaPjgabnp7vli5VcbiAgICAgICAgICAgIGNhc2UgXCJwYXRoXCI6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICAvL+OCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLmluZGV4ID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmluZGV4IHx8IDA7XG4gICAgICAgIHZhciBzdyA9IE1hdGguZmxvb3IodGhpcy53aWR0aCAvIDE2KTtcbiAgICAgICAgdmFyIHNoID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodCAvIDE2KSszMjtcbiAgICAgICAgdmFyIHRvcCA9IHRoaXMuaGVpZ2h0IC8gMjtcbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdzsgeCsrKSB7XG4gICAgICAgICAgICB2YXIgaWR4ID0gKHggJSAyKSArIDE7XG4gICAgICAgICAgICBpZiAoeCA9PSAwKSBpZHggPSAwO1xuICAgICAgICAgICAgaWYgKHggPT0gc3ctMSkgaWR4ID0gMztcbiAgICAgICAgICAgIHZhciBzID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJmbG9vclwiLCAxNiwgOTYpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAuc2V0RnJhbWVUcmltbWluZyh0aGlzLmluZGV4ICogNjQsIDMyLCA2NCwgOTYpXG4gICAgICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoaWR4KVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbih4ICogMTYgLSB0aGlzLndpZHRoIC8gMiArIDgsIDE2LXRvcCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmICh0aGlzLm1vdmVUeXBlID09IFwiY2lyY2xlXCIpIHtcbiAgICAgICAgICAgIHZhciByYWQgPSB0aGlzLnJhZGl1cy50b1JhZGlhbigpO1xuICAgICAgICAgICAgdGhpcy54ID0gdGhpcy5jZW50ZXJYICsgTWF0aC5jb3MocmFkKSAqIHRoaXMubW92ZVJhZGl1cztcbiAgICAgICAgICAgIHRoaXMueSA9IHRoaXMuY2VudGVyWSArIE1hdGguc2luKHJhZCkgKiB0aGlzLm1vdmVSYWRpdXM7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5tb3ZlVHlwZSA9PSAncGF0aCcpIHtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5YGc5q2i44Go5YaN55SfXG4gICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkgdGhpcy50d2VlbmVyLnBhdXNlKCk7XG4gICAgICAgIGlmICh0aGlzLmlzQWN0aXZlKSB0aGlzLnR3ZWVuZXIucGxheSgpO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbGxpc2lvbikge1xuICAgICAgICAgICAgdGhpcy5jb2xsaXNpb24udnggPSB0aGlzLnggLSB0aGlzLmNvbGxpc2lvbi54O1xuICAgICAgICAgICAgdGhpcy5jb2xsaXNpb24udnkgPSB0aGlzLnkgLSB0aGlzLmNvbGxpc2lvbi55O1xuICAgICAgICAgICAgdGhpcy5jb2xsaXNpb24ueCA9IHRoaXMueDtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnkgPSB0aGlzLnk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOS4iuOBq+S5l+OBo+OBpuOBhOOCi+OBi+WIpOWumlxuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdGhpcy5pc09uUGxheWVyID0gZmFsc2U7XG4gICAgICAgIGlmIChwbC5mbG9vck9iamVjdCAmJiBwbC5mbG9vck9iamVjdC5wYXJlbnRPYmplY3QgPT09IHRoaXMpIHtcbiAgICAgICAgICAgIHRoaXMuaXNPblBsYXllciA9IHRydWU7XG4gICAgICAgICAgICAvL+W6iuOBjOS4i+mZjeOBl+OBpuOBhOOCi+aZguOBruOBv1xuICAgICAgICAgICAgaWYgKCFwbC5pc0p1bXAgJiYgdGhpcy5jb2xsaXNpb24udnkgPiAwKSB7XG4gICAgICAgICAgICAgICAgcGwueSA9IHRoaXMueSAtIHRoaXMuaGVpZ2h0ICogMC41O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44OV44Ot44Ki5b2T44Gf44KK5Yik5a6a44Gu6L+95YqgXG4gICAgYWRkQ29sbGlzaW9uOiBmdW5jdGlvbiAobGF5ZXIpIHtcbiAgICAgICAgdGhpcy5jb2xsaXNpb24gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogdGhpcy53aWR0aCwgaGVpZ2h0OiB0aGlzLmhlaWdodH0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyhsYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSlcbiAgICAgICAgICAgIC5zZXRWaXNpYmxlKERFQlVHX0NPTExJU0lPTik7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLmFscGhhID0gMC4zO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi52eCA9IDA7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLnZ5ID0gMDtcbiAgICAgICAgdGhpcy5jb2xsaXNpb24uaWdub3JlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLnR5cGUgPSBcIm1vdmVmbG9vclwiO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi5wYXJlbnRPYmplY3QgPSB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+enu+WLleODkeOCueOBruioreWumlxuICAgIHNldFBhdGg6IGZ1bmN0aW9uKHN0YXJ0WCwgc3RhcnRZLCBwYXRoLCBsb29wKSB7XG4gICAgICAgIHRoaXMueCA9IHN0YXJ0WDtcbiAgICAgICAgdGhpcy55ID0gc3RhcnRZO1xuICAgICAgICB0aGlzLnBhdGggPSBwYXRoO1xuICAgICAgICB0aGlzLmxvb3AgPSBsb29wO1xuXG4gICAgICAgIGlmIChsb29wKSB7XG4gICAgICAgICAgICAvL+i3nembouioiOeul1xuICAgICAgICAgICAgdmFyIHN1bSA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHAxID0gcGF0aFtpXTtcbiAgICAgICAgICAgICAgICB2YXIgcDIgPSBwYXRoW2krMV07XG4gICAgICAgICAgICAgICAgcDIubWFnbml0dWRlID0gTWF0aC5zcXJ0KChwMi54IC0gcDEueCkgKiAocDIueCAtIHAxLngpICsgKHAyLnkgLSBwMS55KSAqIChwMi55IC0gcDEueSkpO1xuICAgICAgICAgICAgICAgIHN1bSArPSBwMi5tYWduaXR1ZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+e1gueCueOBi+OCieWni+eCueOBvuOBp+OBrui3nembouOCkuWKoOeul1xuICAgICAgICAgICAgdmFyIHAxID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgdmFyIHAyID0gcGF0aFswXTtcbiAgICAgICAgICAgIHAyLm1hZ25pdHVkZSA9IE1hdGguc3FydCgocDIueCAtIHAxLngpICogKHAyLnggLSBwMS54KSArIChwMi55IC0gcDEueSkgKiAocDIueSAtIHAxLnkpKTtcbiAgICAgICAgICAgIHN1bSArPSBwMi5tYWduaXR1ZGU7XG4gICAgICAgICAgICB2YXIgdW5pdCA9IHRoaXMubW92ZVNwZWVkIC8gc3VtO1xuXG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKS53YWl0KDYwKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwID0gcGF0aFtpXTtcbiAgICAgICAgICAgICAgICB2YXIgdGltZSA9IE1hdGguZmxvb3IocC5tYWduaXR1ZGUgKiB1bml0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIubW92ZVRvKHN0YXJ0WCArIHAueCwgc3RhcnRZICsgcC55LCB0aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5tb3ZlVG8oc3RhcnRYICsgcGF0aFswXS54LCBzdGFydFkgKyBwYXRoWzBdLnksIHRpbWUpO1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLnNldExvb3AodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL+W+gOi3r+i3nembouioiOeul1xuICAgICAgICAgICAgdmFyIHN1bSA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHAxID0gcGF0aFtpXTtcbiAgICAgICAgICAgICAgICB2YXIgcDIgPSBwYXRoW2krMV07XG4gICAgICAgICAgICAgICAgcDIubWFnbml0dWRlID0gTWF0aC5zcXJ0KChwMi54IC0gcDEueCkgKiAocDIueCAtIHAxLngpICsgKHAyLnkgLSBwMS55KSAqIChwMi55IC0gcDEueSkpO1xuICAgICAgICAgICAgICAgIHN1bSArPSBwMi5tYWduaXR1ZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdW5pdCA9IHRoaXMubW92ZVNwZWVkIC8gc3VtO1xuXG4gICAgICAgICAgICAvL+W+qei3r+i3nembouioiOeul1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIHZhciBwMSA9IHBhdGhbaV07XG4gICAgICAgICAgICAgICAgdmFyIHAyID0gcGF0aFtpLTFdO1xuICAgICAgICAgICAgICAgIHAyLm1hZ25pdHVkZV9yZXQgPSBNYXRoLnNxcnQoKHAyLnggLSBwMS54KSAqIChwMi54IC0gcDEueCkgKyAocDIueSAtIHAxLnkpICogKHAyLnkgLSBwMS55KSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpLndhaXQoNjApO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBwYXRoW2ldO1xuICAgICAgICAgICAgICAgIHZhciB0aW1lID0gTWF0aC5mbG9vcihwLm1hZ25pdHVkZSAqIHVuaXQpO1xuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5tb3ZlVG8oc3RhcnRYICsgcC54LCBzdGFydFkgKyBwLnksIHRpbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50d2VlbmVyLndhaXQoNjApO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHBhdGgubGVuZ3RoIC0gMjsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICB2YXIgcCA9IHBhdGhbaV07XG4gICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBNYXRoLmZsb29yKHAubWFnbml0dWRlX3JldCAqIHVuaXQpO1xuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5tb3ZlVG8oc3RhcnRYICsgcC54LCBzdGFydFkgKyBwLnksIHRpbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50d2VlbmVyLnNldExvb3AodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG4iLCIvKlxuICogIG1hcG9iamVjdC5nYXRlLmpzXG4gKiAgMjAxNy8wMy8yMFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucWZ0Lk1hcE9iamVjdCA9IHFmdC5NYXBPYmplY3QgfHwge307XG5cbi8v44Ov44O844OX44Ky44O844OIXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkdhdGVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAuMCxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/lrp/ooYzmuIjjgb/jg5Xjg6njgrBcbiAgICBhbHJlYWR5OiBmYWxzZSxcblxuICAgIC8v44Ot44OD44Kv44GV44KM44Gm44GE44KL44GLXG4gICAgaXNMb2NrOiBmYWxzZSxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz44OV44Op44KwXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciB3aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgMzY7XG4gICAgICAgIHZhciBoZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCA2NDtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHt3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0fSk7XG4gICAgICAgIHRoaXMud2lkdGhfaGFsZiA9IHdpZHRoIC8gMjtcbiAgICAgICAgdGhpcy5oZWlnaHRfaGFsZiA9IGhlaWdodCAvIDI7XG5cbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7XG4gICAgICAgIHRoaXMuaXNMb2NrID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmxvY2sgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMubmFtZSA9IG9wdGlvbnMubmFtZTtcbiAgICAgICAgdGhpcy5lbnRlck9mZnNldCA9IG9wdGlvbnMucHJvcGVydGllcy5lbnRlck9mZnNldCB8fCAwO1xuXG4gICAgICAgIC8v44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gbnVsbDtcblxuICAgICAgICAvL+OCsuODvOODiOapn+iDvVxuICAgICAgICB2YXIgcHJvcGVydGllcyA9IG9wdGlvbnMucHJvcGVydGllcztcbiAgICAgICAgc3dpdGNoIChvcHRpb25zLm5hbWUpIHtcbiAgICAgICAgICAgIC8v44Oe44OD44OX5YaF56e75YuVXG4gICAgICAgICAgICBjYXNlIFwid2FycFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubmV4dElEID0gcHJvcGVydGllcy5uZXh0SUQ7XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSBwcm9wZXJ0aWVzLm9mZnNldCB8fCAwO1xuICAgICAgICAgICAgICAgIHRoaXMub24oJ2VudGVyZG9vcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ihjOOBjeWFiOOBruaknOe0olxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMuZmluZEdhdGUodGhpcy5uZXh0SUQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5leHQpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbnRlclBsYXllcigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLndhcnAobmV4dC54LCBuZXh0LnkrbmV4dC5vZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoMTIwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFscmVhZHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0LmxlYXZlUGxheWVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgLy/jg57jg4Pjg5fliIfjgormm7/jgYhcbiAgICAgICAgICAgIGNhc2UgXCJtYXBzd2l0Y2hcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5leHRJRCA9IHByb3BlcnRpZXMubmV4dElEO1xuICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gcHJvcGVydGllcy5vZmZzZXQgfHwgMDtcbiAgICAgICAgICAgICAgICB0aGlzLnRvTGF5ZXJOdW1iZXIgPSBwcm9wZXJ0aWVzLnRvTGF5ZXJOdW1iZXI7XG4gICAgICAgICAgICAgICAgdGhpcy5vbignZW50ZXJkb29yJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXllciA9IHRoaXMucGFyZW50U2NlbmUuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyW3RoaXMudG9MYXllck51bWJlcl07XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gdGhpcy5wYXJlbnRTY2VuZS5zdGFnZUNvbnRyb2xsZXIuZmluZE9iamVjdCh0aGlzLm5leHRJRCwgdGhpcy50b0xheWVyTnVtYmVyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0KSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW50ZXJQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnN3aXRjaE1hcChsYXllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIuc2V0UG9zaXRpb24obmV4dC54LCBuZXh0LnkgKyBuZXh0Lm9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbHJlYWR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dC5sZWF2ZVBsYXllcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mZy50d2VlbmVyLmNsZWFyKCkud2FpdCgzMCkuZmFkZUluKDMwKS5mYWRlT3V0KDMwKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OR44O844OG44Kj44Kv44OrXG4gICAgICAgIGlmICghdGhpcy5pc0xvY2sgJiYgdGhpcy50aW1lICUgNiA9PSAwKSB7XG4gICAgICAgICAgICAoMikudGltZXMoZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgICAgIHZhciBzcCA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwicGFydGljbGVcIiwgMTYsIDE2KVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAuc2V0RnJhbWVJbmRleCgwKVxuICAgICAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMClcbiAgICAgICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKE1hdGgucmFuZGludCgtdGhpcy53aWR0aF9oYWxmLCB0aGlzLndpZHRoX2hhbGYpLCB0aGlzLmhlaWdodF9oYWxmICsgTWF0aC5yYW5kaW50KC00LCA0KSk7XG4gICAgICAgICAgICAgICAgc3AuYWxwaGEgPSAwLjM7XG4gICAgICAgICAgICAgICAgc3AudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5ieSh7eTogLTQ4LCBhbHBoYTogIDAuOSwgc2NhbGVYOiAgMC4zLCBzY2FsZVk6ICAwLjN9LCAxMDAwLCBcImVhc2VJblNpbmVcIilcbiAgICAgICAgICAgICAgICAgICAgLmJ5KHt5OiAtNDgsIGFscGhhOiAtMC45LCBzY2FsZVg6IC0wLjMsIHNjYWxlWTogLTAuM30sIDEwMDAsIFwiZWFzZU91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQoc3ApKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzjgrLjg7zjg4jjgavlhaXjgotcbiAgICBlbnRlclBsYXllcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBlbnRlck9mZnNldCA9IHRoaXMuZW50ZXJPZmZzZXQ7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgcGxheWVyLmFscGhhID0gMDtcbiAgICAgICAgcGxheWVyLmlzQ29udHJvbCA9IGZhbHNlO1xuICAgICAgICBwbGF5ZXIuaXNNdXRla2kgPSB0cnVlO1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLnNldFBvc2l0aW9uKHBsYXllci54LCBwbGF5ZXIueSkuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAubW92ZVRvKHRoaXMueCwgdGhpcy55K2VudGVyT2Zmc2V0LCAxNSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWRlT3V0KDE1KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzjgrLjg7zjg4jjgYvjgonlh7rjgotcbiAgICBsZWF2ZVBsYXllcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgcGxheWVyLmFscGhhID0gMDtcbiAgICAgICAgcGxheWVyLmlzQ29udHJvbCA9IGZhbHNlO1xuICAgICAgICBwbGF5ZXIuaXNNdXRla2kgPSB0cnVlO1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55KS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpO1xuICAgICAgICBwbC5hbHBoYSA9IDA7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgIC5mYWRlSW4oMTUpXG4gICAgICAgICAgICAubW92ZVRvKHBsYXllci54LCBwbGF5ZXIueSwgMzApXG4gICAgICAgICAgICAuZmFkZUluKDEwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGxheWVyLmFscGhhID0gMTtcbiAgICAgICAgICAgICAgICBwbGF5ZXIuaXNDb250cm9sID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBwbGF5ZXIuaXNNdXRla2kgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBwbC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+S7luOBruOCsuODvOODiOOCkuaknOe0olxuICAgIGZpbmRHYXRlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5vYmpMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0Lk1hcE9iamVjdC5HYXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUuaWQgPT0gaWQpIHJlc3VsdCA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QubnBjLmpzXG4gKiAgMjAxNy8wOC8wOVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/lhpLpmbrogIVcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QubnBjXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIC8v56e75YuV6YCf5bqmXG4gICAgc3BlZWQ6IDIsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiA4LFxuXG4gICAgLy/lvbHooajnpLrjg5Xjg6njgrBcbiAgICBpc1NoYWRvdzogdHJ1ZSxcblxuICAgIC8v56e75YuV44OV44Op44KwXG4gICAgaXNNb3ZlOiB0cnVlLFxuXG4gICAgLy/kuI3li5Xjg5Xjg6njgrBcbiAgICB0b0ZpeDogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyNCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImFjdG9yXCIgKyAob3B0aW9ucy5wcm9wZXJ0aWVzLmFjdG9yIHx8IFwiNDBcIiksIDMyLCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2NhbGVYID0gLTE7XG5cbiAgICAgICAgdGhpcy5zcGVlZCA9IG9wdGlvbnMucHJvcGVydGllcy5zcGVlZCB8fCB0aGlzLnNwZWVkO1xuICAgICAgICB0aGlzLmlzTW92ZSA9IChvcHRpb25zLnByb3BlcnRpZXMuaXNNb3ZlID09PSB1bmRlZmluZWQ/IHRydWU6IG9wdGlvbnMucHJvcGVydGllcy5pc01vdmUpO1xuICAgICAgICB0aGlzLnRlcnJpdG9yeSA9IG9wdGlvbnMucHJvcGVydGllcy50ZXJyaXRvcnkgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBvcHRpb25zLnByb3BlcnRpZXMuZGlyZWN0aW9uIHx8IDA7XG4gICAgICAgIHRoaXMudGV4dCA9IG9wdGlvbnMucHJvcGVydGllcy50ZXh0O1xuXG4gICAgICAgIGlmIChvcHRpb25zLnByb3BlcnRpZXMudG9GaXgpIHtcbiAgICAgICAgICAgIHRoaXMuaWdub3JlQ29sbGlzaW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZ3Jhdml0eSA9IDA7XG4gICAgICAgICAgICB0aGlzLmlzTW92ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy50b0ZpeCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLm9uZSgnZW50ZXJmcmFtZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHVwRml4ZWRTaGFkb3coKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuXG4gICAgICAgIHRoaXMud2FpdFRpbWUgPSAwO1xuXG4gICAgICAgIHRoaXMub25lKCdlbnRlcmZyYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzTW92ZSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgOTA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImRvd25cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxODA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjcwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLndhaXRUaW1lID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzTW92ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubW92ZUFsZ29yaXRobSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaUu+aSg+OBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICBpZiAocGwuaXNBdHRhY2sgJiYgdGhpcy5oaXRUZXN0RWxlbWVudChwbC5hdHRhY2tDb2xsaXNpb24pKSB7XG4gICAgICAgICAgICAgICAgLy/oqbHjgZfjgYvjgZHjgZ/kuovjgavjgarjgotcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCg1KVxuICAgICAgICAgICAgICAgICAgICAuY2FsbCgoKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY2VuZSA9IHFmdC5Db252ZXJzYXRpb25TY2VuZSh0aGlzLnBhcmVudFNjZW5lLCB0aGlzLnRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShzY2VuZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMud2FpdFRpbWUgPSAxNTtcblxuICAgICAgICAgICAgICAgIC8v5ZCR44GN44Gu6Kq/5pW0XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMud2FpdFRpbWUtLTtcbiAgICAgICAgaWYgKHRoaXMud2FpdFRpbWUgPCAwKSB0aGlzLndhaXRUaW1lID0gMDtcbiAgICB9LFxuXG4gICAgbW92ZUFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/ltJbjgaPjgbfjgaHjgafmipjjgorov5TjgZlcbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODhuODquODiOODquODvOaMh+WumlxuICAgICAgICAgICAgaWYgKHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgLy/msLTlubPmlrnlkJHjga7jgb/jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgICAgICB2YXIgdHggPSB0aGlzLnggLSB0aGlzLmZpcnN0WDtcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnModHgpID4gdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAgdGhpcy5zcGVlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzEzLCAxNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzM2LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWyAzLCAgNCwgIDUsICA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbIDksIDEwLCAxMSwgMTBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFsgMCwgIDEsICAyLCAgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQxLCA0MiwgNDMsIDQ0LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkZWZlbnNlXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGFtYWdlXCJdID0gWyAxOCwgMTksIDIwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRyb3BcIl0gPSBbMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkZWFkXCJdID0gWzE4LCAxOSwgMjAsIDMzLCAzNCwgMzUsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsZWFyXCJdID0gWzI0LCAyNSwgMjZdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3R1blwiXSA9IFsgMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/lm7rlrprlvbHooajnpLrjgrvjg4Pjg4jjgqLjg4Pjg5dcbiAgICBzZXR1cEZpeGVkU2hhZG93OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgc2MgPSB0aGlzLndpZHRoIC8gMjQ7XG4gICAgICAgIGlmIChzYyA8IDEpIHNjICs9IDAuMjtcbiAgICAgICAgdGhpcy5maXhlZFNoYWRvd1Nwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwic2hhZG93XCIsIDI0LCA4KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5zaGFkb3dMYXllcilcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjUpXG4gICAgICAgICAgICAuc2V0U2NhbGUoc2MsIDEuMCk7XG4gICAgICAgIHRoaXMuZml4ZWRTaGFkb3dTcHJpdGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmFscGhhID0gMC41O1xuICAgICAgICAgICAgaWYgKHRoYXQuYWxwaGEgPCAwLjUpIHRoaXMuYWxwaGEgPSB0aGF0LmFscGhhO1xuICAgICAgICAgICAgdGhpcy54ID0gdGhhdC54O1xuICAgICAgICAgICAgdGhpcy55ID0gdGhhdC55ICsgMTY7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG4iXX0=
