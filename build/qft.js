/*
 *  phina.assetloaderex.js
 *  2016/11/25
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//バックグラウンドでアセット読み込み
phina.define("phina.extension.AssetLoaderEx", {

    //進捗
    loadprogress: 0,

    //読み込み終了フラグ
    loadcomplete: false,

    init: function() {
    },

    load: function(assets, callback) {
        this._onLoadAssets = callback || function(){};
        var loader = phina.asset.AssetLoader();
        loader.load(assets);
        loader.on('load', function(e) {
            this.loadcomplete = true;
            this._onLoadAssets();
        }.bind(this));
        loader.onprogress = function(e) {
            this.loadprogress = e.progress;
        }.bind(this);
        return this;
    },
});

/*
 *  phina.extension.js
 *  2016/11/25
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//setAlphaを追加
phina.display.DisplayElement.prototype.setAlpha = function(val) {
    this.alpha = val;
    return this;
};

//スプライト機能拡張
phina.display.Sprite.prototype.setFrameTrimming = function(x, y, width, height) {
  this._frameTrimX = x || 0;
  this._frameTrimY = y || 0;
  this._frameTrimWidth = width || this.image.domElement.width - this._frameTrimX;
  this._frameTrimHeight = height || this.image.domElement.height - this._frameTrimY;
  return this;
}

phina.display.Sprite.prototype.setFrameIndex = function(index, width, height) {
  var sx = this._frameTrimX || 0;
  var sy = this._frameTrimY || 0;
  var sw = this._frameTrimWidth  || (this.image.domElement.width-sx);
  var sh = this._frameTrimHeight || (this.image.domElement.height-sy);

  var tw  = width || this.width;      // tw
  var th  = height || this.height;    // th
  var row = ~~(sw / tw);
  var col = ~~(sh / th);
  var maxIndex = row*col;
  index = index%maxIndex;

  var x   = index%row;
  var y   = ~~(index/row);
  this.srcRect.x = sx+x*tw;
  this.srcRect.y = sy+y*th;
  this.srcRect.width  = tw;
  this.srcRect.height = th;

  this._frameIndex = index;

  return this;
}

//エレメント同士の接触判定
phina.display.DisplayElement.prototype.isHitElement = function(elm) {
    //自分とテスト対象をグローバルへ変換
    var p = this.globalToLocal(elm);
    var target = phina.display.DisplayElement({width: elm.width, height: elm.height}).setPosition(p.x, p.y);

    if (this.boundingType == 'rect') {
        if (elm.boundingType == 'rect') {
            return phina.geom.Collision.testRectRect(this, target);
        } else {
            return phina.geom.Collision.testRectCircle(this, target);
        }
    } else {
        if (elm.boundingType == 'rect') {
            return phina.geom.Collision.testCiecleRect(this, target);
        } else {
            return phina.geom.Collision.testCircleCircle(this, target);
        }
    }
}

//子要素全て切り離し
phina.app.Element.prototype.removeChildren = function(beginIndex) {
    beginIndex = beginIndex || 0;
    var tempChildren = this.children.slice();
    var len = len = tempChildren.length;
    for (var i = beginIndex; i < len; ++i) {
        tempChildren[i].remove();
    }
    this.children = [];
}

/**
 * @method testLineLine
 * @static
 * 2つの線分が重なっているかどうかを判定します
 * 参考：http://www5d.biglobe.ne.jp/~tomoya03/shtml/algorithm/Intersection.htm
 *
 * ### Example
 *     p1 = phina.geom.Vector2(100, 100);
 *     p2 = phina.geom.Vector2(200, 200);
 *     p3 = phina.geom.Vector2(150, 240);
 *     p4 = phina.geom.Vector2(200, 100);
 * phina.geom.Collision.testLineLine(p1, p2, p3, p4); // => true
 *
 * @param {phina.geom.Vector2} p1 線分1の端の座標
 * @param {phina.geom.Vector2} p2 線分1の端の座標
 * @param {phina.geom.Vector2} p3 線分2の端の座標
 * @param {phina.geom.Vector2} p4 線分2の端の座標
 * @return {Boolean} 線分1と線分2が重なっているかどうか
 */
phina.geom.Collision.testLineLine = function(p1, p2, p3, p4) {
  //同一ＸＹ軸上に乗ってる場合の誤判定回避
  if (p1.x == p2.x && p1.x == p3.x && p1.x == p4.x) {
    var min = Math.min(p1.y, p2.y);
    var max = Math.max(p1.y, p2.y);
    if (min <= p3.y && p3.y <= max || min <= p4.y && p4.y <= max) return true;
    return false;
  }
  if (p1.y == p2.y && p1.y == p3.y && p1.y == p4.y) {
    var min = Math.min(p1.x, p2.x);
    var max = Math.max(p1.x, p2.x);
    if (min <= p3.x && p3.x <= max || min <= p4.x && p4.x <= max) return true;
    return false;
  }
  var a = (p1.x - p2.x) * (p3.y - p1.y) + (p1.y - p2.y) * (p1.x - p3.x);
  var b = (p1.x - p2.x) * (p4.y - p1.y) + (p1.y - p2.y) * (p1.x - p4.x);
  var c = (p3.x - p4.x) * (p1.y - p3.y) + (p3.y - p4.y) * (p3.x - p1.x);
  var d = (p3.x - p4.x) * (p2.y - p3.y) + (p3.y - p4.y) * (p3.x - p2.x);
  return a * b <= 0 && c * d <= 0;
}

/**
 * @method testRectLine
 * @static
 * 矩形と線分が重なっているかどうかを判定します
 *
 * ### Example
 *     rect = phina.geom.Rect(120, 130, 40, 50);
 *     p1 = phina.geom.Vector2(100, 100);
 *     p2 = phina.geom.Vector2(200, 200);
 * phina.geom.Collision.testRectLine(rect, p1, p2); // => true
 *
 * @param {phina.geom.Rect} rect 矩形領域オブジェクト
 * @param {phina.geom.Vector2} p1 線分の端の座標
 * @param {phina.geom.Vector2} p2 線分の端の座標
 * @return {Boolean} 矩形と線分が重なっているかどうか
 */
phina.geom.Collision.testRectLine = function(rect, p1, p2) {
    //包含判定(p1が含まれてれば良いのでp2の判定はしない）
    if (rect.left <= p1.x && p1.x <= rect.right && rect.top <= p1.y && p1.y <= rect.bottom ) return true;

    //矩形の４点
    var r1 = phina.geom.Vector2(rect.left, rect.top);     //左上
    var r2 = phina.geom.Vector2(rect.right, rect.top);    //右上
    var r3 = phina.geom.Vector2(rect.right, rect.bottom); //右下
    var r4 = phina.geom.Vector2(rect.left, rect.bottom);  //左下

    //矩形の４辺をなす線分との接触判定
    if (phina.geom.Collision.testLineLine(p1, p2, r1, r2)) return true;
    if (phina.geom.Collision.testLineLine(p1, p2, r2, r3)) return true;
    if (phina.geom.Collision.testLineLine(p1, p2, r3, r4)) return true;
    if (phina.geom.Collision.testLineLine(p1, p2, r1, r4)) return true;
    return false;
}


//円弧の描画
phina.define('phina.display.ArcShape', {
  superClass: 'phina.display.Shape',

  init: function(options) {
    options = ({}).$safe(options, {
      backgroundColor: 'transparent',
      fill: 'red',
      stroke: '#aaa',
      strokeWidth: 4,
      radius: 32,
      startAngle: 0,
      endAngle: 270,

      anticlockwise: false,
    });
    this.superInit(options);

    this.radius = options.radius;
    this.startAngle = options.startAngle;
    this.endAngle = options.endAngle;
    this.anticlockwise = options.anticlockwise;

    this.setBoundingType('circle');
  },

  prerender: function(canvas) {
    canvas.fillPie(0, 0, this.radius, this.startAngle, this.endAngle);
  },
});

/*
 *  phina.tiledmap.js
 *  2016/09/10
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

/**
 * @class phina.asset.TiledMap
 * @extends phina.asset.Asset
 * # TiledMapEditorで作成したtmxファイルを読み込みクラス
 */
phina.define("phina.asset.TiledMap", {
    superClass: "phina.asset.Asset",

    /**
     * @property image
     * 作成されたマップ画像
     */
    image: null,

    /**
     * @property tilesets
     * タイルセット情報
     */
    tilesets: null,

    /**
     * @property layers
     * レイヤー情報が格納されている配列
     */
    layers: null,

    init: function() {
        this.superInit();
    },

    _load: function(resolve) {
        //パス抜き出し
        this.path = "";
        var last = this.src.lastIndexOf("/");
        if (last > 0) {
            this.path = this.src.substring(0, last+1);
        }

        //終了関数保存
        this._resolve = resolve;

        // load
        var self = this;
        var xml = new XMLHttpRequest();
        xml.open('GET', this.src);
        xml.onreadystatechange = function() {
            if (xml.readyState === 4) {
                if ([200, 201, 0].indexOf(xml.status) !== -1) {
                    var data = xml.responseText;
                    data = (new DOMParser()).parseFromString(data, "text/xml");
                    self.dataType = "xml";
                    self.data = data;
                    self._parse(data);
//                    resolve(self);
                }
            }
        };
        xml.send(null);
    },

    /**
     * @method getMapData
     * 指定したマップレイヤーを配列として取得します。
     *
     * @param {String} layerName 対象レイヤー名
     */
    getMapData: function(layerName) {
        //レイヤー検索
        var data = null;
        for(var i = 0; i < this.layers.length; i++) {
            if (this.layers[i].name == layerName) {
                //コピーを返す
                return this.layers[i].data.concat();
            }
        }
        return null;
    },

    /**
     * @method getObjectGroup
     * オブジェクトグループを取得します
     *
     * グループ指定が無い場合、全レイヤーを配列にして返します。
     *
     * @param {String} grounpName 対象オブジェクトグループ名
     */
    getObjectGroup: function(groupName) {
        groupName = groupName || null;
        var ls = [];
        var len = this.layers.length;
        for (var i = 0; i < len; i++) {
            if (this.layers[i].type == "objectgroup") {
                if (groupName == null || groupName == this.layers[i].name) {
                    //レイヤー情報をクローンする
                    var obj = this._cloneObjectLayer(this.layers[i]);
                    if (groupName !== null) return obj;
                }
                ls.push(obj);
            }
        }
        return ls;
    },

    /**
     * @method getMapImage
     * マップイメージの作成
     *
     * 複数のマップレイヤーを指定出来ます。
     * 描画順序はTiledMapEditor側での指定順では無く、引数の順序となります（第一引数が一番下となる）
     *
     * @param {String}  対象レイヤー名
     */
    getImage: function(...args) {
        var numLayer = 0;
        for (var i = 0; i < this.layers.length; i++) {
            if (this.layers[i].type == "layer" || this.layers[i].type == "imagelayer") numLayer++;
        }
        if (numLayer == 0) return null;

        var generated = false;
        var width = this.width * this.tilewidth;
        var height = this.height * this.tileheight;
        var canvas = phina.graphics.Canvas().setSize(width, height);

        for (var i = 0; i < this.layers.length; i++) {
            var find = args.indexOf(this.layers[i].name);
            if (args.length == 0 || find >= 0) {
                //マップレイヤー
                if (this.layers[i].type == "layer" && this.layers[i].visible != "0") {
                    var layer = this.layers[i];
                    var mapdata = layer.data;
                    var width = layer.width;
                    var height = layer.height;
                    var opacity = layer.opacity || 1.0;
                    var count = 0;
                    for (var y = 0; y < height; y++) {
                        for (var x = 0; x < width; x++) {
                            var index = mapdata[count];
                                if (index !== -1) {
                                //マップチップを配置
                                this._setMapChip(canvas, index, x * this.tilewidth, y * this.tileheight, opacity);
                            }
                            count++;
                        }
                    }
                    generated = true;
                }
                //オブジェクトグループ
                if (this.layers[i].type == "objectgroup" && this.layers[i].visible != "0") {
                    var layer = this.layers[i];
                    var opacity = layer.opacity || 1.0;
                    layer.objects.forEach(function(e) {
                        if (e.gid) {
                            this._setMapChip(canvas, e.gid, e.x, e.y, opacity);
                        }
                    }.bind(this));
                    generated = true;
                }
                //イメージレイヤー
                if (this.layers[i].type == "imagelayer" && this.layers[i].visible != "0") {
                    var len = this.layers[i];
                    var image = phina.asset.AssetManager.get('image', this.layers[i].image.source);
                    canvas.context.drawImage(image.domElement, this.layers[i].x, this.layers[i].y);
                    generated = true;
                }
            }
        }

        if (!generated) return null;

        var texture = phina.asset.Texture();
        texture.domElement = canvas.domElement;
        return texture;
    },

    /**
     * @method _cloneObjectLayer
     * 引数として渡されたオブジェクトレイヤーをクローンして返します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _cloneObjectLayer: function(srcLayer) {
        var result = {}.$safe(srcLayer);
        result.objects = [];
        //レイヤー内オブジェクトのコピー
        srcLayer.objects.forEach(function(obj){
            var resObj = {
                properties: {}.$safe(obj.properties),
            }.$extend(obj);
            if (obj.ellipse) resObj.ellipse = obj.ellipse;
            if (obj.gid) resObj.gid = obj.gid;
            if (obj.polygon) resObj.polygon = obj.polygon.clone();
            if (obj.polyline) resObj.polyline = obj.polyline.clone();
            result.objects.push(resObj);
        });
        return result;
    },

    /**
     * @method _parse
     * 取得したTiledMapEditのデータをパースします。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parse: function(data) {
        //タイル属性情報取得
        var map = data.getElementsByTagName('map')[0];
        var attr = this._attrToJSON(map);
        this.$extend(attr);
        this.properties = this._propertiesToJSON(map);

        //タイルセット取得
        this.tilesets = this._parseTilesets(data);

        //タイルセット情報補完
        var defaultAttr = {
            tilewidth: 32,
            tileheight: 32,
            spacing: 0,
            margin: 0,
        };
        this.tilesets.chips = [];
        for (var i = 0; i < this.tilesets.length; i++) {
            //タイルセット属性情報取得
            var attr = this._attrToJSON(data.getElementsByTagName('tileset')[i]);
            attr.$safe(defaultAttr);
            attr.firstgid--;
            this.tilesets[i].$extend(attr);

            //マップチップリスト作成
            var t = this.tilesets[i];
            this.tilesets[i].mapChip = [];
            for (var r = attr.firstgid; r < attr.firstgid+attr.tilecount; r++) {
                var chip = {
                    image: t.image,
                    x: ((r - attr.firstgid) % t.columns) * (t.tilewidth + t.spacing) + t.margin,
                    y: Math.floor((r - attr.firstgid) / t.columns) * (t.tileheight + t.spacing) + t.margin,
                }.$safe(attr);
                this.tilesets.chips[r] = chip;
            }
        }

        //レイヤー取得
        this.layers = this._parseLayers(data);

        //イメージデータ読み込み
        this._checkImage();
    },

    /**
     * @method _checkImage
     * アセットに無いイメージデータをチェックして読み込みを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _checkImage: function() {
        var that = this;
        var imageSource = [];
        var loadImage = [];

        //一覧作成
        for (var i = 0; i < this.tilesets.length; i++) {
            var obj = {
                image: this.tilesets[i].image,
                transR: this.tilesets[i].transR,
                transG: this.tilesets[i].transG,
                transB: this.tilesets[i].transB,
            };
            imageSource.push(obj);
        }
        for (var i = 0; i < this.layers.length; i++) {
            if (this.layers[i].image) {
                var obj = {
                    image: this.layers[i].image.source
                };
                imageSource.push(obj);
            }
        }

        //アセットにあるか確認
        for (var i = 0; i < imageSource.length; i++) {
            var image = phina.asset.AssetManager.get('image', imageSource[i].image);
            if (image) {
                //アセットにある
            } else {
                //なかったのでロードリストに追加
                loadImage.push(imageSource[i]);
            }
        }

        //一括ロード
        //ロードリスト作成
        var assets = {
            image: []
        };
        for (var i = 0; i < loadImage.length; i++) {
            //イメージのパスをマップと同じにする
            assets.image[loadImage[i].image] = this.path+loadImage[i].image;
        }
        if (loadImage.length) {
            var loader = phina.asset.AssetLoader();
            loader.load(assets);
            loader.on('load', function(e) {
                //透過色設定反映
                loadImage.forEach(function(elm) {
                    var image = phina.asset.AssetManager.get('image', elm.image);
                    if (elm.transR !== undefined) {
                        var r = elm.transR, g = elm.transG, b = elm.transB;
                        image.filter(function(pixel, index, x, y, bitmap) {
                            var data = bitmap.data;
                            if (pixel[0] == r && pixel[1] == g && pixel[2] == b) {
                                data[index+3] = 0;
                            }
                        });
                    }
                });
                //読み込み終了
                that._resolve(that);
            }.bind(this));
        } else {
            //読み込み終了
            this._resolve(that);
        }
    },

    /**
     * @method _setMapChip
     * キャンバスの指定した座標にマップチップのイメージをコピーします。
     *
     * 内部で使用している関数です。
     * @private
     */
    _setMapChip: function(canvas, index, x, y, opacity) {
        //タイルセットからマップチップを取得
        var chip = this.tilesets.chips[index];
        if (!chip) {
            return;
        }
        var image = phina.asset.AssetManager.get('image', chip.image);
        if (!image) {
            console.log(chip.image);
        }
        canvas.context.drawImage(
            image.domElement,
            chip.x + chip.margin, chip.y + chip.margin,
            chip.tilewidth, chip.tileheight,
            x, y,
            chip.tilewidth, chip.tileheight);
    },

    /**
     * @method _propertiesToJSON
     * XMLプロパティをJSONに変換します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _propertiesToJSON: function(elm) {
        var properties = elm.getElementsByTagName("properties")[0];
        var obj = {};
        if (properties === undefined) {
            return obj;
        }
        for (var k = 0; k < properties.childNodes.length; k++) {
            var p = properties.childNodes[k];
            if (p.tagName === "property") {
                //propertyにtype指定があったら変換
                var type = p.getAttribute('type');
                var value = p.getAttribute('value');
                if (!value) value = p.textContent;
                if (type == "int") {
                    obj[p.getAttribute('name')] = parseInt(value, 10);
                } else if (type == "float") {
                    obj[p.getAttribute('name')] = parseFloat(value);
                } else if (type == "bool" ) {
                    if (value == "true") obj[p.getAttribute('name')] = true;
                    else obj[p.getAttribute('name')] = false;
                } else {
                    obj[p.getAttribute('name')] = value;
                }
            }
        }
        return obj;
    },

    /**
     * @method _propertiesToJSON
     * XML属性情報をJSONに変換します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _attrToJSON: function(source) {
        var obj = {};
        for (var i = 0; i < source.attributes.length; i++) {
            var val = source.attributes[i].value;
            val = isNaN(parseFloat(val))? val: parseFloat(val);
            obj[source.attributes[i].name] = val;
        }
        return obj;
    },

    /**
     * @method _propertiesToJSON_str
     * XMLプロパティをJSONに変換し、文字列で返します。
     *
     * 内部で使用している関数です。
     * @private
     */
    _attrToJSON_str: function(source) {
        var obj = {};
        for (var i = 0; i < source.attributes.length; i++) {
            var val = source.attributes[i].value;
            obj[source.attributes[i].name] = val;
        }
        return obj;
    },

    /**
     * @method _parseTilesets
     * タイルセットのパースを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parseTilesets: function(xml) {
        var each = Array.prototype.forEach;
        var self = this;
        var data = [];
        var tilesets = xml.getElementsByTagName('tileset');
        each.call(tilesets, function(tileset) {
            var t = {};
            var props = self._propertiesToJSON(tileset);
            if (props.src) {
                t.image = props.src;
            } else {
                t.image = tileset.getElementsByTagName('image')[0].getAttribute('source');
            }
            //透過色設定取得
            t.trans = tileset.getElementsByTagName('image')[0].getAttribute('trans');
            if (t.trans) {
                t.transR = parseInt(t.trans.substring(0, 2), 16);
                t.transG = parseInt(t.trans.substring(2, 4), 16);
                t.transB = parseInt(t.trans.substring(4, 6), 16);
            }

            data.push(t);
        });
        return data;
    },

    /**
     * @method _parseLayers
     * レイヤー情報のパースを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parseLayers: function(xml) {
        var each = Array.prototype.forEach;
        var data = [];

        var map = xml.getElementsByTagName("map")[0];
        var layers = [];
        each.call(map.childNodes, function(elm) {
            if (elm.tagName == "layer" || elm.tagName == "objectgroup" || elm.tagName == "imagelayer") {
                layers.push(elm);
            }
        });

        layers.each(function(layer) {
            switch (layer.tagName) {
                case "layer":
                    //通常レイヤー
                    var d = layer.getElementsByTagName('data')[0];
                    var encoding = d.getAttribute("encoding");
                    var l = {
                        type: "layer",
                        name: layer.getAttribute("name"),
                    };

                    if (encoding == "csv") {
                        l.data = this._parseCSV(d.textContent);
                    } else if (encoding == "base64") {
                        l.data = this._parseBase64(d.textContent);
                    }

                    var attr = this._attrToJSON(layer);
                    l.$extend(attr);
                    l.properties = this._propertiesToJSON(layer);

                    data.push(l);
                    break;

                //オブジェクトレイヤー
                case "objectgroup":
                    var l = {
                        type: "objectgroup",
                        objects: [],
                        name: layer.getAttribute("name"),
                        x: parseFloat(layer.getAttribute("offsetx")) || 0,
                        y: parseFloat(layer.getAttribute("offsety")) || 0,
                        alpha: layer.getAttribute("opacity") || 1,
                        color: layer.getAttribute("color") || null,
                        draworder: layer.getAttribute("draworder") || null,
                    };
                    l.properties = this._propertiesToJSON(layer);

                    //レイヤー内解析
                    each.call(layer.childNodes, function(elm) {
                        if (elm.nodeType == 3) return;
                        var d = this._attrToJSON(elm);
                        if (d.id === undefined) return;
                        d.properties = this._propertiesToJSON(elm);
                        //子要素の解析
                        if (elm.childNodes.length) {
                            elm.childNodes.forEach(function(e) {
                                if (e.nodeType == 3) return;
                                //楕円
                                if (e.nodeName == 'ellipse') {
                                    d.ellipse = true;
                                }
                                //多角形
                                if (e.nodeName == 'polygon') {
                                    d.polygon = [];
                                    var attr = this._attrToJSON_str(e);
                                    var pl = attr.points.split(" ");
                                    pl.forEach(function(str) {
                                        var pts = str.split(",");
                                        d.polygon.push({x: parseFloat(pts[0]), y: parseFloat(pts[1])});
                                    });
                                }
                                //線分
                                if (e.nodeName == 'polyline') {
                                    d.polyline = [];
                                    var attr = this._attrToJSON_str(e);
                                    var pl = attr.points.split(" ");
                                    pl.forEach(function(str) {
                                        var pts = str.split(",");
                                        d.polyline.push({x: parseFloat(pts[0]), y: parseFloat(pts[1])});
                                    });
                                }
                            }.bind(this));
                        }
                        l.objects.push(d);
                    }.bind(this));

                    data.push(l);
                    break;

                //イメージレイヤー
                case "imagelayer":
                    var l = {
                        type: "imagelayer",
                        name: layer.getAttribute("name"),
                        x: parseFloat(layer.getAttribute("offsetx")) || 0,
                        y: parseFloat(layer.getAttribute("offsety")) || 0,
                        alpha: layer.getAttribute("opacity") || 1,
                        visible: (layer.getAttribute("visible") === undefined || layer.getAttribute("visible") != 0),
                    };
                    var imageElm = layer.getElementsByTagName("image")[0];
                    l.image = {source: imageElm.getAttribute("source")};

                    data.push(l);
                    break;
            }
        }.bind(this));
        return data;
    },

    /**
     * @method _perseCSV
     * CSVのパースを行います。
     *
     * 内部で使用している関数です。
     * @private
     */
    _parseCSV: function(data) {
        var dataList = data.split(',');
        var layer = [];

        dataList.each(function(elm, i) {
            var num = parseInt(elm, 10) - 1;
            layer.push(num);
        });

        return layer;
    },

    /**
     * @method _perseCSV
     * BASE64のパースを行います。
     *
     * 内部で使用している関数です。
     * http://thekannon-server.appspot.com/herpity-derpity.appspot.com/pastebin.com/75Kks0WH
     * @private
     */
    _parseBase64: function(data) {
        var dataList = atob(data.trim());
        var rst = [];

        dataList = dataList.split('').map(function(e) {
            return e.charCodeAt(0);
        });

        for (var i=0,len=dataList.length/4; i<len; ++i) {
            var n = dataList[i*4];
            rst[i] = parseInt(n, 10) - 1;
        }

        return rst;
    },
});

//ローダーに追加
phina.asset.AssetLoader.assetLoadFunctions.tmx = function(key, path) {
    var tmx = phina.asset.TiledMap();
    return tmx.load(path);
};

/*
 *  phina.virtualpad.js
 *  2017/06/13
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//バーチャルパッド
phina.define("phina.extension.VirtualPad", {
    superClass: "phina.display.DisplayElement",

    active: true,

    //挿下キー情報
    keyData: {
        up: false,
        down: false,
        left: false,
        right: false,
        a: false,
        b: false,
    },

    defaultOptions: {
        //パッド縦横
        width: 640,
        height: 480,

        //パッド座標
        x: 0,
        y: 0,

        //判定半径
        fingerRadius: 20,
    },

    init: function(options) {
        this.superInit();
        options = (options || {}).$safe(this.defaultOptions);
        this.options = options;

        var param = {
            width: options.width,
            height: options.height,
            fill: "rgba(0,0,0,0.3)",
            stroke: "rgba(0,0,0,0.3)",
            strokeWigth: 0,
            backgroundColor: 'transparent',
        };
        this.mask = phina.display.RectangleShape(param)
//            .addChildTo(this)
            .setOrigin(0, 0)
            .setPosition(options.x, options.y);

        this.analog = phina.extension.VirtualPad.AnalogStick()
            .addChildTo(this)
            .setPosition(82, options.height - 82);

        this.btn = [];
        this.btn[0] = phina.extension.VirtualPad.Button().addChildTo(this).setPosition(options.width * 0.7, options.height * 0.9);
        this.btn[1] = phina.extension.VirtualPad.Button().addChildTo(this).setPosition(options.width * 0.7 + 80, options.height * 0.9);

        //タップ位置表示
        var fingerParam = {
            backgroundColor: 'transparent',
            fill: "rgba(0,0,0,0.2)",
            stroke: "rgba(0,0,0,0.2)",
            strokeWidth: 1,
            radius: options.fingerRadius,
        };
        this.finger = [];
        for (var i = 0; i < 5; i++) {
            this.finger[i] = phina.display.CircleShape(fingerParam).addChildTo(this);
            this.finger[i].visible = false;
        }
    },

    update: function() {
    },

    updateInfo: function() {
        var p = app.mouse;
        if (p.getPointing()) {
            //タップ位置表示
            var ps = app.pointers;
            for (var i = 0; i < 5; i++) {
                if (i < ps.length) {
                    this.finger[i].visible = true;
                    this.finger[i].setPosition(ps[i].x, ps[i].y);
                } else {
                    this.finger[i].visible = false;
                }
            }
        } else {
            for (var i = 0; i < 5; i++) {
                this.finger[i].visible = false;
            }
        }
    },

    getKey: function(code) {
        var ov = 10;
        var angle = this.analog.angle;
        switch (code) {
            case "right":
                return angle && (angle >= 315 - ov || angle <= 45 + ov);
            case "down":
                return angle && (angle >= 45 - ov && angle <= 135 + ov);
            case "left":
                return angle && (angle >= 135 - ov && angle <= 215 + ov);
            case "up":
                return angle && (angle >= 215 - ov && angle <= 315 + ov);
            case "z":
            case "Z":
                return this.btn[0].isOn;
            case "x":
            case "X":
                return this.btn[1].isOn;
            default:
                return false;
        }
    },
});

//バーチャルパッド十字キー
phina.define("phina.extension.VirtualPad.CrossKey", {
    superClass: "phina.display.DisplayElement",

    active: true,

    init: function(options) {
        this.superInit();
        options = (options || {}).$safe(this.defaultOptions);
        this.options = options;

        //十字キー中心点
        var hw = 0;
        var hh = 0;
        var cp = phina.geom.Vector2(0, 0);

        var button = {
            width: 20,
            height: 20,
            fill: "rgba(0,0,0,0.2)",
            stroke: "rgba(0,0,0,0.2)",
            backgroundColor: 'transparent',
        };
        //0:上 1:右上 2:右 3:右下 4:下 5:左下 6:左 7:左上
        this.btn = [];
        this.btn[0] = phina.display.RectangleShape({width: 60, height: 50}.$safe(button)).setPosition(cp.x     , cp.y - 40).addChildTo(this).setInteractive(true);
        this.btn[2] = phina.display.RectangleShape({width: 50, height: 60}.$safe(button)).setPosition(cp.x + 40, cp.y     ).addChildTo(this).setInteractive(true);
        this.btn[4] = phina.display.RectangleShape({width: 60, height: 50}.$safe(button)).setPosition(cp.x     , cp.y + 40).addChildTo(this).setInteractive(true);
        this.btn[6] = phina.display.RectangleShape({width: 50, height: 60}.$safe(button)).setPosition(cp.x - 40, cp.y     ).addChildTo(this).setInteractive(true);

        this.btn[1] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x + 40, cp.y - 40).addChildTo(this).setInteractive(true);
        this.btn[3] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x + 40, cp.y + 40).addChildTo(this).setInteractive(true);
        this.btn[5] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x - 40, cp.y + 40).addChildTo(this).setInteractive(true);
        this.btn[7] = phina.display.RectangleShape({width: 30, height: 30}.$safe(button)).setPosition(cp.x - 40, cp.y - 40).addChildTo(this).setInteractive(true);

        for (var i = 0; i < this.btn.length; i++) {
            this.btn[i].isOn = false;
            this.btn[i].on('pointover', function() {
                this.isOn = true;
            });
            this.btn[i].on('pointout', function() {
                this.isOn = false;
            });
        }

        //挿下キー情報
        this.keydata = {
            up: false,
            down: false,
            left: false,
            right: false,
        };
    },

    update: function() {
        this.keydata = {
            up: this.btn[0].isOn || this.btn[1].isOn || this.btn[7].isOn,
            right: this.btn[2].isOn || this.btn[1].isOn || this.btn[3].isOn,
            down: this.btn[4].isOn || this.btn[3].isOn || this.btn[5].isOn,
            left: this.btn[6].isOn || this.btn[5].isOn || this.btn[7].isOn,
        };
    },
});

//バーチャルパッドボタン
phina.define("phina.extension.VirtualPad.Button", {
    superClass: "phina.display.DisplayElement",

    active: true,

    init: function(options) {
        this.superInit();
        options = (options || {}).$safe(this.defaultOptions);
        this.options = options;

        var param = {
            radius: options.radius || 30,
            fill: "rgba(0,0,0,0.3)",
            stroke: "rgba(255, 255, 255, 0.3)",
            backgroundColor: 'transparent',
        };
        this.btn = phina.display.CircleShape(param)
            .addChildTo(this)
            .setInteractive(true);
        this.btn.on('pointover', e => {
            this.isOn = true;
        });
        this.btn.on('pointout', e => {
            this.isOn = false;
        });
    },
});

//バーチャルパッドアナログスティック
phina.define("phina.extension.VirtualPad.AnalogStick", {
    superClass: "phina.display.CircleShape",

    active: true,

    init: function(options) {
        this.superInit({
            radius: 80,
            fill: null,
            stroke: "rgba(255, 255, 255, 0.3)",
            backgroundColor: 'transparent',
        });

        //中心点
        var hw = 0;
        var hh = 0;
        var cp = phina.geom.Vector2(0, 0);

        var param = {
            radius: 20,
            fill: "rgba(0,0,0,0.3)",
            stroke: "rgba(0,0,0,0.3)",
            backgroundColor: 'transparent',
        };
        this.inner = phina.display.CircleShape(param)
            .addChildTo(this)
            .setInteractive(true);
        this.vector = phina.geom.Vector2(0, 0);
        this.pt = null;
    },

    update: function() {
        if (!app.pointer.getPointing()) {
            this.vector.set(0, 0);
        }
        var pointers = app.pointers;
        pointers.forEach(pointer => {
            if (pointer.getPointingStart() && this.hitTest(pointer.x, pointer.y)) {
                this.pt = pointer;
            }
        });
        if (this.pt) {
            if (this.pt.getPointing()) {
                this.vector.set(this.pt.x - this.x, this.pt.y - this.y).normalize();
            } else if (this.pt.getPointingEnd()) {
                this.vector.set(0, 0);
            }
        }
        this.inner.x = this.vector.x * this.radius * 0.6;
        this.inner.y = this.vector.y * this.radius * 0.6;

        //角度
        if (this.vector.x == 0 && this.vector.y == 0) {
            this.angle = null;
        } else {
            this.angle = Math.floor(Math.atan2(this.vector.y, this.vector.x).toDegree());
            if (this.angle < 0) this.angle += 360;
        }
    },
});

/*
 *  SoundSet.js
 *  2014/11/28
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

//サウンド管理
phina.define("phina.extension.SoundSet", {

    //サウンドが格納される配列
    elements: null,

    //再生中ＢＧＭ
    bgm: null,
    bgmIsPlay: false,

    //マスターボリューム
    volumeBGM: 0.5,
    volumeSE: 0.5,

    init: function() {
        this.elements = [];
    },

    //登録済みアセット読み込み
    readAsset: function() {
        for (var key in phina.asset.AssetManager.assets.sound) {
            var obj = phina.asset.AssetManager.get("sound", key);
            if (obj instanceof phina.asset.Sound) this.add(key);
        }
    },

    //サウンド追加
    add: function(name, url) {
        if (name === undefined) return null;
        url = url || null;
        if (this.find(name)) return true;

        var e = phina.extension.SoundElement(name);
        if (!e.media) return false;
        this.elements.push(e);
        return true;
    },

    //サウンド検索
    find: function(name) {
        if (!this.elements) return null;
        for (var i = 0; i < this.elements.length; i++) {
            if (this.elements[i].name == name) return this.elements[i];
        }
        return null;
    },

    //サウンドをＢＧＭとして再生
    playBGM: function(name, loop, callback) {
        if (loop === undefined) loop = true;
        if (this.bgm) {
            this.bgm.stop();
            this.bgmIsPlay = false;
        }
        var element = this.find(name);
        if (element) {
            var vol = this.volumeBGM * element._volume;
            element.media.volume = vol;
            element.play(loop, callback);
            this.bgm = element;
            this.bgmIsPlay = true;
        } else {
            if (this.add(name)) this.playBGM(name);
        }
        return this;
    },

    //ＢＧＭ停止
    stopBGM: function() {
        if (this.bgm) {
            if (this.bgmIsPlay) {
                this.bgm.stop();
                this.bgmIsPlay = false;
            }
            this.bgm = null;
        }
        return this;
    },

    //ＢＧＭ一時停止
    pauseBGM: function() {
        if (this.bgm) {
            if (this.bgmIsPlay) {
                this.bgm.pause();
                this.bgmIsPlay = false;
            }
        }
        return this;
    },

    //ＢＧＭ再開
    resumeBGM: function() {
        if (this.bgm) {
            if (!this.bgmIsPlay) {
                this.bgm.volume = this.volumeBGM;
                this.bgm.resume();
                this.bgmIsPlay = true;
            }
        }
        return this;
    },

    //ＢＧＭマスターボリューム設定
    setVolumeBGM: function(vol) {
        this.volumeBGM = vol;
        if (this.bgm) {
            this.bgm.pause();
            this.bgm.setVolume(this.volumeBGM * this.bgm._volume);
            this.bgm.resume();
        }
        return this;
    },

    //アセットを指定してボリュームを設定
    setVolume: function(name, vol) {
        var media = this.find(name);
        if (media) {
            media.setVolume(vol);
        }
        return this;
    },

    //サウンドをサウンドエフェクトとして再生
    playSE: function(name, loop, callback) {
        var element = this.find(name);
        if (element) {
            var vol = this.volumeSE * element._volume;
            element.media.volume = vol;
            element.play(loop, callback);
        } else {
            if (this.add(name)) this.playSE(name);
        }
        return this;
    },

    //ループ再生しているSEを停止
    stopSE: function(name) {
        var media = this.find(name);
        if (media) {
            media.stop();
        }
        return this;
    },

    //ＢＧＭ一時停止
    pauseBGM: function() {
        if (this.bgm) {
            if (this.bgmIsPlay) {
                this.bgm.pause();
                this.bgmIsPlay = false;
            }
        }
        return this;
    },

    //ＳＥマスターボリューム設定
    setVolumeSE: function(vol) {
        this.volumeSE = vol;
        return this;
    },
});

//SoundElement Basic
phina.define("phina.extension.SoundElement", {
    //サウンド名
    name: null,

    //ＵＲＬ
    url: null,

    //サウンド本体
    media: null,

    //ボリューム
    _volume: 1,

    //再生終了時のコールバック関数
    callback: null,

    //再生中フラグ
    playing: false,

    init: function(name) {
        this.name = name;
        this.media = phina.asset.AssetManager.get("sound", name);
        if (this.media) {
            this.media.volume = 1;
            this.media.on('ended', function() {
                if (this.media.loop) this.playing = false;
                if (this.callback) this.callback();
            }.bind(this))
        } else {
            console.warn("asset not found. "+name);
        }
    },

    //サウンドの再生
    play: function(loop, callback) {
        if (loop === undefined) loop = false
        if (!this.media) return this;

        //ループ再生の場合多重再生を禁止
        if (loop && this.playing) return;

        this.media.loop = loop;
        this.media.play();
        this.callback = callback;
        this.playing = true;
        return this;
    },

    //サウンド再生再開
    resume: function() {
        if (!this.media) return this;
        this.media.resume();
        this.playing = true;
        return this;
    },

    //サウンド一時停止
    pause: function () {
        if (!this.media) return this;
        this.media.pause();
        this.playing = false;
    },

    //サウンド停止
    stop: function() {
        if (!this.media) return this;
        this.media.stop();
        this.playing = false;
        return this;
    },

    //ボリューム設定
    setVolume: function(vol) {
        if (!this.media) return this;
        if (vol === undefined) vol = 0.5;
        this._volume = vol;
        return this;
    },

    _accessor: {
        volume: {
            "get": function() { return this._volume; },
            "set": function(vol) { this.setVolume(vol); }
        },
        loop: {
            "get": function() { return this.media.loop; },
            "set": function(f) { this.media.loop = f; }
        },
    }
});

/*
 *  application.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

//namespaace Quest For the Tanelorn
var qft = {};

phina.define("qft.Application", {
    superClass: "phina.display.CanvasApp",

    init: function() {
        this.superInit({
            query: '#world',
            width: SC_W,
            height: SC_H,
            backgroundColor: 'rgba(0, 0, 0, 1)',
        });
        this.fps = FPS;

        //ゲームパッド管理
        this.gamepadManager = phina.input.GamepadManager();
        this.gamepad = this.gamepadManager.get(0);

        //バーチャルパッド
        this.virtualPad = phina.extension.VirtualPad({width: SC_W, height: SC_H}).setPosition(0, 0);

        //パッド情報を更新
        this.on('enterframe', function() {
            this.gamepadManager.update();
            this.virtualPad.updateInfo();
            this.updateController();
        });
        this.controller = {};

        //サウンドセット
        this.soundset = phina.extension.SoundSet();

        //Labelデフォルト設定
        phina.display.Label.defaults.$extend({
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        });
    },

    updateController: function() {
        var before = this.controller;
        before.before = null;

        var gp = this.gamepad;
        var kb = this.keyboard;
        var angle1 = gp.getKeyAngle();
        var angle2 = kb.getKeyAngle();
        this.controller = {
            angle: angle1 !== null? angle1: angle2,

            up: gp.getKey("up") || kb.getKey("up"),
            down: gp.getKey("down") || kb.getKey("down"),
            left: gp.getKey("left") || kb.getKey("left"),
            right: gp.getKey("right") || kb.getKey("right"),

            attack: gp.getKey("X") || kb.getKey("Z"),
            jump:   gp.getKey("up") || gp.getKey("A") || kb.getKey("up") || kb.getKey("X"),
            change: gp.getKey("B") || kb.getKey("C"),
            menu:   gp.getKey("start") || kb.getKey("escape"),

            a: gp.getKey("A") || kb.getKey("Z"),
            b: gp.getKey("B") || kb.getKey("X"),
            x: gp.getKey("X") || kb.getKey("C"),
            y: gp.getKey("Y") || kb.getKey("V"),

            ok: gp.getKey("A") || kb.getKey("Z") || kb.getKey("space") || kb.getKey("return"),
            cancel: gp.getKey("B") || kb.getKey("X") || kb.getKey("escape"),

            start: gp.getKey("start") || kb.getKey("return"),
            select: gp.getKey("select"),

            pause: gp.getKey("start") || kb.getKey("escape"),

            analog1: gp.getStickDirection(0),
            analog2: gp.getStickDirection(1),

            //前フレーム情報
            before: before,
        };
    },

    _onLoadAssets: function() {
        this.soundset.readAsset();

        //特殊効果用ビットマップ作成
        [
            "player1",
            "player2",
        ].forEach(function(name) {
            if (!phina.asset.AssetManager.get("image", name)) return;

            //ダメージ用
            if (!phina.asset.AssetManager.get("image", name+"White")) {
                var tex = phina.asset.AssetManager.get("image", name).clone();
                tex.filter( function(pixel, index, x, y, bitmap) {
                    var data = bitmap.data;
                    data[index+0] = (pixel[0] == 0? 0: 128); //r
                    data[index+1] = (pixel[1] == 0? 0: 128); //g
                    data[index+2] = (pixel[2] == 0? 0: 128); //b
                });
                phina.asset.AssetManager.set("image", name+"White", tex);
            }
            //瀕死用
            if (!phina.asset.AssetManager.get("image", name+"Red")) {
                var tex = phina.asset.AssetManager.get("image", name).clone();
                tex.filter( function(pixel, index, x, y, bitmap) {
                    var data = bitmap.data;
                    data[index+0] = pixel[0];
                    data[index+1] = 0;
                    data[index+2] = 0;
                });
                phina.asset.AssetManager.set("image", name+"Red", tex);
            }
            //影用
            if (!phina.asset.AssetManager.get("image", name+"Black")) {
                var tex = phina.asset.AssetManager.get("image", name).clone();
                tex.filter( function(pixel, index, x, y, bitmap) {
                    var data = bitmap.data;
                    data[index+0] = 0;
                    data[index+1] = 0;
                    data[index+2] = 0;
                });
                phina.asset.AssetManager.set("image", name+"Black", tex);
            }
        });
    },

    playBGM: function(asset, loop, callback) {
        if (loop === undefined) loop = true;
        this.soundset.playBGM(asset, loop, callback);
    },

    stopBGM: function(asset) {
        this.soundset.stopBGM();
    },

    setVolumeBGM: function(vol) {
        if (vol > 1) vol = 1;
        if (vol < 0) vol = 0;
        this.soundset.setVolumeBGM(vol);
    },

    playSE: function(asset, loop) {
        if (loop === undefined) loop = false;
        this.soundset.playSE(asset, loop);
    },

    setVolumeSE: function(vol) {
        if (vol > 1) vol = 1;
        if (vol < 0) vol = 0;
        this.soundset.setVolumeSE(vol);
    },

    setVolume: function(asset, vol) {
        this.soundset.setVolume(asset, vol);
    },

    _accessor: {
        volumeBGM: {
            "get": function() { return this.sounds.volumeBGM; },
            "set": function(vol) { this.setVolumeBGM(vol); }
        },
        volumeSE: {
            "get": function() { return this.sounds.volumeSE; },
            "set": function(vol) { this.setVolumeSE(vol); }
        }
    }
});

/*
 *  asset.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Assets", {
    _static: {
        loaded: [],
        isLoaded: function(assetType) {
            return qft.Assets.loaded[assetType]? true: false;
        },
        get: function(options) {
            qft.Assets.loaded[options.assetType] = true;
            switch (options.assetType) {
                case "splash":
                    return {
                        image: {
                            "openingmap":   "assets/image/opening_map.jpg",
                            "openingtower": "assets/image/opening_tower.png",
                            "openingground":"assets/image/opening_ground.png",
                            "openingback":  "assets/image/opening_back.png",
                            "openingback2": "assets/image/opening_bg_jan.jpg",
                            "openinglight": "assets/image/opening_tree_light_yellow.png",
                            "player1":      "assets/image/actor4.png",
                            "background":   "assets/image/back-s03b.png",
                        },
                    };
                case "splash2":
                    return {
                        sound: {
                            "openingbgm":   "assets/sound/DS-070m.mp3",
                        },
                    };
                case "common":
                    return {
                        image: {
                            "actor4":    "assets/image/actor4.png",
                            "actor19":    "assets/image/actor19.png",
                            "actor40":    "assets/image/actor40.png",
                            "actor55":    "assets/image/actor55.png",
                            "actor64":    "assets/image/actor64_a.png",
                            "actor642":    "assets/image/actor64_b.png",
                            "actor108":    "assets/image/actor108.png",
                            "actor111":    "assets/image/actor111.png",
                            "actor112":    "assets/image/actor112.png",
                            "weapons":    "assets/image/weapons.png",
                            "item":       "assets/image/item.png",
                            "itembox":    "assets/image/takarabako.png",
                            "particle":   "assets/image/particle.png",
                            "door":       "assets/image/door.png",
                            "checkicon":  "assets/image/check icon_00.png",
                            "titleback":  "assets/image/titleback.png", 
                            "menuframe":  "assets/image/nc92367.png",

                            "monster01":  "assets/image/monster01.png",
                            "monster02":  "assets/image/char_m_devil01.png",
                            "monster03":  "assets/image/char_m_magi01.png",
                            "monster01x2":  "assets/image/monster01x2.png",
                            "monster02x2":  "assets/image/char_m_devil01x2.png",
                            "bullet":     "assets/image/effect_bullet01.png",
                            "effect":     "assets/image/effect.png",
                            "effect2":    "assets/image/effect01a.png",
                            "gate":       "assets/image/gate.png",
                            "flame02":    "assets/image/object_fire02a.png",
                            "flame03":    "assets/image/object_fire03a.png",
                            "flame05":    "assets/image/object_fire05a.png",
                            "accessory1": "assets/image/map_effect2.png",
                            "block":      "assets/image/block.png",
                            "floor":      "assets/map/TileA4.png",
                            "balloon":    "assets/image/chara09_c1.png",
                            "shadow":     "assets/image/shadow.png",
                        },
                        sound: {
                            "click":      "assets/sound/se_maoudamashii_system44.mp3",
                            "ok":         "assets/sound/se_maoudamashii_system36.mp3",
                            "cancel":     "assets/sound/se_maoudamashii_system43.mp3",
                            "attack":     "assets/sound/sen_ka_katana_sasinuku01.mp3",
                            "hit":        "assets/sound/sen_ka_katana_sasu01.mp3",
                            "hit_blunt":  "assets/sound/sen_blunt.mp3",
                            "damage":     "assets/sound/se_maoudamashii_battle12.mp3",
                            "arrowstick": "assets/sound/sen_ka_ya03.mp3",
                            "stageclear": "assets/sound/DS-030m.mp3",
                            "gameover":   "assets/sound/gameover3.mp3",
                            "getkeyitem": "assets/sound/se_maoudamashii_onepoint23.mp3",
                            "bomb":       "assets/sound/sen_ge_taihou03.mp3",
                            "select":     "assets/sound/se_maoudamashii_system45.mp3",
                            "getitem":    "assets/sound/ata_a49.mp3",
                            "recovery":   "assets/sound/se_maoudamashii_magical01.mp3",
                            "tinkling":   "assets/sound/tinkling.mp3",
                            "holy1":      "assets/sound/holy1.mp3",
                            "bgm1":       "assets/sound/DS-ba01m.mp3",
                        },
                        font: {
                            "UbuntuMono": "assets/font/UbuntuMono-Bold.ttf",
                            "titlefont1": "assets/font/teutonic4.ttf",
                            "titlefont2": "assets/font/GothStencil_Premium.ttf",
                        },
                        tmx: {
                            "stage1": "assets/map/stage1.tmx",
                            "stage999": "assets/map/stage999.tmx",
                        },
                    };
                case "stage2":
                    return {
                        sound: {
                            "bgm2": "assets/sound/DS-035m.mp3",
                        },
                        tmx: {
                            "stage2_1": "assets/map/stage2_1.tmx",
                        },
                    };
                case "stage3":
                    return {
                        sound: {
                            "bgm3": "assets/sound/DS-041m.mp3",
                        },
                        tmx: {
                            "stage3_1": "assets/map/stage3_1.tmx",
                            "stage3_2": "assets/map/stage3_2.tmx",
                            "stage3_3": "assets/map/stage3_3.tmx",
                        },
                    };
                case "stage4":
                    return {
                        sound: {
                            "bgm4": "assets/sound/DS-076m.mp3",
                        },
                        tmx: {
                            "stage4_1": "assets/map/stage4_1.tmx",
                            "stage4_2": "assets/map/stage4_2.tmx",
                        },
                    };
                case "stage5":
                    return {
                        sound: {
                            "bgm5": "assets/sound/DS-089m.mp3",
                        },
                        tmx: {
                            "stage5_1": "assets/map/stage5_1.tmx",
                            "stage5_2": "assets/map/stage5_2.tmx",
                        },
                    };
                case "stage6":
                    return {
                        sound: {
                            "bgm6": "assets/sound/DS-060m.mp3",
                        },
                        tmx: {
                            "stage6_1": "assets/map/stage6_1.tmx",
                            "stage6_2": "assets/map/stage6_2.tmx",
                        },
                    };
                case "stage7":
                    return {
                        sound: {
                            "bgm7": "assets/sound/DS-105m.mp3",
                        },
                        tmx: {
                            "stage7_1": "assets/map/stage7_1.tmx",
                            "stage7_2": "assets/map/stage7_2.tmx",
                            "stage7_3": "assets/map/stage7_3.tmx",
                        },
                    };
                case "stage8":
                    return {
                        sound: {
                            "bgm8": "assets/sound/DS-064m.mp3",
                        },
                        tmx: {
                            "stage8_1": "assets/map/stage8_1.tmx",
                            "stage8_2": "assets/map/stage8_2.tmx",
                        },
                    };
                case "stage9":
                    return {
                        sound: {
                            "bgm9": "assets/sound/DS-064m.mp3",
                        },
                        tmx: {
                            "stage9_1": "assets/map/stage9_1.tmx",
                        },
                    };
                case "stage10":
                    return {
                        sound: {
                            "ending": "assets/sound/DS-071m.mp3",
                        },
                        tmx: {
                            "stage10": "assets/map/stage10.tmx",
                        },
                    };
                default:
                    throw "invalid assetType: " + options.assetType;
            }
        },
    },
});


/*
 *  Benri.js
 *  2014/12/18
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
var toRad = 3.14159/180;    //弧度法toラジアン変換
var toDeg = 180/3.14159;    //ラジアンto弧度法変換

//距離計算
var distance = function(from, to) {
    var x = from.x-to.x;
    var y = from.y-to.y;
    return Math.sqrt(x*x+y*y);
}

//距離計算（ルート無し版）
var distanceSq = function(from, to) {
    var x = from.x - to.x;
    var y = from.y - to.y;
    return x*x+y*y;
}

//数値の制限
var clamp = function(x, min, max) {
    return (x<min)?min:((x>max)?max:x);
};

//乱数生成
var prand = phina.util.Random();
var rand = function(min, max) {
    return prand.randint(min, max);
}

//タイトル無しダイアログ
var AdvanceAlert = function(str) {
    var tmpFrame = document.createElement('iframe');
    tmpFrame.setAttribute('src', 'data:text/plain,');
    document.documentElement.appendChild(tmpFrame);

    window.frames[0].window.alert(str);
    tmpFrame.parentNode.removeChild(tmpFrame);
};
var AdvanceConfirm = function(str) {
    var tmpFrame = document.createElement('iframe');
    tmpFrame.setAttribute('src', 'data:text/plain,');
    document.documentElement.appendChild(tmpFrame);

    var result = window.frames[0].window.confirm(str);
    tmpFrame.parentNode.removeChild(tmpFrame);

    return result;
};

//数値をカンマ編集して文字列として出力
Number.prototype.$method("comma",  function() {
    var str = this+'';
    var len = str.length;
    var out = '';
    for (var i = len-1; i > -1; i--) {
        out = str[i]+out;
        if (i != 0 && (len-i)%3 == 0) out = ','+out;
    }
    return out;
});

/*
 *  main.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

//phina.globalize();

//デバッグフラグ
const DEBUG = false;
const DEBUG_COLLISION = false;
const DEBUG_EYESIGHT = false;
const DEBUG_MOBILE = false;

//定数
const SC_W = 576;
const SC_H = 324;
// SC_W = 480;
// SC_H = 320;

const FPS = 30;

//アイテムＩＤ
const ITEM_SHORTSWORD = 0;
const ITEM_LONGSWORD = 1;
const ITEM_AX = 2;
const ITEM_SPEAR = 3;
const ITEM_BOW = 4;
const ITEM_ROD = 5;
const ITEM_BOOK = 6;
const ITEM_SHIELD = 7;
const ITEM_ARMOR = 8;
const ITEM_HAT = 9;
const ITEM_BOOTS = 10;
const ITEM_GROVE = 11;
const ITEM_RING = 12;
const ITEM_SCROLL = 13;
const ITEM_LETTER = 14;
const ITEM_CARD = 15;
const ITEM_KEY = 16;
const ITEM_COIN = 17;
const ITEM_BAG = 18;
const ITEM_ORB = 19;
const ITEM_STONE = 20;
const ITEM_JEWEL = 21;
const ITEM_JEWELBOX = 22;
const ITEM_APPLE = 24;
const ITEM_HARB = 25;
const ITEM_MEAT = 26;
const ITEM_POTION = 27;

//インスタンス
let app;

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
      .then(() => console.log('Service worker registered!'));
}

window.onload = function() {
    app = qft.Application();
    app.replaceScene(qft.SceneFlow());

    //モバイル対応
    if (phina.isMobile()) {
        app.domElement.addEventListener('touchend', function dummy() {
            var s = phina.asset.Sound();
            s.loadFromBuffer();
            s.play().stop();
            app.domElement.removeEventListener('touchend', dummy);
        });
    }
    app.domElement.addEventListener('click', function dummy() {
        var context = phina.asset.Sound.getAudioContext();
        context.resume();
    });

    app.run();
//    app.enableStats();
};

/*
 *  configscene.js
 *  2017/03/02
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.ConfigScene", {
    superClass: "phina.display.DisplayScene",

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,0.5)",
            stroke: "rgba(0,0,0,0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.alpha = 0;
        this.bg.tweener.clear().fadeIn(500);

        this.scroll = phina.display.Sprite("menuframe")
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)
            .setScale(0.85, 1.1);
        this.scroll.alpha = 0;
        this.scroll.tweener.clear().fadeIn(500);

        this.menuBase = phina.display.DisplayElement().addChildTo(this.scroll);

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont1",
            align: "center",
            baseline: "middle",
            fontSize: 70,
        };
        this.textLabel = phina.display.Label({text: "Menu", fontSize: 20}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(0, -SC_H*0.3);

        //メニューテキスト表示
        var that = this;
        this.menu = ["System", "Practice", "Exit"];
        this.menuText = [];
        for (var i = 0; i < this.menu.length; i++) {
            this.menuText[i] = phina.display.Label({text: this.menu[i], fontSize: 40}.$safe(labelParam))
                .addChildTo(this.menuBase)
                .setPosition(0, -SC_H*0.15+SC_H*0.15*i)
                .setScale(0.7);

            //タッチ判定用
            var param2 = {
                width: SC_W*0.3,
                height: SC_H*0.10,
                fill: "rgba(0,100,200,0.5)",
                stroke: "rgba(0,100,200,0.5)",
                backgroundColor: 'transparent',
            };
            var c = phina.display.RectangleShape(param2)
                .addChildTo(this.menuBase)
                .setPosition(0, -SC_H*0.15+SC_H*0.15*i)
                .setInteractive(true);
            c.alpha = 0;
            c.select = i;
            c.onpointstart = function() {
                if (that.isSelected || that.time < 10) return;
                if (this.select == that.select) {
                    that.ok = true;
                } else {
                    that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    that.select = this.select;
                    that.menuText[that.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                    app.playSE("select");
                }
            }
        }
        this.isSelected = false;
        this.select = 0;
        this.selectMax = 3;
        this.menuText[0].setScale(1);
        this.ok = false;
        this.cansel = false;

        this.time = 0;

        this.on('resume', function() {
            this.menuBase.tweener.clear().fadeIn(500);
            this.time = 0;
            this.isSelected = false;
            this.ok = false;
            this.cansel = false;
        });
    },

    update: function() {
        var ct = app.controller;
        if (ct.down && !ct.before.down && this.select < this.selectMax-1) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select++;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }
        if (ct.up && !ct.before.up && this.select > 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }

        if (this.time > 15) {
            //決定
            if (ct.ok || this.ok) {
                if (this.select == 0) {
                }
                if (this.select == 1) {
                    app.playSE("ok");
                    this.menuBase.tweener.clear()
                        .fadeOut(500)
                        .call(function() {
                            app.pushScene(qft.ConfigScene_Practice());
                        });
                }
                if (this.select == 2) {
                    app.playSE("cancel");
                    this.exitMenu();
                }
                this.time = 0;
            }

            //キャンセル        
            if (ct.cancel) {
                app.playSE("cancel");
                this.exitMenu();
                this.time = 0;
            }
        }
        this.time++;
    },

    exitMenu: function() {
        this.bg.tweener.clear().fadeOut(500);
        this.scroll.tweener.clear()
            .fadeOut(500)
            .call(function() {
                this.exit();
            }.bind(this));
    }
});

/*
 *  conversationscene.js
 *  2017/08/17
 *  @auther minimo  
 *  This Program is MIT license.
 */

//会話表示シーン 
phina.define("qft.ConversationScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene, text) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //プレイヤーの画面上位置によりフレームの縦位置を変更
        var frameY = SC_H * 0.25;
        var pl = this.currentScene.player;

        //会話表示フレーム
        var param = {
            width:SC_W * 0.95,
            height:SC_H * 0.4,
            fill: "rgba(0, 0, 0, 0.5)",
            stroke: "rgba(1, 1, 1, 0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W * 0.5, frameY)

        //テキスト処理
        if (text === undefined) text = "TEST MESSAGE";
        if (text instanceof Array) {
            this.text = "";
            text.forEach((t) => {
                this.text += (t + "\n");
            });
        } else {
            this.text = text;
        }

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "Orbitron",
            fontSize: 70,

            verticalAlign: 'top',
            align:'start',
            baseline:'top',
            width: SC_W * 0.9,
            height: SC_H * 0.3,
            scrollX: 0,
            scrollY: 0,
        };
        this.textLabel = phina.ui.LabelArea({text: "", fontSize: 20}.$safe(labelParam)).addChildTo(this.bg);

        this.isExit = false;
        this.isFinish = false;
        this.waitTime = 0;
        this.col = 0;
        this.time = 0;
    },

    update: function() {
        if (this.waitTime == 0) {
            this.textLabel.text = this.text.substring(0, this.col);
            if (this.text.substring(this.col, this.col+1) == "\n") this.waitTime = 10;
            this.col++;
            if (this.col > this.text.length) this.isFinish = true;
        }
        if (this.waitTime > 0) this.waitTime--;

        var ct = app.controller;
        if (this.isFinish) {
            if (!this.isExit && this.time > 10 && ct.before.attack && !ct.attack) {
                this.isExit = true;
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
        } else {
            if (ct.attack) {
                this.col = this.text.length;
                this.isFinish = true;
                this.time = 0;
            }
        }
        this.time++;
    },
});


/*
 *  creditscene.js
 *  2017/12/24
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.CreditScene", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.clear()
            .set({alpha: 0})
            .to({alpha: 0.5}, 1000);

        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 26,
            fontWeight: ''
        };
        phina.display.Label({text: "Congraturations!!"}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.2);

        phina.display.Label({text: "Thank you for playing."}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.4);

        phina.display.Label({text: "This game is a test version."}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);

        phina.display.Label({text: "Push button to title.", fontSize: 20}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.8);

        app.playBGM("gameover", false);

        this.time = 0;
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time > 120) {
            if (ct.ok || ct.cancel) {
                app.playBGM("openingbgm");
                this.parentScene.flare('exitgame');
                this.exit();
            }
        }
        this.time++;
    },
});

/*
 *  endingcene.js
 *  2017/02/07
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.EndingScene", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.clear()
            .set({alpha: 0})
            .to({alpha: 0.5}, 1000);

        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 26,
            fontWeight: ''
        };
        phina.display.Label({text: "Thank you for playing."}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.4);

        phina.display.Label({text: "This game is over"}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);

        phina.display.Label({text: "Push button to title.", fontSize: 20}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.8);

        app.playBGM("gameover", false);

        this.time = 0;
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time > 120) {
            if (ct.ok || ct.cancel) {
                app.playBGM("openingbgm");
                this.parentScene.flare('exitgame');
                this.exit();
            }
        }
        this.time++;
    },
});

/*
 *  endingcene.trueending.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

//トゥルーエンディング
phina.define("qft.EndingScene.TrueEnding", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        this.text = [
            "数多の苦難を乗り越え",
            "あなたは遂に楽園「永遠の都」への入り口へと到達した",
            "扉の向こうには階段があり",
            "その階段は遥か天上へと続いている",
            "階段を昇りますか？",
        ];

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.clear()
            .set({alpha: 0})
            .to({alpha: 0.5}, 1000);

        //イメージ表示用レイヤ
        this.imageLayer = phina.display.DisplayElement().addChildTo(this);

        //上下黒帯
        param.height = SC_H * 0.15;
        this.bar1 = phina.display.RectangleShape(param).addChildTo(this).setOrigin(0, 1).setPosition(0, -1);
        this.bar2 = phina.display.RectangleShape(param).addChildTo(this).setOrigin(0, 0).setPosition(0, SC_H + 1);
        this.bar1.tweener.clear().setUpdateType('fps').moveBy(0, SC_H * 0.15, 30, "easeOutSine");
        this.bar2.tweener.clear().setUpdateType('fps').moveBy(0, -SC_H * 0.15, 30, "easeOutSine");

        this.time = 0;

        this.one('enterframe', () => {
            //ＢＧＭ再生
            app.playBGM("endingbgm");
        });
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time > 120) {
            if (ct.ok || ct.cancel) {
                app.playBGM("openingbgm");
                this.parentScene.flare('exitgame');
                this.exit();
            }
        }
        this.time++;
    },
});

/*
 *  GameOverScene.js
 *  2014/06/04
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.GameOverScene", {
    superClass: "phina.display.DisplayScene",
    
    init: function(parentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.parentScene = parentScene;

        //バックグラウンド
        var param = {
            width: SC_W,
            height: SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.5)
        this.bg.alpha = 0;

        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        };
        var x = SC_W * 0.5-32*4;
        var n = 0;
        ["G", "A", "M", "E", "O", "V", "E", "R"].forEach(function(e) {
            var lb = phina.display.Label({text: e}.$safe(labelParam))
                .setPosition(x, SC_H*0.5+32)
                .setScale(0, 1)
                .addChildTo(this);
            lb.tweener.clear()
                .set({alpha: 0})
                .wait(n*50)
                .to({scaleX: 1.0, alpha: 1, y: SC_H*0.5}, 1000, "easeOutSine")
                .wait(1000-n*50)
                .set({alpha: 0})
                .to({scaleX: 0.0, alpha: 0, y: SC_H*0.5-32}, 1000, "easeOutSine")
            var pt = phina.display.Sprite("particle", 16, 16)
                .setFrameIndex(48)
                .setPosition(x, SC_H*0.5)
                .setScale(3, 3)
                .addChildTo(this);
            pt.alpha = 0;
            pt.tweener.clear()
                .wait(n*50+1000)
                .to({alpha: 1}, 1000-n*50, "easeOutSine")
                .to({scaleX: 0.0, alpha: 0, y: SC_H*0.5-32}, 1000, "easeOutSine")
            x += 32;
            n++;
        }.bind(this));

        app.playBGM("gameover", false);

        this.select = 0; //0:YES 1:NO
        this.pushyes = false;
        this.pushno = false;
        this.ok = false;

        this.time = 0;
    },

    update: function(app) {
        var ct = app.controller;
        if (this.time == 90) {
            this.dispContinue();
        }
        if (this.time > 105) {
            if ((ct.left || this.pushyes) && this.select == 1) {
                this.select = 0;
                this.pushyes = false;
                this.yes.tweener.clear().to({scaleX: 1, scaleY: 1}, 500, "easeOutBounce");
                this.no.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                app.playSE("select");
                this.text3.text = "ゲームオーバー地点からコンティニューします（スコアはリセットされます）";
            } else if ((ct.right || this.pushno) && this.select == 0) {
                this.select = 1;
                this.pushno = false;
                this.yes.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                this.no.tweener.clear().to({scaleX: 1, scaleY: 1}, 500, "easeOutBounce");
                app.playSE("select");
                this.text3.text = "タイトルに戻ります";
            }
            if (ct.ok || ct.cancel || this.ok) {
                if (this.select == 0) {
                    this.parentScene.flare('continue');
                    this.exit();
                } else {
                    this.parentScene.flare('exitgame');
                    this.exit();
                }
            }
        }
        this.time++;
    },

    dispContinue: function() {
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 36,
            fontWeight: ''
        };
        this.text1 = phina.display.Label({text: "CONTINUE?"}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.4+10)
            .addChildTo(this);
        this.text1.alpha = 0;
        this.text1.tweener.clear().to({y: SC_H*0.4, alpha: 1}, 500, "easeInSine");

        this.yes = phina.display.Label({text: "YES", fontSize: 30}.$safe(labelParam))
            .setScale(1)
            .setPosition(SC_W*0.4, SC_H*0.6+10)
            .addChildTo(this);
        this.yes.alpha = 0;
        this.yes.tweener.clear().to({y: SC_H*0.6, alpha: 1}, 500, "easeInSine");

        this.no = phina.display.Label({text: "NO", fontSize: 30}.$safe(labelParam))
            .setScale(0.7)
            .setPosition(SC_W*0.6, SC_H*0.6+10)
            .addChildTo(this);
        this.no.alpha = 0;
        this.no.tweener.clear().to({y: SC_H*0.6, alpha: 1}, 500, "easeInSine");

        //タッチ判定用
        var that = this;
        var param2 = {
            width: 80,
            height: SC_H*0.08,
            fill: "rgba(0,100,200,0.5)",
            stroke: "rgba(0,100,200,0.5)",
            backgroundColor: 'transparent',
        };
        var yes = phina.display.RectangleShape(param2)
            .addChildTo(this)
            .setPosition(SC_W*0.4, SC_H*0.6)
            .setInteractive(true);
        yes.alpha = 0;
        yes.onpointstart = function() {
            if (that.select == 0) {
                that.ok = true;
            } else {
                that.pushyes = true;
            }
        }
        var no = phina.display.RectangleShape(param2)
            .addChildTo(this)
            .setPosition(SC_W*0.6, SC_H*0.6)
            .setInteractive(true);
        no.alpha = 0;
        no.onpointstart = function() {
            if (that.select == 1) {
                that.ok = true;
            } else {
                that.pushno = true;
            }
        }

        this.text3 = phina.display.Label({text: "ゲームオーバー地点からコンティニューします（スコアはリセットされます）", fontSize: 10}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.75+10)
            .addChildTo(this);
        this.text3.alpha = 0;
        this.text3.tweener.clear().to({y: SC_H*0.75, alpha: 1}, 500, "easeInSine");

        this.bg.tweener.clear().to({alpha:0.3}, 500, "easeInSine");
    },
});

/*
 *  LoadingScene.js
 *  2015/09/08
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アセットロード用シーン
phina.define("qft.LoadingScene", {
    superClass: "phina.display.DisplayScene",

    init: function(options) {
        options = (options || {}).$safe({
            assets: null,
            width: SC_W,
            height: SC_H,
            lie: false,
            exitType: "auto",
        });
        this.superInit(options);

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)
        this.bg.tweener.setUpdateType('fps');

        //ロードする物が無い場合スキップ
        this.forceExit = false;
        var assets = options.assets;
        if (!assets.$has("sound") &&
            !assets.$has("image") &&
            !assets.$has("font") &&
            !assets.$has("spritesheet") &&
            !assets.$has("script") &&
            !assets.$has("tmx")) {

            this.forceExit = true;
            return;
        }

        var labelParam = {
            text: "Loading",
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 30
        };
        phina.display.Label(labelParam)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);

        this.fromJSON({
            children: {
                gauge: {
                    className: 'phina.ui.Gauge',
                    arguments: {
                        value: 0,
                        width: this.width*0.5,
                        height: 5,
                        color: 'black',
                        stroke: false,
                        gaugeColor: 'blue',
                        padding: 0,
                    },
                    x: this.gridX.center(),
                    y: SC_H*0.5+20,
                    originY: 0,
                }
            }
        });
        this.gauge.update = function(e) {
            this.gaugeColor = 'hsla({0}, 100%, 50%, 0.8)'.format(e.ticker.frame*3);
        }

        var loader = phina.asset.AssetLoader();
        if (options.lie) {
            this.gauge.animationTime = 10*1000;
            this.gauge.value = 90;
            loader.onload = function() {
                this.gauge.animationTime = 1*1000;
                this.gauge.value = 100;
            }.bind(this);
        } else {
            loader.onprogress = function(e) {
                this.gauge.value = e.progress*100;
            }.bind(this);
        }
        this.gauge.onfull = function() {
            if (options.exitType === 'auto') {
                if (this.app._onLoadAssets) this.app._onLoadAssets();
                this.exit();
            }
        }.bind(this);

        loader.load(options.assets);
    },
    update: function() {
        if (this.forceExit) this.exit();
    },    
});

/*
 *  MainScene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.MainScene", {
    superClass: "phina.display.DisplayScene",

    //現在ステージ番号
    stageNumber: 1,

    //最大ステージ番号
    stageNumberMax: 8,

    //残り時間（フレーム単位）
    timeLimit: 120,

    //メッセージスタック
    messageStack: [],

    //ステージクリアフラグ
    isStageClear: false,

    //エンディング進行中フラグ
    isEnding: false,

    //真エンディングフラグ
    isTrueEnding: true,

    //スコア
    totalScore: 0,

    //敵討伐数
    totalKill: 0,

    //コンティニュー回数
    continueCount: 0,

    //ステージクリア時情報
    clearResult: [],

    //スクリーンのマップ外への移動制限フラグ
    limitWidth: false,
    limitHeight: true,

    //スクリーン中心座標
    screenCenterPosition: null,

    //プレイヤースクリーン中央固定フラグ
    centerPlayer: true,

    //シーン内全オブジェクト強制停止
    pauseScene: false,

    init: function(options) {
        this.superInit({width: SC_W, height: SC_H});
        options = (options || {}).$safe({
            startStage: 1,
            isPractice: false,
            isContinue: false,
        })
        this.stageNumber = options.startStage || 1;
        this.isPractice = options.isPractice;
        this.isContinue = options.isContinue;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.setUpdateType('fps');

        //背景
        this.backgroundImage = phina.display.Sprite("background")
            .addChildTo(this).setPosition(0, SC_H*0.5)
            .setOrigin(0, 0.5)
            .setScale(1.0, 1.1);

        //管理用基準レイヤ
        this.baseLayer = phina.display.DisplayElement().addChildTo(this);

        //プレイヤーキャラクタ
        this.player = qft.Player(this);

        //スクリーン初期化
        this.setupScreen();

        //スクリーン中心座標管理用
        var that = this;
        this.camera = phina.app.Object2D().addChildTo(this);
        this.camera.parentScene = this;
        this.camera.tweener.setUpdateType('fps');
        this.camera.moveFrom = phina.geom.Vector2(0, 0);
        this.camera.moveTo = phina.geom.Vector2(0, 0);
        this.camera.moveRatio = 0;
        this.camera.moveLerp = false;
        this.camera.moveToPlayer = false;
        this.camera.update = function() {
            if (that.centerPlayer) {
                this.x = that.player.x;
                this.y = that.player.y;
            } else {
                if (this.moveLerp) {
                    if (this.moveToPlayer) {
                        this.moveTo.x = that.player.x;
                        this.moveTo.y = that.player.y;
                    }
                    var p = phina.geom.Vector2.lerp(this.moveFrom, this.moveTo, this.moveRatio);
                    this.setPosition(p.x, p.y);
                }
            }
        };

        //ステージクリア時情報
        this.clearResult = [];
        this.totalScore = 0;
        this.totalKill = 0;

        //コンティニュー時状態ロード
        if (this.isContinue) this.loadGame();

        //ステージ開始位置
        this.mapstart = phina.geom.Vector2(0, 0);

        //ステージ情報初期化
        this.setupStage();

        this.fgWhite = phina.display.RectangleShape(param.$extend({fill: 'white'}))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fgWhite.alpha = 0;
        this.fgWhite.tweener.setUpdateType('fps').clear();

        this.fg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fg.tweener.setUpdateType('fps').clear().fadeOut(30);

        //バーチャルパッドの可視化
        if (phina.isMobile() || DEBUG_MOBILE) {
            app.virtualPad.addChildTo(this).setPosition(0, 0);
        }

        app.volumeBGM = 0.5;
        app.volumeSE = 0.2;

        //メニューを開く
        this.on('openmenu', function(e) {
            app.pushScene(qft.MenuScene(this));
        });

        //キー取得
        this.on('getkey', function(e) {
            var x = this.mapLayer.x + this.player.x;
            var y = this.mapLayer.y + this.player.y;
            var key = phina.display.DisplayElement()
                .setPosition(x, y)
                .addChildTo(this.baseLayer);
            key.tweener.clear().moveTo(15+(this.player.keys.length-1)*24, 36, 500);
            var sp = phina.display.Sprite("item", 24, 24)
                .setFrameIndex(ITEM_KEY)
                .addChildTo(key);
        });

        //ステージクリア
        this.on('stageclear', this.stageClear);

        //次ステージへ移行
        this.on('nextstage', function(e) {
            if (!this.allClear) {
                this.stageNumber++;
                this.setupStage();
                this.player.saveStatus();
            } else {
                //エンディング分岐
                if (this.isTrueEnding) {
                    this.stageNumber = 10;
                    this.setupStage();
                } else {
                    //仮エンディング
                    app.pushScene(qft.EndingScene(this));
                }
            }
        });

        //エンディングへ移行
        this.on('ending', function(e) {
            app.pushScene(qft.EndingScene(this));
        });

        //ゲームオーバー
        this.on('gameover', function(e) {
            app.pushScene(qft.GameOverScene(this));
        });

        //コンティニュー
        this.on('continue', function(e) {
            this.restart();
        });

        //ゲーム終了
        this._exitGame = false;
        this.on('exitgame', function(e) {
            this._exitGame = true;
            if (!this.isPractice) this.saveGame();
        });
        this.on('exitgame_nosave', function(e) {
            this._exitGame = true;
        });

        //メッセージ表示
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };
        var that = this;
        this.messageStack = [];
        this.eventMessage = phina.display.Label({text: ""}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.2)
            .addChildTo(this);
        this.eventMessage.alpha = 0;
        this.eventMessage.tweener.clear().setUpdateType('fps');
        this.eventMessage.nextOk = true;
        this.eventMessage.update = function() {
            if (this.nextOk && that.messageStack.length > 0) {
                this.nextOk = false;
                var msg = that.messageStack[0];
                this.tweener.clear()
                    .call(function(){
                        this.text = msg.text;
                    }.bind(this))
                    .fadeIn(15).wait(90).fadeOut(15)
                    .call(function(){
                        this.nextOk = true;
                        that.messageStack.splice(0, 1);
                    }.bind(this))
            }
        }

        this.time = 0;
    },

    update: function(app) {
        if (this.time == 15) this.player.isControl = true;

        //ゲーム終了
        if (this._exitGame) {
            this.exitGame();
        }

        var ct = app.controller;
        if (!this.isStageClear) {
            //通常時処理
            //メニューシーンへ移行
            if (this.time > 15) {
                if (ct.pause || ct.menu) {
                    this.flare('openmenu');
                }
            }

            //ステージ進行
            var event = this.stageController.get(this.time);
            if (event) {
                if (typeof(event.value) === 'function') {
                    event.value.call(this, event.option);
                } else {
                    this.enterEnemyUnit(event.value);
                }
            }
            //ステージクリア条件チェック
            if (this.mapLayer.clearGate) {
                if (this.stageController.checkStageClearCondition()) {
                    this.mapLayer.clearGate.isLock = false;
                }
            }

            if (!this.pauseScene) this.timeLimit--;
            if (this.timeLimit < 0) {
                this.timeLimit = 0;
            }
            if (this.timeLimit == 0 && !this.player.isDead) {
//                this.player.dead();
            }
        } else {
            //ステージクリア時処理
            //残りタイムをスコア加算
            if (this.timeLimit >= 60) {
                this.timeLimit -= 60;
                this.totalScore += 20;
                if (this.timeLimit < 60) this.timeLimit = 0;
            }

            //ショートカット
            var ct = app.controller;
            if (ct.ok) {
                if (this.timeLimit >= 60) {
                    this.totalScore += Math.floor(this.timeLimit / 60) * 20;
                }
            }
        }

        //スクリーン表示位置
        var map = this.mapLayer.map;
        this.mapLayer.x = SC_W * 0.5 - this.camera.x;
        this.mapLayer.y = SC_H * 0.5 - this.camera.y;
        if (this.limitHeight) {
            if (this.mapLayer.y > 0) this.mapLayer.y = 0;
            if (this.mapLayer.y < -(map.height-SC_H)) this.mapLayer.y = -(map.height-SC_H);
        }
        if (this.limitWidth) {
            if (this.mapLayer.x > 0) this.mapLayer.x = 0;
            if (this.mapLayer.x < -(map.width-SC_W)) this.mapLayer.x = -(map.width-SC_W);
        }

        //スクリーン座標
        this.screenX = -this.mapLayer.x;
        this.screenY = -this.mapLayer.y;

        if (this.stageController.isBackgroundMove) {
            //バックグラウンドのX座標を全体の割合から計算
            this.backgroundImage.x = -Math.floor(this.backgroundImage.width * (this.player.x / map.width)*0.05);
        } else {
            this.backgroundImage.x = this.stageController.backgroundX;
        }

        this.time++;
    },

    //敵キャラクタ投入
    spawnEnemy: function(x, y, name, options) {
        return qft.Enemy[name](this, options).addChildTo(this.enemyLayer).setPosition(x, y);
    },

    //アイテム投入
    spawnItem: function(x, y, options) {
        return qft.Item(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //アイテムボックス投入
    spawnItemBox: function(x, y, options) {
        return qft.ItemBox(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //エフェクト投入
    spawnEffect: function(x, y, options) {
        return qft.Effect(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //メッセージ投入
    spawnMessage: function(text, between, waitFrame) {
        between = between || 32;
        waitFrame = waitFrame || 30;
        var arrayText = text.split("");
        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        };
        var n = 0;
        var x = SC_W * 0.5 - (arrayText.length * between * 0.5);
        arrayText.forEach(function(e) {
            if (e == " ") {
                x += between;
                return;
            }
            var lb = phina.display.Label({text: e}.$safe(labelParam)).setPosition(x, SC_H*0.5+32).setScale(0, 1).addChildTo(this);
            lb.tweener.clear().setUpdateType('fps')
                .set({alpha: 0})
                .wait(n)
                .to({scaleX: 1.0, alpha: 1, y: SC_H*0.5}, 15, "easeOutSine")
                .wait(waitFrame)
                .to({scaleX: 0.0, y: SC_H*0.5-32}, 10, "easeOutSine")
                .call(function(){this.remove()}.bind(lb));
            x += between;
            n += 5;
        }.bind(this));
    },

    //イベントメッセージ投入
    spawnEventMessage: function(id, text) {
        if (!id || !text) return;
        //メッセージスタック内に同一ＩＤがある場合は投入しない
        for (var i = 0; i < this.messageStack.length; i++) {
            if (this.messageStack[i].id == id) return;
        }
        if (text instanceof Array) {
            text.forEach(function(str) {
                this.messageStack.push({id: id, text: str});
            }.bind(this));
        } else {
            this.messageStack.push({id: id, text: text});
        }
    },

    //スクリーン初期化
    setupScreen: function() {
        var that = this;
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "UbuntuMono",
            align: "left",
            baseline: "middle",
            fontSize: 20,
            fontWeight: ''
        };

        //体力ゲージ
        this.lifeGaugeLabel = phina.display.Label({text: "LIFE"}.$safe(labelParam)).addChildTo(this).setPosition(0, 10);
        var options = {
            width:  200,
            height: 5,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 2,
            gaugeColor: 'lime',
            cornerRadius: 0,
            value: this.player.hp,
            maxValue: this.player.hpMax,
        };
        this.lifeGauge = phina.ui.Gauge(options).addChildTo(this).setOrigin(0, 0.5).setPosition(40, 10);
        this.lifeGauge.update = function() {
            this.value = that.player.hp;
            this.width = that.player.hpMax * 2;
            this.maxValue = that.player.hpMax;
        };

        //スコア表示
        this.scoreLabel = phina.display.Label({text:"SCORE:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 10);
        this.scoreLabel.score = 0;
        this.scoreLabel.s = 0;
        this.scoreLabel.update = function(e) {
            if (e.ticker.frame % 10 == 0) {
                this.s = ~~((that.totalScore-this.score)/7);
                if (this.s < 3) this.s = 3;
                if (this.s > 7777) this.s = 7777;
            }
            this.score += this.s;
            if (this.score > that.totalScore) this.score = that.totalScore;

            this.text = "SCORE "+this.score.comma();
        }

        //制限時間表示
        this.timeLabel = phina.display.Label({text: "TIME:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 30);
        this.timeLabel.update = function() {
            this.text = "TIME:"+Math.floor(that.timeLimit/30);
            if (that.timeLimit == 0) {
                this.fill = 'red';
            } else {
                this.fill = 'white';
            }
        }

        //プレイヤー装備武器表示
        this.playerWeapon = qft.PlayerWeapon(this.player).addChildTo(this).setPosition(SC_W-30, SC_H-30);
        var sw = phina.display.RectangleShape({width: 60, height: 60})
            .addChildTo(this)
            .setPosition(SC_W-30, SC_H-30)
            .setInteractive(true)
            .setAlpha(0.0);
        sw.on('pointstart', e => {
            var pl = that.player;
            if (!pl.before.change && pl.equip.switchOk) pl.switchWeapon();
        });
    },

    //マップ情報の初期化
    setupStage: function() {

        this.baseLayer.removeChildren();

        //登録済みマップの消去
        this.clearMap();

        //ステージ設定読み込み
        switch (this.stageNumber) {
            case 1:
                this.stageController = qft.Stage1(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 2:
                this.stageController = qft.Stage2(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 3:
                this.stageController = qft.Stage3(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 4:
                this.stageController = qft.Stage4(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 5:
                this.stageController = qft.Stage5(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 6:
                this.stageController = qft.Stage6(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 7:
                this.stageController = qft.Stage7(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 8:
                this.stageController = qft.Stage8(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 9:
                this.stageController = qft.Stage9(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
            case 10:
                this.stageController = qft.Stage10(this);
                this.switchMap(this.stageController.mapLayer[0]);
                this.isEnding = true;
                //システム表示のＯＦＦ
                this.lifeGaugeLabel.visible = false;
                this.lifeGauge.visible = false;
                this.scoreLabel.visible = false;
                this.timeLabel.visible = false;
                this.playerWeapon.visible = false;
                break;
            case 999:
                this.stageController = qft.Stage999(this);
                this.switchMap(this.stageController.mapLayer[0]);
                break;
        };

        //ステージクリアフラグクリア
        this.isStageClear = false;

        //経過時間初期化
        this.time = 0;

        //タイムリミット設定
        this.timeLimit = this.stageController.timeLimit;

        //プレイヤー設定
        this.player.isControl = true;
        this.player.isMuteki = false;
        this.player.alpha = 1.0;

        this.mapstart = phina.geom.Vector2(this.player.x, this.player.y);

        this.stageController.playBGM();
    },

    //ステージイベント発火
    fireStageEvent: function(eventName) {
        return this.stageController.fireEvent(eventName);
    },

    warp: function(x, y, frame) {
        frame = frame || 60;
        this.player.isControl = false;
        this.player.gravity = 0;
        this.player.vx = 0;
        this.player.isMuteki = true;
        this.player.tweener.clear()
            .wait(45)
            .call(function(){
                this.ignoreCollision = true;
            }.bind(this.player))
            .moveTo(x, y, frame, "easeInOutSine")
            .call(function(){
                this.ignoreCollision = false;
                this.gravity = 0.9;
            }.bind(this.player))
            .wait(90)
            .call(function(){
                this.isControl = true;
                this.isMuteki = false;
            }.bind(this.player));
    },

    //マップ情報の消去
    clearMap: function() {
        //当たり判定、オブジェクトの全消去
        if (this.backgroundLayer) this.backgroundLayer.removeChildren();
        if (this.foregroundLayer) this.foregroundLayer.removeChildren();
        if (this.collisionLaye) this.collisionLayer.removeChildren();
        if (this.enemyLayer) this.enemyLayer.removeChildren();
        if (this.objLayer) this.objLayer.removeChildren();
        if (this.mapImageLayer) this.mapImageLayer.removeChildren();
        if (this.effectLayer) this.effectLayer.removeChildren();
        if (this.shadowLayer) this.shadowLayer.removeChildren();
    },

    //マップレイヤの切替
    switchMap: function(layer, x, y) {
        if (this.mapLayer) this.mapLayer.remove();
        this.mapLayer = layer;
        this.mapLayer.addChildTo(this.baseLayer);
        this.map = layer.map;

        this.backgroundLayer = layer.backgroundLayer;
        this.foregroundLayer = layer.foregroundLayer;
        this.collisionLayer = layer.collisionLayer;
        this.enemyLayer = layer.enemyLayer;
        this.playerLayer = layer.playerLayer;
        this.objLayer = layer.objLayer;
        this.mapImageLayer = layer.mapImageLayer;
        this.effectLayer = layer.effectLayer;
        this.shadowLayer = layer.shadowLayer;

        this.player.remove();
        this.player.addChildTo(layer.playerLayer);
        if (x) {
            this.player.setPosition(x, y);
        }
    },

    //リスタート
    restart: function() {
        this.player.continueReset();
        this.player.mutekiTime = 90;
        this.player.addChildTo(this.mapLayer.playerLayer);

        //プレイヤー座標を最後に床にいた場所にする
        this.player.x = this.player.lastOnFloorX;
        this.player.y = this.player.lastOnFloorY;

        //復帰位置安全性確認
        var x = this.player.x;
        var y = this.player.y;
        var c1 = this.player.checkMapCollision2(x, y + 5, 4, 32);   //真下
        var c2 = this.player.checkMapCollision2(x+32, y + 5, 4, 32);//右下
        var c3 = this.player.checkMapCollision2(x-32, y + 5, 4, 32);//左下
        //真下に足場が無い場合は安全な場所にずらす
        if (!c1) {
            if (c2) {
                this.player.x += 32;
            } else if (c3){
                this.player.x -= 32;
            } else {
                //安全に復帰出来ないので直近のスタート地点へ
                this.player.x = this.mapstart.x;
                this.player.y = this.mapstart.y;
            }
        }

        this.totalScore = 0;
        this.totalKill = 0;
        this.continueCount++;

        this.stageController.playBGM();
    },

    //ステージクリア
    stageClear: function() {
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 2,

            fontFamily: "UbuntuMono",
            baseline: "middle",
            fontSize: 20,
            fontWeight: ''
        };

        //オールクリア判定
        this.allClear = false;
        if (!this.isPractice && this.stageNumber >= this.stageNumberMax) this.allClear = true;

        //クリアメッセージ投入
        var text = "STAGE " + this.stageNumber + " CLEAR!";
        if (this.allClear) text = "STAGE ALL CLEAR!";
        this.spawnMessage(text, 24);
        this.player.isControl = false;
        this.stageController.stageClear();
        this.isStageClear = true;

        //プレイヤー所持キークリア
        this.player.keys = [];
        this.player.isMuteki = true;

        //クリアBGM
        var bgmFinish = false;
        app.playBGM("stageclear", false, function() {
            bgmFinish = true;
        });

        var ar = {loadcomplete: true};
        if (!this.isPractice) {
            //クリア時点情報保存
            var data = {
                stage: this.stageNumber,
                score: this.totalScore,
                kill: this.totalKill,
                time: this.stageController.timeLimit - this.timeLimit,
            };
            this.clearResult[this.stageNumber] = data;

            //次ステージのアセット読み込み
            if (this.stageNumber < this.stageNumberMax) {
                var assets = qft.Assets.get({assetType: "stage"+(this.stageNumber+1)});
                var ar = phina.extension.AssetLoaderEx().load(assets, function(){app.soundset.readAsset();});
            } else {
                //オールクリア時はエンディング用ステージへ
                if (this.allClear) {
                    var assets = qft.Assets.get({assetType: "stage10"});
                    var ar = phina.extension.AssetLoaderEx().load(assets, function(){app.soundset.readAsset();});
                }
            }
        }

        //ロード進捗表示
        var that = this;
        var param = {text: "Loading... ", align: "right", fontSize: 20}.$safe(labelParam);
        var progress = phina.display.Label(param).addChildTo(this).setPosition(SC_W, SC_H*0.95);
        progress.time = 0;
        progress.update = function() {
            //ロードが終わったらキー入力で次ステージへ
            if (ar.loadprogress) this.text = "Loading... "+Math.floor(ar.loadprogress * 100)+"%";
            if (bgmFinish && that.timeLimit == 0 && ar.loadcomplete) {
                this.text = "Push button to next stage.";
                if (that.allClear) this.text = "Push button to next...";
                var ct = app.controller;
                if (ct.ok || ct.cancel) {
                    if (that.isPractice) {
                        that._exitGame = true;
                    } else {
                        that.flare('nextstage');
                    }
                    this.remove();
                }
            }
            if (this.time % 30 == 0) this.visible = !this.visible;
            this.time++;
        }
    },

    exitGame: function() {
        app.playBGM("openingbgm");
        if (this.isPractice || this.isContinue) {
            this.exit();
        } else {
            this.exit("title");
        }
    },

    //現在のステータスをローカルストレージへ保存
    saveGame: function() {
        var saveObj = {
            stageNumber: this.stageNumber,
            score: this.totalScore,
            kill: this.totalKill,
            result: this.clearResult,
            playerStatus: this.player.startStatus,
        };
        localStorage.setItem("stage", JSON.stringify(saveObj));
        return saveObj;
    },

    //ローカルストレージから直前の保存状態を読み込み
    loadGame: function() {
        var data = localStorage.getItem("stage");
        if (data) {
            var d = JSON.parse(data).$safe({
                stageNumber: 1,
                result: [],
                playerStatus: {},
            });
            this.stageNumber = d.stageNumber;
            this.totalScore = 0;
            this.totalKill = 0;
            this.clearResult = d.result;

            //プレイヤー情報復元
            this.player.startStatus = d.playerStatus;
            this.player.restoreStatus();
            this.playerWeapon.rotation = 0;
        }
        return d;
    },
});

/*
 *  menuscene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.MenuScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,0.5)",
            stroke: "rgba(0,0,0,0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "left",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };

        this.player = this.currentScene.player;
        this.limitFrame = 30;
        this.isExit = false;

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont2",
            align: "center",
            baseline: "middle",
            fontSize: 70,
        };
        this.textLabel1 = phina.display.Label({text: "PAUSE", fontSize: 20}.$safe(labelParam))
            .addChildTo(this).setPosition(SC_W*0.5, SC_H*0.8);

        this.time = 0;        
    },

    update: function() {
        var ct = app.controller;
        if (this.time > 10 && !this.isExit) {
            if (ct.start || ct.pause || ct.menu) {
                this.isExit = true;
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
        }
        this.limitFrame--;
        this.time++;
    },
});


/*
 *  menuscene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.MenuScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: "rgba(0,0,0,0.5)",
            stroke: "rgba(0,0,0,0.5)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5)

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "left",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };

        this.player = this.currentScene.player;
        var x = SC_W*0.3; //this.player.x + this.currentScene.mapLayer.x;
        var y = SC_H*0.5; //this.player.y + this.currentScene.mapLayer.y;

        //ベースエレメント
        this.menuBase = phina.display.DisplayElement().addChildTo(this).setPosition(x, y);
        this.menuBase.tweener.setUpdateType('fps');

        //メニューアイテム初期化
        this.setItems();

        //現在装備表示
        var eq = this.player.equip;
        this.weapon = phina.display.Sprite("item", 24, 24)
            .setPosition(SC_W*0.55, SC_H*0.3)
            .setScale(1.5)
            .setFrameIndex(eq.weapon[0])
            .addChildTo(this);
        this.weaponLabel = phina.display.Label({text: ""}.$safe(labelParam))
            .setPosition(SC_W*0.55+32, SC_H*0.3)
            .addChildTo(this);
        this.weaponLabel.update = function() {
            var item = qft.ItemInfo.get(eq.weapon[0]);
            this.text = item.name;
        };

        this.limitFrame = 30;

        this.isExit = false;
        this.time = 0;        
    },

    update: function() {
        var ct = app.controller;
        if (this.time > 10 && !this.isExit) {
            if (ct.start || ct.pause || ct.menu) {
                this.isExit = true;
                this.close();
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
            if (ct.right && this.limitFrame < 0) {
                app.playSE("click");
                this.menuBase.tweener.clear()
                    .by({rotation: -this.deg_1}, 4)
                    .call(function(){
                        if (this.rotation < 0) this.rotation += 360;
                    }.bind(this.menuBase));
                this.limitFrame = 5;
                this.currentScene.menuSelect++;
                if (this.currentScene.menuSelect == this.icon.length) this.currentScene.menuSelect = 0;
            }
            if (ct.left && this.limitFrame < 0) {
                app.playSE("click");
                this.menuBase.tweener.clear()
                    .by({rotation: this.deg_1}, 4)
                    .call(function(){
                        if (this.rotation > 360) this.rotation -= 360;
                    }.bind(this.menuBase));
                this.limitFrame = 5;
                this.currentScene.menuSelect--;
                if (this.currentScene.menuSelect < 0) this.currentScene.menuSelect = this.icon.length-1;
            }
        }
        this.limitFrame--;
        this.time++;
    },

    setItems: function() {
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 24,
            fontWeight: ''
        };

        var that = this;
        this.menuBase.removeChildren();

        //メニューアイテム
        this.icon = [];
        this.menuItems = this.player.items.clone();

        var rad = 0;
        var rad_1 = (Math.PI*2) / this.menuItems.length;
        var id = 0;
        this.menuItems.forEach(function(e) {
            var ic;
            if (typeof e === 'string') {
                ic = phina.display.Label({text: e}.$safe(labelParam)).addChildTo(this.menuBase);
                ic.setScale(0.5);
            } else {
                ic = phina.display.Sprite("item", 24, 24)
                    .addChildTo(this.menuBase)
                    .setFrameIndex(e);
            }
            ic.tweener.setUpdateType('fps');
            ic.rad = rad;
            ic.id = id;
            ic.distance = 0;
            ic.isClose = false;
            ic.update = function() {
                this.rotation = -that.menuBase.rotation;
                this.x =  Math.sin(this.rad)*this.distance;
                this.y = -Math.cos(this.rad)*this.distance;
                if (this.isClose) return;
                if (this.id == that.currentScene.menuSelect) {
                    this.tweener.clear().to({distance: 88, scaleX: 3, scaleY: 3}, 3);
                } else {
                    this.tweener.clear().to({distance: 72, scaleX: 1, scaleY: 1}, 3);
                }
            }
            ic.close = function() {
                this.tweener.clear().to({distance: 0, scaleX: 1, scaleY: 1}, 3);
                this.isClose = true;
            }
            ic.tweener.clear().to({distance: 48}, 500);
            this.icon.push(ic);
            rad += rad_1;
            id++;
        }.bind(this));

        this.deg_1 = 360/ this.menuItems.length;
        this.menuBase.rotation = -(this.currentScene.menuSelect * this.deg_1) - 90;
        this.menuBase.tweener.by({rotation: 90}, 15, "easeOutSine");
    },

    close: function() {
        this.menuBase.tweener.clear().by({rotation: 180}, 15, "easeOutSine");
        this.icon.forEach(function(e) {
            e.close();
        }.bind(this));
    },
});


/*
 *  messagescene.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.MessageScene", {
    superClass: "phina.display.DisplayScene",

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //メッセージウィンドウ
        var param = {
            width:SC_W*0.8,
            height:SC_H*0.4,
            fill: "rgba(0,0,0,0.8)",
            stroke: "white",
            sttokeWidth: 5,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.25)
            .setScale(1, 0);
        this.bg.tweener.clear().to({scaleY: 1}, 500, "easeOutCube");

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };
        this.textLabel = phina.display.Label({text: options.message || "no message", fontSize: 20}.$safe(labelParam))
            .addChildTo(this).setPosition(SC_W*0.5, SC_H*0.25);

        this.player = this.currentScene.player;
        this.limitFrame = 30;
        this.isExit = false;

        this.time = 0;        
    },

    update: function() {
        var ct = app.controller;
        if (this.time > 10 && !this.isExit) {
            if (ct.start || ct.pause || ct.menu) {
                this.isExit = true;
                this.tweener.clear()
                    .wait(100)
                    .call(function() {
                        app.popScene();
                    });
            }
        }
        this.limitFrame--;
        this.time++;
    },
});


/*
 *  openingscene.js
 *  2017/02/08
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.OpeningScene", {
    superClass: "phina.display.DisplayScene",

    //進行
    seq: 0,

    init: function(currentScene) {
        this.superInit({width: SC_W, height: SC_H});
        this.currentScene = currentScene;

        //ＢＧＭ再生
        app.playBGM("openingbgm");

        this.text = [
            "世界の中心にそびえる塔",
            "塔の最上階には",
            "「永遠の都」と呼ばれる楽園があるという",
            "噂を聞いた多くの冒険者が",
            "楽園を求めて塔へと赴き",
            "その謎に挑んでいった",
            "しかし…",
            "彼らが果たして楽園に辿り着いたのか",
            "それとも世界の果てで力尽きたのか",
            "その末路を知る者はいない",
            "そして…",
            "新たな冒険者がまた一人",
            "いまだ見ぬ楽園への道に挑もうとしていた",
        ];

        //バックグラウンド
        var param = {
            width: SC_W,
            height: SC_H,
            fill: "rgba(0,0,0,1)",
            stroke: "rgba(0,0,0,1)",
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.5)

        //イメージ表示用レイヤ
        this.imageLayer = phina.display.DisplayElement().addChildTo(this);

        //フォアグラウンド
        var that = this;
        this.fg = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.5).setInteractive(true);
        this.fg.alpha = 0;
        this.fg.onpointstart = function() {
            if (that.alreadyLoad || that.loader && that.loader.loadcomplete) that.exit();
        }

        //上下黒帯
        param.height = SC_H * 0.15;
        this.bg1 = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.07)
        this.bg2 = phina.display.RectangleShape(param).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.93)

        //字幕
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 14,
        };
        var num = 0;
        this.textLabel = phina.display.Label({text: ""}.$safe(labelParam)).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.9);
        this.textLabel.alpha = 0;
        this.textLabel.tweener.clear()
            .call(function() {
                this.textLabel.text = this.text[num];
                num++;
                if (num == this.text.length) {
                    this.textLabel.tweener.setLoop(false);
                }
            }.bind(this))
            .fadeIn(500)
            .wait(3000)
            .fadeOut(500)
            .wait(1000)
            .setLoop(true);

        //基本アセットをロード
        this.alreadyLoad = false;
        if (qft.Assets.isLoaded("common")) {
            //読込済みなのでスキップ
            this.alreadyLoad = true;
            return;
        }
        var that = this;
        var assets = qft.Assets.get({assetType: "common"});
        this.loader = phina.extension.AssetLoaderEx().load(assets, function(){app.soundset.readAsset();});
        this.loadLabel = phina.display.Label({text: "", align: "right", fontSize: 12}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.99, SC_H*0.1);
        this.loadLabel.time = 1;    
        this.loadLabel.update = function() {
            this.text = "Loading... "+Math.floor(that.loader.loadprogress * 100)+"%";
            if (that.loader.loadcomplete) {
                this.text = "Push button to skip.";
                this.visible = true;
            } else {
                if (this.time % 20 == 0) this.visible = !this.visible;
            }
            this.time++;
        };
    },

    update: function() {
        if (this.alreadyLoad || this.loader && this.loader.loadcomplete) {
            var ct = app.controller;
            if (ct.ok || ct.cancel) this.exit();
        }

        if (this.seq == 0) {
            this.worldmap();
            this.seq++;
        }
        if (this.seq == 2) {
            this.towerimage();
            this.seq++;
        }
        if (this.seq == 4) {
            this.sequence3();
            this.seq++;
        }
        if (this.seq == 6) {
            this.playerimage();
            this.seq++;
        }
        if (this.seq == 8) {
            this.exit();
        }
    },

    //世界地図
    worldmap: function() {
        var sprite1 = phina.display.Sprite("openingmap")
            .addChildTo(this.imageLayer)
            .setPosition(SC_W * 0.5, -SC_H * 0.25)
            .setScale(0.8)
            .setAlpha(0.0);
        sprite1.tweener.clear()
            .by({alpha: 1.0, y: 200}, 7000)
            .by({alpha: -1.0, y: 200}, 7000)
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));
    },

    //塔外観
    towerimage: function() {
        var sprite1 = phina.display.Sprite("background").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.5);
        sprite1.alpha = 0;
        sprite1.tweener.clear()
            .call(function(){
                sprite1.alpha = 1;
                this.fg.alpha = 1;
                this.fg.tweener.clear().fadeOut(7000).fadeIn(7000);
            }.bind(this))
            .wait(14000)
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));

        var sprite2 = phina.display.Sprite("openingtower").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.3);
        sprite2.alpha = 0;
        sprite2.tweener.clear()
            .call(function(){
                sprite2.alpha = 1;
            }.bind(this))
            .by({x: -100}, 4000, "easeInOutSine")
            .wait(3000)
            .by({y: 300}, 7000, "easeInSine")
            .call(function(){
                sprite2.remove();
            }.bind(this));
    },

    //三番目表示（暫定）
    sequence3: function() {
        var sprite1 = phina.display.Sprite("openingback2").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.3).setScale(1.1);
        sprite1.alpha = 0;
        sprite1.tweener.clear()
            .call(function(){
                sprite1.alpha = 1;
                this.fg.alpha = 1;
                this.fg.tweener.clear().fadeOut(7000).wait(10000).fadeIn(7000);
            }.bind(this))
            .by({y: 150}, 12000, "easeInOutSine")
            .wait(12000)
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));

        var sprite2 = phina.display.Sprite("openinglight").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.5);
        sprite2.blendMode = 'lighter';
        sprite2.alpha = 0.3;
        sprite2.tweener.clear()
            .wait(12000)
            .by({x: -50}, 12000, "easeInOutSine");
    },

    //プレイヤー表示
    playerimage: function() {
        var sprite1 = phina.display.Sprite("openingback").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.35).setScale(1.2);
        sprite1.alpha = 0;
        sprite1.tweener.clear()
            .call(function(){
                sprite1.alpha = 1;
                this.fg.alpha = 1;
                this.fg.tweener.clear().fadeOut(7000).wait(5000).fadeIn(7000);
            }.bind(this))
            .wait(15000)
            .by({y: 150}, 5000, "easeInOutSine")
            .call(function(){
                sprite1.remove();
                this.seq++;
            }.bind(this));

        var sprite2 = phina.display.Sprite("openingground").addChildTo(this.imageLayer).setPosition(SC_W * 0.5, SC_H * 0.9);
        sprite2.tweener.clear()
            .by({y: -50}, 4000, "easeInOutSine")
            .wait(10000)
            .by({y: 200}, 5000, "easeInOutSine")

        var pl = qft.PlayerDummy("player1").addChildTo(sprite2).setPosition(0, 38);
        pl.setAnimation("up");
        pl.tweener.clear()
            .wait(3000)
            .by({y: -76}, 5000, "easeInOutSine")
            .call(function() {
                pl.setAnimation("up_stop");
            })
            .wait(6000)
            .call(function() {
                pl.setAnimation("down");
            })
            .by({y: 76}, 5000, "easeInOutSine");
    },
});


/*
 *  practicescene.js
 *  2017/04/15
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.ConfigScene_Practice", {
    superClass: "phina.display.DisplayScene",

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        this.menuBase = phina.display.DisplayElement().addChildTo(this);
        this.menuBase.alpha = 0;
        this.menuBase.tweener.clear().fadeIn(500);

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont1",
            align: "center",
            baseline: "middle",
            fontSize: 70,
        };
        this.textLabel1 = phina.display.Label({text: "Practice", fontSize: 20}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.2);
        this.textLabel2 = phina.display.Label({text: "Stage select", fontSize: 20}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.3);

        //メニューテキスト表示
        var that = this;
        this.menu = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "P"];
        this.menuText = [];
        for (var i = 0; i < this.menu.length; i++) {
            this.menuText[i] = phina.display.Label({text: this.menu[i], fontSize: 40}.$safe(labelParam))
                .addChildTo(this.menuBase)
                .setPosition(SC_W*0.5+(SC_W*0.07*i)-(SC_W*0.07*(this.menu.length-1)/2), SC_H*0.5)
                .setScale(0.7);

            //タッチ判定用
            var param2 = {
                width: 30,
                height: SC_H*0.10,
                fill: "rgba(0,100,200,0.5)",
                stroke: "rgba(0,100,200,0.5)",
                backgroundColor: 'transparent',
            };
            var c = phina.display.RectangleShape(param2)
                .addChildTo(this.menuBase)
                .setPosition(SC_W*0.5+(SC_W*0.07*i)-(SC_W*0.07*(this.menu.length-1)/2), SC_H*0.5)
                .setInteractive(true);
            c.alpha = 0;
            c.select = i;
            c.onpointstart = function() {
                if (that.isSelected || that.time < 10) return;
                if (this.select == that.select) {
                    that.ok = true;
                } else {
                    if (that.vselect == 0) {
                        that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    } else {
                        that.exitText.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    }
                    that.select = this.select;
                    that.menuText[that.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                    that.vselect = 0;
                    app.playSE("select");
                }
            }
        }

        this.exitText = phina.display.Label({text: "Exit", fontSize: 40}.$safe(labelParam))
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.7)
            .setScale(0.7);
        //タッチ判定用
        var param2 = {
            width: SC_W*0.3,
            height: SC_H*0.10,
            fill: "rgba(0,100,200,0.5)",
            stroke: "rgba(0,100,200,0.5)",
            backgroundColor: 'transparent',
        };
        var c = phina.display.RectangleShape(param2)
            .addChildTo(this.menuBase)
            .setPosition(SC_W*0.5, SC_H*0.7)
            .setInteractive(true);
        c.alpha = 0;
        c.onpointstart = function() {
            if (that.isSelected || that.time < 10) return;
            if (that.vselect == 1) {
                that.ok = true;
            } else {
                that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                that.exitText.tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                that.vselect = 1;
                app.playSE("select");
            }
        }

        this.vselect = 0;
        this.select = 0;
        this.isSelected = false;
        this.selectMax = this.menu.length;
        this.menuText[0].setScale(1);
        this.ok = false;
        this.cancel = false;

        this.time = 0;

        this.on('resume', function() {
            this.time = 0;
            this.isSelected = false;
            this.ok = false;
            this.cansel = false;
        });
    },

    update: function() {
        var ct = app.controller;
        if (ct.right && !ct.before.right && this.select < this.selectMax-1 && this.vselect == 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select++;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }
        if (ct.left && !ct.before.left && this.select > 0  && this.vselect == 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }
        if (ct.down && !ct.before.down && this.vselect == 0) {
            this.vselect++;
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.exitText.tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }
        if (ct.up && !ct.before.up && this.vselect == 1) {
            this.vselect--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.exitText.tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            app.playSE("select");
            this.time = 10;
        }

        if (this.time > 15) {
            if (ct.ok || this.ok) {
                if (this.vselect == 0) {
                    if (this.select == 0) {
                        app.pushScene(qft.MainScene({startStage: 1, isPractice: true}));
                    } else {
                        if (this.select == 9) {
                            app.pushScene(qft.MainScene({startStage: 999, isPractice: true}));
                        } else if (this.select == 8) {
                            app.pushScene(qft.SceneFlow.Resume({stageNumber: 10, isPractice: false}));
                        } else {
                            app.pushScene(qft.SceneFlow.Resume({stageNumber: this.select+1, isPractice: true}));
                        }
                    }
                    app.stopBGM();
                }
                if (this.vselect == 1) {
                    app.playSE("cancel");
                    this.exitMenu();
                }
                this.time = 0;
            }
            if (ct.cancel || this.cancel) {
                app.playSE("cancel");
                this.exitMenu();
                this.time = 0;
            }
        }
        this.time++;
    },

    exitMenu: function() {
        this.menuBase.tweener.clear()
            .fadeOut(500)
            .call(function() {
                this.exit();
            }.bind(this));
    },
});

phina.define("qft.PracticePlatform", {
    superClass: "phina.display.DisplayScene",

    init: function(options) {
        this.superInit();
        this.options = (options || {}).$safe({
            assetType: "stage2",
            startStage: 2,
        })
        this.count = 0;
    },

    onenter: function() {
        app.pushScene(qft.LoadingScene({
            assets: qft.Assets.get(this.options),
        }));
    },

    onresume: function() {
        this.count++;
        if (this.count == 1) {
            app.pushScene(qft.MainScene({startStage: this.options.startStage, isPractice: true}));
        }
        if (this.count == 2){
            this.exit();
        }
    }
});

/*
 *  SceneFlow.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

//メインシーンフロー
phina.define("qft.SceneFlow", {
    superClass: "phina.game.ManagerScene",

    init: function(options) {
        options = options || {};
        startLabel = options.startLabel || "splash";
        this.superInit({
            startLabel: startLabel,
            scenes: [{
                label: "splash",
                className: "qft.SplashScene",
            },{
                label: "opening",
                className: "qft.OpeningScene",
            },{
                label: "title",
                className: "qft.TitleScene",
                nextLabel: "opening",
            },{
                label: "main",
                className: "qft.MainScene",
                arguments: {
                    startStage: 1,
                    isPractice: false,
                },
                nextLabel: "title",
            },{
                label: "continue",
                className: "qft.SceneFlow.Resume",
                arguments: {
                    isPractice: false,
                    isContinue: true,
                },
                nextLabel: "title",
            },{
                label: "ending",
                className: "qft.EndingScene",
                nextLabel: "main",
            },{
                label: "config",
                className: "qft.ConfigScene",
                nextLabel: "title",
            },{
                label: "practice",
                className: "qft.ConfigScene_Practice",
                nextLabel: "config",
            }],
        });
    }
});

//復帰用
phina.define("qft.SceneFlow.Resume", {
    superClass: "phina.game.ManagerScene",

    init: function(options) {
        options = (options || {}).$safe({stageNumber: 2, isPractice: false, isContinue: false});
        if (options.isContinue) {
            var data = localStorage.getItem("stage");
            if (data) {
                var d = JSON.parse(data).$safe({
                    stageNumber: 1,
                    result: [],
                    playerStatus: {},
                });
                options.stageNumber = d.stageNumber;
            } else {
                options.stageNumber = 1;
            }
        }
        var startLabel = "start";
        var assets = qft.Assets.get({assetType: "stage"+options.stageNumber});
        this.superInit({
            startLabel: startLabel,
            scenes: [{
                label: "start",
                className: "qft.LoadingScene",
                arguments: {
                    assets: assets,
                },
                nextLabel: "main",
            },{
                label: "main",
                className: "qft.MainScene",
                arguments: {
                    startStage: options.stageNumber,
                    isPractice: options.isPractice,
                    isContinue: options.isContinue,
                },
            }],
        });
    },
    onfinish: function() {
        this.exit();
    }
});

/*
 *  splashscene.js
 *  2017/02/08
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define('qft.SplashScene', {
    superClass: 'phina.display.DisplayScene',

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        this.unlock = false;
        this.loadcomplete1 = false;
        this.loadcomplete2 = false;
        this.progress1 = 0;
        this.progress2 = 0;

        //preload asset
        var assets = qft.Assets.get({assetType: "splash"});
        this.loader = phina.asset.AssetLoader();
        this.loader.load(assets);
        this.loader.on('load', function(e) {
            this.loadcomplete1 = true;
        }.bind(this));
        this.loader.on('progress', function(e) {
            this.progress1 = Math.floor(e.progress*100);
        }.bind(this));

        //preload asset2
        var assets = qft.Assets.get({assetType: "splash2"});
        this.loader2 = phina.asset.AssetLoader();
        this.loader2.load(assets);
        this.loader2.on('load', function(e) {
            this.loadcomplete2 = true;
        }.bind(this));
        this.loader2.on('progress', function(e) {
            this.progress2 = Math.floor(e.progress*100);
        }.bind(this));

        //logo
        var texture = phina.asset.Texture();
        texture.load(qft.SplashScene.logo).then(function() {
            this._init();
        }.bind(this));
        this.texture = texture;
    },

    _init: function() {
        this.sprite = phina.display.Sprite(this.texture)
            .addChildTo(this)
            .setPosition(this.gridX.center(), this.gridY.center())
            .setScale(0.3);
        this.sprite.alpha = 0;

        this.sprite.tweener.clear()
            .to({alpha:1}, 500, 'easeOutCubic')
            .wait(500)
            .call(function() {
                this.unlock = true;
            }, this);

        var that = this;
        //進捗ゲージ
        var options = {
            width:  SC_W*0.1,
            height: 3,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 1,
            gaugeColor: 'lime',
            cornerRadius: 3,
            value: 0,
            maxValue: 100,
        };
        this.progressGauge = phina.ui.Gauge(options).addChildTo(this).setPosition(SC_W*0.5, SC_H*0.8);
        this.progressGauge.beforeValue = 0;
        this.progressGauge.update = function() {
            if (that.progress1 == this.beforeValue) {
                this.value++;
            } else {
                this.value = that.progress1;
            }
            this.beforeValue = this.value;
        };
    },

    update: function() {
        if (this.unlock && this.loadcomplete1 && this.loadcomplete2) {
            this.unlock = false;
            this.sprite.tweener.clear()
                .to({alpha:0}, 500, 'easeOutCubic')
                .call(function() {
                    this.exit();
                }, this);
            this.progressGauge.tweener.clear().to({alpha:0}, 10, 'easeOutCubic')
        }
    },

    _static: {
        logo: "assets/image/phinajs_logo.png",
    },
});

/*
 *  titlescene.js
 *  2017/02/09
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.define("qft.TitleScene", {
    superClass: "phina.display.DisplayScene",

    init: function() {
        this.superInit({width: SC_W, height: SC_H});

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.setUpdateType('fps');

        var sprite1 = phina.display.Sprite("titleback").addChildTo(this).setPosition(SC_W * 0.5, SC_H * 0.5);
        sprite1.alpha = 0;
        sprite1.tweener.clear().fadeIn(500);

        //タイトルロゴの表示
        this.dispTitleLogo();

        //メニューアイテム表示
        var that = this;
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 5,

            fontFamily: "titlefont2",
            align: "center",
            baseline: "middle",
            fontSize: 30,
        };
        this.menu = ["Start", "Continue", "Config"];
        this.menuComment = ["ゲームを開始します", "前回ゲームオーバーになったステージの最初から開始します", "設定メニューを開きます"];
        this.menuText = [];
        for (var i = 0; i < this.menu.length; i++) {
            this.menuText[i] = phina.display.Label({text: this.menu[i]}.$safe(labelParam))
                .addChildTo(this)
                .setPosition(SC_W*0.5, SC_H*0.6+i*30)
                .setScale(0.7);

            //タッチ判定用
            var param2 = {
                width: SC_W*0.3,
                height: SC_H*0.08,
                fill: "rgba(0,100,200,0.5)",
                stroke: "rgba(0,100,200,0.5)",
                backgroundColor: 'transparent',
            };
            var c = phina.display.RectangleShape(param2)
                .addChildTo(this)
                .setPosition(SC_W*0.5, SC_H*0.6+i*30)
                .setInteractive(true);
            c.alpha = 0;
            c.select = i;
            c.onpointstart = function() {
                if (that.isSelected || that.time < 10) return;
                if (this.select == that.select) {
                    that.ok = true;
                } else {
                    that.menuText[that.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
                    that.select = this.select;
                    that.menuText[that.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
                    app.playSE("select");
                }
            }
        }
        this.isSelected = false;
        this.select = 0;
        this.selectMax = 3;
        this.menuText[0].setScale(1);
        this.ok = false;
        this.cansel = false;

        //メニューコメント
        var that = this;
        this.comment = phina.display.Label({text: "", fontSize: 10}.$safe(labelParam))
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.9);
        this.comment.update = function() {
            this.text = that.menuComment[that.select];
        }

        this.fg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fg.tweener.setUpdateType('fps');
        this.fg.tweener.clear().fadeOut(15);

        this.on('resume', e => {
            this.fg.tweener.clear().fadeOut(15);
            this.time = 0;
            this.isSelected = false;
            this.ok = false;
            this.cansel = false;
        });

        this.time = 0;
    },

    update: function(app) {
        if (this.isSelected) return;

        var ct = app.controller;
        if (ct.down && !ct.before.down && this.select < this.selectMax-1) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select++;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }
        if (ct.up && !ct.before.up && this.select > 0) {
            this.menuText[this.select].tweener.clear().to({scaleX: 0.7, scaleY: 0.7}, 500, "easeOutBounce");
            this.select--;
            this.menuText[this.select].tweener.clear().to({scaleX: 1.0, scaleY: 1.0}, 500, "easeOutBounce");
            this.time = 10;
            app.playSE("select");
        }
        if (this.time > 15) {
            if (ct.ok || this.ok){
                this.isSelected = true;
                this.time = 0;
                switch (this.select) {
                    case 0:
                        //通常開始
                        app.playSE("ok");
                        this.fg.tweener.clear()
                            .fadeIn(3)
                            .call(function() {
                                this.exit("main");
                            }.bind(this));
                        break;
                    case 1:
                        //コンティニュー
                        app.playSE("ok");
                        this.fg.tweener.clear()
                            .fadeIn(3)
                            .call(function() {
                                var data = localStorage.getItem("stage");
                                if (data) {
                                    var d = JSON.parse(data).$safe({stageNumber: 1});
                                    if (d.stageNumber == 1) {
                                        this.exit("main");
                                    } else {
                                        app.pushScene(qft.SceneFlow.Resume({isPractice: false, isContinue: true}));
                                    }
                                } else {
                                    this.exit("main");
                                }
                            }.bind(this));
                        break;
                    case 2:
                        //設定メニュー
                        app.pushScene(qft.ConfigScene(this));
                        break;
                }
            }
            if (ct.cancel || this.cancel) {
                app.pushScene(qft.ConfigScene(this));
                this.isSelected = true;
                this.time = 0;
            }
        }
        if (this.time > 30 * 120) {
            this.exit("opening");
        }
        this.time++;
    },

    //タイトルロゴ表示
    dispTitleLogo: function(x, y) {
        x = x || SC_W * 0.5;
        y = y || SC_H * 0.45;

        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 10,

            fontFamily: "titlefont1",
            align: "center",
            baseline: "middle",
            fontSize: 60,
        };
        var num = 0;
        this.textLabel = phina.display.Label({text: "The", fontSize: 30}.$safe(labelParam))
            .addChildTo(this).setPosition(x-182, y-85);
        this.textLabel = phina.display.Label({text: "Quest"}.$safe(labelParam))
            .addChildTo(this).setPosition(x-47, y-85);
        this.textLabel = phina.display.Label({text: "for", fontSize: 40}.$safe(labelParam))
            .addChildTo(this).setPosition(x-17, y-40);
        this.textLabel = phina.display.Label({text: "Tanelorn"}.$safe(labelParam))
            .addChildTo(this).setPosition(x+48, y);
    },
});

/*
 *  tutorialscene.js
 *  2017/06/01
 *  @auther minimo  
 *  This Program is MIT license.
 */
 
phina.define("qft.TutorialScene", {
    superClass: "phina.display.DisplayScene",

    //スクリーンのマップ外への移動制限フラグ
    limitWidth: false,
    limitHeight: true,

    //プレイヤースクリーン中央固定フラグ
    centerPlayer: true,

    init: function(options) {
        this.superInit({width: SC_W, height: SC_H});

        //バックグラウンド
        var param = {
            width:SC_W,
            height:SC_H,
            fill: 'black',
            stroke: false,
            backgroundColor: 'transparent',
        };
        this.bg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.bg.tweener.setUpdateType('fps');

        //背景
        this.backgroundImage = phina.display.Sprite("background").addChildTo(this).setPosition(0, SC_H*0.5).setOrigin(0, 0.5);

        //管理用基準レイヤ
        this.baseLayer = phina.display.DisplayElement().addChildTo(this);

        //プレイヤーキャラクタ
        this.player = qft.Player(this);

       //スクリーン初期化
        this.setupScreen();

        //ステージ情報初期化
        this.setupStage();

        this.fg = phina.display.RectangleShape(param)
            .addChildTo(this)
            .setPosition(SC_W*0.5, SC_H*0.5);
        this.fg.tweener.setUpdateType('fps').clear().fadeOut(30);

        //バーチャルパッドの可視化
//        app.virtualPad.addChildTo(this);

        app.volumeBGM = 0.5;
        app.volumeSE = 0.2;

        //メッセージ表示
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 16,
            fontWeight: ''
        };
        var that = this;
        this.messageStack = [];
        this.eventMessage = phina.display.Label({text: ""}.$safe(labelParam))
            .setPosition(SC_W*0.5, SC_H*0.2)
            .addChildTo(this);
        this.eventMessage.alpha = 0;
        this.eventMessage.tweener.clear().setUpdateType('fps');
        this.eventMessage.nextOk = true;
        this.eventMessage.update = function() {
            if (this.nextOk && that.messageStack.length > 0) {
                this.nextOk = false;
                var msg = that.messageStack[0];
                this.tweener.clear()
                    .call(function(){
                        this.text = msg.text;
                    }.bind(this))
                    .fadeIn(15).wait(90).fadeOut(15)
                    .call(function(){
                        this.nextOk = true;
                        that.messageStack.splice(0, 1);
                    }.bind(this))
            }
        }

        this.time = 0;
    },

    update: function(app) {
        if (this.time == 15) this.player.isControl = true;

        //スクリーン表示位置をプレイヤー中心になる様に調整
        if (this.centerPlayer) {
            var map = this.mapLayer.map;
            this.mapLayer.x = SC_W*0.5-this.player.x;
            this.mapLayer.y = SC_H*0.5-this.player.y;
            if (this.limitHeight) {
                if (this.mapLayer.y > 0) this.mapLayer.y = 0;
                if (this.mapLayer.y < -(map.height-SC_H)) this.mapLayer.y = -(map.height-SC_H);
            }
            if (this.limitWidth) {
                if (this.mapLayer.x > 0) this.mapLayer.x = 0;
                if (this.mapLayer.x < -(map.width-SC_W)) this.mapLayer.x = -(map.width-SC_W);
            }

            //スクリーン座標
            this.screenX = -this.mapLayer.x;
            this.screenY = -this.mapLayer.y;

            //バックグラウンドのX座標を全体の割合から計算
            this.backgroundImage.x = -Math.floor(this.backgroundImage.width * (this.player.x / map.width)*0.01);
        }

        this.time++;
    },

    //敵キャラクタ投入
    spawnEnemy: function(x, y, name, options) {
        return qft.Enemy[name](this, options).addChildTo(this.enemyLayer).setPosition(x, y);
    },

    //アイテム投入
    spawnItem: function(x, y, options) {
        return qft.Item(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //アイテムボックス投入
    spawnItemBox: function(x, y, options) {
        return qft.ItemBox(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //エフェクト投入
    spawnEffect: function(x, y, options) {
        return qft.Effect(this, options).addChildTo(this.objLayer).setPosition(x, y);
    },

    //メッセージ投入
    spawnMessage: function(text, between, waitFrame) {
        between = between || 32;
        waitFrame = waitFrame || 30;
        var arrayText = text.split("");
        var labelParam = {
            fill: "white",
            stroke: "blue",
            strokeWidth: 2,

            fontFamily: "Orbitron",
            align: "center",
            baseline: "middle",
            fontSize: 32,
            fontWeight: ''
        };
        var n = 0;
        var x = SC_W * 0.5 - (arrayText.length * between * 0.5);
        arrayText.forEach(function(e) {
            if (e == " ") {
                x += between;
                return;
            }
            var lb = phina.display.Label({text: e}.$safe(labelParam)).setPosition(x, SC_H*0.5+32).setScale(0, 1).addChildTo(this);
            lb.tweener.clear().setUpdateType('fps')
                .set({alpha: 0})
                .wait(n)
                .to({scaleX: 1.0, alpha: 1, y: SC_H*0.5}, 15, "easeOutSine")
                .wait(waitFrame)
                .to({scaleX: 0.0, y: SC_H*0.5-32}, 10, "easeOutSine")
                .call(function(){this.remove()}.bind(lb));
            x += between;
            n += 5;
        }.bind(this));
    },

    //イベントメッセージ投入
    spawnEventMessage: function(id, text) {
        if (!id || !text) return;
        //メッセージスタック内に同一ＩＤがある場合は投入しない
        for (var i = 0; i < this.messageStack.length; i++) {
            if (this.messageStack[i].id == id) return;
        }
        if (text instanceof Array) {
            text.forEach(function(str) {
                this.messageStack.push({id: id, text: str});
            }.bind(this));
        } else {
            this.messageStack.push({id: id, text: text});
        }
    },

    //スクリーン初期化
    setupScreen: function() {
        var that = this;
        var labelParam = {
            fill: "white",
            stroke: "black",
            strokeWidth: 1,

            fontFamily: "UbuntuMono",
            align: "left",
            baseline: "middle",
            fontSize: 20,
            fontWeight: ''
        };

        //体力ゲージ
        phina.display.Label({text: "LIFE"}.$safe(labelParam)).addChildTo(this).setPosition(0, 10);
        var options = {
            width:  256,
            height: 5,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 2,
            gaugeColor: 'lime',
            cornerRadius: 0,
            value: this.player.hp,
            maxValue: this.player.hp,
        };
        this.lifeGauge = phina.ui.Gauge(options).addChildTo(this).setOrigin(0, 0.5).setPosition(40, 10);
        this.lifeGauge.update = function() {
            this.value = that.player.hp;
        };

        //スコア表示
        this.scoreLabel = phina.display.Label({text:"SCORE:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 10);
        this.scoreLabel.score = 0;
        this.scoreLabel.s = 0;
        this.scoreLabel.update = function(e) {
            if (e.ticker.frame % 10 == 0) {
                this.s = ~~((that.totalScore-this.score)/7);
                if (this.s < 3) this.s = 3;
                if (this.s > 7777) this.s = 7777;
            }
            this.score += this.s;
            if (this.score > that.totalScore) this.score = that.totalScore;

            this.text = "SCORE "+this.score.comma();
        }

        //制限時間表示
        var tl = phina.display.Label({text: "TIME:", align: "right"}.$safe(labelParam)).addChildTo(this).setPosition(SC_W, 30);
        tl.update = function() {
            this.text = "TIME:"+Math.floor(that.timeLimit/30);
            if (that.timeLimit == 0) {
                this.fill = 'red';
            } else {
                this.fill = 'white';
            }
        }

        //プレイヤー装備武器表示
        this.playerWeapon = qft.PlayerWeapon(this.player).addChildTo(this).setPosition(SC_W-30, SC_H-30);
    },

    //マップ情報の初期化
    setupStage: function() {

        this.baseLayer.removeChildren();

        this.stageController = qft.Stage999(this);
        this.switchMap(this.stageController.mapLayer[0]);

        //経過時間初期化
        this.time = 0;

        //タイムリミット設定
        this.timeLimit = this.stageController.timeLimit;

        //プレイヤー設定
        this.player.isControl = false;
        this.player.isMuteki = false;
        this.player.alpha = 1.0;

        this.stageController.playBGM();
    },

    //マップレイヤの切替
    switchMap: function(layer, x, y) {
        if (this.mapLayer) this.mapLayer.remove();
        this.mapLayer = layer;
        this.mapLayer.addChildTo(this.baseLayer);
        this.map = layer.map;

        this.backgroundLayer = layer.backgroundLayer;
        this.foregroundLayer = layer.foregroundLayer;
        this.collisionLayer = layer.collisionLayer;
        this.enemyLayer = layer.enemyLayer;
        this.playerLayer = layer.playerLayer;
        this.objLayer = layer.objLayer;
        this.mapImageLayer = layer.mapImageLayer;
        this.effectLayer = layer.effectLayer;

        this.player.remove();
        this.player.addChildTo(layer.playerLayer);
        if (x) {
            this.player.setPosition(x, y);
        }
    },
});

/*
 *  stage1.js
 *  2017/01/24
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage1", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 1,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm1",

    init: function(parentScene) {
        this.superInit(parentScene);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage1");
        this.mapLayer[0] = this.createMap(tmx);

       //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 1", 24);

            //マップ表示設定
            this.limitWidth = false;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveBy(14, -32, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage10.js
 *  2017/09/10
 *  @auther minimo  
 *  This Program is MIT license.
 */

//エンディングシーン
phina.define("qft.Stage10", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 10,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "ending",

    //特殊ステージフラグ
    isEnding: true,

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage10");
        this.mapLayer[0] = this.createMap(tmx);

        //プレイヤーダミースプライト
        var pl = qft.PlayerDummy("player1")

        //初期処理
        this.add(1, function() {
            //開始メッセージ投入
            this.spawnEventMessage(1, "Congraturations!!");

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;

            this.player.speed = 2;
            this.player.speedAscend = 2;
            this.player.isAuto = true;
            this.player.autoKey.up = true;
        });

        this.add(224, function() {
            this.player.autoKey.up = false;
        });

        this.add(60, function() {
            this.player.autoKey.right = true;
        });

        //石碑まで
        this.add(255, function() {
            this.player.autoKey.right = false;
            this.player.setAlpha(0);
            pl.addChildTo(this.mapLayer.playerLayer);
            pl.setPosition(this.player.x, this.player.y);
            pl.setAnimation("up_stop");
        });
        this.add(120, function() {
            this.player.autoKey.right = true;
            this.player.setAlpha(1.0);
            pl.remove();
        });

        //入り口まで
        this.add(330, function() {
            this.player.autoKey.right =　false;
        });

        this.add(60, function() {
            this.player.autoKey.right = true;
        });
        this.add(30, function() {
            this.player.autoKey.right = false;
        });
        this.add(30, function() {
            this.player.autoKey.right = true;
        });
        this.add(20, function() {
            this.player.autoKey.right = false;
        });

        this.add(60, function() {
            this.player.tweener.clear().set({alpha: 0}).moveBy(0, -600, 600);
            this.player.gravity = 0;

            pl.addChildTo(this.mapLayer.playerLayer);
            pl.setPosition(this.player.x, this.player.y);
            pl.setAnimation("up");
            pl.tweener.setUpdateType('fps').clear()
                .moveBy(0, -600, 600)
                .call(() => {
                    pl.setAnimation("down");
                })
                .wait(10)
                .call(() => {
                    pl.setAnimation("clear");
                })
                .wait(30)
                .call(() => {
                    pl.setAnimation("up");
                })
                .wait(30)
                .call(() => {
                    this.fgWhite.tweener.clear()
                        .wait(120)
                        .fadeIn(120)
                        .call(() => {
                            this.flare("ending");
                        });
                    this.fg.tweener.clear()
                        .wait(150)
                        .fadeIn(60);

                })
                .moveBy(0, -600, 600);
            var obj = this.stageController.findObject(17, 0, "enemy");
            obj.setAnimation("up");
        });

        this.add(60, function() {
            var obj = this.stageController.findObject(17, 0, "enemy");
            obj.tweener.clear().moveBy(0, -300, 300);
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
    },
});

/*
 *  stage1.js
 *  2017/01/24
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage2", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 2,

    //タイムリミット
    timeLimit: FPS*60*7,

    //BGMアセット名
    bgm: "bgm2",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage2_1");
        this.mapLayer[0] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 2", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 2) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(487, 271, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage3.js
 *  2017/03/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage3", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 3,

    //タイムリミット
    timeLimit: FPS*60*10,

    //BGMアセット名
    bgm: "bgm3",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage3_1");
        this.mapLayer[0] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage3_2");
        this.mapLayer[1] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage3_3");
        this.mapLayer[2] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 3", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 2) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(86, 272, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage4.js
 *  2017/03/08
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage4", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 4,

    //タイムリミット
    timeLimit: FPS*60*7,

    //BGMアセット名
    bgm: "bgm4",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage4_1");
        this.mapLayer[0] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage4_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 4", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(2903, 176, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage5.js
 *  2017/05/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage5", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 5,

    //タイムリミット
    timeLimit: FPS*60*8,

    //BGMアセット名
    bgm: "bgm5",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage5_1");
        this.mapLayer[0] = this.createMap(tmx);
        var tmx = phina.asset.AssetManager.get('tmx', "stage5_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 5", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        //鍵出現
        this.addEvent("key", () => {
            var kx = 1196;
            var ky = 688;
            var key = qft.Item(this.parentScene, {properties: {kind: "key"}})
                .addChildTo(this.parentScene.mapLayer.objLayer)
                .setPosition(kx, ky);
            key.vy = -5;
            this.parentScene.pauseScene = true;
            this.parentScene.centerPlayer = false;
            this.parentScene.camera.setPosition(this.parentScene.player.x, this.parentScene.player.y);
            this.parentScene.camera.tweener.clear()
                .call(function() {
                    app.playSE("holy1");
                })
                .moveTo(kx, ky, 30, "easeInOutSine")
                .wait(30)
                .call(function() {
                    this.parentScene.pauseScene = false;
                    this.moveFrom.x = kx;
                    this.moveFrom.y = ky;
                    this.moveRaio = 0;
                    this.moveLerp = true;
                    this.moveToPlayer = true;
                }.bind(this.parentScene.camera))
                .to({moveRatio: 1}, 30, "easeInOutSine")
                .call(function() {
                    this.parentScene.centerPlayer = true;
                    this.moveLerp = false;
                }.bind(this.parentScene.camera));
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(3493+18, 80+80, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },

    //ステージＢＧＭ再生
    playBGM: function() {
        app.setVolume(this.bgm, 0.5);
        app.playBGM(this.bgm);
    },
});

/*
 *  stage6.js
 *  2017/05/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ１
phina.define("qft.Stage6", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 6,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm6",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage6_1");
        this.mapLayer[0] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage6_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 6", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.bossdead1 = false;
        this.bossdead2 = false;

        //ボス１討伐
        this.addEvent("bossdead_1", () => {
            this.bossdead1 = true;
            if (this.bossdead2) this.fireEvent("key");
        });
        //ボス２討伐
        this.addEvent("bossdead_2", () => {
            this.bossdead2 = true;
            if (this.bossdead1) this.fireEvent("key");
        });

        //鍵出現
        this.addEvent("key", () => {
            var kx = 384;
            var ky = 944;
            var key = qft.Item(this.parentScene, {properties: {kind: "key"}})
                .addChildTo(this.parentScene.mapLayer.objLayer)
                .setPosition(kx, ky);
            key.vy = -5;
            this.parentScene.pauseScene = true;
            this.parentScene.centerPlayer = false;
            this.parentScene.camera.setPosition(this.parentScene.player.x, this.parentScene.player.y);
            this.parentScene.camera.tweener.clear()
                .call(function() {
                    app.playSE("holy1");
                })
                .moveTo(kx, ky, 30, "easeInOutSine")
                .wait(30)
                .call(function() {
                    this.parentScene.pauseScene = false;
                    this.moveFrom.x = kx;
                    this.moveFrom.y = ky;
                    this.moveRaio = 0;
                    this.moveLerp = true;
                    this.moveToPlayer = true;
                }.bind(this.parentScene.camera))
                .to({moveRatio: 1}, 30, "easeInOutSine")
                .call(function() {
                    this.parentScene.centerPlayer = true;
                    this.moveLerp = false;
                }.bind(this.parentScene.camera));
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 3) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(119 + 18　, 448 + 80, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage7.js
 *  2017/07/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ7
phina.define("qft.Stage7", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 6,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm7",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage7_1");
        this.mapLayer[0] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage7_2");
        this.mapLayer[1] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage7_3");
        this.mapLayer[2] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 7", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(182 + 18, 208 + 80, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage8.js
 *  2017/07/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ8
phina.define("qft.Stage8", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 8,

    //タイムリミット
    timeLimit: FPS*60*8,

    //BGMアセット名
    bgm: "bgm8",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage8_1");
        this.mapLayer[0] = this.createMap(tmx);

        var tmx = phina.asset.AssetManager.get('tmx', "stage8_2");
        this.mapLayer[1] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 8", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        //鍵出現
        this.addEvent("key", () => {
            var kx = 670;
            var ky = 853;
            var key = qft.Item(this.parentScene, {properties: {kind: "key"}})
                .addChildTo(this.parentScene.mapLayer.objLayer)
                .setPosition(kx, ky);
            key.vy = -5;
            this.parentScene.pauseScene = true;
            this.parentScene.centerPlayer = false;
            this.parentScene.camera.setPosition(this.parentScene.player.x, this.parentScene.player.y);
            this.parentScene.camera.tweener.clear()
                .call(function() {
                    app.playSE("holy1");
                })
                .moveTo(kx, ky, 30, "easeInOutSine")
                .wait(30)
                .call(function() {
                    this.parentScene.pauseScene = false;
                    this.moveFrom.x = kx;
                    this.moveFrom.y = ky;
                    this.moveRaio = 0;
                    this.moveLerp = true;
                    this.moveToPlayer = true;
                }.bind(this.parentScene.camera))
                .to({moveRatio: 1}, 30, "easeInOutSine")
                .call(function() {
                    this.parentScene.centerPlayer = true;
                    this.moveLerp = false;
                }.bind(this.parentScene.camera));
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
//        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("walk");
                pl.tweener.clear()
                    .moveTo(784+16, 304-16, 500)
                    .call(function() {
                        pl.setAnimation("up");
                    })
                    .moveTo(784+16, -32, 5000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage9.js
 *  2017/07/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ9
phina.define("qft.Stage9", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 9,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm9",

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage9_1");
        this.mapLayer[0] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 9", 24);

            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },

    //ステージクリア条件判定
    checkStageClearCondition: function() {
        var keys = this.player.keys;
        if (keys.length < 1) return false;
        return true;
    },

    //ステージクリア処理
    stageClear: function() {
        var pl = qft.PlayerDummy("player1").addChildTo(this.parentScene.mapLayer.playerLayer).setVisible(false);
        pl.setAnimation("clear");
        this.player.tweener.clear()
            .wait(30)
            .set({alpha: 0})
            .call(function() {
                pl.setPosition(this.player.x, this.player.y).setVisible(true);
            }.bind(this))
            .wait(60)
            .call(function() {
                pl.setAnimation("up");
                pl.tweener.clear().moveTo(487, 271, 1000)
                    .call(function() {
                        pl.animation = false;
                    })
                    .fadeOut(500);
            }.bind(this));
    },
});

/*
 *  stage999.js
 *  2017/05/03
 *  @auther minimo  
 *  This Program is MIT license.
 */

//テストステージ
phina.define("qft.Stage999", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 1,

    //タイムリミット
    timeLimit: FPS*60*5,

    init: function(parentScene) {
        this.superInit(parentScene);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage999");
        this.mapLayer[0] = this.createMap(tmx);

       //初期処理
        this.add(1, function() {
            //ＢＧＭ再生
            app.playBGM("bgm1");

            //ステージ開始メッセージ投入
            this.spawnMessage("STAGE 1", 24);

            //マップ表示設定
            this.limitWidth = false;
            this.limitHeight = true;
        });
    },
});

/*
 *  stagecontroller.js
 *  2017/01/24
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ステージ制御
phina.define("qft.StageController", {
    superClass: "phina.app.Object2D",

    //ステージ番号
    stageNumber: 0,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "bgm1",

    //マップ表示設定
    limitWidth: false,
    limitHeight: true,

    parentScene: null,
    mapLayer: null,
    player: null,
    time: 0,

    //経過時間トリガイベント
    seq: null,
    index: 0,

    //マップトリガイベント
    event: null,

    //バックグラウンド設定
    isBackgroundMove: true,
    backgroundX: -320,

    //特殊ステージフラグ
    isOpening: false,
    isTutorial: false,
    isEnding: false,

    init: function(parentScene) {
        this.superInit();

        this.parentScene = parentScene;
        this.mapLayer = [];
        this.player = parentScene.player;

        this.seq = [];
        this.event = [];
    },

    //時間イベント追加
    add: function(time, value, option) {
        this.index += time;
        this.seq[this.index] = {
            value: value,
            option: option,
        };
    },

    //時間イベント取得
    get: function(time) {
        var data = this.seq[time];
        if (data === undefined) return null;
        return data;
    },

    //マップイベント追加
    addEvent: function(id, value, option) {
        this.event[id] = {
            value: value,
            option: option,
            executed: false,
        };
    },

    //マップイベント取得
    getEvent: function(id) {
        var data = this.event[id];
        if (data === undefined) return null;
        return data;
    },

    //次にイベントが発生する時間を取得
    getNextEventTime: function(time) {
        var data = this.seq[time];
        if (data === undefined) {
            var t = time+1;
            var rt = -1;
            this.seq.some(function(val, index){
                if (index > t) {
                    rt = index;
                    return true;
                }
            },this.seq);
            return rt;
        } else {
            return time;
        }
    },

    //イベント発火
    fireEvent: function(eventName) {
        var event = this.event[eventName];
        if (event) {
            event.value.call();
            return true;
        }
        return false;
    },

    clear: function() {
        this.seq = [];
        this.index = 0;
    },

    checkStageClearCondition: function() {
        return false;
    },

    stageClear: function() {
    },

    //ステージＢＧＭ再生
    playBGM: function() {
        app.playBGM(this.bgm);
    },

    //IDからオブジェクト検索
    findObject: function(id, layerNumber, layerName) {
        layerNumber = layerNumber || 0;
        layerName = layerName || "object";
        var result = null;
        switch (layerName) {
            case "object":
                this.mapLayer[layerNumber].objLayer.children.forEach(function(e) {
                    if (e.id == id) result = e;
                }.bind(this));
                break;
            case "enemy":
                this.mapLayer[layerNumber].enemyLayer.children.forEach(function(e) {
                    if (e.id == id) result = e;
                }.bind(this));
                break;
        }
        return result;
    },

    //tmxからマップレイヤを作成する
    createMap: function(tmx) {
        //マップレイヤ
        var mapLayer = phina.display.DisplayElement();

        //マップ画像用レイヤ
        mapLayer.mapImageLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //地形判定用レイヤ
        mapLayer.collisionLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //バックグラウンドレイヤ
        mapLayer.backgroundLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //オブジェクト管理レイヤ
        mapLayer.objLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //影表示レイヤ
        mapLayer.shadowLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //敵キャラクタ管理レイヤ
        mapLayer.enemyLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //プレイヤー表示レイヤ
        mapLayer.playerLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //エフェクト管理レイヤ
        mapLayer.effectLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //フォアグラウンドレイヤ
        mapLayer.foregroundLayer = phina.display.DisplayElement().addChildTo(mapLayer);

        //マップ画像取得
        var mapImage = tmx.getImage("map", "background", "background2", "background3");
        mapLayer.map = phina.display.Sprite(mapImage).addChildTo(mapLayer.mapImageLayer).setOrigin(0, 0);

        //フォアグラウンド画像
        var foreground = tmx.getImage("foreground", "foreground2", "foreground3");
        phina.display.Sprite(foreground).addChildTo(mapLayer.foregroundLayer).setOrigin(0, 0);

        //マップ当たり判定取得
        var objects = tmx.getObjectGroup("collision").objects;
        objects.forEach(function(e) {
            var width = e.width || 16;
            var height = e.height || 16;
            var c = phina.display.RectangleShape({width: width, height: height})
                .addChildTo(mapLayer.collisionLayer)
                .setPosition(e.x+width/2, e.y+height/2)
                .setVisible(DEBUG_COLLISION);
            c.on('enterframe', function() {
                this.x += this.vx;
                this.y += this.vy;
            });
            c.id = e.id;
            c.vx = 0;
            c.vy = 0;
            c.alpha = 0.3;
            c.ignore = false;
            c.friction = e.properties.friction == undefined? 0.5: e.properties.friction;
            if (e.name) c.name = e.name;
            if (e.type) c.type = e.type;
            c.$extend(e.properties);

            //常時実行スクリプト
            if (c.script) {
                var sc = "(function(app) {"+c.script+"})";
                var f = eval(sc);
                c.on('enterframe', f);
            }
            //当たり判定時実行スクリプト
            if (c.collision) {
                var sc = "(function(e, dir) {"+c.collision+"})";
                c.collisionScript = eval(sc);
            }
        }.bind(this));

        //イベント取得
        var events = tmx.getObjectGroup("event").objects;
        events.forEach(function(e) {
            var that = this;
            var x = e.x + (e.width || 16) / 2;
            var y = e.y + (e.height || 16) / 2;
            switch (e.type) {
                case "player":
                    if (e.name == "start") {
                        mapLayer.startPosition = {x: x, y: y};
                        this.player.x = x;
                        this.player.y = y;
                        this.player.scaleX = 1;
                        if (e.properties.direction == 180) this.player.scaleX = -1;
                    }
                    break;
                case "enemy":
                    if (qft.Enemy[e.name]) {
                        var enemy = qft.Enemy[e.name](this.parentScene, e.properties).addChildTo(mapLayer.enemyLayer).setPosition(x, y);
                        if (e.properties.dead) {
                            var sc = "(function(app) {"+e.properties.dead+"})";
                            var f = eval(sc);
                            enemy.on('dead', f);
                        }
                        //移動パス設定
                        if (e.properties.path) {
                            var path = null;
                            var id = e.properties.path;
                            for (var i = 0; i < events.length; i++) {
                                if (events[i].id == id) {
                                    path = events[i];
                                    break;
                                }
                            }
                            if (path) enemy.setPath(path, e.properties.loop || false);
                        }
                    } else {
                        console.warn("unknown enemy: "+e.name);
                    }
                    break;
                case "item":
                    qft.Item(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "itembox":
                    qft.ItemBox(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "door":
                    var door = qft.MapObject.Door(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    if (e.name == "clear") mapLayer.clearGate = door;
                    if (e.properties.script) {
                        var sc = "(function(app) {"+e.properties.script+"})";
                        var f = eval(sc);
                        door.on('enterframe', f);
                        door.stageController = this;
                        door.player = this.parentScene.player;
                        door.parentScene = this.parentScene;
                    }
                    break;
                case "block":
                    var block = qft.MapObject.Block(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    block.addCollision(mapLayer.collisionLayer);
                    break;
                case "floor":
                    var floor = qft.MapObject.Floor(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    floor.addCollision(mapLayer.collisionLayer);
                    if (e.properties.script) {
                        var sc = "(function(app) {"+e.properties.script+"})";
                        var f = eval(sc);
                        floor.on('enterframe', f);
                        floor.stageController = this;
                        floor.player = this.parentScene.player;
                        floor.parentScene = this.parentScene;
                    }
                    //移動パス設定
                    var path = null;
                    if (e.properties.moveType == 'path' && e.properties.path) {
                        var id = e.properties.path;
                        for (var i = 0; i < events.length; i++) {
                            if (events[i].id == id) {
                                path = events[i];
                                break;
                            }
                        }
                        if (path) {
                            floor.setPath(path.x, path.y, path.polyline, e.properties.loop);
                        }
                    }
                    break;
                case "check":
                    qft.MapObject.CheckIcon(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y).setAnimation(e.name);
                    break;
                case "message":
                    qft.MapObject.Message(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "event":
                    qft.MapObject.Event(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    break;
                case "gate":
                    var gate = qft.MapObject.Gate(this.parentScene, e).addChildTo(mapLayer.objLayer).setPosition(x, y);
                    if (e.properties.script) {
                        var sc = "(function(app) {"+e.properties.script+"})";
                        var f = eval(sc);
                        gate.on('enterframe', f);
                        gate.stageController = this;
                        gate.player = this.parentScene.player;
                        gate.parentScene = this.parentScene;
                    }
                    break;
                case "accessory":
                    var layer = e.properties.foreground? mapLayer.foregroundLayer: mapLayer.backgroundLayer;
                    switch (e.name) {
                        case "lamp":
                            qft.MapObject.Lamp(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "bonfire":
                            qft.MapObject.Bonfire(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "flame":
                            qft.MapObject.Flame(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "candle":
                            qft.MapObject.Candle(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "lanthanum":
                            qft.MapObject.Lanthanum(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        case "candlelamp":
                            qft.MapObject.CandleLamp(this.parentScene, e).addChildTo(layer).setPosition(x, y);
                            break;
                        default:
                            console.warn("unknown map accessory: "+e.name);
                    }
                    break;
                case "npc":
                    qft.MapObject.npc(this.parentScene, e).addChildTo(mapLayer.enemyLayer).setPosition(x, y);
                    break;
                case "path":
                    break;
                default:
                    console.warn("unknown map object id:[" + e.id + "] type:[" + e.type + "] name:[" + e.name + "]");
            }
        }.bind(this));
        return mapLayer;
    },
});

/*
 *  stage10.js
 *  2017/09/10
 *  @auther minimo  
 *  This Program is MIT license.
 */

//エンディングシーン
phina.define("qft.Stage10", {
    superClass: "qft.StageController",

    //ステージ番号
    stageNumber: 10,

    //タイムリミット
    timeLimit: FPS*60*5,

    //BGMアセット名
    bgm: "ending",

    //特殊ステージフラグ
    isEnding: true,

    init: function(parentScene, tmx) {
        this.superInit(parentScene, tmx);

        //マップ情報読み込み
        var tmx = phina.asset.AssetManager.get('tmx', "stage10");
        this.mapLayer[0] = this.createMap(tmx);

        //初期処理
        this.add(1, function() {
            //マップ表示設定
            this.limitWidth = true;
            this.limitHeight = true;
        });

        this.add(60, function() {
        });
    },
});

/*
 *  balloon.js
 *  2017/04/26
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Balloon", {
    superClass: "phina.display.Sprite",

    //寿命フレーム
    lifeSpan: 30,

    //アニメーション間隔
    animationInterval: 6,


    init: function(options) {
        this.superInit("balloon", 24, 32);

        this.pattern = options.pattern || "!";
        this.setAnimation(this.pattern);

        this.lifeSpan = options.lifeSpan || 60;
        this.animationInterval = options.animationInterval || 6;
        this.time = 0;

        //特殊パターン
        if (this.pattern == "anger2") {
            this.tweener.setUpdateType('fps').clear().by({y: -16, alpha: -1}, this.animationInterval, "easeInSine");
        }
    },

    update : function() {
        if (this.time % this.animationInterval == 0) this.frameIndex++;

        this.time++;
        if (this.time > this.lifeSpan) this.remove();
    },

    setAnimation: function(pattern) {
        switch (pattern) {
            case "...":
                this.setFrameTrimming(0, 0, 24, 128);
                break;
            case "?":
                this.setFrameTrimming(96, 32, 24, 32);
                break;
            case "!":
                this.setFrameTrimming(72, 64, 72, 32);
                break;
            case "zzz":
                this.setFrameTrimming(0, 0, 24, 32);
                break;
            case "stun":
                this.setFrameTrimming(144, 32, 48, 32);
                break;
            case "light":
                this.setFrameTrimming(144, 64, 48, 32);
                break;
            case "newtype":
                this.setFrameTrimming(144, 96, 72, 32);
                break;
            case "anger":
            case "anger1":
                this.setFrameTrimming(72, 96, 24, 32);
                break;
            case "anger2":
                this.setFrameTrimming(144, 128, 72, 32);
                break;
        }
    },
});

/*
 *  character.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Character", {
    superClass: "phina.display.DisplayElement",

    //マップオブジェクトID
    id: -1,

    //加速度
    vx: 0,
    vy: 0,

    //初期座標
    firstX: 0,
    firstY: 0,

    //重力加速度
    gravity: 0.9,

    //横移動減衰率
    friction: 0.5,

    //床移動減衰率
    floorFriction: 0.5,

    //反発係数
    rebound: 0,

    //ジャンプ中フラグ
    isJump: false,

    //スルーしたフロア
    throughFloor: null,

    //床上フラグ
    isOnFloor: false,

    //乗っているオブジェクト
    floorObject: null,

    //はしご上フラグ
    isOnLadder: false,

    //階段上フラグ
    isOnStairs: false,

    //はしご掴みフラグ
    isCatchLadder: false,

    //死亡フラグ
    isDead: false,

    //落下死亡フラグ
    isDrop: false,

    //気絶フラグ
    isStun: false,

    //操作停止時間
    stopTime: 0,

    //無敵フラグ
    isMuteki: false,

    //無敵時間
    mutekiTime: 0,

    //アニメーションフラグ
    isAnimation: true,

    //現在実行中アクション
    nowAnimation: "stand",

    //前フレーム実行アクション
    beforeAnimation: "",

    //アニメーション進行可能フラグ
    isAdvanceAnimation: true,

    //アニメーション変更検知フラグ
    isChangeAnimation: false,

    //アニメーション間隔
    animationInterval: 6,

    //地形無視
    ignoreCollision: false,

    //スクリーン内フラグ
    onScreen: false,

    //活動フラグ
    isActive: true,

    //影表示
    isShadow: false,
    shadowY: 0,

    //識別フラグ
    isPlayer: false,
    isEnemy: false,
    isItemBox: false,
    isItem: false,
    isBlock: false,
    isMapAccessory: false,

    //経過フレーム
    time: 0,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;
        this.boundingType = "rect";
        this.tweener.setUpdateType('fps');

        this.options = options || {};
        this.setupAnimation();

        this.id = options.id || -1;

        //当たり判定情報初期化
        if (!this.isMapAccessory) this.initCollision(options);

        //吹き出し
        var that = this;
        this.balloon = null;
        this.lastBalloon = "";
        this.balloonTime = 0;
        this.on('balloon', e => {
            if (this.isStun) return;
            if (this.time > this.balloonTime) this.lastBalloon = "";
            if (this.lastBalloonPattern == e.pattern && !e.force) return;
            if (this.balloon) this.balloon.remove();
            e.$safe({x: 0, y: -this.height/2-10});
            this.balloon = qft.Balloon({pattern: e.pattern, lifeSpan: e.lifeSpan, animationInterval: e.animationInterval})
                .addChildTo(this)
                .setPosition(e.x, e.y);
            this.balloon.on('removed', e => {
                that.balloon = null;
                that.flare('balloonend');
            });
            this.lastBalloonPattern = e.pattern;
            this.balloonTime = this.time + 120;
        });
        this.on('balloonerace', e => {
            if (this.balloon == null) return;
            this.balloon.remove();
            this.balloon = null;
            this.balloonTime = 0;
        });

        //気絶状態
        this.on('stun', e => {
            this.isStun = true;
            this.stopTime = e.power * 10;
            this.balloon = qft.Balloon({pattern: "stun", lifeSpan: this.stopTime})
                .addChildTo(this)
                .setPosition(0, -this.height/2-10);
            this.lastBalloon = e.pattern;
            this.balloonTime = this.time + 120;
        });

        this.on('enterframe', function(e) {
            if (this.parentScene.pauseScene) return;

            //初期座標の記録と初回フレーム処理
            if (this.time == 0) {
                this.firstX = this.x;
                this.firstY = this.y;
                this.firstFrame();
            }

            //画面内判定
            var ps = this.parentScene;
            if (ps.screenX-SC_W < this.x && this.x < ps.screenX + SC_W*2 && 
                ps.screenY-SC_H < this.y && this.y < ps.screenY + SC_H*2) {
                this.onScreen = true;
            } else {
                this.onScreen = false;
            }
            //画面外の場合は動作停止
//            if (!this.onScreen) return;

            //活動フラグ
            if (!this.isActive) return;

            this.x += this.vx;
            if (this.isOnFloor) {
                this.vx *= this.floorFriction;
            } else {
                this.vx *= this.friction;
            }

            if (this.isCatchLadder) {
                this.y += this.vy;
                this.vy = 0;
            } else {
                this.y += this.vy;
                this.vy += this.gravity;
                //落下速度上限
                if (this.vy > 20) this.vy = 20;
            }
            if (Math.abs(this.vx) < 0.01) this.vx = 0;
            if (Math.abs(this.vy) < 0.01) this.vy = 0;

            //当たり判定
            if (!this.isMapAccessory) {
                this.resetCollisionPosition();
                this.checkMapCollision();
            }

            //画面外落ち
            if (!this.isDead && this.y > this.parent.parent.map.height) this.dropDead();

            //アニメーション
            if (this.sprite && this.isAnimation && this.isAdvanceAnimation && this.time % this.animationInterval == 0) {
                this.index = (this.index+1) % this.frame[this.nowAnimation].length;
                //次フレーム番号が特殊指定の場合
                var next = this.frame[this.nowAnimation][this.index];
                if (next == "stop") {
                    //停止
                    this.index--;
                } else if (next == "remove") {
                    //リムーブ
                    this.remove();
                } else if (typeof next === "string") {
                    //指定アニメーションへ変更
                    this.setAnimation(next);
                } else {
                    this.sprite.frameIndex = next;
                }
            }

            //無敵時間処理
            if (this.mutekiTime > 0) {
                if (this.mutekiTime % 2 == 0) this.visible = !this.visible;
                this.mutekiTime--;
            } else {
                this.visible = true;
            }

            //操作停止時間
            this.stopTime--;
            if (this.stopTime < 0) this.stopTime = 0;

            //操作停止時間が終わったら気絶解除
            if (this.isStun && this.stopTime == 0) {
                this.isStun = false;
                this.flare('balloonerace');
            }

            if (this.balloon) this.balloon.scaleX = this.scaleX;

            //乗っている床の取得
            if (this.isOnFloor) {
                this.floorObject = this._collision[2].hit;
            } else {
                this.floorObject = null;
            }

            //影処理
            if (this.shadowSprite) {
                this.shadowSprite.x = this.x;
                this.shadowSprite.y = this.shadowY;
            }

            this.time++;
            this.beforeAnimation = this.nowAnimation;
        });

        this.on('added', () => {
            this.one('enterframe', () => {
                if (this.isShadow && !this.ignoreCollision) this.setupShadow();
            });
        });

        this.on('removed', () => {
            if(this.shadowSprite) this.shadowSprite.remove();
        });
    },

    //一回目のenterframeで一度だけ呼ばれる
    firstFrame: function() {
    },

    //影表示セットアップ
    setupShadow: function() {
        var that = this;
        var sc = this.width / 24;
        if (sc < 1) sc += 0.2;
        this.shadowSprite = phina.display.Sprite("shadow", 24, 8)
            .addChildTo(this.parentScene.shadowLayer)
            .setAlpha(0.5)
            .setScale(sc, 1.0);
        this.shadowSprite.update = function() {
            this.alpha = 0.5;
            if (that.alpha < 0.5) this.alpha = that.alpha;
        }
    },

    //当たり判定情報初期化
    initCollision: function(options) {
        //当り判定用（0:上 1:右 2:下 3:左）
        var w = Math.floor(this.width/4);
        var h = Math.floor(this.height/4);
        this._collision = [];
        this._collision[0] = phina.display.RectangleShape({width: w, height: 2});
        this._collision[1] = phina.display.RectangleShape({width: 2, height: h});
        this._collision[2] = phina.display.RectangleShape({width: w, height: 2});
        this._collision[3] = phina.display.RectangleShape({width: 2, height: h});
        this.collisionResult = null;

        //当たり判定チェック位置オフセット
        this.offsetCollisionX = options.offsetCollisionX || 0;
        this.offsetCollisionY = options.offsetCollisionY || 0;

        //当たり判定情報再設定
        this.setupCollision();

        //当たり判定デバッグ用
        if (DEBUG_COLLISION) {
            this.one('enterframe', e => {
                this._collision[0].addChildTo(this.parentScene.objLayer);
                this._collision[1].addChildTo(this.parentScene.objLayer);
                this._collision[2].addChildTo(this.parentScene.objLayer);
                this._collision[3].addChildTo(this.parentScene.objLayer);
                this._collision[0].alpha = 0.3;
                this._collision[1].alpha = 0.3;
                this._collision[2].alpha = 0.3;
                this._collision[3].alpha = 0.3;
                //ダメージ当たり判定表示
                var c = phina.display.RectangleShape({width: this.width, height: this.height}).addChildTo(this);
                c.alpha = 0.3;
            });
            this.one('removed', e => {
                this._collision[0].remove();
                this._collision[1].remove();
                this._collision[2].remove();
                this._collision[3].remove();
                });
        }
        return this;
    },

    //画面外落ち
    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        this.vx = 0;
        this.vy = -10;
        this.tweener.clear()
            .wait(60)
            .call(function(){
                this.flare('dead');
                this.remove();
            }.bind(this));
        return this;
    },

    //ノックバックモーション
    knockback: function(power, direction) {
        power = power || 0;
        if (power == 0) return;
        if (direction === undefined) direction = (this.direction + 180) % 360;

        var back = 32 + Math.floor(power / 10);
        var sx = Math.cos(direction.toRadian());
        var sy = Math.sin(direction.toRadian());

        //ノックバック先に壁が無いかチェック
        var chk = this.checkMapCollision2(this.x + sx * back, this.y + sy * back, 8, 8);
        if (chk) {
            //壁に当たる所までバックする
            var c = chk[0];
            switch (direction) {
                case 0:
                    back = (c.x - c.width / 2) - this.x;
                    back *= 0.8;
                    break;
                case 180:
                    back = this.x - (c.x + c.width / 2);
                    back *= 0.8;
                    break;
                default:
            }
        }

        this.tweener.clear().by({x: sx * back, y: sy * back}, 10, "easeOutElastic");
        this.vx = 0;
        this.vy = 0;
        return this;
    },

    //地形当たり判定
    checkMapCollision: function() {
        if (this.ignoreCollision) return this;

        this._collision[0].hit = null;
        this._collision[1].hit = null;
        this._collision[2].hit = null;
        this._collision[3].hit = null;

        this.isOnLadder = false;
        this.isOnStairs = false;

        if (this.onScreen && this.shadowSprite) {
            this.shadowY = 99999;
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(this.x, this.y + 128);
            this.shadowSprite.visible = false;
        }

        //地形接触判定
        this.parentScene.collisionLayer.children.forEach(e => {
            if (this.isDrop) return;
            if (e.ignore || e == this.throughFloor) return;
            if (e.type == "ladder" || e.type == "stairs") return;

            //上側
            if (this.vy < 0  && e.hitTestElement(this._collision[0])) this._collision[0].hit = e;
            //下側
            if (this.vy >= 0 && e.hitTestElement(this._collision[2])) this._collision[2].hit = e;
            //右側
            if (this.vx > 0  && e.hitTestElement(this._collision[1])) this._collision[1].hit = e;
            //左側
            if (this.vx < 0  && e.hitTestElement(this._collision[3])) this._collision[3].hit = e;

            if (this.onScreen && this.shadowSprite) {
                //キャラクターの下方向にレイを飛ばして直下の地面座標を取る
                var x = e.x - e.width / 2;
                var y = e.y - e.height / 2;
                var p3 = phina.geom.Vector2(x, y);
                var p4 = phina.geom.Vector2(x + e.width, y);
                if (y < this.shadowY && phina.geom.Collision.testLineLine(p1, p2, p3, p4)) {
                    this.shadowSprite.setPosition(this.x, y);
                    this.shadowSprite.visible = true;
                    this.shadowY = y;
                }
            }
        });

        if (this.isCatchLadder) this.shadowSprite.visible = false;

        //当たり判定結果反映
        this.collisionProcess();

        //はしごのみ判定
        this.parentScene.collisionLayer.children.forEach(e => {
            //梯子判定
            if (e.type == "ladder" || e.type == "stairs") {
                if (this.ladderCollision && e.hitTestElement(this.ladderCollision)) {
                    this.isOnLadder = true;
                    this.isOnStairs = (e.type == "stairs");
                }
                return;
            }
        });
        return this;
    },

    //当たり判定結果反映処理
    collisionProcess: function() {
        var w = Math.floor(this.width/2)+6;
        var h = Math.floor(this.height/2)+6;
        this.isOnFloor = false;

        //上側接触
        if (this._collision[0].hit && !this.isCatchLadder) {
            var ret = this._collision[0].hit;
            this.y = ret.y+ret.height*(1-ret.originY)+h;
            this.vy = 0;
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 0);
            }
        }
        //下側接触
        if (this._collision[2].hit && !this.isCatchLadder) {
            var ret = this._collision[2].hit;
            this.y = ret.y-ret.height*ret.originY-h;
            this.x += ret.vx || 0;
            if (!this.isPlayer && ret.vy > 0) this.y += ret.vy || 0;

            this.isJump = false;
            this.isOnFloor = true;
            this.floorFriction = ret.friction == undefined? 0.5: ret.friction;

            this.throughFloor = null;
            if (this.rebound > 0) {
                this.isJump = true;
                this.vy = -this.vy * this.rebound;
            } else {
                this.vy = 0;
            }
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 2);
            }
        }
        //右側接触
        if (this._collision[1].hit && !this.isCatchLadder) {
            var ret = this._collision[1].hit;
            this.x = ret.x-ret.width*ret.originX-w;
            this.vx = 0;
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 1);
            }
        }
        //左側接触
        if (this._collision[3].hit && !this.isCatchLadder) {
            var ret = this._collision[3].hit;
            this.x = ret.x+ret.width*(1-ret.originX)+w;
            this.vx = 0;
            this.resetCollisionPosition();
            if (ret.collisionScript) {
                ret.collisionScript(this, 3);
            }
        }
        return this;
    },

    //地形当たり判定（特定地点チェックのみ）衝突したものを配列で返す
    checkMapCollision2: function(x, y, width, height) {
        x = x || this.x;
        y = y || this.y;
        width = width || 1;
        height = height || 1;
        var c = phina.display.DisplayElement({width: width, height: height}).setPosition(x, y);
        var ret = null;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.type == "ladder" || e.type == "stairs") return;
            if (e.hitTestElement(c)) {
                if (ret == null) ret = [];
                ret.push(e);
            }
        });
        return ret;
    },

    //キャラクタ同士当たり判定（ブロックのみ）
    checkCharacterCollision: function() {
        if (this.ignoreCollision) return;
        if (this.isDrop) return;

        var ret = [];
        var that = this;
        this.parentScene.objLayer.children.forEach(function(e) {
            if (!e.isBlock) return;
            if (e.isDead) return;

            //上側
            if (that.vy < 0 && e.hitTestElement(that._collision[0])) {
                that.y = e.y+e.height*(1-e.originY)+16;
                that.vy = 1;
                ret[0] = e;
                that.resetCollisionPosition();
            }
            //下側
            if (that.vy > 0 && e.hitTestElement(that._collision[2])) {
                that.y = e.y-e.height*e.originY-16;
                that.vx = e.vx;
                that.vy = 0;
                that.isJump = false;
                that.isOnFloor = true;
                that.throughFloor = null;
                ret[2] = e;
                if (that.rebound > 0) {
                    that.isJump = true;
                    that.vy = -that.vy * that.rebound;
                } else {
                    that.vy = 0;
                }
                that.resetCollisionPosition();
            }
            //右側
            if (that.vx > 0 && e.hitTestElement(that._collision[1])) {
                that.x = e.x-e.width*e.originX-10;
                that.vx = 0;
                ret[1] = e;
                that.resetCollisionPosition();
            }
            //左側
            if (that.vx < 0 && e.hitTestElement(that._collision[3])) {
                that.x = e.x+e.width*(1-e.originX)+10;
                that.vx = 0;
                ret[3] = e;
                that.resetCollisionPosition();
            }
        });
        return ret;
    },

    //当たり判定用エレメントの再設定
    setupCollision: function() {
        return this;
    },

    //当たり判定用エレメントの位置再セット
    resetCollisionPosition: function() {
        var w = Math.floor(this.width/2) + 6 + this.offsetCollisionX;
        var h = Math.floor(this.height/2)+ 6 + this.offsetCollisionY;
        this._collision[0].setPosition(this.x, this.y - h);
        this._collision[1].setPosition(this.x + w, this.y);
        this._collision[2].setPosition(this.x, this.y + h);
        this._collision[3].setPosition(this.x - w, this.y);
        return this;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [0, "stop"];
        this.frame["walk"] = [0];
        this.frame["up"] =   [0];
        this.frame["down"] = [0];
        this.frame["attack"] = [0, "stop"];
        this.index = 0;
        return this;
    },

    setAnimation: function(animName) {
        if (!this.frame[animName]) return;
        if (animName == this.nowAnimation) return;
        this.nowAnimation = animName;
        this.index = -1;
        this.isChangeAnimation = true;
        return this;
    },

    //プレイヤーからの直線距離
    getDistancePlayer: function() {
        var x = this.x-this.parentScene.player.x;
        var y = this.y-this.parentScene.player.y;
        return Math.sqrt(x*x+y*y);
    },

    //オブジェクト間の直線距離
    getDistance: function(element) {
        var x = this.x - element.x;
        var y = this.y - element.y;
        return Math.sqrt(x*x+y*y);
    },

    //自分と他エレメントを結ぶ直線の角度（弧度法）
    getAngle: function(element) {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(element.x, element.y);
        var p = p2.sub(p1);
        return p.toDegree();
    },

    //自分と他エレメントを結ぶ直線の角度（ラジアン）
    getAngleRadian: function(element) {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(element.x, element.y);
        var p = p2.sub(p1);
        return p.toAngle();
    },

    //物理現象情報のみオブジェクトで取得
    getPhysics: function() {
        return {
            vx: this.vx,
            vy: this.vy,
            gravity: this.gravity,
            friction: this.friction,
            rebound: this.rebound,
        };
    },

    //移動パスの設定
    setPath: function(path, loop) {
        this.path = [];
        this.loop = loop;

        //パス情報の作成
        var sum = 0;
        var ptb = null;
        for (var i = 0; i < path.polyline.length; i++) {
            var pt = phina.geom.Vector2(path.x + path.polyline[i].x, path.y + path.polyline[i].y);
            if (i > 0) {
                sum += Math.floor(ptb.distance(pt));
            }
            pt.time = sum;
            this.path.push(pt);
            ptb = pt;
        }

        //ループ有り指定の場合、始点の座標を終点に加える
        if (loop) {
            var end = phina.geom.Vector2(path.x + path.polyline[path.polyline.length - 1].x, path.y + path.polyline[path.polyline.length - 1].y);
            var start = phina.geom.Vector2(path.x + path.polyline[0].x, path.y + path.polyline[0].y);
            sum += Math.floor(start.distance(end));
            start.time = sum;
            this.path.push(start);
        }
        this.path.maxTime = sum;

        return this;
    },

    //パス座標の取得
    getPathPosition: function(time) {
        if (!this.path || time < 0) return null;
        time %= this.path.maxTime;

        var len = this.path.length;
        for (var i = 0; i < len; i++) {
            var p = this.path[i];
            if (time == p.time) return p;
            if (time < p.time) {
                var p2 = this.path[i - 1];
                var t = (time - p2.time) / (p.time - p2.time);
                return phina.geom.Vector2.lerp(p2, p, t);
            }
        }
        return null;
    },
});

/*
 *  effect.js
 *  2017/01/12
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Effect", {
    superClass: "phina.display.DisplayElement",

    //インデックス更新間隔
    interval: 2,

    //現在インデックス
    index: 0,

    //開始インデックス
    startIndex: 0,

    //最大インデックス
    maxIndex: 8,

    //アニメーション進行可能フラグ   
    isAdvanceAnimation: true,

    //経過フレーム
    time: 0,

    defaultOptions: {
        name: "explode",
        assetName: "effect",
        loop: false,
        position: {x: 0, y: 0},
        origin: {x: 0.5, y: 0.5},
        rotation: 0,
        alpha: 1.0,
        scale: {x: 1.0, y: 1.0},
        blendMode: "source-over",
    },

    init: function(parentScene, options) {
        this.superInit();

        this.options = (options || {}).$safe(this.defaultOptions);
        this.options.$extend(qft.EffectData.get(this.options.name));
        this.setup();

        this.on('enterframe', function() {
            this.time++;
            if (this.time % this.interval == 0 && this.isAdvanceAnimation) {
                this.sprite.frameIndex++;
                if (this.sprite.frameIndex == 0 || this.sprite.frameIndex == this.maxIndex) {
                    if (this.options.loop) {
                        this.sprite.frameIndex = this.startIndex;
                    } else {
                        this.remove();
                    }
                    this.flare('animationend');
                }
            }
        });
    },

    setup: function() {
        var op = this.options;
        this.sprite = phina.display.Sprite(op.assetName, op.width, op.height)
            .setPosition(op.position.x, op.position.y)
            .setOrigin(op.origin.x, op.origin.y)
            .setScale(op.scale.x, op.scale.y)
            .setRotation(op.rotation)
            .addChildTo(this);
        if (op.trimming) {
            var t = op.trimming;
            this.sprite.setFrameTrimming(t.x, t.y, t.width, t.height);
        }
        this.startIndex = op.startIndex;
        this.maxIndex = op.maxIndex;
        this.sprite.alpha = op.alpha;
        this.sprite.frameIndex = this.startIndex;
    },
});

phina.define("qft.EffectData", {
    _static: {
        get: function(name) {
            switch (name) {
                case "explode_small":
                    return {
                        width: 16,
                        height: 16,
                        interval: 2,
                        startIndex: 8,
                        maxIndex: 15,
                        trimming: {x: 256, y: 256, width: 128, height: 32},
                    };
                case "explode_small2":
                    return {
                        width: 16,
                        height: 16,
                        interval: 4,
                        startIndex: 0,
                        maxIndex: 7,
                        trimming: {x: 256, y: 256, width: 128, height: 32},
                    };
                case "explode":
                    return {
                        width: 64,
                        height: 64,
                        interval: 1,
                        startIndex: 0,
                        maxIndex: 8,
                        trimming: {x: 0, y: 0, width: 512, height: 128},
                    };
                case "explode_large":
                    return {
                        width: 48,
                        height: 48,
                        interval: 4,
                        startIndex: 0,
                        maxIndex: 7,
                        trimming: {x: 0, y: 0, width: 512, height: 128},
                    };
                case "explode_ground":
                    return {
                        width: 32,
                        height: 48,
                        interval: 4,
                        startIndex: 0,
                        maxIndex: 7,
                        trimming: {x: 256, y: 192, width: 256, height: 48},
                    };
                case "smoke_small":
                    return {
                        width: 16,
                        height: 16,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 4,
                        trimming: {x: 128, y: 128, width: 64, height: 16},
                    };
                case "smoke":
                    return {
                        width: 24,
                        height: 24,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 5,
                        trimming: {x: 128, y: 160, width: 120, height: 24},
                    };
                case "smoke_large":
                    return {
                        width: 32,
                        height: 32,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 8,
                        trimming: {x: 256, y: 128, width: 128, height: 64},
                    };
                case "hit":
                    return {
                        assetName: "effect2",
                        width: 72,
                        height: 32,
                        interval: 5,
                        startIndex: 0,
                        maxIndex: 3,
                        trimming: {x: 0, y: 0, width: 72, height: 128},
                    };
                default:
                    return {};
            }
        }
    }
});

/*
 *  enemy.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//敵キャラクタ基本クラス
phina.define("qft.Enemy", {
    superClass: "qft.Character",

    //識別フラグ
    isEnemy: true,

    //レベル
    level: 0,

    //ヒットポイント
    hp: 10,

    //防御力
    deffence: 1,

    //攻撃力
    power: 0,

    //移動速度
    speed: 1,

    //気絶確率
    stunPower: 1,

    //視力
    eyesight: 0,

    //視野角
    viewAngle: 90,

    //進行方向（0:右 180:左 270:上 90:下）
    direction: 0,

    //ポイント
    point: 0,

    //攻撃当たり判定有効フラグ
    isEnableAttackCollision: true,

    //スーパーアーマー状態フラグ
    isSuperArmor: false,

    //影表示フラグ
    isShadow: true,

    //属性ダメージ倍率
    damageSlash: 1,
    damageSting: 1,
    damageBlow: 1,
    damageArrow: 1,
    damageFire: 1,
    damageIce: 1,
    damageHoly: 1,
    damageDark: 1,

    //アイテムドロップ率（％）
    dropRate: 0,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 0,
    rareDropItem: ITEM_BAG,

    //行動パターン用
    chaseTime: 0,
    turnTime: 0,
    stopTime: 0,
    turnCount: 0,

    init: function(parentScene, options) {
        options = options || {};
        this.superInit(parentScene, options);
        this.setupAnimation();
        this.options = options;
        this.level = options.level || 0;
        this.territory = options.territory;

        //デバッグ時視界の可視化
        if (DEBUG_EYESIGHT) {
            var that = this;
            var va = (this.viewAngle / 2).toRadian();
            phina.display.ArcShape({radius: this.eyesight, startAngle: -va, endAngle: va}).addChildTo(this).setAlpha(0.3);
        }

        this.on('enterframe', function() {
            if (this.parentScene.pauseScene) return;
            //画面外の場合は動作停止
            if (!this.onScreen) return;

            var pl = this.parentScene.player;

            //向きの指定
            if (this.vx != 0) {
                if (this.vx > 0) {
                    this.scaleX = 1;
                } else {
                    this.scaleX = -1;
                }
            }

            //ステージクリアの場合は当たり判定無し
            if (this.parentScene.isStageClear) return;

            //気絶中はアニメーションしない
            if (this.isStun) {
                this.isAdvanceAnimation = false;
            } else {
                this.isAdvanceAnimation = true;
            }

            //被ダメージ当たり判定
            if (!this.isMuteki && this.mutekiTime == 0) {
                //プレイヤー攻撃との当たり判定
                if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                    this.damage(pl.attackCollision);
                }
                //プレイヤーショットとの当たり判定
                this.parentScene.playerLayer.children.forEach(function(e) {
                    if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                        e.hit(this);
                        e.remove();
                        this.damage(e);
                    }
                }.bind(this));
            }

            //プレイヤーとの当たり判定
            if (this.isEnableAttackCollision && this.mutekiTime == 0) {
                if (!this.isDead && !pl.isDead && this.power > 0 && this.hitTestElement(pl)) {
                    this.hit();
                    pl.damage(this);
                }
            }

            if (this.stopTime == 0) {
                this.algorithm();
                if (this.chaseTime > 0) this.chaseTime--;
                if (this.turnTime > 0) this.turnTime--;
            }
        });

        this.on('dead', function() {
            //確定ドロップアイテム
            if (this.options.item) {
                var i = this.parentScene.spawnItem(this.x, this.y, {kind: this.options.item});
                i.vy = -5;
                if (this.options.item == "key") {
                    i.isEnemyDrop = false;
                } else {
                    i.isEnemyDrop = true;
                }
                this.remove();
                return;
            }
            //レアアイテムドロップ判定
            var dice = Math.randint(1, 100);
            if (dice <= this.rareDropRate) {
                var i = this.parentScene.spawnItem(this.x, this.y, {kind: this.rareDropItem});
                i.vy = -5;
                i.isEnemyDrop = true;
            } else {
                //通常アイテムドロップ判定
                var dice = Math.randint(1, 100);
                if (dice <= this.dropRate) {
                    var i = this.parentScene.spawnItem(this.x, this.y, {kind: this.dropItem});
                    i.vy = -5;
                    i.isEnemyDrop = true;
                }
            }
            this.remove();
        });
    },

    algorithm: function() {
    },

    damage: function(target) {
        if (this.mutekiTime > 0) return false;
        if (this.isMuteki) return false;

        //気絶キャンセル
        this.isStun = false;

        var dir = 0;
        if (target instanceof qft.PlayerAttack) {
            if (target.scaleX == 1) dir = 0; else dir = 180;
        } else {
            if (this.x > target.x) dir = 0; else dir = 180;
        }

        var power = target.power;
        if (target.isSlash) power *= this.damageSlash;
        if (target.isSting) power *= this.damageSting;
        if (target.isBlow) power *= this.damageBlow;
        if (target.isArrow) power *= this.damageArrow;
        if (target.isFire) power *= this.damageFire;
        if (target.isIce) power *= this.damageIce;
        if (target.isHoly) power *= this.damageHoly;
        if (target.isDark) power *= this.damageDark;
        power = Math.floor(power);
        if (!this.isSuperArmor) this.knockback(power, dir);
        this.mutekiTime = 10;
        this.hp -= power;
        if (this.hp <= 0) {
            this.hp = 0;
            this.parentScene.totalScore += this.point;
            this.parentScene.totalKill++;
            this.flare('dead');
        } else {
            this.flare('damaged', {direction: dir});

            //気絶判定
            var dice = Math.randint(1, 100);
            if (dice <= target.stunPower) this.flare('stun', {power: target.power});
        }
        app.playSE("hit");
        return true;
    },

    //プレイヤーが見える位置にいるのか判定
    isLookPlayer: function() {
        //視力外の場合は見えない
        if (this.getDistancePlayer() > this.eyesight) return false;

        //視野角外の場合は見えない
        if (this.viewAngle != 360) {
            //プレイヤーとの角度（右が360度）
            var angle = Math.floor(this.getPlayerAngle());

            //視界範囲内の判定
            if (this.direction == 0) {
                var va = this.viewAngle / 2;
                if (!(360-va < angle || angle < va)) return false;
            } else {
                var dir = this.direction;
                var va = this.viewAngle / 2;
                if (!(dir-va < angle && angle < dir+va)) return false;
            }
        }

        var result = true;
        var that = this;
        var player = this.parentScene.player;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.type == "ladder" || this.type == "stairs") return;
            //自分とプレイヤー間に遮蔽物（地形当り判定）がある場合見えない
            if (phina.geom.Collision.testRectLine(e, that, player)) {
                result = false;
            }
        });
        return result;
    },

    //自分とプレイヤーを結ぶ直線の角度（弧度法）
    getPlayerAngle: function() {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(this.parentScene.player.x, this.parentScene.player.y);
        var p = p2.sub(p1);
        return p.toDegree();
    },

    //自分とプレイヤーを結ぶ直線の角度（ラジアン）
    getPlayerRadian: function() {
        var p1 = phina.geom.Vector2(this.x, this.y);
        var p2 = phina.geom.Vector2(this.parentScene.player.x, this.parentScene.player.y);
        var p = p2.sub(p1);
        return p.toAngle();
    },

    //体力ゲージ設置
    setupLifeGauge: function() {
        var that = this;
        //体力ゲージ
        var options = {
            width:  32,
            height: 2,
            backgroundColor: 'transparent',
            fill: 'red',
            stroke: 'white',
            strokeWidth: 1,
            gaugeColor: 'lime',
            cornerRadius: 0,
            value: this.hp,
            maxValue: this.hp,
        };
        this.lifeGauge = phina.ui.Gauge(options).addChildTo(this).setPosition(0, 0);
        this.lifeGauge.update = function() {
            this.visible = (that.hp != this.maxValue);
            this.value = that.hp;
            this.rotation = -that.rotation;
            this.scaleX = that.scaleX;

            if (this.dispTime > 150) this.visible = false;
            if (this.beforeValue == this.value) this.dispTime++; else this.dispTime = 0;
            this.beforeValue = this.value;
        };
        this.lifeGauge.dispTime = 0;
    },

    hit: function() {
    },

    //汎用往復アルゴリズム（陸上）
    roundtripAlgorithm_ground: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //テリトリー指定
            if (!look && this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }

        if (this.isOnFloor || this.isJump) {
            this.vx =  this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        }
    },

    //汎用往復アルゴリズム（空中）
    roundtripAlgorithm_flying: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        var chk1 = 1;
        var chk2 = 3;
        if (this.vertical) {
            chk1 = 0;
            chk2 = 2;
        }
        //壁に当たったら折り返す
        var turn = false;
        if (this._collision[chk1].hit || this._collision[chk2].hit) turn = true;

        //テリトリー指定
        if (!look && this.territory) {
            if (this.vertical) {
                //垂直方向チェック
                var ty = this.y - this.firstY;
                if (Math.abs(ty) > this.territory) {
                    if (ty > 0) {
                        this.direction = 270;
                    } else {
                        this.direction = 90;
                    }
                }
            } else {
                //水平方向チェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }
    },

    //汎用追跡アルゴリズム
    chaseAlgorithm: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
                this.firstX = this.x;
                this.firstY = this.y;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) {
            this.chaseTime = 0;
            this.firstX = this.x;
            this.firstY = this.y;
        }

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
            if (this.isJump) this.vx *= 1;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }

        if (this.isOnFloor) {
            //テリトリー指定
            if (this.chaseTime == 0 && this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }

            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        }
                    }

                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+32, this.y+32, 16, 96)) {jumpOk = true; this.vy = -7;}
                            if (this.checkMapCollision2(this.x+32, this.y-32, 16, 96)) {jumpOk = true; this.vy = -10;}
                        } else {
                            if (this.checkMapCollision2(this.x-32, this.y+32, 16, 96)) {jumpOk = true; this.vy = -7;}
                            if (this.checkMapCollision2(this.x-32, this.y-32, 16, 96)) {jumpOk = true; this.vy = -10;}
                        }
                        if (jumpOk) {
                            this.isJump = true;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 45;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                            this.firstX = this.x;
                            this.firstY = this.y;
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                }
            }
        }

        if (this.chaseTime == 30) {
            this.flare('balloon', {pattern: "?"});
            this.firstX = this.x;
            this.firstY = this.y;
        }
    },

    //評価関数
    evaluate: function(dis, look) {
        var pl = this.parentScene.player;
        if (dis === undefined) dis = this.getDistancePlayer();
        if (look === undefined) look = this.isLookPlayer();

        //脅威度
        var threat = 0;

        //プレイヤーとの距離により脅威度を加算
        if (dis < 256) threat += 10
        if (dis < 128) threat += 20

        //プレイヤー視認可能状態
        if (look) threat += 30;

        //プレイヤー行動状態
        var playerAction = "";
        if (pl.x == pl.before.x && pl.y == pl.before.y) {
            //プレイヤーは移動していない
        } else {
            //プレイヤー進行方向（右:0 左:180）
            var pldir = 0;
            if (pl.x < pl.before.x) pldir = 180;
            if (this.x < pl.x) {
                if (prdir == 0) {
                    //プレイヤーは近づいている
                } else {
                    //プレイヤーは離れている
                }
            } else {
                if (prdir == 180) {
                    //プレイヤーは近づいている
                } else {
                    //プレイヤーは離れている
                }
            }
        }

        return {
            threat: threat,
            playerAction: playerAction,
        };
    },
});

//敵攻撃判定
phina.define("qft.EnemyAttack", {
    superClass: "phina.display.RectangleShape",

    //攻撃力
    power: 1,

    //有効フラグ
    isActive: true,

    //寿命
    lifeSpan: 15,

    init: function(parentScene, options) {
        options = (options || {}).$safe({width: 32, height: 32});
        this.superInit(options);
        this.parentScene = parentScene;

        this.$extend(options);
        this.time = 0;

        this.on('enterframe', e => {
            this.time++;
            if (this.time > this.lifeSpan) {
                this.remove();
                return;
            }
            if (!this.isActive) return;
            var pl = this.parentScene.player;

            //プレイヤー攻撃と当たった場合はエフェクトを出して無効化
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                this.isActice = false;
                this.bump();
                return;
            }

            //プレイヤーショットとの当たり判定
            this.parentScene.playerLayer.children.forEach(function(e) {
                if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                    e.snap(this);
                    e.isCollision = false;
                }
            }.bind(this));

            //プレイヤーとの当たり判定
            if (!pl.isDead && this.hitTestElement(pl)) {
                pl.damage(this);
            }
        });

        if (DEBUG_COLLISION) {
            phina.display.RectangleShape({width: this.width, height: this.height}).addChildTo(this).setAlpha(0.5);
        }
    },

    //判定同士がぶつかった場合の処理
    bump: function() {
        this.parentScene.spawnEffect(this.x, this.y, {name: "hit"});
        if (this.master) {
            var pl = this.parentScene.player;
            pl.knockback(5, this.master.direction);
            this.master.knockback(5, (this.master.direction + 180) % 360);
            app.playSE("tinkling");
        }
    },
});

/*
 *  item.js
 *  2017/01/04
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アイテムクラス
phina.define("qft.Item", {
    superClass: "qft.Character",

    //識別フラグ
    isItem: true,

    //アイテム種別
    kind: 0,

    //アイテムレベル
    level: 0,

    //捨てアイテム
    throwAway: false,

    //大まかな種別フラグ
    isWeapon: false,
    isEquip: false,
    isFood: false,
    isItem: false,
    isKey: false,

    //敵ドロップアイテムフラグ
    isEnemyDrop: false,

    //アイテム情報
    status: null,

    //反発係数
    rebound: 0.3,

    //アニメーション進行可能フラグ   
    isAdvanceAnimation: false,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 16, height: 16});

        //アイテムレベル
        this.level = 0;
        this.kind = null;
        if (options.properties) {
            this.level = options.properties.level || 0;
            this.kind = options.properties.kind;
        }
        if (options.kind !== undefined) this.kind = options.kind;

        //アイテム種別
        if (this.kind == null) {
            if (options.name == "food") {
                this.kind = ITEM_APPLE + this.level;
            } else {
                var name = "ITEM_"+options.name.toUpperCase();
                this.kind = eval(name);
            }
        } else if (typeof this.kind === "string") {
            var name = "ITEM_"+this.kind.toUpperCase();
            this.kind = eval(name);
        }

        //アイテムステータス取得
        this.$extend(qft.ItemInfo.get(this.kind));

        //アイテムスプライト
        if (this.isWeapon) {
            //武器の場合
            var index = this.kind * 10 + Math.min(this.level, this.maxIndex);
            this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(index);

            if (this.level > 0) {
                //強化レベル表示
                var labelParam = {
                    fill: "white",
                    stroke: "black",
                    strokeWidth: 2,

                    fontFamily: "Orbitron",
                    align: "center",
                    baseline: "middle",
                    fontSize: 10,
                    fontWeight: ''
                };
                phina.display.Label({text: "+"+this.level}.$safe(labelParam)).setPosition(6, 6).addChildTo(this);
            }
        } else {
            this.sprite = phina.display.Sprite("item", 24, 24).addChildTo(this).setFrameIndex(this.kind);
        }

        //寿命
        this.lifeSpan = 150;

        //アクティブフラグ
        if (this.options.active === undefined || this.options.active == true) {
            this.isActive = true;
        } else {
            this.isActive = false;
        }

        this.on('enterframe', e => {
            //プレイヤーとの当たり判定
            var pl = this.parentScene.player;
            if (this.hitTestElement(pl)) {
                if (this.time > 10 && !this.throwAway) {
                    pl.getItem(this);
                    this.remove();
                }
            } else if (this.time > 30 && this.throwAway) this.throwAway = false;

            if (this.isEnemyDrop) {
                if (this.lifeSpan == 0) this.remove();
                if (this.lifeSpan < 30) {
                    if (this.time % 2 == 0) this.visible = !this.visible;
                } else if (this.lifeSpan < 60){
                    if (this.time % 5 == 0) this.visible = !this.visible;
                } else if (this.lifeSpan < 90) {
                    if (this.time % 10 == 0) this.visible = !this.visible;
                }
                this.lifeSpan--;
            }
        });
    },
});

phina.define("qft.ItemInfo", {
    _static: {
        get: function(kind) {
            switch (kind) {
                case "shortsword":
                case ITEM_SHORTSWORD:
                    return {
                        name: "SHORT SWORD",
                        type: "sword",
                        isWeapon: true,
                        isSlash: true,
                        power: 10,
                        stunPower: 1,
                        maxIndex: 0,
                        collision: {
                            width: 14,
                            height: 30
                        }
                    };
                case "longsword":
                case ITEM_LONGSWORD:
                    return {
                        name: "LONG SWORD",
                        type: "sword",
                        isWeapon: true,
                        isSlash: true,
                        power: 15,
                        stunPower: 5,
                        maxIndex: 7,
                        collision: {
                            width: 24,
                            height: 25
                        }
                    };
                case "ax":
                case ITEM_AX:
                    return {
                        name: "AX",
                        type: "ax",
                        isWeapon: true,
                        isSlash: true,
                        isBrow: true,
                        power: 20,
                        stunPower: 20,
                        maxIndex: 4,
                        collision: {
                            width: 14,
                            height: 26
                        }
                    };
                case "spear":
                case ITEM_SPEAR:
                    return {
                        name: "SPEAR",
                        type: "spear",
                        isWeapon: true,
                        isSting: true,
                        power: 10,
                        stunPower: 1,
                        maxIndex: 4,
                        collision: {
                            width: 39,
                            height: 10
                        }
                    };
                case "bow":
                case ITEM_BOW:
                    return {
                        name: "BOW",
                        type: "bow",
                        isWeapon: true,
                        isBrow: true,
                        power: 5,
                        stunPower: 5,
                        maxIndex: 0,
                        collision: {
                            width: 20,
                            height: 10
                        }
                    };
                case "rod":
                case ITEM_ROD:
                    return {
                        name: "MAGIC ROD",
                        type: "rod",
                        isWeapon: true,
                        isBrow: true,
                        isFire: true,
                        power: 5,
                        stunPower: 10,
                        maxIndex: 7,
                        collision: {
                            width: 20,
                            height: 10
                        }
                    };
                case "book":
                case ITEM_BOOK:
                    return {
                        name: "BOOK",
                        type: "book",
                        isWeapon: true,
                        isBrow: true,
                        isHoly: true,
                        power: 10,
                        stunPower: 40,
                        maxIndex: 0,
                        collision: {
                            width: 20,
                            height: 20
                        }
                    };
                case "shield":
                case ITEM_SHIELD:
                    return {
                        name: "SHIELD",
                        type: "equip",
                        isEquip: true,
                        power: 20,
                        point: 1000,
                    };
                case "armor":
                case ITEM_ARMOR:
                    return {
                        name: "ARMOR",
                        type: "equip",
                        isEquip: true,
                        power: 30,
                        point: 5000,
                    };
                case "hat":
                case ITEM_HAT:
                    return {
                        name: "HAT",
                        type: "equip",
                        isEquip: true,
                        power: 10,
                        point: 300,
                    };
                case "boots":
                case ITEM_BOOTS:
                    return {
                        name: "BOOTS",
                        type: "equip",
                        isEquip: true,
                        power: 10,
                        point: 500,
                    };
                case "grove":
                case ITEM_GROVE:
                    return {
                        name: "GROVE",
                        type: "equip",
                        isEquip: true,
                        power: 10,
                        point: 500,
                    };
                case "ring":
                case ITEM_RING:
                    return {
                        name: "RING",
                        type: "equip",
                        isEquip: true,
                        power: 20,
                        point: 3000,
                    };
                case "scroll":
                case ITEM_SCROLL:
                    return {
                        name: "SCROLL",
                        type: "item",
                        isItem: true,
                        point: 1000,
                    };
                case "letter":
                case ITEM_LETTER:
                    return {
                        name: "LETTER",
                        type: "item",
                        isItem: true,
                        point: 100,
                    };
                case "card":
                case ITEM_CARD:
                    return {
                        name: "CARD",
                        type: "item",
                        isItem: true,
                        point: 1000,
                    };
                case "key":
                case ITEM_KEY:
                    return {
                        name: "KEY",
                        type: "key",
                        isKey: true,
                        point: 2000,
                    };
                case "coin":
                case ITEM_COIN:
                    return {
                        name: "COIN",
                        type: "item",
                        isItem: true,
                        point: 500,
                    };
                case "bag":
                case ITEM_BAG:
                    return {
                        name: "BAG",
                        type: "item",
                        isItem: true,
                        point: 1000,
                    };
                case "orb":
                case ITEM_ORB:
                    return {
                        name: "ORB",
                        type: "item",
                        isItem: true,
                        point: 5000,
                    };
                case "stone":
                case ITEM_STONE:
                    return {
                        name: "STONE",
                        type: "item",
                        isItem: true,
                        point: 2000,
                    };
                case "jewel":
                case ITEM_JEWEL:
                    return {
                        name: "JEWEL",
                        type: "item",
                        isItem: true,
                        point: 5000,
                    };
                case "jewelbox":
                case ITEM_JEWELBOX:
                    return {
                        name: "JEWELBOX",
                        type: "item",
                        isItem: true,
                        point: 10000,
                    };
                case "apple":
                case ITEM_APPLE:
                    return {
                        name: "APPLE",
                        type: "food",
                        isFood: true,
                        power: 20,
                    };
                case "harb":
                case ITEM_HARB:
                    return {
                        name: "HARB",
                        type: "food",
                        isFood: true,
                        power: 40,
                    };
                case "meat":
                case ITEM_MEAT:
                    return {
                        name: "MEAT",
                        type: "food",
                        isFood: true,
                        power: 60,
                    };
                case "potion":
                case ITEM_POTION:
                    return {
                        name: "POTION",
                        type: "food",
                        isFood: true,
                        power: 100,
                    };
                default:
                    return {};
            }
        },
    },
});


/*
 *  itembox.js
 *  2017/01/04
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アイテムボックスクラス
phina.define("qft.ItemBox", {
    superClass: "qft.Character",

    //識別フラグ
    isItemBox: true,

    //耐久力
    hp: 1,

    //開いたフラグ
    opened: false,

    //アイテム種別
    kind: 0,

    //アニメーション間隔
    animationInterval: 3,

    //反発係数
    rebound: 0.3,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 26, height: 26}.$safe(options.properties));

        //アイテムボックススプライト
        this.sprite = phina.display.Sprite("itembox", 32, 32)
            .addChildTo(this)
            .setScale(0.8)
            .setFrameIndex(0);
        this.sprite.tweener.setUpdateType('fps');

        this.setAnimation("close");

        //内容物
        this.name = options.name;
        this.kind = options.properties? options.properties.kind: undefined;
        this.level = options.properties? options.properties.level: 0;
    },

    update: function() {
        if (!this.opened) {
            //プレイヤー攻撃（固定）との当たり判定
            var pl = this.parentScene.player;
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                this.damage(pl);
            }
            //プレイヤー攻撃判定との当たり判定
            this.parentScene.playerLayer.children.forEach(function(e) {
                if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                    e.remove();
                    this.damage(e);
                }
            }.bind(this));
        }
        this.visible = true;    //点滅キャンセル
    },

    damage: function(target) {
        if (this.opened) return;
        this.hp -= target.power;
        this.mutekiTime = 10;
        if (this.hp <= 0) {
            this.open();
        }
        if (this.x < target.x) {
            this.sprite.tweener.clear().moveBy(-5, 0, 2).moveBy(5, 0, 2);
        } else {
            this.sprite.tweener.clear().moveBy(5, 0, 2).moveBy(-5, 0, 2);
        }
    },

    open: function() {
        this.isAdvanceAnimation = true;
        this.opened = true;
        this.setAnimation("open");
        switch (this.name) {
            case "empty":
                break;
            case "item":
                this.tweener.clear()
                    .wait(10)
                    .call(function() {
                        var options = {
                            kind: this.kind,
                            properties: {
                                level: this.level
                            }
                        };
                        var i = this.parentScene.spawnItem(this.x, this.y, options);
                        i.vy = -5;
                    }.bind(this));
                break;
            default:
                this.tweener.clear()
                    .wait(10)
                    .call(function() {
                        var options = {
                            name: this.name,
                            properties: {
                                level: this.level
                            }
                        };
                        var i = this.parentScene.spawnItem(this.x, this.y, options);
                        i.vy = -5;
                    }.bind(this));
                break;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        if (this.options.color == "gold") {
            this.frame["close"] = [2];
            this.frame["open"] = [2, 6, 8, "stop"];
        } else if (this.options.color == "red") {
            this.frame["close"] = [1];
            this.frame["open"] = [1, 4, 7, "stop"];
        } else if (this.options.color == "blue") {
            this.frame["close"] = [0];
            this.frame["open"] = [0, 3, 6, "stop"];
        } else {
            this.frame["close"] = [1];
            this.frame["open"] = [1, 4, 7, "stop"];
        }
        this.index = 0;
    },
});

/*
 *  mapobject.js
 *  2017/01/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//チェックアイコン
phina.define("qft.MapObject.CheckIcon", {
    superClass: "qft.Character",

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 3,

    //地形無視
    ignoreCollision: true,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 36, height: 64});
        this.$safe(options);

        //スプライト
        this.sprite = phina.display.Sprite("checkicon", 32, 32).addChildTo(this);
        this.setAnimation("up");
        this.animationInterval = 10;
    },

    update: function(e) {
    },

    setupAnimation: function(options) {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["in"] = [2, 1, 0];
        this.frame["up"] = [5, 4, 3];
        this.frame["down"] = [8, 7, 6];
        this.frame["out"] = [11, 10, 9];
        this.index = 0;
    },
});

//メッセージ表示
phina.define("qft.MapObject.Message", {
    superClass: "phina.display.DisplayElement",

    //オブジェクトID
    id: null,

    //一回のみ表示フラグ
    once: false,

    //表示済みフラグ
    alreadyRead: false,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;
        this.id = options.id;
        this.once = options.properties.once || false;
        this.text = options.properties.text || "TEST";
    },

    update: function(e) {
        //プレイヤーとの当たり判定
        var pl = this.parentScene.player;
        var hit = this.hitTestElement(pl);
        if (hit && !this.alreadyRead) {
            this.parentScene.spawnEventMessage(this.id, this.text);
            this.alreadyRead = true;

            //一回のみの場合はリムーブ
            if (this.once) this.remove();
        }

        //判定を外れたら表示済みフラグを外す
        if (!hit && this.alreadyRead) this.alreadyRead = false;
    },
});

//イベント
phina.define("qft.MapObject.Event", {
    superClass: "phina.display.DisplayElement",

    //オブジェクトID
    id: null,

    //一回のみ表示フラグ
    once: false,

    //実行済みフラグ
    already: false,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;
        this.id = options.id;
        this.once = options.properties.once || false;
        this.properties = options.properties;
    },

    update: function(e) {
        //プレイヤーとの当たり判定
        var pl = this.parentScene.player;
        var hit = this.hitTestElement(pl);
        if (hit && !this.alreadyRead) {
            this.parentScene.spawnEventMessage(this.id, this.text);
            this.already = true;

            //一回のみの場合はリムーブ
            if (this.once) this.remove();
        }

        //判定を外れたら実行済みフラグを外す
        if (!hit && this.already) this.alreadyRead = false;
    },
});

/*
 *  player.js
 *  2016/12/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Player", {
    superClass: "qft.Character",

    //識別フラグ
    isPlayer: true,

    //最大ヒットポイント
    hpMax: 100,

    //ヒットポイント
    hp: 100,

    //攻撃力
    power: 10,

    //気絶確率
    stunPower: 1,

    //防御力
    defense: 10,

    //移動速度
    speed: 5,

    //登坂速度
    speedAscend: 4,

    //下押し連続フレーム数
    downFrame: 0,

    //多段ジャンプ可能回数
    numJump: 0,
    numJumpMax: 1,

    //所持装備アイテム
    equip: null,

    //アイテム所持最大数
    maxItem: 10,

    //所持アイテム
    items: null,

    //所持クリア条件キー
    keys: null,

    //操作可能フラグ
    isControl: true,

    //攻撃中フラグ
    isAttack: false,

    //防御中フラグ
    isDefense: false,

    //ドア上フラグ
    isOnDoor: false,

    //ダミー表示スプライト
    dummy: null,

    //影表示フラグ
    isShadow: true,

    //オートパイロット
    isAuto: false,
    autoKey: {
        up: false,
        right: false,
        down: false,
        left: false,
        attack: false,
        jump: false,
    },

    //前フレームの情報
    before: {
        //操作系
        up: false,
        down: false,
        attack: false,
        jump: false,
        change: false,
        isStun: false,
        isOnFloor: false,
        x: 0,
        y: 0,
    },

    //ステージ開始時ステータス
    startStatus: null,

    init: function(parentScene) {
        this.superInit(parentScene, {width: 16, height: 20});
        var that = this;

        //スプライト背後
        this.back = phina.display.DisplayElement().addChildTo(this).setScale(-1, 1);

        //表示用スプライト
        this.sprite = phina.display.Sprite("player1", 32, 32).addChildTo(this).setFrameIndex(0);
        this.sprite.scaleX = -1;

        //武器用スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this.back)
            .setFrameIndex(0)
            .setOrigin(1, 1)
            .setPosition(3, 3);
        this.weapon.alpha = 0;
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.type = "sword";

        //盾
        this.shield = phina.display.Sprite("item", 24, 24)
//            .addChildTo(this)
            .setFrameIndex(7)
            .setPosition(10, 6)
            .setScale(0.8)
            .setVisible(false);

        //攻撃判定用
        this.attackCollision = phina.display.RectangleShape({width: 14, height: 26});
        //当たり判定デバッグ用
        if (DEBUG_COLLISION) {
            this.one('enterframe', e => {
                this.attackCollision.addChildTo(this.parentScene.playerLayer);
                this.attackCollision.alpha = 0.3;
            });
            this.on('removed', e => {
                this.attackCollision.remove();
            });
        }

        //プレイヤー情報の初期化
        this.reset();

        //はしご判定用
        this.ladderCollision = phina.display.RectangleShape({width: 16, height: 20});

        //初期アニメーション設定
        this.setAnimation("walk");
        this.beforeAnimation = "";

        //死亡時コールバック
        this.on('dead', function(e) {
            this.parentScene.flare('gameover');
        });

        //ステージ開始時ステータス
        this.saveStatus();

        //最後に床上にいた場所を保存
        this.lastOnFloorX = 0;
        this.lastOnFloorY = 0;
    },

    update: function(app) {
        if (this.parentScene.pauseScene) return;

        //オブジェクトレイヤー接触判定
        this.isOnDoor = null;
        this.parentScene.objLayer.children.forEach(function(e) {
            //扉判定
            if (e instanceof qft.MapObject.Door || e instanceof qft.MapObject.Gate) {
                if (e.hitTestElement(this)) {
                    this.isOnDoor = e;
                    return;
                }
            }
        }.bind(this));

        //死亡時は何も出来ない
        if (this.isDead) {
            //マップ外落下
            if (this.isDrop) {
                this.hp = 0;
                this.setAnimation("drop");
            }
            return;
        }

//        this.shield.setVisible(false);
//        this.isDefense = false;

        //プレイヤー操作
        var ct = app.controller;
        //バーチャルパッド情報取得
        var vp = app.virtualPad;
        if (vp.getKey("up")) ct.up = true;
        if (vp.getKey("right")) ct.right = true;
        if (vp.getKey("down")) ct.down = true;
        if (vp.getKey("left")) ct.left = true;
        if (vp.getKey("Z")) ct.attack = true;
        if (vp.getKey("X")) ct.jump = true;

        //オートパイロット
        if (this.isAuto) {
            ct = this.autoKey;
        }

        if (!this.isControl) ct = {};
        if (this.stopTime == 0) {
            //左移動
            if (ct.left && !ct.down) {
                if (!this.isJump && !this.isAttack && !this.isCatchLadder) this.setAnimation("walk");
                //はしご掴み状態で左に壁がある場合は不可
                var c = this._collision[3];
                if (!(this.isCatchLadder && this.checkMapCollision2(c.x+6, c.y, c.width, c.height))) {
                    this.scaleX = -1;
                    this.vx = -this.speed;
                }
            }
            //右移動
            if (ct.right && !ct.down) {
                if (!this.isJump && !this.isAttack && !this.isCatchLadder) this.setAnimation("walk");
                //はしご掴み状態で右に壁がある場合は不可
                var c = this._collision[1];
                if (!(this.isCatchLadder && this.checkMapCollision2(c.x-6, c.y, c.width, c.height))) {
                    this.scaleX = 1;
                    this.vx = this.speed;
                }
            }

            //頭上足元はしご検知
            var headLadder = this.checkHeadLadder();
            var footLadder = this.checkFootLadder();

            //はしご掴み状態で操作分岐
            if (this.isCatchLadder) {
                if (ct.up) {
                    this.vx = 0;
                    this.vy = -this.speedAscend;
                    var c = this._collision[0];
                    if (!headLadder && this.checkMapCollision2(c.x, c.y-6, c.width, c.height)) {
                        this.vy = 0;
                    }
                }
                if (ct.down) {
                    this.vx = 0;
                    this.vy = this.speedAscend;
                }
            } else {
                //ジャンプボタンのみ
                if (ct.jump && !ct.up) {
                    //ジャンプ二段目以降
                    if (this.isJump && this.numJump < this.numJumpMax && this.vy > -5) {
                        this.vy = -11;
                        this.numJump++;
                    }
                    //ジャンプ
                    var chk = this.checkMapCollision2(this.x, this.y-16, 5, 3);
                    if (!this.isJump && this.isOnFloor && !chk) {
                        this.setAnimation("jump");
                        this.isJump = true;
                        this.vy = -11;
                        this.numJump = 1;
                    }
                }
                //上キー押下
                if (ct.up) {
                    //ジャンプ二段目以降
                    if (this.isJump && this.numJump < this.numJumpMax && this.vy > -5) {
                        this.vy = -11;
                        this.numJump++;
                    }
                    //ジャンプ
                    var chk = this.checkMapCollision2(this.x, this.y-16, 5, 3);
                    if (!this.isJump && this.isOnFloor && !this.isOnLadder && !chk) {
                        this.setAnimation("jump");
                        this.isJump = true;
                        this.vy = -11;
                        this.numJump = 1;
                    }
                    //はしごを昇る（階段は接地時のみ）
                    if (this.isOnLadder && !this.isOnStairs || this.isOnFloor && this.isOnStairs) {
                        this.setAnimation("up");
                        this.vx = 0;
                        this.vy = 0;
                        this.isCatchLadder = true;
                        this.throughFloor = null;
                    }
                    //扉に入る（接地時＆左右キーオフ時のみ）
                    if (!ct.left && !ct.right && this.isOnFloor && this.isOnDoor && !this.isOnDoor.isLock && !this.isOnDoor.already) {
                        this.vx = 0;
                        this.vy = 0;
                        this.isOnDoor.flare('enterdoor');
                        this.isOnDoor.already = false;
                    }
                }
                //下キー押下
                if (ct.down) {
                    //はしごを降りる
                    if (footLadder) {
                        this.setAnimation("up");
                        this.vx = 0;
                        this.vy = 0;
                        this.isCatchLadder = true;
                        this.throughFloor = null;
                    }
                    //床スルー
                    if (this.downFrame > 6 && !this.jump && !footLadder) {
                        if (this.isOnFloor && !this.throughFloor) {
                            var floor = this.checkMapCollision2(this.x, this.y+16, 5, 5);
                            if (floor && floor[0].enableThrough) this.throughFloor = floor[0];
                        }
                    }
                    //盾を構える
                    if (!this.isAttack) {
//                        this.shield.setVisible(true);
//                        this.isDefense = true;
//                        this.setAnimation("defense");
                    }
                }
            }

        }

        //はしごから外れたら梯子掴み状態キャンセル
        if (this.isCatchLadder) {
            if (!this.isOnLadder && !ct.down || this.isOnLadder && !footLadder && !ct.up) {
                this.isCatchLadder = false;
            }
        }

        //攻撃
        if (!this.isAttack) {
            if (this.isOnFloor) {
                if (this.nowAnimation != "damage" && !this.isDefense) this.setAnimation("walk");
            } else if (this.isCatchLadder) {
                if (ct.up) {
                    this.setAnimation("up");
                } else if (ct.down) {
                    if (this.isOnStairs) {
                        this.setAnimation("down");
                    } else {
                        this.setAnimation("up");
                    }
                }
            } else {
                if (!this.isStun && !this.isDead) this.setAnimation("jump");
            }
            if (ct.attack && !this.before.attack && this.stopTime == 0 && !(this.isCatchLadder && this.isOnLadder)) {
                this.isCatchLadder = false;
                this.setAnimation("attack");
                this.weaponAttack();
            }

            //武器の変更
            if (ct.change && !this.before.change && this.equip.switchOk) {
                this.switchWeapon();
            }
        }

        //気絶状態
        if (this.isStun) {
            this.setAnimation("stun");

            //梯子掴みキャンセル
            this.isCatchLadder = false;

            //レバガチャで気絶復帰を早める
            if (ct.left && !ct.before.left ||
                ct.right && !ct.before.right ||
                ct.up && !ct.before.up ||
                ct.down && !ct.before.down) this.stopTime -= 2;
        } else if (this.before.isStun) {
            //気絶復帰したらアニメーションを標準に
            this.setAnimation("stand");
        }

        //死亡状態
        if (this.isDead) {
            this.setAnimation("dead");
            this.isCatchLadder = false;
        }

        //アニメーション変更を検知
        if (this.nowAnimation != this.beforeAnimation) {
            this.time = 0;
            this.isAdvanceAnimation = true;
            this.animationInterval = 6;
            if (this.nowAnimation == "attack") this.animationInterval = 2;
            if (this.nowAnimation == "defense") this.animationInterval = 1;
        } else {
            //歩行アニメーションの場合は移動している時のみ進める
            if (this.nowAnimation == "walk" && !ct.left && !ct.right) {
                this.isAdvanceAnimation = false;
            } else {
                this.isAdvanceAnimation = true;
            }
            if (this.nowAnimation == "up" || this.nowAnimation == "down") {
                if (ct.up || ct.down || ct.left || ct.right) {
                    this.isAdvanceAnimation = true;
                } else {
                    this.isAdvanceAnimation = false;
                }
            }
        }

        //攻撃判定追従
        this.attackCollision.x = this.x + this.scaleX * 12;
        this.attackCollision.y = this.y;

        //コントローラ他情報保存
        this.before.up = ct.up;
        this.before.down = ct.down;
        this.before.attack = ct.attack;
        this.before.jump = ct.up || ct.jump;
        this.before.change = ct.change;
        this.before.isStun = this.isStun;
        this.before.inOnFloor = this.isOnFloor;
        this.before.x = this.x;
        this.before.y = this.y;

        //ダウンキー連続押下フレームカウント
        if (this.isOnFloor && !this.isCatchLadder && ct.down && !ct.right && !ct.left && !ct.up && !ct.attack) {
            this.downFrame++;
        } else {
            this.downFrame = 0;
        }

        //接地時座標保存
        if (this.isOnFloor && this._collision[2].hit.type != "movefloor") {
            this.lastOnFloorX = this.x;
            this.lastOnFloorY = this.y;
        }
    },

    //プレイヤー情報リセット
    reset: function() {
        //移動情報
        this.vx = 0;
        this.vy = 0;

        //ステータス
        this.hp = this.hpMax;

        //各種フラグ
        this.isJump = false;
        this.isDead = false;
        this.isCatchLadder = false;
        this.isDrop = false;
        this.isOnFloor = false;
        this.isAdvanceAnimation = true;
        this.ignoreCollision = false;

        //経過時間系
        this.mutekiTime = 0;
        this.stopTime = 0;
        this.downFrame = 0;
        this.time = 0;

        //アニメーション
        this.setAnimation("walk");
        this.beforeAnimation = "";
        this.animationInterval = 6;

        //所持装備
        this.equip = {
            using: 0,         //現在使用中（weaponsのindex）
            weapons: [0],     //所持リスト（最大３）
            level: [0],       //武器レベル
            switchOk: true,   //変更可能フラグ
        };

        //武器セット
        this.setWeapon(this.equip.weapons[this.equip.using]);

        //所持アイテム
        this.items = [];

        //所持クリア条件キー
        this.keys = [];

        //操作可能フラグ
        this.isControl = true;

        //多段ジャンプ最大回数
        this.numJumpMax = 0;

        //ダミースプライト除去
        if (this.dummy) {
            this.dummy.remove();
            this.dummy = null;
        }

        return this;
    },

    //プレイヤー情報コンティニュー用リセット
    continueReset: function() {
        //移動情報
        this.vx = 0;
        this.vy = 0;

        //ステータス
        this.hp = this.hpMax;

        //各種フラグ
        this.isJump = false;
        this.isDead = false;
        this.isCatchLadder = false;
        this.isDrop = false;
        this.isOnFloor = false;
        this.isAdvanceAnimation = true;
        this.ignoreCollision = false;

        //経過時間系
        this.mutekiTime = 0;
        this.stopTime = 0;
        this.downFrame = 0;
        this.time = 0;

        //アニメーション
        this.setAnimation("walk");
        this.beforeAnimation = "";
        this.animationInterval = 6;

        //操作可能フラグ
        this.isControl = true;

        //多段ジャンプ最大回数
        this.numJumpMax = 0;

        //ダミースプライト除去
        if (this.dummy) {
            this.dummy.remove();
            this.dummy = null;
        }
        this.sprite.visible = true;

        return this;
    },

    //ダメージ処理
    damage: function(target) {
        if (this.mutekiTime > 0) return false;
        if (target.power == 0) return false;
        if (this.isDead) return false;
        if (this.isMuteki) return false;

        //気絶キャンセル
        this.isStun = false;

        var dir = 0;
        if (this.x < target.x) dir = 180;
        if (!this.isCatchLadder) this.knockback(target.power, dir);

        this.hp -= target.power;
        this.isCatchLadder = false;
        app.playSE("damage");

        if (this.hp <= 0) {
            this.dead();
        } else {
            this.mutekiTime = 60;
            this.stopTime = 15;
            if (this.nowAnimation != "jump") this.setAnimation("damage");

            //気絶判定
            var dice = Math.randint(1, 100);
            if (dice <= target.stunPower) {
                this.flare('stun', {power: 10});
                this.setAnimation("stun");
            }
        }
        return true;
    },

    //死亡時処理
    dead: function() {
        this.hp = 0;
        this.isDead = true;
        this.isCatchLadder = false;
        this.vx = 0;
        this.vy = -6;
        var tw = phina.accessory.Tweener().attachTo(this).setUpdateType('fps');
        tw.clear()
            .wait(60)
            .call(function(){
                this.flare('dead');
                tw.remove();
            }.bind(this));

        //ダミースプライト追加
        this.sprite.visible = false;
        this.dummy = qft.PlayerDummy("player1").addChildTo(this).setAnimation("dead");
    },

    //アイテム取得
    getItem: function(item) {
        //武器
        if (item.isWeapon) {
            //既に持っている武器かチェック
            var index = this.equip.weapons.findIndex(function(e, i, a) {
                return e == item.kind;
            });
            if (index == null || index == -1) {
                //持って無い武器だった場合
                if (this.equip.weapons.length < 3) {
                    //リストに追加
                    this.equip.weapons.push(item.kind);
                    this.equip.level.push(item.level);
                } else {
                    //現在使用武器の手前の武器を捨てる
                    var dropIndex = this.equip.using == 0? 2: this.equip.using - 1;
                    var options = {
                        properties: {
                            kind: this.equip.weapons[dropIndex],
                            level: this.equip.level[dropIndex],
                        },
                    };
                    var drop = this.parentScene.spawnItem(this.x, this.y, options);
                    drop.friction = 0.8;
                    drop.vx = 0 * -this.scaleX;
                    drop.vy = -5;
                    drop.throwAway = true;
                    this.equip.weapons[dropIndex] = item.kind;
                    this.equip.level[dropIndex] = item.level;
                }
            } else {
                //所持武器を拾ったらその武器のレベルが上がる
                this.equip.level[index]++;
                var id = this.equip.weapons[this.equip.using];
                var lv = this.equip.level[this.equip.using];
                this.setWeapon(id, lv);
            }
            app.playSE("getitem");
        }
        //装備品
        if (item.isEquip) {
            this.hpMax += (item.power || 0);
            this.hp += (item.power || 0);
            if (this.hpMax > 200) this.hpMax = 200;
            if (this.hp > this.hpMax) this.hp = this.hpMax;
            this.parentScene.totalScore += (item.point || 0);
            app.playSE("getitem");
        }
        //食べ物
        if (item.isFood) {
            //ステージ進度によって回復量が増加
            var power = item.power;
            if (this.parentScene.stageNumber > 4) power *= 1.5;
            this.hp += power;
            app.playSE("recovery");
            if (this.hp > this.hpMax) this.hp = this.hpMax;
            this.parentScene.totalScore += (item.point || 0);
        }
        //鍵
        if (item.isKey) {
            this.keys.push(item);
            app.playSE("getkeyitem");
            this.parentScene.flare('getkey', {key: item});
            this.parentScene.totalScore += (item.point || 0);
        }
        //得点アイテム
        if (item.isItem) {
            this.parentScene.totalScore += (item.point || 0);
            app.playSE("getitem");
        }
        return this;
    },

    //使用武器の変更
    switchWeapon: function() {
        //手持ちの武器が一個の場合は何もしない
        if (this.equip.weapons.length < 2) return;

        this.equip.switchOk = false;

        var rot = 120;
        if (this.equip.weapons.length == 2 && this.equip.using == 1) rot = 240;
        this.parentScene.playerWeapon.tweener.clear()
            .by({rotation: rot}, 300)
            .call(function() {
                this.equip.switchOk = true;
            }.bind(this));

        //現在使用武器設定
        this.equip.using = (this.equip.using + 1) % this.equip.weapons.length;
        var id = this.equip.weapons[this.equip.using];
        var lv = this.equip.level[this.equip.using];
        this.setWeapon(id, lv);

        app.playSE("select");
    },

    //武器変更
    setWeapon: function(kind, level) {
        kind = kind || 0;
        level = level || 0;

        //属性初期化
        this.attackCollision.$extend({
            isSlash: false,
            isSting: false,
            isBlow: false,
            isArrow: false,
            isFire: false,
            isIce: false,
            stunPower: 1,
        });

        //アイテム情報取得
        var spec = qft.ItemInfo.get(kind);
        this.attackCollision.$extend(spec);
        this.attackCollision.power += level * (spec.levelBonus || 2);

        switch (kind) {
            case 0:
                //ショートソード
                level = 0;
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
            case 1:
                //ロングソード
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
            case 2:
                //斧
                this.frame["attack"] = [ 44, 44, 44, 43, 43, 43, 42, 42, 42, 41, 41, 41, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
            case 3:
                //槍
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(0, 0);
                break;
            case 4:
                //弓
                level = 0;
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(0, 0);
                break;
            case 5:
                //魔法の杖
                this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
                this.weapon.setPosition(0, 0);
                break;
            case 6:
                //魔導書
                this.frame["attack"] = [ 44, 44, 44, 43, 43, 43, 42, 42, 42, 41, 41, 41, "stop"];
                this.weapon.setPosition(-3, 3);
                break;
        }

        //武器画像設定
        var index = kind * 10 + Math.min(level, spec.maxIndex);
        this.weapon.setFrameIndex(index);

        return this;
    },

    //装備武器により攻撃モーションを変える
    weaponAttack: function() {
        var kind = this.equip.weapons[this.equip.using];
        var level = this.equip.level[this.equip.using];
        this.isAttack = true;
        var that = this;
        switch (kind) {
            case 0:
                //ショートソード
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 200, alpha: 1.0})
                    .to({rotation: 360}, 5)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 1:
                //ロングソード
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 200, alpha: 1.0})
                    .to({rotation: 360}, 6)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 2:
                //斧
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 400, alpha: 1.0})
                    .to({rotation: 270}, 8)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 3:
                //槍
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: -45, alpha: 1.0})
                    .by({x: -10}, 2)
                    .by({x: 10}, 2)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
            case 4:
                //弓
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: -45, alpha: 1.0})
                    .by({x: 7}, 3)
                    .by({x: -7}, 3)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                    var arrowPower = 5 + level * 2;
                    var arrow = qft.PlayerAttack(this.parentScene, {width: 15, height: 10, power: arrowPower, type: "arrow"})
                        .addChildTo(this.parentScene.playerLayer)
                        .setScale(this.scaleX, 1)
                        .setPosition(this.x, this.y);
                    arrow.tweener.setUpdateType('fps').clear()
                        .by({x: (150 + level * 5) * this.scaleX}, 7)
                        .call(function() {
                            this.remove();
                        }.bind(arrow));
                break;
            case 5:
                //魔法の杖
                app.playSE("bomb");
                this.weapon.tweener.clear()
                    .set({rotation: 200, alpha: 1.0})
                    .to({rotation: 360}, 8)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                var magicPower = 15 + level * 2;
                for (var i = 0; i < 6; i++) {
                    var magic = qft.PlayerAttack(this.parentScene, {width: 15, height: 10, index: 30, power: magicPower, type: "flame"})
                        .addChildTo(this.parentScene.playerLayer)
                        .setScale(this.scaleX, 1);
                    magic.rad = (90 - i * 30).toRadian();
                    magic.isCollision = false;
                    magic.visible = false;
                    magic.tweener.setUpdateType('fps').clear()
                        .wait(i)
                        .call(function() {
                            this.isCollision = true;
                            this.visible = true;
                            var mx = Math.cos(this.rad) * that.scaleX;
                            var my = Math.sin(this.rad);
                            this.setPosition(that.x + 32 * mx, that.y + 32 * my);
                        }.bind(magic))
                        .wait(8)
                        .call(function() {
                            this.remove();
                        }.bind(magic));
                }
                break;
            case 6:
                //魔導書
                app.playSE("attack");
                this.weapon.tweener.clear()
                    .set({rotation: 400, alpha: 1.0})
                    .to({rotation: 270}, 8)
                    .fadeOut(1)
                    .call(function() {
                        that.isAttack = false;
                    });
                break;
        }
        return this;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [36, "stop"];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
        this.frame["defense"] = [ 41, 42, 43, 44, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["drop"] = [18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.frame["clear"] = [24, 25, 26];
        this.frame["stun"] = [ 18, 19, 20];
        this.index = 0;
        return this;
    },

    //当たり判定用エレメントの位置再セット
    resetCollisionPosition: function() {
        var w = Math.floor(this.width/2)+6;
        var h = Math.floor(this.height/2)+6;
        this._collision[0].setPosition(this.x, this.y - h);
        this._collision[1].setPosition(this.x + w, this.y - 5);
        this._collision[2].setPosition(this.x, this.y + h);
        this._collision[3].setPosition(this.x - w, this.y - 5);
        this.ladderCollision.setPosition(this.x, this.y);
        return this;
    },

    //頭上はしごチェック
    checkHeadLadder: function() {
        var h = Math.floor(this.height/2)+10;
        var c = phina.display.DisplayElement({width: 16, height: 2}).setPosition(this.x, this.y-h);
        var ret = null;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.hitTestElement(c)) {
                if (e.type == "ladder" || e.type == "stairs") ret = e;
            }
        }.bind(this));
        return ret;
    },

    //足下はしごチェック
    checkFootLadder: function() {
        var h = Math.floor(this.height/2)+10;
        var c = phina.display.DisplayElement({width: 16, height: 2}).setPosition(this.x, this.y+h);
        var ret = null;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.hitTestElement(c)) {
                if (e.type == "ladder" || e.type == "stairs") ret = e;
            }
        }.bind(this));
        return ret;
    },

    //現在ステータス保存
    saveStatus: function() {
        //所持武器、アイテム等ステータスの取得
        var eq = this.equip;
        var equip = {
            using: 0,
            weapons: eq.weapons.concat(),
            level: eq.level.concat(),
            switchOk: true,
        };
        var items = this.items.concat();
        var numJumpMax = this.numJumpMax;

        this.startStatus = {
            hpMax: this.hpMax,
            hp: this.hp,
            power: this.power,
            defense: this.defense,
            equip: equip,
            items: items,
            numJumpMax: numJumpMax,
        };
    },

    //ステータス復元
    restoreStatus: function() {
        var ss = this.startStatus;
        this.hpMax = ss.hpMax;
        this.hp = ss.hp;
        this.power = ss.power;
        this.defense = ss.defense;
        this.equip = {
            using: 0,
            weapons: ss.equip.weapons.concat(),
            level: ss.equip.level.concat(),
            switchOk: true,
        }
        if (ss.items) {
            this.items = ss.items.concat();
        } else {
            this.item = [];
        }
        this.numJumpMax = ss.numJumpMax;

        var id = this.equip.weapons[this.equip.using];
        var lv = this.equip.level[this.equip.using];
        this.setWeapon(id, lv);
    },
});

//プレイヤー攻撃判定
phina.define("qft.PlayerAttack", {
    superClass: "phina.display.DisplayElement",

    //攻撃力
    power: 1,

    //当たり判定発生フラグ
    isCollision: true,

    //属性
    isSlash: false,
    isSting: false,
    isBlow: false,
    isArrow: false,
    isFire: false,
    isIce: false,

    init: function(parentScene, options) {
        this.superInit(options);
        this.parentScene = parentScene;

        this.type = options.type || "arrow";
        this.power = options.power || 0;
        this.time = 0;
        this.index = 0;

        //表示スプライト
        switch (this.type) {
            case "arrow":
                this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(1);
                this.frame = [1];
                this.isArrow = true;
                this.isSting = true;
                this.stunPower = 10;
                break;
            case "fireball":
                this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(9);
                this.frame = [9, 10, 11, 10];
                this.isFire = true;
                break;
            case "masakari":
                this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(20);
                this.frame = [20];
                this.isSlash = true;
                this.isBrow = true;
                this.stunPower = 50;
                break;
            case "dagger":
                this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(20);
                this.sprite.rotation = 135;
                this.frame = [0];
                this.isSting = true;
                this.stunPower = 1;
                break;
            case "flame":
                this.sprite = phina.display.Sprite("effect", 48, 48)
                    .addChildTo(this)
                    .setFrameTrimming(0, 192, 192, 96)
                    .setScale(0.5);
                this.frame = [0, 1, 2, 3, 4, 5, 6, 7, 8];
                this.isFire = true;
                this.stunPower = 1;
                break;
        }

        if (DEBUG_COLLISION) {
            phina.display.RectangleShape({width: this.width, height: this.height}).addChildTo(this).setAlpha(0.5);
        }
    },

    update: function(app) {
        if (!this.isCollision || this.type == "explode") return;

        if (this.time % 3 == 0) {
            this.sprite.setFrameIndex(this.frame[this.index]);
            this.index = (this.index + 1) % this.frame.length;
        }
        if (this.type == "flame") return;

        //地形接触判定
        var that = this;
        this.parentScene.collisionLayer.children.forEach(function(e) {
            if (e.type == "ladder" || e.type == "stairs") return;
            if (this.hitTestElement(e)) {
                this.isCollision = false;
                switch (this.type) {
                    case "arrow":
                        this.stick(e);
                        break;
                    case "fireball":
                        this.explode(e);
                        break;
                }
            }
        }.bind(this));

        this.time++;
    },

    //ヒット後処理
    hit: function(target) {
        switch (this.type) {
            case "fireball":
                this.explode(target);
                break;
        }
    },

    //刺さる
    stick: function(e) {
        //効果音
        switch (this.type) {
            case "arrow":
                app.playSE("arrowstick");
                break;
            case "masakari":
                break;
        }

        if (this.scaleX == 1) {
            this.x = e.left;
        } else {
            this.x = e.right;
        }
        this.tweener.clear()
            .wait(30)
            .call(function() {
                this.remove();
            }.bind(this));
    },

    //弾かれる
    snap: function(e) {
        //効果音
        app.playSE("tinkling");
        this.tweener.clear()
            .by({y: -92, rotation: 700}, 15, "easeOutQuad")
            .call(function() {
                this.remove();
            }.bind(this));
    },

    //爆発
    explode: function(e) {
        this.parentScene.spawnEffect(this.x, this.y);
        app.playSE("bomb");
        this.remove();
    },
});

//プレイヤーダミースプライト
phina.define("qft.PlayerDummy", {
    superClass: "phina.display.Sprite",

    init: function(assetName) {
        this.superInit(assetName, 32, 32);
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["walk_stop"] = [ 3,  4,  5,  4, "stop"];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["up_stop"] =   [10, "stop"];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["clear"] = [24, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.index = 0;

        this.nowAnimation = "stand";
        this.animation = true;

        this.bx = 0;
        this.by = 0;
        this.time = 0;

        //影の追加
        var that = this;
        var sc = 16 / 24;
        if (sc < 1) sc += 0.2;
        this.shadowSprite = phina.display.Sprite("shadow", 24, 8)
            .addChildTo(this)
            .setAlpha(0.5)
            .setScale(sc, 1.0)
            .setPosition(0, 16);
    },

    update: function() {
        if (this.animation && this.time % 6 == 0) {
            this.index = (this.index+1) % this.frame[this.nowAnimation].length;
            if (this.frame[this.nowAnimation][this.index] == "stop") this.index--;
            this.frameIndex = this.frame[this.nowAnimation][this.index];
        }

        if (this.x < this.bx) this.scaleX = 1;
        if (this.x > this.bx) this.scaleX = -1;
        this.bx = this.x;
        this.by = this.y;

        this.time++;
    },

    setAnimation: function(animName) {
        if (!this.frame[animName]) return;
        if (animName == this.nowAnimation) return;
        this.nowAnimation = animName;
        this.index = -1;
        return this;
    },
});

//プレイヤー現在使用武器表示
phina.define("qft.PlayerWeapon", {
    superClass: "phina.display.DisplayElement",

    init: function(player) {
        this.superInit();
        this.player = player;

        var that = this;
        this.base = phina.display.DisplayElement().addChildTo(this);
        this.base.update = function() {
            this.rotation = -that.rotation;
        }
        var param = {
            width: 25,
            height: 25,
            fill: "rgba(0,0,0,0.0)",
            stroke: "yellow",
            strokeWidth: 2,
            backgroundColor: 'transparent',
        };
        //使用中武器
        phina.display.RectangleShape(param).addChildTo(this.base).setPosition(0, -18);
        //捨てちゃう武器
        this.dropFrame = phina.display.RectangleShape({stroke: "red"}.$safe(param))
            .addChildTo(this.base)
            .setPosition(14, 10)
            .setVisible(false);
        this.dropFrame.update = function() {
            if (that.player.equip.weapons.length < 3) {
                this.visible = false;
            } else {
                this.visible = true;
            }
        }

        //武器リスト（３つ）
        this.weapons = [];
        var rad = 0;
        var rad_1 = (Math.PI*2) / 3;
        (3).times(function(i) {
            var x =  Math.sin(rad)*18;
            var y = -Math.cos(rad)*18;
            rad -= rad_1;
            this.weapons[i] = phina.display.Sprite("weapons", 24, 24)
                .addChildTo(this)
                .setPosition(x, y);
            this.weapons[i].index = i;
            this.weapons[i].update = function() {
                this.rotation = -that.rotation;
                var weapons = that.player.equip.weapons;
                if (this.index < weapons.length) {
                    var kind = that.player.equip.weapons[this.index];
                    var level = that.player.equip.level[this.index];
                    var spec = qft.ItemInfo.get(kind);
                    var index = kind * 10 + Math.min(level, spec.maxIndex);
                    this.setFrameIndex(index);
                    this.visible = true;
                } else {
                    this.visible = false;
                }
            }
            var labelParam = {
                fill: "white",
                stroke: "black",
                strokeWidth: 2,

                fontFamily: "Orbitron",
                align: "center",
                baseline: "middle",
                fontSize: 10,
                fontWeight: ''
            };
            //強化レベル表示
            this.weapons[i].level = phina.display.Label({text: ""}.$safe(labelParam)).setPosition(6, 6).addChildTo(this.weapons[i]);
            this.weapons[i].level.index = i;
            this.weapons[i].level.update = function() {
                var level = that.player.equip.level[this.index];
                if (level != 0) {
                    this.text = "+"+level;
                } else {
                    this.text = "";
                }
            }
        }.bind(this));
    },

    clear: function() {
    },
});

/*
 *  enemy.adventurer.js
 *  2017/08/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//冒険者
phina.define("qft.Enemy.Adventurer", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 360,

    //得点
    point: 10000,

    //アニメーション間隔
    animationInterval: 6,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 24, height: 20});
        this.superInit(parentScene, options);

        //武器用スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setOrigin(1, 1)
            .setPosition(-3, 3);
        this.weapon.alpha = 0;
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.kind = "sword";
        this.weapon.scaleX = -1;
        this.weapon.scaleY = -1;

        //表示用スプライト
        if (this.black) {
            this.sprite = phina.display.Sprite("player1Black", 32, 32).addChildTo(this);
        } else {
            this.sprite = phina.display.Sprite("player1", 32, 32).addChildTo(this);
        }
        this.sprite.scaleX = -1;

        this.hp += this.level * 5;
        this.power += this.level * 5;
        this.point += this.level * 1000;

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;
        this.attackInterval = 30;

        //行動フェーズ
        this.phase = "wander";

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        //待機状態
        if (this.phase == "wait") {
            this.isAdvanceAnimation = false;
            if (look) {
                this.flare('balloon', {pattern: "!", lifeSpan: 15});
                this.phase = "approach";
            }
        } else {
            this.isAdvanceAnimation = true;
        }

        //徘徊
        if (this.phase == "wander") {
            if (look) {
                this.flare('balloon', {pattern: "!", lifeSpan: 15});
                this.phase = "approach";
            } else {
                this.roundtripAlgorithm_ground(distance, look);
            }
        }

        //プレイヤー発見後接近
        if (this.phase == "approach") {
            if (this.x < player.x) {
                this.vx = 3;
            } else {
                this.vx = -3;
            }
            if (!look) {
                this.phase = "lost";
                this.chaseTime = 150;
            }
            if (distance < 52 && this.attackInterval == 0) this.phase = "attack";
        }

        //プレイヤー見失い
        if (this.phase == "lost") {
            this.chaseTime--;
            if (this.x < player.x) {
                this.vx = 3;
            } else {
                this.vx = -3;
            }
            if (this.chaseTime < 0) {
                this.chaseTime = 0;
                this.flare('balloon', {pattern: "..."});
                this.phase = "wait";
            }
        }

        //攻撃
        if (this.phase == "attack") {
            this.attack();
            this.attackInterval = 30;
        } else if (this.phase != "attacking") {
            if (this.isOnFloor) {
                this.setAnimation("walk");
            } else {
                this.setAnimation("jump");
            }
        }

        this.attackInterval--;
        if (this.attackInterval < 0) this.attackInterval = 0;
    },

    //攻撃
    attack: function() {
        this.animationInterval = 2;
        this.setAnimation("attack");
        this.phase = "attacking";

        //攻撃判定
        var that = this;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 24, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        app.playSE("attack");
        this.weapon.tweener.clear()
            .set({rotation: 200, alpha: 1.0})
            .to({rotation: 360}, 6)
            .fadeOut(1)
            .call(() => {
                this.animationInterval = 6;
                this.setAnimation("walk");
                this.phase = "approach";
                atk.remove();
            });
    },

    //飛び道具弾き
    guard: function() {
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [36, "stop"];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
        this.frame["defense"] = [ 41, 42, 43, 44, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["drop"] = [18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.frame["clear"] = [24, 25, 26];
        this.frame["stun"] = [ 18, 19, 20];
        this.index = 0;
        return this;
    },
});

/*
 *  enemy.archdemon.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アークデーモン
phina.define("qft.Enemy.ArchDemon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 30,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 180,

    //アニメーション間隔
    animationInterval: 15,

    //得点
    point: 5000,

    //飛行モード
    flying: false,
    flyingPhase: 0, //行動フェーズ
    flyingX: 0,     //飛行開始Ｘ座標

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 35, height: 30});
        if (options.size) {
            var size = options.size || 1;
            options.width = size * 35;
            options.height = size * 30;
        }
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(216*2, 640*2, 72*2, 128*2).setPosition(0, -10);
        if (options.size) {
            var size = options.size || 1;
            this.sprite.setScale(size).setPosition(0, size * -12);
        }

        this.hp += this.level * 5;
        this.power += this.level * 5;
        this.point += this.level * 1000;

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.phase = 0;
        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤー情報
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //進行方向決定
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }

        //プレイヤー発見後一定時間追跡する
        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.vx *= 3;
            this.flare('balloon', {pattern: "!"});
        }
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }
        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this._collision[3].hit) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //プレイヤーへの攻撃
            if (look && !this.isAttack && !this.isJump) {
                if (dis > 128) {
                    this.firebreath();
                } else {
                    this.exploding();
                }
            }
        }

        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    //火球を吐く
    fireball: function() {
        this.isAttack = true;
        this.stopTime = 30;
        this.sprite.tweener.clear()
            .wait(10)
            .call(() => {
                this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, rotation: this.getPlayerAngle(), power: 30});
            })
            .wait(45)
            .call(() => {
                this.isAttack = false;
            });
    },

    //炎を吐く
    firebreath: function() {
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite.tweener.clear()
            .wait(10)
            .wait(60)
            .call(() => {
                this.isAttack = false;
            });

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var b = this.parentScene.spawnEnemy(this.x + 24 * this.scaleX, this.y-8, "Bullet", {type: "explode", power: 10, rotation: this.getPlayerAngle(), velocity: 5});
                b.setScale(0.1);
                b.tweener.clear().setUpdateType('fps').to({scaleX: 1, scaleY: 1}, 10);
                ct++;
                if (ct == 6 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(5)
            .setLoop(true);
    },

    //爆発
    exploding: function() {
        app.playSE("bomb");
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite.tweener.clear()
            .fadeIn(15)
            .wait(45)
            .call(() => {
                this.isAttack = false;
            });

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var rad = rot.toRadian();
                var ex = Math.cos(rad) * 16;
                var ey = Math.sin(rad) * 16;
                this.parentScene.spawnEnemy(this.x + ex, this.y + ey, "Bullet", {type: "explode", power: 10, rotation: rot, velocity: 3});
                rot += 22.5;
                ct++;
                if (ct == 16 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(1)
            .setLoop(true);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.archknight.js
 *  2017/05/18
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アークナイト
phina.define("qft.Enemy.ArchKnight", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 70,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 90,

    //得点
    point: 5000,

    //アニメーション間隔
    animationInterval: 10,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_LONGSWORD,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 25, height: 40});
        this.superInit(parentScene, options);

        //武器スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setOrigin(1, 1)
            .setPosition(-6, 3)
            .setScale(-1.5, 1.5)
            .setRotation(430);
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.kind = "sword";
        if (options.weapon == "ax") {
            this.weapon.setFrameIndex(20 + Math.min(9, this.level));
            this.weapon.kind = "ax";
        }
        if (options.weapon == "spear") {
            this.weapon.setFrameIndex(30 + Math.min(9, this.level));
            this.weapon.kind = "spear";
        }

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(216*2, 128*2, 72*2, 128*2);
        this.sprite.setPosition(0, -5);

        this.hp += this.level * 5;
        this.power += this.level * 5;
        this.point += this.level * 1000;

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 0.5;
            } else {
                this.vx = -0.5;
            }
            if (this.isJump) this.vx *= 2;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }
        if (this.chaseTime > 0) this.vx *= 3;

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+40, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+40, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                    this.turnWait = 1;
                }
            }

            //攻撃
            if (look && !this.isJump && dis < 64 && !this.isAttack) {
                this.attack();
            }

            //プレイヤー飛び道具を弾く
            if (look && !this.isAttack) {
                var that = this;
                //プレイヤーショットとの距離判定
                this.parentScene.playerLayer.children.forEach(function(e) {
                    if (e instanceof qft.PlayerAttack && e.isCollision && e.type == "arrow") {
                        if (that.getDistance(e) < 64) that.guard();
                    }
                }.bind(this));
            }
        }
        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    attack: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 48, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        if (this.weapon.kind == "sword" || this.weapon.kind == "ax") {
            atk.isActive = false;
            this.weapon.tweener.clear()
                .to({rotation: 270}, 2)
                .call(function() {
                    atk.isActive = true;
                    that.isSuperArmor = true;
                    that.vx = 16 * that.scaleX;
                })
                .to({rotation: 430}, 6)
                .call(function() {
                    that.isAttack = false;
                    that.isSuperArmor = false;
                    atk.remove();
                });
        } else if (this.weapon.kind == "spear") {
            atk.width = 32;
            atk.height = 8;
            atk.setPosition(this.x + this.scaleX * 1, this.y);
            atk.tweener.clear().by({x: 20 * this.scaleX}, 10).by({x: -20 * this.scaleX}, 10);
            atk.isActive = false;

            this.weapon.tweener.clear()
                .set({rotation: 45, x: -20})
                .wait(6)
                .call(function() {
                    atk.isActive = true;
                    that.isSuperArmor = true;
                    that.vx = 32 * that.scaleX;
                })
                .by({x: 20}, 3)
                .by({x: -30}, 5)
                .call(function() {
                    that.isAttack = false;
                    that.isSuperArmor = false;
                    atk.remove();
                })
                .set({rotation: 430, x: -2});
        }
        this.isAttack = true;
        this.stopTime = 30;
    },

    //飛び道具弾き
    guard: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 48, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        this.isMuteki = true;
        this.weapon.tweener.clear()
            .set({rotation: 430})
            .to({rotation: 300}, 3)
            .call(function() {
                that.vx = 4 * that.scaleX;
            })
            .to({rotation: 430}, 3)
            .call(function() {
                that.isAttack = false;
                that.isMuteki = false;
                atk.remove();
            });
        this.isAttack = true;
        this.stopTime = Math.min(0, 6 - this.level);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.frame["turn"] = [6, "walk"];
        this.index = 0;
    },
});

/*
 *  enemy.archmage.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//アークメイジ
phina.define("qft.Enemy.ArchMage", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 360,

    //得点
    point: 800,

    //重力加速度
    gravity: 0,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var lv = Math.min(this.level, 3);
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming((lv % 2) * 144 + 72, Math.floor(lv / 2) * 128, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.speed = 1;
        this.phase = 0;
        this.isAttack = false;

        //接近戦経過時間
        this.nearCount = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        //これ以上進めない場合は折り返す
        if (this._collision[1].hit) {
            this.direction = 180;
        } else if (this._collision[3].hit) {
            this.direction = 0;
        }

        //テリトリー指定
        if (this.territory) {
            //水平方向のみチェック
            var tx = this.x - this.firstX;
            if (Math.abs(tx) > this.territory) {
                if (tx > 0) {
                    this.direction = 180;
                } else {
                    this.direction = 0;
                }
            }
        }

        //通常フェーズでプレイヤーを発見したら警戒フェーズに移る
        if (this.phase == 0 && look) {
            this.flare('balloon', {pattern: "!"});
            this.phase = 1;
            this.speed = 0;
        }

        //プレイヤーが離れたら通常フェーズ
        if (this.phase != 0) {
            if (distance > 192 || !look) {
                this.flare('balloonerace');
                this.phase = 0;
                this.speed = 1;
                for (var i = 0; i < this.dagger.length; i++) {
                    this.dagger[i].phase = 0;
                }
            }
        }

        //通常
        if (this.phase == 0) {
            this.vx = this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        } else {
            if (this.x < player.x) {
                this.scaleX = 1;
                this.direction = 0;
            } else {
                this.scaleX = -1;
                this.direction = 180;
            }
        }

        //警戒
        if (this.phase == 1) {
            if (this.balloon == null) this.flare('balloon', {pattern: "...", animationInterval : 15});
            if (distance < 192) this.phase = 2;
        }

        //攻撃
        if (this.phase == 2) {
            this.flare('balloonerace');
            for (var i = 0; i < this.dagger.length; i++) {
                this.dagger[i].isAttack = true;
            }
            if (distance < 92) this.phase = 3;
        }
        if (this.phase == 3) {
            this.phase++;
            this.flare('balloonerace');
            for (var i = 0; i < this.dagger.length; i++) {
                this.dagger[i].phase = 10;
            }
        }
        if (this.phase == 4 && this.time % 90 == 0) {
            this.isAttack = true;
        }

        if (this.isAttack) {
            this.isAttack = false;
            if (this.phase == 2) {
                var b = this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true});
                b.rotation = this.getPlayerAngle() + Math.randint(-30, 30);
            }
            if (this.phase == 4) {
                for (var i = 0; i < 4; i++) {
                    var b = this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true});
                    b.rotation = this.getPlayerAngle() + Math.randint(-60, 60);
                }
            }
        }

        if (distance < 96) {
            this.nearCount++;
            if (this.nearCount > 90) {
                this.teleport();
                this.nearCount = 0;
            }
        } else {
            this.nearCount -= 10;
            if (this.nearCount < 0) this.nearCount = 0;
        }
    },

    //テレポート
    teleport: function() {
        for (var i = 0; i < this.dagger.length; i++) {
            this.dagger[i].phase = 10;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },

    firstFrame: function() {
        //マジックダガー装備
        this.dagger = [];
        this.dagger[0] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX:  16, offsetY: -16, order: 0, level: this.level});
        this.dagger[1] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX: -16, offsetY: -16, order: 1, level: this.level});
        if (this.level > 2) this.dagger[2] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX: -32, offsetY: -8, order: 2, level: this.level});
        if (this.level > 3) this.dagger[3] = this.parentScene.spawnEnemy(this.x, this.y, "MagicDagger", {parent: this, offsetX:  32, offsetY: -8, order: 3, level: this.level});
    },
});

/*
 *  enemy.babydemon.js
 *  2017/01/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ベビーデーモン
phina.define("qft.Enemy.BabyDemon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 40,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 5,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 0, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 100;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //汎用追跡アルゴリズム
        this.chaseAlgorithm(dis, look);

        //プレイヤーが近くにいたら攻撃
        if (this.isOnFloor && look && !this.isJump && dis < 64) {
            //飛びかかる
            this.isJump = true;
            this.vy = -6;
            var pl = this.parentScene.player;
            if (this.x > pl.x) {
                this.direction = 180;
            } else {
                this.direction = 0;
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look || this.chaseTime > 0) {
            this.vx *= 4;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.bird.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//鳥
phina.define("qft.Enemy.Bird", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 30,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 60,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0,

    //得点
    point: 200,

    //属性ダメージ倍率
    damageArrow: 5,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18});
        options = options.$safe(this.defaultOptions);
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72, 0, 72, 128).setScale(1 + capLevel * 0.1);

        this.hp += this.level * 5;
        this.power += this.level * 1;
        this.point += this.level * 100;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.isVertical = this.options.vertical || false;
        this.direction = this.options.direction || this.isVertical? 90: 0;
        this.speed = this.options.speed || 2;
        this.returnTime = this.options.returnTime || 120;
        this.bombInterval = this.options.bombInterval || 90;

        this.on('damaged', e => {
            if (this.isVertical) return;
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //チェックする壁決定
        var chk = 0;
        if (!this.isVertical) chk = 1;

        //壁に当たるか一定時間経過で折り返し
        if (this._collision[chk].hit || this._collision[chk+2].hit || this.returnTime < 0) {
            this.direction = (this.direction + 180) % 360;
            this.returnTime = this.options.returnTime;
        }

        //プレイヤーをみつけたら加速
        if (this.isLookPlayer()) {
            this.speed = 4;
            this.returnTime -= 2;
        } else {
            this.speed = 2;
            this.returnTime--;
        }

        //移動
        var rad = this.direction.toRadian();
        this.vx = Math.cos(rad) * this.speed;
        this.vy = Math.sin(rad) * this.speed;

        //落し物
        if (this.onScreen && this.time % this.bombInterval == 0) {
            this.parentScene.spawnEnemy(this.x, this.y, "BirdBomb", {});
        }

        //向きの指定
        if (this.vx != 0) {
            if (this.vx > 0) {
                this.scaleX = 1;
            } else {
                this.scaleX = -1;
            }
        }
        if (this.isVertical && this.getDistancePlayer() < 256) {
            if (this.x < this.parentScene.player.x) this.scaleX = 1; else this.scaleX = -1;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["walk"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

//鳥の落し物
phina.define("qft.Enemy.BirdBomb", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //防御力
    deffence: 10,

    //攻撃力
    power: 5,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 5, height: 5});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(72);

        this.setAnimation("normal");
        this.animationInterval = 6;
    },

    update: function() {
        if (this.isOnFloor) this.remove();
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [72, 73, 74, 73];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.bullet.js
 *  2017/01/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.Bullet", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //寿命
    lifespan: 75,

    //速度
    velocity: 2,

    //加速度
    accel: 1.02,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 1.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 0,

    //爆発フラグ
    explode: false,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        this.type = options.type;
        this.power = options.power || this.power;
        this.rotation = options.rotation || 0;
        this.velocity = options.velocity || this.velocity;
        this.lifeSpan = options.lifeSpan || this.lifeSpan;

        //表示用スプライト
        switch (options.type) {
            case "explode":
                this.sprite = phina.display.Sprite("effect", 48, 48).addChildTo(this).setFrameTrimming(0, 192, 192, 96);
                this.animationInterval = 3;
                this.explode = false;
                this.ignoreCollision = true;
                this.isMuteki = true;
                this.pattern = "explode";
                break;
            default:
                this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(9);
                this.animationInterval = 3;
                this.explode = options.explode || true;
                this.pattern = options.pattern || "pattern1";
                break;
        }

        this.setAnimation(this.pattern);

        this.on('dead', function() {
            if (this.explode) {
                this.parentScene.spawnEffect(this.x, this.y);
                app.playSE("bomb");
            }
        });
    },

    algorithm: function() {
        var rad = this.rotation.toRadian();
        this.vx = Math.cos(rad) * this.velocity;
        this.vy = Math.sin(rad) * this.velocity;
        this.velocity *= this.accel;
        if (this.vx > 1) this.sprite.scaleX = 1; else this.sprite.scaleX = -1;
        if (this.time > this.lifespan) this.remove();

        if (!this.ignoreCollision) {
            if (this._collision[0].hit ||
                this._collision[1].hit ||
                this._collision[2].hit ||
                this._collision[3].hit) this.flare('dead');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [9, 10, 11, 10];
        this.frame["pattern2"] = [15, 16, 17, 16];
        this.frame["explode"] = [0, 1, 2, 3, 4, 5, 6, 7, "remove"];
        this.index = 0;
    },

    hit: function() {
        if (this.type == "explode") return;

        this.remove();
        this.flare('dead');
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        this.vx = 0;
        this.vy = -10;
        return this;
    },
});

/*
 *  enemy.death.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//死神
phina.define("qft.Enemy.Death", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 30,

    //重力加速度
    gravity: 0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //気絶確率
    stunPower: 30,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 180,

    //地形無視
    ignoreCollision: true,

    //ノックバックキャンセル
    isSuperArmor: true,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_STONE,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_STONE,

    //属性ダメージ倍率
    damageFire: 2.0,
    damageIce: 0.8,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 128, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 1;
        this.point += this.level * 100;

        this.setAnimation("move");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.phase = 0;
        this.speed = 1;

        //行動パターン
        this.pattern = options.pattern || "linear";
        this.moveLength = options.length || 48;
        this.degree = 0;
        this.isVertical = false;

        //被ダメージ時処理
        this.on('damaged', e => {
            this.phase = 0;
        });

        this.tweener2 = phina.accessory.Tweener().attachTo(this);
    },

    algorithm: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        var rad = this.degree.toRadian();
        if (this.pattern == "linear") {
            if (this.isVertical) {
                this.vy = Math.cos(rad) * 2;
            } else {
                this.vx = Math.cos(rad) * 2;
            }
        }
        this.degree += 2;

        //徘徊モードの場合は適当に攻撃
        if (this.time % 90 == 0) this.isAttack = true;

        //攻撃
        if (this.isAttack) {
            this.isAttack = false;
            var b = this.parentScene.spawnEnemy(this.x, this.y, "DeathFlame", {pattern: 0});
            b.vy = -2;
            b.vx = 2 * this.scaleX;
            this.actionWait = 120;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["move"] = [3, 4, 5, 4];
        this.frame["up"] = [6, 7, 6, 8];
        this.frame["down"] =   [0, 1, 0, 2];
        this.frame["attack"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

//炎
phina.define("qft.Enemy.DeathFlame", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //攻撃力
    power: 10,

    //重力加速度
    gravity: 0.1,

    //横移動減衰率
    friction: 0.98,

    //気絶確率
    stunPower: 20,

    //地形無視
    ignoreCollision: false,

    //無敵フラグ
    isMuteki: true,

    //攻撃当たり判定有効フラグ
    isAttackCollision: true,

    //寿命
    lifeSpan: 120,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 20});
        this.superInit(parentScene, options);

        this.pattern = options.pattern || 0;
        this.lifeSpan = options.lifeSpan || 120;
        this.power += this.level * 5;

        this.setupAnimation(this.pattern);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 0, 144, 128).setFrameIndex(15 + this.pattern);

        this.setAnimation("appear");
        this.animationInterval = 3;

        this.direction = 0;
    },

    algorithm: function() {
        if (this.lifeSpan == 0) this.remove();
        if (this.lifeSpan < 30) {
            if (this.time % 2 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 60){
            if (this.time % 5 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 90) {
            if (this.time % 10 == 0) this.visible = !this.visible;
        }
        this.lifeSpan--;
    },

    setupAnimation: function(index) {
        index = index || 0;
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["appear"] = [15+index, 9+index,  3+index, 21+index, "normal"];
        this.frame["normal"] = [ 0+index, 6+index, 12+index, 18+index];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.demon.js
 *  2017/01/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

//デーモン
phina.define("qft.Enemy.Demon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 30,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 90,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 5,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(Math.min(this.level, 4) * 72, 640, 72, 128)
            .setScale(1.5)
            .setPosition(0, -8);

        this.hp += this.level * 10;
        this.power += this.level * 3;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 16) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 16) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //プレイヤーが近くにいたら攻撃
            if (look && !this.isJump && !this.isAttack) {
                if (dis > 96) {
                    //火を吐く
                    this.fireball();
                } else {
                    //飛びかかる
                    this.isJump = true;
                    this.vy = -6;
                    var pl = this.parentScene.player;
                    if (this.x > pl.x) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look) {
            this.vx *= 3;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (dis < 256) {
                this.flare('balloon', {pattern: "?"});
            } else {
                this.flare('balloonerace');
            }
        }
    },

    //火球を吐く
    fireball: function() {
        this.isAttack = true;
        this.stopTime = 30;
        var tw = phina.accessory.Tweener().attachTo(this).setUpdateType('fps')
            .call(() => {
                this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, power: 10 + this.level * 5, rotation: this.getPlayerAngle()});
            })
            .wait(30)
            .call(() => {
                tw.remove();
                this.isAttack = false;
            });
    },

    //火を吐く
    flaming: function() {
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite2.tweener.clear()
            .fadeIn(15)
            .wait(60)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(15);

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var b = this.parentScene.spawnEnemy(this.x + 24 * this.scaleX, this.y-8, "Bullet", {type: "explode", power: 10, rotation: this.getPlayerAngle(), velocity: 5});
                b.setScale(0.1);
                b.tweener.clear().setUpdateType('fps').to({scaleX: 1, scaleY: 1}, 10);
                ct++;
                if (ct == 6 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(5)
            .setLoop(true);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.devil.js
 *  2017/04/25
 *  @auther minimo  
 *  This Program is MIT license.
 */

//悪魔
phina.define("qft.Enemy.Devil", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 30,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 360,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 800,

    //属性ダメージ倍率
    damageArrow: 5,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_BAG,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_STONE,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18}).$safe(this.defaultOptions);
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(72, 0, 72, 128);

        this.hp += this.level * 10;
        this.power += this.level * 5;
        this.point += this.level * 100;

        this.setAnimation("stand");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.isVertical = this.options.vertical || false;
        this.direction = this.options.direction || this.isVertical? 90: 0;
        this.speed = this.options.speed || 2;
        this.returnTime = this.options.returnTime || 120;
        this.attackInterval = this.options.attackInterval || 90;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤー情報
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤーが近くにいたら寄っていく
        if (look && dis > 32) {
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(pl.x, pl.y);
            var p = p2.sub(p1);
            p.normalize();
            this.vx = p.x * (1 + this.level * 0.2);
            this.vy = p.y * (1 + this.level * 0.2);

            //プレイヤーの方向を向く
            var angle = this.getPlayerAngle();
            if (angle > 315 || angle < 45) this.setAnimation('horizon');
            if ( 45 < angle && angle < 135) this.setAnimation('down');
            if (135 < angle && angle < 225) this.setAnimation('horizon');
            if (225 < angle && angle < 315) this.setAnimation('down');

            //一定以上近づいたら攻撃
            if (dis < 96) this.isAttack = true;

            this.flare('balloon', {pattern: "!"});
        } else {
            this.vx = 0;
            this.vy = 0;
            this.setAnimation("stand");
            this.flare('balloonerace');
        }

        if (this.vx > 0) {
            this.scaleX = 1;
        } else {
            this.scaleX = -1;
        }

        if (this.isAttack) {
            this.attack();
        }
    },

    attack: function() {
        this.stopTime = 30;
        this.isAttack = false;
        this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, power: 10 + this.level * 5, rotation: this.getPlayerAngle()});
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [6, 7, 8, 7];
        this.frame["up"] = [0, 1, 2, 1];
        this.frame["down"] = [5, 6, 7, 6];
        this.frame["horizon"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

/*
 *  enemy.explode.js
 *  2017/07/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.Explode", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0.98,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 0,

    //無敵フラグ
    isMuteki: true,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("effect", 48, 48)
            .addChildTo(this)
            .setFrameTrimming(0, 192, 192, 96);
        this.animationInterval = 3;

        this.power = options.power || this.power;

        this.pattern = options.pattern || "pattern1";
        this.setAnimation(this.pattern);
        this.animationInterval = 3;
    },

    algorithm: function() {
        if (this.index == 8) this.remove();
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [0, 1, 2, 3, 4, 5, 6, 7, 8, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.firebird.js
 *  2016/03/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//鳥
phina.define("qft.Enemy.FireBird", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 90,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0,

    //得点
    point: 300,

    //属性ダメージ倍率
    damageArrow: 5,
    damageFire: 0.5,
    damageIce: 2,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16, offsetCollisionX: -6});
        options = options.$safe(this.defaultOptions);
        this.superInit(parentScene, options);


        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(288, 0, 72, 128);

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.isVertical = this.options.vertical || false;
        this.direction = this.options.direction || this.isVertical? 90: 0;
        this.speed = this.options.speed || 2;
        this.returnTime = this.options.returnTime || 120;
        this.bombInterval = this.options.bombInterval || 90;
        this.attackInterval = 0;
        this.attackCount = 99;
        this.isAttack = false;

        this.on('damaged', e => {
            if (this.isVertical) return;
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
        this.on('dead', function() {
            this.parentScene.spawnEffect(this.x, this.y);
            app.playSE("bomb");
        });
    },

    algorithm: function() {
        //チェックする壁決定
        var chk = 1;
        if (this.isVertical) chk = 0;

        //壁に当たるか一定時間経過で折り返し
        if (this._collision[chk].hit || this._collision[chk+2].hit || this.returnTime < 0) {
            this.direction = (this.direction + 180) % 360;
            this.returnTime = this.options.returnTime;
        }
        //移動
        var rad = this.direction.toRadian();
        this.vx = Math.cos(rad) * this.speed;
        this.vy = Math.sin(rad) * this.speed;
        this.returnTime--;
 
        //プレイヤーを見つけたら攻撃
        var lookPlayer = this.isLookPlayer();
        if (lookPlayer) {
            if (this.attackInterval == 0) {
                var b = this.parentScene.spawnEnemy(this.x, this.y+6, "Bullet", {pattern: "pattern2", explode: true, velocity: 3});
                b.rotation = this.getPlayerAngle();
                this.attackInterval = 90;
            }
        } else {
                this.attackInterval = 60;
        }

        //落し物
        if (this.onScreen && this.time % this.bombInterval == 0) {
            this.parentScene.spawnEnemy(this.x, this.y, "FireBirdBomb", {});
        }

        //向きの指定
        if (this.vx != 0) {
            if (this.vx > 0) {
                this.scaleX = 1;
            } else {
                this.scaleX = -1;
            }
        }
        if (this.isVertical && this.getDistancePlayer() < 256) {
            if (this.x < this.parentScene.player.x) this.scaleX = 1; else this.scaleX = -1;
        }

        if (this.attackInterval > 0) this.attackInterval--;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["walk"] = [3, 4, 5, 4];
        this.index = 0;
    },

    attack: function() {
    },
});

//鳥の落し物
phina.define("qft.Enemy.FireBirdBomb", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //防御力
    deffence: 10,

    //攻撃力
    power: 5,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 5, height: 5});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("bullet", 24, 32).addChildTo(this).setFrameIndex(72);

        this.setAnimation("normal");
        this.animationInterval = 6;
    },

    update: function() {
        if (this.isOnFloor) {
            this.parentScene.spawnEffect(this.x, this.y, {name: "explode_ground"});
            if (this.onScreen) app.playSE("bomb");
            this.remove();
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [72, 73, 74, 73];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.flame.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//炎
phina.define("qft.Enemy.Flame", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //攻撃力
    power: 10,

    //無敵フラグ
    isMuteki: true,

    //攻撃当たり判定有効フラグ
    isAttackCollision: true,

    //寿命
    lifeSpan: 120,

    //影表示フラグ
    isShadow: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 20});
        this.superInit(parentScene, options);

        this.pattern = options.pattern || 0;
        this.lifeSpan = options.lifeSpan || 120;
        this.power += this.level * 5;

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(Math.min(this.pattern, 2) * 24 + 72, 0, 24, 128);

        this.setAnimation("normal");
        this.animationInterval = 3;

        this.direction = 0;
    },

    algorithm: function() {
        if (this.lifeSpan == 0) this.remove();
        if (this.lifeSpan < 30) {
            if (this.time % 2 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 60){
            if (this.time % 5 == 0) this.visible = !this.visible;
        } else if (this.lifeSpan < 90) {
            if (this.time % 10 == 0) this.visible = !this.visible;
        }
        this.lifeSpan--;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [0, 1, 2, 3];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.garuda.js
 *  2017/07/07
 *  @auther minimo  
 *  This Program is MIT license.
 */

//怪鳥
phina.define("qft.Enemy.Garuda", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 80,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 60,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 0,

    //スーパーアーマー
    isSuperArmor: true,

    //得点
    point: 3000,

    //属性ダメージ倍率
    damageArrow: 5,

    defaultOptions: {
        speed: 2,
        direction: 0,
        returnTime: 120,
    },

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18});
        options = options.$safe(this.defaultOptions);
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01x2", 48, 64).addChildTo(this);
        this.sprite.setFrameTrimming(0, 0, 72 * 2, 128 * 2).setScale(1.5).setPosition(0, 16);

        this.sprite2 = phina.display.Sprite("monster01x2", 48, 64).addChildTo(this);
        this.sprite2.setFrameTrimming(288 * 2, 0, 72 * 2, 128 * 2).setScale(1.5).setPosition(0, 16).setAlpha(0);
        var that = this;
        this.sprite2.update = function() {
            this.frameIndex = that.sprite.frameIndex;
        }

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.moveTime = 0;
    },

    algorithm: function() {
        if (this.path) {
            var p = this.getPathPosition(this.moveTime);
            this.setPosition(p.x, p.y);
        }
        this.moveTime += 2;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["up"] =   [0, 1, 2, 1];
        this.frame["down"] = [6, 7, 8, 7];
        this.frame["walk"] = [3, 4, 5, 4];
        this.index = 0;
    },
});

/*
 *  enemy.greaterdemon.js
 *  2017/05/01
 *  @auther minimo  
 *  This Program is MIT license.
 */

//グレーターデーモン
phina.define("qft.Enemy.GreaterDemon", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 120,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 180,

    //アニメーション間隔
    animationInterval: 15,

    //得点
    point: 5000,

    //飛行モード
    flying: false,
    flyingPhase: 0, //行動フェーズ
    flyingX: 0,     //飛行開始Ｘ座標

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWELBOX,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 35, height: 30});
        if (options.size) {
            var size = options.size || 1;
            options.width = size * 35;
            options.height = size * 30;
        }
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(72*2*2, 640*2, 72*2, 128*2).setPosition(0, -10);
        if (options.size) {
            var size = options.size || 1;
            this.sprite.setScale(size).setPosition(0, size * -12);
        }

        this.sprite2 = phina.display.Sprite("monster01x2", 24*2, 32*2).addChildTo(this).setAlpha(0);
        this.sprite2.setFrameTrimming(288*2, 640*2, 72*2, 128*2).setPosition(0, -10);
        this.sprite2.tweener.setUpdateType('fps');
        if (options.size) {
            var size = options.size || 1;
            this.sprite2.setScale(size).setPosition(0, size * -12);
        }
        var that = this;
        this.sprite2.update = function() {
            this.frameIndex = that.sprite.frameIndex;
        }

        this.setAnimation("walk");
        this.setupLifeGauge();

        this.phase = 0;
        this.direction = 0;
        this.isAttack = false;
        this.isAttackCancel = false;
        this.chaseTime = 0;
        this.turnTime = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
            this.isAttackCancel = true;
        });
    },

    algorithm: function() {
        //プレイヤー情報
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //進行方向決定
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }

        //プレイヤー発見後一定時間追跡する
        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.vx *= 3;
            this.flare('balloon', {pattern: "!"});
        }
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }
        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
                this.chaseTime = 0;
            } else if (this._collision[3].hit) {
                this.direction = 0;
                this.chaseTime = 0;
            }

            //プレイヤーへの攻撃
            if (look && !this.isAttack && !this.isJump) {
                if (dis > 128) {
                    this.firebreath();
                } else {
                    this.exploding();
                }
            }
        }

        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    //火球を吐く
    fireball: function() {
        this.isAttack = true;
        this.stopTime = 30;
        this.sprite2.tweener.clear()
            .fadeIn(10)
            .call(() => {
                this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, rotation: this.getPlayerAngle(), power: 30});
            })
            .wait(45)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(10);
    },

    //炎を吐く
    firebreath: function() {
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite2.tweener.clear()
            .fadeIn(15)
            .wait(60)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(15);

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var b = this.parentScene.spawnEnemy(this.x + 24 * this.scaleX, this.y-8, "Bullet", {type: "explode", power: 10, rotation: this.getPlayerAngle(), velocity: 5});
                b.setScale(0.1);
                b.tweener.clear().setUpdateType('fps').to({scaleX: 1, scaleY: 1}, 10);
                ct++;
                if (ct == 6 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(5)
            .setLoop(true);
    },

    //爆発
    exploding: function() {
        app.playSE("bomb");
        this.isAttack = true;
        this.stopTime = 60;
        this.sprite2.tweener.clear()
            .fadeIn(15)
            .wait(45)
            .call(() => {
                this.isAttack = false;
            })
            .fadeOut(15);

        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var rad = rot.toRadian();
                var ex = Math.cos(rad) * 16;
                var ey = Math.sin(rad) * 16;
                this.parentScene.spawnEnemy(this.x + ex, this.y + ey, "Bullet", {type: "explode", power: 10, rotation: rot, velocity: 3});
                rot += 22.5;
                ct++;
                if (ct == 16 || this.attackCancel) {
                    tw.remove();
                    this.isAttackCancel = false;
                }
            })
            .wait(1)
            .setLoop(true);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.intelligentsword.js
 *  2017/07/19
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.IntelligentSword", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 1.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 360,

    //得点
    point: 2000,

    //アニメーションフラグ
    isAnimation: false,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_LONGSWORD,

    //レアドロップ率（％）
    rareDropRate: 1,
    rareDropItem: ITEM_LONGSWORD,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 24});
        this.superInit(parentScene, options);

        this.sprite = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setRotation(215);
        this.sprite.tweener.clear()
            .to({y: -2}, 1000, "easeInOutSine")
            .to({y: 4}, 1000, "easeInOutSine")
            .setLoop(true);

        this.type = options.type;
        this.power = options.power || this.power;
        this.rotation = options.rotation || 0;
        this.velocity = options.velocity || this.velocity;

        this.phase = 0;

        this.setupLifeGauge();
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.phase == 0) {
            if (look && dis < 64) {
                this.phase++;
            }
        }

        if (this.phase == 2) {
            var ang = this.getAngle(pl);
            this.rotation = ang + 30;
        }

        if (look) {
            this.flare('balloon', {pattern: "!", lifeSpan: 15, y: 0});
        } else {
            this.flare('balloonerace');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [0];
        this.index = 0;
    },

    snap: function(target) {
        //効果音
        app.playSE("tinkling");
        this.tweener.clear()
            .by({y: -64, rotation: 700}, 15, "easeOutQuad")
            .call(function() {
                this.phase = 10;
            }.bind(this));
    },
});

/*
 *  enemy.knight.js
 *  2017/05/06
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ナイト
phina.define("qft.Enemy.Knight", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 70,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //速度
    speed: 1,

    //視力
    eyesight: 192,

    //視野角
    viewAngle: 90,

    //得点
    point: 1000,

    //アイテムドロップ率（％）
    dropRate: 7,
    dropItem: ITEM_JEWEL,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_LONGSWORD,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //武器スプライト
        this.weapon = phina.display.Sprite("weapons", 24, 24)
            .addChildTo(this)
            .setFrameIndex(10 + Math.min(9, this.level))
            .setOrigin(1, 1)
            .setPosition(-4, 2)
            .setScale(-1, 1)
            .setRotation(430);
        this.weapon.tweener.setUpdateType('fps');
        this.weapon.kind = "sword";
        if (options.weapon == "ax") {
            this.weapon.setFrameIndex(20 + Math.min(9, this.level));
            this.weapon.kind = "ax";
        }
        if (options.weapon == "spear") {
            this.weapon.setFrameIndex(30 + Math.min(9, this.level));
            this.weapon.kind = "spear";
        }

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(144, 128, 72, 128);
        this.sprite.setPosition(0, -5).setScale(1.3);

        this.hp += this.level * 10;
        this.power += this.level * 10;
        this.point += this.level * 500;

        this.setAnimation("walk");
        this.animationInterval = 6;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
            if (this.isJump) this.vx *= 1;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }
        if (this.chaseTime > 0) this.vx *= 3;

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -12;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                }
            }

            //攻撃
            if (look && !this.isJump && dis < 64 && !this.isAttack) {
                this.attack();
            }

            //プレイヤー飛び道具を弾く（レベル４以上）
            if (this.level > 3 && look && !this.isAttack) {
                var that = this;
                //プレイヤーショットとの距離判定
                this.parentScene.playerLayer.children.forEach(function(e) {
                    if (e instanceof qft.PlayerAttack && e.isCollision && e.type == "arrow") {
                        if (that.getDistance(e) < 64) that.guard();
                    }
                }.bind(this));
            }
        }

        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    attack: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 24, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        if (this.weapon.kind == "sword" || this.weapon.kind == "ax") {
            atk.isActive = false;
            this.weapon.tweener.clear()
                .to({rotation: 270}, 3)
                .wait(3)
                .call(function() {
                    atk.isActive = true;
                    that.vx = 16 * that.scaleX;
                })
                .to({rotation: 430}, 6)
                .call(function() {
                    that.isAttack = false;
                    atk.remove();
                });
        } else if (this.weapon.kind == "spear") {
            atk.width = 32;
            atk.height = 8;
            atk.setPosition(this.x + this.scaleX * 1, this.y);
            atk.tweener.clear().by({x: 20 * this.scaleX}, 10).by({x: -20 * this.scaleX}, 10);
            atk.isActive = false;

            this.weapon.tweener.clear()
                .set({rotation: 45, x: -20})
                .wait(2)
                .call(function() {
                    atk.isActive = true;
                    that.isSuperArmor = true;
                    that.vx = 32 * that.scaleX;
                })
                .by({x: 20}, 3)
                .by({x: -30}, 5)
                .call(function() {
                    that.isAttack = false;
                    that.isSuperArmor = false;
                    atk.remove();
                })
                .set({rotation: 430, x: -2});
        }
        this.isAttack = true;
        this.stopTime = 30;
    },

    //飛び道具弾き
    guard: function() {
        var that = this;
        var width = 24, height = 24;
        var atk = qft.EnemyAttack(this.parentScene, {width: 24, height: 24, power: 20 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        this.isMuteki = true;
        this.weapon.tweener.clear()
            .set({rotation: 430})
            .to({rotation: 300}, 3)
            .to({rotation: 430}, 3)
            .call(function() {
                that.isAttack = false;
                that.isMuteki = false;
                atk.remove();
            });
        this.isAttack = true;
        this.stopTime = 6;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.mage.js
 *  2017/04/28
 *  @auther minimo  
 *  This Program is MIT license.
 */

//魔術師
phina.define("qft.Enemy.Mage", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 160,

    //得点
    point: 500,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var lv = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming((lv % 2) * 144, Math.floor(lv / 2) * 128, 72, 128);
        this.sprite.setScale(1.2).setPosition(0, -2);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 200;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.phase = 0;
        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        if (this.isOnFloor) {
            //プレイヤーが近くにいたら距離を取る
            if (this.phase == 0 && look && !this.isJump && distance < 128) {
                this.flare('balloon', {pattern: "!"});
                this.phase = 1;
                this.speed = 3;
            }

            //逃げるフェーズ
            if (this.phase == 1) {
                if (distance < 128) {
                    if (this.x < player.x) this.direction = 180; else this.direction = 0;
                    this.speed = 3;
                } else {
                    if (this.x < player.x) this.direction = 0; else this.direction = 180;
                    this.speed = 0;
                    this.phase = 2;
                }
                var lv = Math.min(this.level, 4);
                this.sprite.setFrameTrimming((lv % 2) * 144, Math.floor(lv / 2) * 128, 72, 128);
            }

            //攻撃フェーズ
            if (this.phase == 2) {
                if (distance < 96) {
                    //プレイヤーが近づいたら逃げる
                    this.phase = 1;
                } else {
                    //プレイヤーが遠くにいる場合は攻撃
                    this.isAttack = true;
                }
            }

            //発狂モード
            if (this.phase == 3) {
                this.isAttack = true;
            }

            if (this.isAttack) {
                var lv = Math.min(this.level, 4);
                this.sprite.setFrameTrimming((lv % 2) * 144 + 72, Math.floor(lv / 2) * 128, 72, 128);
                this.isAttack = false;

                if (this.phase < 3) {
                    this.stopTime = 30;
                    this.fireball();
                } else {
                    this.stopTime = 8;
                    this.fireball();
                }

                //プレイヤー方向を向く
                if (this.x < player.x) {
                    this.diretion = 0;
                    this.scaleX = 1;
                } else {
                    this.direction = 180;
                    this.scaleX = -1;
                }
            }

            //これ以上進めない場合は折り返す
            var cantescape = false;
            if (this._collision[1].hit || this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
                if (this.phase == 1) cantescape = true;
            } else if (this._collision[3].hit || this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
                if (this.phase == 1) cantescape = true;
            }
            //逃げられない場合は発狂モード
            if (cantescape) {
                this.phase = 3;
                this.speed = 0;
            }

            //プレイヤーが離れたら通常フェーズ
            if (distance > 128 + 64) {
                var lv = Math.min(this.level, 4);
                this.sprite.setFrameTrimming((lv % 2) * 144, Math.floor(lv / 2) * 128, 72, 128);
                this.phase = 0;
                this.speed = 1;
            }
        }

        if (this.isOnFloor || this.isJump) {
            this.vx = this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },

    //ファイアボール
    fireball: function() {
        this.parentScene.spawnEnemy(this.x, this.y, "Bullet", {explode: true, rotation: this.getPlayerAngle() + Math.randint(-40, 40)});
    },

    //爆発
    explode: function() {
        app.playSE("bomb");
        this.isAttack = false;
        var rot = (this.scaleX == 1)? 0: 180;
        var ct = 0;
        var tw = phina.accessory.Tweener().attachTo(this)
            .setUpdateType('fps')
            .call(() => {
                var rad = rot.toRadian();
                var ex = Math.cos(rad) * 16;
                var ey = Math.sin(rad) * 16;
                this.parentScene.spawnEnemy(this.x + ex, this.y + ey, "Bullet", {type: "explode", power: 10, rotation: rot, velocity: 3});
                rot += 22.5;
                ct++;
                if (ct == 32 || this.attackCancel) {
                    tw.remove();
                }
            })
            .wait(1)
            .setLoop(true);
    },
});

/*
 *  enemy.magicdgger.js
 *  2017/07/19
 *  @auther minimo  
 *  This Program is MIT license.
 */

phina.define("qft.Enemy.MagicDagger", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //寿命
    lifespan: 75,

    //速度
    velocity: 2,

    //加速度
    accel: 1.02,

    //重力加速度
    gravity: 0,

    //横移動減衰率
    friction: 1.0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 0,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        this.sprite = phina.display.Sprite("weapons", 24, 24).addChildTo(this).setFrameIndex(0);
        this.setAnimation("pattern1");

        this.power = options.power || this.power;
        this.power += this.level * 2;

        this.parentUnit = options.parent || null;
        this.offsetX = options.offsetX || Math.randint(-16, 16);
        this.offsetY = options.offsetY || Math.randint(-16, 16);
        this.order = options.order || 0;

        this.isAttack = false;
        this.isAttack_before = false;
        this.isDamaged = false;

        this.phase = 0;
    },

    algorithm: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //待機開始
        if (this.phase == 0) {
            this.phase++;
            var x = this.parentUnit.x + this.offsetX;
            var y = this.parentUnit.y + this.offsetY;
            y += Math.cos(this.time.toRadian() * 6) * 5;
            this.tweener.clear()
                .moveTo(x, y, 5)
                .call(() => {
                    this.phase++;
                });
        }

        //待機中
        if (this.phase == 2) {
            this.x = this.parentUnit.x + this.offsetX;
            this.y = this.parentUnit.y + this.offsetY;
            this.y += Math.cos(this.time.toRadian() * 6) * 5;
            this.rotation -= 3;

            if (this.isAttack) {
                this.phase = 3;
                this.isAttack = false;
            }
        }

        //プレイヤー攻撃開始
        if (this.phase == 3) {
            this.phase++;
            this.rotation = this.getPlayerAngle() + 135;
            this.tweener.clear()
                .moveTo(pl.x, pl.y, 20, "easeInQuad")
                .call(() => {
                    this.phase++;
                });
        }

        //攻撃終了
        if (this.phase == 5) {
            this.phase++;
            this.isEnableAttackCollision = false;
            var x = this.parentUnit.x + this.offsetX;
            var y = this.parentUnit.y + this.offsetY;
            this.tweener.clear()
                .moveTo(x, y, 15, "easeInOutQuad")
                .wait(5)
                .call(() => {
                    this.phase = 0;
                    this.isEnableAttackCollision = true;
                });
        }

        //警戒待機開始
        if (this.phase == 10) {
            this.phase++;
            var deg = this.time.toRadian() * 6 + this.order * 60;
            var x = this.parentUnit.x + Math.cos(deg) * 16;
            var y = this.parentUnit.y + Math.sin(deg) * 16;
            this.tweener.clear()
                .moveTo(x, y, 5)
                .call(() => {
                    this.phase++;
                });
        }

        //警戒待機中
        if (this.phase == 12) {
            var deg = this.time.toRadian() * 6 + this.order * 60;
            this.x = this.parentUnit.x + Math.cos(deg) * 16;
            this.y = this.parentUnit.y + Math.sin(deg) * 16;
            this.rotation -= 6;

            if (this.isAttack) {
                this.phase = 13;
                this.isAttack = false;
            }
        }

        //近接攻撃開始
        if (this.phase == 13) {
            this.phase++;
            this.tweener.clear()
                .wait(10)
                .call(() => {
                    this.phase++;
                    this.rotation = this.getPlayerAngle() + 135;
                })
                .moveTo(pl.x, pl.y, 6)
                .call(() => {
                    this.phase++;
                });
        }

        //近接攻撃
        if (this.phase == 14) {
            var deg = this.time.toRadian() * 20 + this.order * 60;
            this.x = this.parentUnit.x + Math.cos(deg) * 24;
            this.y = this.parentUnit.y + Math.sin(deg) * 24;
            this.rotation -= 6;
        }

        //攻撃終了
        if (this.phase == 16) {
            this.phase++;
            this.isEnableAttackCollision = false;
            var x = this.parentUnit.x + this.offsetX;
            var y = this.parentUnit.y + this.offsetY;
            this.tweener.clear()
                .moveTo(x, y, 10)
                .call(() => {
                    this.phase = 10;
                    this.isEnableAttackCollision = true;
                });
        }

        //親ユニット同期
        if (this.parentUnit) {
            this.direction = this.parentUnit.direction;
            if (this.parentUnit.hp == 0) this.remove();
        }

        //飛び道具迎撃
        this.parentScene.playerLayer.children.forEach(function(e) {
            if (e instanceof qft.PlayerAttack && e.isCollision) {
                if (e.type != "arrow" && e.type != "masakari") return;
                var dis = this.getDistance(e);
                if (dis < 64) {
                    this.phase = 20;
                    this.tweener.clear()
                        .moveTo(e.x, e.y, 5)
                        .call(() => {
                            this.phase = 10;
                        });
                }
            }
        }.bind(this));

        this.isAttack_before = this.isAttack;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [0];
        this.index = 0;
    },

    damage: function(target) {
        this.isDamaged = true;
        if (this.phase < 10) this.phase = 6; else this.phase = 17;

        //効果音
        app.playSE("tinkling");
        this.tweener.clear()
            .by({y: -64, rotation: 700}, 15, "easeOutQuad")
            .call(function() {
                if (this.phase < 10) this.phase = 0; else this.phase = 10;
                this.isDamaged = false;
            }.bind(this));
    },
});

/*
 *  enemy.ogre.js
 *  2017/05/06
 *  @auther minimo  
 *  This Program is MIT license.
 */

//オーガ
phina.define("qft.Enemy.Ogre", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 60,

    //防御力
    deffence: 10,

    //攻撃力
    power: 20,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 1000,

    //アイテムドロップ率（％）
    dropRate: 7,
    dropItem: ITEM_BAG,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWEL,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 20, height: 20});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(216, 0, 72, 128);
        this.sprite.setPosition(0, -5).setScale(1.3);

        this.hp += this.level * 5;
        this.power += this.level * 3;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 0.5;
            } else {
                this.vx = -0.5;
            }
            if (this.chaseTime > 0) this.vx *= 4;
        }

        if (look) {
            this.chaseTime = 150;
            this.turnCount = 0;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+40, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+40, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                    this.turnWait = 1;
                }
            }
        }
        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.orochi.js
 *  2017/06/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

//大蛇
phina.define("qft.Enemy.Orochi", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 700,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 32, height: 36});
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01x2", 24 * 2, 32 * 2).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72 * 2, 384 * 2, 72 * 2, 128 * 2)
            .setScale(1 + capLevel * 0.1)
            .setPosition(0, capLevel * -1 - 4);
        this.width += capLevel * 10;

        this.hp += this.level * 10;
        this.power += this.level * 5;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 15;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        if (this.isDead) return;

        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+10, this.y+40, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-10, this.y+40, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //プレイヤーが近くにいたらジャンプ攻撃
            if (look && !this.isJump && dis < 40) {
                this.isJump = true;
                this.vy = -6;
                var pl = this.parentScene.player;
                if (this.x > pl.x) {
                    this.direction = 180;
                } else {
                    this.direction = 0;
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look) {
            this.vx *= 4;
            this.flare('balloon', {pattern: "!", lifeSpan: 15, y: 0});
        } else {
            this.flare('balloonerace');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.slime.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//スライム
phina.define("qft.Enemy.Slime", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 100,

    //属性ダメージ倍率
    damageSting: 0.8,
    damageBlow: 0.5,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72, 256, 72, 128)
            .setScale(1 + capLevel * 0.2)
            .setPosition(0, -2 + capLevel * -3);
        this.width += capLevel * 5;

        this.hp += this.level * 10;
        if (this.level > 3) this.hp += 30;
        this.power += this.level * 5;
        this.point += this.level * 200;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
            if (this.level > 3　&& this.stopTime == 0) {
                this.attack();
                this.flare('balloon', {pattern: "anger1", lifeSpan: 60, y: 0, force: true});
            }
        });
    },

    algorithm: function() {
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //テリトリー指定
            if (this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }

            if (this.level < 4) {
                //プレイヤーが近くにいたらジャンプ攻撃
                if (look && !this.isJump && dis < 40) {
                    this.isJump = true;
                    this.vy = -6;
                    var pl = this.parentScene.player;
                    if (this.x > pl.x) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            this.vx =  2 + Math.floor(this.level*0.5) * this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
            }
        }
    },

    attack: function() {
        this.stopTime = 30;
        var vx = 1;
        if (this.direction == 180) vx = -1;
        for (var i = 0; i < this.level; i++) {
            var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 2});
            b.vy = -8;
            b.vx = i * 2 * vx;
        }
    },

    randomAttack: function() {
        this.stopTime = 30;
        var vx = 1;
        if (this.direction == 180) vx = -1;
        for (var i = 0; i < this.level; i++) {
            var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 2});
            b.vy = -8;
            b.vx = i * 2 * vx;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.snake.js
 *  2017/01/27
 *  @auther minimo  
 *  This Program is MIT license.
 */

//蛇
phina.define("qft.Enemy.Snake", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 150,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 3,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 18});
        this.superInit(parentScene, options);

        //表示用スプライト
        var capLevel = Math.min(this.level, 4);
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(capLevel * 72, 384, 72, 128)
            .setScale(1 + capLevel * 0.1)
            .setPosition(0, capLevel * -1)
        this.width += capLevel * 5;

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 100;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        if (this.isDead) return;

        //プレイヤーとの距離
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //プレイヤーが近くにいたらジャンプ攻撃
            if (look && !this.isJump && dis < 40) {
                this.isJump = true;
                this.vy = -6;
                var pl = this.parentScene.player;
                if (this.x > pl.x) {
                    this.direction = 180;
                } else {
                    this.direction = 0;
                }
            }
        }
        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 1;
            } else {
                this.vx = -1;
            }
        }
        if (look) {
            this.vx *= 4;
            this.flare('balloon', {pattern: "!", lifeSpan: 15, y: 0});
        } else {
            this.flare('balloonerace');
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.titan.js
 *  2017/05/06
 *  @auther minimo  
 *  This Program is MIT license.
 */

//巨人
phina.define("qft.Enemy.Titan", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 100,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 90,

    //得点
    point: 3000,

    //アイテムドロップ率（％）
    dropRate: 7,
    dropItem: ITEM_BAG,

    //レアドロップ率（％）
    rareDropRate: 2,
    rareDropItem: ITEM_JEWEL,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 25, height: 40});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster02x2", 24*2, 32*2).addChildTo(this);
        this.sprite.setFrameTrimming(216*2, 0, 72*2, 128*2);
        this.sprite.setPosition(0, -5);

        this.hp += this.level * 10;
        this.power += this.level * 5;
        this.point += this.level * 500;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.isAttack = false;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        //プレイヤーとの距離
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤー発見後一定時間追跡する
        if (this.chaseTime > 0 && !this.isAttack && this.turnTime == 0) {
            if (this.x > pl.x) {
                if (this.direction == 0) this.turnCount++;
                this.direction = 180;
            } else {
                if (this.direction == 180) this.turnCount++;
                this.direction = 0;
            }
            this.turnTime = 15;
            if (look) this.turnCount = 0;
            //プレイヤーを見失った状態で三回振り返った場合は追跡終了
            if (this.turnCount > 3) {
                this.flare('balloon', {pattern: "?"});
                this.stopTime = 30;
                this.chaseTime = 0;
            }
        }

        //一定距離以上離れたら追跡解除
        if (dis > 512) this.chaseTime = 0;

        if (this.isOnFloor || this.isJump) {
            if (this.direction == 0) {
                this.vx = 0.5;
            } else {
                this.vx = -0.5;
            }
            if (this.isJump) this.vx *= 1.5;
        }

        if (look) {
            this.chaseTime = 120;
            this.stopTime = 0;
            this.flare('balloon', {pattern: "!"});
        } else {
            if (this.chaseTime == 0) this.flare('balloonerace');
        }
        if (this.chaseTime > 0) this.vx *= 3;

        if (this.isOnFloor) {
            //これ以上進めない場合は折り返す
            var isReturnWall = false;
            var isReturnCliff = false;
            if (this.vx > 0) {
                if (this._collision[1].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x+5, this.y+40, 5, 5) == null) isReturnCliff = true;
            } else if (this.vx < 0) {
                if (this._collision[3].hit) isReturnWall = true;
                if (this.checkMapCollision2(this.x-5, this.y+40, 5, 5) == null) isReturnCliff = true;
            }
            if (isReturnWall || isReturnCliff) {
                if (this.chaseTime > 0) {
                    //プレイヤー追跡中で段差がある場合は飛び越える
                    if (isReturnWall) {
                        if (this.direction == 0) {
                            if (this.x < pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        } else {
                            if (this.x > pl.x) {
                                this.isJump = true;
                                this.vy = -10;
                            }
                        }
                    }
                    //プレイヤー追跡中で崖がある場合は着地点があるか調べて飛び降りる
                    if (isReturnCliff) {
                        var jumpOk = false;
                        if (this.direction == 0) {
                            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 96)) jumpOk = true;
                        } else {
                            if (this.checkMapCollision2(this.x-5, this.y+20, 5, 96)) jumpOk = true;
                        }
                        if (jumpOk) {
                            this.isJump = true;
                            this.vy = -5;
                        } else {
                            //着地点が無い場合は諦めて折り返す
                            this.chaseTime = 0;
                            this.stopTime = 30;
                            this.turnWait = 15;
                            this.direction = (this.direction + 180) % 360;
                            this.vx = 0;
                            this.flare('balloon', {pattern: "..."});
                         }
                    }
                } else {
                    this.direction = (this.direction + 180) % 360;
                    this.vx *= -1;
                    this.turnWait = 1;
                }
            }

            //攻撃
            if (look && !this.isJump && dis < 64 && !this.isAttack) {
                this.attack();
            }
        }
        if (this.chaseTime == 30) this.flare('balloon', {pattern: "?"});
    },

    attack: function() {
        var that = this;
        var atk = qft.EnemyAttack(this.parentScene, {width: 1, height: 24, power: 40 + this.level * 5})
            .addChildTo(this.parentScene.enemyLayer)
            .setPosition(this.x + this.scaleX * 18, this.y)
            .setAlpha(0.0);
        if (DEBUG_COLLISION) atk.setAlpha(0.3);
        atk.master = this;
        atk.tweener.setUpdateType('fps');
        atk.update = function() {
            this.x = that.x + that.scaleX * 18;
        }

        atk.isActive = false;
        atk.tweener.clear()
            .wait(6)
            .call(function() {
                atk.isActive = true;
                that.vx = 24 * that.scaleX;
            })
            .wait(6)
            .call(function() {
                that.isAttack = false;
                atk.remove();
            });
        this.isAttack = true;
        this.stopTime = 30;

        qft.Balloon({pattern: "anger2"}).addChildTo(this).setPosition(0, -this.height/2-10);
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  enemy.wisp.js
 *  2016/12/31
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ウィスプ
phina.define("qft.Enemy.Wisp", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //重力加速度
    gravity: 0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 360,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 100,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_STONE,

    //レアドロップ率（％）
    rareDropRate: 0,
    rareDropItem: ITEM_STONE,

    //属性ダメージ倍率
    damageFire: 0.8,
    damageIce: 2,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(Math.min(this.level, 4) * 72, 512, 72, 128);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.eyesight += this.level * 64,
        this.point += this.level * 200;

        this.setAnimation("stand");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.move = false;
        this.attackCount = 0;
    },

    algorithm: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤーが近くにいたら寄っていく
        if (look) {
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(pl.x, pl.y);
            var p = p2.sub(p1);
            p.normalize();
            this.vx = p.x * (1 + this.level * 0.2);
            this.vy = p.y * (1 + this.level * 0.2);
        } else {
            this.vx = 0;
            this.vy = 0;
        }

        //攻撃
        if (this.level > 3 && dis < 128) {
            this.attackCount--;
            if (this.attackCount == 0) {
                for (var i = 0; i < this.level; i++) {
                    var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 1});
                    b.vy = -10;
                    b.vx = (i*2) * this.scaleX;
                }
                this.attackCount = 180 - this.level * 15;
            }
        } else {
            this.attackCount = 60;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

//ウィスプ（強）
phina.define("qft.Enemy.WispHard", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 20,

    //重力加速度
    gravity: 0,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 128,

    //視野角
    viewAngle: 360,

    //地形無視
    ignoreCollision: true,

    //得点
    point: 300,

    //アイテムドロップ率（％）
    dropRate: 10,
    dropItem: ITEM_STONE,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_JEWEL,

    //属性ダメージ倍率
    damageFire: 0.5,
    damageIce: 2,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster01", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(288, 512, 72, 128);

        this.setAnimation("stand");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.move = false;
        this.attackCount = 0;
    },

    update: function() {
        var pl = this.parentScene.player;
        var dis = this.getDistancePlayer();
        var look = this.isLookPlayer();

        //プレイヤーが近くにいたら寄っていく
        if (look) {
            var player = this.parentScene.player;
            var p1 = phina.geom.Vector2(this.x, this.y);
            var p2 = phina.geom.Vector2(player.x, player.y);
            var p = p2.sub(p1);
            p.normalize();
            this.vx = p.x / 2;
            this.vy = p.y / 2;
        } else {
            this.vx = 0;
            this.vy = 0;
        }

        //攻撃
        if (dis < 160) {
            this.attackCount--;
            if (this.attackCount == 0) {
                for (var i = 0; i < this.level+4; i++) {
                    var b = this.parentScene.spawnEnemy(this.x, this.y, "WispBomb", {pattern: 1});
                    b.vy = -10;
                    b.vx = (i*2) * this.scaleX;
                }
                this.attackCount = 180 - this.level * 15;
            }
        } else {
            this.attackCount = 60;
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [3, 4, 5, 4];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

phina.define("qft.Enemy.WispBomb", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 1,

    //横移動減衰率
    friction: 0.99,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //得点
    point: 0,

    //無敵フラグ
    isMuteki: true,

    init: function(parentScene, options) {
        this.superInit(parentScene, {width: 10, height: 10});
        options = options || {};
        this.$extend(options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("particle", 16, 16).addChildTo(this).setFrameIndex(31);
        this.animationInterval = 3;

        this.pattern = options.pattern || 1;
        this.setAnimation("pattern"+this.pattern);

        this.on('dead', function() {
        });
    },

    update: function() {
        if (this.isOnFloor) {
            if (this.onScreen) app.playSE("bomb");
            var b = this.parentScene.spawnEnemy(this.x, this.y, "Flame", {pattern: 1});
            this.remove();
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["pattern1"] = [31, 30, 29, 28, 27, 26, "stop"];
        this.frame["pattern2"] = [31, 30, 29, 28, 27, 26, "stop"];
        this.index = 0;
    },

    dropDead: function() {
        this.isDead = true;
        this.isDrop = true;
        return this;
    },
});

/*
 *  enemy.wizard.js
 *  2017/08/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//ウィザード
phina.define("qft.Enemy.Wizard", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 50,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //視力
    eyesight: 256,

    //視野角
    viewAngle: 360,

    //得点
    point: 3000,

    //重力加速度
    gravity: 0,

    //アイテムドロップ率（％）
    dropRate: 30,
    dropItem: ITEM_COIN,

    //レアドロップ率（％）
    rareDropRate: 5,
    rareDropItem: ITEM_BAG,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this)
            .setFrameTrimming(0, 0, 72, 128)
            .setScale(1.2);

        this.hp += this.level * 5;
        this.power += this.level * 2;
        this.point += this.level * 300;

        this.setAnimation("walk");
        this.animationInterval = 10;
        this.setupLifeGauge();

        this.direction = 0;
        this.speed = 1;
        this.isAttack = false;

        //行動フェーズ
        this.phase = "wait";

        //接近戦経過時間
        this.nearCount = 0;

        this.on('damaged', e => {
            if (e.direction == 0) this.direction = 180; else this.direction = 0;
        });
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

        //待機中
        if (this.phase == "wait") {
            if (look) {
                this.flare('balloon', {pattern: "!", lifeSpan: 15});
                this.phase = "approach";
            }
        }

        //プレイヤー発見後接近
        if (this.phase == "approach") {
        }

        if (distance < 128) {
            this.nearCount++
        } else {
            this.nearCount = 0;
        }
    },

    //テレポート開始
    teleportIn: function() {
        this.sprite.tweener.fadeOut(30);
        for (var i = 0; i < 7; i++) {
            var sp = phina.display.Sprite("monster03", 24, 32)
                .addChildTo(this)
                .setFrameTrimming(0, 0, 72, 128);
            sp.tweener.setUpdateType('fps').clear()
                .by({x: -64 + i * 16, alpha: -1}, 30,"easeOutSine");
        }
    },

    //テレポート終了
    teleportOut: function() {
        this.sprite.tweener.fadeIn(30);
        for (var i = 0; i < 7; i++) {
            var sp = phina.display.Sprite("monster03", 24, 32)
                .addChildTo(this)
                .setFrameTrimming(0, 0, 72, 128);
            sp.tweener.setUpdateType('fps').clear()
                .by({x: -64 + i * 16, alpha: -1}, 30,"easeOutSine");
        }
    },

    //分身
    cloneMySelf: function() {
    },

    //火炎魔法
    flame: function() {
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },

    firstFrame: function() {
    },
});

//ウィザード分身
phina.define("qft.Enemy.WizardClone", {
    superClass: "qft.Enemy",

    //ヒットポイント
    hp: 10,

    //防御力
    deffence: 10,

    //攻撃力
    power: 10,

    //得点
    point: 0,

    //重力加速度
    gravity: 0,

    //アイテムドロップ率（％）
    dropRate: 0,

    //レアドロップ率（％）
    rareDropRate: 0,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 16, height: 16});
        this.superInit(parentScene, options);

        //表示用スプライト
        var lv = Math.min(this.level, 3);
        this.sprite = phina.display.Sprite("monster03", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming((lv % 2) * 144 + 72, Math.floor(lv / 2) * 128, 72, 128);
        this.sprite.setScale(1.2);

        this.setAnimation("walk");
        this.animationInterval = 10;

        this.direction = 0;
        this.speed = 1;
        this.phase = 0;
        this.isAttack = false;
        this.isTeleport = false;
    },

    algorithm: function() {
        var player = this.parentScene.player;
        var look = this.isLookPlayer();
        var distance = this.getDistancePlayer();

    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [0, 1, 2, 1];
        this.frame["jump"] = [3, "stop"];
        this.frame["walk"] = [3, 4, 5, 4];
        this.frame["up"] =   [3, 4, 5, 4];
        this.frame["down"] = [3, 4, 5, 4];
        this.frame["attack"] = [3, "stop"];
        this.index = 0;
    },
});

/*
 *  mapobject.accessory.js
 *  2017/01/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//マップ装飾アクセサリ
phina.define("qft.MapObject.Accessory", {
    superClass: "qft.Character",

    id: null,

    //識別フラグ
    isMapAccessory: true,

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 2,

    isAdvanceAnimation: true,

    //地形無視
    ignoreCollision: true,

    init: function(parentScene, options) {
        this.options = (options || {}).$safe({
            width: 32,
            height: 32,
            index: 0,
        })
        this.superInit(parentScene, {width: this.options.width, height: this.options.height});

        this.id = options.id;
        this.level = options.properties.level || 0;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [2, 1, 0, 3];
        this.frame["normal2"] = [1, 0, 3, 2];
        this.index = 0;
    },
});

//ランプ
phina.define("qft.MapObject.Lamp", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this).setFrameIndex(0);
        this.sprite.setFrameTrimming(this.level * 24, 0, 24, 128);

        //アニメーション設定
        if (this.id % 2) {
            this.setAnimation("normal");
        } else {
            this.setAnimation("normal2");
        }
        this.animationInterval = 8;
    },
});

//たき火
phina.define("qft.MapObject.Bonfire", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this).setFrameIndex(0);
        this.sprite.setFrameTrimming(this.level * 24, 128, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//炎
phina.define("qft.MapObject.Flame", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame02", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(this.level * 24 + 72, 0, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//火
phina.define("qft.MapObject.Fire", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame05", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(this.level * 24 + 72, 0, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//燭台
phina.define("qft.MapObject.Candle", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("flame05", 24, 32).addChildTo(this);
        this.sprite.setFrameTrimming(this.level * 24 + 72, 128, 24, 128);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },
});

//ランタン
phina.define("qft.MapObject.Lanthanum", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("accessory1", 16, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 96, 72, 32);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [0, 1, 2, 1];
        this.index = 0;
    },
});

//ランプ２
phina.define("qft.MapObject.CandleLamp", {
    superClass: "qft.MapObject.Accessory",

    init: function(parentScene, options) {
        this.superInit(parentScene, options);

        //表示用スプライト
        this.sprite = phina.display.Sprite("accessory1", 16, 32).addChildTo(this);
        this.sprite.setFrameTrimming(0, 32, 72, 32);

        //アニメーション設定
        this.setAnimation("normal");
        this.animationInterval = 3;
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["normal"] = [0, 1, 2, 1];
        this.index = 0;
    },
});

/*
 *  mapobject.block.js
 *  2017/03/13
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//ブロッククラス
phina.define("qft.MapObject.Block", {
    superClass: "qft.Character",

    id: null,

    //耐久力
    hp: 30,

    //識別フラグ
    isBlock: true,

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 1,

    isAdvanceAnimation: false,

    //地形無視
    ignoreCollision: true,

    init: function(parentScene, options) {
        this.options = (options || {}).$safe({
            width: 32,
            height: 32,
            index: 0,
        })
        this.superInit(parentScene, {width: this.options.width, height: this.options.height});

        this.id = options.id;

        //スプライト
        this.index = options.index;
        this.sprite = phina.display.Sprite("block", 32, 32).addChildTo(this).setFrameIndex(this.index);

        var param = {
            width: 32,
            height: 32,
            fill: "rgba(0, 0, 0, 0.0)",
            stroke: "black",
            strokeWidth: 1,
            backgroundColor: 'transparent',
        };
        this.waku = phina.display.RectangleShape(param).setPosition(0, 0);
        if (options.enableFrame) this.waku.addChildTo(this);

        //スクリプト
        if (options.properties.script) {
            var sc = "(function(app) {"+options.properties.script+"})";
            var f = eval(sc);
            this.on('enterframe', f);
        }

        this.on('dead', function() {
            this.sprite.remove();
            this.waku.remove();
            if (this.collision) this.collision.remove();
            var s = [];
            s[0] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition(-8, -8).setFrameIndex(this.index * 2 + 0);
            s[1] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition( 8, -8).setFrameIndex(this.index * 2 + 1);
            s[2] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition(-8,  8).setFrameIndex(this.index * 2 + 16 + 0);
            s[3] = phina.display.Sprite("block", 16, 16).addChildTo(this).setPosition( 8,  8).setFrameIndex(this.index * 2 + 16 + 1);
            //スプライトがバラバラに壊れるよ
            (4).times(function(i) {
                s[i].update = function() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vx *= 0.9;
                    this.vy += 0.9;
                    this.rotation += this.rot;
                    this.alpha -= 0.05;
                }
                s[i].vx = 0;
                s[i].vy = -5;
            }.bind(this));
            s[0].vx = -6; s[0].rot = -3;
            s[1].vx =  6; s[1].rot =  3;
            s[2].vx = -3; s[2].rot = -3;
            s[3].vx =  3; s[3].rot =  3;
            this.tweener.clear()
                .wait(10)
                .call(function() {
                    this.remove();
                }.bind(this));
        });
    },

    update: function(e) {
        if (this.collision) {
            this.collision.x = this.x;
            this.collision.y = this.y;
        }
        if (!this.isDead) {
            //プレイヤー攻撃（固定）との当たり判定
            var pl = this.parentScene.player;
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                this.damage(pl);
            }
            //プレイヤー攻撃判定との当たり判定
            this.parentScene.playerLayer.children.forEach(function(e) {
                if (e instanceof qft.PlayerAttack && e.isCollision && this.hitTestElement(e)) {
                    e.remove();
                    this.damage(e);
                }
            }.bind(this));
        }
        this.visible = true;    //点滅キャンセル
    },

    damage: function(target) {
        if (this.isDead) return;
        if (this.mutekiTime > 0) return;
        this.hp -= target.power;
        this.mutekiTime = 10;
        if (this.hp <= 0) {
            this.isDead = true;
            this.flare('dead');
            return;
        }
        var dir = 2;
        if (this.x < target.x) dir = -2;
        this.sprite.tweener.clear()
            .moveBy(dir, 0, 1)
            .moveBy(-dir, 0, 1)
            .call(function(){
                app.playSE("hit_blunt");
            });
    },

    //当たり判定の追加
    addCollision: function (layer) {
        this.collision = phina.display.RectangleShape({width: 32, height: 32})
            .addChildTo(layer)
            .setPosition(this.x, this.y)
            .setVisible(DEBUG_COLLISION);
        this.collision.alpha = 0.3;
        this.collision.vx = 0;
        this.collision.vy = 0;
        this.collision.ignore = false;
        this.collision.type = "block";
    }
});

/*
 *  mapobject.door.js
 *  2017/01/14
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//大型ドアクラス
phina.define("qft.MapObject.Door", {
    superClass: "qft.Character",

    id: null,

    //重力加速度
    gravity: 0.0,

    //アニメーション間隔
    animationInterval: 3,

    //地形無視
    ignoreCollision: true,

    //実行済みフラグ
    already: false,

    //ロックされているか
    isLock: false,

    init: function(parentScene, options) {
        var width = options.width || 36;
        var height = options.height || 64;
        this.superInit(parentScene, {width: width, height: height});

        //スプライト
        this.sprite = phina.display.Sprite("door", 36, 64).addChildTo(this).setFrameIndex(3);
        this.setAnimation("closed");

        this.id = options.id;
        this.isLock = options.properties.lock || false;
        this.name = options.name;
        this.enterOffset = options.properties.enterOffset || 0;
        this.sprite.visible = options.properties.visible == undefined? true: options.properties.visible;

        //ドア機能
        var properties = options.properties;
        switch (options.name) {
            //クリア
            case "clear":
                this.isLock = true;
                this.on('enterdoor', function() {
                    this.parentScene.flare('stageclear');
                });
                break;
            //マップ内移動
            case "warp":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.on('enterdoor', function() {
                    //行き先の検索
                    var next = this.findDoor(this.nextID);
                    if (!next) return;
                    this.enterPlayer();
                    this.parentScene.warp(next.x, next.y+next.offset);
                    this.tweener.clear()
                        .wait(120)
                        .call(function(){
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                });
                break;
            //マップ切り替え
            case "mapswitch":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.toLayerNumber = properties.toLayerNumber;
                this.on('enterdoor', function() {
                    var layer = this.parentScene.stageController.mapLayer[this.toLayerNumber];
                    var next = this.parentScene.stageController.findObject(this.nextID, this.toLayerNumber);
                    if (!next) return;
                    this.enterPlayer();
                    this.tweener.clear()
                        .wait(60)
                        .call(function(){
                            this.parentScene.switchMap(layer);
                            this.parentScene.player.setPosition(next.x, next.y + next.offset);
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                    this.parentScene.fg.tweener.clear().wait(30).fadeIn(30).fadeOut(30);
                });
                break;
        }
    },

    update: function(e) {
        //近くに来たら自動的に開ける
        if (this.getDistancePlayer() < 64) {
            if (!this.isLock) this.open();
        } else {
            if (this.nowAnimation == "open") {
                this.close();
            }
        }

        //プレイヤーとの当たり判定
        var pl = this.parentScene.player;
        var hit = this.hitTestElement(pl);
        if (hit && !this.isLock && !this.already) {
            if (this.name == "clear") {
                //ステージクリアの扉は無条件で入る
                this.flare('enterdoor');
                this.already = true;
            }
        }
    },

    setupAnimation: function(options) {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["opend"] = [3, "stop"];
        this.frame["closed"] = [2, "stop"];
        this.frame["open"] = [2, 1, 0, 3, "stop"];
        this.frame["close"] = [3, 0, 1, 2, "stop"];
        this.index = 0;
    },

    open: function() {
        this.setAnimation("open");
    },

    close: function() {
        this.setAnimation("close");
    },

    //プレイヤーが扉に入る
    enterPlayer: function() {
        var enterOffset = this.enterOffset;
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1")
            .setPosition(player.x, player.y)
            .addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.setAnimation("up");
        pl.tweener.clear().setUpdateType('fps')
            .moveTo(this.x, this.y+this.height/2-16+enterOffset, 15)
            .call(function() {
                pl.animation = false;
            })
            .fadeOut(15)
            .call(function() {
                pl.remove();
            });
    },

    //プレイヤーが扉から出る
    leavePlayer: function() {
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1")
            .setPosition(this.x, this.y+16)
            .addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.alpha = 0;
        pl.setAnimation("down");
        pl.tweener.clear().setUpdateType('fps')
            .fadeIn(15)
            .moveTo(player.x, player.y, 30)
            .fadeIn(10)
            .call(function() {
                player.alpha = 1;
                player.isControl = true;
                player.isMuteki = false;
                pl.remove();
            });
    },

    //他の扉を検索
    findDoor: function(id) {
        var result = null;
        this.parentScene.objLayer.children.forEach(function(e) {
            if (e instanceof qft.MapObject.Door) {
                if (e.id == id) result = e;
            }
        }.bind(this));
        return result;
    },
});

/*
 *  mapobject.floor.js
 *  2017/03/27
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//可動フロアクラス
phina.define("qft.MapObject.Floor", {
    superClass: "qft.Character",

    id: null,

    //識別フラグ
    isFloor: true,

    //重力加速度
    gravity: 0.0,

    //移動フラグ
    isActive: true,

    //プレイヤーが上に乗ってるフラグ
    isOnPlayer: false,

    //アニメーション進行可能フラグ
    isAdvanceAnimation: false,

    //地形無視
    ignoreCollision: true,

    //移動パス
    movePath: null,

    //移動パス現在時間(0-1)
    pathTime: 0,

    init: function(parentScene, options) {
        this.options = (options || {}).$safe({
            width: 32,
            height: 32,
            index: 0,
        })
        this.superInit(parentScene, {width: this.options.width, height: this.options.height});

        this.id = options.id;

        this.moveType = options.properties.moveType || "linear";
        this.moveAngle = options.properties.moveAngle || 0;
        this.moveLength = options.properties.moveLength || 0;
        this.moveRadius = options.properties.moveRadius || 64;
        this.moveSpeed = options.properties.moveSpeed || 60;
        this.moveWait = (options.properties.moveWait !== undefined)? options.properties.moveWait: 60;

        //始点と終点
        this.startX = options.x + (options.width || 16) / 2;
        this.startY = options.y + (options.height || 16) / 2;
        if (this.moveLength > 0) {
            //移動距離が設定されている場合
            var rad = this.moveAngle.toRadian();
            this.endX = this.startX + Math.cos(rad) * this.moveLength;
            this.endY = this.startY + Math.sin(rad) * this.moveLength;
        } else {
            //終点座標が設定されている場合
            this.endX = options.properties.endX || this.startX;
            this.endY = options.properties.endY || this.startY;
        }

        //円運動の場合は中心を設定（無い場合は終点を中心とする）
        if (this.moveType == "circle") {
            this.centerX = options.properties.centerX || this.endX;
            this.centerY = options.properties.centerY || this.endY;
        }

        //移動パターン
        switch (this.moveType) {
            //直線運動
            case "linear":
                this.tweener.clear()
                    .moveTo(this.endX, this.endY, this.moveSpeed, "easeInOutSine")
                    .call(function() {this.flare('moveend');}.bind(this))
                    .wait(this.moveWait)
                    .moveTo(this.startX, this.startY, this.moveSpeed, "easeInOutSine")
                    .call(function() {this.flare('movestart');}.bind(this))
                    .wait(this.moveWait)
                    .setLoop(true);
                break;
            //円運動
            case "circle":
                this.angle = 0;
                if (options.properties.counterClockWise) {
                    //反時計回り
                    this.tweener.clear()
                        .to({angle: -360}, this.moveSpeed)
                        .call(function() {this.flare('moveend');}.bind(this))
                        .set({angle: 0})
                        .setLoop(true);
                } else {
                    //時計回り
                    this.tweener.clear()
                        .to({angle: 360}, this.moveSpeed)
                        .call(function() {this.flare('moveend');}.bind(this))
                        .set({angle: 0})
                        .setLoop(true);
                    break;
                }
            //設定されたパスに沿って移動
            case "path":
                break;
        }

        //スプライト
        this.index = options.properties.index || 0;
        var sw = Math.floor(this.width / 16);
        var sh = Math.floor(this.height / 16)+32;
        var top = this.height / 2;
        for (var x = 0; x < sw; x++) {
            var idx = (x % 2) + 1;
            if (x == 0) idx = 0;
            if (x == sw-1) idx = 3;
            var s = phina.display.Sprite("floor", 16, 96)
                .addChildTo(this)
                .setFrameTrimming(this.index * 64, 32, 64, 96)
                .setFrameIndex(idx)
                .setPosition(x * 16 - this.width / 2 + 8, 16-top);
        }
    },

    update: function(e) {
        if (this.moveType == "circle") {
            var rad = this.radius.toRadian();
            this.x = this.centerX + Math.cos(rad) * this.moveRadius;
            this.y = this.centerY + Math.sin(rad) * this.moveRadius;
        } else if (this.moveType == 'path') {
        }

        //停止と再生
        if (!this.isActive) this.tweener.pause();
        if (this.isActive) this.tweener.play();

        if (this.collision) {
            this.collision.vx = this.x - this.collision.x;
            this.collision.vy = this.y - this.collision.y;
            this.collision.x = this.x;
            this.collision.y = this.y;
        }

        //プレイヤーが上に乗っているか判定
        var pl = this.parentScene.player;
        this.isOnPlayer = false;
        if (pl.floorObject && pl.floorObject.parentObject === this) {
            this.isOnPlayer = true;
            //床が下降している時のみ
            if (!pl.isJump && this.collision.vy > 0) {
                pl.y = this.y - this.height * 0.5;
            }
        }
    },

    //フロア当たり判定の追加
    addCollision: function (layer) {
        this.collision = phina.display.RectangleShape({width: this.width, height: this.height})
            .addChildTo(layer)
            .setPosition(this.x, this.y)
            .setVisible(DEBUG_COLLISION);
        this.collision.alpha = 0.3;
        this.collision.vx = 0;
        this.collision.vy = 0;
        this.collision.ignore = false;
        this.collision.type = "movefloor";
        this.collision.parentObject = this;
    },

    //移動パスの設定
    setPath: function(startX, startY, path, loop) {
        this.x = startX;
        this.y = startY;
        this.path = path;
        this.loop = loop;

        if (loop) {
            //距離計算
            var sum = 0;
            for (var i = 0; i < path.length - 1; i++) {
                var p1 = path[i];
                var p2 = path[i+1];
                p2.magnitude = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
                sum += p2.magnitude;
            }
            //終点から始点までの距離を加算
            var p1 = path[path.length - 1];
            var p2 = path[0];
            p2.magnitude = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
            sum += p2.magnitude;
            var unit = this.moveSpeed / sum;

            this.tweener.clear().wait(60);
            for (var i = 1; i < path.length; i++) {
                var p = path[i];
                var time = Math.floor(p.magnitude * unit);
                this.tweener.moveTo(startX + p.x, startY + p.y, time);
            }
            this.tweener.moveTo(startX + path[0].x, startY + path[0].y, time);
            this.tweener.setLoop(true);
        } else {
            //往路距離計算
            var sum = 0;
            for (var i = 0; i < path.length - 1; i++) {
                var p1 = path[i];
                var p2 = path[i+1];
                p2.magnitude = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
                sum += p2.magnitude;
            }
            var unit = this.moveSpeed / sum;

            //復路距離計算
            for (var i = path.length - 1; i > 0; i--) {
                var p1 = path[i];
                var p2 = path[i-1];
                p2.magnitude_ret = Math.sqrt((p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y));
            }

            this.tweener.clear().wait(60);
            for (var i = 1; i < path.length; i++) {
                var p = path[i];
                var time = Math.floor(p.magnitude * unit);
                this.tweener.moveTo(startX + p.x, startY + p.y, time);
            }
            this.tweener.wait(60);
            for (var i = path.length - 2; i >= 0; i--) {
                var p = path[i];
                var time = Math.floor(p.magnitude_ret * unit);
                this.tweener.moveTo(startX + p.x, startY + p.y, time);
            }
            this.tweener.setLoop(true);
        }
    },
});

/*
 *  mapobject.gate.js
 *  2017/03/20
 *  @auther minimo  
 *  This Program is MIT license.
 */

qft.MapObject = qft.MapObject || {};

//ワープゲート
phina.define("qft.MapObject.Gate", {
    superClass: "qft.Character",

    id: null,

    //重力加速度
    gravity: 0.0,

    //地形無視
    ignoreCollision: true,

    //実行済みフラグ
    already: false,

    //ロックされているか
    isLock: false,

    //アニメーションフラグ
    isAdvanceAnimation: false,

    init: function(parentScene, options) {
        var width = options.width || 36;
        var height = options.height || 64;
        this.superInit(parentScene, {width: width, height: height});
        this.width_half = width / 2;
        this.height_half = height / 2;

        this.id = options.id;
        this.isLock = options.properties.lock || false;
        this.name = options.name;
        this.enterOffset = options.properties.enterOffset || 0;

        //スプライト
        this.sprite = null;

        //ゲート機能
        var properties = options.properties;
        switch (options.name) {
            //マップ内移動
            case "warp":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.on('enterdoor', function() {
                    //行き先の検索
                    var next = this.findGate(this.nextID);
                    if (!next) return;
                    this.enterPlayer();
                    this.parentScene.warp(next.x, next.y+next.offset);
                    this.tweener.clear()
                        .wait(120)
                        .call(function(){
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                });
                break;
            //マップ切り替え
            case "mapswitch":
                this.nextID = properties.nextID;
                this.offset = properties.offset || 0;
                this.toLayerNumber = properties.toLayerNumber;
                this.on('enterdoor', function() {
                    var layer = this.parentScene.stageController.mapLayer[this.toLayerNumber];
                    var next = this.parentScene.stageController.findObject(this.nextID, this.toLayerNumber);
                    if (!next) return;
                    this.enterPlayer();
                    this.tweener.clear()
                        .wait(60)
                        .call(function(){
                            this.parentScene.switchMap(layer);
                            this.parentScene.player.setPosition(next.x, next.y + next.offset);
                            this.already = false;
                            next.leavePlayer();
                        }.bind(this));
                    this.parentScene.fg.tweener.clear().wait(30).fadeIn(30).fadeOut(30);
                });
                break;
        }

        this.time = 0;
    },

    update: function() {
        //パーティクル
        if (!this.isLock && this.time % 6 == 0) {
            (2).times(function(i) {
                var sp = phina.display.Sprite("particle", 16, 16)
                    .addChildTo(this)
                    .setFrameIndex(0)
                    .setScale(0)
                    .setPosition(Math.randint(-this.width_half, this.width_half), this.height_half + Math.randint(-4, 4));
                sp.alpha = 0.3;
                sp.tweener.clear()
                    .by({y: -48, alpha:  0.9, scaleX:  0.3, scaleY:  0.3}, 1000, "easeInSine")
                    .by({y: -48, alpha: -0.9, scaleX: -0.3, scaleY: -0.3}, 1000, "easeOutSine")
                    .call(function() {
                        this.remove();
                    }.bind(sp));
            }.bind(this));
        }
    },

    //プレイヤーがゲートに入る
    enterPlayer: function() {
        var enterOffset = this.enterOffset;
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1").setPosition(player.x, player.y).addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.setAnimation("walk");
        pl.tweener.clear().setUpdateType('fps')
            .moveTo(this.x, this.y+enterOffset, 15)
            .call(function() {
                pl.animation = false;
            })
            .fadeOut(15)
            .call(function() {
                pl.remove();
            });
    },

    //プレイヤーがゲートから出る
    leavePlayer: function() {
        var player = this.parentScene.player;
        player.alpha = 0;
        player.isControl = false;
        player.isMuteki = true;
        var pl = qft.PlayerDummy("player1").setPosition(this.x, this.y).addChildTo(this.parentScene.mapLayer.playerLayer);
        pl.alpha = 0;
        pl.setAnimation("walk");
        pl.animation = false;
        pl.tweener.clear().setUpdateType('fps')
            .fadeIn(15)
            .moveTo(player.x, player.y, 30)
            .fadeIn(10)
            .call(function() {
                player.alpha = 1;
                player.isControl = true;
                player.isMuteki = false;
                pl.remove();
            });
    },

    //他のゲートを検索
    findGate: function(id) {
        var result = null;
        this.parentScene.objLayer.children.forEach(function(e) {
            if (e instanceof qft.MapObject.Gate) {
                if (e.id == id) result = e;
            }
        }.bind(this));
        return result;
    },
});

/*
 *  mapobject.npc.js
 *  2017/08/09
 *  @auther minimo  
 *  This Program is MIT license.
 */

//冒険者
phina.define("qft.MapObject.npc", {
    superClass: "qft.Character",

    //移動速度
    speed: 2,

    //アニメーション間隔
    animationInterval: 8,

    //影表示フラグ
    isShadow: true,

    //移動フラグ
    isMove: true,

    //不動フラグ
    toFix: false,

    init: function(parentScene, options) {
        options = (options || {}).$extend({width: 24, height: 20});
        this.superInit(parentScene, options);

        this.sprite = phina.display.Sprite("actor" + (options.properties.actor || "40"), 32, 32).addChildTo(this);
        this.sprite.scaleX = -1;

        this.speed = options.properties.speed || this.speed;
        this.isMove = (options.properties.isMove === undefined? true: options.properties.isMove);
        this.territory = options.properties.territory || null;
        this.direction = options.properties.direction || 0;
        this.text = options.properties.text;

        if (options.properties.toFix) {
            this.ignoreCollision = true;
            this.gravity = 0;
            this.isMove = false;
            this.toFix = true;
            this.one('enterframe', () => {
                this.setupFixedShadow();
            });
        }

        this.setAnimation("walk");

        this.waitTime = 0;

        this.one('enterframe', () => {
            if (!this.isMove) {
                switch (this.direction) {
                    case 0:
                        this.setAnimation("walk");
                        this.scaleX = 1;
                        break;
                    case 90:
                        this.setAnimation("down");
                        break;
                    case 180:
                        this.setAnimation("walk");
                        this.scaleX = -1;
                        break;
                    case 270:
                        this.setAnimation("up");
                        break;
                }
            }
        });
    },

    update: function() {
        if (this.waitTime == 0) {
            if (this.isMove) {
                this.moveAlgorithm();
            }

            //プレイヤー攻撃との当たり判定
            var pl = this.parentScene.player;
            if (pl.isAttack && this.hitTestElement(pl.attackCollision)) {
                //話しかけた事になる
                this.tweener.clear()
                    .wait(5)
                    .call(()=> {
                        var scene = qft.ConversationScene(this.parentScene, this.text);
                        app.pushScene(scene);
                    });
                this.waitTime = 15;

                //向きの調整
                this.setAnimation("walk");
                if (this.x < pl.x) {
                    this.scaleX = 1;
                } else {
                    this.scaleX = -1;
                }
            }
        }

        this.waitTime--;
        if (this.waitTime < 0) this.waitTime = 0;
    },

    moveAlgorithm: function() {
        if (this.isOnFloor) {
            //崖っぷちで折り返す
            if (this.checkMapCollision2(this.x+5, this.y+20, 5, 5) == null) {
                this.direction = 180;
            } else if (this.checkMapCollision2(this.x-5, this.y+20, 5, 5) == null) {
                this.direction = 0;
            }

            //壁に当たったら折り返す
            if (this._collision[1].hit) {
                this.direction = 180;
            } else if (this._collision[3].hit) {
                this.direction = 0;
            }

            //テリトリー指定
            if (this.territory) {
                //水平方向のみチェック
                var tx = this.x - this.firstX;
                if (Math.abs(tx) > this.territory) {
                    if (tx > 0) {
                        this.direction = 180;
                    } else {
                        this.direction = 0;
                    }
                }
            }
        }

        if (this.isOnFloor) {
            this.vx =  this.speed;
            if (this.direction == 180) {
                this.vx *= -1;
                this.scaleX = -1;
            } else {
                this.scaleX = 1;
            }
        }
    },

    setupAnimation: function() {
        this.spcialAnimation = false;
        this.frame = [];
        this.frame["stand"] = [13, 14];
        this.frame["jump"] = [36, "stop"];
        this.frame["walk"] = [ 3,  4,  5,  4];
        this.frame["up"] =   [ 9, 10, 11, 10];
        this.frame["down"] = [ 0,  1,  2,  1];
        this.frame["attack"] = [ 41, 42, 43, 44, "stop"];
        this.frame["defense"] = [ 41, 42, 43, 44, "stop"];
        this.frame["damage"] = [ 18, 19, 20];
        this.frame["drop"] = [18, 19, 20];
        this.frame["dead"] = [18, 19, 20, 33, 34, 35, "stop"];
        this.frame["clear"] = [24, 25, 26];
        this.frame["stun"] = [ 18, 19, 20];
        this.index = 0;
        return this;
    },

    //固定影表示セットアップ
    setupFixedShadow: function() {
        var that = this;
        var sc = this.width / 24;
        if (sc < 1) sc += 0.2;
        this.fixedShadowSprite = phina.display.Sprite("shadow", 24, 8)
            .addChildTo(this.parentScene.shadowLayer)
            .setAlpha(0.5)
            .setScale(sc, 1.0);
        this.fixedShadowSprite.update = function() {
            this.alpha = 0.5;
            if (that.alpha < 0.5) this.alpha = that.alpha;
            this.x = that.x;
            this.y = that.y + 16;
        }
    },
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAwMF9wbHVnaW5zL3BoaW5hLmFzc2V0bG9hZGVyZXguanMiLCIwMDBfcGx1Z2lucy9waGluYS5leHRlbnNpb24uanMiLCIwMDBfcGx1Z2lucy9waGluYS50aWxlZG1hcC5qcyIsIjAwMF9wbHVnaW5zL3BoaW5hLnZpcnR1YWxwYWQuanMiLCIwMDBfcGx1Z2lucy9zb3VuZHNldC5qcyIsIjAwMV9hcHAvYXBwbGljYXRpb24uanMiLCIwMDFfYXBwL2Fzc2V0cy5qcyIsIjAwMV9hcHAvYmVucmkuanMiLCIwMDFfYXBwL21haW4uanMiLCIwMDJfc2NlbmUvY29uZmlnc2NlbmUuanMiLCIwMDJfc2NlbmUvY29udmVyc2F0aW9uc2NlbmUuanMiLCIwMDJfc2NlbmUvY3JlZGl0c2NlbmUuanMiLCIwMDJfc2NlbmUvZW5kaW5nc2NlbmUuanMiLCIwMDJfc2NlbmUvZW5kaW5nc2NlbmUudHJ1ZWVuZGluZy5qcyIsIjAwMl9zY2VuZS9nYW1lb3ZlcnNjZW5lLmpzIiwiMDAyX3NjZW5lL2xvYWRpbmdzY2VuZS5qcyIsIjAwMl9zY2VuZS9tYWluc2NlbmUuanMiLCIwMDJfc2NlbmUvbWVudXNjZW5lLmpzIiwiMDAyX3NjZW5lL21lbnVzY2VuZV8uanMiLCIwMDJfc2NlbmUvbWVzc2FnZXNjZW5lLmpzIiwiMDAyX3NjZW5lL29wZW5pbmdzY2VuZS5qcyIsIjAwMl9zY2VuZS9wcmFjdGljZXNjZW5lLmpzIiwiMDAyX3NjZW5lL3NjZW5lZmxvdy5qcyIsIjAwMl9zY2VuZS9zcGxhc2hzY2VuZS5qcyIsIjAwMl9zY2VuZS90aXRsZXNjZW5lLmpzIiwiMDAyX3NjZW5lL3R1dG9yaWFsc2NlbmUuanMiLCIwMDNfc3RhZ2Uvc3RhZ2UxLmpzIiwiMDAzX3N0YWdlL3N0YWdlMTAuanMiLCIwMDNfc3RhZ2Uvc3RhZ2UyLmpzIiwiMDAzX3N0YWdlL3N0YWdlMy5qcyIsIjAwM19zdGFnZS9zdGFnZTQuanMiLCIwMDNfc3RhZ2Uvc3RhZ2U1LmpzIiwiMDAzX3N0YWdlL3N0YWdlNi5qcyIsIjAwM19zdGFnZS9zdGFnZTcuanMiLCIwMDNfc3RhZ2Uvc3RhZ2U4LmpzIiwiMDAzX3N0YWdlL3N0YWdlOS5qcyIsIjAwM19zdGFnZS9zdGFnZTk5OS5qcyIsIjAwM19zdGFnZS9zdGFnZWNvbnRyb2xsZXIuanMiLCIwMDNfc3RhZ2Uvc3RhZ2VlbmRpbmcuanMiLCIwMDRfY2hhcmFjdGVyL2JhbGxvb24uanMiLCIwMDRfY2hhcmFjdGVyL2NoYXJhY3Rlci5qcyIsIjAwNF9jaGFyYWN0ZXIvZWZmZWN0LmpzIiwiMDA0X2NoYXJhY3Rlci9lbmVteS5qcyIsIjAwNF9jaGFyYWN0ZXIvaXRlbS5qcyIsIjAwNF9jaGFyYWN0ZXIvaXRlbWJveC5qcyIsIjAwNF9jaGFyYWN0ZXIvbWFwb2JqZWN0LmpzIiwiMDA0X2NoYXJhY3Rlci9wbGF5ZXIuanMiLCIwMDVfZW5lbXkvZW5lbXkuYWR2ZW50dXJlci5qcyIsIjAwNV9lbmVteS9lbmVteS5hcmNoZGVtb24uanMiLCIwMDVfZW5lbXkvZW5lbXkuYXJjaGtuaWdodC5qcyIsIjAwNV9lbmVteS9lbmVteS5hcmNobWFnZS5qcyIsIjAwNV9lbmVteS9lbmVteS5iYWJ5ZGVtb24uanMiLCIwMDVfZW5lbXkvZW5lbXkuYmlyZC5qcyIsIjAwNV9lbmVteS9lbmVteS5idWxsZXQuanMiLCIwMDVfZW5lbXkvZW5lbXkuZGVhdGguanMiLCIwMDVfZW5lbXkvZW5lbXkuZGVtb24uanMiLCIwMDVfZW5lbXkvZW5lbXkuZGV2aWwuanMiLCIwMDVfZW5lbXkvZW5lbXkuZXhwbG9kZS5qcyIsIjAwNV9lbmVteS9lbmVteS5maXJlYmlyZC5qcyIsIjAwNV9lbmVteS9lbmVteS5mbGFtZS5qcyIsIjAwNV9lbmVteS9lbmVteS5nYXJ1ZGEuanMiLCIwMDVfZW5lbXkvZW5lbXkuZ3JlYXRlcmRlbW9uLmpzIiwiMDA1X2VuZW15L2VuZW15LmludGVsbGlnZW50c3dvcmQuanMiLCIwMDVfZW5lbXkvZW5lbXkua25pZ2h0LmpzIiwiMDA1X2VuZW15L2VuZW15Lm1hZ2UuanMiLCIwMDVfZW5lbXkvZW5lbXkubWFnaWNkYWdnZXIuanMiLCIwMDVfZW5lbXkvZW5lbXkub2dyZS5qcyIsIjAwNV9lbmVteS9lbmVteS5vcm9jaGkuanMiLCIwMDVfZW5lbXkvZW5lbXkuc2xpbWUuanMiLCIwMDVfZW5lbXkvZW5lbXkuc25ha2UuanMiLCIwMDVfZW5lbXkvZW5lbXkudGl0YW4uanMiLCIwMDVfZW5lbXkvZW5lbXkud2lzcC5qcyIsIjAwNV9lbmVteS9lbmVteS53aXphcmQuanMiLCIwNjBfbWFwb2JqZWN0L21hcG9iamVjdC5hY2Nlc3NvcnkuanMiLCIwNjBfbWFwb2JqZWN0L21hcG9iamVjdC5ibG9jay5qcyIsIjA2MF9tYXBvYmplY3QvbWFwb2JqZWN0LmRvb3IuanMiLCIwNjBfbWFwb2JqZWN0L21hcG9iamVjdC5mbG9vci5qcyIsIjA2MF9tYXBvYmplY3QvbWFwb2JqZWN0LmdhdGUuanMiLCIwNjBfbWFwb2JqZWN0L21hcG9iamVjdC5ucGMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDelJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNueUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOU5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDak5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdFhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdHRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5bkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN3dDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDalRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9GQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9QQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJxZnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogIHBoaW5hLmFzc2V0bG9hZGVyZXguanNcbiAqICAyMDE2LzExLzI1XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxucGhpbmEuZXh0ZW5zaW9uID0gcGhpbmEuZXh0ZW5zaW9uIHx8IHt9O1xuXG4vL+ODkOODg+OCr+OCsOODqeOCpuODs+ODieOBp+OCouOCu+ODg+ODiOiqreOBv+i+vOOBv1xucGhpbmEuZGVmaW5lKFwicGhpbmEuZXh0ZW5zaW9uLkFzc2V0TG9hZGVyRXhcIiwge1xuXG4gICAgLy/pgLLmjZdcbiAgICBsb2FkcHJvZ3Jlc3M6IDAsXG5cbiAgICAvL+iqreOBv+i+vOOBv+e1guS6huODleODqeOCsFxuICAgIGxvYWRjb21wbGV0ZTogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICB9LFxuXG4gICAgbG9hZDogZnVuY3Rpb24oYXNzZXRzLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9vbkxvYWRBc3NldHMgPSBjYWxsYmFjayB8fCBmdW5jdGlvbigpe307XG4gICAgICAgIHZhciBsb2FkZXIgPSBwaGluYS5hc3NldC5Bc3NldExvYWRlcigpO1xuICAgICAgICBsb2FkZXIubG9hZChhc3NldHMpO1xuICAgICAgICBsb2FkZXIub24oJ2xvYWQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRjb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl9vbkxvYWRBc3NldHMoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgbG9hZGVyLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRwcm9ncmVzcyA9IGUucHJvZ3Jlc3M7XG4gICAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBwaGluYS5leHRlbnNpb24uanNcbiAqICAyMDE2LzExLzI1XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqXG4gKi9cblxucGhpbmEuZXh0ZW5zaW9uID0gcGhpbmEuZXh0ZW5zaW9uIHx8IHt9O1xuXG4vL3NldEFscGhh44KS6L+95YqgXG5waGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50LnByb3RvdHlwZS5zZXRBbHBoYSA9IGZ1bmN0aW9uKHZhbCkge1xuICAgIHRoaXMuYWxwaGEgPSB2YWw7XG4gICAgcmV0dXJuIHRoaXM7XG59O1xuXG4vL+OCueODl+ODqeOCpOODiOapn+iDveaLoeW8tVxucGhpbmEuZGlzcGxheS5TcHJpdGUucHJvdG90eXBlLnNldEZyYW1lVHJpbW1pbmcgPSBmdW5jdGlvbih4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gIHRoaXMuX2ZyYW1lVHJpbVggPSB4IHx8IDA7XG4gIHRoaXMuX2ZyYW1lVHJpbVkgPSB5IHx8IDA7XG4gIHRoaXMuX2ZyYW1lVHJpbVdpZHRoID0gd2lkdGggfHwgdGhpcy5pbWFnZS5kb21FbGVtZW50LndpZHRoIC0gdGhpcy5fZnJhbWVUcmltWDtcbiAgdGhpcy5fZnJhbWVUcmltSGVpZ2h0ID0gaGVpZ2h0IHx8IHRoaXMuaW1hZ2UuZG9tRWxlbWVudC5oZWlnaHQgLSB0aGlzLl9mcmFtZVRyaW1ZO1xuICByZXR1cm4gdGhpcztcbn1cblxucGhpbmEuZGlzcGxheS5TcHJpdGUucHJvdG90eXBlLnNldEZyYW1lSW5kZXggPSBmdW5jdGlvbihpbmRleCwgd2lkdGgsIGhlaWdodCkge1xuICB2YXIgc3ggPSB0aGlzLl9mcmFtZVRyaW1YIHx8IDA7XG4gIHZhciBzeSA9IHRoaXMuX2ZyYW1lVHJpbVkgfHwgMDtcbiAgdmFyIHN3ID0gdGhpcy5fZnJhbWVUcmltV2lkdGggIHx8ICh0aGlzLmltYWdlLmRvbUVsZW1lbnQud2lkdGgtc3gpO1xuICB2YXIgc2ggPSB0aGlzLl9mcmFtZVRyaW1IZWlnaHQgfHwgKHRoaXMuaW1hZ2UuZG9tRWxlbWVudC5oZWlnaHQtc3kpO1xuXG4gIHZhciB0dyAgPSB3aWR0aCB8fCB0aGlzLndpZHRoOyAgICAgIC8vIHR3XG4gIHZhciB0aCAgPSBoZWlnaHQgfHwgdGhpcy5oZWlnaHQ7ICAgIC8vIHRoXG4gIHZhciByb3cgPSB+fihzdyAvIHR3KTtcbiAgdmFyIGNvbCA9IH5+KHNoIC8gdGgpO1xuICB2YXIgbWF4SW5kZXggPSByb3cqY29sO1xuICBpbmRleCA9IGluZGV4JW1heEluZGV4O1xuXG4gIHZhciB4ICAgPSBpbmRleCVyb3c7XG4gIHZhciB5ICAgPSB+fihpbmRleC9yb3cpO1xuICB0aGlzLnNyY1JlY3QueCA9IHN4K3gqdHc7XG4gIHRoaXMuc3JjUmVjdC55ID0gc3kreSp0aDtcbiAgdGhpcy5zcmNSZWN0LndpZHRoICA9IHR3O1xuICB0aGlzLnNyY1JlY3QuaGVpZ2h0ID0gdGg7XG5cbiAgdGhpcy5fZnJhbWVJbmRleCA9IGluZGV4O1xuXG4gIHJldHVybiB0aGlzO1xufVxuXG4vL+OCqOODrOODoeODs+ODiOWQjOWjq+OBruaOpeinpuWIpOWumlxucGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudC5wcm90b3R5cGUuaXNIaXRFbGVtZW50ID0gZnVuY3Rpb24oZWxtKSB7XG4gICAgLy/oh6rliIbjgajjg4bjgrnjg4jlr77osaHjgpLjgrDjg63jg7zjg5Djg6vjgbjlpInmj5tcbiAgICB2YXIgcCA9IHRoaXMuZ2xvYmFsVG9Mb2NhbChlbG0pO1xuICAgIHZhciB0YXJnZXQgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KHt3aWR0aDogZWxtLndpZHRoLCBoZWlnaHQ6IGVsbS5oZWlnaHR9KS5zZXRQb3NpdGlvbihwLngsIHAueSk7XG5cbiAgICBpZiAodGhpcy5ib3VuZGluZ1R5cGUgPT0gJ3JlY3QnKSB7XG4gICAgICAgIGlmIChlbG0uYm91bmRpbmdUeXBlID09ICdyZWN0Jykge1xuICAgICAgICAgICAgcmV0dXJuIHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RSZWN0UmVjdCh0aGlzLCB0YXJnZXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RSZWN0Q2lyY2xlKHRoaXMsIHRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoZWxtLmJvdW5kaW5nVHlwZSA9PSAncmVjdCcpIHtcbiAgICAgICAgICAgIHJldHVybiBwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0Q2llY2xlUmVjdCh0aGlzLCB0YXJnZXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RDaXJjbGVDaXJjbGUodGhpcywgdGFyZ2V0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy/lrZDopoHntKDlhajjgabliIfjgorpm6LjgZdcbnBoaW5hLmFwcC5FbGVtZW50LnByb3RvdHlwZS5yZW1vdmVDaGlsZHJlbiA9IGZ1bmN0aW9uKGJlZ2luSW5kZXgpIHtcbiAgICBiZWdpbkluZGV4ID0gYmVnaW5JbmRleCB8fCAwO1xuICAgIHZhciB0ZW1wQ2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuLnNsaWNlKCk7XG4gICAgdmFyIGxlbiA9IGxlbiA9IHRlbXBDaGlsZHJlbi5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IGJlZ2luSW5kZXg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICB0ZW1wQ2hpbGRyZW5baV0ucmVtb3ZlKCk7XG4gICAgfVxuICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbn1cblxuLyoqXG4gKiBAbWV0aG9kIHRlc3RMaW5lTGluZVxuICogQHN0YXRpY1xuICogMuOBpOOBrue3muWIhuOBjOmHjeOBquOBo+OBpuOBhOOCi+OBi+OBqeOBhuOBi+OCkuWIpOWumuOBl+OBvuOBmVxuICog5Y+C6ICD77yaaHR0cDovL3d3dzVkLmJpZ2xvYmUubmUuanAvfnRvbW95YTAzL3NodG1sL2FsZ29yaXRobS9JbnRlcnNlY3Rpb24uaHRtXG4gKlxuICogIyMjIEV4YW1wbGVcbiAqICAgICBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMigxMDAsIDEwMCk7XG4gKiAgICAgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIoMjAwLCAyMDApO1xuICogICAgIHAzID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDE1MCwgMjQwKTtcbiAqICAgICBwNCA9IHBoaW5hLmdlb20uVmVjdG9yMigyMDAsIDEwMCk7XG4gKiBwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUocDEsIHAyLCBwMywgcDQpOyAvLyA9PiB0cnVlXG4gKlxuICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHAxIOe3muWIhjHjga7nq6/jga7luqfmqJlcbiAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBwMiDnt5rliIYx44Gu56uv44Gu5bqn5qiZXG4gKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDMg57ea5YiGMuOBruerr+OBruW6p+aomVxuICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHA0IOe3muWIhjLjga7nq6/jga7luqfmqJlcbiAqIEByZXR1cm4ge0Jvb2xlYW59IOe3muWIhjHjgajnt5rliIYy44GM6YeN44Gq44Gj44Gm44GE44KL44GL44Gp44GG44GLXG4gKi9cbnBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RMaW5lTGluZSA9IGZ1bmN0aW9uKHAxLCBwMiwgcDMsIHA0KSB7XG4gIC8v5ZCM5LiA77y477y56Lu45LiK44Gr5LmX44Gj44Gm44KL5aC05ZCI44Gu6Kqk5Yik5a6a5Zue6YG/XG4gIGlmIChwMS54ID09IHAyLnggJiYgcDEueCA9PSBwMy54ICYmIHAxLnggPT0gcDQueCkge1xuICAgIHZhciBtaW4gPSBNYXRoLm1pbihwMS55LCBwMi55KTtcbiAgICB2YXIgbWF4ID0gTWF0aC5tYXgocDEueSwgcDIueSk7XG4gICAgaWYgKG1pbiA8PSBwMy55ICYmIHAzLnkgPD0gbWF4IHx8IG1pbiA8PSBwNC55ICYmIHA0LnkgPD0gbWF4KSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKHAxLnkgPT0gcDIueSAmJiBwMS55ID09IHAzLnkgJiYgcDEueSA9PSBwNC55KSB7XG4gICAgdmFyIG1pbiA9IE1hdGgubWluKHAxLngsIHAyLngpO1xuICAgIHZhciBtYXggPSBNYXRoLm1heChwMS54LCBwMi54KTtcbiAgICBpZiAobWluIDw9IHAzLnggJiYgcDMueCA8PSBtYXggfHwgbWluIDw9IHA0LnggJiYgcDQueCA8PSBtYXgpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB2YXIgYSA9IChwMS54IC0gcDIueCkgKiAocDMueSAtIHAxLnkpICsgKHAxLnkgLSBwMi55KSAqIChwMS54IC0gcDMueCk7XG4gIHZhciBiID0gKHAxLnggLSBwMi54KSAqIChwNC55IC0gcDEueSkgKyAocDEueSAtIHAyLnkpICogKHAxLnggLSBwNC54KTtcbiAgdmFyIGMgPSAocDMueCAtIHA0LngpICogKHAxLnkgLSBwMy55KSArIChwMy55IC0gcDQueSkgKiAocDMueCAtIHAxLngpO1xuICB2YXIgZCA9IChwMy54IC0gcDQueCkgKiAocDIueSAtIHAzLnkpICsgKHAzLnkgLSBwNC55KSAqIChwMy54IC0gcDIueCk7XG4gIHJldHVybiBhICogYiA8PSAwICYmIGMgKiBkIDw9IDA7XG59XG5cbi8qKlxuICogQG1ldGhvZCB0ZXN0UmVjdExpbmVcbiAqIEBzdGF0aWNcbiAqIOefqeW9ouOBqOe3muWIhuOBjOmHjeOBquOBo+OBpuOBhOOCi+OBi+OBqeOBhuOBi+OCkuWIpOWumuOBl+OBvuOBmVxuICpcbiAqICMjIyBFeGFtcGxlXG4gKiAgICAgcmVjdCA9IHBoaW5hLmdlb20uUmVjdCgxMjAsIDEzMCwgNDAsIDUwKTtcbiAqICAgICBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMigxMDAsIDEwMCk7XG4gKiAgICAgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIoMjAwLCAyMDApO1xuICogcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdFJlY3RMaW5lKHJlY3QsIHAxLCBwMik7IC8vID0+IHRydWVcbiAqXG4gKiBAcGFyYW0ge3BoaW5hLmdlb20uUmVjdH0gcmVjdCDnn6nlvaLpoJjln5/jgqrjg5bjgrjjgqfjgq/jg4hcbiAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBwMSDnt5rliIbjga7nq6/jga7luqfmqJlcbiAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBwMiDnt5rliIbjga7nq6/jga7luqfmqJlcbiAqIEByZXR1cm4ge0Jvb2xlYW59IOefqeW9ouOBqOe3muWIhuOBjOmHjeOBquOBo+OBpuOBhOOCi+OBi+OBqeOBhuOBi1xuICovXG5waGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0UmVjdExpbmUgPSBmdW5jdGlvbihyZWN0LCBwMSwgcDIpIHtcbiAgICAvL+WMheWQq+WIpOWumihwMeOBjOWQq+OBvuOCjOOBpuOCjOOBsOiJr+OBhOOBruOBp3Ay44Gu5Yik5a6a44Gv44GX44Gq44GE77yJXG4gICAgaWYgKHJlY3QubGVmdCA8PSBwMS54ICYmIHAxLnggPD0gcmVjdC5yaWdodCAmJiByZWN0LnRvcCA8PSBwMS55ICYmIHAxLnkgPD0gcmVjdC5ib3R0b20gKSByZXR1cm4gdHJ1ZTtcblxuICAgIC8v55+p5b2i44Gu77yU54K5XG4gICAgdmFyIHIxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHJlY3QubGVmdCwgcmVjdC50b3ApOyAgICAgLy/lt6bkuIpcbiAgICB2YXIgcjIgPSBwaGluYS5nZW9tLlZlY3RvcjIocmVjdC5yaWdodCwgcmVjdC50b3ApOyAgICAvL+WPs+S4ilxuICAgIHZhciByMyA9IHBoaW5hLmdlb20uVmVjdG9yMihyZWN0LnJpZ2h0LCByZWN0LmJvdHRvbSk7IC8v5Y+z5LiLXG4gICAgdmFyIHI0ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHJlY3QubGVmdCwgcmVjdC5ib3R0b20pOyAgLy/lt6bkuItcblxuICAgIC8v55+p5b2i44Gu77yU6L6644KS44Gq44GZ57ea5YiG44Go44Gu5o6l6Kem5Yik5a6aXG4gICAgaWYgKHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RMaW5lTGluZShwMSwgcDIsIHIxLCByMikpIHJldHVybiB0cnVlO1xuICAgIGlmIChwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUocDEsIHAyLCByMiwgcjMpKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAocGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdExpbmVMaW5lKHAxLCBwMiwgcjMsIHI0KSkgcmV0dXJuIHRydWU7XG4gICAgaWYgKHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RMaW5lTGluZShwMSwgcDIsIHIxLCByNCkpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBmYWxzZTtcbn1cblxuXG4vL+WGhuW8p+OBruaPj+eUu1xucGhpbmEuZGVmaW5lKCdwaGluYS5kaXNwbGF5LkFyY1NoYXBlJywge1xuICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5TaGFwZScsXG5cbiAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSAoe30pLiRzYWZlKG9wdGlvbnMsIHtcbiAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgIGZpbGw6ICdyZWQnLFxuICAgICAgc3Ryb2tlOiAnI2FhYScsXG4gICAgICBzdHJva2VXaWR0aDogNCxcbiAgICAgIHJhZGl1czogMzIsXG4gICAgICBzdGFydEFuZ2xlOiAwLFxuICAgICAgZW5kQW5nbGU6IDI3MCxcblxuICAgICAgYW50aWNsb2Nrd2lzZTogZmFsc2UsXG4gICAgfSk7XG4gICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG5cbiAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzO1xuICAgIHRoaXMuc3RhcnRBbmdsZSA9IG9wdGlvbnMuc3RhcnRBbmdsZTtcbiAgICB0aGlzLmVuZEFuZ2xlID0gb3B0aW9ucy5lbmRBbmdsZTtcbiAgICB0aGlzLmFudGljbG9ja3dpc2UgPSBvcHRpb25zLmFudGljbG9ja3dpc2U7XG5cbiAgICB0aGlzLnNldEJvdW5kaW5nVHlwZSgnY2lyY2xlJyk7XG4gIH0sXG5cbiAgcHJlcmVuZGVyOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICBjYW52YXMuZmlsbFBpZSgwLCAwLCB0aGlzLnJhZGl1cywgdGhpcy5zdGFydEFuZ2xlLCB0aGlzLmVuZEFuZ2xlKTtcbiAgfSxcbn0pO1xuIiwiLypcbiAqICBwaGluYS50aWxlZG1hcC5qc1xuICogIDIwMTYvMDkvMTBcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG4vKipcbiAqIEBjbGFzcyBwaGluYS5hc3NldC5UaWxlZE1hcFxuICogQGV4dGVuZHMgcGhpbmEuYXNzZXQuQXNzZXRcbiAqICMgVGlsZWRNYXBFZGl0b3LjgafkvZzmiJDjgZfjgZ90bXjjg5XjgqHjgqTjg6vjgpLoqq3jgb/ovrzjgb/jgq/jg6njgrlcbiAqL1xucGhpbmEuZGVmaW5lKFwicGhpbmEuYXNzZXQuVGlsZWRNYXBcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuYXNzZXQuQXNzZXRcIixcblxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSBpbWFnZVxuICAgICAqIOS9nOaIkOOBleOCjOOBn+ODnuODg+ODl+eUu+WDj1xuICAgICAqL1xuICAgIGltYWdlOiBudWxsLFxuXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5IHRpbGVzZXRzXG4gICAgICog44K/44Kk44Or44K744OD44OI5oOF5aCxXG4gICAgICovXG4gICAgdGlsZXNldHM6IG51bGwsXG5cbiAgICAvKipcbiAgICAgKiBAcHJvcGVydHkgbGF5ZXJzXG4gICAgICog44Os44Kk44Ok44O85oOF5aCx44GM5qC857SN44GV44KM44Gm44GE44KL6YWN5YiXXG4gICAgICovXG4gICAgbGF5ZXJzOiBudWxsLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgfSxcblxuICAgIF9sb2FkOiBmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIC8v44OR44K55oqc44GN5Ye644GXXG4gICAgICAgIHRoaXMucGF0aCA9IFwiXCI7XG4gICAgICAgIHZhciBsYXN0ID0gdGhpcy5zcmMubGFzdEluZGV4T2YoXCIvXCIpO1xuICAgICAgICBpZiAobGFzdCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMucGF0aCA9IHRoaXMuc3JjLnN1YnN0cmluZygwLCBsYXN0KzEpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/ntYLkuobplqLmlbDkv53lrZhcbiAgICAgICAgdGhpcy5fcmVzb2x2ZSA9IHJlc29sdmU7XG5cbiAgICAgICAgLy8gbG9hZFxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciB4bWwgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgeG1sLm9wZW4oJ0dFVCcsIHRoaXMuc3JjKTtcbiAgICAgICAgeG1sLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHhtbC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICAgICAgaWYgKFsyMDAsIDIwMSwgMF0uaW5kZXhPZih4bWwuc3RhdHVzKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB4bWwucmVzcG9uc2VUZXh0O1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gKG5ldyBET01QYXJzZXIoKSkucGFyc2VGcm9tU3RyaW5nKGRhdGEsIFwidGV4dC94bWxcIik7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZGF0YVR5cGUgPSBcInhtbFwiO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9wYXJzZShkYXRhKTtcbi8vICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHNlbGYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgeG1sLnNlbmQobnVsbCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0TWFwRGF0YVxuICAgICAqIOaMh+WumuOBl+OBn+ODnuODg+ODl+ODrOOCpOODpOODvOOCkumFjeWIl+OBqOOBl+OBpuWPluW+l+OBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGxheWVyTmFtZSDlr77osaHjg6zjgqTjg6Tjg7zlkI1cbiAgICAgKi9cbiAgICBnZXRNYXBEYXRhOiBmdW5jdGlvbihsYXllck5hbWUpIHtcbiAgICAgICAgLy/jg6zjgqTjg6Tjg7zmpJzntKJcbiAgICAgICAgdmFyIGRhdGEgPSBudWxsO1xuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5sYXllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS5uYW1lID09IGxheWVyTmFtZSkge1xuICAgICAgICAgICAgICAgIC8v44Kz44OU44O844KS6L+U44GZXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGF5ZXJzW2ldLmRhdGEuY29uY2F0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0T2JqZWN0R3JvdXBcbiAgICAgKiDjgqrjg5bjgrjjgqfjgq/jg4jjgrDjg6vjg7zjg5fjgpLlj5blvpfjgZfjgb7jgZlcbiAgICAgKlxuICAgICAqIOOCsOODq+ODvOODl+aMh+WumuOBjOeEoeOBhOWgtOWQiOOAgeWFqOODrOOCpOODpOODvOOCkumFjeWIl+OBq+OBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGdyb3VucE5hbWUg5a++6LGh44Kq44OW44K444Kn44Kv44OI44Kw44Or44O844OX5ZCNXG4gICAgICovXG4gICAgZ2V0T2JqZWN0R3JvdXA6IGZ1bmN0aW9uKGdyb3VwTmFtZSkge1xuICAgICAgICBncm91cE5hbWUgPSBncm91cE5hbWUgfHwgbnVsbDtcbiAgICAgICAgdmFyIGxzID0gW107XG4gICAgICAgIHZhciBsZW4gPSB0aGlzLmxheWVycy5sZW5ndGg7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS50eXBlID09IFwib2JqZWN0Z3JvdXBcIikge1xuICAgICAgICAgICAgICAgIGlmIChncm91cE5hbWUgPT0gbnVsbCB8fCBncm91cE5hbWUgPT0gdGhpcy5sYXllcnNbaV0ubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAvL+ODrOOCpOODpOODvOaDheWgseOCkuOCr+ODreODvOODs+OBmeOCi1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5fY2xvbmVPYmplY3RMYXllcih0aGlzLmxheWVyc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChncm91cE5hbWUgIT09IG51bGwpIHJldHVybiBvYmo7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxzLnB1c2gob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbHM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0TWFwSW1hZ2VcbiAgICAgKiDjg57jg4Pjg5fjgqTjg6Hjg7zjgrjjga7kvZzmiJBcbiAgICAgKlxuICAgICAqIOikh+aVsOOBruODnuODg+ODl+ODrOOCpOODpOODvOOCkuaMh+WumuWHuuadpeOBvuOBmeOAglxuICAgICAqIOaPj+eUu+mghuW6j+OBr1RpbGVkTWFwRWRpdG9y5YG044Gn44Gu5oyH5a6a6aCG44Gn44Gv54Sh44GP44CB5byV5pWw44Gu6aCG5bqP44Go44Gq44KK44G+44GZ77yI56ys5LiA5byV5pWw44GM5LiA55Wq5LiL44Go44Gq44KL77yJXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gIOWvvuixoeODrOOCpOODpOODvOWQjVxuICAgICAqL1xuICAgIGdldEltYWdlOiBmdW5jdGlvbiguLi5hcmdzKSB7XG4gICAgICAgIHZhciBudW1MYXllciA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sYXllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS50eXBlID09IFwibGF5ZXJcIiB8fCB0aGlzLmxheWVyc1tpXS50eXBlID09IFwiaW1hZ2VsYXllclwiKSBudW1MYXllcisrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChudW1MYXllciA9PSAwKSByZXR1cm4gbnVsbDtcblxuICAgICAgICB2YXIgZ2VuZXJhdGVkID0gZmFsc2U7XG4gICAgICAgIHZhciB3aWR0aCA9IHRoaXMud2lkdGggKiB0aGlzLnRpbGV3aWR0aDtcbiAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0ICogdGhpcy50aWxlaGVpZ2h0O1xuICAgICAgICB2YXIgY2FudmFzID0gcGhpbmEuZ3JhcGhpY3MuQ2FudmFzKCkuc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGF5ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgZmluZCA9IGFyZ3MuaW5kZXhPZih0aGlzLmxheWVyc1tpXS5uYW1lKTtcbiAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA9PSAwIHx8IGZpbmQgPj0gMCkge1xuICAgICAgICAgICAgICAgIC8v44Oe44OD44OX44Os44Kk44Ok44O8XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGF5ZXJzW2ldLnR5cGUgPT0gXCJsYXllclwiICYmIHRoaXMubGF5ZXJzW2ldLnZpc2libGUgIT0gXCIwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxheWVyID0gdGhpcy5sYXllcnNbaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXBkYXRhID0gbGF5ZXIuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gbGF5ZXIud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBsYXllci5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcGFjaXR5ID0gbGF5ZXIub3BhY2l0eSB8fCAxLjA7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IG1hcGRhdGFbY291bnRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v44Oe44OD44OX44OB44OD44OX44KS6YWN572uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldE1hcENoaXAoY2FudmFzLCBpbmRleCwgeCAqIHRoaXMudGlsZXdpZHRoLCB5ICogdGhpcy50aWxlaGVpZ2h0LCBvcGFjaXR5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvL+OCquODluOCuOOCp+OCr+ODiOOCsOODq+ODvOODl1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxheWVyc1tpXS50eXBlID09IFwib2JqZWN0Z3JvdXBcIiAmJiB0aGlzLmxheWVyc1tpXS52aXNpYmxlICE9IFwiMFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXllciA9IHRoaXMubGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3BhY2l0eSA9IGxheWVyLm9wYWNpdHkgfHwgMS4wO1xuICAgICAgICAgICAgICAgICAgICBsYXllci5vYmplY3RzLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUuZ2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0TWFwQ2hpcChjYW52YXMsIGUuZ2lkLCBlLngsIGUueSwgb3BhY2l0eSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8v44Kk44Oh44O844K444Os44Kk44Ok44O8XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGF5ZXJzW2ldLnR5cGUgPT0gXCJpbWFnZWxheWVyXCIgJiYgdGhpcy5sYXllcnNbaV0udmlzaWJsZSAhPSBcIjBcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGVuID0gdGhpcy5sYXllcnNbaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ2ltYWdlJywgdGhpcy5sYXllcnNbaV0uaW1hZ2Uuc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FudmFzLmNvbnRleHQuZHJhd0ltYWdlKGltYWdlLmRvbUVsZW1lbnQsIHRoaXMubGF5ZXJzW2ldLngsIHRoaXMubGF5ZXJzW2ldLnkpO1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghZ2VuZXJhdGVkKSByZXR1cm4gbnVsbDtcblxuICAgICAgICB2YXIgdGV4dHVyZSA9IHBoaW5hLmFzc2V0LlRleHR1cmUoKTtcbiAgICAgICAgdGV4dHVyZS5kb21FbGVtZW50ID0gY2FudmFzLmRvbUVsZW1lbnQ7XG4gICAgICAgIHJldHVybiB0ZXh0dXJlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9jbG9uZU9iamVjdExheWVyXG4gICAgICog5byV5pWw44Go44GX44Gm5rih44GV44KM44Gf44Kq44OW44K444Kn44Kv44OI44Os44Kk44Ok44O844KS44Kv44Ot44O844Oz44GX44Gm6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jbG9uZU9iamVjdExheWVyOiBmdW5jdGlvbihzcmNMYXllcikge1xuICAgICAgICB2YXIgcmVzdWx0ID0ge30uJHNhZmUoc3JjTGF5ZXIpO1xuICAgICAgICByZXN1bHQub2JqZWN0cyA9IFtdO1xuICAgICAgICAvL+ODrOOCpOODpOODvOWGheOCquODluOCuOOCp+OCr+ODiOOBruOCs+ODlOODvFxuICAgICAgICBzcmNMYXllci5vYmplY3RzLmZvckVhY2goZnVuY3Rpb24ob2JqKXtcbiAgICAgICAgICAgIHZhciByZXNPYmogPSB7XG4gICAgICAgICAgICAgICAgcHJvcGVydGllczoge30uJHNhZmUob2JqLnByb3BlcnRpZXMpLFxuICAgICAgICAgICAgfS4kZXh0ZW5kKG9iaik7XG4gICAgICAgICAgICBpZiAob2JqLmVsbGlwc2UpIHJlc09iai5lbGxpcHNlID0gb2JqLmVsbGlwc2U7XG4gICAgICAgICAgICBpZiAob2JqLmdpZCkgcmVzT2JqLmdpZCA9IG9iai5naWQ7XG4gICAgICAgICAgICBpZiAob2JqLnBvbHlnb24pIHJlc09iai5wb2x5Z29uID0gb2JqLnBvbHlnb24uY2xvbmUoKTtcbiAgICAgICAgICAgIGlmIChvYmoucG9seWxpbmUpIHJlc09iai5wb2x5bGluZSA9IG9iai5wb2x5bGluZS5jbG9uZSgpO1xuICAgICAgICAgICAgcmVzdWx0Lm9iamVjdHMucHVzaChyZXNPYmopO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfcGFyc2VcbiAgICAgKiDlj5blvpfjgZfjgZ9UaWxlZE1hcEVkaXTjga7jg4fjg7zjgr/jgpLjg5Hjg7zjgrnjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3BhcnNlOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIC8v44K/44Kk44Or5bGe5oCn5oOF5aCx5Y+W5b6XXG4gICAgICAgIHZhciBtYXAgPSBkYXRhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdtYXAnKVswXTtcbiAgICAgICAgdmFyIGF0dHIgPSB0aGlzLl9hdHRyVG9KU09OKG1hcCk7XG4gICAgICAgIHRoaXMuJGV4dGVuZChhdHRyKTtcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllc1RvSlNPTihtYXApO1xuXG4gICAgICAgIC8v44K/44Kk44Or44K744OD44OI5Y+W5b6XXG4gICAgICAgIHRoaXMudGlsZXNldHMgPSB0aGlzLl9wYXJzZVRpbGVzZXRzKGRhdGEpO1xuXG4gICAgICAgIC8v44K/44Kk44Or44K744OD44OI5oOF5aCx6KOc5a6MXG4gICAgICAgIHZhciBkZWZhdWx0QXR0ciA9IHtcbiAgICAgICAgICAgIHRpbGV3aWR0aDogMzIsXG4gICAgICAgICAgICB0aWxlaGVpZ2h0OiAzMixcbiAgICAgICAgICAgIHNwYWNpbmc6IDAsXG4gICAgICAgICAgICBtYXJnaW46IDAsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGlsZXNldHMuY2hpcHMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRpbGVzZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvL+OCv+OCpOODq+OCu+ODg+ODiOWxnuaAp+aDheWgseWPluW+l1xuICAgICAgICAgICAgdmFyIGF0dHIgPSB0aGlzLl9hdHRyVG9KU09OKGRhdGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RpbGVzZXQnKVtpXSk7XG4gICAgICAgICAgICBhdHRyLiRzYWZlKGRlZmF1bHRBdHRyKTtcbiAgICAgICAgICAgIGF0dHIuZmlyc3RnaWQtLTtcbiAgICAgICAgICAgIHRoaXMudGlsZXNldHNbaV0uJGV4dGVuZChhdHRyKTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fjg4Hjg4Pjg5fjg6rjgrnjg4jkvZzmiJBcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcy50aWxlc2V0c1tpXTtcbiAgICAgICAgICAgIHRoaXMudGlsZXNldHNbaV0ubWFwQ2hpcCA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgciA9IGF0dHIuZmlyc3RnaWQ7IHIgPCBhdHRyLmZpcnN0Z2lkK2F0dHIudGlsZWNvdW50OyByKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgY2hpcCA9IHtcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHQuaW1hZ2UsXG4gICAgICAgICAgICAgICAgICAgIHg6ICgociAtIGF0dHIuZmlyc3RnaWQpICUgdC5jb2x1bW5zKSAqICh0LnRpbGV3aWR0aCArIHQuc3BhY2luZykgKyB0Lm1hcmdpbixcbiAgICAgICAgICAgICAgICAgICAgeTogTWF0aC5mbG9vcigociAtIGF0dHIuZmlyc3RnaWQpIC8gdC5jb2x1bW5zKSAqICh0LnRpbGVoZWlnaHQgKyB0LnNwYWNpbmcpICsgdC5tYXJnaW4sXG4gICAgICAgICAgICAgICAgfS4kc2FmZShhdHRyKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbGVzZXRzLmNoaXBzW3JdID0gY2hpcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44Os44Kk44Ok44O85Y+W5b6XXG4gICAgICAgIHRoaXMubGF5ZXJzID0gdGhpcy5fcGFyc2VMYXllcnMoZGF0YSk7XG5cbiAgICAgICAgLy/jgqTjg6Hjg7zjgrjjg4fjg7zjgr/oqq3jgb/ovrzjgb9cbiAgICAgICAgdGhpcy5fY2hlY2tJbWFnZSgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9jaGVja0ltYWdlXG4gICAgICog44Ki44K744OD44OI44Gr54Sh44GE44Kk44Oh44O844K444OH44O844K/44KS44OB44Kn44OD44Kv44GX44Gm6Kqt44G/6L6844G/44KS6KGM44GE44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jaGVja0ltYWdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgaW1hZ2VTb3VyY2UgPSBbXTtcbiAgICAgICAgdmFyIGxvYWRJbWFnZSA9IFtdO1xuXG4gICAgICAgIC8v5LiA6Kan5L2c5oiQXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50aWxlc2V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIG9iaiA9IHtcbiAgICAgICAgICAgICAgICBpbWFnZTogdGhpcy50aWxlc2V0c1tpXS5pbWFnZSxcbiAgICAgICAgICAgICAgICB0cmFuc1I6IHRoaXMudGlsZXNldHNbaV0udHJhbnNSLFxuICAgICAgICAgICAgICAgIHRyYW5zRzogdGhpcy50aWxlc2V0c1tpXS50cmFuc0csXG4gICAgICAgICAgICAgICAgdHJhbnNCOiB0aGlzLnRpbGVzZXRzW2ldLnRyYW5zQixcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpbWFnZVNvdXJjZS5wdXNoKG9iaik7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxheWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMubGF5ZXJzW2ldLmltYWdlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHtcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHRoaXMubGF5ZXJzW2ldLmltYWdlLnNvdXJjZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaW1hZ2VTb3VyY2UucHVzaChvYmopO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jgqLjgrvjg4Pjg4jjgavjgYLjgovjgYvnorroqo1cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbWFnZVNvdXJjZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGltYWdlID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgnaW1hZ2UnLCBpbWFnZVNvdXJjZVtpXS5pbWFnZSk7XG4gICAgICAgICAgICBpZiAoaW1hZ2UpIHtcbiAgICAgICAgICAgICAgICAvL+OCouOCu+ODg+ODiOOBq+OBguOCi1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL+OBquOBi+OBo+OBn+OBruOBp+ODreODvOODieODquOCueODiOOBq+i/veWKoFxuICAgICAgICAgICAgICAgIGxvYWRJbWFnZS5wdXNoKGltYWdlU291cmNlW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v5LiA5ous44Ot44O844OJXG4gICAgICAgIC8v44Ot44O844OJ44Oq44K544OI5L2c5oiQXG4gICAgICAgIHZhciBhc3NldHMgPSB7XG4gICAgICAgICAgICBpbWFnZTogW11cbiAgICAgICAgfTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb2FkSW1hZ2UubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIC8v44Kk44Oh44O844K444Gu44OR44K544KS44Oe44OD44OX44Go5ZCM44GY44Gr44GZ44KLXG4gICAgICAgICAgICBhc3NldHMuaW1hZ2VbbG9hZEltYWdlW2ldLmltYWdlXSA9IHRoaXMucGF0aCtsb2FkSW1hZ2VbaV0uaW1hZ2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxvYWRJbWFnZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciBsb2FkZXIgPSBwaGluYS5hc3NldC5Bc3NldExvYWRlcigpO1xuICAgICAgICAgICAgbG9hZGVyLmxvYWQoYXNzZXRzKTtcbiAgICAgICAgICAgIGxvYWRlci5vbignbG9hZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAvL+mAj+mBjuiJsuioreWumuWPjeaYoFxuICAgICAgICAgICAgICAgIGxvYWRJbWFnZS5mb3JFYWNoKGZ1bmN0aW9uKGVsbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCdpbWFnZScsIGVsbS5pbWFnZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbG0udHJhbnNSICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gZWxtLnRyYW5zUiwgZyA9IGVsbS50cmFuc0csIGIgPSBlbG0udHJhbnNCO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2UuZmlsdGVyKGZ1bmN0aW9uKHBpeGVsLCBpbmRleCwgeCwgeSwgYml0bWFwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBiaXRtYXAuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGl4ZWxbMF0gPT0gciAmJiBwaXhlbFsxXSA9PSBnICYmIHBpeGVsWzJdID09IGIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCszXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvL+iqreOBv+i+vOOBv+e1guS6hlxuICAgICAgICAgICAgICAgIHRoYXQuX3Jlc29sdmUodGhhdCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy/oqq3jgb/ovrzjgb/ntYLkuoZcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdmUodGhhdCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc2V0TWFwQ2hpcFxuICAgICAqIOOCreODo+ODs+ODkOOCueOBruaMh+WumuOBl+OBn+W6p+aomeOBq+ODnuODg+ODl+ODgeODg+ODl+OBruOCpOODoeODvOOCuOOCkuOCs+ODlOODvOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICog5YaF6YOo44Gn5L2/55So44GX44Gm44GE44KL6Zai5pWw44Gn44GZ44CCXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0TWFwQ2hpcDogZnVuY3Rpb24oY2FudmFzLCBpbmRleCwgeCwgeSwgb3BhY2l0eSkge1xuICAgICAgICAvL+OCv+OCpOODq+OCu+ODg+ODiOOBi+OCieODnuODg+ODl+ODgeODg+ODl+OCkuWPluW+l1xuICAgICAgICB2YXIgY2hpcCA9IHRoaXMudGlsZXNldHMuY2hpcHNbaW5kZXhdO1xuICAgICAgICBpZiAoIWNoaXApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaW1hZ2UgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCdpbWFnZScsIGNoaXAuaW1hZ2UpO1xuICAgICAgICBpZiAoIWltYWdlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhjaGlwLmltYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBjYW52YXMuY29udGV4dC5kcmF3SW1hZ2UoXG4gICAgICAgICAgICBpbWFnZS5kb21FbGVtZW50LFxuICAgICAgICAgICAgY2hpcC54ICsgY2hpcC5tYXJnaW4sIGNoaXAueSArIGNoaXAubWFyZ2luLFxuICAgICAgICAgICAgY2hpcC50aWxld2lkdGgsIGNoaXAudGlsZWhlaWdodCxcbiAgICAgICAgICAgIHgsIHksXG4gICAgICAgICAgICBjaGlwLnRpbGV3aWR0aCwgY2hpcC50aWxlaGVpZ2h0KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfcHJvcGVydGllc1RvSlNPTlxuICAgICAqIFhNTOODl+ODreODkeODhuOCo+OCkkpTT07jgavlpInmj5vjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3Byb3BlcnRpZXNUb0pTT046IGZ1bmN0aW9uKGVsbSkge1xuICAgICAgICB2YXIgcHJvcGVydGllcyA9IGVsbS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInByb3BlcnRpZXNcIilbMF07XG4gICAgICAgIHZhciBvYmogPSB7fTtcbiAgICAgICAgaWYgKHByb3BlcnRpZXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IHByb3BlcnRpZXMuY2hpbGROb2Rlcy5sZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgdmFyIHAgPSBwcm9wZXJ0aWVzLmNoaWxkTm9kZXNba107XG4gICAgICAgICAgICBpZiAocC50YWdOYW1lID09PSBcInByb3BlcnR5XCIpIHtcbiAgICAgICAgICAgICAgICAvL3Byb3BlcnR544GrdHlwZeaMh+WumuOBjOOBguOBo+OBn+OCieWkieaPm1xuICAgICAgICAgICAgICAgIHZhciB0eXBlID0gcC5nZXRBdHRyaWJ1dGUoJ3R5cGUnKTtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBwLmdldEF0dHJpYnV0ZSgndmFsdWUnKTtcbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlKSB2YWx1ZSA9IHAudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gXCJpbnRcIikge1xuICAgICAgICAgICAgICAgICAgICBvYmpbcC5nZXRBdHRyaWJ1dGUoJ25hbWUnKV0gPSBwYXJzZUludCh2YWx1ZSwgMTApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImZsb2F0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqW3AuZ2V0QXR0cmlidXRlKCduYW1lJyldID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09IFwiYm9vbFwiICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gXCJ0cnVlXCIpIG9ialtwLmdldEF0dHJpYnV0ZSgnbmFtZScpXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGVsc2Ugb2JqW3AuZ2V0QXR0cmlidXRlKCduYW1lJyldID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqW3AuZ2V0QXR0cmlidXRlKCduYW1lJyldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Byb3BlcnRpZXNUb0pTT05cbiAgICAgKiBYTUzlsZ7mgKfmg4XloLHjgpJKU09O44Gr5aSJ5o+b44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDlhoXpg6jjgafkvb/nlKjjgZfjgabjgYTjgovplqLmlbDjgafjgZnjgIJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9hdHRyVG9KU09OOiBmdW5jdGlvbihzb3VyY2UpIHtcbiAgICAgICAgdmFyIG9iaiA9IHt9O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZS5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgdmFsID0gc291cmNlLmF0dHJpYnV0ZXNbaV0udmFsdWU7XG4gICAgICAgICAgICB2YWwgPSBpc05hTihwYXJzZUZsb2F0KHZhbCkpPyB2YWw6IHBhcnNlRmxvYXQodmFsKTtcbiAgICAgICAgICAgIG9ialtzb3VyY2UuYXR0cmlidXRlc1tpXS5uYW1lXSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9wcm9wZXJ0aWVzVG9KU09OX3N0clxuICAgICAqIFhNTOODl+ODreODkeODhuOCo+OCkkpTT07jgavlpInmj5vjgZfjgIHmloflrZfliJfjgafov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2F0dHJUb0pTT05fc3RyOiBmdW5jdGlvbihzb3VyY2UpIHtcbiAgICAgICAgdmFyIG9iaiA9IHt9O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZS5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgdmFsID0gc291cmNlLmF0dHJpYnV0ZXNbaV0udmFsdWU7XG4gICAgICAgICAgICBvYmpbc291cmNlLmF0dHJpYnV0ZXNbaV0ubmFtZV0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfcGFyc2VUaWxlc2V0c1xuICAgICAqIOOCv+OCpOODq+OCu+ODg+ODiOOBruODkeODvOOCueOCkuihjOOBhOOBvuOBmeOAglxuICAgICAqXG4gICAgICog5YaF6YOo44Gn5L2/55So44GX44Gm44GE44KL6Zai5pWw44Gn44GZ44CCXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcGFyc2VUaWxlc2V0czogZnVuY3Rpb24oeG1sKSB7XG4gICAgICAgIHZhciBlYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2g7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdmFyIGRhdGEgPSBbXTtcbiAgICAgICAgdmFyIHRpbGVzZXRzID0geG1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aWxlc2V0Jyk7XG4gICAgICAgIGVhY2guY2FsbCh0aWxlc2V0cywgZnVuY3Rpb24odGlsZXNldCkge1xuICAgICAgICAgICAgdmFyIHQgPSB7fTtcbiAgICAgICAgICAgIHZhciBwcm9wcyA9IHNlbGYuX3Byb3BlcnRpZXNUb0pTT04odGlsZXNldCk7XG4gICAgICAgICAgICBpZiAocHJvcHMuc3JjKSB7XG4gICAgICAgICAgICAgICAgdC5pbWFnZSA9IHByb3BzLnNyYztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdC5pbWFnZSA9IHRpbGVzZXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltYWdlJylbMF0uZ2V0QXR0cmlidXRlKCdzb3VyY2UnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v6YCP6YGO6Imy6Kit5a6a5Y+W5b6XXG4gICAgICAgICAgICB0LnRyYW5zID0gdGlsZXNldC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW1hZ2UnKVswXS5nZXRBdHRyaWJ1dGUoJ3RyYW5zJyk7XG4gICAgICAgICAgICBpZiAodC50cmFucykge1xuICAgICAgICAgICAgICAgIHQudHJhbnNSID0gcGFyc2VJbnQodC50cmFucy5zdWJzdHJpbmcoMCwgMiksIDE2KTtcbiAgICAgICAgICAgICAgICB0LnRyYW5zRyA9IHBhcnNlSW50KHQudHJhbnMuc3Vic3RyaW5nKDIsIDQpLCAxNik7XG4gICAgICAgICAgICAgICAgdC50cmFuc0IgPSBwYXJzZUludCh0LnRyYW5zLnN1YnN0cmluZyg0LCA2KSwgMTYpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYXRhLnB1c2godCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfcGFyc2VMYXllcnNcbiAgICAgKiDjg6zjgqTjg6Tjg7zmg4XloLHjga7jg5Hjg7zjgrnjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3BhcnNlTGF5ZXJzOiBmdW5jdGlvbih4bWwpIHtcbiAgICAgICAgdmFyIGVhY2ggPSBBcnJheS5wcm90b3R5cGUuZm9yRWFjaDtcbiAgICAgICAgdmFyIGRhdGEgPSBbXTtcblxuICAgICAgICB2YXIgbWFwID0geG1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwibWFwXCIpWzBdO1xuICAgICAgICB2YXIgbGF5ZXJzID0gW107XG4gICAgICAgIGVhY2guY2FsbChtYXAuY2hpbGROb2RlcywgZnVuY3Rpb24oZWxtKSB7XG4gICAgICAgICAgICBpZiAoZWxtLnRhZ05hbWUgPT0gXCJsYXllclwiIHx8IGVsbS50YWdOYW1lID09IFwib2JqZWN0Z3JvdXBcIiB8fCBlbG0udGFnTmFtZSA9PSBcImltYWdlbGF5ZXJcIikge1xuICAgICAgICAgICAgICAgIGxheWVycy5wdXNoKGVsbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxheWVycy5lYWNoKGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGxheWVyLnRhZ05hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwibGF5ZXJcIjpcbiAgICAgICAgICAgICAgICAgICAgLy/pgJrluLjjg6zjgqTjg6Tjg7xcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBsYXllci5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZGF0YScpWzBdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5jb2RpbmcgPSBkLmdldEF0dHJpYnV0ZShcImVuY29kaW5nXCIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwibGF5ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGxheWVyLmdldEF0dHJpYnV0ZShcIm5hbWVcIiksXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVuY29kaW5nID09IFwiY3N2XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGwuZGF0YSA9IHRoaXMuX3BhcnNlQ1NWKGQudGV4dENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVuY29kaW5nID09IFwiYmFzZTY0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGwuZGF0YSA9IHRoaXMuX3BhcnNlQmFzZTY0KGQudGV4dENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHIgPSB0aGlzLl9hdHRyVG9KU09OKGxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgbC4kZXh0ZW5kKGF0dHIpO1xuICAgICAgICAgICAgICAgICAgICBsLnByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzVG9KU09OKGxheWVyKTtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2gobCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgLy/jgqrjg5bjgrjjgqfjgq/jg4jjg6zjgqTjg6Tjg7xcbiAgICAgICAgICAgICAgICBjYXNlIFwib2JqZWN0Z3JvdXBcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdGdyb3VwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGxheWVyLmdldEF0dHJpYnV0ZShcIm5hbWVcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiBwYXJzZUZsb2F0KGxheWVyLmdldEF0dHJpYnV0ZShcIm9mZnNldHhcIikpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiBwYXJzZUZsb2F0KGxheWVyLmdldEF0dHJpYnV0ZShcIm9mZnNldHlcIikpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTogbGF5ZXIuZ2V0QXR0cmlidXRlKFwib3BhY2l0eVwiKSB8fCAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGxheWVyLmdldEF0dHJpYnV0ZShcImNvbG9yXCIpIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBkcmF3b3JkZXI6IGxheWVyLmdldEF0dHJpYnV0ZShcImRyYXdvcmRlclwiKSB8fCBudWxsLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBsLnByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzVG9KU09OKGxheWVyKTtcblxuICAgICAgICAgICAgICAgICAgICAvL+ODrOOCpOODpOODvOWGheino+aekFxuICAgICAgICAgICAgICAgICAgICBlYWNoLmNhbGwobGF5ZXIuY2hpbGROb2RlcywgZnVuY3Rpb24oZWxtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxtLm5vZGVUeXBlID09IDMpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5fYXR0clRvSlNPTihlbG0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuaWQgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5wcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllc1RvSlNPTihlbG0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy/lrZDopoHntKDjga7op6PmnpBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbG0uY2hpbGROb2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbG0uY2hpbGROb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUubm9kZVR5cGUgPT0gMykgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+alleWGhlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5ub2RlTmFtZSA9PSAnZWxsaXBzZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuZWxsaXBzZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/lpJrop5LlvaJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUubm9kZU5hbWUgPT0gJ3BvbHlnb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnBvbHlnb24gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0clRvSlNPTl9zdHIoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGwgPSBhdHRyLnBvaW50cy5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbC5mb3JFYWNoKGZ1bmN0aW9uKHN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwdHMgPSBzdHIuc3BsaXQoXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQucG9seWdvbi5wdXNoKHt4OiBwYXJzZUZsb2F0KHB0c1swXSksIHk6IHBhcnNlRmxvYXQocHRzWzFdKX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nt5rliIZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUubm9kZU5hbWUgPT0gJ3BvbHlsaW5lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wb2x5bGluZSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHIgPSB0aGlzLl9hdHRyVG9KU09OX3N0cihlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwbCA9IGF0dHIucG9pbnRzLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsLmZvckVhY2goZnVuY3Rpb24oc3RyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHB0cyA9IHN0ci5zcGxpdChcIixcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5wb2x5bGluZS5wdXNoKHt4OiBwYXJzZUZsb2F0KHB0c1swXSksIHk6IHBhcnNlRmxvYXQocHRzWzFdKX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbC5vYmplY3RzLnB1c2goZCk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKGwpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIC8v44Kk44Oh44O844K444Os44Kk44Ok44O8XG4gICAgICAgICAgICAgICAgY2FzZSBcImltYWdlbGF5ZXJcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImltYWdlbGF5ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGxheWVyLmdldEF0dHJpYnV0ZShcIm5hbWVcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiBwYXJzZUZsb2F0KGxheWVyLmdldEF0dHJpYnV0ZShcIm9mZnNldHhcIikpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiBwYXJzZUZsb2F0KGxheWVyLmdldEF0dHJpYnV0ZShcIm9mZnNldHlcIikpIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTogbGF5ZXIuZ2V0QXR0cmlidXRlKFwib3BhY2l0eVwiKSB8fCAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogKGxheWVyLmdldEF0dHJpYnV0ZShcInZpc2libGVcIikgPT09IHVuZGVmaW5lZCB8fCBsYXllci5nZXRBdHRyaWJ1dGUoXCJ2aXNpYmxlXCIpICE9IDApLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2VFbG0gPSBsYXllci5nZXRFbGVtZW50c0J5VGFnTmFtZShcImltYWdlXCIpWzBdO1xuICAgICAgICAgICAgICAgICAgICBsLmltYWdlID0ge3NvdXJjZTogaW1hZ2VFbG0uZ2V0QXR0cmlidXRlKFwic291cmNlXCIpfTtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2gobCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfcGVyc2VDU1ZcbiAgICAgKiBDU1bjga7jg5Hjg7zjgrnjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3BhcnNlQ1NWOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIHZhciBkYXRhTGlzdCA9IGRhdGEuc3BsaXQoJywnKTtcbiAgICAgICAgdmFyIGxheWVyID0gW107XG5cbiAgICAgICAgZGF0YUxpc3QuZWFjaChmdW5jdGlvbihlbG0sIGkpIHtcbiAgICAgICAgICAgIHZhciBudW0gPSBwYXJzZUludChlbG0sIDEwKSAtIDE7XG4gICAgICAgICAgICBsYXllci5wdXNoKG51bSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBsYXllcjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfcGVyc2VDU1ZcbiAgICAgKiBCQVNFNjTjga7jg5Hjg7zjgrnjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOWGhemDqOOBp+S9v+eUqOOBl+OBpuOBhOOCi+mWouaVsOOBp+OBmeOAglxuICAgICAqIGh0dHA6Ly90aGVrYW5ub24tc2VydmVyLmFwcHNwb3QuY29tL2hlcnBpdHktZGVycGl0eS5hcHBzcG90LmNvbS9wYXN0ZWJpbi5jb20vNzVLa3MwV0hcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXJzZUJhc2U2NDogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICB2YXIgZGF0YUxpc3QgPSBhdG9iKGRhdGEudHJpbSgpKTtcbiAgICAgICAgdmFyIHJzdCA9IFtdO1xuXG4gICAgICAgIGRhdGFMaXN0ID0gZGF0YUxpc3Quc3BsaXQoJycpLm1hcChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICByZXR1cm4gZS5jaGFyQ29kZUF0KDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBmb3IgKHZhciBpPTAsbGVuPWRhdGFMaXN0Lmxlbmd0aC80OyBpPGxlbjsgKytpKSB7XG4gICAgICAgICAgICB2YXIgbiA9IGRhdGFMaXN0W2kqNF07XG4gICAgICAgICAgICByc3RbaV0gPSBwYXJzZUludChuLCAxMCkgLSAxO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJzdDtcbiAgICB9LFxufSk7XG5cbi8v44Ot44O844OA44O844Gr6L+95YqgXG5waGluYS5hc3NldC5Bc3NldExvYWRlci5hc3NldExvYWRGdW5jdGlvbnMudG14ID0gZnVuY3Rpb24oa2V5LCBwYXRoKSB7XG4gICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LlRpbGVkTWFwKCk7XG4gICAgcmV0dXJuIHRteC5sb2FkKHBhdGgpO1xufTtcbiIsIi8qXG4gKiAgcGhpbmEudmlydHVhbHBhZC5qc1xuICogIDIwMTcvMDYvMTNcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG5waGluYS5leHRlbnNpb24gPSBwaGluYS5leHRlbnNpb24gfHwge307XG5cbi8v44OQ44O844OB44Oj44Or44OR44OD44OJXG5waGluYS5kZWZpbmUoXCJwaGluYS5leHRlbnNpb24uVmlydHVhbFBhZFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICBhY3RpdmU6IHRydWUsXG5cbiAgICAvL+aMv+S4i+OCreODvOaDheWgsVxuICAgIGtleURhdGE6IHtcbiAgICAgICAgdXA6IGZhbHNlLFxuICAgICAgICBkb3duOiBmYWxzZSxcbiAgICAgICAgbGVmdDogZmFsc2UsXG4gICAgICAgIHJpZ2h0OiBmYWxzZSxcbiAgICAgICAgYTogZmFsc2UsXG4gICAgICAgIGI6IGZhbHNlLFxuICAgIH0sXG5cbiAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgICAvL+ODkeODg+ODiee4puaoqlxuICAgICAgICB3aWR0aDogNjQwLFxuICAgICAgICBoZWlnaHQ6IDQ4MCxcblxuICAgICAgICAvL+ODkeODg+ODieW6p+aomVxuICAgICAgICB4OiAwLFxuICAgICAgICB5OiAwLFxuXG4gICAgICAgIC8v5Yik5a6a5Y2K5b6EXG4gICAgICAgIGZpbmdlclJhZGl1czogMjAsXG4gICAgfSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh0aGlzLmRlZmF1bHRPcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcblxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDogb3B0aW9ucy53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogb3B0aW9ucy5oZWlnaHQsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC4zKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMC4zKVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lndGg6IDAsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWFzayA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4vLyAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDAsIDApXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24ob3B0aW9ucy54LCBvcHRpb25zLnkpO1xuXG4gICAgICAgIHRoaXMuYW5hbG9nID0gcGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWQuQW5hbG9nU3RpY2soKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbig4Miwgb3B0aW9ucy5oZWlnaHQgLSA4Mik7XG5cbiAgICAgICAgdGhpcy5idG4gPSBbXTtcbiAgICAgICAgdGhpcy5idG5bMF0gPSBwaGluYS5leHRlbnNpb24uVmlydHVhbFBhZC5CdXR0b24oKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKG9wdGlvbnMud2lkdGggKiAwLjcsIG9wdGlvbnMuaGVpZ2h0ICogMC45KTtcbiAgICAgICAgdGhpcy5idG5bMV0gPSBwaGluYS5leHRlbnNpb24uVmlydHVhbFBhZC5CdXR0b24oKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKG9wdGlvbnMud2lkdGggKiAwLjcgKyA4MCwgb3B0aW9ucy5oZWlnaHQgKiAwLjkpO1xuXG4gICAgICAgIC8v44K/44OD44OX5L2N572u6KGo56S6XG4gICAgICAgIHZhciBmaW5nZXJQYXJhbSA9IHtcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwwLjIpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwwLjIpXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcbiAgICAgICAgICAgIHJhZGl1czogb3B0aW9ucy5maW5nZXJSYWRpdXMsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZmluZ2VyID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmZpbmdlcltpXSA9IHBoaW5hLmRpc3BsYXkuQ2lyY2xlU2hhcGUoZmluZ2VyUGFyYW0pLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgICAgICB0aGlzLmZpbmdlcltpXS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICB9LFxuXG4gICAgdXBkYXRlSW5mbzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwID0gYXBwLm1vdXNlO1xuICAgICAgICBpZiAocC5nZXRQb2ludGluZygpKSB7XG4gICAgICAgICAgICAvL+OCv+ODg+ODl+S9jee9ruihqOekulxuICAgICAgICAgICAgdmFyIHBzID0gYXBwLnBvaW50ZXJzO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoaSA8IHBzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmdlcltpXS52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5nZXJbaV0uc2V0UG9zaXRpb24ocHNbaV0ueCwgcHNbaV0ueSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5nZXJbaV0udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maW5nZXJbaV0udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldEtleTogZnVuY3Rpb24oY29kZSkge1xuICAgICAgICB2YXIgb3YgPSAxMDtcbiAgICAgICAgdmFyIGFuZ2xlID0gdGhpcy5hbmFsb2cuYW5nbGU7XG4gICAgICAgIHN3aXRjaCAoY29kZSkge1xuICAgICAgICAgICAgY2FzZSBcInJpZ2h0XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ2xlICYmIChhbmdsZSA+PSAzMTUgLSBvdiB8fCBhbmdsZSA8PSA0NSArIG92KTtcbiAgICAgICAgICAgIGNhc2UgXCJkb3duXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ2xlICYmIChhbmdsZSA+PSA0NSAtIG92ICYmIGFuZ2xlIDw9IDEzNSArIG92KTtcbiAgICAgICAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ2xlICYmIChhbmdsZSA+PSAxMzUgLSBvdiAmJiBhbmdsZSA8PSAyMTUgKyBvdik7XG4gICAgICAgICAgICBjYXNlIFwidXBcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5nbGUgJiYgKGFuZ2xlID49IDIxNSAtIG92ICYmIGFuZ2xlIDw9IDMxNSArIG92KTtcbiAgICAgICAgICAgIGNhc2UgXCJ6XCI6XG4gICAgICAgICAgICBjYXNlIFwiWlwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ0blswXS5pc09uO1xuICAgICAgICAgICAgY2FzZSBcInhcIjpcbiAgICAgICAgICAgIGNhc2UgXCJYXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnRuWzFdLmlzT247XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG59KTtcblxuLy/jg5Djg7zjg4Hjg6Pjg6vjg5Hjg4Pjg4nljYHlrZfjgq3jg7xcbnBoaW5hLmRlZmluZShcInBoaW5hLmV4dGVuc2lvbi5WaXJ0dWFsUGFkLkNyb3NzS2V5XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnRcIixcblxuICAgIGFjdGl2ZTogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh0aGlzLmRlZmF1bHRPcHRpb25zKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcblxuICAgICAgICAvL+WNgeWtl+OCreODvOS4reW/g+eCuVxuICAgICAgICB2YXIgaHcgPSAwO1xuICAgICAgICB2YXIgaGggPSAwO1xuICAgICAgICB2YXIgY3AgPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG5cbiAgICAgICAgdmFyIGJ1dHRvbiA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAyMCxcbiAgICAgICAgICAgIGhlaWdodDogMjAsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC4yKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMC4yKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICAvLzA65LiKIDE65Y+z5LiKIDI65Y+zIDM65Y+z5LiLIDQ65LiLIDU65bem5LiLIDY65bemIDc65bem5LiKXG4gICAgICAgIHRoaXMuYnRuID0gW107XG4gICAgICAgIHRoaXMuYnRuWzBdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDYwLCBoZWlnaHQ6IDUwfS4kc2FmZShidXR0b24pKS5zZXRQb3NpdGlvbihjcC54ICAgICAsIGNwLnkgLSA0MCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgdGhpcy5idG5bMl0gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogNTAsIGhlaWdodDogNjB9LiRzYWZlKGJ1dHRvbikpLnNldFBvc2l0aW9uKGNwLnggKyA0MCwgY3AueSAgICAgKS5hZGRDaGlsZFRvKHRoaXMpLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB0aGlzLmJ0bls0XSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiA2MCwgaGVpZ2h0OiA1MH0uJHNhZmUoYnV0dG9uKSkuc2V0UG9zaXRpb24oY3AueCAgICAgLCBjcC55ICsgNDApLmFkZENoaWxkVG8odGhpcykuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMuYnRuWzZdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDUwLCBoZWlnaHQ6IDYwfS4kc2FmZShidXR0b24pKS5zZXRQb3NpdGlvbihjcC54IC0gNDAsIGNwLnkgICAgICkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcblxuICAgICAgICB0aGlzLmJ0blsxXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAzMCwgaGVpZ2h0OiAzMH0uJHNhZmUoYnV0dG9uKSkuc2V0UG9zaXRpb24oY3AueCArIDQwLCBjcC55IC0gNDApLmFkZENoaWxkVG8odGhpcykuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMuYnRuWzNdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDMwLCBoZWlnaHQ6IDMwfS4kc2FmZShidXR0b24pKS5zZXRQb3NpdGlvbihjcC54ICsgNDAsIGNwLnkgKyA0MCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgdGhpcy5idG5bNV0gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMzAsIGhlaWdodDogMzB9LiRzYWZlKGJ1dHRvbikpLnNldFBvc2l0aW9uKGNwLnggLSA0MCwgY3AueSArIDQwKS5hZGRDaGlsZFRvKHRoaXMpLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB0aGlzLmJ0bls3XSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAzMCwgaGVpZ2h0OiAzMH0uJHNhZmUoYnV0dG9uKSkuc2V0UG9zaXRpb24oY3AueCAtIDQwLCBjcC55IC0gNDApLmFkZENoaWxkVG8odGhpcykuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJ0bi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5idG5baV0uaXNPbiA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5idG5baV0ub24oJ3BvaW50b3ZlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNPbiA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuYnRuW2ldLm9uKCdwb2ludG91dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNPbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+aMv+S4i+OCreODvOaDheWgsVxuICAgICAgICB0aGlzLmtleWRhdGEgPSB7XG4gICAgICAgICAgICB1cDogZmFsc2UsXG4gICAgICAgICAgICBkb3duOiBmYWxzZSxcbiAgICAgICAgICAgIGxlZnQ6IGZhbHNlLFxuICAgICAgICAgICAgcmlnaHQ6IGZhbHNlLFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmtleWRhdGEgPSB7XG4gICAgICAgICAgICB1cDogdGhpcy5idG5bMF0uaXNPbiB8fCB0aGlzLmJ0blsxXS5pc09uIHx8IHRoaXMuYnRuWzddLmlzT24sXG4gICAgICAgICAgICByaWdodDogdGhpcy5idG5bMl0uaXNPbiB8fCB0aGlzLmJ0blsxXS5pc09uIHx8IHRoaXMuYnRuWzNdLmlzT24sXG4gICAgICAgICAgICBkb3duOiB0aGlzLmJ0bls0XS5pc09uIHx8IHRoaXMuYnRuWzNdLmlzT24gfHwgdGhpcy5idG5bNV0uaXNPbixcbiAgICAgICAgICAgIGxlZnQ6IHRoaXMuYnRuWzZdLmlzT24gfHwgdGhpcy5idG5bNV0uaXNPbiB8fCB0aGlzLmJ0bls3XS5pc09uLFxuICAgICAgICB9O1xuICAgIH0sXG59KTtcblxuLy/jg5Djg7zjg4Hjg6Pjg6vjg5Hjg4Pjg4njg5zjgr/jg7NcbnBoaW5hLmRlZmluZShcInBoaW5hLmV4dGVuc2lvbi5WaXJ0dWFsUGFkLkJ1dHRvblwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICBhY3RpdmU6IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG5cbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgcmFkaXVzOiBvcHRpb25zLnJhZGl1cyB8fCAzMCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwwLjMpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYnRuID0gcGhpbmEuZGlzcGxheS5DaXJjbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIHRoaXMuYnRuLm9uKCdwb2ludG92ZXInLCBlID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNPbiA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmJ0bi5vbigncG9pbnRvdXQnLCBlID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNPbiA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9LFxufSk7XG5cbi8v44OQ44O844OB44Oj44Or44OR44OD44OJ44Ki44OK44Ot44Kw44K544OG44Kj44OD44KvXG5waGluYS5kZWZpbmUoXCJwaGluYS5leHRlbnNpb24uVmlydHVhbFBhZC5BbmFsb2dTdGlja1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkNpcmNsZVNoYXBlXCIsXG5cbiAgICBhY3RpdmU6IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHtcbiAgICAgICAgICAgIHJhZGl1czogODAsXG4gICAgICAgICAgICBmaWxsOiBudWxsLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9KTtcblxuICAgICAgICAvL+S4reW/g+eCuVxuICAgICAgICB2YXIgaHcgPSAwO1xuICAgICAgICB2YXIgaGggPSAwO1xuICAgICAgICB2YXIgY3AgPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG5cbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgcmFkaXVzOiAyMCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwwLjMpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwwLjMpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaW5uZXIgPSBwaGluYS5kaXNwbGF5LkNpcmNsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgdGhpcy52ZWN0b3IgPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG4gICAgICAgIHRoaXMucHQgPSBudWxsO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIWFwcC5wb2ludGVyLmdldFBvaW50aW5nKCkpIHtcbiAgICAgICAgICAgIHRoaXMudmVjdG9yLnNldCgwLCAwKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcG9pbnRlcnMgPSBhcHAucG9pbnRlcnM7XG4gICAgICAgIHBvaW50ZXJzLmZvckVhY2gocG9pbnRlciA9PiB7XG4gICAgICAgICAgICBpZiAocG9pbnRlci5nZXRQb2ludGluZ1N0YXJ0KCkgJiYgdGhpcy5oaXRUZXN0KHBvaW50ZXIueCwgcG9pbnRlci55KSkge1xuICAgICAgICAgICAgICAgIHRoaXMucHQgPSBwb2ludGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRoaXMucHQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnB0LmdldFBvaW50aW5nKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZlY3Rvci5zZXQodGhpcy5wdC54IC0gdGhpcy54LCB0aGlzLnB0LnkgLSB0aGlzLnkpLm5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnB0LmdldFBvaW50aW5nRW5kKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZlY3Rvci5zZXQoMCwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbm5lci54ID0gdGhpcy52ZWN0b3IueCAqIHRoaXMucmFkaXVzICogMC42O1xuICAgICAgICB0aGlzLmlubmVyLnkgPSB0aGlzLnZlY3Rvci55ICogdGhpcy5yYWRpdXMgKiAwLjY7XG5cbiAgICAgICAgLy/op5LluqZcbiAgICAgICAgaWYgKHRoaXMudmVjdG9yLnggPT0gMCAmJiB0aGlzLnZlY3Rvci55ID09IDApIHtcbiAgICAgICAgICAgIHRoaXMuYW5nbGUgPSBudWxsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hbmdsZSA9IE1hdGguZmxvb3IoTWF0aC5hdGFuMih0aGlzLnZlY3Rvci55LCB0aGlzLnZlY3Rvci54KS50b0RlZ3JlZSgpKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmFuZ2xlIDwgMCkgdGhpcy5hbmdsZSArPSAzNjA7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG4iLCIvKlxuICogIFNvdW5kU2V0LmpzXG4gKiAgMjAxNC8xMS8yOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmV4dGVuc2lvbiA9IHBoaW5hLmV4dGVuc2lvbiB8fCB7fTtcblxuLy/jgrXjgqbjg7Pjg4nnrqHnkIZcbnBoaW5hLmRlZmluZShcInBoaW5hLmV4dGVuc2lvbi5Tb3VuZFNldFwiLCB7XG5cbiAgICAvL+OCteOCpuODs+ODieOBjOagvOe0jeOBleOCjOOCi+mFjeWIl1xuICAgIGVsZW1lbnRzOiBudWxsLFxuXG4gICAgLy/lho3nlJ/kuK3vvKLvvKfvvK1cbiAgICBiZ206IG51bGwsXG4gICAgYmdtSXNQbGF5OiBmYWxzZSxcblxuICAgIC8v44Oe44K544K/44O844Oc44Oq44Ol44O844OgXG4gICAgdm9sdW1lQkdNOiAwLjUsXG4gICAgdm9sdW1lU0U6IDAuNSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmVsZW1lbnRzID0gW107XG4gICAgfSxcblxuICAgIC8v55m76Yyy5riI44G/44Ki44K744OD44OI6Kqt44G/6L6844G/XG4gICAgcmVhZEFzc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5hc3NldHMuc291bmQpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KFwic291bmRcIiwga2V5KTtcbiAgICAgICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBwaGluYS5hc3NldC5Tb3VuZCkgdGhpcy5hZGQoa2V5KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+OCteOCpuODs+ODiei/veWKoFxuICAgIGFkZDogZnVuY3Rpb24obmFtZSwgdXJsKSB7XG4gICAgICAgIGlmIChuYW1lID09PSB1bmRlZmluZWQpIHJldHVybiBudWxsO1xuICAgICAgICB1cmwgPSB1cmwgfHwgbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuZmluZChuYW1lKSkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgdmFyIGUgPSBwaGluYS5leHRlbnNpb24uU291bmRFbGVtZW50KG5hbWUpO1xuICAgICAgICBpZiAoIWUubWVkaWEpIHJldHVybiBmYWxzZTtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5wdXNoKGUpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrXjgqbjg7Pjg4nmpJzntKJcbiAgICBmaW5kOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgIGlmICghdGhpcy5lbGVtZW50cykgcmV0dXJuIG51bGw7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudHNbaV0ubmFtZSA9PSBuYW1lKSByZXR1cm4gdGhpcy5lbGVtZW50c1tpXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuXG4gICAgLy/jgrXjgqbjg7Pjg4njgpLvvKLvvKfvvK3jgajjgZfjgablho3nlJ9cbiAgICBwbGF5QkdNOiBmdW5jdGlvbihuYW1lLCBsb29wLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAobG9vcCA9PT0gdW5kZWZpbmVkKSBsb29wID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuYmdtKSB7XG4gICAgICAgICAgICB0aGlzLmJnbS5zdG9wKCk7XG4gICAgICAgICAgICB0aGlzLmJnbUlzUGxheSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5maW5kKG5hbWUpO1xuICAgICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHZvbCA9IHRoaXMudm9sdW1lQkdNICogZWxlbWVudC5fdm9sdW1lO1xuICAgICAgICAgICAgZWxlbWVudC5tZWRpYS52b2x1bWUgPSB2b2w7XG4gICAgICAgICAgICBlbGVtZW50LnBsYXkobG9vcCwgY2FsbGJhY2spO1xuICAgICAgICAgICAgdGhpcy5iZ20gPSBlbGVtZW50O1xuICAgICAgICAgICAgdGhpcy5iZ21Jc1BsYXkgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuYWRkKG5hbWUpKSB0aGlzLnBsYXlCR00obmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v77yi77yn77yt5YGc5q2iXG4gICAgc3RvcEJHTTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmJnbSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYmdtSXNQbGF5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5iZ20uc3RvcCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYmdtSXNQbGF5ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmJnbSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v77yi77yn77yt5LiA5pmC5YGc5q2iXG4gICAgcGF1c2VCR006IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5iZ20pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJnbUlzUGxheSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5iZ21Jc1BsYXkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/vvKLvvKfvvK3lho3plotcbiAgICByZXN1bWVCR006IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5iZ20pIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5iZ21Jc1BsYXkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJnbS52b2x1bWUgPSB0aGlzLnZvbHVtZUJHTTtcbiAgICAgICAgICAgICAgICB0aGlzLmJnbS5yZXN1bWUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJnbUlzUGxheSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v77yi77yn77yt44Oe44K544K/44O844Oc44Oq44Ol44O844Og6Kit5a6aXG4gICAgc2V0Vm9sdW1lQkdNOiBmdW5jdGlvbih2b2wpIHtcbiAgICAgICAgdGhpcy52b2x1bWVCR00gPSB2b2w7XG4gICAgICAgIGlmICh0aGlzLmJnbSkge1xuICAgICAgICAgICAgdGhpcy5iZ20ucGF1c2UoKTtcbiAgICAgICAgICAgIHRoaXMuYmdtLnNldFZvbHVtZSh0aGlzLnZvbHVtZUJHTSAqIHRoaXMuYmdtLl92b2x1bWUpO1xuICAgICAgICAgICAgdGhpcy5iZ20ucmVzdW1lKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44Ki44K744OD44OI44KS5oyH5a6a44GX44Gm44Oc44Oq44Ol44O844Og44KS6Kit5a6aXG4gICAgc2V0Vm9sdW1lOiBmdW5jdGlvbihuYW1lLCB2b2wpIHtcbiAgICAgICAgdmFyIG1lZGlhID0gdGhpcy5maW5kKG5hbWUpO1xuICAgICAgICBpZiAobWVkaWEpIHtcbiAgICAgICAgICAgIG1lZGlhLnNldFZvbHVtZSh2b2wpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+OCteOCpuODs+ODieOCkuOCteOCpuODs+ODieOCqOODleOCp+OCr+ODiOOBqOOBl+OBpuWGjeeUn1xuICAgIHBsYXlTRTogZnVuY3Rpb24obmFtZSwgbG9vcCwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmZpbmQobmFtZSk7XG4gICAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgdm9sID0gdGhpcy52b2x1bWVTRSAqIGVsZW1lbnQuX3ZvbHVtZTtcbiAgICAgICAgICAgIGVsZW1lbnQubWVkaWEudm9sdW1lID0gdm9sO1xuICAgICAgICAgICAgZWxlbWVudC5wbGF5KGxvb3AsIGNhbGxiYWNrKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFkZChuYW1lKSkgdGhpcy5wbGF5U0UobmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44Or44O844OX5YaN55Sf44GX44Gm44GE44KLU0XjgpLlgZzmraJcbiAgICBzdG9wU0U6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgdmFyIG1lZGlhID0gdGhpcy5maW5kKG5hbWUpO1xuICAgICAgICBpZiAobWVkaWEpIHtcbiAgICAgICAgICAgIG1lZGlhLnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/vvKLvvKfvvK3kuIDmmYLlgZzmraJcbiAgICBwYXVzZUJHTTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmJnbSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYmdtSXNQbGF5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5iZ20ucGF1c2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJnbUlzUGxheSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL++8s++8peODnuOCueOCv+ODvOODnOODquODpeODvOODoOioreWumlxuICAgIHNldFZvbHVtZVNFOiBmdW5jdGlvbih2b2wpIHtcbiAgICAgICAgdGhpcy52b2x1bWVTRSA9IHZvbDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuXG4vL1NvdW5kRWxlbWVudCBCYXNpY1xucGhpbmEuZGVmaW5lKFwicGhpbmEuZXh0ZW5zaW9uLlNvdW5kRWxlbWVudFwiLCB7XG4gICAgLy/jgrXjgqbjg7Pjg4nlkI1cbiAgICBuYW1lOiBudWxsLFxuXG4gICAgLy/vvLXvvLLvvKxcbiAgICB1cmw6IG51bGwsXG5cbiAgICAvL+OCteOCpuODs+ODieacrOS9k1xuICAgIG1lZGlhOiBudWxsLFxuXG4gICAgLy/jg5zjg6rjg6Xjg7zjg6BcbiAgICBfdm9sdW1lOiAxLFxuXG4gICAgLy/lho3nlJ/ntYLkuobmmYLjga7jgrPjg7zjg6vjg5Djg4Pjgq/plqLmlbBcbiAgICBjYWxsYmFjazogbnVsbCxcblxuICAgIC8v5YaN55Sf5Lit44OV44Op44KwXG4gICAgcGxheWluZzogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMubWVkaWEgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KFwic291bmRcIiwgbmFtZSk7XG4gICAgICAgIGlmICh0aGlzLm1lZGlhKSB7XG4gICAgICAgICAgICB0aGlzLm1lZGlhLnZvbHVtZSA9IDE7XG4gICAgICAgICAgICB0aGlzLm1lZGlhLm9uKCdlbmRlZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1lZGlhLmxvb3ApIHRoaXMucGxheWluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbGxiYWNrKSB0aGlzLmNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJhc3NldCBub3QgZm91bmQuIFwiK25hbWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44K144Km44Oz44OJ44Gu5YaN55SfXG4gICAgcGxheTogZnVuY3Rpb24obG9vcCwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGxvb3AgPT09IHVuZGVmaW5lZCkgbG9vcCA9IGZhbHNlXG4gICAgICAgIGlmICghdGhpcy5tZWRpYSkgcmV0dXJuIHRoaXM7XG5cbiAgICAgICAgLy/jg6vjg7zjg5flho3nlJ/jga7loLTlkIjlpJrph43lho3nlJ/jgpLnpoHmraJcbiAgICAgICAgaWYgKGxvb3AgJiYgdGhpcy5wbGF5aW5nKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5tZWRpYS5sb29wID0gbG9vcDtcbiAgICAgICAgdGhpcy5tZWRpYS5wbGF5KCk7XG4gICAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgICAgdGhpcy5wbGF5aW5nID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44K144Km44Oz44OJ5YaN55Sf5YaN6ZaLXG4gICAgcmVzdW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLm1lZGlhKSByZXR1cm4gdGhpcztcbiAgICAgICAgdGhpcy5tZWRpYS5yZXN1bWUoKTtcbiAgICAgICAgdGhpcy5wbGF5aW5nID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44K144Km44Oz44OJ5LiA5pmC5YGc5q2iXG4gICAgcGF1c2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLm1lZGlhKSByZXR1cm4gdGhpcztcbiAgICAgICAgdGhpcy5tZWRpYS5wYXVzZSgpO1xuICAgICAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgLy/jgrXjgqbjg7Pjg4nlgZzmraJcbiAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLm1lZGlhKSByZXR1cm4gdGhpcztcbiAgICAgICAgdGhpcy5tZWRpYS5zdG9wKCk7XG4gICAgICAgIHRoaXMucGxheWluZyA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/jg5zjg6rjg6Xjg7zjg6DoqK3lrppcbiAgICBzZXRWb2x1bWU6IGZ1bmN0aW9uKHZvbCkge1xuICAgICAgICBpZiAoIXRoaXMubWVkaWEpIHJldHVybiB0aGlzO1xuICAgICAgICBpZiAodm9sID09PSB1bmRlZmluZWQpIHZvbCA9IDAuNTtcbiAgICAgICAgdGhpcy5fdm9sdW1lID0gdm9sO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgX2FjY2Vzc29yOiB7XG4gICAgICAgIHZvbHVtZToge1xuICAgICAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLl92b2x1bWU7IH0sXG4gICAgICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2b2wpIHsgdGhpcy5zZXRWb2x1bWUodm9sKTsgfVxuICAgICAgICB9LFxuICAgICAgICBsb29wOiB7XG4gICAgICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMubWVkaWEubG9vcDsgfSxcbiAgICAgICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKGYpIHsgdGhpcy5tZWRpYS5sb29wID0gZjsgfVxuICAgICAgICB9LFxuICAgIH1cbn0pO1xuIiwiLypcbiAqICBhcHBsaWNhdGlvbi5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8vbmFtZXNwYWFjZSBRdWVzdCBGb3IgdGhlIFRhbmVsb3JuXG52YXIgcWZ0ID0ge307XG5cbnBoaW5hLmRlZmluZShcInFmdC5BcHBsaWNhdGlvblwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkNhbnZhc0FwcFwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHtcbiAgICAgICAgICAgIHF1ZXJ5OiAnI3dvcmxkJyxcbiAgICAgICAgICAgIHdpZHRoOiBTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OiBTQ19ILFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgwLCAwLCAwLCAxKScsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmZwcyA9IEZQUztcblxuICAgICAgICAvL+OCsuODvOODoOODkeODg+ODieeuoeeQhlxuICAgICAgICB0aGlzLmdhbWVwYWRNYW5hZ2VyID0gcGhpbmEuaW5wdXQuR2FtZXBhZE1hbmFnZXIoKTtcbiAgICAgICAgdGhpcy5nYW1lcGFkID0gdGhpcy5nYW1lcGFkTWFuYWdlci5nZXQoMCk7XG5cbiAgICAgICAgLy/jg5Djg7zjg4Hjg6Pjg6vjg5Hjg4Pjg4lcbiAgICAgICAgdGhpcy52aXJ0dWFsUGFkID0gcGhpbmEuZXh0ZW5zaW9uLlZpcnR1YWxQYWQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KS5zZXRQb3NpdGlvbigwLCAwKTtcblxuICAgICAgICAvL+ODkeODg+ODieaDheWgseOCkuabtOaWsFxuICAgICAgICB0aGlzLm9uKCdlbnRlcmZyYW1lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWVwYWRNYW5hZ2VyLnVwZGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy52aXJ0dWFsUGFkLnVwZGF0ZUluZm8oKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ29udHJvbGxlcigpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0ge307XG5cbiAgICAgICAgLy/jgrXjgqbjg7Pjg4njgrvjg4Pjg4hcbiAgICAgICAgdGhpcy5zb3VuZHNldCA9IHBoaW5hLmV4dGVuc2lvbi5Tb3VuZFNldCgpO1xuXG4gICAgICAgIC8vTGFiZWzjg4fjg5Xjgqnjg6vjg4joqK3lrppcbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbC5kZWZhdWx0cy4kZXh0ZW5kKHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibHVlXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAzMixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB1cGRhdGVDb250cm9sbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGJlZm9yZSA9IHRoaXMuY29udHJvbGxlcjtcbiAgICAgICAgYmVmb3JlLmJlZm9yZSA9IG51bGw7XG5cbiAgICAgICAgdmFyIGdwID0gdGhpcy5nYW1lcGFkO1xuICAgICAgICB2YXIga2IgPSB0aGlzLmtleWJvYXJkO1xuICAgICAgICB2YXIgYW5nbGUxID0gZ3AuZ2V0S2V5QW5nbGUoKTtcbiAgICAgICAgdmFyIGFuZ2xlMiA9IGtiLmdldEtleUFuZ2xlKCk7XG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IHtcbiAgICAgICAgICAgIGFuZ2xlOiBhbmdsZTEgIT09IG51bGw/IGFuZ2xlMTogYW5nbGUyLFxuXG4gICAgICAgICAgICB1cDogZ3AuZ2V0S2V5KFwidXBcIikgfHwga2IuZ2V0S2V5KFwidXBcIiksXG4gICAgICAgICAgICBkb3duOiBncC5nZXRLZXkoXCJkb3duXCIpIHx8IGtiLmdldEtleShcImRvd25cIiksXG4gICAgICAgICAgICBsZWZ0OiBncC5nZXRLZXkoXCJsZWZ0XCIpIHx8IGtiLmdldEtleShcImxlZnRcIiksXG4gICAgICAgICAgICByaWdodDogZ3AuZ2V0S2V5KFwicmlnaHRcIikgfHwga2IuZ2V0S2V5KFwicmlnaHRcIiksXG5cbiAgICAgICAgICAgIGF0dGFjazogZ3AuZ2V0S2V5KFwiWFwiKSB8fCBrYi5nZXRLZXkoXCJaXCIpLFxuICAgICAgICAgICAganVtcDogICBncC5nZXRLZXkoXCJ1cFwiKSB8fCBncC5nZXRLZXkoXCJBXCIpIHx8IGtiLmdldEtleShcInVwXCIpIHx8IGtiLmdldEtleShcIlhcIiksXG4gICAgICAgICAgICBjaGFuZ2U6IGdwLmdldEtleShcIkJcIikgfHwga2IuZ2V0S2V5KFwiQ1wiKSxcbiAgICAgICAgICAgIG1lbnU6ICAgZ3AuZ2V0S2V5KFwic3RhcnRcIikgfHwga2IuZ2V0S2V5KFwiZXNjYXBlXCIpLFxuXG4gICAgICAgICAgICBhOiBncC5nZXRLZXkoXCJBXCIpIHx8IGtiLmdldEtleShcIlpcIiksXG4gICAgICAgICAgICBiOiBncC5nZXRLZXkoXCJCXCIpIHx8IGtiLmdldEtleShcIlhcIiksXG4gICAgICAgICAgICB4OiBncC5nZXRLZXkoXCJYXCIpIHx8IGtiLmdldEtleShcIkNcIiksXG4gICAgICAgICAgICB5OiBncC5nZXRLZXkoXCJZXCIpIHx8IGtiLmdldEtleShcIlZcIiksXG5cbiAgICAgICAgICAgIG9rOiBncC5nZXRLZXkoXCJBXCIpIHx8IGtiLmdldEtleShcIlpcIikgfHwga2IuZ2V0S2V5KFwic3BhY2VcIikgfHwga2IuZ2V0S2V5KFwicmV0dXJuXCIpLFxuICAgICAgICAgICAgY2FuY2VsOiBncC5nZXRLZXkoXCJCXCIpIHx8IGtiLmdldEtleShcIlhcIikgfHwga2IuZ2V0S2V5KFwiZXNjYXBlXCIpLFxuXG4gICAgICAgICAgICBzdGFydDogZ3AuZ2V0S2V5KFwic3RhcnRcIikgfHwga2IuZ2V0S2V5KFwicmV0dXJuXCIpLFxuICAgICAgICAgICAgc2VsZWN0OiBncC5nZXRLZXkoXCJzZWxlY3RcIiksXG5cbiAgICAgICAgICAgIHBhdXNlOiBncC5nZXRLZXkoXCJzdGFydFwiKSB8fCBrYi5nZXRLZXkoXCJlc2NhcGVcIiksXG5cbiAgICAgICAgICAgIGFuYWxvZzE6IGdwLmdldFN0aWNrRGlyZWN0aW9uKDApLFxuICAgICAgICAgICAgYW5hbG9nMjogZ3AuZ2V0U3RpY2tEaXJlY3Rpb24oMSksXG5cbiAgICAgICAgICAgIC8v5YmN44OV44Os44O844Og5oOF5aCxXG4gICAgICAgICAgICBiZWZvcmU6IGJlZm9yZSxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgX29uTG9hZEFzc2V0czogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc291bmRzZXQucmVhZEFzc2V0KCk7XG5cbiAgICAgICAgLy/nibnmrorlirnmnpznlKjjg5Pjg4Pjg4jjg57jg4Pjg5fkvZzmiJBcbiAgICAgICAgW1xuICAgICAgICAgICAgXCJwbGF5ZXIxXCIsXG4gICAgICAgICAgICBcInBsYXllcjJcIixcbiAgICAgICAgXS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgIGlmICghcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUpKSByZXR1cm47XG5cbiAgICAgICAgICAgIC8v44OA44Oh44O844K455SoXG4gICAgICAgICAgICBpZiAoIXBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoXCJpbWFnZVwiLCBuYW1lK1wiV2hpdGVcIikpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUpLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgdGV4LmZpbHRlciggZnVuY3Rpb24ocGl4ZWwsIGluZGV4LCB4LCB5LCBiaXRtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBiaXRtYXAuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCswXSA9IChwaXhlbFswXSA9PSAwPyAwOiAxMjgpOyAvL3JcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCsxXSA9IChwaXhlbFsxXSA9PSAwPyAwOiAxMjgpOyAvL2dcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCsyXSA9IChwaXhlbFsyXSA9PSAwPyAwOiAxMjgpOyAvL2JcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuc2V0KFwiaW1hZ2VcIiwgbmFtZStcIldoaXRlXCIsIHRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+eAleatu+eUqFxuICAgICAgICAgICAgaWYgKCFwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KFwiaW1hZ2VcIiwgbmFtZStcIlJlZFwiKSkge1xuICAgICAgICAgICAgICAgIHZhciB0ZXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KFwiaW1hZ2VcIiwgbmFtZSkuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB0ZXguZmlsdGVyKCBmdW5jdGlvbihwaXhlbCwgaW5kZXgsIHgsIHksIGJpdG1hcCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGJpdG1hcC5kYXRhO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2luZGV4KzBdID0gcGl4ZWxbMF07XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMV0gPSAwO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2luZGV4KzJdID0gMDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuc2V0KFwiaW1hZ2VcIiwgbmFtZStcIlJlZFwiLCB0ZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/lvbHnlKhcbiAgICAgICAgICAgIGlmICghcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUrXCJCbGFja1wiKSkge1xuICAgICAgICAgICAgICAgIHZhciB0ZXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KFwiaW1hZ2VcIiwgbmFtZSkuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB0ZXguZmlsdGVyKCBmdW5jdGlvbihwaXhlbCwgaW5kZXgsIHgsIHksIGJpdG1hcCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGJpdG1hcC5kYXRhO1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2luZGV4KzBdID0gMDtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpbmRleCsxXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbaW5kZXgrMl0gPSAwO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5zZXQoXCJpbWFnZVwiLCBuYW1lK1wiQmxhY2tcIiwgdGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHBsYXlCR006IGZ1bmN0aW9uKGFzc2V0LCBsb29wLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAobG9vcCA9PT0gdW5kZWZpbmVkKSBsb29wID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zb3VuZHNldC5wbGF5QkdNKGFzc2V0LCBsb29wLCBjYWxsYmFjayk7XG4gICAgfSxcblxuICAgIHN0b3BCR006IGZ1bmN0aW9uKGFzc2V0KSB7XG4gICAgICAgIHRoaXMuc291bmRzZXQuc3RvcEJHTSgpO1xuICAgIH0sXG5cbiAgICBzZXRWb2x1bWVCR006IGZ1bmN0aW9uKHZvbCkge1xuICAgICAgICBpZiAodm9sID4gMSkgdm9sID0gMTtcbiAgICAgICAgaWYgKHZvbCA8IDApIHZvbCA9IDA7XG4gICAgICAgIHRoaXMuc291bmRzZXQuc2V0Vm9sdW1lQkdNKHZvbCk7XG4gICAgfSxcblxuICAgIHBsYXlTRTogZnVuY3Rpb24oYXNzZXQsIGxvb3ApIHtcbiAgICAgICAgaWYgKGxvb3AgPT09IHVuZGVmaW5lZCkgbG9vcCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNvdW5kc2V0LnBsYXlTRShhc3NldCwgbG9vcCk7XG4gICAgfSxcblxuICAgIHNldFZvbHVtZVNFOiBmdW5jdGlvbih2b2wpIHtcbiAgICAgICAgaWYgKHZvbCA+IDEpIHZvbCA9IDE7XG4gICAgICAgIGlmICh2b2wgPCAwKSB2b2wgPSAwO1xuICAgICAgICB0aGlzLnNvdW5kc2V0LnNldFZvbHVtZVNFKHZvbCk7XG4gICAgfSxcblxuICAgIHNldFZvbHVtZTogZnVuY3Rpb24oYXNzZXQsIHZvbCkge1xuICAgICAgICB0aGlzLnNvdW5kc2V0LnNldFZvbHVtZShhc3NldCwgdm9sKTtcbiAgICB9LFxuXG4gICAgX2FjY2Vzc29yOiB7XG4gICAgICAgIHZvbHVtZUJHTToge1xuICAgICAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnNvdW5kcy52b2x1bWVCR007IH0sXG4gICAgICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2b2wpIHsgdGhpcy5zZXRWb2x1bWVCR00odm9sKTsgfVxuICAgICAgICB9LFxuICAgICAgICB2b2x1bWVTRToge1xuICAgICAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnNvdW5kcy52b2x1bWVTRTsgfSxcbiAgICAgICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHZvbCkgeyB0aGlzLnNldFZvbHVtZVNFKHZvbCk7IH1cbiAgICAgICAgfVxuICAgIH1cbn0pO1xuIiwiLypcbiAqICBhc3NldC5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5Bc3NldHNcIiwge1xuICAgIF9zdGF0aWM6IHtcbiAgICAgICAgbG9hZGVkOiBbXSxcbiAgICAgICAgaXNMb2FkZWQ6IGZ1bmN0aW9uKGFzc2V0VHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuIHFmdC5Bc3NldHMubG9hZGVkW2Fzc2V0VHlwZV0/IHRydWU6IGZhbHNlO1xuICAgICAgICB9LFxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHFmdC5Bc3NldHMubG9hZGVkW29wdGlvbnMuYXNzZXRUeXBlXSA9IHRydWU7XG4gICAgICAgICAgICBzd2l0Y2ggKG9wdGlvbnMuYXNzZXRUeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInNwbGFzaFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmdtYXBcIjogICBcImFzc2V0cy9pbWFnZS9vcGVuaW5nX21hcC5qcGdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmd0b3dlclwiOiBcImFzc2V0cy9pbWFnZS9vcGVuaW5nX3Rvd2VyLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwib3BlbmluZ2dyb3VuZFwiOlwiYXNzZXRzL2ltYWdlL29wZW5pbmdfZ3JvdW5kLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwib3BlbmluZ2JhY2tcIjogIFwiYXNzZXRzL2ltYWdlL29wZW5pbmdfYmFjay5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmdiYWNrMlwiOiBcImFzc2V0cy9pbWFnZS9vcGVuaW5nX2JnX2phbi5qcGdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9wZW5pbmdsaWdodFwiOiBcImFzc2V0cy9pbWFnZS9vcGVuaW5nX3RyZWVfbGlnaHRfeWVsbG93LnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGxheWVyMVwiOiAgICAgIFwiYXNzZXRzL2ltYWdlL2FjdG9yNC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhY2tncm91bmRcIjogICBcImFzc2V0cy9pbWFnZS9iYWNrLXMwM2IucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzcGxhc2gyXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwib3BlbmluZ2JnbVwiOiAgIFwiYXNzZXRzL3NvdW5kL0RTLTA3MG0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjb21tb25cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhY3RvcjRcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3I0LnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3IxOVwiOiAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjE5LnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3I0MFwiOiAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjQwLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3I1NVwiOiAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjU1LnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3I2NFwiOiAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjY0X2EucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhY3RvcjY0MlwiOiAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjY0X2IucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhY3RvcjEwOFwiOiAgICBcImFzc2V0cy9pbWFnZS9hY3RvcjEwOC5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdG9yMTExXCI6ICAgIFwiYXNzZXRzL2ltYWdlL2FjdG9yMTExLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWN0b3IxMTJcIjogICAgXCJhc3NldHMvaW1hZ2UvYWN0b3IxMTIucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3ZWFwb25zXCI6ICAgIFwiYXNzZXRzL2ltYWdlL3dlYXBvbnMucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpdGVtXCI6ICAgICAgIFwiYXNzZXRzL2ltYWdlL2l0ZW0ucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpdGVtYm94XCI6ICAgIFwiYXNzZXRzL2ltYWdlL3Rha2FyYWJha28ucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwYXJ0aWNsZVwiOiAgIFwiYXNzZXRzL2ltYWdlL3BhcnRpY2xlLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZG9vclwiOiAgICAgICBcImFzc2V0cy9pbWFnZS9kb29yLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2hlY2tpY29uXCI6ICBcImFzc2V0cy9pbWFnZS9jaGVjayBpY29uXzAwLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGl0bGViYWNrXCI6ICBcImFzc2V0cy9pbWFnZS90aXRsZWJhY2sucG5nXCIsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVudWZyYW1lXCI6ICBcImFzc2V0cy9pbWFnZS9uYzkyMzY3LnBuZ1wiLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtb25zdGVyMDFcIjogIFwiYXNzZXRzL2ltYWdlL21vbnN0ZXIwMS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1vbnN0ZXIwMlwiOiAgXCJhc3NldHMvaW1hZ2UvY2hhcl9tX2RldmlsMDEucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtb25zdGVyMDNcIjogIFwiYXNzZXRzL2ltYWdlL2NoYXJfbV9tYWdpMDEucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtb25zdGVyMDF4MlwiOiAgXCJhc3NldHMvaW1hZ2UvbW9uc3RlcjAxeDIucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtb25zdGVyMDJ4MlwiOiAgXCJhc3NldHMvaW1hZ2UvY2hhcl9tX2RldmlsMDF4Mi5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJ1bGxldFwiOiAgICAgXCJhc3NldHMvaW1hZ2UvZWZmZWN0X2J1bGxldDAxLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZWZmZWN0XCI6ICAgICBcImFzc2V0cy9pbWFnZS9lZmZlY3QucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlZmZlY3QyXCI6ICAgIFwiYXNzZXRzL2ltYWdlL2VmZmVjdDAxYS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImdhdGVcIjogICAgICAgXCJhc3NldHMvaW1hZ2UvZ2F0ZS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZsYW1lMDJcIjogICAgXCJhc3NldHMvaW1hZ2Uvb2JqZWN0X2ZpcmUwMmEucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmbGFtZTAzXCI6ICAgIFwiYXNzZXRzL2ltYWdlL29iamVjdF9maXJlMDNhLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmxhbWUwNVwiOiAgICBcImFzc2V0cy9pbWFnZS9vYmplY3RfZmlyZTA1YS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjY2Vzc29yeTFcIjogXCJhc3NldHMvaW1hZ2UvbWFwX2VmZmVjdDIucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJibG9ja1wiOiAgICAgIFwiYXNzZXRzL2ltYWdlL2Jsb2NrLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmxvb3JcIjogICAgICBcImFzc2V0cy9tYXAvVGlsZUE0LnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmFsbG9vblwiOiAgICBcImFzc2V0cy9pbWFnZS9jaGFyYTA5X2MxLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2hhZG93XCI6ICAgICBcImFzc2V0cy9pbWFnZS9zaGFkb3cucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc291bmQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNsaWNrXCI6ICAgICAgXCJhc3NldHMvc291bmQvc2VfbWFvdWRhbWFzaGlpX3N5c3RlbTQ0Lm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwib2tcIjogICAgICAgICBcImFzc2V0cy9zb3VuZC9zZV9tYW91ZGFtYXNoaWlfc3lzdGVtMzYubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjYW5jZWxcIjogICAgIFwiYXNzZXRzL3NvdW5kL3NlX21hb3VkYW1hc2hpaV9zeXN0ZW00My5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImF0dGFja1wiOiAgICAgXCJhc3NldHMvc291bmQvc2VuX2thX2thdGFuYV9zYXNpbnVrdTAxLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaGl0XCI6ICAgICAgICBcImFzc2V0cy9zb3VuZC9zZW5fa2Ffa2F0YW5hX3Nhc3UwMS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhpdF9ibHVudFwiOiAgXCJhc3NldHMvc291bmQvc2VuX2JsdW50Lm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGFtYWdlXCI6ICAgICBcImFzc2V0cy9zb3VuZC9zZV9tYW91ZGFtYXNoaWlfYmF0dGxlMTIubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcnJvd3N0aWNrXCI6IFwiYXNzZXRzL3NvdW5kL3Nlbl9rYV95YTAzLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2VjbGVhclwiOiBcImFzc2V0cy9zb3VuZC9EUy0wMzBtLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZ2FtZW92ZXJcIjogICBcImFzc2V0cy9zb3VuZC9nYW1lb3ZlcjMubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJnZXRrZXlpdGVtXCI6IFwiYXNzZXRzL3NvdW5kL3NlX21hb3VkYW1hc2hpaV9vbmVwb2ludDIzLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYm9tYlwiOiAgICAgICBcImFzc2V0cy9zb3VuZC9zZW5fZ2VfdGFpaG91MDMubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzZWxlY3RcIjogICAgIFwiYXNzZXRzL3NvdW5kL3NlX21hb3VkYW1hc2hpaV9zeXN0ZW00NS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImdldGl0ZW1cIjogICAgXCJhc3NldHMvc291bmQvYXRhX2E0OS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJlY292ZXJ5XCI6ICAgXCJhc3NldHMvc291bmQvc2VfbWFvdWRhbWFzaGlpX21hZ2ljYWwwMS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpbmtsaW5nXCI6ICAgXCJhc3NldHMvc291bmQvdGlua2xpbmcubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJob2x5MVwiOiAgICAgIFwiYXNzZXRzL3NvdW5kL2hvbHkxLm1wM1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmdtMVwiOiAgICAgICBcImFzc2V0cy9zb3VuZC9EUy1iYTAxbS5tcDNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJVYnVudHVNb25vXCI6IFwiYXNzZXRzL2ZvbnQvVWJ1bnR1TW9uby1Cb2xkLnR0ZlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGl0bGVmb250MVwiOiBcImFzc2V0cy9mb250L3RldXRvbmljNC50dGZcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlZm9udDJcIjogXCJhc3NldHMvZm9udC9Hb3RoU3RlbmNpbF9QcmVtaXVtLnR0ZlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRteDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhZ2UxXCI6IFwiYXNzZXRzL21hcC9zdGFnZTEudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTk5OVwiOiBcImFzc2V0cy9tYXAvc3RhZ2U5OTkudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFnZTJcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiZ20yXCI6IFwiYXNzZXRzL3NvdW5kL0RTLTAzNW0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG14OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTJfMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2UyXzEudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFnZTNcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiZ20zXCI6IFwiYXNzZXRzL3NvdW5kL0RTLTA0MW0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG14OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTNfMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2UzXzEudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTNfMlwiOiBcImFzc2V0cy9tYXAvc3RhZ2UzXzIudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTNfM1wiOiBcImFzc2V0cy9tYXAvc3RhZ2UzXzMudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFnZTRcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiZ200XCI6IFwiYXNzZXRzL3NvdW5kL0RTLTA3Nm0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG14OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTRfMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2U0XzEudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTRfMlwiOiBcImFzc2V0cy9tYXAvc3RhZ2U0XzIudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFnZTVcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiZ201XCI6IFwiYXNzZXRzL3NvdW5kL0RTLTA4OW0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG14OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTVfMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2U1XzEudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTVfMlwiOiBcImFzc2V0cy9tYXAvc3RhZ2U1XzIudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFnZTZcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiZ202XCI6IFwiYXNzZXRzL3NvdW5kL0RTLTA2MG0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG14OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTZfMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2U2XzEudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTZfMlwiOiBcImFzc2V0cy9tYXAvc3RhZ2U2XzIudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFnZTdcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiZ203XCI6IFwiYXNzZXRzL3NvdW5kL0RTLTEwNW0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG14OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTdfMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2U3XzEudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTdfMlwiOiBcImFzc2V0cy9tYXAvc3RhZ2U3XzIudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTdfM1wiOiBcImFzc2V0cy9tYXAvc3RhZ2U3XzMudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFnZThcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiZ204XCI6IFwiYXNzZXRzL3NvdW5kL0RTLTA2NG0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG14OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZThfMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2U4XzEudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZThfMlwiOiBcImFzc2V0cy9tYXAvc3RhZ2U4XzIudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFnZTlcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiZ205XCI6IFwiYXNzZXRzL3NvdW5kL0RTLTA2NG0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG14OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTlfMVwiOiBcImFzc2V0cy9tYXAvc3RhZ2U5XzEudG14XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdGFnZTEwXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VuZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZW5kaW5nXCI6IFwiYXNzZXRzL3NvdW5kL0RTLTA3MW0ubXAzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgdG14OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFnZTEwXCI6IFwiYXNzZXRzL21hcC9zdGFnZTEwLnRteFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBcImludmFsaWQgYXNzZXRUeXBlOiBcIiArIG9wdGlvbnMuYXNzZXRUeXBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgIH0sXG59KTtcblxuIiwiLypcbiAqICBCZW5yaS5qc1xuICogIDIwMTQvMTIvMThcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG4gXG52YXIgdG9SYWQgPSAzLjE0MTU5LzE4MDsgICAgLy/lvKfluqbms5V0b+ODqeOCuOOCouODs+WkieaPm1xudmFyIHRvRGVnID0gMTgwLzMuMTQxNTk7ICAgIC8v44Op44K444Ki44OzdG/lvKfluqbms5XlpInmj5tcblxuLy/ot53pm6LoqIjnrpdcbnZhciBkaXN0YW5jZSA9IGZ1bmN0aW9uKGZyb20sIHRvKSB7XG4gICAgdmFyIHggPSBmcm9tLngtdG8ueDtcbiAgICB2YXIgeSA9IGZyb20ueS10by55O1xuICAgIHJldHVybiBNYXRoLnNxcnQoeCp4K3kqeSk7XG59XG5cbi8v6Led6Zui6KiI566X77yI44Or44O844OI54Sh44GX54mI77yJXG52YXIgZGlzdGFuY2VTcSA9IGZ1bmN0aW9uKGZyb20sIHRvKSB7XG4gICAgdmFyIHggPSBmcm9tLnggLSB0by54O1xuICAgIHZhciB5ID0gZnJvbS55IC0gdG8ueTtcbiAgICByZXR1cm4geCp4K3kqeTtcbn1cblxuLy/mlbDlgKTjga7liLbpmZBcbnZhciBjbGFtcCA9IGZ1bmN0aW9uKHgsIG1pbiwgbWF4KSB7XG4gICAgcmV0dXJuICh4PG1pbik/bWluOigoeD5tYXgpP21heDp4KTtcbn07XG5cbi8v5Lmx5pWw55Sf5oiQXG52YXIgcHJhbmQgPSBwaGluYS51dGlsLlJhbmRvbSgpO1xudmFyIHJhbmQgPSBmdW5jdGlvbihtaW4sIG1heCkge1xuICAgIHJldHVybiBwcmFuZC5yYW5kaW50KG1pbiwgbWF4KTtcbn1cblxuLy/jgr/jgqTjg4jjg6vnhKHjgZfjg4DjgqTjgqLjg63jgrBcbnZhciBBZHZhbmNlQWxlcnQgPSBmdW5jdGlvbihzdHIpIHtcbiAgICB2YXIgdG1wRnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTtcbiAgICB0bXBGcmFtZS5zZXRBdHRyaWJ1dGUoJ3NyYycsICdkYXRhOnRleHQvcGxhaW4sJyk7XG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKHRtcEZyYW1lKTtcblxuICAgIHdpbmRvdy5mcmFtZXNbMF0ud2luZG93LmFsZXJ0KHN0cik7XG4gICAgdG1wRnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0bXBGcmFtZSk7XG59O1xudmFyIEFkdmFuY2VDb25maXJtID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgdmFyIHRtcEZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgdG1wRnJhbWUuc2V0QXR0cmlidXRlKCdzcmMnLCAnZGF0YTp0ZXh0L3BsYWluLCcpO1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0bXBGcmFtZSk7XG5cbiAgICB2YXIgcmVzdWx0ID0gd2luZG93LmZyYW1lc1swXS53aW5kb3cuY29uZmlybShzdHIpO1xuICAgIHRtcEZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodG1wRnJhbWUpO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbi8v5pWw5YCk44KS44Kr44Oz44Oe57eo6ZuG44GX44Gm5paH5a2X5YiX44Go44GX44Gm5Ye65YqbXG5OdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJjb21tYVwiLCAgZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN0ciA9IHRoaXMrJyc7XG4gICAgdmFyIGxlbiA9IHN0ci5sZW5ndGg7XG4gICAgdmFyIG91dCA9ICcnO1xuICAgIGZvciAodmFyIGkgPSBsZW4tMTsgaSA+IC0xOyBpLS0pIHtcbiAgICAgICAgb3V0ID0gc3RyW2ldK291dDtcbiAgICAgICAgaWYgKGkgIT0gMCAmJiAobGVuLWkpJTMgPT0gMCkgb3V0ID0gJywnK291dDtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbn0pO1xuIiwiLypcbiAqICBtYWluLmpzXG4gKiAgMjAxNi8xMi8yOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy9waGluYS5nbG9iYWxpemUoKTtcblxuLy/jg4fjg5Djg4PjgrDjg5Xjg6njgrBcbmNvbnN0IERFQlVHID0gZmFsc2U7XG5jb25zdCBERUJVR19DT0xMSVNJT04gPSBmYWxzZTtcbmNvbnN0IERFQlVHX0VZRVNJR0hUID0gZmFsc2U7XG5jb25zdCBERUJVR19NT0JJTEUgPSBmYWxzZTtcblxuLy/lrprmlbBcbmNvbnN0IFNDX1cgPSA1NzY7XG5jb25zdCBTQ19IID0gMzI0O1xuLy8gU0NfVyA9IDQ4MDtcbi8vIFNDX0ggPSAzMjA7XG5cbmNvbnN0IEZQUyA9IDMwO1xuXG4vL+OCouOCpOODhuODoO+8qe+8pFxuY29uc3QgSVRFTV9TSE9SVFNXT1JEID0gMDtcbmNvbnN0IElURU1fTE9OR1NXT1JEID0gMTtcbmNvbnN0IElURU1fQVggPSAyO1xuY29uc3QgSVRFTV9TUEVBUiA9IDM7XG5jb25zdCBJVEVNX0JPVyA9IDQ7XG5jb25zdCBJVEVNX1JPRCA9IDU7XG5jb25zdCBJVEVNX0JPT0sgPSA2O1xuY29uc3QgSVRFTV9TSElFTEQgPSA3O1xuY29uc3QgSVRFTV9BUk1PUiA9IDg7XG5jb25zdCBJVEVNX0hBVCA9IDk7XG5jb25zdCBJVEVNX0JPT1RTID0gMTA7XG5jb25zdCBJVEVNX0dST1ZFID0gMTE7XG5jb25zdCBJVEVNX1JJTkcgPSAxMjtcbmNvbnN0IElURU1fU0NST0xMID0gMTM7XG5jb25zdCBJVEVNX0xFVFRFUiA9IDE0O1xuY29uc3QgSVRFTV9DQVJEID0gMTU7XG5jb25zdCBJVEVNX0tFWSA9IDE2O1xuY29uc3QgSVRFTV9DT0lOID0gMTc7XG5jb25zdCBJVEVNX0JBRyA9IDE4O1xuY29uc3QgSVRFTV9PUkIgPSAxOTtcbmNvbnN0IElURU1fU1RPTkUgPSAyMDtcbmNvbnN0IElURU1fSkVXRUwgPSAyMTtcbmNvbnN0IElURU1fSkVXRUxCT1ggPSAyMjtcbmNvbnN0IElURU1fQVBQTEUgPSAyNDtcbmNvbnN0IElURU1fSEFSQiA9IDI1O1xuY29uc3QgSVRFTV9NRUFUID0gMjY7XG5jb25zdCBJVEVNX1BPVElPTiA9IDI3O1xuXG4vL+OCpOODs+OCueOCv+ODs+OCuVxubGV0IGFwcDtcblxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJylcbiAgICAgIC50aGVuKCgpID0+IGNvbnNvbGUubG9nKCdTZXJ2aWNlIHdvcmtlciByZWdpc3RlcmVkIScpKTtcbn1cblxud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIGFwcCA9IHFmdC5BcHBsaWNhdGlvbigpO1xuICAgIGFwcC5yZXBsYWNlU2NlbmUocWZ0LlNjZW5lRmxvdygpKTtcblxuICAgIC8v44Oi44OQ44Kk44Or5a++5b+cXG4gICAgaWYgKHBoaW5hLmlzTW9iaWxlKCkpIHtcbiAgICAgICAgYXBwLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBmdW5jdGlvbiBkdW1teSgpIHtcbiAgICAgICAgICAgIHZhciBzID0gcGhpbmEuYXNzZXQuU291bmQoKTtcbiAgICAgICAgICAgIHMubG9hZEZyb21CdWZmZXIoKTtcbiAgICAgICAgICAgIHMucGxheSgpLnN0b3AoKTtcbiAgICAgICAgICAgIGFwcC5kb21FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgZHVtbXkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXBwLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiBkdW1teSgpIHtcbiAgICAgICAgdmFyIGNvbnRleHQgPSBwaGluYS5hc3NldC5Tb3VuZC5nZXRBdWRpb0NvbnRleHQoKTtcbiAgICAgICAgY29udGV4dC5yZXN1bWUoKTtcbiAgICB9KTtcblxuICAgIGFwcC5ydW4oKTtcbi8vICAgIGFwcC5lbmFibGVTdGF0cygpO1xufTtcbiIsIi8qXG4gKiAgY29uZmlnc2NlbmUuanNcbiAqICAyMDE3LzAzLzAyXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuIFxucGhpbmEuZGVmaW5lKFwicWZ0LkNvbmZpZ1NjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC41KVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMC41KVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5iZy5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5jbGVhcigpLmZhZGVJbig1MDApO1xuXG4gICAgICAgIHRoaXMuc2Nyb2xsID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtZW51ZnJhbWVcIilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KVxuICAgICAgICAgICAgLnNldFNjYWxlKDAuODUsIDEuMSk7XG4gICAgICAgIHRoaXMuc2Nyb2xsLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy5zY3JvbGwudHdlZW5lci5jbGVhcigpLmZhZGVJbig1MDApO1xuXG4gICAgICAgIHRoaXMubWVudUJhc2UgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyh0aGlzLnNjcm9sbCk7XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiA1LFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcInRpdGxlZm9udDFcIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogNzAsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGV4dExhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJNZW51XCIsIGZvbnRTaXplOiAyMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKDAsIC1TQ19IKjAuMyk7XG5cbiAgICAgICAgLy/jg6Hjg4vjg6Xjg7zjg4bjgq3jgrnjg4jooajnpLpcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLm1lbnUgPSBbXCJTeXN0ZW1cIiwgXCJQcmFjdGljZVwiLCBcIkV4aXRcIl07XG4gICAgICAgIHRoaXMubWVudVRleHQgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1lbnUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbaV0gPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiB0aGlzLm1lbnVbaV0sIGZvbnRTaXplOiA0MH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oMCwgLVNDX0gqMC4xNStTQ19IKjAuMTUqaSlcbiAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMC43KTtcblxuICAgICAgICAgICAgLy/jgr/jg4Pjg4HliKTlrprnlKhcbiAgICAgICAgICAgIHZhciBwYXJhbTIgPSB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IFNDX1cqMC4zLFxuICAgICAgICAgICAgICAgIGhlaWdodDogU0NfSCowLjEwLFxuICAgICAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBjID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbTIpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oMCwgLVNDX0gqMC4xNStTQ19IKjAuMTUqaSlcbiAgICAgICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgICAgICBjLmFscGhhID0gMDtcbiAgICAgICAgICAgIGMuc2VsZWN0ID0gaTtcbiAgICAgICAgICAgIGMub25wb2ludHN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuaXNTZWxlY3RlZCB8fCB0aGF0LnRpbWUgPCAxMCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdCA9PSB0aGF0LnNlbGVjdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm1lbnVUZXh0W3RoYXQuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnNlbGVjdCA9IHRoaXMuc2VsZWN0O1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm1lbnVUZXh0W3RoYXQuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZWxlY3QgPSAwO1xuICAgICAgICB0aGlzLnNlbGVjdE1heCA9IDM7XG4gICAgICAgIHRoaXMubWVudVRleHRbMF0uc2V0U2NhbGUoMSk7XG4gICAgICAgIHRoaXMub2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jYW5zZWwgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIHRoaXMub24oJ3Jlc3VtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5tZW51QmFzZS50d2VlbmVyLmNsZWFyKCkuZmFkZUluKDUwMCk7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5pc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm9rID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmNhbnNlbCA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmIChjdC5kb3duICYmICFjdC5iZWZvcmUuZG93biAmJiB0aGlzLnNlbGVjdCA8IHRoaXMuc2VsZWN0TWF4LTEpIHtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdCsrO1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDEwO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3QudXAgJiYgIWN0LmJlZm9yZS51cCAmJiB0aGlzLnNlbGVjdCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdC0tO1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDEwO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnRpbWUgPiAxNSkge1xuICAgICAgICAgICAgLy/msbrlrppcbiAgICAgICAgICAgIGlmIChjdC5vayB8fCB0aGlzLm9rKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcIm9rXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbnVCYXNlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuQ29uZmlnU2NlbmVfUHJhY3RpY2UoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ID09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImNhbmNlbFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGl0TWVudSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+OCreODo+ODs+OCu+ODqyAgICAgICAgXG4gICAgICAgICAgICBpZiAoY3QuY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImNhbmNlbFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmV4aXRNZW51KCk7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgZXhpdE1lbnU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuY2xlYXIoKS5mYWRlT3V0KDUwMCk7XG4gICAgICAgIHRoaXMuc2Nyb2xsLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmZhZGVPdXQoNTAwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cbn0pO1xuIiwiLypcbiAqICBjb252ZXJzYXRpb25zY2VuZS5qc1xuICogIDIwMTcvMDgvMTdcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v5Lya6Kmx6KGo56S644K344O844OzIFxucGhpbmEuZGVmaW5lKFwicWZ0LkNvbnZlcnNhdGlvblNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihjdXJyZW50U2NlbmUsIHRleHQpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUgPSBjdXJyZW50U2NlbmU7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjga7nlLvpnaLkuIrkvY3nva7jgavjgojjgorjg5Xjg6zjg7zjg6Djga7nuKbkvY3nva7jgpLlpInmm7RcbiAgICAgICAgdmFyIGZyYW1lWSA9IFNDX0ggKiAwLjI1O1xuICAgICAgICB2YXIgcGwgPSB0aGlzLmN1cnJlbnRTY2VuZS5wbGF5ZXI7XG5cbiAgICAgICAgLy/kvJroqbHooajnpLrjg5Xjg6zjg7zjg6BcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyAqIDAuOTUsXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCAqIDAuNCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLCAwLCAwLCAwLjUpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgxLCAxLCAxLCAwLjUpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XICogMC41LCBmcmFtZVkpXG5cbiAgICAgICAgLy/jg4bjgq3jgrnjg4jlh6bnkIZcbiAgICAgICAgaWYgKHRleHQgPT09IHVuZGVmaW5lZCkgdGV4dCA9IFwiVEVTVCBNRVNTQUdFXCI7XG4gICAgICAgIGlmICh0ZXh0IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiXCI7XG4gICAgICAgICAgICB0ZXh0LmZvckVhY2goKHQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHQgKz0gKHQgKyBcIlxcblwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogNSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDcwLFxuXG4gICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAndG9wJyxcbiAgICAgICAgICAgIGFsaWduOidzdGFydCcsXG4gICAgICAgICAgICBiYXNlbGluZTondG9wJyxcbiAgICAgICAgICAgIHdpZHRoOiBTQ19XICogMC45LFxuICAgICAgICAgICAgaGVpZ2h0OiBTQ19IICogMC4zLFxuICAgICAgICAgICAgc2Nyb2xsWDogMCxcbiAgICAgICAgICAgIHNjcm9sbFk6IDAsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGV4dExhYmVsID0gcGhpbmEudWkuTGFiZWxBcmVhKHt0ZXh0OiBcIlwiLCBmb250U2l6ZTogMjB9LiRzYWZlKGxhYmVsUGFyYW0pKS5hZGRDaGlsZFRvKHRoaXMuYmcpO1xuXG4gICAgICAgIHRoaXMuaXNFeGl0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNGaW5pc2ggPSBmYWxzZTtcbiAgICAgICAgdGhpcy53YWl0VGltZSA9IDA7XG4gICAgICAgIHRoaXMuY29sID0gMDtcbiAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMud2FpdFRpbWUgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy50ZXh0TGFiZWwudGV4dCA9IHRoaXMudGV4dC5zdWJzdHJpbmcoMCwgdGhpcy5jb2wpO1xuICAgICAgICAgICAgaWYgKHRoaXMudGV4dC5zdWJzdHJpbmcodGhpcy5jb2wsIHRoaXMuY29sKzEpID09IFwiXFxuXCIpIHRoaXMud2FpdFRpbWUgPSAxMDtcbiAgICAgICAgICAgIHRoaXMuY29sKys7XG4gICAgICAgICAgICBpZiAodGhpcy5jb2wgPiB0aGlzLnRleHQubGVuZ3RoKSB0aGlzLmlzRmluaXNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy53YWl0VGltZSA+IDApIHRoaXMud2FpdFRpbWUtLTtcblxuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKHRoaXMuaXNGaW5pc2gpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0V4aXQgJiYgdGhpcy50aW1lID4gMTAgJiYgY3QuYmVmb3JlLmF0dGFjayAmJiAhY3QuYXR0YWNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0V4aXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC53YWl0KDEwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAucG9wU2NlbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoY3QuYXR0YWNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2wgPSB0aGlzLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNGaW5pc2ggPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcbn0pO1xuXG4iLCIvKlxuICogIGNyZWRpdHNjZW5lLmpzXG4gKiAgMjAxNy8xMi8yNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5DcmVkaXRTY2VuZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuICAgIFxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUgPSBwYXJlbnRTY2VuZTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLnRvKHthbHBoYTogMC41fSwgMTAwMCk7XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmx1ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMjYsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIkNvbmdyYXR1cmF0aW9ucyEhXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjIpO1xuXG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiVGhhbmsgeW91IGZvciBwbGF5aW5nLlwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC40KTtcblxuICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlRoaXMgZ2FtZSBpcyBhIHRlc3QgdmVyc2lvbi5cIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG5cbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJQdXNoIGJ1dHRvbiB0byB0aXRsZS5cIiwgZm9udFNpemU6IDIwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC44KTtcblxuICAgICAgICBhcHAucGxheUJHTShcImdhbWVvdmVyXCIsIGZhbHNlKTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDEyMCkge1xuICAgICAgICAgICAgaWYgKGN0Lm9rIHx8IGN0LmNhbmNlbCkge1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5QkdNKFwib3BlbmluZ2JnbVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmZsYXJlKCdleGl0Z2FtZScpO1xuICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5kaW5nY2VuZS5qc1xuICogIDIwMTcvMDIvMDdcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuRW5kaW5nU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcbiAgICBcbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5iZy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC50byh7YWxwaGE6IDAuNX0sIDEwMDApO1xuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsdWVcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDI2LFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJUaGFuayB5b3UgZm9yIHBsYXlpbmcuXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjQpO1xuXG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiVGhpcyBnYW1lIGlzIG92ZXJcIn0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG5cbiAgICAgICAgcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJQdXNoIGJ1dHRvbiB0byB0aXRsZS5cIiwgZm9udFNpemU6IDIwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC44KTtcblxuICAgICAgICBhcHAucGxheUJHTShcImdhbWVvdmVyXCIsIGZhbHNlKTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDEyMCkge1xuICAgICAgICAgICAgaWYgKGN0Lm9rIHx8IGN0LmNhbmNlbCkge1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5QkdNKFwib3BlbmluZ2JnbVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmZsYXJlKCdleGl0Z2FtZScpO1xuICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5kaW5nY2VuZS50cnVlZW5kaW5nLmpzXG4gKiAgMjAxNy8wNS8wMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbi8v44OI44Kl44Or44O844Ko44Oz44OH44Kj44Oz44KwXG5waGluYS5kZWZpbmUoXCJxZnQuRW5kaW5nU2NlbmUuVHJ1ZUVuZGluZ1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuICAgIFxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUgPSBwYXJlbnRTY2VuZTtcblxuICAgICAgICB0aGlzLnRleHQgPSBbXG4gICAgICAgICAgICBcIuaVsOWkmuOBruiLpumbo+OCkuS5l+OCiui2iuOBiFwiLFxuICAgICAgICAgICAgXCLjgYLjgarjgZ/jga/pgYLjgavmpb3lnJLjgIzmsLjpgaDjga7pg73jgI3jgbjjga7lhaXjgorlj6PjgbjjgajliLDpgZTjgZfjgZ9cIixcbiAgICAgICAgICAgIFwi5omJ44Gu5ZCR44GT44GG44Gr44Gv6ZqO5q6144GM44GC44KKXCIsXG4gICAgICAgICAgICBcIuOBneOBrumajuauteOBr+mBpeOBi+WkqeS4iuOBuOOBqOe2muOBhOOBpuOBhOOCi1wiLFxuICAgICAgICAgICAgXCLpmo7mrrXjgpLmmIfjgorjgb7jgZnjgYvvvJ9cIixcbiAgICAgICAgXTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLnRvKHthbHBoYTogMC41fSwgMTAwMCk7XG5cbiAgICAgICAgLy/jgqTjg6Hjg7zjgrjooajnpLrnlKjjg6zjgqTjg6RcbiAgICAgICAgdGhpcy5pbWFnZUxheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcyk7XG5cbiAgICAgICAgLy/kuIrkuIvpu5LluK9cbiAgICAgICAgcGFyYW0uaGVpZ2h0ID0gU0NfSCAqIDAuMTU7XG4gICAgICAgIHRoaXMuYmFyMSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pLmFkZENoaWxkVG8odGhpcykuc2V0T3JpZ2luKDAsIDEpLnNldFBvc2l0aW9uKDAsIC0xKTtcbiAgICAgICAgdGhpcy5iYXIyID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRPcmlnaW4oMCwgMCkuc2V0UG9zaXRpb24oMCwgU0NfSCArIDEpO1xuICAgICAgICB0aGlzLmJhcjEudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLm1vdmVCeSgwLCBTQ19IICogMC4xNSwgMzAsIFwiZWFzZU91dFNpbmVcIik7XG4gICAgICAgIHRoaXMuYmFyMi50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJykubW92ZUJ5KDAsIC1TQ19IICogMC4xNSwgMzAsIFwiZWFzZU91dFNpbmVcIik7XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDtcblxuICAgICAgICB0aGlzLm9uZSgnZW50ZXJmcmFtZScsICgpID0+IHtcbiAgICAgICAgICAgIC8v77yi77yn77yt5YaN55SfXG4gICAgICAgICAgICBhcHAucGxheUJHTShcImVuZGluZ2JnbVwiKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAodGhpcy50aW1lID4gMTIwKSB7XG4gICAgICAgICAgICBpZiAoY3Qub2sgfHwgY3QuY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlCR00oXCJvcGVuaW5nYmdtXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoJ2V4aXRnYW1lJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBHYW1lT3ZlclNjZW5lLmpzXG4gKiAgMjAxNC8wNi8wNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5HYW1lT3ZlclNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG4gICAgXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuXG4gICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciBwYXJhbSA9IHtcbiAgICAgICAgICAgIHdpZHRoOiBTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OiBTQ19ILFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMCwwLDEpXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpXG4gICAgICAgIHRoaXMuYmcuYWxwaGEgPSAwO1xuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsdWVcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDMyLFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHggPSBTQ19XICogMC41LTMyKjQ7XG4gICAgICAgIHZhciBuID0gMDtcbiAgICAgICAgW1wiR1wiLCBcIkFcIiwgXCJNXCIsIFwiRVwiLCBcIk9cIiwgXCJWXCIsIFwiRVwiLCBcIlJcIl0uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgbGIgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBlfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oeCwgU0NfSCowLjUrMzIpXG4gICAgICAgICAgICAgICAgLnNldFNjYWxlKDAsIDEpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgICAgICBsYi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAgICAgLndhaXQobio1MClcbiAgICAgICAgICAgICAgICAudG8oe3NjYWxlWDogMS4wLCBhbHBoYTogMSwgeTogU0NfSCowLjV9LCAxMDAwLCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLndhaXQoMTAwMC1uKjUwKVxuICAgICAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgICAgICAudG8oe3NjYWxlWDogMC4wLCBhbHBoYTogMCwgeTogU0NfSCowLjUtMzJ9LCAxMDAwLCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICB2YXIgcHQgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInBhcnRpY2xlXCIsIDE2LCAxNilcbiAgICAgICAgICAgICAgICAuc2V0RnJhbWVJbmRleCg0OClcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oeCwgU0NfSCowLjUpXG4gICAgICAgICAgICAgICAgLnNldFNjYWxlKDMsIDMpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgICAgICBwdC5hbHBoYSA9IDA7XG4gICAgICAgICAgICBwdC50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAud2FpdChuKjUwKzEwMDApXG4gICAgICAgICAgICAgICAgLnRvKHthbHBoYTogMX0sIDEwMDAtbio1MCwgXCJlYXNlT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC50byh7c2NhbGVYOiAwLjAsIGFscGhhOiAwLCB5OiBTQ19IKjAuNS0zMn0sIDEwMDAsIFwiZWFzZU91dFNpbmVcIilcbiAgICAgICAgICAgIHggKz0gMzI7XG4gICAgICAgICAgICBuKys7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgYXBwLnBsYXlCR00oXCJnYW1lb3ZlclwiLCBmYWxzZSk7XG5cbiAgICAgICAgdGhpcy5zZWxlY3QgPSAwOyAvLzA6WUVTIDE6Tk9cbiAgICAgICAgdGhpcy5wdXNoeWVzID0gZmFsc2U7XG4gICAgICAgIHRoaXMucHVzaG5vID0gZmFsc2U7XG4gICAgICAgIHRoaXMub2sgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKHRoaXMudGltZSA9PSA5MCkge1xuICAgICAgICAgICAgdGhpcy5kaXNwQ29udGludWUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50aW1lID4gMTA1KSB7XG4gICAgICAgICAgICBpZiAoKGN0LmxlZnQgfHwgdGhpcy5wdXNoeWVzKSAmJiB0aGlzLnNlbGVjdCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3QgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMucHVzaHllcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMueWVzLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLCBzY2FsZVk6IDF9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHQzLnRleHQgPSBcIuOCsuODvOODoOOCquODvOODkOODvOWcsOeCueOBi+OCieOCs+ODs+ODhuOCo+ODi+ODpeODvOOBl+OBvuOBme+8iOOCueOCs+OCouOBr+ODquOCu+ODg+ODiOOBleOCjOOBvuOBme+8iVwiO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgoY3QucmlnaHQgfHwgdGhpcy5wdXNobm8pICYmIHRoaXMuc2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdCA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5wdXNobm8gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnllcy50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubm8udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEsIHNjYWxlWTogMX0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0My50ZXh0ID0gXCLjgr/jgqTjg4jjg6vjgavmiLvjgorjgb7jgZlcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdC5vayB8fCBjdC5jYW5jZWwgfHwgdGhpcy5vaykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoJ2NvbnRpbnVlJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoJ2V4aXRnYW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgZGlzcENvbnRpbnVlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDM2LFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50ZXh0MSA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiQ09OVElOVUU/XCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNCsxMClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnRleHQxLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy50ZXh0MS50d2VlbmVyLmNsZWFyKCkudG8oe3k6IFNDX0gqMC40LCBhbHBoYTogMX0sIDUwMCwgXCJlYXNlSW5TaW5lXCIpO1xuXG4gICAgICAgIHRoaXMueWVzID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJZRVNcIiwgZm9udFNpemU6IDMwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5zZXRTY2FsZSgxKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC40LCBTQ19IKjAuNisxMClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnllcy5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMueWVzLnR3ZWVuZXIuY2xlYXIoKS50byh7eTogU0NfSCowLjYsIGFscGhhOiAxfSwgNTAwLCBcImVhc2VJblNpbmVcIik7XG5cbiAgICAgICAgdGhpcy5ubyA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiTk9cIiwgZm9udFNpemU6IDMwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjcpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjYsIFNDX0gqMC42KzEwKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMubm8uYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLm5vLnR3ZWVuZXIuY2xlYXIoKS50byh7eTogU0NfSCowLjYsIGFscGhhOiAxfSwgNTAwLCBcImVhc2VJblNpbmVcIik7XG5cbiAgICAgICAgLy/jgr/jg4Pjg4HliKTlrprnlKhcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgcGFyYW0yID0ge1xuICAgICAgICAgICAgd2lkdGg6IDgwLFxuICAgICAgICAgICAgaGVpZ2h0OiBTQ19IKjAuMDgsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHZhciB5ZXMgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtMilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjQsIFNDX0gqMC42KVxuICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICB5ZXMuYWxwaGEgPSAwO1xuICAgICAgICB5ZXMub25wb2ludHN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhhdC5zZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoYXQub2sgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGF0LnB1c2h5ZXMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBubyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0yKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNiwgU0NfSCowLjYpXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgIG5vLmFscGhhID0gMDtcbiAgICAgICAgbm8ub25wb2ludHN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhhdC5zZWxlY3QgPT0gMSkge1xuICAgICAgICAgICAgICAgIHRoYXQub2sgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGF0LnB1c2hubyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRleHQzID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCLjgrLjg7zjg6Djgqrjg7zjg5Djg7zlnLDngrnjgYvjgonjgrPjg7Pjg4bjgqPjg4vjg6Xjg7zjgZfjgb7jgZnvvIjjgrnjgrPjgqLjga/jg6rjgrvjg4Pjg4jjgZXjgozjgb7jgZnvvIlcIiwgZm9udFNpemU6IDEwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjc1KzEwKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMudGV4dDMuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLnRleHQzLnR3ZWVuZXIuY2xlYXIoKS50byh7eTogU0NfSCowLjc1LCBhbHBoYTogMX0sIDUwMCwgXCJlYXNlSW5TaW5lXCIpO1xuXG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5jbGVhcigpLnRvKHthbHBoYTowLjN9LCA1MDAsIFwiZWFzZUluU2luZVwiKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIExvYWRpbmdTY2VuZS5qc1xuICogIDIwMTUvMDkvMDhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Ki44K744OD44OI44Ot44O844OJ55So44K344O844OzXG5waGluYS5kZWZpbmUoXCJxZnQuTG9hZGluZ1NjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUoe1xuICAgICAgICAgICAgYXNzZXRzOiBudWxsLFxuICAgICAgICAgICAgd2lkdGg6IFNDX1csXG4gICAgICAgICAgICBoZWlnaHQ6IFNDX0gsXG4gICAgICAgICAgICBsaWU6IGZhbHNlLFxuICAgICAgICAgICAgZXhpdFR5cGU6IFwiYXV0b1wiLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogJ2JsYWNrJyxcbiAgICAgICAgICAgIHN0cm9rZTogZmFsc2UsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpXG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcblxuICAgICAgICAvL+ODreODvOODieOBmeOCi+eJqeOBjOeEoeOBhOWgtOWQiOOCueOCreODg+ODl1xuICAgICAgICB0aGlzLmZvcmNlRXhpdCA9IGZhbHNlO1xuICAgICAgICB2YXIgYXNzZXRzID0gb3B0aW9ucy5hc3NldHM7XG4gICAgICAgIGlmICghYXNzZXRzLiRoYXMoXCJzb3VuZFwiKSAmJlxuICAgICAgICAgICAgIWFzc2V0cy4kaGFzKFwiaW1hZ2VcIikgJiZcbiAgICAgICAgICAgICFhc3NldHMuJGhhcyhcImZvbnRcIikgJiZcbiAgICAgICAgICAgICFhc3NldHMuJGhhcyhcInNwcml0ZXNoZWV0XCIpICYmXG4gICAgICAgICAgICAhYXNzZXRzLiRoYXMoXCJzY3JpcHRcIikgJiZcbiAgICAgICAgICAgICFhc3NldHMuJGhhcyhcInRteFwiKSkge1xuXG4gICAgICAgICAgICB0aGlzLmZvcmNlRXhpdCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIHRleHQ6IFwiTG9hZGluZ1wiLFxuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsdWVcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDMwXG4gICAgICAgIH07XG4gICAgICAgIHBoaW5hLmRpc3BsYXkuTGFiZWwobGFiZWxQYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcblxuICAgICAgICB0aGlzLmZyb21KU09OKHtcbiAgICAgICAgICAgIGNoaWxkcmVuOiB7XG4gICAgICAgICAgICAgICAgZ2F1Z2U6IHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAncGhpbmEudWkuR2F1Z2UnLFxuICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgqMC41LFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICdibGFjaycsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ2F1Z2VDb2xvcjogJ2JsdWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy5ncmlkWC5jZW50ZXIoKSxcbiAgICAgICAgICAgICAgICAgICAgeTogU0NfSCowLjUrMjAsXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpblk6IDAsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5nYXVnZS51cGRhdGUgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLmdhdWdlQ29sb3IgPSAnaHNsYSh7MH0sIDEwMCUsIDUwJSwgMC44KScuZm9ybWF0KGUudGlja2VyLmZyYW1lKjMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxvYWRlciA9IHBoaW5hLmFzc2V0LkFzc2V0TG9hZGVyKCk7XG4gICAgICAgIGlmIChvcHRpb25zLmxpZSkge1xuICAgICAgICAgICAgdGhpcy5nYXVnZS5hbmltYXRpb25UaW1lID0gMTAqMTAwMDtcbiAgICAgICAgICAgIHRoaXMuZ2F1Z2UudmFsdWUgPSA5MDtcbiAgICAgICAgICAgIGxvYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdhdWdlLmFuaW1hdGlvblRpbWUgPSAxKjEwMDA7XG4gICAgICAgICAgICAgICAgdGhpcy5nYXVnZS52YWx1ZSA9IDEwMDtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvYWRlci5vbnByb2dyZXNzID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2F1Z2UudmFsdWUgPSBlLnByb2dyZXNzKjEwMDtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdhdWdlLm9uZnVsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZXhpdFR5cGUgPT09ICdhdXRvJykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFwcC5fb25Mb2FkQXNzZXRzKSB0aGlzLmFwcC5fb25Mb2FkQXNzZXRzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICBsb2FkZXIubG9hZChvcHRpb25zLmFzc2V0cyk7XG4gICAgfSxcbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5mb3JjZUV4aXQpIHRoaXMuZXhpdCgpO1xuICAgIH0sICAgIFxufSk7XG4iLCIvKlxuICogIE1haW5TY2VuZS5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5NYWluU2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIC8v54++5Zyo44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDEsXG5cbiAgICAvL+acgOWkp+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyTWF4OiA4LFxuXG4gICAgLy/mrovjgormmYLplpPvvIjjg5Xjg6zjg7zjg6DljZjkvY3vvIlcbiAgICB0aW1lTGltaXQ6IDEyMCxcblxuICAgIC8v44Oh44OD44K744O844K444K544K/44OD44KvXG4gICAgbWVzc2FnZVN0YWNrOiBbXSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki44OV44Op44KwXG4gICAgaXNTdGFnZUNsZWFyOiBmYWxzZSxcblxuICAgIC8v44Ko44Oz44OH44Kj44Oz44Kw6YCy6KGM5Lit44OV44Op44KwXG4gICAgaXNFbmRpbmc6IGZhbHNlLFxuXG4gICAgLy/nnJ/jgqjjg7Pjg4fjgqPjg7PjgrDjg5Xjg6njgrBcbiAgICBpc1RydWVFbmRpbmc6IHRydWUsXG5cbiAgICAvL+OCueOCs+OColxuICAgIHRvdGFsU2NvcmU6IDAsXG5cbiAgICAvL+aVteiojuS8kOaVsFxuICAgIHRvdGFsS2lsbDogMCxcblxuICAgIC8v44Kz44Oz44OG44Kj44OL44Ol44O85Zue5pWwXG4gICAgY29udGludWVDb3VudDogMCxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5pmC5oOF5aCxXG4gICAgY2xlYXJSZXN1bHQ6IFtdLFxuXG4gICAgLy/jgrnjgq/jg6rjg7zjg7Pjga7jg57jg4Pjg5flpJbjgbjjga7np7vli5XliLbpmZDjg5Xjg6njgrBcbiAgICBsaW1pdFdpZHRoOiBmYWxzZSxcbiAgICBsaW1pdEhlaWdodDogdHJ1ZSxcblxuICAgIC8v44K544Kv44Oq44O844Oz5Lit5b+D5bqn5qiZXG4gICAgc2NyZWVuQ2VudGVyUG9zaXRpb246IG51bGwsXG5cbiAgICAvL+ODl+ODrOOCpOODpOODvOOCueOCr+ODquODvOODs+S4reWkruWbuuWumuODleODqeOCsFxuICAgIGNlbnRlclBsYXllcjogdHJ1ZSxcblxuICAgIC8v44K344O844Oz5YaF5YWo44Kq44OW44K444Kn44Kv44OI5by35Yi25YGc5q2iXG4gICAgcGF1c2VTY2VuZTogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUoe1xuICAgICAgICAgICAgc3RhcnRTdGFnZTogMSxcbiAgICAgICAgICAgIGlzUHJhY3RpY2U6IGZhbHNlLFxuICAgICAgICAgICAgaXNDb250aW51ZTogZmFsc2UsXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc3RhZ2VOdW1iZXIgPSBvcHRpb25zLnN0YXJ0U3RhZ2UgfHwgMTtcbiAgICAgICAgdGhpcy5pc1ByYWN0aWNlID0gb3B0aW9ucy5pc1ByYWN0aWNlO1xuICAgICAgICB0aGlzLmlzQ29udGludWUgPSBvcHRpb25zLmlzQ29udGludWU7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogJ2JsYWNrJyxcbiAgICAgICAgICAgIHN0cm9rZTogZmFsc2UsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG5cbiAgICAgICAgLy/og4zmma9cbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJhY2tncm91bmRcIilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKDAsIFNDX0gqMC41KVxuICAgICAgICAgICAgLnNldE9yaWdpbigwLCAwLjUpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMS4wLCAxLjEpO1xuXG4gICAgICAgIC8v566h55CG55So5Z+65rqW44Os44Kk44OkXG4gICAgICAgIHRoaXMuYmFzZUxheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcyk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgq3jg6Pjg6njgq/jgr9cbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBxZnQuUGxheWVyKHRoaXMpO1xuXG4gICAgICAgIC8v44K544Kv44Oq44O844Oz5Yid5pyf5YyWXG4gICAgICAgIHRoaXMuc2V0dXBTY3JlZW4oKTtcblxuICAgICAgICAvL+OCueOCr+ODquODvOODs+S4reW/g+W6p+aomeeuoeeQhueUqFxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMuY2FtZXJhID0gcGhpbmEuYXBwLk9iamVjdDJEKCkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5jYW1lcmEucGFyZW50U2NlbmUgPSB0aGlzO1xuICAgICAgICB0aGlzLmNhbWVyYS50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICB0aGlzLmNhbWVyYS5tb3ZlRnJvbSA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcbiAgICAgICAgdGhpcy5jYW1lcmEubW92ZVRvID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuICAgICAgICB0aGlzLmNhbWVyYS5tb3ZlUmF0aW8gPSAwO1xuICAgICAgICB0aGlzLmNhbWVyYS5tb3ZlTGVycCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNhbWVyYS5tb3ZlVG9QbGF5ZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jYW1lcmEudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhhdC5jZW50ZXJQbGF5ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnggPSB0aGF0LnBsYXllci54O1xuICAgICAgICAgICAgICAgIHRoaXMueSA9IHRoYXQucGxheWVyLnk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vdmVMZXJwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vdmVUb1BsYXllcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlVG8ueCA9IHRoYXQucGxheWVyLng7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVUby55ID0gdGhhdC5wbGF5ZXIueTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHBoaW5hLmdlb20uVmVjdG9yMi5sZXJwKHRoaXMubW92ZUZyb20sIHRoaXMubW92ZVRvLCB0aGlzLm1vdmVSYXRpbyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24ocC54LCBwLnkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouaZguaDheWgsVxuICAgICAgICB0aGlzLmNsZWFyUmVzdWx0ID0gW107XG4gICAgICAgIHRoaXMudG90YWxTY29yZSA9IDA7XG4gICAgICAgIHRoaXMudG90YWxLaWxsID0gMDtcblxuICAgICAgICAvL+OCs+ODs+ODhuOCo+ODi+ODpeODvOaZgueKtuaFi+ODreODvOODiVxuICAgICAgICBpZiAodGhpcy5pc0NvbnRpbnVlKSB0aGlzLmxvYWRHYW1lKCk7XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vkvY3nva5cbiAgICAgICAgdGhpcy5tYXBzdGFydCA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcblxuICAgICAgICAvL+OCueODhuODvOOCuOaDheWgseWIneacn+WMllxuICAgICAgICB0aGlzLnNldHVwU3RhZ2UoKTtcblxuICAgICAgICB0aGlzLmZnV2hpdGUgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtLiRleHRlbmQoe2ZpbGw6ICd3aGl0ZSd9KSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5mZ1doaXRlLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy5mZ1doaXRlLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKTtcblxuICAgICAgICB0aGlzLmZnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KTtcbiAgICAgICAgdGhpcy5mZy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKCkuZmFkZU91dCgzMCk7XG5cbiAgICAgICAgLy/jg5Djg7zjg4Hjg6Pjg6vjg5Hjg4Pjg4njga7lj6/oppbljJZcbiAgICAgICAgaWYgKHBoaW5hLmlzTW9iaWxlKCkgfHwgREVCVUdfTU9CSUxFKSB7XG4gICAgICAgICAgICBhcHAudmlydHVhbFBhZC5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICB9XG5cbiAgICAgICAgYXBwLnZvbHVtZUJHTSA9IDAuNTtcbiAgICAgICAgYXBwLnZvbHVtZVNFID0gMC4yO1xuXG4gICAgICAgIC8v44Oh44OL44Ol44O844KS6ZaL44GPXG4gICAgICAgIHRoaXMub24oJ29wZW5tZW51JywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuTWVudVNjZW5lKHRoaXMpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jgq3jg7zlj5blvpdcbiAgICAgICAgdGhpcy5vbignZ2V0a2V5JywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyIHggPSB0aGlzLm1hcExheWVyLnggKyB0aGlzLnBsYXllci54O1xuICAgICAgICAgICAgdmFyIHkgPSB0aGlzLm1hcExheWVyLnkgKyB0aGlzLnBsYXllci55O1xuICAgICAgICAgICAgdmFyIGtleSA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbih4LCB5KVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMuYmFzZUxheWVyKTtcbiAgICAgICAgICAgIGtleS50d2VlbmVyLmNsZWFyKCkubW92ZVRvKDE1Kyh0aGlzLnBsYXllci5rZXlzLmxlbmd0aC0xKSoyNCwgMzYsIDUwMCk7XG4gICAgICAgICAgICB2YXIgc3AgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIml0ZW1cIiwgMjQsIDI0KVxuICAgICAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KElURU1fS0VZKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKGtleSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v44K544OG44O844K444Kv44Oq44KiXG4gICAgICAgIHRoaXMub24oJ3N0YWdlY2xlYXInLCB0aGlzLnN0YWdlQ2xlYXIpO1xuXG4gICAgICAgIC8v5qyh44K544OG44O844K444G456e76KGMXG4gICAgICAgIHRoaXMub24oJ25leHRzdGFnZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5hbGxDbGVhcikge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VOdW1iZXIrKztcbiAgICAgICAgICAgICAgICB0aGlzLnNldHVwU3RhZ2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5zYXZlU3RhdHVzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v44Ko44Oz44OH44Kj44Oz44Kw5YiG5bKQXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNUcnVlRW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VOdW1iZXIgPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR1cFN0YWdlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy/ku67jgqjjg7Pjg4fjgqPjg7PjgrBcbiAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuRW5kaW5nU2NlbmUodGhpcykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jgqjjg7Pjg4fjgqPjg7PjgrDjgbjnp7vooYxcbiAgICAgICAgdGhpcy5vbignZW5kaW5nJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuRW5kaW5nU2NlbmUodGhpcykpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+OCsuODvOODoOOCquODvOODkOODvFxuICAgICAgICB0aGlzLm9uKCdnYW1lb3ZlcicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0LkdhbWVPdmVyU2NlbmUodGhpcykpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+OCs+ODs+ODhuOCo+ODi+ODpeODvFxuICAgICAgICB0aGlzLm9uKCdjb250aW51ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRoaXMucmVzdGFydCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+OCsuODvOODoOe1guS6hlxuICAgICAgICB0aGlzLl9leGl0R2FtZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9uKCdleGl0Z2FtZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2V4aXRHYW1lID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1ByYWN0aWNlKSB0aGlzLnNhdmVHYW1lKCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm9uKCdleGl0Z2FtZV9ub3NhdmUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLl9leGl0R2FtZSA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v44Oh44OD44K744O844K46KGo56S6XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiAxNixcbiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5tZXNzYWdlU3RhY2sgPSBbXTtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZS50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlLm5leHRPayA9IHRydWU7XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMubmV4dE9rICYmIHRoYXQubWVzc2FnZVN0YWNrLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5leHRPayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBtc2cgPSB0aGF0Lm1lc3NhZ2VTdGFja1swXTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0ID0gbXNnLnRleHQ7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVJbigxNSkud2FpdCg5MCkuZmFkZU91dCgxNSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQubWVzc2FnZVN0YWNrLnNwbGljZSgwLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgaWYgKHRoaXMudGltZSA9PSAxNSkgdGhpcy5wbGF5ZXIuaXNDb250cm9sID0gdHJ1ZTtcblxuICAgICAgICAvL+OCsuODvOODoOe1guS6hlxuICAgICAgICBpZiAodGhpcy5fZXhpdEdhbWUpIHtcbiAgICAgICAgICAgIHRoaXMuZXhpdEdhbWUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAoIXRoaXMuaXNTdGFnZUNsZWFyKSB7XG4gICAgICAgICAgICAvL+mAmuW4uOaZguWHpueQhlxuICAgICAgICAgICAgLy/jg6Hjg4vjg6Xjg7zjgrfjg7zjg7Pjgbjnp7vooYxcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgPiAxNSkge1xuICAgICAgICAgICAgICAgIGlmIChjdC5wYXVzZSB8fCBjdC5tZW51KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ29wZW5tZW51Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmAsuihjFxuICAgICAgICAgICAgdmFyIGV2ZW50ID0gdGhpcy5zdGFnZUNvbnRyb2xsZXIuZ2V0KHRoaXMudGltZSk7XG4gICAgICAgICAgICBpZiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGV2ZW50LnZhbHVlKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBldmVudC52YWx1ZS5jYWxsKHRoaXMsIGV2ZW50Lm9wdGlvbik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbnRlckVuZW15VW5pdChldmVudC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bjg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIGlmICh0aGlzLm1hcExheWVyLmNsZWFyR2F0ZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YWdlQ29udHJvbGxlci5jaGVja1N0YWdlQ2xlYXJDb25kaXRpb24oKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcExheWVyLmNsZWFyR2F0ZS5pc0xvY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5wYXVzZVNjZW5lKSB0aGlzLnRpbWVMaW1pdC0tO1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZUxpbWl0IDwgMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGltZUxpbWl0ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWVMaW1pdCA9PSAwICYmICF0aGlzLnBsYXllci5pc0RlYWQpIHtcbi8vICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLmRlYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K444Kv44Oq44Ki5pmC5Yem55CGXG4gICAgICAgICAgICAvL+aui+OCiuOCv+OCpOODoOOCkuOCueOCs+OCouWKoOeul1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZUxpbWl0ID49IDYwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lTGltaXQgLT0gNjA7XG4gICAgICAgICAgICAgICAgdGhpcy50b3RhbFNjb3JlICs9IDIwO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRpbWVMaW1pdCA8IDYwKSB0aGlzLnRpbWVMaW1pdCA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44K344On44O844OI44Kr44OD44OIXG4gICAgICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgICAgIGlmIChjdC5vaykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRpbWVMaW1pdCA+PSA2MCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsU2NvcmUgKz0gTWF0aC5mbG9vcih0aGlzLnRpbWVMaW1pdCAvIDYwKSAqIDIwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44K544Kv44Oq44O844Oz6KGo56S65L2N572uXG4gICAgICAgIHZhciBtYXAgPSB0aGlzLm1hcExheWVyLm1hcDtcbiAgICAgICAgdGhpcy5tYXBMYXllci54ID0gU0NfVyAqIDAuNSAtIHRoaXMuY2FtZXJhLng7XG4gICAgICAgIHRoaXMubWFwTGF5ZXIueSA9IFNDX0ggKiAwLjUgLSB0aGlzLmNhbWVyYS55O1xuICAgICAgICBpZiAodGhpcy5saW1pdEhlaWdodCkge1xuICAgICAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIueSA+IDApIHRoaXMubWFwTGF5ZXIueSA9IDA7XG4gICAgICAgICAgICBpZiAodGhpcy5tYXBMYXllci55IDwgLShtYXAuaGVpZ2h0LVNDX0gpKSB0aGlzLm1hcExheWVyLnkgPSAtKG1hcC5oZWlnaHQtU0NfSCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubGltaXRXaWR0aCkge1xuICAgICAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIueCA+IDApIHRoaXMubWFwTGF5ZXIueCA9IDA7XG4gICAgICAgICAgICBpZiAodGhpcy5tYXBMYXllci54IDwgLShtYXAud2lkdGgtU0NfVykpIHRoaXMubWFwTGF5ZXIueCA9IC0obWFwLndpZHRoLVNDX1cpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jgrnjgq/jg6rjg7zjg7PluqfmqJlcbiAgICAgICAgdGhpcy5zY3JlZW5YID0gLXRoaXMubWFwTGF5ZXIueDtcbiAgICAgICAgdGhpcy5zY3JlZW5ZID0gLXRoaXMubWFwTGF5ZXIueTtcblxuICAgICAgICBpZiAodGhpcy5zdGFnZUNvbnRyb2xsZXIuaXNCYWNrZ3JvdW5kTW92ZSkge1xuICAgICAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4njga5Y5bqn5qiZ44KS5YWo5L2T44Gu5Ymy5ZCI44GL44KJ6KiI566XXG4gICAgICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZS54ID0gLU1hdGguZmxvb3IodGhpcy5iYWNrZ3JvdW5kSW1hZ2Uud2lkdGggKiAodGhpcy5wbGF5ZXIueCAvIG1hcC53aWR0aCkqMC4wNSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZS54ID0gdGhpcy5zdGFnZUNvbnRyb2xsZXIuYmFja2dyb3VuZFg7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxuXG4gICAgLy/mlbXjgq3jg6Pjg6njgq/jgr/mipXlhaVcbiAgICBzcGF3bkVuZW15OiBmdW5jdGlvbih4LCB5LCBuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBxZnQuRW5lbXlbbmFtZV0odGhpcywgb3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzLmVuZW15TGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgIH0sXG5cbiAgICAvL+OCouOCpOODhuODoOaKleWFpVxuICAgIHNwYXduSXRlbTogZnVuY3Rpb24oeCwgeSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gcWZ0Lkl0ZW0odGhpcywgb3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICB9LFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg5zjg4Pjgq/jgrnmipXlhaVcbiAgICBzcGF3bkl0ZW1Cb3g6IGZ1bmN0aW9uKHgsIHksIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHFmdC5JdGVtQm94KHRoaXMsIG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcy5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgfSxcblxuICAgIC8v44Ko44OV44Kn44Kv44OI5oqV5YWlXG4gICAgc3Bhd25FZmZlY3Q6IGZ1bmN0aW9uKHgsIHksIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHFmdC5FZmZlY3QodGhpcywgb3B0aW9ucykuYWRkQ2hpbGRUbyh0aGlzLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICB9LFxuXG4gICAgLy/jg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICBzcGF3bk1lc3NhZ2U6IGZ1bmN0aW9uKHRleHQsIGJldHdlZW4sIHdhaXRGcmFtZSkge1xuICAgICAgICBiZXR3ZWVuID0gYmV0d2VlbiB8fCAzMjtcbiAgICAgICAgd2FpdEZyYW1lID0gd2FpdEZyYW1lIHx8IDMwO1xuICAgICAgICB2YXIgYXJyYXlUZXh0ID0gdGV4dC5zcGxpdChcIlwiKTtcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmx1ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMzIsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuICAgICAgICB2YXIgbiA9IDA7XG4gICAgICAgIHZhciB4ID0gU0NfVyAqIDAuNSAtIChhcnJheVRleHQubGVuZ3RoICogYmV0d2VlbiAqIDAuNSk7XG4gICAgICAgIGFycmF5VGV4dC5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlID09IFwiIFwiKSB7XG4gICAgICAgICAgICAgICAgeCArPSBiZXR3ZWVuO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBsYiA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IGV9LiRzYWZlKGxhYmVsUGFyYW0pKS5zZXRQb3NpdGlvbih4LCBTQ19IKjAuNSszMikuc2V0U2NhbGUoMCwgMSkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgICAgIGxiLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgICAgICAud2FpdChuKVxuICAgICAgICAgICAgICAgIC50byh7c2NhbGVYOiAxLjAsIGFscGhhOiAxLCB5OiBTQ19IKjAuNX0sIDE1LCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLndhaXQod2FpdEZyYW1lKVxuICAgICAgICAgICAgICAgIC50byh7c2NhbGVYOiAwLjAsIHk6IFNDX0gqMC41LTMyfSwgMTAsIFwiZWFzZU91dFNpbmVcIilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe3RoaXMucmVtb3ZlKCl9LmJpbmQobGIpKTtcbiAgICAgICAgICAgIHggKz0gYmV0d2VlbjtcbiAgICAgICAgICAgIG4gKz0gNTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG4gICAgLy/jgqTjg5njg7Pjg4jjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICBzcGF3bkV2ZW50TWVzc2FnZTogZnVuY3Rpb24oaWQsIHRleHQpIHtcbiAgICAgICAgaWYgKCFpZCB8fCAhdGV4dCkgcmV0dXJuO1xuICAgICAgICAvL+ODoeODg+OCu+ODvOOCuOOCueOCv+ODg+OCr+WGheOBq+WQjOS4gO+8qe+8pOOBjOOBguOCi+WgtOWQiOOBr+aKleWFpeOBl+OBquOBhFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWVzc2FnZVN0YWNrLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5tZXNzYWdlU3RhY2tbaV0uaWQgPT0gaWQpIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGV4dCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICB0ZXh0LmZvckVhY2goZnVuY3Rpb24oc3RyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlU3RhY2sucHVzaCh7aWQ6IGlkLCB0ZXh0OiBzdHJ9KTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VTdGFjay5wdXNoKHtpZDogaWQsIHRleHQ6IHRleHR9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+OCueOCr+ODquODvOODs+WIneacn+WMllxuICAgIHNldHVwU2NyZWVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiVWJ1bnR1TW9ub1wiLFxuICAgICAgICAgICAgYWxpZ246IFwibGVmdFwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMjAsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgIC8v5L2T5Yqb44Ky44O844K4XG4gICAgICAgIHRoaXMubGlmZUdhdWdlTGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIkxJRkVcIn0uJHNhZmUobGFiZWxQYXJhbSkpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oMCwgMTApO1xuICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAgMjAwLFxuICAgICAgICAgICAgaGVpZ2h0OiA1LFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgZmlsbDogJ3JlZCcsXG4gICAgICAgICAgICBzdHJva2U6ICd3aGl0ZScsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcbiAgICAgICAgICAgIGdhdWdlQ29sb3I6ICdsaW1lJyxcbiAgICAgICAgICAgIGNvcm5lclJhZGl1czogMCxcbiAgICAgICAgICAgIHZhbHVlOiB0aGlzLnBsYXllci5ocCxcbiAgICAgICAgICAgIG1heFZhbHVlOiB0aGlzLnBsYXllci5ocE1heCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5saWZlR2F1Z2UgPSBwaGluYS51aS5HYXVnZShvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMpLnNldE9yaWdpbigwLCAwLjUpLnNldFBvc2l0aW9uKDQwLCAxMCk7XG4gICAgICAgIHRoaXMubGlmZUdhdWdlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoYXQucGxheWVyLmhwO1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHRoYXQucGxheWVyLmhwTWF4ICogMjtcbiAgICAgICAgICAgIHRoaXMubWF4VmFsdWUgPSB0aGF0LnBsYXllci5ocE1heDtcbiAgICAgICAgfTtcblxuICAgICAgICAvL+OCueOCs+OCouihqOekulxuICAgICAgICB0aGlzLnNjb3JlTGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OlwiU0NPUkU6XCIsIGFsaWduOiBcInJpZ2h0XCJ9LiRzYWZlKGxhYmVsUGFyYW0pKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1csIDEwKTtcbiAgICAgICAgdGhpcy5zY29yZUxhYmVsLnNjb3JlID0gMDtcbiAgICAgICAgdGhpcy5zY29yZUxhYmVsLnMgPSAwO1xuICAgICAgICB0aGlzLnNjb3JlTGFiZWwudXBkYXRlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUudGlja2VyLmZyYW1lICUgMTAgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMucyA9IH5+KCh0aGF0LnRvdGFsU2NvcmUtdGhpcy5zY29yZSkvNyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucyA8IDMpIHRoaXMucyA9IDM7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucyA+IDc3NzcpIHRoaXMucyA9IDc3Nzc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNjb3JlICs9IHRoaXMucztcbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3JlID4gdGhhdC50b3RhbFNjb3JlKSB0aGlzLnNjb3JlID0gdGhhdC50b3RhbFNjb3JlO1xuXG4gICAgICAgICAgICB0aGlzLnRleHQgPSBcIlNDT1JFIFwiK3RoaXMuc2NvcmUuY29tbWEoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5Yi26ZmQ5pmC6ZaT6KGo56S6XG4gICAgICAgIHRoaXMudGltZUxhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJUSU1FOlwiLCBhbGlnbjogXCJyaWdodFwifS4kc2FmZShsYWJlbFBhcmFtKSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XLCAzMCk7XG4gICAgICAgIHRoaXMudGltZUxhYmVsLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gXCJUSU1FOlwiK01hdGguZmxvb3IodGhhdC50aW1lTGltaXQvMzApO1xuICAgICAgICAgICAgaWYgKHRoYXQudGltZUxpbWl0ID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGwgPSAncmVkJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxsID0gJ3doaXRlJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O86KOF5YKZ5q2m5Zmo6KGo56S6XG4gICAgICAgIHRoaXMucGxheWVyV2VhcG9uID0gcWZ0LlBsYXllcldlYXBvbih0aGlzLnBsYXllcikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XLTMwLCBTQ19ILTMwKTtcbiAgICAgICAgdmFyIHN3ID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDYwLCBoZWlnaHQ6IDYwfSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVy0zMCwgU0NfSC0zMClcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSh0cnVlKVxuICAgICAgICAgICAgLnNldEFscGhhKDAuMCk7XG4gICAgICAgIHN3Lm9uKCdwb2ludHN0YXJ0JywgZSA9PiB7XG4gICAgICAgICAgICB2YXIgcGwgPSB0aGF0LnBsYXllcjtcbiAgICAgICAgICAgIGlmICghcGwuYmVmb3JlLmNoYW5nZSAmJiBwbC5lcXVpcC5zd2l0Y2hPaykgcGwuc3dpdGNoV2VhcG9uKCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+ODnuODg+ODl+aDheWgseOBruWIneacn+WMllxuICAgIHNldHVwU3RhZ2U6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHRoaXMuYmFzZUxheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG5cbiAgICAgICAgLy/nmbvpjLLmuIjjgb/jg57jg4Pjg5fjga7mtojljrtcbiAgICAgICAgdGhpcy5jbGVhck1hcCgpO1xuXG4gICAgICAgIC8v44K544OG44O844K46Kit5a6a6Kqt44G/6L6844G/XG4gICAgICAgIHN3aXRjaCAodGhpcy5zdGFnZU51bWJlcikge1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlMSh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2UyKHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTModGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlNCh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2U1KHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTYodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlNyh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIgPSBxZnQuU3RhZ2U4KHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTkodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNYXAodGhpcy5zdGFnZUNvbnRyb2xsZXIubWFwTGF5ZXJbMF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxMDpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTEwKHRoaXMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoTWFwKHRoaXMuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyWzBdKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRW5kaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAvL+OCt+OCueODhuODoOihqOekuuOBru+8r++8pu+8plxuICAgICAgICAgICAgICAgIHRoaXMubGlmZUdhdWdlTGFiZWwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMubGlmZUdhdWdlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNjb3JlTGFiZWwudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMudGltZUxhYmVsLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcldlYXBvbi52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDk5OTpcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlQ29udHJvbGxlciA9IHFmdC5TdGFnZTk5OSh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLjg5Xjg6njgrDjgq/jg6rjgqJcbiAgICAgICAgdGhpcy5pc1N0YWdlQ2xlYXIgPSBmYWxzZTtcblxuICAgICAgICAvL+e1jOmBjuaZgumWk+WIneacn+WMllxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIC8v44K/44Kk44Og44Oq44Of44OD44OI6Kit5a6aXG4gICAgICAgIHRoaXMudGltZUxpbWl0ID0gdGhpcy5zdGFnZUNvbnRyb2xsZXIudGltZUxpbWl0O1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O86Kit5a6aXG4gICAgICAgIHRoaXMucGxheWVyLmlzQ29udHJvbCA9IHRydWU7XG4gICAgICAgIHRoaXMucGxheWVyLmlzTXV0ZWtpID0gZmFsc2U7XG4gICAgICAgIHRoaXMucGxheWVyLmFscGhhID0gMS4wO1xuXG4gICAgICAgIHRoaXMubWFwc3RhcnQgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSk7XG5cbiAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIucGxheUJHTSgpO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCpOODmeODs+ODiOeZuueBq1xuICAgIGZpcmVTdGFnZUV2ZW50OiBmdW5jdGlvbihldmVudE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhZ2VDb250cm9sbGVyLmZpcmVFdmVudChldmVudE5hbWUpO1xuICAgIH0sXG5cbiAgICB3YXJwOiBmdW5jdGlvbih4LCB5LCBmcmFtZSkge1xuICAgICAgICBmcmFtZSA9IGZyYW1lIHx8IDYwO1xuICAgICAgICB0aGlzLnBsYXllci5pc0NvbnRyb2wgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuZ3Jhdml0eSA9IDA7XG4gICAgICAgIHRoaXMucGxheWVyLnZ4ID0gMDtcbiAgICAgICAgdGhpcy5wbGF5ZXIuaXNNdXRla2kgPSB0cnVlO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDQ1KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGlzLmlnbm9yZUNvbGxpc2lvbiA9IHRydWU7XG4gICAgICAgICAgICB9LmJpbmQodGhpcy5wbGF5ZXIpKVxuICAgICAgICAgICAgLm1vdmVUbyh4LCB5LCBmcmFtZSwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoaXMuaWdub3JlQ29sbGlzaW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmF2aXR5ID0gMC45O1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMucGxheWVyKSlcbiAgICAgICAgICAgIC53YWl0KDkwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQ29udHJvbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5pc011dGVraSA9IGZhbHNlO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMucGxheWVyKSk7XG4gICAgfSxcblxuICAgIC8v44Oe44OD44OX5oOF5aCx44Gu5raI5Y67XG4gICAgY2xlYXJNYXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+W9k+OBn+OCiuWIpOWumuOAgeOCquODluOCuOOCp+OCr+ODiOOBruWFqOa2iOWOu1xuICAgICAgICBpZiAodGhpcy5iYWNrZ3JvdW5kTGF5ZXIpIHRoaXMuYmFja2dyb3VuZExheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG4gICAgICAgIGlmICh0aGlzLmZvcmVncm91bmRMYXllcikgdGhpcy5mb3JlZ3JvdW5kTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICAgICAgaWYgKHRoaXMuY29sbGlzaW9uTGF5ZSkgdGhpcy5jb2xsaXNpb25MYXllci5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICBpZiAodGhpcy5lbmVteUxheWVyKSB0aGlzLmVuZW15TGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICAgICAgaWYgKHRoaXMub2JqTGF5ZXIpIHRoaXMub2JqTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICAgICAgaWYgKHRoaXMubWFwSW1hZ2VMYXllcikgdGhpcy5tYXBJbWFnZUxheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG4gICAgICAgIGlmICh0aGlzLmVmZmVjdExheWVyKSB0aGlzLmVmZmVjdExheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG4gICAgICAgIGlmICh0aGlzLnNoYWRvd0xheWVyKSB0aGlzLnNoYWRvd0xheWVyLnJlbW92ZUNoaWxkcmVuKCk7XG4gICAgfSxcblxuICAgIC8v44Oe44OD44OX44Os44Kk44Ok44Gu5YiH5pu/XG4gICAgc3dpdGNoTWFwOiBmdW5jdGlvbihsYXllciwgeCwgeSkge1xuICAgICAgICBpZiAodGhpcy5tYXBMYXllcikgdGhpcy5tYXBMYXllci5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5tYXBMYXllciA9IGxheWVyO1xuICAgICAgICB0aGlzLm1hcExheWVyLmFkZENoaWxkVG8odGhpcy5iYXNlTGF5ZXIpO1xuICAgICAgICB0aGlzLm1hcCA9IGxheWVyLm1hcDtcblxuICAgICAgICB0aGlzLmJhY2tncm91bmRMYXllciA9IGxheWVyLmJhY2tncm91bmRMYXllcjtcbiAgICAgICAgdGhpcy5mb3JlZ3JvdW5kTGF5ZXIgPSBsYXllci5mb3JlZ3JvdW5kTGF5ZXI7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uTGF5ZXIgPSBsYXllci5jb2xsaXNpb25MYXllcjtcbiAgICAgICAgdGhpcy5lbmVteUxheWVyID0gbGF5ZXIuZW5lbXlMYXllcjtcbiAgICAgICAgdGhpcy5wbGF5ZXJMYXllciA9IGxheWVyLnBsYXllckxheWVyO1xuICAgICAgICB0aGlzLm9iakxheWVyID0gbGF5ZXIub2JqTGF5ZXI7XG4gICAgICAgIHRoaXMubWFwSW1hZ2VMYXllciA9IGxheWVyLm1hcEltYWdlTGF5ZXI7XG4gICAgICAgIHRoaXMuZWZmZWN0TGF5ZXIgPSBsYXllci5lZmZlY3RMYXllcjtcbiAgICAgICAgdGhpcy5zaGFkb3dMYXllciA9IGxheWVyLnNoYWRvd0xheWVyO1xuXG4gICAgICAgIHRoaXMucGxheWVyLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLnBsYXllci5hZGRDaGlsZFRvKGxheWVyLnBsYXllckxheWVyKTtcbiAgICAgICAgaWYgKHgpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44Oq44K544K/44O844OIXG4gICAgcmVzdGFydDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMucGxheWVyLmNvbnRpbnVlUmVzZXQoKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIubXV0ZWtpVGltZSA9IDkwO1xuICAgICAgICB0aGlzLnBsYXllci5hZGRDaGlsZFRvKHRoaXMubWFwTGF5ZXIucGxheWVyTGF5ZXIpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85bqn5qiZ44KS5pyA5b6M44Gr5bqK44Gr44GE44Gf5aC05omA44Gr44GZ44KLXG4gICAgICAgIHRoaXMucGxheWVyLnggPSB0aGlzLnBsYXllci5sYXN0T25GbG9vclg7XG4gICAgICAgIHRoaXMucGxheWVyLnkgPSB0aGlzLnBsYXllci5sYXN0T25GbG9vclk7XG5cbiAgICAgICAgLy/lvqnluLDkvY3nva7lronlhajmgKfnorroqo1cbiAgICAgICAgdmFyIHggPSB0aGlzLnBsYXllci54O1xuICAgICAgICB2YXIgeSA9IHRoaXMucGxheWVyLnk7XG4gICAgICAgIHZhciBjMSA9IHRoaXMucGxheWVyLmNoZWNrTWFwQ29sbGlzaW9uMih4LCB5ICsgNSwgNCwgMzIpOyAgIC8v55yf5LiLXG4gICAgICAgIHZhciBjMiA9IHRoaXMucGxheWVyLmNoZWNrTWFwQ29sbGlzaW9uMih4KzMyLCB5ICsgNSwgNCwgMzIpOy8v5Y+z5LiLXG4gICAgICAgIHZhciBjMyA9IHRoaXMucGxheWVyLmNoZWNrTWFwQ29sbGlzaW9uMih4LTMyLCB5ICsgNSwgNCwgMzIpOy8v5bem5LiLXG4gICAgICAgIC8v55yf5LiL44Gr6Laz5aC044GM54Sh44GE5aC05ZCI44Gv5a6J5YWo44Gq5aC05omA44Gr44Ga44KJ44GZXG4gICAgICAgIGlmICghYzEpIHtcbiAgICAgICAgICAgIGlmIChjMikge1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLnggKz0gMzI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGMzKXtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci54IC09IDMyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL+WuieWFqOOBq+W+qeW4sOWHuuadpeOBquOBhOOBruOBp+ebtOi/keOBruOCueOCv+ODvOODiOWcsOeCueOBuFxuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLnggPSB0aGlzLm1hcHN0YXJ0Lng7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIueSA9IHRoaXMubWFwc3RhcnQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudG90YWxTY29yZSA9IDA7XG4gICAgICAgIHRoaXMudG90YWxLaWxsID0gMDtcbiAgICAgICAgdGhpcy5jb250aW51ZUNvdW50Kys7XG5cbiAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIucGxheUJHTSgpO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOColxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiVWJ1bnR1TW9ub1wiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMjAsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgIC8v44Kq44O844Or44Kv44Oq44Ki5Yik5a6aXG4gICAgICAgIHRoaXMuYWxsQ2xlYXIgPSBmYWxzZTtcbiAgICAgICAgaWYgKCF0aGlzLmlzUHJhY3RpY2UgJiYgdGhpcy5zdGFnZU51bWJlciA+PSB0aGlzLnN0YWdlTnVtYmVyTWF4KSB0aGlzLmFsbENsZWFyID0gdHJ1ZTtcblxuICAgICAgICAvL+OCr+ODquOCouODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICB2YXIgdGV4dCA9IFwiU1RBR0UgXCIgKyB0aGlzLnN0YWdlTnVtYmVyICsgXCIgQ0xFQVIhXCI7XG4gICAgICAgIGlmICh0aGlzLmFsbENsZWFyKSB0ZXh0ID0gXCJTVEFHRSBBTEwgQ0xFQVIhXCI7XG4gICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKHRleHQsIDI0KTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuaXNDb250cm9sID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyLnN0YWdlQ2xlYXIoKTtcbiAgICAgICAgdGhpcy5pc1N0YWdlQ2xlYXIgPSB0cnVlO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85omA5oyB44Kt44O844Kv44Oq44KiXG4gICAgICAgIHRoaXMucGxheWVyLmtleXMgPSBbXTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuaXNNdXRla2kgPSB0cnVlO1xuXG4gICAgICAgIC8v44Kv44Oq44KiQkdNXG4gICAgICAgIHZhciBiZ21GaW5pc2ggPSBmYWxzZTtcbiAgICAgICAgYXBwLnBsYXlCR00oXCJzdGFnZWNsZWFyXCIsIGZhbHNlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGJnbUZpbmlzaCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBhciA9IHtsb2FkY29tcGxldGU6IHRydWV9O1xuICAgICAgICBpZiAoIXRoaXMuaXNQcmFjdGljZSkge1xuICAgICAgICAgICAgLy/jgq/jg6rjgqLmmYLngrnmg4XloLHkv53lrZhcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHN0YWdlOiB0aGlzLnN0YWdlTnVtYmVyLFxuICAgICAgICAgICAgICAgIHNjb3JlOiB0aGlzLnRvdGFsU2NvcmUsXG4gICAgICAgICAgICAgICAga2lsbDogdGhpcy50b3RhbEtpbGwsXG4gICAgICAgICAgICAgICAgdGltZTogdGhpcy5zdGFnZUNvbnRyb2xsZXIudGltZUxpbWl0IC0gdGhpcy50aW1lTGltaXQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5jbGVhclJlc3VsdFt0aGlzLnN0YWdlTnVtYmVyXSA9IGRhdGE7XG5cbiAgICAgICAgICAgIC8v5qyh44K544OG44O844K444Gu44Ki44K744OD44OI6Kqt44G/6L6844G/XG4gICAgICAgICAgICBpZiAodGhpcy5zdGFnZU51bWJlciA8IHRoaXMuc3RhZ2VOdW1iZXJNYXgpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXNzZXRzID0gcWZ0LkFzc2V0cy5nZXQoe2Fzc2V0VHlwZTogXCJzdGFnZVwiKyh0aGlzLnN0YWdlTnVtYmVyKzEpfSk7XG4gICAgICAgICAgICAgICAgdmFyIGFyID0gcGhpbmEuZXh0ZW5zaW9uLkFzc2V0TG9hZGVyRXgoKS5sb2FkKGFzc2V0cywgZnVuY3Rpb24oKXthcHAuc291bmRzZXQucmVhZEFzc2V0KCk7fSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v44Kq44O844Or44Kv44Oq44Ki5pmC44Gv44Ko44Oz44OH44Kj44Oz44Kw55So44K544OG44O844K444G4XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWxsQ2xlYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2V0cyA9IHFmdC5Bc3NldHMuZ2V0KHthc3NldFR5cGU6IFwic3RhZ2UxMFwifSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhciA9IHBoaW5hLmV4dGVuc2lvbi5Bc3NldExvYWRlckV4KCkubG9hZChhc3NldHMsIGZ1bmN0aW9uKCl7YXBwLnNvdW5kc2V0LnJlYWRBc3NldCgpO30pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44Ot44O844OJ6YCy5o2X6KGo56S6XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHBhcmFtID0ge3RleHQ6IFwiTG9hZGluZy4uLiBcIiwgYWxpZ246IFwicmlnaHRcIiwgZm9udFNpemU6IDIwfS4kc2FmZShsYWJlbFBhcmFtKTtcbiAgICAgICAgdmFyIHByb2dyZXNzID0gcGhpbmEuZGlzcGxheS5MYWJlbChwYXJhbSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XLCBTQ19IKjAuOTUpO1xuICAgICAgICBwcm9ncmVzcy50aW1lID0gMDtcbiAgICAgICAgcHJvZ3Jlc3MudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+ODreODvOODieOBjOe1guOCj+OBo+OBn+OCieOCreODvOWFpeWKm+OBp+asoeOCueODhuODvOOCuOOBuFxuICAgICAgICAgICAgaWYgKGFyLmxvYWRwcm9ncmVzcykgdGhpcy50ZXh0ID0gXCJMb2FkaW5nLi4uIFwiK01hdGguZmxvb3IoYXIubG9hZHByb2dyZXNzICogMTAwKStcIiVcIjtcbiAgICAgICAgICAgIGlmIChiZ21GaW5pc2ggJiYgdGhhdC50aW1lTGltaXQgPT0gMCAmJiBhci5sb2FkY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSBcIlB1c2ggYnV0dG9uIHRvIG5leHQgc3RhZ2UuXCI7XG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuYWxsQ2xlYXIpIHRoaXMudGV4dCA9IFwiUHVzaCBidXR0b24gdG8gbmV4dC4uLlwiO1xuICAgICAgICAgICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICAgICAgICAgIGlmIChjdC5vayB8fCBjdC5jYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuaXNQcmFjdGljZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fZXhpdEdhbWUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5mbGFyZSgnbmV4dHN0YWdlJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMzAgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgICAgIHRoaXMudGltZSsrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGV4aXRHYW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYXBwLnBsYXlCR00oXCJvcGVuaW5nYmdtXCIpO1xuICAgICAgICBpZiAodGhpcy5pc1ByYWN0aWNlIHx8IHRoaXMuaXNDb250aW51ZSkge1xuICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmV4aXQoXCJ0aXRsZVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ePvuWcqOOBruOCueODhuODvOOCv+OCueOCkuODreODvOOCq+ODq+OCueODiOODrOODvOOCuOOBuOS/neWtmFxuICAgIHNhdmVHYW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNhdmVPYmogPSB7XG4gICAgICAgICAgICBzdGFnZU51bWJlcjogdGhpcy5zdGFnZU51bWJlcixcbiAgICAgICAgICAgIHNjb3JlOiB0aGlzLnRvdGFsU2NvcmUsXG4gICAgICAgICAgICBraWxsOiB0aGlzLnRvdGFsS2lsbCxcbiAgICAgICAgICAgIHJlc3VsdDogdGhpcy5jbGVhclJlc3VsdCxcbiAgICAgICAgICAgIHBsYXllclN0YXR1czogdGhpcy5wbGF5ZXIuc3RhcnRTdGF0dXMsXG4gICAgICAgIH07XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwic3RhZ2VcIiwgSlNPTi5zdHJpbmdpZnkoc2F2ZU9iaikpO1xuICAgICAgICByZXR1cm4gc2F2ZU9iajtcbiAgICB9LFxuXG4gICAgLy/jg63jg7zjgqvjg6vjgrnjg4jjg6zjg7zjgrjjgYvjgonnm7TliY3jga7kv53lrZjnirbmhYvjgpLoqq3jgb/ovrzjgb9cbiAgICBsb2FkR2FtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBkYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJzdGFnZVwiKTtcbiAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBkID0gSlNPTi5wYXJzZShkYXRhKS4kc2FmZSh7XG4gICAgICAgICAgICAgICAgc3RhZ2VOdW1iZXI6IDEsXG4gICAgICAgICAgICAgICAgcmVzdWx0OiBbXSxcbiAgICAgICAgICAgICAgICBwbGF5ZXJTdGF0dXM6IHt9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnN0YWdlTnVtYmVyID0gZC5zdGFnZU51bWJlcjtcbiAgICAgICAgICAgIHRoaXMudG90YWxTY29yZSA9IDA7XG4gICAgICAgICAgICB0aGlzLnRvdGFsS2lsbCA9IDA7XG4gICAgICAgICAgICB0aGlzLmNsZWFyUmVzdWx0ID0gZC5yZXN1bHQ7XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCx5b6p5YWDXG4gICAgICAgICAgICB0aGlzLnBsYXllci5zdGFydFN0YXR1cyA9IGQucGxheWVyU3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIucmVzdG9yZVN0YXR1cygpO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXJXZWFwb24ucm90YXRpb24gPSAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgbWVudXNjZW5lLmpzXG4gKiAgMjAxNi8xMi8yOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cbiBcbnBoaW5hLmRlZmluZShcInFmdC5NZW51U2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKGN1cnJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZSA9IGN1cnJlbnRTY2VuZTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC41KVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMC41KVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KVxuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwibGVmdFwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMTYsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucGxheWVyID0gdGhpcy5jdXJyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB0aGlzLmxpbWl0RnJhbWUgPSAzMDtcbiAgICAgICAgdGhpcy5pc0V4aXQgPSBmYWxzZTtcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDUsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwidGl0bGVmb250MlwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiA3MCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwxID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJQQVVTRVwiLCBmb250U2l6ZTogMjB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC44KTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwOyAgICAgICAgXG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAodGhpcy50aW1lID4gMTAgJiYgIXRoaXMuaXNFeGl0KSB7XG4gICAgICAgICAgICBpZiAoY3Quc3RhcnQgfHwgY3QucGF1c2UgfHwgY3QubWVudSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNFeGl0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCgxMDApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnBvcFNjZW5lKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMubGltaXRGcmFtZS0tO1xuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9LFxufSk7XG5cbiIsIi8qXG4gKiAgbWVudXNjZW5lLmpzXG4gKiAgMjAxNi8xMi8yOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cbiBcbnBoaW5hLmRlZmluZShcInFmdC5NZW51U2NlbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKGN1cnJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZSA9IGN1cnJlbnRTY2VuZTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC41KVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMC41KVwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJnID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KVxuXG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgYWxpZ246IFwibGVmdFwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMTYsXG4gICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMucGxheWVyID0gdGhpcy5jdXJyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgeCA9IFNDX1cqMC4zOyAvL3RoaXMucGxheWVyLnggKyB0aGlzLmN1cnJlbnRTY2VuZS5tYXBMYXllci54O1xuICAgICAgICB2YXIgeSA9IFNDX0gqMC41OyAvL3RoaXMucGxheWVyLnkgKyB0aGlzLmN1cnJlbnRTY2VuZS5tYXBMYXllci55O1xuXG4gICAgICAgIC8v44OZ44O844K544Ko44Os44Oh44Oz44OIXG4gICAgICAgIHRoaXMubWVudUJhc2UgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgdGhpcy5tZW51QmFzZS50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuXG4gICAgICAgIC8v44Oh44OL44Ol44O844Ki44Kk44OG44Og5Yid5pyf5YyWXG4gICAgICAgIHRoaXMuc2V0SXRlbXMoKTtcblxuICAgICAgICAvL+ePvuWcqOijheWCmeihqOekulxuICAgICAgICB2YXIgZXEgPSB0aGlzLnBsYXllci5lcXVpcDtcbiAgICAgICAgdGhpcy53ZWFwb24gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIml0ZW1cIiwgMjQsIDI0KVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41NSwgU0NfSCowLjMpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMS41KVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoZXEud2VhcG9uWzBdKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMud2VhcG9uTGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNTUrMzIsIFNDX0gqMC4zKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMud2VhcG9uTGFiZWwudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHFmdC5JdGVtSW5mby5nZXQoZXEud2VhcG9uWzBdKTtcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IGl0ZW0ubmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmxpbWl0RnJhbWUgPSAzMDtcblxuICAgICAgICB0aGlzLmlzRXhpdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRpbWUgPSAwOyAgICAgICAgXG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAodGhpcy50aW1lID4gMTAgJiYgIXRoaXMuaXNFeGl0KSB7XG4gICAgICAgICAgICBpZiAoY3Quc3RhcnQgfHwgY3QucGF1c2UgfHwgY3QubWVudSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNFeGl0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLndhaXQoMTAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wb3BTY2VuZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdC5yaWdodCAmJiB0aGlzLmxpbWl0RnJhbWUgPCAwKSB7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImNsaWNrXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubWVudUJhc2UudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5ieSh7cm90YXRpb246IC10aGlzLmRlZ18xfSwgNClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvdGF0aW9uIDwgMCkgdGhpcy5yb3RhdGlvbiArPSAzNjA7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzLm1lbnVCYXNlKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5saW1pdEZyYW1lID0gNTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZS5tZW51U2VsZWN0Kys7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudFNjZW5lLm1lbnVTZWxlY3QgPT0gdGhpcy5pY29uLmxlbmd0aCkgdGhpcy5jdXJyZW50U2NlbmUubWVudVNlbGVjdCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3QubGVmdCAmJiB0aGlzLmxpbWl0RnJhbWUgPCAwKSB7XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImNsaWNrXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubWVudUJhc2UudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5ieSh7cm90YXRpb246IHRoaXMuZGVnXzF9LCA0KVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucm90YXRpb24gPiAzNjApIHRoaXMucm90YXRpb24gLT0gMzYwO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcy5tZW51QmFzZSkpO1xuICAgICAgICAgICAgICAgIHRoaXMubGltaXRGcmFtZSA9IDU7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUubWVudVNlbGVjdC0tO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRTY2VuZS5tZW51U2VsZWN0IDwgMCkgdGhpcy5jdXJyZW50U2NlbmUubWVudVNlbGVjdCA9IHRoaXMuaWNvbi5sZW5ndGgtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpbWl0RnJhbWUtLTtcbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcblxuICAgIHNldEl0ZW1zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDI0LFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMubWVudUJhc2UucmVtb3ZlQ2hpbGRyZW4oKTtcblxuICAgICAgICAvL+ODoeODi+ODpeODvOOCouOCpOODhuODoFxuICAgICAgICB0aGlzLmljb24gPSBbXTtcbiAgICAgICAgdGhpcy5tZW51SXRlbXMgPSB0aGlzLnBsYXllci5pdGVtcy5jbG9uZSgpO1xuXG4gICAgICAgIHZhciByYWQgPSAwO1xuICAgICAgICB2YXIgcmFkXzEgPSAoTWF0aC5QSSoyKSAvIHRoaXMubWVudUl0ZW1zLmxlbmd0aDtcbiAgICAgICAgdmFyIGlkID0gMDtcbiAgICAgICAgdGhpcy5tZW51SXRlbXMuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgaWM7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgaWMgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBlfS4kc2FmZShsYWJlbFBhcmFtKSkuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKTtcbiAgICAgICAgICAgICAgICBpYy5zZXRTY2FsZSgwLjUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpYyA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiaXRlbVwiLCAyNCwgMjQpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWMudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgICAgIGljLnJhZCA9IHJhZDtcbiAgICAgICAgICAgIGljLmlkID0gaWQ7XG4gICAgICAgICAgICBpYy5kaXN0YW5jZSA9IDA7XG4gICAgICAgICAgICBpYy5pc0Nsb3NlID0gZmFsc2U7XG4gICAgICAgICAgICBpYy51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gLXRoYXQubWVudUJhc2Uucm90YXRpb247XG4gICAgICAgICAgICAgICAgdGhpcy54ID0gIE1hdGguc2luKHRoaXMucmFkKSp0aGlzLmRpc3RhbmNlO1xuICAgICAgICAgICAgICAgIHRoaXMueSA9IC1NYXRoLmNvcyh0aGlzLnJhZCkqdGhpcy5kaXN0YW5jZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0Nsb3NlKSByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWQgPT0gdGhhdC5jdXJyZW50U2NlbmUubWVudVNlbGVjdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKS50byh7ZGlzdGFuY2U6IDg4LCBzY2FsZVg6IDMsIHNjYWxlWTogM30sIDMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpLnRvKHtkaXN0YW5jZTogNzIsIHNjYWxlWDogMSwgc2NhbGVZOiAxfSwgMyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWMuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKS50byh7ZGlzdGFuY2U6IDAsIHNjYWxlWDogMSwgc2NhbGVZOiAxfSwgMyk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0Nsb3NlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGljLnR3ZWVuZXIuY2xlYXIoKS50byh7ZGlzdGFuY2U6IDQ4fSwgNTAwKTtcbiAgICAgICAgICAgIHRoaXMuaWNvbi5wdXNoKGljKTtcbiAgICAgICAgICAgIHJhZCArPSByYWRfMTtcbiAgICAgICAgICAgIGlkKys7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5kZWdfMSA9IDM2MC8gdGhpcy5tZW51SXRlbXMubGVuZ3RoO1xuICAgICAgICB0aGlzLm1lbnVCYXNlLnJvdGF0aW9uID0gLSh0aGlzLmN1cnJlbnRTY2VuZS5tZW51U2VsZWN0ICogdGhpcy5kZWdfMSkgLSA5MDtcbiAgICAgICAgdGhpcy5tZW51QmFzZS50d2VlbmVyLmJ5KHtyb3RhdGlvbjogOTB9LCAxNSwgXCJlYXNlT3V0U2luZVwiKTtcbiAgICB9LFxuXG4gICAgY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLm1lbnVCYXNlLnR3ZWVuZXIuY2xlYXIoKS5ieSh7cm90YXRpb246IDE4MH0sIDE1LCBcImVhc2VPdXRTaW5lXCIpO1xuICAgICAgICB0aGlzLmljb24uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBlLmNsb3NlKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuXG4iLCIvKlxuICogIG1lc3NhZ2VzY2VuZS5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG4gXG5waGluYS5kZWZpbmUoXCJxZnQuTWVzc2FnZVNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihjdXJyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUgPSBjdXJyZW50U2NlbmU7XG5cbiAgICAgICAgLy/jg6Hjg4Pjgrvjg7zjgrjjgqbjgqPjg7Pjg4njgqZcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyowLjgsXG4gICAgICAgICAgICBoZWlnaHQ6U0NfSCowLjQsXG4gICAgICAgICAgICBmaWxsOiBcInJnYmEoMCwwLDAsMC44KVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHRva2VXaWR0aDogNSxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuMjUpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMSwgMCk7XG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVk6IDF9LCA1MDAsIFwiZWFzZU91dEN1YmVcIik7XG5cbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDE2LFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBvcHRpb25zLm1lc3NhZ2UgfHwgXCJubyBtZXNzYWdlXCIsIGZvbnRTaXplOiAyMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjI1KTtcblxuICAgICAgICB0aGlzLnBsYXllciA9IHRoaXMuY3VycmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdGhpcy5saW1pdEZyYW1lID0gMzA7XG4gICAgICAgIHRoaXMuaXNFeGl0ID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy50aW1lID0gMDsgICAgICAgIFxuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY3QgPSBhcHAuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDEwICYmICF0aGlzLmlzRXhpdCkge1xuICAgICAgICAgICAgaWYgKGN0LnN0YXJ0IHx8IGN0LnBhdXNlIHx8IGN0Lm1lbnUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRXhpdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLndhaXQoMTAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wb3BTY2VuZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpbWl0RnJhbWUtLTtcbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcbn0pO1xuXG4iLCIvKlxuICogIG9wZW5pbmdzY2VuZS5qc1xuICogIDIwMTcvMDIvMDhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG4gXG5waGluYS5kZWZpbmUoXCJxZnQuT3BlbmluZ1NjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICAvL+mAsuihjFxuICAgIHNlcTogMCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKGN1cnJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7d2lkdGg6IFNDX1csIGhlaWdodDogU0NfSH0pO1xuICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZSA9IGN1cnJlbnRTY2VuZTtcblxuICAgICAgICAvL++8ou+8p++8reWGjeeUn1xuICAgICAgICBhcHAucGxheUJHTShcIm9wZW5pbmdiZ21cIik7XG5cbiAgICAgICAgdGhpcy50ZXh0ID0gW1xuICAgICAgICAgICAgXCLkuJbnlYzjga7kuK3lv4PjgavjgZ3jgbPjgYjjgovloZRcIixcbiAgICAgICAgICAgIFwi5aGU44Gu5pyA5LiK6ZqO44Gr44GvXCIsXG4gICAgICAgICAgICBcIuOAjOawuOmBoOOBrumDveOAjeOBqOWRvOOBsOOCjOOCi+alveWckuOBjOOBguOCi+OBqOOBhOOBhlwiLFxuICAgICAgICAgICAgXCLlmYLjgpLogZ7jgYTjgZ/lpJrjgY/jga7lhpLpmbrogIXjgYxcIixcbiAgICAgICAgICAgIFwi5qW95ZyS44KS5rGC44KB44Gm5aGU44G444Go6LW044GNXCIsXG4gICAgICAgICAgICBcIuOBneOBruisjuOBq+aMkeOCk+OBp+OBhOOBo+OBn1wiLFxuICAgICAgICAgICAgXCLjgZfjgYvjgZfigKZcIixcbiAgICAgICAgICAgIFwi5b2844KJ44GM5p6c44Gf44GX44Gm5qW95ZyS44Gr6L6/44KK552A44GE44Gf44Gu44GLXCIsXG4gICAgICAgICAgICBcIuOBneOCjOOBqOOCguS4lueVjOOBruaenOOBpuOBp+WKm+WwveOBjeOBn+OBruOBi1wiLFxuICAgICAgICAgICAgXCLjgZ3jga7mnKvot6/jgpLnn6XjgovogIXjga/jgYTjgarjgYRcIixcbiAgICAgICAgICAgIFwi44Gd44GX44Gm4oCmXCIsXG4gICAgICAgICAgICBcIuaWsOOBn+OBquWGkumZuuiAheOBjOOBvuOBn+S4gOS6ulwiLFxuICAgICAgICAgICAgXCLjgYTjgb7jgaDopovjgazmpb3lnJLjgbjjga7pgZPjgavmjJHjgoLjgYbjgajjgZfjgabjgYTjgZ9cIixcbiAgICAgICAgXTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDogU0NfVyxcbiAgICAgICAgICAgIGhlaWdodDogU0NfSCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwxKVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwwLDAsMSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KVxuXG4gICAgICAgIC8v44Kk44Oh44O844K46KGo56S655So44Os44Kk44OkXG4gICAgICAgIHRoaXMuaW1hZ2VMYXllciA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMpO1xuXG4gICAgICAgIC8v44OV44Kp44Ki44Kw44Op44Km44Oz44OJXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5mZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC41KS5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgdGhpcy5mZy5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMuZmcub25wb2ludHN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhhdC5hbHJlYWR5TG9hZCB8fCB0aGF0LmxvYWRlciAmJiB0aGF0LmxvYWRlci5sb2FkY29tcGxldGUpIHRoYXQuZXhpdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/kuIrkuIvpu5LluK9cbiAgICAgICAgcGFyYW0uaGVpZ2h0ID0gU0NfSCAqIDAuMTU7XG4gICAgICAgIHRoaXMuYmcxID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjA3KVxuICAgICAgICB0aGlzLmJnMiA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC45MylcblxuICAgICAgICAvL+Wtl+W5lVxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogMTQsXG4gICAgICAgIH07XG4gICAgICAgIHZhciBudW0gPSAwO1xuICAgICAgICB0aGlzLnRleHRMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuOSk7XG4gICAgICAgIHRoaXMudGV4dExhYmVsLmFscGhhID0gMDtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHRMYWJlbC50ZXh0ID0gdGhpcy50ZXh0W251bV07XG4gICAgICAgICAgICAgICAgbnVtKys7XG4gICAgICAgICAgICAgICAgaWYgKG51bSA9PSB0aGlzLnRleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dExhYmVsLnR3ZWVuZXIuc2V0TG9vcChmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLmZhZGVJbig1MDApXG4gICAgICAgICAgICAud2FpdCgzMDAwKVxuICAgICAgICAgICAgLmZhZGVPdXQoNTAwKVxuICAgICAgICAgICAgLndhaXQoMTAwMClcbiAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuXG4gICAgICAgIC8v5Z+65pys44Ki44K744OD44OI44KS44Ot44O844OJXG4gICAgICAgIHRoaXMuYWxyZWFkeUxvYWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHFmdC5Bc3NldHMuaXNMb2FkZWQoXCJjb21tb25cIikpIHtcbiAgICAgICAgICAgIC8v6Kqt6L685riI44G/44Gq44Gu44Gn44K544Kt44OD44OXXG4gICAgICAgICAgICB0aGlzLmFscmVhZHlMb2FkID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBhc3NldHMgPSBxZnQuQXNzZXRzLmdldCh7YXNzZXRUeXBlOiBcImNvbW1vblwifSk7XG4gICAgICAgIHRoaXMubG9hZGVyID0gcGhpbmEuZXh0ZW5zaW9uLkFzc2V0TG9hZGVyRXgoKS5sb2FkKGFzc2V0cywgZnVuY3Rpb24oKXthcHAuc291bmRzZXQucmVhZEFzc2V0KCk7fSk7XG4gICAgICAgIHRoaXMubG9hZExhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJcIiwgYWxpZ246IFwicmlnaHRcIiwgZm9udFNpemU6IDEyfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjk5LCBTQ19IKjAuMSk7XG4gICAgICAgIHRoaXMubG9hZExhYmVsLnRpbWUgPSAxOyAgICBcbiAgICAgICAgdGhpcy5sb2FkTGFiZWwudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSBcIkxvYWRpbmcuLi4gXCIrTWF0aC5mbG9vcih0aGF0LmxvYWRlci5sb2FkcHJvZ3Jlc3MgKiAxMDApK1wiJVwiO1xuICAgICAgICAgICAgaWYgKHRoYXQubG9hZGVyLmxvYWRjb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiUHVzaCBidXR0b24gdG8gc2tpcC5cIjtcbiAgICAgICAgICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMjAgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudGltZSsrO1xuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5hbHJlYWR5TG9hZCB8fCB0aGlzLmxvYWRlciAmJiB0aGlzLmxvYWRlci5sb2FkY29tcGxldGUpIHtcbiAgICAgICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICAgICAgaWYgKGN0Lm9rIHx8IGN0LmNhbmNlbCkgdGhpcy5leGl0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zZXEgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy53b3JsZG1hcCgpO1xuICAgICAgICAgICAgdGhpcy5zZXErKztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZXEgPT0gMikge1xuICAgICAgICAgICAgdGhpcy50b3dlcmltYWdlKCk7XG4gICAgICAgICAgICB0aGlzLnNlcSsrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlcSA9PSA0KSB7XG4gICAgICAgICAgICB0aGlzLnNlcXVlbmNlMygpO1xuICAgICAgICAgICAgdGhpcy5zZXErKztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZXEgPT0gNikge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXJpbWFnZSgpO1xuICAgICAgICAgICAgdGhpcy5zZXErKztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZXEgPT0gOCkge1xuICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/kuJbnlYzlnLDlm7NcbiAgICB3b3JsZG1hcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzcHJpdGUxID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJvcGVuaW5nbWFwXCIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLmltYWdlTGF5ZXIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyAqIDAuNSwgLVNDX0ggKiAwLjI1KVxuICAgICAgICAgICAgLnNldFNjYWxlKDAuOClcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjApO1xuICAgICAgICBzcHJpdGUxLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmJ5KHthbHBoYTogMS4wLCB5OiAyMDB9LCA3MDAwKVxuICAgICAgICAgICAgLmJ5KHthbHBoYTogLTEuMCwgeTogMjAwfSwgNzAwMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc3ByaXRlMS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcSsrO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG4gICAgLy/loZTlpJboprNcbiAgICB0b3dlcmltYWdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNwcml0ZTEgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJhY2tncm91bmRcIikuYWRkQ2hpbGRUbyh0aGlzLmltYWdlTGF5ZXIpLnNldFBvc2l0aW9uKFNDX1cgKiAwLjUsIFNDX0ggKiAwLjUpO1xuICAgICAgICBzcHJpdGUxLmFscGhhID0gMDtcbiAgICAgICAgc3ByaXRlMS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc3ByaXRlMS5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5mZy5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5mZy50d2VlbmVyLmNsZWFyKCkuZmFkZU91dCg3MDAwKS5mYWRlSW4oNzAwMCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCgxNDAwMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc3ByaXRlMS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcSsrO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICB2YXIgc3ByaXRlMiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwib3BlbmluZ3Rvd2VyXCIpLmFkZENoaWxkVG8odGhpcy5pbWFnZUxheWVyKS5zZXRQb3NpdGlvbihTQ19XICogMC41LCBTQ19IICogMC4zKTtcbiAgICAgICAgc3ByaXRlMi5hbHBoYSA9IDA7XG4gICAgICAgIHNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNwcml0ZTIuYWxwaGEgPSAxO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLmJ5KHt4OiAtMTAwfSwgNDAwMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAud2FpdCgzMDAwKVxuICAgICAgICAgICAgLmJ5KHt5OiAzMDB9LCA3MDAwLCBcImVhc2VJblNpbmVcIilcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc3ByaXRlMi5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIC8v5LiJ55Wq55uu6KGo56S677yI5pqr5a6a77yJXG4gICAgc2VxdWVuY2UzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNwcml0ZTEgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm9wZW5pbmdiYWNrMlwiKS5hZGRDaGlsZFRvKHRoaXMuaW1hZ2VMYXllcikuc2V0UG9zaXRpb24oU0NfVyAqIDAuNSwgU0NfSCAqIDAuMykuc2V0U2NhbGUoMS4xKTtcbiAgICAgICAgc3ByaXRlMS5hbHBoYSA9IDA7XG4gICAgICAgIHNwcml0ZTEudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNwcml0ZTEuYWxwaGEgPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZmcuYWxwaGEgPSAxO1xuICAgICAgICAgICAgICAgIHRoaXMuZmcudHdlZW5lci5jbGVhcigpLmZhZGVPdXQoNzAwMCkud2FpdCgxMDAwMCkuZmFkZUluKDcwMDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLmJ5KHt5OiAxNTB9LCAxMjAwMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAud2FpdCgxMjAwMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc3ByaXRlMS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcSsrO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICB2YXIgc3ByaXRlMiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwib3BlbmluZ2xpZ2h0XCIpLmFkZENoaWxkVG8odGhpcy5pbWFnZUxheWVyKS5zZXRQb3NpdGlvbihTQ19XICogMC41LCBTQ19IICogMC41KTtcbiAgICAgICAgc3ByaXRlMi5ibGVuZE1vZGUgPSAnbGlnaHRlcic7XG4gICAgICAgIHNwcml0ZTIuYWxwaGEgPSAwLjM7XG4gICAgICAgIHNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgxMjAwMClcbiAgICAgICAgICAgIC5ieSh7eDogLTUwfSwgMTIwMDAsIFwiZWFzZUluT3V0U2luZVwiKTtcbiAgICB9LFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zooajnpLpcbiAgICBwbGF5ZXJpbWFnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzcHJpdGUxID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJvcGVuaW5nYmFja1wiKS5hZGRDaGlsZFRvKHRoaXMuaW1hZ2VMYXllcikuc2V0UG9zaXRpb24oU0NfVyAqIDAuNSwgU0NfSCAqIDAuMzUpLnNldFNjYWxlKDEuMik7XG4gICAgICAgIHNwcml0ZTEuYWxwaGEgPSAwO1xuICAgICAgICBzcHJpdGUxLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzcHJpdGUxLmFscGhhID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmZnLmFscGhhID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuY2xlYXIoKS5mYWRlT3V0KDcwMDApLndhaXQoNTAwMCkuZmFkZUluKDcwMDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoMTUwMDApXG4gICAgICAgICAgICAuYnkoe3k6IDE1MH0sIDUwMDAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzcHJpdGUxLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VxKys7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHZhciBzcHJpdGUyID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJvcGVuaW5nZ3JvdW5kXCIpLmFkZENoaWxkVG8odGhpcy5pbWFnZUxheWVyKS5zZXRQb3NpdGlvbihTQ19XICogMC41LCBTQ19IICogMC45KTtcbiAgICAgICAgc3ByaXRlMi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5ieSh7eTogLTUwfSwgNDAwMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAud2FpdCgxMDAwMClcbiAgICAgICAgICAgIC5ieSh7eTogMjAwfSwgNTAwMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG5cbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHNwcml0ZTIpLnNldFBvc2l0aW9uKDAsIDM4KTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzAwMClcbiAgICAgICAgICAgIC5ieSh7eTogLTc2fSwgNTAwMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cF9zdG9wXCIpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53YWl0KDYwMDApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJkb3duXCIpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5ieSh7eTogNzZ9LCA1MDAwLCBcImVhc2VJbk91dFNpbmVcIik7XG4gICAgfSxcbn0pO1xuXG4iLCIvKlxuICogIHByYWN0aWNlc2NlbmUuanNcbiAqICAyMDE3LzA0LzE1XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuIFxucGhpbmEuZGVmaW5lKFwicWZ0LkNvbmZpZ1NjZW5lX1ByYWN0aWNlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcblxuICAgICAgICB0aGlzLm1lbnVCYXNlID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMubWVudUJhc2UuYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLm1lbnVCYXNlLnR3ZWVuZXIuY2xlYXIoKS5mYWRlSW4oNTAwKTtcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDUsXG5cbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwidGl0bGVmb250MVwiLFxuICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICBiYXNlbGluZTogXCJtaWRkbGVcIixcbiAgICAgICAgICAgIGZvbnRTaXplOiA3MCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwxID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJQcmFjdGljZVwiLCBmb250U2l6ZTogMjB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjIpO1xuICAgICAgICB0aGlzLnRleHRMYWJlbDIgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlN0YWdlIHNlbGVjdFwiLCBmb250U2l6ZTogMjB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5tZW51QmFzZSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjMpO1xuXG4gICAgICAgIC8v44Oh44OL44Ol44O844OG44Kt44K544OI6KGo56S6XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5tZW51ID0gW1wiMVwiLCBcIjJcIiwgXCIzXCIsIFwiNFwiLCBcIjVcIiwgXCI2XCIsIFwiN1wiLCBcIjhcIiwgXCI5XCIsIFwiUFwiXTtcbiAgICAgICAgdGhpcy5tZW51VGV4dCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWVudS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFtpXSA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IHRoaXMubWVudVtpXSwgZm9udFNpemU6IDQwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSsoU0NfVyowLjA3KmkpLShTQ19XKjAuMDcqKHRoaXMubWVudS5sZW5ndGgtMSkvMiksIFNDX0gqMC41KVxuICAgICAgICAgICAgICAgIC5zZXRTY2FsZSgwLjcpO1xuXG4gICAgICAgICAgICAvL+OCv+ODg+ODgeWIpOWumueUqFxuICAgICAgICAgICAgdmFyIHBhcmFtMiA9IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogMzAsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBTQ19IKjAuMTAsXG4gICAgICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtMilcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLm1lbnVCYXNlKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSsoU0NfVyowLjA3KmkpLShTQ19XKjAuMDcqKHRoaXMubWVudS5sZW5ndGgtMSkvMiksIFNDX0gqMC41KVxuICAgICAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgICAgICAgIGMuYWxwaGEgPSAwO1xuICAgICAgICAgICAgYy5zZWxlY3QgPSBpO1xuICAgICAgICAgICAgYy5vbnBvaW50c3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhhdC5pc1NlbGVjdGVkIHx8IHRoYXQudGltZSA8IDEwKSByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ID09IHRoYXQuc2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQub2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LnZzZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5tZW51VGV4dFt0aGF0LnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZXhpdFRleHQudHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGF0LnNlbGVjdCA9IHRoaXMuc2VsZWN0O1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lm1lbnVUZXh0W3RoYXQuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LnZzZWxlY3QgPSAwO1xuICAgICAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZXhpdFRleHQgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIkV4aXRcIiwgZm9udFNpemU6IDQwfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC43KVxuICAgICAgICAgICAgLnNldFNjYWxlKDAuNyk7XG4gICAgICAgIC8v44K/44OD44OB5Yik5a6a55SoXG4gICAgICAgIHZhciBwYXJhbTIgPSB7XG4gICAgICAgICAgICB3aWR0aDogU0NfVyowLjMsXG4gICAgICAgICAgICBoZWlnaHQ6IFNDX0gqMC4xMCxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcInJnYmEoMCwxMDAsMjAwLDAuNSlcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtMilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMubWVudUJhc2UpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC43KVxuICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICBjLmFscGhhID0gMDtcbiAgICAgICAgYy5vbnBvaW50c3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGF0LmlzU2VsZWN0ZWQgfHwgdGhhdC50aW1lIDwgMTApIHJldHVybjtcbiAgICAgICAgICAgIGlmICh0aGF0LnZzZWxlY3QgPT0gMSkge1xuICAgICAgICAgICAgICAgIHRoYXQub2sgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGF0Lm1lbnVUZXh0W3RoYXQuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgICAgIHRoYXQuZXhpdFRleHQudHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICB0aGF0LnZzZWxlY3QgPSAxO1xuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnZzZWxlY3QgPSAwO1xuICAgICAgICB0aGlzLnNlbGVjdCA9IDA7XG4gICAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbGVjdE1heCA9IHRoaXMubWVudS5sZW5ndGg7XG4gICAgICAgIHRoaXMubWVudVRleHRbMF0uc2V0U2NhbGUoMSk7XG4gICAgICAgIHRoaXMub2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jYW5jZWwgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIHRoaXMub24oJ3Jlc3VtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5vayA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5jYW5zZWwgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICBpZiAoY3QucmlnaHQgJiYgIWN0LmJlZm9yZS5yaWdodCAmJiB0aGlzLnNlbGVjdCA8IHRoaXMuc2VsZWN0TWF4LTEgJiYgdGhpcy52c2VsZWN0ID09IDApIHtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdCsrO1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJzZWxlY3RcIik7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAxMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3QubGVmdCAmJiAhY3QuYmVmb3JlLmxlZnQgJiYgdGhpcy5zZWxlY3QgPiAwICAmJiB0aGlzLnZzZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0LS07XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDEwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdC5kb3duICYmICFjdC5iZWZvcmUuZG93biAmJiB0aGlzLnZzZWxlY3QgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy52c2VsZWN0Kys7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W3RoaXMuc2VsZWN0XS50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMC43LCBzY2FsZVk6IDAuN30sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgdGhpcy5leGl0VGV4dC50d2VlbmVyLmNsZWFyKCkudG8oe3NjYWxlWDogMS4wLCBzY2FsZVk6IDEuMH0sIDUwMCwgXCJlYXNlT3V0Qm91bmNlXCIpO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDEwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdC51cCAmJiAhY3QuYmVmb3JlLnVwICYmIHRoaXMudnNlbGVjdCA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnZzZWxlY3QtLTtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wfSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLmV4aXRUZXh0LnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMTA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy50aW1lID4gMTUpIHtcbiAgICAgICAgICAgIGlmIChjdC5vayB8fCB0aGlzLm9rKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5NYWluU2NlbmUoe3N0YXJ0U3RhZ2U6IDEsIGlzUHJhY3RpY2U6IHRydWV9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3QgPT0gOSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUocWZ0Lk1haW5TY2VuZSh7c3RhcnRTdGFnZTogOTk5LCBpc1ByYWN0aWNlOiB0cnVlfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlbGVjdCA9PSA4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuU2NlbmVGbG93LlJlc3VtZSh7c3RhZ2VOdW1iZXI6IDEwLCBpc1ByYWN0aWNlOiBmYWxzZX0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuU2NlbmVGbG93LlJlc3VtZSh7c3RhZ2VOdW1iZXI6IHRoaXMuc2VsZWN0KzEsIGlzUHJhY3RpY2U6IHRydWV9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYXBwLnN0b3BCR00oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudnNlbGVjdCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJjYW5jZWxcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhpdE1lbnUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdC5jYW5jZWwgfHwgdGhpcy5jYW5jZWwpIHtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiY2FuY2VsXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuZXhpdE1lbnUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudGltZSsrO1xuICAgIH0sXG5cbiAgICBleGl0TWVudTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMubWVudUJhc2UudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZU91dCg1MDApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuXG5waGluYS5kZWZpbmUoXCJxZnQuUHJhY3RpY2VQbGF0Zm9ybVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUoe1xuICAgICAgICAgICAgYXNzZXRUeXBlOiBcInN0YWdlMlwiLFxuICAgICAgICAgICAgc3RhcnRTdGFnZTogMixcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5jb3VudCA9IDA7XG4gICAgfSxcblxuICAgIG9uZW50ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5Mb2FkaW5nU2NlbmUoe1xuICAgICAgICAgICAgYXNzZXRzOiBxZnQuQXNzZXRzLmdldCh0aGlzLm9wdGlvbnMpLFxuICAgICAgICB9KSk7XG4gICAgfSxcblxuICAgIG9ucmVzdW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5jb3VudCsrO1xuICAgICAgICBpZiAodGhpcy5jb3VudCA9PSAxKSB7XG4gICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5NYWluU2NlbmUoe3N0YXJ0U3RhZ2U6IHRoaXMub3B0aW9ucy5zdGFydFN0YWdlLCBpc1ByYWN0aWNlOiB0cnVlfSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvdW50ID09IDIpe1xuICAgICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiIsIi8qXG4gKiAgU2NlbmVGbG93LmpzXG4gKiAgMjAxNi8xMi8yOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbi8v44Oh44Kk44Oz44K344O844Oz44OV44Ot44O8XG5waGluYS5kZWZpbmUoXCJxZnQuU2NlbmVGbG93XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmdhbWUuTWFuYWdlclNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICBzdGFydExhYmVsID0gb3B0aW9ucy5zdGFydExhYmVsIHx8IFwic3BsYXNoXCI7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHtcbiAgICAgICAgICAgIHN0YXJ0TGFiZWw6IHN0YXJ0TGFiZWwsXG4gICAgICAgICAgICBzY2VuZXM6IFt7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwic3BsYXNoXCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5TcGxhc2hTY2VuZVwiLFxuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwib3BlbmluZ1wiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuT3BlbmluZ1NjZW5lXCIsXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJ0aXRsZVwiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuVGl0bGVTY2VuZVwiLFxuICAgICAgICAgICAgICAgIG5leHRMYWJlbDogXCJvcGVuaW5nXCIsXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJtYWluXCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5NYWluU2NlbmVcIixcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRTdGFnZTogMSxcbiAgICAgICAgICAgICAgICAgICAgaXNQcmFjdGljZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBuZXh0TGFiZWw6IFwidGl0bGVcIixcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcImNvbnRpbnVlXCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5TY2VuZUZsb3cuUmVzdW1lXCIsXG4gICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgICAgIGlzUHJhY3RpY2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBpc0NvbnRpbnVlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbmV4dExhYmVsOiBcInRpdGxlXCIsXG4gICAgICAgICAgICB9LHtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJlbmRpbmdcIixcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicWZ0LkVuZGluZ1NjZW5lXCIsXG4gICAgICAgICAgICAgICAgbmV4dExhYmVsOiBcIm1haW5cIixcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcImNvbmZpZ1wiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuQ29uZmlnU2NlbmVcIixcbiAgICAgICAgICAgICAgICBuZXh0TGFiZWw6IFwidGl0bGVcIixcbiAgICAgICAgICAgIH0se1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcInByYWN0aWNlXCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5Db25maWdTY2VuZV9QcmFjdGljZVwiLFxuICAgICAgICAgICAgICAgIG5leHRMYWJlbDogXCJjb25maWdcIixcbiAgICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxuLy/lvqnluLDnlKhcbnBoaW5hLmRlZmluZShcInFmdC5TY2VuZUZsb3cuUmVzdW1lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmdhbWUuTWFuYWdlclNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUoe3N0YWdlTnVtYmVyOiAyLCBpc1ByYWN0aWNlOiBmYWxzZSwgaXNDb250aW51ZTogZmFsc2V9KTtcbiAgICAgICAgaWYgKG9wdGlvbnMuaXNDb250aW51ZSkge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInN0YWdlXCIpO1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IEpTT04ucGFyc2UoZGF0YSkuJHNhZmUoe1xuICAgICAgICAgICAgICAgICAgICBzdGFnZU51bWJlcjogMSxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0OiBbXSxcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyU3RhdHVzOiB7fSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnN0YWdlTnVtYmVyID0gZC5zdGFnZU51bWJlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5zdGFnZU51bWJlciA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHN0YXJ0TGFiZWwgPSBcInN0YXJ0XCI7XG4gICAgICAgIHZhciBhc3NldHMgPSBxZnQuQXNzZXRzLmdldCh7YXNzZXRUeXBlOiBcInN0YWdlXCIrb3B0aW9ucy5zdGFnZU51bWJlcn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdCh7XG4gICAgICAgICAgICBzdGFydExhYmVsOiBzdGFydExhYmVsLFxuICAgICAgICAgICAgc2NlbmVzOiBbe1xuICAgICAgICAgICAgICAgIGxhYmVsOiBcInN0YXJ0XCIsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInFmdC5Mb2FkaW5nU2NlbmVcIixcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXRzOiBhc3NldHMsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBuZXh0TGFiZWw6IFwibWFpblwiLFxuICAgICAgICAgICAgfSx7XG4gICAgICAgICAgICAgICAgbGFiZWw6IFwibWFpblwiLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJxZnQuTWFpblNjZW5lXCIsXG4gICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0U3RhZ2U6IG9wdGlvbnMuc3RhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIGlzUHJhY3RpY2U6IG9wdGlvbnMuaXNQcmFjdGljZSxcbiAgICAgICAgICAgICAgICAgICAgaXNDb250aW51ZTogb3B0aW9ucy5pc0NvbnRpbnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBvbmZpbmlzaDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZXhpdCgpO1xuICAgIH1cbn0pO1xuIiwiLypcbiAqICBzcGxhc2hzY2VuZS5qc1xuICogIDIwMTcvMDIvMDhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG5waGluYS5kZWZpbmUoJ3FmdC5TcGxhc2hTY2VuZScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmUnLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG5cbiAgICAgICAgdGhpcy51bmxvY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5sb2FkY29tcGxldGUxID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9hZGNvbXBsZXRlMiA9IGZhbHNlO1xuICAgICAgICB0aGlzLnByb2dyZXNzMSA9IDA7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3MyID0gMDtcblxuICAgICAgICAvL3ByZWxvYWQgYXNzZXRcbiAgICAgICAgdmFyIGFzc2V0cyA9IHFmdC5Bc3NldHMuZ2V0KHthc3NldFR5cGU6IFwic3BsYXNoXCJ9KTtcbiAgICAgICAgdGhpcy5sb2FkZXIgPSBwaGluYS5hc3NldC5Bc3NldExvYWRlcigpO1xuICAgICAgICB0aGlzLmxvYWRlci5sb2FkKGFzc2V0cyk7XG4gICAgICAgIHRoaXMubG9hZGVyLm9uKCdsb2FkJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkY29tcGxldGUxID0gdHJ1ZTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5sb2FkZXIub24oJ3Byb2dyZXNzJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5wcm9ncmVzczEgPSBNYXRoLmZsb29yKGUucHJvZ3Jlc3MqMTAwKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAvL3ByZWxvYWQgYXNzZXQyXG4gICAgICAgIHZhciBhc3NldHMgPSBxZnQuQXNzZXRzLmdldCh7YXNzZXRUeXBlOiBcInNwbGFzaDJcIn0pO1xuICAgICAgICB0aGlzLmxvYWRlcjIgPSBwaGluYS5hc3NldC5Bc3NldExvYWRlcigpO1xuICAgICAgICB0aGlzLmxvYWRlcjIubG9hZChhc3NldHMpO1xuICAgICAgICB0aGlzLmxvYWRlcjIub24oJ2xvYWQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRjb21wbGV0ZTIgPSB0cnVlO1xuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmxvYWRlcjIub24oJ3Byb2dyZXNzJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5wcm9ncmVzczIgPSBNYXRoLmZsb29yKGUucHJvZ3Jlc3MqMTAwKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAvL2xvZ29cbiAgICAgICAgdmFyIHRleHR1cmUgPSBwaGluYS5hc3NldC5UZXh0dXJlKCk7XG4gICAgICAgIHRleHR1cmUubG9hZChxZnQuU3BsYXNoU2NlbmUubG9nbykudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX2luaXQoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy50ZXh0dXJlID0gdGV4dHVyZTtcbiAgICB9LFxuXG4gICAgX2luaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKHRoaXMudGV4dHVyZSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy5ncmlkWC5jZW50ZXIoKSwgdGhpcy5ncmlkWS5jZW50ZXIoKSlcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5hbHBoYSA9IDA7XG5cbiAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAudG8oe2FscGhhOjF9LCA1MDAsICdlYXNlT3V0Q3ViaWMnKVxuICAgICAgICAgICAgLndhaXQoNTAwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51bmxvY2sgPSB0cnVlO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAvL+mAsuaNl+OCsuODvOOCuFxuICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAgU0NfVyowLjEsXG4gICAgICAgICAgICBoZWlnaHQ6IDMsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICBmaWxsOiAncmVkJyxcbiAgICAgICAgICAgIHN0cm9rZTogJ3doaXRlJyxcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuICAgICAgICAgICAgZ2F1Z2VDb2xvcjogJ2xpbWUnLFxuICAgICAgICAgICAgY29ybmVyUmFkaXVzOiAzLFxuICAgICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgICBtYXhWYWx1ZTogMTAwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnByb2dyZXNzR2F1Z2UgPSBwaGluYS51aS5HYXVnZShvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuOCk7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3NHYXVnZS5iZWZvcmVWYWx1ZSA9IDA7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3NHYXVnZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGF0LnByb2dyZXNzMSA9PSB0aGlzLmJlZm9yZVZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZSsrO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhhdC5wcm9ncmVzczE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmJlZm9yZVZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMudW5sb2NrICYmIHRoaXMubG9hZGNvbXBsZXRlMSAmJiB0aGlzLmxvYWRjb21wbGV0ZTIpIHtcbiAgICAgICAgICAgIHRoaXMudW5sb2NrID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAudG8oe2FscGhhOjB9LCA1MDAsICdlYXNlT3V0Q3ViaWMnKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3NHYXVnZS50d2VlbmVyLmNsZWFyKCkudG8oe2FscGhhOjB9LCAxMCwgJ2Vhc2VPdXRDdWJpYycpXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgICBsb2dvOiBcImFzc2V0cy9pbWFnZS9waGluYWpzX2xvZ28ucG5nXCIsXG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICB0aXRsZXNjZW5lLmpzXG4gKiAgMjAxNy8wMi8wOVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5UaXRsZVNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoe3dpZHRoOiBTQ19XLCBoZWlnaHQ6IFNDX0h9KTtcblxuICAgICAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODiVxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDpTQ19XLFxuICAgICAgICAgICAgaGVpZ2h0OlNDX0gsXG4gICAgICAgICAgICBmaWxsOiAnYmxhY2snLFxuICAgICAgICAgICAgc3Ryb2tlOiBmYWxzZSxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuYmcudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcblxuICAgICAgICB2YXIgc3ByaXRlMSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwidGl0bGViYWNrXCIpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVyAqIDAuNSwgU0NfSCAqIDAuNSk7XG4gICAgICAgIHNwcml0ZTEuYWxwaGEgPSAwO1xuICAgICAgICBzcHJpdGUxLnR3ZWVuZXIuY2xlYXIoKS5mYWRlSW4oNTAwKTtcblxuICAgICAgICAvL+OCv+OCpOODiOODq+ODreOCtOOBruihqOekulxuICAgICAgICB0aGlzLmRpc3BUaXRsZUxvZ28oKTtcblxuICAgICAgICAvL+ODoeODi+ODpeODvOOCouOCpOODhuODoOihqOekulxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogNSxcblxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJ0aXRsZWZvbnQyXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDMwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1lbnUgPSBbXCJTdGFydFwiLCBcIkNvbnRpbnVlXCIsIFwiQ29uZmlnXCJdO1xuICAgICAgICB0aGlzLm1lbnVDb21tZW50ID0gW1wi44Ky44O844Og44KS6ZaL5aeL44GX44G+44GZXCIsIFwi5YmN5Zue44Ky44O844Og44Kq44O844OQ44O844Gr44Gq44Gj44Gf44K544OG44O844K444Gu5pyA5Yid44GL44KJ6ZaL5aeL44GX44G+44GZXCIsIFwi6Kit5a6a44Oh44OL44Ol44O844KS6ZaL44GN44G+44GZXCJdO1xuICAgICAgICB0aGlzLm1lbnVUZXh0ID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tZW51Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLm1lbnVUZXh0W2ldID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogdGhpcy5tZW51W2ldfS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjYraSozMClcbiAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMC43KTtcblxuICAgICAgICAgICAgLy/jgr/jg4Pjg4HliKTlrprnlKhcbiAgICAgICAgICAgIHZhciBwYXJhbTIgPSB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IFNDX1cqMC4zLFxuICAgICAgICAgICAgICAgIGhlaWdodDogU0NfSCowLjA4LFxuICAgICAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDEwMCwyMDAsMC41KVwiLFxuICAgICAgICAgICAgICAgIHN0cm9rZTogXCJyZ2JhKDAsMTAwLDIwMCwwLjUpXCIsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBjID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbTIpXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oU0NfVyowLjUsIFNDX0gqMC42K2kqMzApXG4gICAgICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgICAgICAgYy5hbHBoYSA9IDA7XG4gICAgICAgICAgICBjLnNlbGVjdCA9IGk7XG4gICAgICAgICAgICBjLm9ucG9pbnRzdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LmlzU2VsZWN0ZWQgfHwgdGhhdC50aW1lIDwgMTApIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3QgPT0gdGhhdC5zZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5vayA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5tZW51VGV4dFt0aGF0LnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDAuNywgc2NhbGVZOiAwLjd9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zZWxlY3QgPSB0aGlzLnNlbGVjdDtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5tZW51VGV4dFt0aGF0LnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2VsZWN0ID0gMDtcbiAgICAgICAgdGhpcy5zZWxlY3RNYXggPSAzO1xuICAgICAgICB0aGlzLm1lbnVUZXh0WzBdLnNldFNjYWxlKDEpO1xuICAgICAgICB0aGlzLm9rID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2Fuc2VsID0gZmFsc2U7XG5cbiAgICAgICAgLy/jg6Hjg4vjg6Xjg7zjgrPjg6Hjg7Pjg4hcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLmNvbW1lbnQgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlwiLCBmb250U2l6ZTogMTB9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjkpO1xuICAgICAgICB0aGlzLmNvbW1lbnQudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSB0aGF0Lm1lbnVDb21tZW50W3RoYXQuc2VsZWN0XTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMuZmcudHdlZW5lci5jbGVhcigpLmZhZGVPdXQoMTUpO1xuXG4gICAgICAgIHRoaXMub24oJ3Jlc3VtZScsIGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5mZy50d2VlbmVyLmNsZWFyKCkuZmFkZU91dCgxNSk7XG4gICAgICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5pc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm9rID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmNhbnNlbCA9IGZhbHNlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICBpZiAodGhpcy5pc1NlbGVjdGVkKSByZXR1cm47XG5cbiAgICAgICAgdmFyIGN0ID0gYXBwLmNvbnRyb2xsZXI7XG4gICAgICAgIGlmIChjdC5kb3duICYmICFjdC5iZWZvcmUuZG93biAmJiB0aGlzLnNlbGVjdCA8IHRoaXMuc2VsZWN0TWF4LTEpIHtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdCsrO1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDEwO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3QudXAgJiYgIWN0LmJlZm9yZS51cCAmJiB0aGlzLnNlbGVjdCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMubWVudVRleHRbdGhpcy5zZWxlY3RdLnR3ZWVuZXIuY2xlYXIoKS50byh7c2NhbGVYOiAwLjcsIHNjYWxlWTogMC43fSwgNTAwLCBcImVhc2VPdXRCb3VuY2VcIik7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdC0tO1xuICAgICAgICAgICAgdGhpcy5tZW51VGV4dFt0aGlzLnNlbGVjdF0udHdlZW5lci5jbGVhcigpLnRvKHtzY2FsZVg6IDEuMCwgc2NhbGVZOiAxLjB9LCA1MDAsIFwiZWFzZU91dEJvdW5jZVwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDEwO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInNlbGVjdFwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50aW1lID4gMTUpIHtcbiAgICAgICAgICAgIGlmIChjdC5vayB8fCB0aGlzLm9rKXtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLnNlbGVjdCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAvL+mAmuW4uOmWi+Wni1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcIm9rXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mZy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmFkZUluKDMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhpdChcIm1haW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAvL+OCs+ODs+ODhuOCo+ODi+ODpeODvFxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcIm9rXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mZy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmFkZUluKDMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJzdGFnZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gSlNPTi5wYXJzZShkYXRhKS4kc2FmZSh7c3RhZ2VOdW1iZXI6IDF9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLnN0YWdlTnVtYmVyID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4aXQoXCJtYWluXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5TY2VuZUZsb3cuUmVzdW1lKHtpc1ByYWN0aWNlOiBmYWxzZSwgaXNDb250aW51ZTogdHJ1ZX0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhpdChcIm1haW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v6Kit5a6a44Oh44OL44Ol44O8XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHAucHVzaFNjZW5lKHFmdC5Db25maWdTY2VuZSh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3QuY2FuY2VsIHx8IHRoaXMuY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgYXBwLnB1c2hTY2VuZShxZnQuQ29uZmlnU2NlbmUodGhpcykpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50aW1lID4gMzAgKiAxMjApIHtcbiAgICAgICAgICAgIHRoaXMuZXhpdChcIm9wZW5pbmdcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcblxuICAgIC8v44K/44Kk44OI44Or44Ot44K06KGo56S6XG4gICAgZGlzcFRpdGxlTG9nbzogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgICB4ID0geCB8fCBTQ19XICogMC41O1xuICAgICAgICB5ID0geSB8fCBTQ19IICogMC40NTtcblxuICAgICAgICB2YXIgbGFiZWxQYXJhbSA9IHtcbiAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEwLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcInRpdGxlZm9udDFcIixcbiAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgYmFzZWxpbmU6IFwibWlkZGxlXCIsXG4gICAgICAgICAgICBmb250U2l6ZTogNjAsXG4gICAgICAgIH07XG4gICAgICAgIHZhciBudW0gPSAwO1xuICAgICAgICB0aGlzLnRleHRMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiVGhlXCIsIGZvbnRTaXplOiAzMH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbih4LTE4MiwgeS04NSk7XG4gICAgICAgIHRoaXMudGV4dExhYmVsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJRdWVzdFwifS4kc2FmZShsYWJlbFBhcmFtKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKHgtNDcsIHktODUpO1xuICAgICAgICB0aGlzLnRleHRMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiZm9yXCIsIGZvbnRTaXplOiA0MH0uJHNhZmUobGFiZWxQYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbih4LTE3LCB5LTQwKTtcbiAgICAgICAgdGhpcy50ZXh0TGFiZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlRhbmVsb3JuXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oeCs0OCwgeSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICB0dXRvcmlhbHNjZW5lLmpzXG4gKiAgMjAxNy8wNi8wMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cbiBcbnBoaW5hLmRlZmluZShcInFmdC5UdXRvcmlhbFNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXCIsXG5cbiAgICAvL+OCueOCr+ODquODvOODs+OBruODnuODg+ODl+WkluOBuOOBruenu+WLleWItumZkOODleODqeOCsFxuICAgIGxpbWl0V2lkdGg6IGZhbHNlLFxuICAgIGxpbWl0SGVpZ2h0OiB0cnVlLFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgrnjgq/jg6rjg7zjg7PkuK3lpK7lm7rlrprjg5Xjg6njgrBcbiAgICBjZW50ZXJQbGF5ZXI6IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHt3aWR0aDogU0NfVywgaGVpZ2h0OiBTQ19IfSk7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4lcbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6U0NfVyxcbiAgICAgICAgICAgIGhlaWdodDpTQ19ILFxuICAgICAgICAgICAgZmlsbDogJ2JsYWNrJyxcbiAgICAgICAgICAgIHN0cm9rZTogZmFsc2UsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmcgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHBhcmFtKVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihTQ19XKjAuNSwgU0NfSCowLjUpO1xuICAgICAgICB0aGlzLmJnLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG5cbiAgICAgICAgLy/og4zmma9cbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJhY2tncm91bmRcIikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbigwLCBTQ19IKjAuNSkuc2V0T3JpZ2luKDAsIDAuNSk7XG5cbiAgICAgICAgLy/nrqHnkIbnlKjln7rmupbjg6zjgqTjg6RcbiAgICAgICAgdGhpcy5iYXNlTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyh0aGlzKTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCreODo+ODqeOCr+OCv1xuICAgICAgICB0aGlzLnBsYXllciA9IHFmdC5QbGF5ZXIodGhpcyk7XG5cbiAgICAgICAvL+OCueOCr+ODquODvOODs+WIneacn+WMllxuICAgICAgICB0aGlzLnNldHVwU2NyZWVuKCk7XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgrjmg4XloLHliJ3mnJ/ljJZcbiAgICAgICAgdGhpcy5zZXR1cFN0YWdlKCk7XG5cbiAgICAgICAgdGhpcy5mZyA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuNSk7XG4gICAgICAgIHRoaXMuZmcudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKS5jbGVhcigpLmZhZGVPdXQoMzApO1xuXG4gICAgICAgIC8v44OQ44O844OB44Oj44Or44OR44OD44OJ44Gu5Y+v6KaW5YyWXG4vLyAgICAgICAgYXBwLnZpcnR1YWxQYWQuYWRkQ2hpbGRUbyh0aGlzKTtcblxuICAgICAgICBhcHAudm9sdW1lQkdNID0gMC41O1xuICAgICAgICBhcHAudm9sdW1lU0UgPSAwLjI7XG5cbiAgICAgICAgLy/jg6Hjg4Pjgrvjg7zjgrjooajnpLpcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDE2LFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLm1lc3NhZ2VTdGFjayA9IFtdO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZSA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6IFwiXCJ9LiRzYWZlKGxhYmVsUGFyYW0pKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDX1cqMC41LCBTQ19IKjAuMilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLmV2ZW50TWVzc2FnZS5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMuZXZlbnRNZXNzYWdlLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UubmV4dE9rID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5ldmVudE1lc3NhZ2UudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5uZXh0T2sgJiYgdGhhdC5tZXNzYWdlU3RhY2subGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMubmV4dE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9IHRoYXQubWVzc2FnZVN0YWNrWzBdO1xuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSBtc2cudGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAuZmFkZUluKDE1KS53YWl0KDkwKS5mYWRlT3V0KDE1KVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0T2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5tZXNzYWdlU3RhY2suc3BsaWNlKDAsIDEpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICBpZiAodGhpcy50aW1lID09IDE1KSB0aGlzLnBsYXllci5pc0NvbnRyb2wgPSB0cnVlO1xuXG4gICAgICAgIC8v44K544Kv44Oq44O844Oz6KGo56S65L2N572u44KS44OX44Os44Kk44Ok44O85Lit5b+D44Gr44Gq44KL5qeY44Gr6Kq/5pW0XG4gICAgICAgIGlmICh0aGlzLmNlbnRlclBsYXllcikge1xuICAgICAgICAgICAgdmFyIG1hcCA9IHRoaXMubWFwTGF5ZXIubWFwO1xuICAgICAgICAgICAgdGhpcy5tYXBMYXllci54ID0gU0NfVyowLjUtdGhpcy5wbGF5ZXIueDtcbiAgICAgICAgICAgIHRoaXMubWFwTGF5ZXIueSA9IFNDX0gqMC41LXRoaXMucGxheWVyLnk7XG4gICAgICAgICAgICBpZiAodGhpcy5saW1pdEhlaWdodCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hcExheWVyLnkgPiAwKSB0aGlzLm1hcExheWVyLnkgPSAwO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hcExheWVyLnkgPCAtKG1hcC5oZWlnaHQtU0NfSCkpIHRoaXMubWFwTGF5ZXIueSA9IC0obWFwLmhlaWdodC1TQ19IKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmxpbWl0V2lkdGgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXBMYXllci54ID4gMCkgdGhpcy5tYXBMYXllci54ID0gMDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXBMYXllci54IDwgLShtYXAud2lkdGgtU0NfVykpIHRoaXMubWFwTGF5ZXIueCA9IC0obWFwLndpZHRoLVNDX1cpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+OCueOCr+ODquODvOODs+W6p+aomVxuICAgICAgICAgICAgdGhpcy5zY3JlZW5YID0gLXRoaXMubWFwTGF5ZXIueDtcbiAgICAgICAgICAgIHRoaXMuc2NyZWVuWSA9IC10aGlzLm1hcExheWVyLnk7XG5cbiAgICAgICAgICAgIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJ44GuWOW6p+aomeOCkuWFqOS9k+OBruWJsuWQiOOBi+OCieioiOeul1xuICAgICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UueCA9IC1NYXRoLmZsb29yKHRoaXMuYmFja2dyb3VuZEltYWdlLndpZHRoICogKHRoaXMucGxheWVyLnggLyBtYXAud2lkdGgpKjAuMDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcblxuICAgIC8v5pW144Kt44Oj44Op44Kv44K/5oqV5YWlXG4gICAgc3Bhd25FbmVteTogZnVuY3Rpb24oeCwgeSwgbmFtZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gcWZ0LkVuZW15W25hbWVdKHRoaXMsIG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcy5lbmVteUxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICB9LFxuXG4gICAgLy/jgqLjgqTjg4bjg6DmipXlhaVcbiAgICBzcGF3bkl0ZW06IGZ1bmN0aW9uKHgsIHksIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHFmdC5JdGVtKHRoaXMsIG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcy5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgfSxcblxuICAgIC8v44Ki44Kk44OG44Og44Oc44OD44Kv44K55oqV5YWlXG4gICAgc3Bhd25JdGVtQm94OiBmdW5jdGlvbih4LCB5LCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBxZnQuSXRlbUJveCh0aGlzLCBvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgIH0sXG5cbiAgICAvL+OCqOODleOCp+OCr+ODiOaKleWFpVxuICAgIHNwYXduRWZmZWN0OiBmdW5jdGlvbih4LCB5LCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBxZnQuRWZmZWN0KHRoaXMsIG9wdGlvbnMpLmFkZENoaWxkVG8odGhpcy5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgfSxcblxuICAgIC8v44Oh44OD44K744O844K45oqV5YWlXG4gICAgc3Bhd25NZXNzYWdlOiBmdW5jdGlvbih0ZXh0LCBiZXR3ZWVuLCB3YWl0RnJhbWUpIHtcbiAgICAgICAgYmV0d2VlbiA9IGJldHdlZW4gfHwgMzI7XG4gICAgICAgIHdhaXRGcmFtZSA9IHdhaXRGcmFtZSB8fCAzMDtcbiAgICAgICAgdmFyIGFycmF5VGV4dCA9IHRleHQuc3BsaXQoXCJcIik7XG4gICAgICAgIHZhciBsYWJlbFBhcmFtID0ge1xuICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgc3Ryb2tlOiBcImJsdWVcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIk9yYml0cm9uXCIsXG4gICAgICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDMyLFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG4gPSAwO1xuICAgICAgICB2YXIgeCA9IFNDX1cgKiAwLjUgLSAoYXJyYXlUZXh0Lmxlbmd0aCAqIGJldHdlZW4gKiAwLjUpO1xuICAgICAgICBhcnJheVRleHQuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZSA9PSBcIiBcIikge1xuICAgICAgICAgICAgICAgIHggKz0gYmV0d2VlbjtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbGIgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBlfS4kc2FmZShsYWJlbFBhcmFtKSkuc2V0UG9zaXRpb24oeCwgU0NfSCowLjUrMzIpLnNldFNjYWxlKDAsIDEpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgICAgICBsYi50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAgICAgLndhaXQobilcbiAgICAgICAgICAgICAgICAudG8oe3NjYWxlWDogMS4wLCBhbHBoYTogMSwgeTogU0NfSCowLjV9LCAxNSwgXCJlYXNlT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgIC53YWl0KHdhaXRGcmFtZSlcbiAgICAgICAgICAgICAgICAudG8oe3NjYWxlWDogMC4wLCB5OiBTQ19IKjAuNS0zMn0sIDEwLCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXt0aGlzLnJlbW92ZSgpfS5iaW5kKGxiKSk7XG4gICAgICAgICAgICB4ICs9IGJldHdlZW47XG4gICAgICAgICAgICBuICs9IDU7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIC8v44Kk44OZ44Oz44OI44Oh44OD44K744O844K45oqV5YWlXG4gICAgc3Bhd25FdmVudE1lc3NhZ2U6IGZ1bmN0aW9uKGlkLCB0ZXh0KSB7XG4gICAgICAgIGlmICghaWQgfHwgIXRleHQpIHJldHVybjtcbiAgICAgICAgLy/jg6Hjg4Pjgrvjg7zjgrjjgrnjgr/jg4Pjgq/lhoXjgavlkIzkuIDvvKnvvKTjgYzjgYLjgovloLTlkIjjga/mipXlhaXjgZfjgarjgYRcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1lc3NhZ2VTdGFjay5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMubWVzc2FnZVN0YWNrW2ldLmlkID09IGlkKSByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRleHQgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgdGV4dC5mb3JFYWNoKGZ1bmN0aW9uKHN0cikge1xuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZVN0YWNrLnB1c2goe2lkOiBpZCwgdGV4dDogc3RyfSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlU3RhY2sucHVzaCh7aWQ6IGlkLCB0ZXh0OiB0ZXh0fSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/jgrnjgq/jg6rjg7zjg7PliJ3mnJ/ljJZcbiAgICBzZXR1cFNjcmVlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuXG4gICAgICAgICAgICBmb250RmFtaWx5OiBcIlVidW50dU1vbm9cIixcbiAgICAgICAgICAgIGFsaWduOiBcImxlZnRcIixcbiAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgZm9udFNpemU6IDIwLFxuICAgICAgICAgICAgZm9udFdlaWdodDogJydcbiAgICAgICAgfTtcblxuICAgICAgICAvL+S9k+WKm+OCsuODvOOCuFxuICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIkxJRkVcIn0uJHNhZmUobGFiZWxQYXJhbSkpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oMCwgMTApO1xuICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAgMjU2LFxuICAgICAgICAgICAgaGVpZ2h0OiA1LFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgZmlsbDogJ3JlZCcsXG4gICAgICAgICAgICBzdHJva2U6ICd3aGl0ZScsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcbiAgICAgICAgICAgIGdhdWdlQ29sb3I6ICdsaW1lJyxcbiAgICAgICAgICAgIGNvcm5lclJhZGl1czogMCxcbiAgICAgICAgICAgIHZhbHVlOiB0aGlzLnBsYXllci5ocCxcbiAgICAgICAgICAgIG1heFZhbHVlOiB0aGlzLnBsYXllci5ocCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5saWZlR2F1Z2UgPSBwaGluYS51aS5HYXVnZShvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMpLnNldE9yaWdpbigwLCAwLjUpLnNldFBvc2l0aW9uKDQwLCAxMCk7XG4gICAgICAgIHRoaXMubGlmZUdhdWdlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoYXQucGxheWVyLmhwO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8v44K544Kz44Ki6KGo56S6XG4gICAgICAgIHRoaXMuc2NvcmVMYWJlbCA9IHBoaW5hLmRpc3BsYXkuTGFiZWwoe3RleHQ6XCJTQ09SRTpcIiwgYWxpZ246IFwicmlnaHRcIn0uJHNhZmUobGFiZWxQYXJhbSkpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oU0NfVywgMTApO1xuICAgICAgICB0aGlzLnNjb3JlTGFiZWwuc2NvcmUgPSAwO1xuICAgICAgICB0aGlzLnNjb3JlTGFiZWwucyA9IDA7XG4gICAgICAgIHRoaXMuc2NvcmVMYWJlbC51cGRhdGUgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZS50aWNrZXIuZnJhbWUgJSAxMCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zID0gfn4oKHRoYXQudG90YWxTY29yZS10aGlzLnNjb3JlKS83KTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zIDwgMykgdGhpcy5zID0gMztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zID4gNzc3NykgdGhpcy5zID0gNzc3NztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2NvcmUgKz0gdGhpcy5zO1xuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcmUgPiB0aGF0LnRvdGFsU2NvcmUpIHRoaXMuc2NvcmUgPSB0aGF0LnRvdGFsU2NvcmU7XG5cbiAgICAgICAgICAgIHRoaXMudGV4dCA9IFwiU0NPUkUgXCIrdGhpcy5zY29yZS5jb21tYSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/liLbpmZDmmYLplpPooajnpLpcbiAgICAgICAgdmFyIHRsID0gcGhpbmEuZGlzcGxheS5MYWJlbCh7dGV4dDogXCJUSU1FOlwiLCBhbGlnbjogXCJyaWdodFwifS4kc2FmZShsYWJlbFBhcmFtKSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XLCAzMCk7XG4gICAgICAgIHRsLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gXCJUSU1FOlwiK01hdGguZmxvb3IodGhhdC50aW1lTGltaXQvMzApO1xuICAgICAgICAgICAgaWYgKHRoYXQudGltZUxpbWl0ID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGwgPSAncmVkJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxsID0gJ3doaXRlJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O86KOF5YKZ5q2m5Zmo6KGo56S6XG4gICAgICAgIHRoaXMucGxheWVyV2VhcG9uID0gcWZ0LlBsYXllcldlYXBvbih0aGlzLnBsYXllcikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbihTQ19XLTMwLCBTQ19ILTMwKTtcbiAgICB9LFxuXG4gICAgLy/jg57jg4Pjg5fmg4XloLHjga7liJ3mnJ/ljJZcbiAgICBzZXR1cFN0YWdlOiBmdW5jdGlvbigpIHtcblxuICAgICAgICB0aGlzLmJhc2VMYXllci5yZW1vdmVDaGlsZHJlbigpO1xuXG4gICAgICAgIHRoaXMuc3RhZ2VDb250cm9sbGVyID0gcWZ0LlN0YWdlOTk5KHRoaXMpO1xuICAgICAgICB0aGlzLnN3aXRjaE1hcCh0aGlzLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclswXSk7XG5cbiAgICAgICAgLy/ntYzpgY7mmYLplpPliJ3mnJ/ljJZcbiAgICAgICAgdGhpcy50aW1lID0gMDtcblxuICAgICAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiOioreWumlxuICAgICAgICB0aGlzLnRpbWVMaW1pdCA9IHRoaXMuc3RhZ2VDb250cm9sbGVyLnRpbWVMaW1pdDtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOioreWumlxuICAgICAgICB0aGlzLnBsYXllci5pc0NvbnRyb2wgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuaXNNdXRla2kgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wbGF5ZXIuYWxwaGEgPSAxLjA7XG5cbiAgICAgICAgdGhpcy5zdGFnZUNvbnRyb2xsZXIucGxheUJHTSgpO1xuICAgIH0sXG5cbiAgICAvL+ODnuODg+ODl+ODrOOCpOODpOOBruWIh+abv1xuICAgIHN3aXRjaE1hcDogZnVuY3Rpb24obGF5ZXIsIHgsIHkpIHtcbiAgICAgICAgaWYgKHRoaXMubWFwTGF5ZXIpIHRoaXMubWFwTGF5ZXIucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMubWFwTGF5ZXIgPSBsYXllcjtcbiAgICAgICAgdGhpcy5tYXBMYXllci5hZGRDaGlsZFRvKHRoaXMuYmFzZUxheWVyKTtcbiAgICAgICAgdGhpcy5tYXAgPSBsYXllci5tYXA7XG5cbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kTGF5ZXIgPSBsYXllci5iYWNrZ3JvdW5kTGF5ZXI7XG4gICAgICAgIHRoaXMuZm9yZWdyb3VuZExheWVyID0gbGF5ZXIuZm9yZWdyb3VuZExheWVyO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbkxheWVyID0gbGF5ZXIuY29sbGlzaW9uTGF5ZXI7XG4gICAgICAgIHRoaXMuZW5lbXlMYXllciA9IGxheWVyLmVuZW15TGF5ZXI7XG4gICAgICAgIHRoaXMucGxheWVyTGF5ZXIgPSBsYXllci5wbGF5ZXJMYXllcjtcbiAgICAgICAgdGhpcy5vYmpMYXllciA9IGxheWVyLm9iakxheWVyO1xuICAgICAgICB0aGlzLm1hcEltYWdlTGF5ZXIgPSBsYXllci5tYXBJbWFnZUxheWVyO1xuICAgICAgICB0aGlzLmVmZmVjdExheWVyID0gbGF5ZXIuZWZmZWN0TGF5ZXI7XG5cbiAgICAgICAgdGhpcy5wbGF5ZXIucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMucGxheWVyLmFkZENoaWxkVG8obGF5ZXIucGxheWVyTGF5ZXIpO1xuICAgICAgICBpZiAoeCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlMS5qc1xuICogIDIwMTcvMDEvMjRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K477yRXG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2UxXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDEsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjUsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ20xXCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2UxXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgMVwiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gdGhpcy5wbGF5ZXIua2V5cztcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoIDwgMSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlQnkoMTQsIC0zMiwgMTAwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTEwLmpzXG4gKiAgMjAxNy8wOS8xMFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqjjg7Pjg4fjgqPjg7PjgrDjgrfjg7zjg7NcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTEwXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDEwLFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo1LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiZW5kaW5nXCIsXG5cbiAgICAvL+eJueauiuOCueODhuODvOOCuOODleODqeOCsFxuICAgIGlzRW5kaW5nOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTEwXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOODgOODn+ODvOOCueODl+ODqeOCpOODiFxuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpXG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+mWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bkV2ZW50TWVzc2FnZSgxLCBcIkNvbmdyYXR1cmF0aW9ucyEhXCIpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuXG4gICAgICAgICAgICB0aGlzLnBsYXllci5zcGVlZCA9IDI7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5zcGVlZEFzY2VuZCA9IDI7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5pc0F1dG8gPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS51cCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDIyNCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnVwID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkucmlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+efs+eikeOBvuOBp1xuICAgICAgICB0aGlzLmFkZCgyNTUsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS5yaWdodCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuc2V0QWxwaGEoMCk7XG4gICAgICAgICAgICBwbC5hZGRDaGlsZFRvKHRoaXMubWFwTGF5ZXIucGxheWVyTGF5ZXIpO1xuICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSk7XG4gICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cF9zdG9wXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hZGQoMTIwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkucmlnaHQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuc2V0QWxwaGEoMS4wKTtcbiAgICAgICAgICAgIHBsLnJlbW92ZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+WFpeOCiuWPo+OBvuOBp1xuICAgICAgICB0aGlzLmFkZCgzMzAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS5yaWdodCA944CAZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLmF1dG9LZXkucmlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hZGQoMzAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS5yaWdodCA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hZGQoMzAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXIuYXV0b0tleS5yaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmFkZCgyMCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5hdXRvS2V5LnJpZ2h0ID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKS5zZXQoe2FscGhhOiAwfSkubW92ZUJ5KDAsIC02MDAsIDYwMCk7XG4gICAgICAgICAgICB0aGlzLnBsYXllci5ncmF2aXR5ID0gMDtcblxuICAgICAgICAgICAgcGwuYWRkQ2hpbGRUbyh0aGlzLm1hcExheWVyLnBsYXllckxheWVyKTtcbiAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpO1xuICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICBwbC50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKClcbiAgICAgICAgICAgICAgICAubW92ZUJ5KDAsIC02MDAsIDYwMClcbiAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcImRvd25cIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mZ1doaXRlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoMTIwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZhZGVJbigxMjApXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZShcImVuZGluZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZnLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoMTUwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZhZGVJbig2MCk7XG5cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5tb3ZlQnkoMCwgLTYwMCwgNjAwKTtcbiAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLnN0YWdlQ29udHJvbGxlci5maW5kT2JqZWN0KDE3LCAwLCBcImVuZW15XCIpO1xuICAgICAgICAgICAgb2JqLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5zdGFnZUNvbnRyb2xsZXIuZmluZE9iamVjdCgxNywgMCwgXCJlbmVteVwiKTtcbiAgICAgICAgICAgIG9iai50d2VlbmVyLmNsZWFyKCkubW92ZUJ5KDAsIC0zMDAsIDMwMCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2UxLmpzXG4gKiAgMjAxNy8wMS8yNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrjvvJFcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTJcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogMixcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNyxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbTJcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2UyXzFcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgMlwiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSB0aGlzLnBsYXllci5rZXlzO1xuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPCAyKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcikuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSkuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLm1vdmVUbyg0ODcsIDI3MSwgMTAwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTMuanNcbiAqICAyMDE3LzAzLzAxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuO+8kVxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlM1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiAzLFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCoxMCxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbTNcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2UzXzFcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTNfMlwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclsxXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlM18zXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzJdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDNcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gdGhpcy5wbGF5ZXIua2V5cztcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoIDwgMikgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlVG8oODYsIDI3MiwgMTAwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTQuanNcbiAqICAyMDE3LzAzLzA4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuO+8kVxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlNFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiA0LFxuXG4gICAgLy/jgr/jgqTjg6Djg6rjg5/jg4Pjg4hcbiAgICB0aW1lTGltaXQ6IEZQUyo2MCo3LFxuXG4gICAgLy9CR03jgqLjgrvjg4Pjg4jlkI1cbiAgICBiZ206IFwiYmdtNFwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIHRteCkge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgdG14KTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTRfMVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlNF8yXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzFdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDRcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouadoeS7tuWIpOWumlxuICAgIGNoZWNrU3RhZ2VDbGVhckNvbmRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gdGhpcy5wbGF5ZXIua2V5cztcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoIDwgMSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlVG8oMjkwMywgMTc2LCAxMDAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIHN0YWdlNS5qc1xuICogIDIwMTcvMDUvMTRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44K544OG44O844K477yRXG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2U1XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5TdGFnZUNvbnRyb2xsZXJcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDUsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjgsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ201XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgdG14KSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB0bXgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX5oOF5aCx6Kqt44G/6L6844G/XG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlNV8xXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzBdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U1XzJcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMV0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgNVwiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v6Y215Ye654++XG4gICAgICAgIHRoaXMuYWRkRXZlbnQoXCJrZXlcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIGt4ID0gMTE5NjtcbiAgICAgICAgICAgIHZhciBreSA9IDY4ODtcbiAgICAgICAgICAgIHZhciBrZXkgPSBxZnQuSXRlbSh0aGlzLnBhcmVudFNjZW5lLCB7cHJvcGVydGllczoge2tpbmQ6IFwia2V5XCJ9fSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLm9iakxheWVyKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihreCwga3kpO1xuICAgICAgICAgICAga2V5LnZ5ID0gLTU7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBhdXNlU2NlbmUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jZW50ZXJQbGF5ZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2FtZXJhLnNldFBvc2l0aW9uKHRoaXMucGFyZW50U2NlbmUucGxheWVyLngsIHRoaXMucGFyZW50U2NlbmUucGxheWVyLnkpO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJob2x5MVwiKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5tb3ZlVG8oa3gsIGt5LCAzMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVGcm9tLnggPSBreDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlRnJvbS55ID0ga3k7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVJhaW8gPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVMZXJwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlVG9QbGF5ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzLnBhcmVudFNjZW5lLmNhbWVyYSkpXG4gICAgICAgICAgICAgICAgLnRvKHttb3ZlUmF0aW86IDF9LCAzMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2VudGVyUGxheWVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTGVycCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzLnBhcmVudFNjZW5lLmNhbWVyYSkpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IHRoaXMucGxheWVyLmtleXM7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA8IDEpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKS5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KS5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkubW92ZVRvKDM0OTMrMTgsIDgwKzgwLCAxMDAwKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsLmFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCg1MDApO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjvvKLvvKfvvK3lho3nlJ9cbiAgICBwbGF5QkdNOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYXBwLnNldFZvbHVtZSh0aGlzLmJnbSwgMC41KTtcbiAgICAgICAgYXBwLnBsYXlCR00odGhpcy5iZ20pO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2U2LmpzXG4gKiAgMjAxNy8wNS8xNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg4bjg7zjgrjvvJFcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTZcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogNixcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNSxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbTZcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U2XzFcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlNl8yXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzFdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDZcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmJvc3NkZWFkMSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmJvc3NkZWFkMiA9IGZhbHNlO1xuXG4gICAgICAgIC8v44Oc44K577yR6KiO5LyQXG4gICAgICAgIHRoaXMuYWRkRXZlbnQoXCJib3NzZGVhZF8xXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYm9zc2RlYWQxID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLmJvc3NkZWFkMikgdGhpcy5maXJlRXZlbnQoXCJrZXlcIik7XG4gICAgICAgIH0pO1xuICAgICAgICAvL+ODnOOCue+8kuiojuS8kFxuICAgICAgICB0aGlzLmFkZEV2ZW50KFwiYm9zc2RlYWRfMlwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmJvc3NkZWFkMiA9IHRydWU7XG4gICAgICAgICAgICBpZiAodGhpcy5ib3NzZGVhZDEpIHRoaXMuZmlyZUV2ZW50KFwia2V5XCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+mNteWHuuePvlxuICAgICAgICB0aGlzLmFkZEV2ZW50KFwia2V5XCIsICgpID0+IHtcbiAgICAgICAgICAgIHZhciBreCA9IDM4NDtcbiAgICAgICAgICAgIHZhciBreSA9IDk0NDtcbiAgICAgICAgICAgIHZhciBrZXkgPSBxZnQuSXRlbSh0aGlzLnBhcmVudFNjZW5lLCB7cHJvcGVydGllczoge2tpbmQ6IFwia2V5XCJ9fSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLm9iakxheWVyKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihreCwga3kpO1xuICAgICAgICAgICAga2V5LnZ5ID0gLTU7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBhdXNlU2NlbmUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jZW50ZXJQbGF5ZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2FtZXJhLnNldFBvc2l0aW9uKHRoaXMucGFyZW50U2NlbmUucGxheWVyLngsIHRoaXMucGFyZW50U2NlbmUucGxheWVyLnkpO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJob2x5MVwiKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5tb3ZlVG8oa3gsIGt5LCAzMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVGcm9tLnggPSBreDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlRnJvbS55ID0ga3k7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVJhaW8gPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVMZXJwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlVG9QbGF5ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzLnBhcmVudFNjZW5lLmNhbWVyYSkpXG4gICAgICAgICAgICAgICAgLnRvKHttb3ZlUmF0aW86IDF9LCAzMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2VudGVyUGxheWVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTGVycCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzLnBhcmVudFNjZW5lLmNhbWVyYSkpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IHRoaXMucGxheWVyLmtleXM7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA8IDMpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKS5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KS5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkubW92ZVRvKDExOSArIDE444CALCA0NDggKyA4MCwgMTAwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTcuanNcbiAqICAyMDE3LzA3LzI2XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuDdcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTdcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogNixcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNSxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbTdcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U3XzFcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlN18yXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzFdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTdfM1wiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclsyXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOmWi+Wni+ODoeODg+OCu+ODvOOCuOaKleWFpVxuICAgICAgICAgICAgdGhpcy5zcGF3bk1lc3NhZ2UoXCJTVEFHRSA3XCIsIDI0KTtcblxuICAgICAgICAgICAgLy/jg57jg4Pjg5fooajnpLroqK3lrppcbiAgICAgICAgICAgIHRoaXMubGltaXRXaWR0aCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5hZGQoNjAsIGZ1bmN0aW9uKCkge1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IHRoaXMucGxheWVyLmtleXM7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA8IDEpIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5Yem55CGXG4gICAgc3RhZ2VDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHFmdC5QbGF5ZXJEdW1teShcInBsYXllcjFcIikuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKS5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIHRoaXMucGxheWVyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuc2V0KHthbHBoYTogMH0pXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRQb3NpdGlvbih0aGlzLnBsYXllci54LCB0aGlzLnBsYXllci55KS5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkubW92ZVRvKDE4MiArIDE4LCAyMDggKyA4MCwgMTAwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTguanNcbiAqICAyMDE3LzA3LzI2XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuDhcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZThcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogOCxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqOCxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbThcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U4XzFcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIHZhciB0bXggPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCd0bXgnLCBcInN0YWdlOF8yXCIpO1xuICAgICAgICB0aGlzLm1hcExheWVyWzFdID0gdGhpcy5jcmVhdGVNYXAodG14KTtcblxuICAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDhcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+mNteWHuuePvlxuICAgICAgICB0aGlzLmFkZEV2ZW50KFwia2V5XCIsICgpID0+IHtcbiAgICAgICAgICAgIHZhciBreCA9IDY3MDtcbiAgICAgICAgICAgIHZhciBreSA9IDg1MztcbiAgICAgICAgICAgIHZhciBrZXkgPSBxZnQuSXRlbSh0aGlzLnBhcmVudFNjZW5lLCB7cHJvcGVydGllczoge2tpbmQ6IFwia2V5XCJ9fSlcbiAgICAgICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLm9iakxheWVyKVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihreCwga3kpO1xuICAgICAgICAgICAga2V5LnZ5ID0gLTU7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBhdXNlU2NlbmUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jZW50ZXJQbGF5ZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2FtZXJhLnNldFBvc2l0aW9uKHRoaXMucGFyZW50U2NlbmUucGxheWVyLngsIHRoaXMucGFyZW50U2NlbmUucGxheWVyLnkpO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jYW1lcmEudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJob2x5MVwiKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5tb3ZlVG8oa3gsIGt5LCAzMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVGcm9tLnggPSBreDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlRnJvbS55ID0ga3k7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVJhaW8gPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVMZXJwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlVG9QbGF5ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzLnBhcmVudFNjZW5lLmNhbWVyYSkpXG4gICAgICAgICAgICAgICAgLnRvKHttb3ZlUmF0aW86IDF9LCAzMCwgXCJlYXNlSW5PdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuY2VudGVyUGxheWVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTGVycCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzLnBhcmVudFNjZW5lLmNhbWVyYSkpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLmnaHku7bliKTlrppcbiAgICBjaGVja1N0YWdlQ2xlYXJDb25kaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IHRoaXMucGxheWVyLmtleXM7XG4vLyAgICAgICAgaWYgKGtleXMubGVuZ3RoIDwgMSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLlh6bnkIZcbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUubWFwTGF5ZXIucGxheWVyTGF5ZXIpLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJjbGVhclwiKTtcbiAgICAgICAgdGhpcy5wbGF5ZXIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgzMClcbiAgICAgICAgICAgIC5zZXQoe2FscGhhOiAwfSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldFBvc2l0aW9uKHRoaXMucGxheWVyLngsIHRoaXMucGxheWVyLnkpLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgICAgICAgICAgcGwudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5tb3ZlVG8oNzg0KzE2LCAzMDQtMTYsIDUwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLm1vdmVUbyg3ODQrMTYsIC0zMiwgNTAwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTkuanNcbiAqICAyMDE3LzA3LzI2XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuDlcbnBoaW5hLmRlZmluZShcInFmdC5TdGFnZTlcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogOSxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNSxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImJnbTlcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2U5XzFcIik7XG4gICAgICAgIHRoaXMubWFwTGF5ZXJbMF0gPSB0aGlzLmNyZWF0ZU1hcCh0bXgpO1xuXG4gICAgICAgIC8v5Yid5pyf5Yem55CGXG4gICAgICAgIHRoaXMuYWRkKDEsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vjg6Hjg4Pjgrvjg7zjgrjmipXlhaVcbiAgICAgICAgICAgIHRoaXMuc3Bhd25NZXNzYWdlKFwiU1RBR0UgOVwiLCAyNCk7XG5cbiAgICAgICAgICAgIC8v44Oe44OD44OX6KGo56S66Kit5a6aXG4gICAgICAgICAgICB0aGlzLmxpbWl0V2lkdGggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5saW1pdEhlaWdodCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKDYwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K444Kv44Oq44Ki5p2h5Lu25Yik5a6aXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSB0aGlzLnBsYXllci5rZXlzO1xuICAgICAgICBpZiAoa2V5cy5sZW5ndGggPCAxKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouWHpueQhlxuICAgIHN0YWdlQ2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcikuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcImNsZWFyXCIpO1xuICAgICAgICB0aGlzLnBsYXllci50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLnNldCh7YWxwaGE6IDB9KVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0UG9zaXRpb24odGhpcy5wbGF5ZXIueCwgdGhpcy5wbGF5ZXIueSkuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLm1vdmVUbyg0ODcsIDI3MSwgMTAwMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoNTAwKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZTk5OS5qc1xuICogIDIwMTcvMDUvMDNcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44OG44K544OI44K544OG44O844K4XG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2U5OTlcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLFxuXG4gICAgLy/jgrnjg4bjg7zjgrjnlarlj7dcbiAgICBzdGFnZU51bWJlcjogMSxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lKTtcblxuICAgICAgICAvL+ODnuODg+ODl+aDheWgseiqreOBv+i+vOOBv1xuICAgICAgICB2YXIgdG14ID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgndG14JywgXCJzdGFnZTk5OVwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAvL+WIneacn+WHpueQhlxuICAgICAgICB0aGlzLmFkZCgxLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8v77yi77yn77yt5YaN55SfXG4gICAgICAgICAgICBhcHAucGxheUJHTShcImJnbTFcIik7XG5cbiAgICAgICAgICAgIC8v44K544OG44O844K46ZaL5aeL44Oh44OD44K744O844K45oqV5YWlXG4gICAgICAgICAgICB0aGlzLnNwYXduTWVzc2FnZShcIlNUQUdFIDFcIiwgMjQpO1xuXG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmxpbWl0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBzdGFnZWNvbnRyb2xsZXIuanNcbiAqICAyMDE3LzAxLzI0XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCueODhuODvOOCuOWItuW+oVxucGhpbmEuZGVmaW5lKFwicWZ0LlN0YWdlQ29udHJvbGxlclwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5hcHAuT2JqZWN0MkRcIixcblxuICAgIC8v44K544OG44O844K455Wq5Y+3XG4gICAgc3RhZ2VOdW1iZXI6IDAsXG5cbiAgICAvL+OCv+OCpOODoOODquODn+ODg+ODiFxuICAgIHRpbWVMaW1pdDogRlBTKjYwKjUsXG5cbiAgICAvL0JHTeOCouOCu+ODg+ODiOWQjVxuICAgIGJnbTogXCJiZ20xXCIsXG5cbiAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgIGxpbWl0V2lkdGg6IGZhbHNlLFxuICAgIGxpbWl0SGVpZ2h0OiB0cnVlLFxuXG4gICAgcGFyZW50U2NlbmU6IG51bGwsXG4gICAgbWFwTGF5ZXI6IG51bGwsXG4gICAgcGxheWVyOiBudWxsLFxuICAgIHRpbWU6IDAsXG5cbiAgICAvL+e1jOmBjuaZgumWk+ODiOODquOCrOOCpOODmeODs+ODiFxuICAgIHNlcTogbnVsbCxcbiAgICBpbmRleDogMCxcblxuICAgIC8v44Oe44OD44OX44OI44Oq44Ks44Kk44OZ44Oz44OIXG4gICAgZXZlbnQ6IG51bGwsXG5cbiAgICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODieioreWumlxuICAgIGlzQmFja2dyb3VuZE1vdmU6IHRydWUsXG4gICAgYmFja2dyb3VuZFg6IC0zMjAsXG5cbiAgICAvL+eJueauiuOCueODhuODvOOCuOODleODqeOCsFxuICAgIGlzT3BlbmluZzogZmFsc2UsXG4gICAgaXNUdXRvcmlhbDogZmFsc2UsXG4gICAgaXNFbmRpbmc6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgICB0aGlzLnBhcmVudFNjZW5lID0gcGFyZW50U2NlbmU7XG4gICAgICAgIHRoaXMubWFwTGF5ZXIgPSBbXTtcbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBwYXJlbnRTY2VuZS5wbGF5ZXI7XG5cbiAgICAgICAgdGhpcy5zZXEgPSBbXTtcbiAgICAgICAgdGhpcy5ldmVudCA9IFtdO1xuICAgIH0sXG5cbiAgICAvL+aZgumWk+OCpOODmeODs+ODiOi/veWKoFxuICAgIGFkZDogZnVuY3Rpb24odGltZSwgdmFsdWUsIG9wdGlvbikge1xuICAgICAgICB0aGlzLmluZGV4ICs9IHRpbWU7XG4gICAgICAgIHRoaXMuc2VxW3RoaXMuaW5kZXhdID0ge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgb3B0aW9uOiBvcHRpb24sXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8v5pmC6ZaT44Kk44OZ44Oz44OI5Y+W5b6XXG4gICAgZ2V0OiBmdW5jdGlvbih0aW1lKSB7XG4gICAgICAgIHZhciBkYXRhID0gdGhpcy5zZXFbdGltZV07XG4gICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9LFxuXG4gICAgLy/jg57jg4Pjg5fjgqTjg5njg7Pjg4jov73liqBcbiAgICBhZGRFdmVudDogZnVuY3Rpb24oaWQsIHZhbHVlLCBvcHRpb24pIHtcbiAgICAgICAgdGhpcy5ldmVudFtpZF0gPSB7XG4gICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICBvcHRpb246IG9wdGlvbixcbiAgICAgICAgICAgIGV4ZWN1dGVkOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLy/jg57jg4Pjg5fjgqTjg5njg7Pjg4jlj5blvpdcbiAgICBnZXRFdmVudDogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmV2ZW50W2lkXTtcbiAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgcmV0dXJuIG51bGw7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH0sXG5cbiAgICAvL+asoeOBq+OCpOODmeODs+ODiOOBjOeZuueUn+OBmeOCi+aZgumWk+OCkuWPluW+l1xuICAgIGdldE5leHRFdmVudFRpbWU6IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLnNlcVt0aW1lXTtcbiAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aW1lKzE7XG4gICAgICAgICAgICB2YXIgcnQgPSAtMTtcbiAgICAgICAgICAgIHRoaXMuc2VxLnNvbWUoZnVuY3Rpb24odmFsLCBpbmRleCl7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gdCkge1xuICAgICAgICAgICAgICAgICAgICBydCA9IGluZGV4O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LHRoaXMuc2VxKTtcbiAgICAgICAgICAgIHJldHVybiBydDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aW1lO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44Kk44OZ44Oz44OI55m654GrXG4gICAgZmlyZUV2ZW50OiBmdW5jdGlvbihldmVudE5hbWUpIHtcbiAgICAgICAgdmFyIGV2ZW50ID0gdGhpcy5ldmVudFtldmVudE5hbWVdO1xuICAgICAgICBpZiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnZhbHVlLmNhbGwoKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgY2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNlcSA9IFtdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgY2hlY2tTdGFnZUNsZWFyQ29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBzdGFnZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICB9LFxuXG4gICAgLy/jgrnjg4bjg7zjgrjvvKLvvKfvvK3lho3nlJ9cbiAgICBwbGF5QkdNOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYXBwLnBsYXlCR00odGhpcy5iZ20pO1xuICAgIH0sXG5cbiAgICAvL0lE44GL44KJ44Kq44OW44K444Kn44Kv44OI5qSc57SiXG4gICAgZmluZE9iamVjdDogZnVuY3Rpb24oaWQsIGxheWVyTnVtYmVyLCBsYXllck5hbWUpIHtcbiAgICAgICAgbGF5ZXJOdW1iZXIgPSBsYXllck51bWJlciB8fCAwO1xuICAgICAgICBsYXllck5hbWUgPSBsYXllck5hbWUgfHwgXCJvYmplY3RcIjtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG51bGw7XG4gICAgICAgIHN3aXRjaCAobGF5ZXJOYW1lKSB7XG4gICAgICAgICAgICBjYXNlIFwib2JqZWN0XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5tYXBMYXllcltsYXllck51bWJlcl0ub2JqTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmlkID09IGlkKSByZXN1bHQgPSBlO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZW5lbXlcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm1hcExheWVyW2xheWVyTnVtYmVyXS5lbmVteUxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5pZCA9PSBpZCkgcmVzdWx0ID0gZTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8vdG1444GL44KJ44Oe44OD44OX44Os44Kk44Ok44KS5L2c5oiQ44GZ44KLXG4gICAgY3JlYXRlTWFwOiBmdW5jdGlvbih0bXgpIHtcbiAgICAgICAgLy/jg57jg4Pjg5fjg6zjgqTjg6RcbiAgICAgICAgdmFyIG1hcExheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpO1xuXG4gICAgICAgIC8v44Oe44OD44OX55S75YOP55So44Os44Kk44OkXG4gICAgICAgIG1hcExheWVyLm1hcEltYWdlTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyhtYXBMYXllcik7XG5cbiAgICAgICAgLy/lnLDlvaLliKTlrprnlKjjg6zjgqTjg6RcbiAgICAgICAgbWFwTGF5ZXIuY29sbGlzaW9uTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyhtYXBMYXllcik7XG5cbiAgICAgICAgLy/jg5Djg4Pjgq/jgrDjg6njgqbjg7Pjg4njg6zjgqTjg6RcbiAgICAgICAgbWFwTGF5ZXIuYmFja2dyb3VuZExheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8obWFwTGF5ZXIpO1xuXG4gICAgICAgIC8v44Kq44OW44K444Kn44Kv44OI566h55CG44Os44Kk44OkXG4gICAgICAgIG1hcExheWVyLm9iakxheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8obWFwTGF5ZXIpO1xuXG4gICAgICAgIC8v5b2x6KGo56S644Os44Kk44OkXG4gICAgICAgIG1hcExheWVyLnNoYWRvd0xheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8obWFwTGF5ZXIpO1xuXG4gICAgICAgIC8v5pW144Kt44Oj44Op44Kv44K/566h55CG44Os44Kk44OkXG4gICAgICAgIG1hcExheWVyLmVuZW15TGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyhtYXBMYXllcik7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zooajnpLrjg6zjgqTjg6RcbiAgICAgICAgbWFwTGF5ZXIucGxheWVyTGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyhtYXBMYXllcik7XG5cbiAgICAgICAgLy/jgqjjg5Xjgqfjgq/jg4jnrqHnkIbjg6zjgqTjg6RcbiAgICAgICAgbWFwTGF5ZXIuZWZmZWN0TGF5ZXIgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KCkuYWRkQ2hpbGRUbyhtYXBMYXllcik7XG5cbiAgICAgICAgLy/jg5XjgqnjgqLjgrDjg6njgqbjg7Pjg4njg6zjgqTjg6RcbiAgICAgICAgbWFwTGF5ZXIuZm9yZWdyb3VuZExheWVyID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpLmFkZENoaWxkVG8obWFwTGF5ZXIpO1xuXG4gICAgICAgIC8v44Oe44OD44OX55S75YOP5Y+W5b6XXG4gICAgICAgIHZhciBtYXBJbWFnZSA9IHRteC5nZXRJbWFnZShcIm1hcFwiLCBcImJhY2tncm91bmRcIiwgXCJiYWNrZ3JvdW5kMlwiLCBcImJhY2tncm91bmQzXCIpO1xuICAgICAgICBtYXBMYXllci5tYXAgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShtYXBJbWFnZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5tYXBJbWFnZUxheWVyKS5zZXRPcmlnaW4oMCwgMCk7XG5cbiAgICAgICAgLy/jg5XjgqnjgqLjgrDjg6njgqbjg7Pjg4nnlLvlg49cbiAgICAgICAgdmFyIGZvcmVncm91bmQgPSB0bXguZ2V0SW1hZ2UoXCJmb3JlZ3JvdW5kXCIsIFwiZm9yZWdyb3VuZDJcIiwgXCJmb3JlZ3JvdW5kM1wiKTtcbiAgICAgICAgcGhpbmEuZGlzcGxheS5TcHJpdGUoZm9yZWdyb3VuZCkuYWRkQ2hpbGRUbyhtYXBMYXllci5mb3JlZ3JvdW5kTGF5ZXIpLnNldE9yaWdpbigwLCAwKTtcblxuICAgICAgICAvL+ODnuODg+ODl+W9k+OBn+OCiuWIpOWumuWPluW+l1xuICAgICAgICB2YXIgb2JqZWN0cyA9IHRteC5nZXRPYmplY3RHcm91cChcImNvbGxpc2lvblwiKS5vYmplY3RzO1xuICAgICAgICBvYmplY3RzLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyIHdpZHRoID0gZS53aWR0aCB8fCAxNjtcbiAgICAgICAgICAgIHZhciBoZWlnaHQgPSBlLmhlaWdodCB8fCAxNjtcbiAgICAgICAgICAgIHZhciBjID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodH0pXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8obWFwTGF5ZXIuY29sbGlzaW9uTGF5ZXIpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKGUueCt3aWR0aC8yLCBlLnkraGVpZ2h0LzIpXG4gICAgICAgICAgICAgICAgLnNldFZpc2libGUoREVCVUdfQ09MTElTSU9OKTtcbiAgICAgICAgICAgIGMub24oJ2VudGVyZnJhbWUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnggKz0gdGhpcy52eDtcbiAgICAgICAgICAgICAgICB0aGlzLnkgKz0gdGhpcy52eTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYy5pZCA9IGUuaWQ7XG4gICAgICAgICAgICBjLnZ4ID0gMDtcbiAgICAgICAgICAgIGMudnkgPSAwO1xuICAgICAgICAgICAgYy5hbHBoYSA9IDAuMztcbiAgICAgICAgICAgIGMuaWdub3JlID0gZmFsc2U7XG4gICAgICAgICAgICBjLmZyaWN0aW9uID0gZS5wcm9wZXJ0aWVzLmZyaWN0aW9uID09IHVuZGVmaW5lZD8gMC41OiBlLnByb3BlcnRpZXMuZnJpY3Rpb247XG4gICAgICAgICAgICBpZiAoZS5uYW1lKSBjLm5hbWUgPSBlLm5hbWU7XG4gICAgICAgICAgICBpZiAoZS50eXBlKSBjLnR5cGUgPSBlLnR5cGU7XG4gICAgICAgICAgICBjLiRleHRlbmQoZS5wcm9wZXJ0aWVzKTtcblxuICAgICAgICAgICAgLy/luLjmmYLlrp/ooYzjgrnjgq/jg6rjg5fjg4hcbiAgICAgICAgICAgIGlmIChjLnNjcmlwdCkge1xuICAgICAgICAgICAgICAgIHZhciBzYyA9IFwiKGZ1bmN0aW9uKGFwcCkge1wiK2Muc2NyaXB0K1wifSlcIjtcbiAgICAgICAgICAgICAgICB2YXIgZiA9IGV2YWwoc2MpO1xuICAgICAgICAgICAgICAgIGMub24oJ2VudGVyZnJhbWUnLCBmKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v5b2T44Gf44KK5Yik5a6a5pmC5a6f6KGM44K544Kv44Oq44OX44OIXG4gICAgICAgICAgICBpZiAoYy5jb2xsaXNpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgc2MgPSBcIihmdW5jdGlvbihlLCBkaXIpIHtcIitjLmNvbGxpc2lvbitcIn0pXCI7XG4gICAgICAgICAgICAgICAgYy5jb2xsaXNpb25TY3JpcHQgPSBldmFsKHNjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAvL+OCpOODmeODs+ODiOWPluW+l1xuICAgICAgICB2YXIgZXZlbnRzID0gdG14LmdldE9iamVjdEdyb3VwKFwiZXZlbnRcIikub2JqZWN0cztcbiAgICAgICAgZXZlbnRzLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIHggPSBlLnggKyAoZS53aWR0aCB8fCAxNikgLyAyO1xuICAgICAgICAgICAgdmFyIHkgPSBlLnkgKyAoZS5oZWlnaHQgfHwgMTYpIC8gMjtcbiAgICAgICAgICAgIHN3aXRjaCAoZS50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcInBsYXllclwiOlxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5uYW1lID09IFwic3RhcnRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWFwTGF5ZXIuc3RhcnRQb3NpdGlvbiA9IHt4OiB4LCB5OiB5fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLnggPSB4O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIueSA9IHk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucHJvcGVydGllcy5kaXJlY3Rpb24gPT0gMTgwKSB0aGlzLnBsYXllci5zY2FsZVggPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZW5lbXlcIjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHFmdC5FbmVteVtlLm5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZW5lbXkgPSBxZnQuRW5lbXlbZS5uYW1lXSh0aGlzLnBhcmVudFNjZW5lLCBlLnByb3BlcnRpZXMpLmFkZENoaWxkVG8obWFwTGF5ZXIuZW5lbXlMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5wcm9wZXJ0aWVzLmRlYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2MgPSBcIihmdW5jdGlvbihhcHApIHtcIitlLnByb3BlcnRpZXMuZGVhZCtcIn0pXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBldmFsKHNjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmVteS5vbignZGVhZCcsIGYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy/np7vli5Xjg5HjgrnoqK3lrppcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnByb3BlcnRpZXMucGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXRoID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSBlLnByb3BlcnRpZXMucGF0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRzW2ldLmlkID09IGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gZXZlbnRzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGgpIGVuZW15LnNldFBhdGgocGF0aCwgZS5wcm9wZXJ0aWVzLmxvb3AgfHwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwidW5rbm93biBlbmVteTogXCIrZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiaXRlbVwiOlxuICAgICAgICAgICAgICAgICAgICBxZnQuSXRlbSh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIml0ZW1ib3hcIjpcbiAgICAgICAgICAgICAgICAgICAgcWZ0Lkl0ZW1Cb3godGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkb29yXCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBkb29yID0gcWZ0Lk1hcE9iamVjdC5Eb29yKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5uYW1lID09IFwiY2xlYXJcIikgbWFwTGF5ZXIuY2xlYXJHYXRlID0gZG9vcjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUucHJvcGVydGllcy5zY3JpcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYyA9IFwiKGZ1bmN0aW9uKGFwcCkge1wiK2UucHJvcGVydGllcy5zY3JpcHQrXCJ9KVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBldmFsKHNjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvb3Iub24oJ2VudGVyZnJhbWUnLCBmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvb3Iuc3RhZ2VDb250cm9sbGVyID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvb3IucGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb29yLnBhcmVudFNjZW5lID0gdGhpcy5wYXJlbnRTY2VuZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiYmxvY2tcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrID0gcWZ0Lk1hcE9iamVjdC5CbG9jayh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgYmxvY2suYWRkQ29sbGlzaW9uKG1hcExheWVyLmNvbGxpc2lvbkxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImZsb29yXCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBmbG9vciA9IHFmdC5NYXBPYmplY3QuRmxvb3IodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGZsb29yLmFkZENvbGxpc2lvbihtYXBMYXllci5jb2xsaXNpb25MYXllcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnByb3BlcnRpZXMuc2NyaXB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2MgPSBcIihmdW5jdGlvbihhcHApIHtcIitlLnByb3BlcnRpZXMuc2NyaXB0K1wifSlcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZXZhbChzYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbG9vci5vbignZW50ZXJmcmFtZScsIGYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3Iuc3RhZ2VDb250cm9sbGVyID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb29yLnBsYXllciA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3IucGFyZW50U2NlbmUgPSB0aGlzLnBhcmVudFNjZW5lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v56e75YuV44OR44K56Kit5a6aXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXRoID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUucHJvcGVydGllcy5tb3ZlVHlwZSA9PSAncGF0aCcgJiYgZS5wcm9wZXJ0aWVzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IGUucHJvcGVydGllcy5wYXRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRzW2ldLmlkID09IGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBldmVudHNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3Iuc2V0UGF0aChwYXRoLngsIHBhdGgueSwgcGF0aC5wb2x5bGluZSwgZS5wcm9wZXJ0aWVzLmxvb3ApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjaGVja1wiOlxuICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0LkNoZWNrSWNvbih0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KS5zZXRBbmltYXRpb24oZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm1lc3NhZ2VcIjpcbiAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5NZXNzYWdlKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obWFwTGF5ZXIub2JqTGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZXZlbnRcIjpcbiAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5FdmVudCh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLm9iakxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImdhdGVcIjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdhdGUgPSBxZnQuTWFwT2JqZWN0LkdhdGUodGhpcy5wYXJlbnRTY2VuZSwgZSkuYWRkQ2hpbGRUbyhtYXBMYXllci5vYmpMYXllcikuc2V0UG9zaXRpb24oeCwgeSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnByb3BlcnRpZXMuc2NyaXB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2MgPSBcIihmdW5jdGlvbihhcHApIHtcIitlLnByb3BlcnRpZXMuc2NyaXB0K1wifSlcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZXZhbChzYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYXRlLm9uKCdlbnRlcmZyYW1lJywgZik7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYXRlLnN0YWdlQ29udHJvbGxlciA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYXRlLnBsYXllciA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2F0ZS5wYXJlbnRTY2VuZSA9IHRoaXMucGFyZW50U2NlbmU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImFjY2Vzc29yeVwiOlxuICAgICAgICAgICAgICAgICAgICB2YXIgbGF5ZXIgPSBlLnByb3BlcnRpZXMuZm9yZWdyb3VuZD8gbWFwTGF5ZXIuZm9yZWdyb3VuZExheWVyOiBtYXBMYXllci5iYWNrZ3JvdW5kTGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibGFtcFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFmdC5NYXBPYmplY3QuTGFtcCh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKGxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJib25maXJlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5Cb25maXJlKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImZsYW1lXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5GbGFtZSh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKGxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJjYW5kbGVcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0LkNhbmRsZSh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKGxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJsYW50aGFudW1cIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0LkxhbnRoYW51bSh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKGxheWVyKS5zZXRQb3NpdGlvbih4LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJjYW5kbGVsYW1wXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcWZ0Lk1hcE9iamVjdC5DYW5kbGVMYW1wKHRoaXMucGFyZW50U2NlbmUsIGUpLmFkZENoaWxkVG8obGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJ1bmtub3duIG1hcCBhY2Nlc3Nvcnk6IFwiK2UubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm5wY1wiOlxuICAgICAgICAgICAgICAgICAgICBxZnQuTWFwT2JqZWN0Lm5wYyh0aGlzLnBhcmVudFNjZW5lLCBlKS5hZGRDaGlsZFRvKG1hcExheWVyLmVuZW15TGF5ZXIpLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwicGF0aFwiOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJ1bmtub3duIG1hcCBvYmplY3QgaWQ6W1wiICsgZS5pZCArIFwiXSB0eXBlOltcIiArIGUudHlwZSArIFwiXSBuYW1lOltcIiArIGUubmFtZSArIFwiXVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgcmV0dXJuIG1hcExheWVyO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgc3RhZ2UxMC5qc1xuICogIDIwMTcvMDkvMTBcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Ko44Oz44OH44Kj44Oz44Kw44K344O844OzXG5waGluYS5kZWZpbmUoXCJxZnQuU3RhZ2UxMFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuU3RhZ2VDb250cm9sbGVyXCIsXG5cbiAgICAvL+OCueODhuODvOOCuOeVquWPt1xuICAgIHN0YWdlTnVtYmVyOiAxMCxcblxuICAgIC8v44K/44Kk44Og44Oq44Of44OD44OIXG4gICAgdGltZUxpbWl0OiBGUFMqNjAqNSxcblxuICAgIC8vQkdN44Ki44K744OD44OI5ZCNXG4gICAgYmdtOiBcImVuZGluZ1wiLFxuXG4gICAgLy/nibnmrorjgrnjg4bjg7zjgrjjg5Xjg6njgrBcbiAgICBpc0VuZGluZzogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCB0bXgpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHRteCk7XG5cbiAgICAgICAgLy/jg57jg4Pjg5fmg4XloLHoqq3jgb/ovrzjgb9cbiAgICAgICAgdmFyIHRteCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3RteCcsIFwic3RhZ2UxMFwiKTtcbiAgICAgICAgdGhpcy5tYXBMYXllclswXSA9IHRoaXMuY3JlYXRlTWFwKHRteCk7XG5cbiAgICAgICAgLy/liJ3mnJ/lh6bnkIZcbiAgICAgICAgdGhpcy5hZGQoMSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+ODnuODg+ODl+ihqOekuuioreWumlxuICAgICAgICAgICAgdGhpcy5saW1pdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubGltaXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCg2MCwgZnVuY3Rpb24oKSB7XG4gICAgICAgIH0pO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgYmFsbG9vbi5qc1xuICogIDIwMTcvMDQvMjZcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5CYWxsb29uXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuU3ByaXRlXCIsXG5cbiAgICAvL+Wvv+WRveODleODrOODvOODoFxuICAgIGxpZmVTcGFuOiAzMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDYsXG5cblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoXCJiYWxsb29uXCIsIDI0LCAzMik7XG5cbiAgICAgICAgdGhpcy5wYXR0ZXJuID0gb3B0aW9ucy5wYXR0ZXJuIHx8IFwiIVwiO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbih0aGlzLnBhdHRlcm4pO1xuXG4gICAgICAgIHRoaXMubGlmZVNwYW4gPSBvcHRpb25zLmxpZmVTcGFuIHx8IDYwO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gb3B0aW9ucy5hbmltYXRpb25JbnRlcnZhbCB8fCA2O1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIC8v54m55q6K44OR44K/44O844OzXG4gICAgICAgIGlmICh0aGlzLnBhdHRlcm4gPT0gXCJhbmdlcjJcIikge1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKCkuYnkoe3k6IC0xNiwgYWxwaGE6IC0xfSwgdGhpcy5hbmltYXRpb25JbnRlcnZhbCwgXCJlYXNlSW5TaW5lXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZSA6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy50aW1lICUgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9PSAwKSB0aGlzLmZyYW1lSW5kZXgrKztcblxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IHRoaXMubGlmZVNwYW4pIHRoaXMucmVtb3ZlKCk7XG4gICAgfSxcblxuICAgIHNldEFuaW1hdGlvbjogZnVuY3Rpb24ocGF0dGVybikge1xuICAgICAgICBzd2l0Y2ggKHBhdHRlcm4pIHtcbiAgICAgICAgICAgIGNhc2UgXCIuLi5cIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgMjQsIDEyOCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiP1wiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZyg5NiwgMzIsIDI0LCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiIVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZyg3MiwgNjQsIDcyLCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwienp6XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDAsIDAsIDI0LCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic3R1blwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZygxNDQsIDMyLCA0OCwgMzIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImxpZ2h0XCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDE0NCwgNjQsIDQ4LCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibmV3dHlwZVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVUcmltbWluZygxNDQsIDk2LCA3MiwgMzIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImFuZ2VyXCI6XG4gICAgICAgICAgICBjYXNlIFwiYW5nZXIxXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRGcmFtZVRyaW1taW5nKDcyLCA5NiwgMjQsIDMyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJhbmdlcjJcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNldEZyYW1lVHJpbW1pbmcoMTQ0LCAxMjgsIDcyLCAzMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGNoYXJhY3Rlci5qc1xuICogIDIwMTYvMTIvMjhcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5DaGFyYWN0ZXJcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgLy/jg57jg4Pjg5fjgqrjg5bjgrjjgqfjgq/jg4hJRFxuICAgIGlkOiAtMSxcblxuICAgIC8v5Yqg6YCf5bqmXG4gICAgdng6IDAsXG4gICAgdnk6IDAsXG5cbiAgICAvL+WIneacn+W6p+aomVxuICAgIGZpcnN0WDogMCxcbiAgICBmaXJzdFk6IDAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAuOSxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAuNSxcblxuICAgIC8v5bqK56e75YuV5rib6KGw546HXG4gICAgZmxvb3JGcmljdGlvbjogMC41LFxuXG4gICAgLy/lj43nmbrkv4LmlbBcbiAgICByZWJvdW5kOiAwLFxuXG4gICAgLy/jgrjjg6Pjg7Pjg5fkuK3jg5Xjg6njgrBcbiAgICBpc0p1bXA6IGZhbHNlLFxuXG4gICAgLy/jgrnjg6vjg7zjgZfjgZ/jg5Xjg63jgqJcbiAgICB0aHJvdWdoRmxvb3I6IG51bGwsXG5cbiAgICAvL+W6iuS4iuODleODqeOCsFxuICAgIGlzT25GbG9vcjogZmFsc2UsXG5cbiAgICAvL+S5l+OBo+OBpuOBhOOCi+OCquODluOCuOOCp+OCr+ODiFxuICAgIGZsb29yT2JqZWN0OiBudWxsLFxuXG4gICAgLy/jga/jgZfjgZTkuIrjg5Xjg6njgrBcbiAgICBpc09uTGFkZGVyOiBmYWxzZSxcblxuICAgIC8v6ZqO5q615LiK44OV44Op44KwXG4gICAgaXNPblN0YWlyczogZmFsc2UsXG5cbiAgICAvL+OBr+OBl+OBlOaOtOOBv+ODleODqeOCsFxuICAgIGlzQ2F0Y2hMYWRkZXI6IGZhbHNlLFxuXG4gICAgLy/mrbvkuqHjg5Xjg6njgrBcbiAgICBpc0RlYWQ6IGZhbHNlLFxuXG4gICAgLy/okL3kuIvmrbvkuqHjg5Xjg6njgrBcbiAgICBpc0Ryb3A6IGZhbHNlLFxuXG4gICAgLy/msJfntbbjg5Xjg6njgrBcbiAgICBpc1N0dW46IGZhbHNlLFxuXG4gICAgLy/mk43kvZzlgZzmraLmmYLplpNcbiAgICBzdG9wVGltZTogMCxcblxuICAgIC8v54Sh5pW144OV44Op44KwXG4gICAgaXNNdXRla2k6IGZhbHNlLFxuXG4gICAgLy/nhKHmlbXmmYLplpNcbiAgICBtdXRla2lUaW1lOiAwLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7Pjg5Xjg6njgrBcbiAgICBpc0FuaW1hdGlvbjogdHJ1ZSxcblxuICAgIC8v54++5Zyo5a6f6KGM5Lit44Ki44Kv44K344On44OzXG4gICAgbm93QW5pbWF0aW9uOiBcInN0YW5kXCIsXG5cbiAgICAvL+WJjeODleODrOODvOODoOWun+ihjOOCouOCr+OCt+ODp+ODs1xuICAgIGJlZm9yZUFuaW1hdGlvbjogXCJcIixcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6YCy6KGM5Y+v6IO944OV44Op44KwXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiB0cnVlLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PlpInmm7TmpJznn6Xjg5Xjg6njgrBcbiAgICBpc0NoYW5nZUFuaW1hdGlvbjogZmFsc2UsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiA2LFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IGZhbHNlLFxuXG4gICAgLy/jgrnjgq/jg6rjg7zjg7PlhoXjg5Xjg6njgrBcbiAgICBvblNjcmVlbjogZmFsc2UsXG5cbiAgICAvL+a0u+WLleODleODqeOCsFxuICAgIGlzQWN0aXZlOiB0cnVlLFxuXG4gICAgLy/lvbHooajnpLpcbiAgICBpc1NoYWRvdzogZmFsc2UsXG4gICAgc2hhZG93WTogMCxcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNQbGF5ZXI6IGZhbHNlLFxuICAgIGlzRW5lbXk6IGZhbHNlLFxuICAgIGlzSXRlbUJveDogZmFsc2UsXG4gICAgaXNJdGVtOiBmYWxzZSxcbiAgICBpc0Jsb2NrOiBmYWxzZSxcbiAgICBpc01hcEFjY2Vzc29yeTogZmFsc2UsXG5cbiAgICAvL+e1jOmBjuODleODrOODvOODoFxuICAgIHRpbWU6IDAsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuICAgICAgICB0aGlzLmJvdW5kaW5nVHlwZSA9IFwicmVjdFwiO1xuICAgICAgICB0aGlzLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG5cbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgdGhpcy5zZXR1cEFuaW1hdGlvbigpO1xuXG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkIHx8IC0xO1xuXG4gICAgICAgIC8v5b2T44Gf44KK5Yik5a6a5oOF5aCx5Yid5pyf5YyWXG4gICAgICAgIGlmICghdGhpcy5pc01hcEFjY2Vzc29yeSkgdGhpcy5pbml0Q29sbGlzaW9uKG9wdGlvbnMpO1xuXG4gICAgICAgIC8v5ZC544GN5Ye644GXXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5iYWxsb29uID0gbnVsbDtcbiAgICAgICAgdGhpcy5sYXN0QmFsbG9vbiA9IFwiXCI7XG4gICAgICAgIHRoaXMuYmFsbG9vblRpbWUgPSAwO1xuICAgICAgICB0aGlzLm9uKCdiYWxsb29uJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1N0dW4pIHJldHVybjtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgPiB0aGlzLmJhbGxvb25UaW1lKSB0aGlzLmxhc3RCYWxsb29uID0gXCJcIjtcbiAgICAgICAgICAgIGlmICh0aGlzLmxhc3RCYWxsb29uUGF0dGVybiA9PSBlLnBhdHRlcm4gJiYgIWUuZm9yY2UpIHJldHVybjtcbiAgICAgICAgICAgIGlmICh0aGlzLmJhbGxvb24pIHRoaXMuYmFsbG9vbi5yZW1vdmUoKTtcbiAgICAgICAgICAgIGUuJHNhZmUoe3g6IDAsIHk6IC10aGlzLmhlaWdodC8yLTEwfSk7XG4gICAgICAgICAgICB0aGlzLmJhbGxvb24gPSBxZnQuQmFsbG9vbih7cGF0dGVybjogZS5wYXR0ZXJuLCBsaWZlU3BhbjogZS5saWZlU3BhbiwgYW5pbWF0aW9uSW50ZXJ2YWw6IGUuYW5pbWF0aW9uSW50ZXJ2YWx9KVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKGUueCwgZS55KTtcbiAgICAgICAgICAgIHRoaXMuYmFsbG9vbi5vbigncmVtb3ZlZCcsIGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoYXQuYmFsbG9vbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhhdC5mbGFyZSgnYmFsbG9vbmVuZCcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmxhc3RCYWxsb29uUGF0dGVybiA9IGUucGF0dGVybjtcbiAgICAgICAgICAgIHRoaXMuYmFsbG9vblRpbWUgPSB0aGlzLnRpbWUgKyAxMjA7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm9uKCdiYWxsb29uZXJhY2UnLCBlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJhbGxvb24gPT0gbnVsbCkgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5iYWxsb29uLnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy5iYWxsb29uID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuYmFsbG9vblRpbWUgPSAwO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL+awl+e1tueKtuaFi1xuICAgICAgICB0aGlzLm9uKCdzdHVuJywgZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzU3R1biA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gZS5wb3dlciAqIDEwO1xuICAgICAgICAgICAgdGhpcy5iYWxsb29uID0gcWZ0LkJhbGxvb24oe3BhdHRlcm46IFwic3R1blwiLCBsaWZlU3BhbjogdGhpcy5zdG9wVGltZX0pXG4gICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oMCwgLXRoaXMuaGVpZ2h0LzItMTApO1xuICAgICAgICAgICAgdGhpcy5sYXN0QmFsbG9vbiA9IGUucGF0dGVybjtcbiAgICAgICAgICAgIHRoaXMuYmFsbG9vblRpbWUgPSB0aGlzLnRpbWUgKyAxMjA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMub24oJ2VudGVyZnJhbWUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnRTY2VuZS5wYXVzZVNjZW5lKSByZXR1cm47XG5cbiAgICAgICAgICAgIC8v5Yid5pyf5bqn5qiZ44Gu6KiY6Yyy44Go5Yid5Zue44OV44Os44O844Og5Yem55CGXG4gICAgICAgICAgICBpZiAodGhpcy50aW1lID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0WCA9IHRoaXMueDtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0WSA9IHRoaXMueTtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0RnJhbWUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/nlLvpnaLlhoXliKTlrppcbiAgICAgICAgICAgIHZhciBwcyA9IHRoaXMucGFyZW50U2NlbmU7XG4gICAgICAgICAgICBpZiAocHMuc2NyZWVuWC1TQ19XIDwgdGhpcy54ICYmIHRoaXMueCA8IHBzLnNjcmVlblggKyBTQ19XKjIgJiYgXG4gICAgICAgICAgICAgICAgcHMuc2NyZWVuWS1TQ19IIDwgdGhpcy55ICYmIHRoaXMueSA8IHBzLnNjcmVlblkgKyBTQ19IKjIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uU2NyZWVuID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vblNjcmVlbiA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/nlLvpnaLlpJbjga7loLTlkIjjga/li5XkvZzlgZzmraJcbi8vICAgICAgICAgICAgaWYgKCF0aGlzLm9uU2NyZWVuKSByZXR1cm47XG5cbiAgICAgICAgICAgIC8v5rS75YuV44OV44Op44KwXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNBY3RpdmUpIHJldHVybjtcblxuICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMudng7XG4gICAgICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IHRoaXMuZmxvb3JGcmljdGlvbjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCAqPSB0aGlzLmZyaWN0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0NhdGNoTGFkZGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy55ICs9IHRoaXMudnk7XG4gICAgICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMueSArPSB0aGlzLnZ5O1xuICAgICAgICAgICAgICAgIHRoaXMudnkgKz0gdGhpcy5ncmF2aXR5O1xuICAgICAgICAgICAgICAgIC8v6JC95LiL6YCf5bqm5LiK6ZmQXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudnkgPiAyMCkgdGhpcy52eSA9IDIwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKE1hdGguYWJzKHRoaXMudngpIDwgMC4wMSkgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICBpZiAoTWF0aC5hYnModGhpcy52eSkgPCAwLjAxKSB0aGlzLnZ5ID0gMDtcblxuICAgICAgICAgICAgLy/lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIGlmICghdGhpcy5pc01hcEFjY2Vzc29yeSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tNYXBDb2xsaXNpb24oKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/nlLvpnaLlpJbokL3jgaFcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0RlYWQgJiYgdGhpcy55ID4gdGhpcy5wYXJlbnQucGFyZW50Lm1hcC5oZWlnaHQpIHRoaXMuZHJvcERlYWQoKTtcblxuICAgICAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7NcbiAgICAgICAgICAgIGlmICh0aGlzLnNwcml0ZSAmJiB0aGlzLmlzQW5pbWF0aW9uICYmIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uICYmIHRoaXMudGltZSAlIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5kZXggPSAodGhpcy5pbmRleCsxKSAlIHRoaXMuZnJhbWVbdGhpcy5ub3dBbmltYXRpb25dLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAvL+asoeODleODrOODvOODoOeVquWPt+OBjOeJueauiuaMh+WumuOBruWgtOWQiFxuICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gdGhpcy5mcmFtZVt0aGlzLm5vd0FuaW1hdGlvbl1bdGhpcy5pbmRleF07XG4gICAgICAgICAgICAgICAgaWYgKG5leHQgPT0gXCJzdG9wXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/lgZzmraJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmRleC0tO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV4dCA9PSBcInJlbW92ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44Oq44Og44O844OWXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbmV4dCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgICAgICAvL+aMh+WumuOCouODi+ODoeODvOOCt+ODp+ODs+OBuOWkieabtFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihuZXh0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZS5mcmFtZUluZGV4ID0gbmV4dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v54Sh5pW15pmC6ZaT5Yem55CGXG4gICAgICAgICAgICBpZiAodGhpcy5tdXRla2lUaW1lID4gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm11dGVraVRpbWUgJSAyID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgICAgICAgICAgdGhpcy5tdXRla2lUaW1lLS07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5pON5L2c5YGc5q2i5pmC6ZaTXG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lLS07XG4gICAgICAgICAgICBpZiAodGhpcy5zdG9wVGltZSA8IDApIHRoaXMuc3RvcFRpbWUgPSAwO1xuXG4gICAgICAgICAgICAvL+aTjeS9nOWBnOatouaZgumWk+OBjOe1guOCj+OBo+OBn+OCieawl+e1tuino+mZpFxuICAgICAgICAgICAgaWYgKHRoaXMuaXNTdHVuICYmIHRoaXMuc3RvcFRpbWUgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNTdHVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmJhbGxvb24pIHRoaXMuYmFsbG9vbi5zY2FsZVggPSB0aGlzLnNjYWxlWDtcblxuICAgICAgICAgICAgLy/kuZfjgaPjgabjgYTjgovluorjga7lj5blvpdcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxvb3JPYmplY3QgPSB0aGlzLl9jb2xsaXNpb25bMl0uaGl0O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsb29yT2JqZWN0ID0gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/lvbHlh6bnkIZcbiAgICAgICAgICAgIGlmICh0aGlzLnNoYWRvd1Nwcml0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2hhZG93U3ByaXRlLnggPSB0aGlzLng7XG4gICAgICAgICAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUueSA9IHRoaXMuc2hhZG93WTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgICAgICB0aGlzLmJlZm9yZUFuaW1hdGlvbiA9IHRoaXMubm93QW5pbWF0aW9uO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm9uKCdhZGRlZCcsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMub25lKCdlbnRlcmZyYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzU2hhZG93ICYmICF0aGlzLmlnbm9yZUNvbGxpc2lvbikgdGhpcy5zZXR1cFNoYWRvdygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMub24oJ3JlbW92ZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICBpZih0aGlzLnNoYWRvd1Nwcml0ZSkgdGhpcy5zaGFkb3dTcHJpdGUucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+S4gOWbnuebruOBrmVudGVyZnJhbWXjgafkuIDluqbjgaDjgZHlkbzjgbDjgozjgotcbiAgICBmaXJzdEZyYW1lOiBmdW5jdGlvbigpIHtcbiAgICB9LFxuXG4gICAgLy/lvbHooajnpLrjgrvjg4Pjg4jjgqLjg4Pjg5dcbiAgICBzZXR1cFNoYWRvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHNjID0gdGhpcy53aWR0aCAvIDI0O1xuICAgICAgICBpZiAoc2MgPCAxKSBzYyArPSAwLjI7XG4gICAgICAgIHRoaXMuc2hhZG93U3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJzaGFkb3dcIiwgMjQsIDgpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLnNoYWRvd0xheWVyKVxuICAgICAgICAgICAgLnNldEFscGhhKDAuNSlcbiAgICAgICAgICAgIC5zZXRTY2FsZShzYywgMS4wKTtcbiAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmFscGhhID0gMC41O1xuICAgICAgICAgICAgaWYgKHRoYXQuYWxwaGEgPCAwLjUpIHRoaXMuYWxwaGEgPSB0aGF0LmFscGhhO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v5b2T44Gf44KK5Yik5a6a5oOF5aCx5Yid5pyf5YyWXG4gICAgaW5pdENvbGxpc2lvbjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICAvL+W9k+OCiuWIpOWumueUqO+8iDA65LiKIDE65Y+zIDI65LiLIDM65bem77yJXG4gICAgICAgIHZhciB3ID0gTWF0aC5mbG9vcih0aGlzLndpZHRoLzQpO1xuICAgICAgICB2YXIgaCA9IE1hdGguZmxvb3IodGhpcy5oZWlnaHQvNCk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvbiA9IFtdO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMF0gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogdywgaGVpZ2h0OiAyfSk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblsxXSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUoe3dpZHRoOiAyLCBoZWlnaHQ6IGh9KTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzJdID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IHcsIGhlaWdodDogMn0pO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMiwgaGVpZ2h0OiBofSk7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uUmVzdWx0ID0gbnVsbDtcblxuICAgICAgICAvL+W9k+OBn+OCiuWIpOWumuODgeOCp+ODg+OCr+S9jee9ruOCquODleOCu+ODg+ODiFxuICAgICAgICB0aGlzLm9mZnNldENvbGxpc2lvblggPSBvcHRpb25zLm9mZnNldENvbGxpc2lvblggfHwgMDtcbiAgICAgICAgdGhpcy5vZmZzZXRDb2xsaXNpb25ZID0gb3B0aW9ucy5vZmZzZXRDb2xsaXNpb25ZIHx8IDA7XG5cbiAgICAgICAgLy/lvZPjgZ/jgorliKTlrprmg4XloLHlho3oqK3lrppcbiAgICAgICAgdGhpcy5zZXR1cENvbGxpc2lvbigpO1xuXG4gICAgICAgIC8v5b2T44Gf44KK5Yik5a6a44OH44OQ44OD44Kw55SoXG4gICAgICAgIGlmIChERUJVR19DT0xMSVNJT04pIHtcbiAgICAgICAgICAgIHRoaXMub25lKCdlbnRlcmZyYW1lJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzBdLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5vYmpMYXllcik7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzFdLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5vYmpMYXllcik7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzJdLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5vYmpMYXllcik7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzNdLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5vYmpMYXllcik7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzBdLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblsxXS5hbHBoYSA9IDAuMztcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0uYWxwaGEgPSAwLjM7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzNdLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgICAgIC8v44OA44Oh44O844K45b2T44Gf44KK5Yik5a6a6KGo56S6XG4gICAgICAgICAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogdGhpcy53aWR0aCwgaGVpZ2h0OiB0aGlzLmhlaWdodH0pLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgICAgICAgICAgYy5hbHBoYSA9IDAuMztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5vbmUoJ3JlbW92ZWQnLCBlID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMF0ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzFdLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblsyXS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bM10ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v55S76Z2i5aSW6JC944GhXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgIHRoaXMudnkgPSAtMTA7XG4gICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnZGVhZCcpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/jg47jg4Pjgq/jg5Djg4Pjgq/jg6Ljg7zjgrfjg6fjg7NcbiAgICBrbm9ja2JhY2s6IGZ1bmN0aW9uKHBvd2VyLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgcG93ZXIgPSBwb3dlciB8fCAwO1xuICAgICAgICBpZiAocG93ZXIgPT0gMCkgcmV0dXJuO1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSB1bmRlZmluZWQpIGRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG5cbiAgICAgICAgdmFyIGJhY2sgPSAzMiArIE1hdGguZmxvb3IocG93ZXIgLyAxMCk7XG4gICAgICAgIHZhciBzeCA9IE1hdGguY29zKGRpcmVjdGlvbi50b1JhZGlhbigpKTtcbiAgICAgICAgdmFyIHN5ID0gTWF0aC5zaW4oZGlyZWN0aW9uLnRvUmFkaWFuKCkpO1xuXG4gICAgICAgIC8v44OO44OD44Kv44OQ44OD44Kv5YWI44Gr5aOB44GM54Sh44GE44GL44OB44Kn44OD44KvXG4gICAgICAgIHZhciBjaGsgPSB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLnggKyBzeCAqIGJhY2ssIHRoaXMueSArIHN5ICogYmFjaywgOCwgOCk7XG4gICAgICAgIGlmIChjaGspIHtcbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44KL5omA44G+44Gn44OQ44OD44Kv44GZ44KLXG4gICAgICAgICAgICB2YXIgYyA9IGNoa1swXTtcbiAgICAgICAgICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBiYWNrID0gKGMueCAtIGMud2lkdGggLyAyKSAtIHRoaXMueDtcbiAgICAgICAgICAgICAgICAgICAgYmFjayAqPSAwLjg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTgwOlxuICAgICAgICAgICAgICAgICAgICBiYWNrID0gdGhpcy54IC0gKGMueCArIGMud2lkdGggLyAyKTtcbiAgICAgICAgICAgICAgICAgICAgYmFjayAqPSAwLjg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKS5ieSh7eDogc3ggKiBiYWNrLCB5OiBzeSAqIGJhY2t9LCAxMCwgXCJlYXNlT3V0RWxhc3RpY1wiKTtcbiAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgIHRoaXMudnkgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/lnLDlvaLlvZPjgZ/jgorliKTlrppcbiAgICBjaGVja01hcENvbGxpc2lvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlnbm9yZUNvbGxpc2lvbikgcmV0dXJuIHRoaXM7XG5cbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzBdLmhpdCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblsxXS5oaXQgPSBudWxsO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0uaGl0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzNdLmhpdCA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5pc09uTGFkZGVyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNPblN0YWlycyA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0aGlzLm9uU2NyZWVuICYmIHRoaXMuc2hhZG93U3ByaXRlKSB7XG4gICAgICAgICAgICB0aGlzLnNoYWRvd1kgPSA5OTk5OTtcbiAgICAgICAgICAgIHZhciBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkgKyAxMjgpO1xuICAgICAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/lnLDlvaLmjqXop6bliKTlrppcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jb2xsaXNpb25MYXllci5jaGlsZHJlbi5mb3JFYWNoKGUgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNEcm9wKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoZS5pZ25vcmUgfHwgZSA9PSB0aGlzLnRocm91Z2hGbG9vcikgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKGUudHlwZSA9PSBcImxhZGRlclwiIHx8IGUudHlwZSA9PSBcInN0YWlyc1wiKSByZXR1cm47XG5cbiAgICAgICAgICAgIC8v5LiK5YG0XG4gICAgICAgICAgICBpZiAodGhpcy52eSA8IDAgICYmIGUuaGl0VGVzdEVsZW1lbnQodGhpcy5fY29sbGlzaW9uWzBdKSkgdGhpcy5fY29sbGlzaW9uWzBdLmhpdCA9IGU7XG4gICAgICAgICAgICAvL+S4i+WBtFxuICAgICAgICAgICAgaWYgKHRoaXMudnkgPj0gMCAmJiBlLmhpdFRlc3RFbGVtZW50KHRoaXMuX2NvbGxpc2lvblsyXSkpIHRoaXMuX2NvbGxpc2lvblsyXS5oaXQgPSBlO1xuICAgICAgICAgICAgLy/lj7PlgbRcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4ID4gMCAgJiYgZS5oaXRUZXN0RWxlbWVudCh0aGlzLl9jb2xsaXNpb25bMV0pKSB0aGlzLl9jb2xsaXNpb25bMV0uaGl0ID0gZTtcbiAgICAgICAgICAgIC8v5bem5YG0XG4gICAgICAgICAgICBpZiAodGhpcy52eCA8IDAgICYmIGUuaGl0VGVzdEVsZW1lbnQodGhpcy5fY29sbGlzaW9uWzNdKSkgdGhpcy5fY29sbGlzaW9uWzNdLmhpdCA9IGU7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9uU2NyZWVuICYmIHRoaXMuc2hhZG93U3ByaXRlKSB7XG4gICAgICAgICAgICAgICAgLy/jgq3jg6Pjg6njgq/jgr/jg7zjga7kuIvmlrnlkJHjgavjg6zjgqTjgpLpo5vjgbDjgZfjgabnm7TkuIvjga7lnLDpnaLluqfmqJnjgpLlj5bjgotcbiAgICAgICAgICAgICAgICB2YXIgeCA9IGUueCAtIGUud2lkdGggLyAyO1xuICAgICAgICAgICAgICAgIHZhciB5ID0gZS55IC0gZS5oZWlnaHQgLyAyO1xuICAgICAgICAgICAgICAgIHZhciBwMyA9IHBoaW5hLmdlb20uVmVjdG9yMih4LCB5KTtcbiAgICAgICAgICAgICAgICB2YXIgcDQgPSBwaGluYS5nZW9tLlZlY3RvcjIoeCArIGUud2lkdGgsIHkpO1xuICAgICAgICAgICAgICAgIGlmICh5IDwgdGhpcy5zaGFkb3dZICYmIHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RMaW5lTGluZShwMSwgcDIsIHAzLCBwNCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUuc2V0UG9zaXRpb24odGhpcy54LCB5KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhZG93WSA9IHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5pc0NhdGNoTGFkZGVyKSB0aGlzLnNoYWRvd1Nwcml0ZS52aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgLy/lvZPjgZ/jgorliKTlrprntZDmnpzlj43mmKBcbiAgICAgICAgdGhpcy5jb2xsaXNpb25Qcm9jZXNzKCk7XG5cbiAgICAgICAgLy/jga/jgZfjgZTjga7jgb/liKTlrppcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jb2xsaXNpb25MYXllci5jaGlsZHJlbi5mb3JFYWNoKGUgPT4ge1xuICAgICAgICAgICAgLy/moq/lrZDliKTlrppcbiAgICAgICAgICAgIGlmIChlLnR5cGUgPT0gXCJsYWRkZXJcIiB8fCBlLnR5cGUgPT0gXCJzdGFpcnNcIikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxhZGRlckNvbGxpc2lvbiAmJiBlLmhpdFRlc3RFbGVtZW50KHRoaXMubGFkZGVyQ29sbGlzaW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT25MYWRkZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT25TdGFpcnMgPSAoZS50eXBlID09IFwic3RhaXJzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprntZDmnpzlj43mmKDlh6bnkIZcbiAgICBjb2xsaXNpb25Qcm9jZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHcgPSBNYXRoLmZsb29yKHRoaXMud2lkdGgvMikrNjtcbiAgICAgICAgdmFyIGggPSBNYXRoLmZsb29yKHRoaXMuaGVpZ2h0LzIpKzY7XG4gICAgICAgIHRoaXMuaXNPbkZsb29yID0gZmFsc2U7XG5cbiAgICAgICAgLy/kuIrlgbTmjqXop6ZcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblswXS5oaXQgJiYgIXRoaXMuaXNDYXRjaExhZGRlcikge1xuICAgICAgICAgICAgdmFyIHJldCA9IHRoaXMuX2NvbGxpc2lvblswXS5oaXQ7XG4gICAgICAgICAgICB0aGlzLnkgPSByZXQueStyZXQuaGVpZ2h0KigxLXJldC5vcmlnaW5ZKStoO1xuICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgICAgICB0aGlzLnJlc2V0Q29sbGlzaW9uUG9zaXRpb24oKTtcbiAgICAgICAgICAgIGlmIChyZXQuY29sbGlzaW9uU2NyaXB0KSB7XG4gICAgICAgICAgICAgICAgcmV0LmNvbGxpc2lvblNjcmlwdCh0aGlzLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL+S4i+WBtOaOpeinplxuICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzJdLmhpdCAmJiAhdGhpcy5pc0NhdGNoTGFkZGVyKSB7XG4gICAgICAgICAgICB2YXIgcmV0ID0gdGhpcy5fY29sbGlzaW9uWzJdLmhpdDtcbiAgICAgICAgICAgIHRoaXMueSA9IHJldC55LXJldC5oZWlnaHQqcmV0Lm9yaWdpblktaDtcbiAgICAgICAgICAgIHRoaXMueCArPSByZXQudnggfHwgMDtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1BsYXllciAmJiByZXQudnkgPiAwKSB0aGlzLnkgKz0gcmV0LnZ5IHx8IDA7XG5cbiAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmlzT25GbG9vciA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmZsb29yRnJpY3Rpb24gPSByZXQuZnJpY3Rpb24gPT0gdW5kZWZpbmVkPyAwLjU6IHJldC5mcmljdGlvbjtcblxuICAgICAgICAgICAgdGhpcy50aHJvdWdoRmxvb3IgPSBudWxsO1xuICAgICAgICAgICAgaWYgKHRoaXMucmVib3VuZCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy52eSA9IC10aGlzLnZ5ICogdGhpcy5yZWJvdW5kO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgaWYgKHJldC5jb2xsaXNpb25TY3JpcHQpIHtcbiAgICAgICAgICAgICAgICByZXQuY29sbGlzaW9uU2NyaXB0KHRoaXMsIDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8v5Y+z5YG05o6l6KemXG4gICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMV0uaGl0ICYmICF0aGlzLmlzQ2F0Y2hMYWRkZXIpIHtcbiAgICAgICAgICAgIHZhciByZXQgPSB0aGlzLl9jb2xsaXNpb25bMV0uaGl0O1xuICAgICAgICAgICAgdGhpcy54ID0gcmV0LngtcmV0LndpZHRoKnJldC5vcmlnaW5YLXc7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgIHRoaXMucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgaWYgKHJldC5jb2xsaXNpb25TY3JpcHQpIHtcbiAgICAgICAgICAgICAgICByZXQuY29sbGlzaW9uU2NyaXB0KHRoaXMsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8v5bem5YG05o6l6KemXG4gICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0ICYmICF0aGlzLmlzQ2F0Y2hMYWRkZXIpIHtcbiAgICAgICAgICAgIHZhciByZXQgPSB0aGlzLl9jb2xsaXNpb25bM10uaGl0O1xuICAgICAgICAgICAgdGhpcy54ID0gcmV0LngrcmV0LndpZHRoKigxLXJldC5vcmlnaW5YKSt3O1xuICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICB0aGlzLnJlc2V0Q29sbGlzaW9uUG9zaXRpb24oKTtcbiAgICAgICAgICAgIGlmIChyZXQuY29sbGlzaW9uU2NyaXB0KSB7XG4gICAgICAgICAgICAgICAgcmV0LmNvbGxpc2lvblNjcmlwdCh0aGlzLCAzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/lnLDlvaLlvZPjgZ/jgorliKTlrprvvIjnibnlrprlnLDngrnjg4Hjgqfjg4Pjgq/jga7jgb/vvInooZ3nqoHjgZfjgZ/jgoLjga7jgpLphY3liJfjgafov5TjgZlcbiAgICBjaGVja01hcENvbGxpc2lvbjI6IGZ1bmN0aW9uKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgeCA9IHggfHwgdGhpcy54O1xuICAgICAgICB5ID0geSB8fCB0aGlzLnk7XG4gICAgICAgIHdpZHRoID0gd2lkdGggfHwgMTtcbiAgICAgICAgaGVpZ2h0ID0gaGVpZ2h0IHx8IDE7XG4gICAgICAgIHZhciBjID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCh7d2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodH0pLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICB2YXIgcmV0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jb2xsaXNpb25MYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLnR5cGUgPT0gXCJsYWRkZXJcIiB8fCBlLnR5cGUgPT0gXCJzdGFpcnNcIikgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKGUuaGl0VGVzdEVsZW1lbnQoYykpIHtcbiAgICAgICAgICAgICAgICBpZiAocmV0ID09IG51bGwpIHJldCA9IFtdO1xuICAgICAgICAgICAgICAgIHJldC5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9LFxuXG4gICAgLy/jgq3jg6Pjg6njgq/jgr/lkIzlo6vlvZPjgZ/jgorliKTlrprvvIjjg5bjg63jg4Pjgq/jga7jgb/vvIlcbiAgICBjaGVja0NoYXJhY3RlckNvbGxpc2lvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlnbm9yZUNvbGxpc2lvbikgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5pc0Ryb3ApIHJldHVybjtcblxuICAgICAgICB2YXIgcmV0ID0gW107XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5vYmpMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmICghZS5pc0Jsb2NrKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoZS5pc0RlYWQpIHJldHVybjtcblxuICAgICAgICAgICAgLy/kuIrlgbRcbiAgICAgICAgICAgIGlmICh0aGF0LnZ5IDwgMCAmJiBlLmhpdFRlc3RFbGVtZW50KHRoYXQuX2NvbGxpc2lvblswXSkpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnkgPSBlLnkrZS5oZWlnaHQqKDEtZS5vcmlnaW5ZKSsxNjtcbiAgICAgICAgICAgICAgICB0aGF0LnZ5ID0gMTtcbiAgICAgICAgICAgICAgICByZXRbMF0gPSBlO1xuICAgICAgICAgICAgICAgIHRoYXQucmVzZXRDb2xsaXNpb25Qb3NpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/kuIvlgbRcbiAgICAgICAgICAgIGlmICh0aGF0LnZ5ID4gMCAmJiBlLmhpdFRlc3RFbGVtZW50KHRoYXQuX2NvbGxpc2lvblsyXSkpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnkgPSBlLnktZS5oZWlnaHQqZS5vcmlnaW5ZLTE2O1xuICAgICAgICAgICAgICAgIHRoYXQudnggPSBlLnZ4O1xuICAgICAgICAgICAgICAgIHRoYXQudnkgPSAwO1xuICAgICAgICAgICAgICAgIHRoYXQuaXNKdW1wID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhhdC5pc09uRmxvb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoYXQudGhyb3VnaEZsb29yID0gbnVsbDtcbiAgICAgICAgICAgICAgICByZXRbMl0gPSBlO1xuICAgICAgICAgICAgICAgIGlmICh0aGF0LnJlYm91bmQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52eSA9IC10aGF0LnZ5ICogdGhhdC5yZWJvdW5kO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudnkgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGF0LnJlc2V0Q29sbGlzaW9uUG9zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v5Y+z5YG0XG4gICAgICAgICAgICBpZiAodGhhdC52eCA+IDAgJiYgZS5oaXRUZXN0RWxlbWVudCh0aGF0Ll9jb2xsaXNpb25bMV0pKSB7XG4gICAgICAgICAgICAgICAgdGhhdC54ID0gZS54LWUud2lkdGgqZS5vcmlnaW5YLTEwO1xuICAgICAgICAgICAgICAgIHRoYXQudnggPSAwO1xuICAgICAgICAgICAgICAgIHJldFsxXSA9IGU7XG4gICAgICAgICAgICAgICAgdGhhdC5yZXNldENvbGxpc2lvblBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+W3puWBtFxuICAgICAgICAgICAgaWYgKHRoYXQudnggPCAwICYmIGUuaGl0VGVzdEVsZW1lbnQodGhhdC5fY29sbGlzaW9uWzNdKSkge1xuICAgICAgICAgICAgICAgIHRoYXQueCA9IGUueCtlLndpZHRoKigxLWUub3JpZ2luWCkrMTA7XG4gICAgICAgICAgICAgICAgdGhhdC52eCA9IDA7XG4gICAgICAgICAgICAgICAgcmV0WzNdID0gZTtcbiAgICAgICAgICAgICAgICB0aGF0LnJlc2V0Q29sbGlzaW9uUG9zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcblxuICAgIC8v5b2T44Gf44KK5Yik5a6a55So44Ko44Os44Oh44Oz44OI44Gu5YaN6Kit5a6aXG4gICAgc2V0dXBDb2xsaXNpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/lvZPjgZ/jgorliKTlrprnlKjjgqjjg6zjg6Hjg7Pjg4jjga7kvY3nva7lho3jgrvjg4Pjg4hcbiAgICByZXNldENvbGxpc2lvblBvc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHcgPSBNYXRoLmZsb29yKHRoaXMud2lkdGgvMikgKyA2ICsgdGhpcy5vZmZzZXRDb2xsaXNpb25YO1xuICAgICAgICB2YXIgaCA9IE1hdGguZmxvb3IodGhpcy5oZWlnaHQvMikrIDYgKyB0aGlzLm9mZnNldENvbGxpc2lvblk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblswXS5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSAtIGgpO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMV0uc2V0UG9zaXRpb24odGhpcy54ICsgdywgdGhpcy55KTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzJdLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55ICsgaCk7XG4gICAgICAgIHRoaXMuX2NvbGxpc2lvblszXS5zZXRQb3NpdGlvbih0aGlzLnggLSB3LCB0aGlzLnkpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFsxMywgMTRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFswLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzBdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFswXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHNldEFuaW1hdGlvbjogZnVuY3Rpb24oYW5pbU5hbWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmZyYW1lW2FuaW1OYW1lXSkgcmV0dXJuO1xuICAgICAgICBpZiAoYW5pbU5hbWUgPT0gdGhpcy5ub3dBbmltYXRpb24pIHJldHVybjtcbiAgICAgICAgdGhpcy5ub3dBbmltYXRpb24gPSBhbmltTmFtZTtcbiAgICAgICAgdGhpcy5pbmRleCA9IC0xO1xuICAgICAgICB0aGlzLmlzQ2hhbmdlQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O844GL44KJ44Gu55u057ea6Led6ZuiXG4gICAgZ2V0RGlzdGFuY2VQbGF5ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgeCA9IHRoaXMueC10aGlzLnBhcmVudFNjZW5lLnBsYXllci54O1xuICAgICAgICB2YXIgeSA9IHRoaXMueS10aGlzLnBhcmVudFNjZW5lLnBsYXllci55O1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHgqeCt5KnkpO1xuICAgIH0sXG5cbiAgICAvL+OCquODluOCuOOCp+OCr+ODiOmWk+OBruebtOe3mui3nembolxuICAgIGdldERpc3RhbmNlOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgIHZhciB4ID0gdGhpcy54IC0gZWxlbWVudC54O1xuICAgICAgICB2YXIgeSA9IHRoaXMueSAtIGVsZW1lbnQueTtcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydCh4KngreSp5KTtcbiAgICB9LFxuXG4gICAgLy/oh6rliIbjgajku5bjgqjjg6zjg6Hjg7Pjg4jjgpLntZDjgbbnm7Tnt5rjga7op5LluqbvvIjlvKfluqbms5XvvIlcbiAgICBnZXRBbmdsZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIoZWxlbWVudC54LCBlbGVtZW50LnkpO1xuICAgICAgICB2YXIgcCA9IHAyLnN1YihwMSk7XG4gICAgICAgIHJldHVybiBwLnRvRGVncmVlKCk7XG4gICAgfSxcblxuICAgIC8v6Ieq5YiG44Go5LuW44Ko44Os44Oh44Oz44OI44KS57WQ44G255u057ea44Gu6KeS5bqm77yI44Op44K444Ki44Oz77yJXG4gICAgZ2V0QW5nbGVSYWRpYW46IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHAxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgdmFyIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKGVsZW1lbnQueCwgZWxlbWVudC55KTtcbiAgICAgICAgdmFyIHAgPSBwMi5zdWIocDEpO1xuICAgICAgICByZXR1cm4gcC50b0FuZ2xlKCk7XG4gICAgfSxcblxuICAgIC8v54mp55CG54++6LGh5oOF5aCx44Gu44G/44Kq44OW44K444Kn44Kv44OI44Gn5Y+W5b6XXG4gICAgZ2V0UGh5c2ljczogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2eDogdGhpcy52eCxcbiAgICAgICAgICAgIHZ5OiB0aGlzLnZ5LFxuICAgICAgICAgICAgZ3Jhdml0eTogdGhpcy5ncmF2aXR5LFxuICAgICAgICAgICAgZnJpY3Rpb246IHRoaXMuZnJpY3Rpb24sXG4gICAgICAgICAgICByZWJvdW5kOiB0aGlzLnJlYm91bmQsXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8v56e75YuV44OR44K544Gu6Kit5a6aXG4gICAgc2V0UGF0aDogZnVuY3Rpb24ocGF0aCwgbG9vcCkge1xuICAgICAgICB0aGlzLnBhdGggPSBbXTtcbiAgICAgICAgdGhpcy5sb29wID0gbG9vcDtcblxuICAgICAgICAvL+ODkeOCueaDheWgseOBruS9nOaIkFxuICAgICAgICB2YXIgc3VtID0gMDtcbiAgICAgICAgdmFyIHB0YiA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5wb2x5bGluZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHB0ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHBhdGgueCArIHBhdGgucG9seWxpbmVbaV0ueCwgcGF0aC55ICsgcGF0aC5wb2x5bGluZVtpXS55KTtcbiAgICAgICAgICAgIGlmIChpID4gMCkge1xuICAgICAgICAgICAgICAgIHN1bSArPSBNYXRoLmZsb29yKHB0Yi5kaXN0YW5jZShwdCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcHQudGltZSA9IHN1bTtcbiAgICAgICAgICAgIHRoaXMucGF0aC5wdXNoKHB0KTtcbiAgICAgICAgICAgIHB0YiA9IHB0O1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jg6vjg7zjg5fmnInjgormjIflrprjga7loLTlkIjjgIHlp4vngrnjga7luqfmqJnjgpLntYLngrnjgavliqDjgYjjgotcbiAgICAgICAgaWYgKGxvb3ApIHtcbiAgICAgICAgICAgIHZhciBlbmQgPSBwaGluYS5nZW9tLlZlY3RvcjIocGF0aC54ICsgcGF0aC5wb2x5bGluZVtwYXRoLnBvbHlsaW5lLmxlbmd0aCAtIDFdLngsIHBhdGgueSArIHBhdGgucG9seWxpbmVbcGF0aC5wb2x5bGluZS5sZW5ndGggLSAxXS55KTtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IHBoaW5hLmdlb20uVmVjdG9yMihwYXRoLnggKyBwYXRoLnBvbHlsaW5lWzBdLngsIHBhdGgueSArIHBhdGgucG9seWxpbmVbMF0ueSk7XG4gICAgICAgICAgICBzdW0gKz0gTWF0aC5mbG9vcihzdGFydC5kaXN0YW5jZShlbmQpKTtcbiAgICAgICAgICAgIHN0YXJ0LnRpbWUgPSBzdW07XG4gICAgICAgICAgICB0aGlzLnBhdGgucHVzaChzdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wYXRoLm1heFRpbWUgPSBzdW07XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v44OR44K55bqn5qiZ44Gu5Y+W5b6XXG4gICAgZ2V0UGF0aFBvc2l0aW9uOiBmdW5jdGlvbih0aW1lKSB7XG4gICAgICAgIGlmICghdGhpcy5wYXRoIHx8IHRpbWUgPCAwKSByZXR1cm4gbnVsbDtcbiAgICAgICAgdGltZSAlPSB0aGlzLnBhdGgubWF4VGltZTtcblxuICAgICAgICB2YXIgbGVuID0gdGhpcy5wYXRoLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgdmFyIHAgPSB0aGlzLnBhdGhbaV07XG4gICAgICAgICAgICBpZiAodGltZSA9PSBwLnRpbWUpIHJldHVybiBwO1xuICAgICAgICAgICAgaWYgKHRpbWUgPCBwLnRpbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcDIgPSB0aGlzLnBhdGhbaSAtIDFdO1xuICAgICAgICAgICAgICAgIHZhciB0ID0gKHRpbWUgLSBwMi50aW1lKSAvIChwLnRpbWUgLSBwMi50aW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGhpbmEuZ2VvbS5WZWN0b3IyLmxlcnAocDIsIHAsIHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZWZmZWN0LmpzXG4gKiAgMjAxNy8wMS8xMlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkVmZmVjdFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICAvL+OCpOODs+ODh+ODg+OCr+OCueabtOaWsOmWk+malFxuICAgIGludGVydmFsOiAyLFxuXG4gICAgLy/nj77lnKjjgqTjg7Pjg4fjg4Pjgq/jgrlcbiAgICBpbmRleDogMCxcblxuICAgIC8v6ZaL5aeL44Kk44Oz44OH44OD44Kv44K5XG4gICAgc3RhcnRJbmRleDogMCxcblxuICAgIC8v5pyA5aSn44Kk44Oz44OH44OD44Kv44K5XG4gICAgbWF4SW5kZXg6IDgsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mAsuihjOWPr+iDveODleODqeOCsCAgIFxuICAgIGlzQWR2YW5jZUFuaW1hdGlvbjogdHJ1ZSxcblxuICAgIC8v57WM6YGO44OV44Os44O844OgXG4gICAgdGltZTogMCxcblxuICAgIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgICAgIG5hbWU6IFwiZXhwbG9kZVwiLFxuICAgICAgICBhc3NldE5hbWU6IFwiZWZmZWN0XCIsXG4gICAgICAgIGxvb3A6IGZhbHNlLFxuICAgICAgICBwb3NpdGlvbjoge3g6IDAsIHk6IDB9LFxuICAgICAgICBvcmlnaW46IHt4OiAwLjUsIHk6IDAuNX0sXG4gICAgICAgIHJvdGF0aW9uOiAwLFxuICAgICAgICBhbHBoYTogMS4wLFxuICAgICAgICBzY2FsZToge3g6IDEuMCwgeTogMS4wfSxcbiAgICAgICAgYmxlbmRNb2RlOiBcInNvdXJjZS1vdmVyXCIsXG4gICAgfSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICAgICAgdGhpcy5vcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgICAgICB0aGlzLm9wdGlvbnMuJGV4dGVuZChxZnQuRWZmZWN0RGF0YS5nZXQodGhpcy5vcHRpb25zLm5hbWUpKTtcbiAgICAgICAgdGhpcy5zZXR1cCgpO1xuXG4gICAgICAgIHRoaXMub24oJ2VudGVyZnJhbWUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudGltZSsrO1xuICAgICAgICAgICAgaWYgKHRoaXMudGltZSAlIHRoaXMuaW50ZXJ2YWwgPT0gMCAmJiB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbikge1xuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLmZyYW1lSW5kZXgrKztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zcHJpdGUuZnJhbWVJbmRleCA9PSAwIHx8IHRoaXMuc3ByaXRlLmZyYW1lSW5kZXggPT0gdGhpcy5tYXhJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxvb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLmZyYW1lSW5kZXggPSB0aGlzLnN0YXJ0SW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2FuaW1hdGlvbmVuZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNldHVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG9wID0gdGhpcy5vcHRpb25zO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKG9wLmFzc2V0TmFtZSwgb3Aud2lkdGgsIG9wLmhlaWdodClcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbihvcC5wb3NpdGlvbi54LCBvcC5wb3NpdGlvbi55KVxuICAgICAgICAgICAgLnNldE9yaWdpbihvcC5vcmlnaW4ueCwgb3Aub3JpZ2luLnkpXG4gICAgICAgICAgICAuc2V0U2NhbGUob3Auc2NhbGUueCwgb3Auc2NhbGUueSlcbiAgICAgICAgICAgIC5zZXRSb3RhdGlvbihvcC5yb3RhdGlvbilcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICBpZiAob3AudHJpbW1pbmcpIHtcbiAgICAgICAgICAgIHZhciB0ID0gb3AudHJpbW1pbmc7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKHQueCwgdC55LCB0LndpZHRoLCB0LmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGFydEluZGV4ID0gb3Auc3RhcnRJbmRleDtcbiAgICAgICAgdGhpcy5tYXhJbmRleCA9IG9wLm1heEluZGV4O1xuICAgICAgICB0aGlzLnNwcml0ZS5hbHBoYSA9IG9wLmFscGhhO1xuICAgICAgICB0aGlzLnNwcml0ZS5mcmFtZUluZGV4ID0gdGhpcy5zdGFydEluZGV4O1xuICAgIH0sXG59KTtcblxucGhpbmEuZGVmaW5lKFwicWZ0LkVmZmVjdERhdGFcIiwge1xuICAgIF9zdGF0aWM6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZXhwbG9kZV9zbWFsbFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxNixcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogOCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiAxNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1taW5nOiB7eDogMjU2LCB5OiAyNTYsIHdpZHRoOiAxMjgsIGhlaWdodDogMzJ9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJleHBsb2RlX3NtYWxsMlwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxNixcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiA0LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA3LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAyNTYsIHk6IDI1Niwgd2lkdGg6IDEyOCwgaGVpZ2h0OiAzMn0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImV4cGxvZGVcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiA2NCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogNjQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogOCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1taW5nOiB7eDogMCwgeTogMCwgd2lkdGg6IDUxMiwgaGVpZ2h0OiAxMjh9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJleHBsb2RlX2xhcmdlXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogNDgsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQ4LFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IDQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmltbWluZzoge3g6IDAsIHk6IDAsIHdpZHRoOiA1MTIsIGhlaWdodDogMTI4fSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZXhwbG9kZV9ncm91bmRcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAzMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDgsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogNyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1taW5nOiB7eDogMjU2LCB5OiAxOTIsIHdpZHRoOiAyNTYsIGhlaWdodDogNDh9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzbW9rZV9zbWFsbFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDE2LFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxNixcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA0LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAxMjgsIHk6IDEyOCwgd2lkdGg6IDY0LCBoZWlnaHQ6IDE2fSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic21va2VcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1taW5nOiB7eDogMTI4LCB5OiAxNjAsIHdpZHRoOiAxMjAsIGhlaWdodDogMjR9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzbW9rZV9sYXJnZVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDMyLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAzMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA4LFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1pbmc6IHt4OiAyNTYsIHk6IDEyOCwgd2lkdGg6IDEyOCwgaGVpZ2h0OiA2NH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImhpdFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXROYW1lOiBcImVmZmVjdDJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiA3MixcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMzIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogMyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1taW5nOiB7eDogMCwgeTogMCwgd2lkdGg6IDcyLCBoZWlnaHQ6IDEyOH0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSk7XG4iLCIvKlxuICogIGVuZW15LmpzXG4gKiAgMjAxNi8xMi8zMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/mlbXjgq3jg6Pjg6njgq/jgr/ln7rmnKzjgq/jg6njgrlcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuQ2hhcmFjdGVyXCIsXG5cbiAgICAvL+itmOWIpeODleODqeOCsFxuICAgIGlzRW5lbXk6IHRydWUsXG5cbiAgICAvL+ODrOODmeODq1xuICAgIGxldmVsOiAwLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMTAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMCxcblxuICAgIC8v56e75YuV6YCf5bqmXG4gICAgc3BlZWQ6IDEsXG5cbiAgICAvL+awl+e1tueiuueOh1xuICAgIHN0dW5Qb3dlcjogMSxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDAsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+mAsuihjOaWueWQke+8iDA65Y+zIDE4MDrlt6YgMjcwOuS4iiA5MDrkuIvvvIlcbiAgICBkaXJlY3Rpb246IDAsXG5cbiAgICAvL+ODneOCpOODs+ODiFxuICAgIHBvaW50OiAwLFxuXG4gICAgLy/mlLvmkoPlvZPjgZ/jgorliKTlrprmnInlirnjg5Xjg6njgrBcbiAgICBpc0VuYWJsZUF0dGFja0NvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v44K544O844OR44O844Ki44O844Oe44O854q25oWL44OV44Op44KwXG4gICAgaXNTdXBlckFybW9yOiBmYWxzZSxcblxuICAgIC8v5b2x6KGo56S644OV44Op44KwXG4gICAgaXNTaGFkb3c6IHRydWUsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZVNsYXNoOiAxLFxuICAgIGRhbWFnZVN0aW5nOiAxLFxuICAgIGRhbWFnZUJsb3c6IDEsXG4gICAgZGFtYWdlQXJyb3c6IDEsXG4gICAgZGFtYWdlRmlyZTogMSxcbiAgICBkYW1hZ2VJY2U6IDEsXG4gICAgZGFtYWdlSG9seTogMSxcbiAgICBkYW1hZ2VEYXJrOiAxLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDAsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIC8v6KGM5YuV44OR44K/44O844Oz55SoXG4gICAgY2hhc2VUaW1lOiAwLFxuICAgIHR1cm5UaW1lOiAwLFxuICAgIHN0b3BUaW1lOiAwLFxuICAgIHR1cm5Db3VudDogMCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc2V0dXBBbmltYXRpb24oKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5sZXZlbCA9IG9wdGlvbnMubGV2ZWwgfHwgMDtcbiAgICAgICAgdGhpcy50ZXJyaXRvcnkgPSBvcHRpb25zLnRlcnJpdG9yeTtcblxuICAgICAgICAvL+ODh+ODkOODg+OCsOaZguimlueVjOOBruWPr+imluWMllxuICAgICAgICBpZiAoREVCVUdfRVlFU0lHSFQpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHZhciB2YSA9ICh0aGlzLnZpZXdBbmdsZSAvIDIpLnRvUmFkaWFuKCk7XG4gICAgICAgICAgICBwaGluYS5kaXNwbGF5LkFyY1NoYXBlKHtyYWRpdXM6IHRoaXMuZXllc2lnaHQsIHN0YXJ0QW5nbGU6IC12YSwgZW5kQW5nbGU6IHZhfSkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRBbHBoYSgwLjMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50U2NlbmUucGF1c2VTY2VuZSkgcmV0dXJuO1xuICAgICAgICAgICAgLy/nlLvpnaLlpJbjga7loLTlkIjjga/li5XkvZzlgZzmraJcbiAgICAgICAgICAgIGlmICghdGhpcy5vblNjcmVlbikgcmV0dXJuO1xuXG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcblxuICAgICAgICAgICAgLy/lkJHjgY3jga7mjIflrppcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4ICE9IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+OCueODhuODvOOCuOOCr+ODquOCouOBruWgtOWQiOOBr+W9k+OBn+OCiuWIpOWumueEoeOBl1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50U2NlbmUuaXNTdGFnZUNsZWFyKSByZXR1cm47XG5cbiAgICAgICAgICAgIC8v5rCX57W25Lit44Gv44Ki44OL44Oh44O844K344On44Oz44GX44Gq44GEXG4gICAgICAgICAgICBpZiAodGhpcy5pc1N0dW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v6KKr44OA44Oh44O844K45b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNNdXRla2kgJiYgdGhpcy5tdXRla2lUaW1lID09IDApIHtcbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaUu+aSg+OBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgICAgIGlmIChwbC5pc0F0dGFjayAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsLmF0dGFja0NvbGxpc2lvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYW1hZ2UocGwuYXR0YWNrQ29sbGlzaW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgrfjg6fjg4Pjg4jjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5QbGF5ZXJBdHRhY2sgJiYgZS5pc0NvbGxpc2lvbiAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLmhpdCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhbWFnZShlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICBpZiAodGhpcy5pc0VuYWJsZUF0dGFja0NvbGxpc2lvbiAmJiB0aGlzLm11dGVraVRpbWUgPT0gMCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0RlYWQgJiYgIXBsLmlzRGVhZCAmJiB0aGlzLnBvd2VyID4gMCAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhpdCgpO1xuICAgICAgICAgICAgICAgICAgICBwbC5kYW1hZ2UodGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5zdG9wVGltZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGdvcml0aG0oKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwKSB0aGlzLmNoYXNlVGltZS0tO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnR1cm5UaW1lID4gMCkgdGhpcy50dXJuVGltZS0tO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm9uKCdkZWFkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL+eiuuWumuODieODreODg+ODl+OCouOCpOODhuODoFxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduSXRlbSh0aGlzLngsIHRoaXMueSwge2tpbmQ6IHRoaXMub3B0aW9ucy5pdGVtfSk7XG4gICAgICAgICAgICAgICAgaS52eSA9IC01O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaXRlbSA9PSBcImtleVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGkuaXNFbmVteURyb3AgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpLmlzRW5lbXlEcm9wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+ODrOOCouOCouOCpOODhuODoOODieODreODg+ODl+WIpOWumlxuICAgICAgICAgICAgdmFyIGRpY2UgPSBNYXRoLnJhbmRpbnQoMSwgMTAwKTtcbiAgICAgICAgICAgIGlmIChkaWNlIDw9IHRoaXMucmFyZURyb3BSYXRlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduSXRlbSh0aGlzLngsIHRoaXMueSwge2tpbmQ6IHRoaXMucmFyZURyb3BJdGVtfSk7XG4gICAgICAgICAgICAgICAgaS52eSA9IC01O1xuICAgICAgICAgICAgICAgIGkuaXNFbmVteURyb3AgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL+mAmuW4uOOCouOCpOODhuODoOODieODreODg+ODl+WIpOWumlxuICAgICAgICAgICAgICAgIHZhciBkaWNlID0gTWF0aC5yYW5kaW50KDEsIDEwMCk7XG4gICAgICAgICAgICAgICAgaWYgKGRpY2UgPD0gdGhpcy5kcm9wUmF0ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25JdGVtKHRoaXMueCwgdGhpcy55LCB7a2luZDogdGhpcy5kcm9wSXRlbX0pO1xuICAgICAgICAgICAgICAgICAgICBpLnZ5ID0gLTU7XG4gICAgICAgICAgICAgICAgICAgIGkuaXNFbmVteURyb3AgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgIH0sXG5cbiAgICBkYW1hZ2U6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICBpZiAodGhpcy5tdXRla2lUaW1lID4gMCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5pc011dGVraSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIC8v5rCX57W244Kt44Oj44Oz44K744OrXG4gICAgICAgIHRoaXMuaXNTdHVuID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGRpciA9IDA7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBxZnQuUGxheWVyQXR0YWNrKSB7XG4gICAgICAgICAgICBpZiAodGFyZ2V0LnNjYWxlWCA9PSAxKSBkaXIgPSAwOyBlbHNlIGRpciA9IDE4MDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPiB0YXJnZXQueCkgZGlyID0gMDsgZWxzZSBkaXIgPSAxODA7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcG93ZXIgPSB0YXJnZXQucG93ZXI7XG4gICAgICAgIGlmICh0YXJnZXQuaXNTbGFzaCkgcG93ZXIgKj0gdGhpcy5kYW1hZ2VTbGFzaDtcbiAgICAgICAgaWYgKHRhcmdldC5pc1N0aW5nKSBwb3dlciAqPSB0aGlzLmRhbWFnZVN0aW5nO1xuICAgICAgICBpZiAodGFyZ2V0LmlzQmxvdykgcG93ZXIgKj0gdGhpcy5kYW1hZ2VCbG93O1xuICAgICAgICBpZiAodGFyZ2V0LmlzQXJyb3cpIHBvd2VyICo9IHRoaXMuZGFtYWdlQXJyb3c7XG4gICAgICAgIGlmICh0YXJnZXQuaXNGaXJlKSBwb3dlciAqPSB0aGlzLmRhbWFnZUZpcmU7XG4gICAgICAgIGlmICh0YXJnZXQuaXNJY2UpIHBvd2VyICo9IHRoaXMuZGFtYWdlSWNlO1xuICAgICAgICBpZiAodGFyZ2V0LmlzSG9seSkgcG93ZXIgKj0gdGhpcy5kYW1hZ2VIb2x5O1xuICAgICAgICBpZiAodGFyZ2V0LmlzRGFyaykgcG93ZXIgKj0gdGhpcy5kYW1hZ2VEYXJrO1xuICAgICAgICBwb3dlciA9IE1hdGguZmxvb3IocG93ZXIpO1xuICAgICAgICBpZiAoIXRoaXMuaXNTdXBlckFybW9yKSB0aGlzLmtub2NrYmFjayhwb3dlciwgZGlyKTtcbiAgICAgICAgdGhpcy5tdXRla2lUaW1lID0gMTA7XG4gICAgICAgIHRoaXMuaHAgLT0gcG93ZXI7XG4gICAgICAgIGlmICh0aGlzLmhwIDw9IDApIHtcbiAgICAgICAgICAgIHRoaXMuaHAgPSAwO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS50b3RhbFNjb3JlICs9IHRoaXMucG9pbnQ7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnRvdGFsS2lsbCsrO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnZGVhZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnZGFtYWdlZCcsIHtkaXJlY3Rpb246IGRpcn0pO1xuXG4gICAgICAgICAgICAvL+awl+e1tuWIpOWumlxuICAgICAgICAgICAgdmFyIGRpY2UgPSBNYXRoLnJhbmRpbnQoMSwgMTAwKTtcbiAgICAgICAgICAgIGlmIChkaWNlIDw9IHRhcmdldC5zdHVuUG93ZXIpIHRoaXMuZmxhcmUoJ3N0dW4nLCB7cG93ZXI6IHRhcmdldC5wb3dlcn0pO1xuICAgICAgICB9XG4gICAgICAgIGFwcC5wbGF5U0UoXCJoaXRcIik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+ODl+ODrOOCpOODpOODvOOBjOimi+OBiOOCi+S9jee9ruOBq+OBhOOCi+OBruOBi+WIpOWumlxuICAgIGlzTG9va1BsYXllcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v6KaW5Yqb5aSW44Gu5aC05ZCI44Gv6KaL44GI44Gq44GEXG4gICAgICAgIGlmICh0aGlzLmdldERpc3RhbmNlUGxheWVyKCkgPiB0aGlzLmV5ZXNpZ2h0KSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgLy/oppbph47op5LlpJbjga7loLTlkIjjga/opovjgYjjgarjgYRcbiAgICAgICAgaWYgKHRoaXMudmlld0FuZ2xlICE9IDM2MCkge1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7op5LluqbvvIjlj7PjgYwzNjDluqbvvIlcbiAgICAgICAgICAgIHZhciBhbmdsZSA9IE1hdGguZmxvb3IodGhpcy5nZXRQbGF5ZXJBbmdsZSgpKTtcblxuICAgICAgICAgICAgLy/oppbnlYznr4Tlm7LlhoXjga7liKTlrppcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhID0gdGhpcy52aWV3QW5nbGUgLyAyO1xuICAgICAgICAgICAgICAgIGlmICghKDM2MC12YSA8IGFuZ2xlIHx8IGFuZ2xlIDwgdmEpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBkaXIgPSB0aGlzLmRpcmVjdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgdmEgPSB0aGlzLnZpZXdBbmdsZSAvIDI7XG4gICAgICAgICAgICAgICAgaWYgKCEoZGlyLXZhIDwgYW5nbGUgJiYgYW5nbGUgPCBkaXIrdmEpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUuY29sbGlzaW9uTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZS50eXBlID09IFwibGFkZGVyXCIgfHwgdGhpcy50eXBlID09IFwic3RhaXJzXCIpIHJldHVybjtcbiAgICAgICAgICAgIC8v6Ieq5YiG44Go44OX44Os44Kk44Ok44O86ZaT44Gr6YGu6JS954mp77yI5Zyw5b2i5b2T44KK5Yik5a6a77yJ44GM44GC44KL5aC05ZCI6KaL44GI44Gq44GEXG4gICAgICAgICAgICBpZiAocGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdFJlY3RMaW5lKGUsIHRoYXQsIHBsYXllcikpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8v6Ieq5YiG44Go44OX44Os44Kk44Ok44O844KS57WQ44G255u057ea44Gu6KeS5bqm77yI5byn5bqm5rOV77yJXG4gICAgZ2V0UGxheWVyQW5nbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueSk7XG4gICAgICAgIHZhciBwID0gcDIuc3ViKHAxKTtcbiAgICAgICAgcmV0dXJuIHAudG9EZWdyZWUoKTtcbiAgICB9LFxuXG4gICAgLy/oh6rliIbjgajjg5fjg6zjgqTjg6Tjg7zjgpLntZDjgbbnm7Tnt5rjga7op5LluqbvvIjjg6njgrjjgqLjg7PvvIlcbiAgICBnZXRQbGF5ZXJSYWRpYW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueSk7XG4gICAgICAgIHZhciBwID0gcDIuc3ViKHAxKTtcbiAgICAgICAgcmV0dXJuIHAudG9BbmdsZSgpO1xuICAgIH0sXG5cbiAgICAvL+S9k+WKm+OCsuODvOOCuOioree9rlxuICAgIHNldHVwTGlmZUdhdWdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAvL+S9k+WKm+OCsuODvOOCuFxuICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHdpZHRoOiAgMzIsXG4gICAgICAgICAgICBoZWlnaHQ6IDIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgICAgICBmaWxsOiAncmVkJyxcbiAgICAgICAgICAgIHN0cm9rZTogJ3doaXRlJyxcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuICAgICAgICAgICAgZ2F1Z2VDb2xvcjogJ2xpbWUnLFxuICAgICAgICAgICAgY29ybmVyUmFkaXVzOiAwLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuaHAsXG4gICAgICAgICAgICBtYXhWYWx1ZTogdGhpcy5ocCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5saWZlR2F1Z2UgPSBwaGluYS51aS5HYXVnZShvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICB0aGlzLmxpZmVHYXVnZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9ICh0aGF0LmhwICE9IHRoaXMubWF4VmFsdWUpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoYXQuaHA7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gLXRoYXQucm90YXRpb247XG4gICAgICAgICAgICB0aGlzLnNjYWxlWCA9IHRoYXQuc2NhbGVYO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5kaXNwVGltZSA+IDE1MCkgdGhpcy52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5iZWZvcmVWYWx1ZSA9PSB0aGlzLnZhbHVlKSB0aGlzLmRpc3BUaW1lKys7IGVsc2UgdGhpcy5kaXNwVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmJlZm9yZVZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5saWZlR2F1Z2UuZGlzcFRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICBoaXQ6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG5cbiAgICAvL+axjueUqOW+gOW+qeOCouODq+OCtOODquOCuuODoO+8iOmZuOS4iu+8iVxuICAgIHJvdW5kdHJpcEFsZ29yaXRobV9ncm91bmQ6IGZ1bmN0aW9uKGRpcywgbG9vaykge1xuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgaWYgKGRpcyA9PT0gdW5kZWZpbmVkKSBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIGlmIChsb29rID09PSB1bmRlZmluZWQpIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/ltJbjgaPjgbfjgaHjgafmipjjgorov5TjgZlcbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODhuODquODiOODquODvOaMh+WumlxuICAgICAgICAgICAgaWYgKCFsb29rICYmIHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgLy/msLTlubPmlrnlkJHjga7jgb/jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgICAgICB2YXIgdHggPSB0aGlzLnggLSB0aGlzLmZpcnN0WDtcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnModHgpID4gdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAgdGhpcy5zcGVlZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v5rGO55So5b6A5b6p44Ki44Or44K044Oq44K644Og77yI56m65Lit77yJXG4gICAgcm91bmR0cmlwQWxnb3JpdGhtX2ZseWluZzogZnVuY3Rpb24oZGlzLCBsb29rKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICBpZiAoZGlzID09PSB1bmRlZmluZWQpIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgaWYgKGxvb2sgPT09IHVuZGVmaW5lZCkgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgdmFyIGNoazEgPSAxO1xuICAgICAgICB2YXIgY2hrMiA9IDM7XG4gICAgICAgIGlmICh0aGlzLnZlcnRpY2FsKSB7XG4gICAgICAgICAgICBjaGsxID0gMDtcbiAgICAgICAgICAgIGNoazIgPSAyO1xuICAgICAgICB9XG4gICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgIHZhciB0dXJuID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bY2hrMV0uaGl0IHx8IHRoaXMuX2NvbGxpc2lvbltjaGsyXS5oaXQpIHR1cm4gPSB0cnVlO1xuXG4gICAgICAgIC8v44OG44Oq44OI44Oq44O85oyH5a6aXG4gICAgICAgIGlmICghbG9vayAmJiB0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgaWYgKHRoaXMudmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICAvL+WeguebtOaWueWQkeODgeOCp+ODg+OCr1xuICAgICAgICAgICAgICAgIHZhciB0eSA9IHRoaXMueSAtIHRoaXMuZmlyc3RZO1xuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyh0eSkgPiB0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDI3MDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gOTA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v5rC05bmz5pa55ZCR44OB44Kn44OD44KvXG4gICAgICAgICAgICAgICAgdmFyIHR4ID0gdGhpcy54IC0gdGhpcy5maXJzdFg7XG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHR4KSA+IHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v5rGO55So6L+96Leh44Ki44Or44K044Oq44K644OgXG4gICAgY2hhc2VBbGdvcml0aG06IGZ1bmN0aW9uKGRpcywgbG9vaykge1xuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgaWYgKGRpcyA9PT0gdW5kZWZpbmVkKSBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIGlmIChsb29rID09PSB1bmRlZmluZWQpIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O855m66KaL5b6M5LiA5a6a5pmC6ZaT6L+96Leh44GZ44KLXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDAgJiYgIXRoaXMuaXNBdHRhY2sgJiYgdGhpcy50dXJuVGltZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHVyblRpbWUgPSAxNTtcbiAgICAgICAgICAgIGlmIChsb29rKSB0aGlzLnR1cm5Db3VudCA9IDA7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+WkseOBo+OBn+eKtuaFi+OBp+S4ieWbnuaMr+OCiui/lOOBo+OBn+WgtOWQiOOBr+i/vei3oee1guS6hlxuICAgICAgICAgICAgaWYgKHRoaXMudHVybkNvdW50ID4gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RYID0gdGhpcy54O1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RZID0gdGhpcy55O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/kuIDlrprot53pm6Lku6XkuIrpm6LjgozjgZ/jgonov73ot6Hop6PpmaRcbiAgICAgICAgaWYgKGRpcyA+IDUxMikge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5maXJzdFggPSB0aGlzLng7XG4gICAgICAgICAgICB0aGlzLmZpcnN0WSA9IHRoaXMueTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNKdW1wKSB0aGlzLnZ4ICo9IDE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAxMjA7XG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAwKSB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/jg4bjg6rjg4jjg6rjg7zmjIflrppcbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAwICYmIHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgLy/msLTlubPmlrnlkJHjga7jgb/jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgICAgICB2YXIgdHggPSB0aGlzLnggLSB0aGlzLmZpcnN0WDtcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnModHgpID4gdGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44GT44KM5Lul5LiK6YCy44KB44Gq44GE5aC05ZCI44Gv5oqY44KK6L+U44GZXG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5XYWxsID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5DbGlmZiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZ4IDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwgfHwgaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafmrrXlt67jgYzjgYLjgovloLTlkIjjga/po5vjgbPotorjgYjjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafltJbjgYzjgYLjgovloLTlkIjjga/nnYDlnLDngrnjgYzjgYLjgovjgYvoqr/jgbnjgabpo5vjgbPpmY3jgorjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuQ2xpZmYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqdW1wT2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCszMiwgdGhpcy55KzMyLCAxNiwgOTYpKSB7anVtcE9rID0gdHJ1ZTsgdGhpcy52eSA9IC03O31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzMyLCB0aGlzLnktMzIsIDE2LCA5NikpIHtqdW1wT2sgPSB0cnVlOyB0aGlzLnZ5ID0gLTEwO31cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC0zMiwgdGhpcy55KzMyLCAxNiwgOTYpKSB7anVtcE9rID0gdHJ1ZTsgdGhpcy52eSA9IC03O31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTMyLCB0aGlzLnktMzIsIDE2LCA5NikpIHtqdW1wT2sgPSB0cnVlOyB0aGlzLnZ5ID0gLTEwO31cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdW1wT2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v552A5Zyw54K544GM54Sh44GE5aC05ZCI44Gv6Kum44KB44Gm5oqY44KK6L+U44GZXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSA0NTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnR1cm5XYWl0ID0gMTU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIuLi5cIn0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RYID0gdGhpcy54O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RZID0gdGhpcy55O1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMzApIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RYID0gdGhpcy54O1xuICAgICAgICAgICAgdGhpcy5maXJzdFkgPSB0aGlzLnk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/oqZXkvqHplqLmlbBcbiAgICBldmFsdWF0ZTogZnVuY3Rpb24oZGlzLCBsb29rKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICBpZiAoZGlzID09PSB1bmRlZmluZWQpIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgaWYgKGxvb2sgPT09IHVuZGVmaW5lZCkgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/ohIXlqIHluqZcbiAgICAgICAgdmFyIHRocmVhdCA9IDA7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7ot53pm6LjgavjgojjgorohIXlqIHluqbjgpLliqDnrpdcbiAgICAgICAgaWYgKGRpcyA8IDI1NikgdGhyZWF0ICs9IDEwXG4gICAgICAgIGlmIChkaXMgPCAxMjgpIHRocmVhdCArPSAyMFxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O86KaW6KqN5Y+v6IO954q25oWLXG4gICAgICAgIGlmIChsb29rKSB0aHJlYXQgKz0gMzA7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zooYzli5XnirbmhYtcbiAgICAgICAgdmFyIHBsYXllckFjdGlvbiA9IFwiXCI7XG4gICAgICAgIGlmIChwbC54ID09IHBsLmJlZm9yZS54ICYmIHBsLnkgPT0gcGwuYmVmb3JlLnkpIHtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Gv56e75YuV44GX44Gm44GE44Gq44GEXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOmAsuihjOaWueWQke+8iOWPszowIOW3pjoxODDvvIlcbiAgICAgICAgICAgIHZhciBwbGRpciA9IDA7XG4gICAgICAgICAgICBpZiAocGwueCA8IHBsLmJlZm9yZS54KSBwbGRpciA9IDE4MDtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbC54KSB7XG4gICAgICAgICAgICAgICAgaWYgKHByZGlyID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjga/ov5HjgaXjgYTjgabjgYTjgotcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBr+mbouOCjOOBpuOBhOOCi1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHByZGlyID09IDE4MCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBr+i/keOBpeOBhOOBpuOBhOOCi1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Gv6Zui44KM44Gm44GE44KLXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRocmVhdDogdGhyZWF0LFxuICAgICAgICAgICAgcGxheWVyQWN0aW9uOiBwbGF5ZXJBY3Rpb24sXG4gICAgICAgIH07XG4gICAgfSxcbn0pO1xuXG4vL+aVteaUu+aSg+WIpOWumlxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15QXR0YWNrXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGVcIixcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEsXG5cbiAgICAvL+acieWKueODleODqeOCsFxuICAgIGlzQWN0aXZlOiB0cnVlLFxuXG4gICAgLy/lr7/lkb1cbiAgICBsaWZlU3BhbjogMTUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHt3aWR0aDogMzIsIGhlaWdodDogMzJ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUgPSBwYXJlbnRTY2VuZTtcblxuICAgICAgICB0aGlzLiRleHRlbmQob3B0aW9ucyk7XG4gICAgICAgIHRoaXMudGltZSA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGUgPT4ge1xuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lID4gdGhpcy5saWZlU3Bhbikge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzQWN0aXZlKSByZXR1cm47XG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmlLvmkoPjgajlvZPjgZ/jgaPjgZ/loLTlkIjjga/jgqjjg5Xjgqfjgq/jg4jjgpLlh7rjgZfjgabnhKHlirnljJZcbiAgICAgICAgICAgIGlmIChwbC5pc0F0dGFjayAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsLmF0dGFja0NvbGxpc2lvbikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQWN0aWNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5idW1wKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCt+ODp+ODg+ODiOOBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXJMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5QbGF5ZXJBdHRhY2sgJiYgZS5pc0NvbGxpc2lvbiAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGUuc25hcCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgZS5pc0NvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICBpZiAoIXBsLmlzRGVhZCAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsKSkge1xuICAgICAgICAgICAgICAgIHBsLmRhbWFnZSh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikge1xuICAgICAgICAgICAgcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IHRoaXMud2lkdGgsIGhlaWdodDogdGhpcy5oZWlnaHR9KS5hZGRDaGlsZFRvKHRoaXMpLnNldEFscGhhKDAuNSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/liKTlrprlkIzlo6vjgYzjgbbjgaTjgYvjgaPjgZ/loLTlkIjjga7lh6bnkIZcbiAgICBidW1wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVmZmVjdCh0aGlzLngsIHRoaXMueSwge25hbWU6IFwiaGl0XCJ9KTtcbiAgICAgICAgaWYgKHRoaXMubWFzdGVyKSB7XG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgIHBsLmtub2NrYmFjayg1LCB0aGlzLm1hc3Rlci5kaXJlY3Rpb24pO1xuICAgICAgICAgICAgdGhpcy5tYXN0ZXIua25vY2tiYWNrKDUsICh0aGlzLm1hc3Rlci5kaXJlY3Rpb24gKyAxODApICUgMzYwKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJ0aW5rbGluZ1wiKTtcbiAgICAgICAgfVxuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgaXRlbS5qc1xuICogIDIwMTcvMDEvMDRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Ki44Kk44OG44Og44Kv44Op44K5XG5waGluYS5kZWZpbmUoXCJxZnQuSXRlbVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuQ2hhcmFjdGVyXCIsXG5cbiAgICAvL+itmOWIpeODleODqeOCsFxuICAgIGlzSXRlbTogdHJ1ZSxcblxuICAgIC8v44Ki44Kk44OG44Og56iu5YilXG4gICAga2luZDogMCxcblxuICAgIC8v44Ki44Kk44OG44Og44Os44OZ44OrXG4gICAgbGV2ZWw6IDAsXG5cbiAgICAvL+aNqOOBpuOCouOCpOODhuODoFxuICAgIHRocm93QXdheTogZmFsc2UsXG5cbiAgICAvL+Wkp+OBvuOBi+OBqueoruWIpeODleODqeOCsFxuICAgIGlzV2VhcG9uOiBmYWxzZSxcbiAgICBpc0VxdWlwOiBmYWxzZSxcbiAgICBpc0Zvb2Q6IGZhbHNlLFxuICAgIGlzSXRlbTogZmFsc2UsXG4gICAgaXNLZXk6IGZhbHNlLFxuXG4gICAgLy/mlbXjg4njg63jg4Pjg5fjgqLjgqTjg4bjg6Djg5Xjg6njgrBcbiAgICBpc0VuZW15RHJvcDogZmFsc2UsXG5cbiAgICAvL+OCouOCpOODhuODoOaDheWgsVxuICAgIHN0YXR1czogbnVsbCxcblxuICAgIC8v5Y+N55m65L+C5pWwXG4gICAgcmVib3VuZDogMC4zLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PpgLLooYzlj6/og73jg5Xjg6njgrAgICBcbiAgICBpc0FkdmFuY2VBbmltYXRpb246IGZhbHNlLFxuXG4gICAgLy/lvbHooajnpLrjg5Xjg6njgrBcbiAgICBpc1NoYWRvdzogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwge3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuXG4gICAgICAgIC8v44Ki44Kk44OG44Og44Os44OZ44OrXG4gICAgICAgIHRoaXMubGV2ZWwgPSAwO1xuICAgICAgICB0aGlzLmtpbmQgPSBudWxsO1xuICAgICAgICBpZiAob3B0aW9ucy5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICB0aGlzLmxldmVsID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmxldmVsIHx8IDA7XG4gICAgICAgICAgICB0aGlzLmtpbmQgPSBvcHRpb25zLnByb3BlcnRpZXMua2luZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5raW5kICE9PSB1bmRlZmluZWQpIHRoaXMua2luZCA9IG9wdGlvbnMua2luZDtcblxuICAgICAgICAvL+OCouOCpOODhuODoOeoruWIpVxuICAgICAgICBpZiAodGhpcy5raW5kID09IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLm5hbWUgPT0gXCJmb29kXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmtpbmQgPSBJVEVNX0FQUExFICsgdGhpcy5sZXZlbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBcIklURU1fXCIrb3B0aW9ucy5uYW1lLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5raW5kID0gZXZhbChuYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy5raW5kID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB2YXIgbmFtZSA9IFwiSVRFTV9cIit0aGlzLmtpbmQudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIHRoaXMua2luZCA9IGV2YWwobmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+OCouOCpOODhuODoOOCueODhuODvOOCv+OCueWPluW+l1xuICAgICAgICB0aGlzLiRleHRlbmQocWZ0Lkl0ZW1JbmZvLmdldCh0aGlzLmtpbmQpKTtcblxuICAgICAgICAvL+OCouOCpOODhuODoOOCueODl+ODqeOCpOODiFxuICAgICAgICBpZiAodGhpcy5pc1dlYXBvbikge1xuICAgICAgICAgICAgLy/mrablmajjga7loLTlkIhcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXMua2luZCAqIDEwICsgTWF0aC5taW4odGhpcy5sZXZlbCwgdGhpcy5tYXhJbmRleCk7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleChpbmRleCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsID4gMCkge1xuICAgICAgICAgICAgICAgIC8v5by35YyW44Os44OZ44Or6KGo56S6XG4gICAgICAgICAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGw6IFwid2hpdGVcIixcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiT3JiaXRyb25cIixcbiAgICAgICAgICAgICAgICAgICAgYWxpZ246IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogMTAsXG4gICAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICcnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIitcIit0aGlzLmxldmVsfS4kc2FmZShsYWJlbFBhcmFtKSkuc2V0UG9zaXRpb24oNiwgNikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJpdGVtXCIsIDI0LCAyNCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KHRoaXMua2luZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+Wvv+WRvVxuICAgICAgICB0aGlzLmxpZmVTcGFuID0gMTUwO1xuXG4gICAgICAgIC8v44Ki44Kv44OG44Kj44OW44OV44Op44KwXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWN0aXZlID09PSB1bmRlZmluZWQgfHwgdGhpcy5vcHRpb25zLmFjdGl2ZSA9PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub24oJ2VudGVyZnJhbWUnLCBlID0+IHtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgIGlmICh0aGlzLmhpdFRlc3RFbGVtZW50KHBsKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgPiAxMCAmJiAhdGhpcy50aHJvd0F3YXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcGwuZ2V0SXRlbSh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGltZSA+IDMwICYmIHRoaXMudGhyb3dBd2F5KSB0aGlzLnRocm93QXdheSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0VuZW15RHJvcCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxpZmVTcGFuID09IDApIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGlmZVNwYW4gPCAzMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMiA9PSAwKSB0aGlzLnZpc2libGUgPSAhdGhpcy52aXNpYmxlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDYwKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudGltZSAlIDUgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubGlmZVNwYW4gPCA5MCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMTAgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5saWZlU3Bhbi0tO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxufSk7XG5cbnBoaW5hLmRlZmluZShcInFmdC5JdGVtSW5mb1wiLCB7XG4gICAgX3N0YXRpYzoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKGtpbmQpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoa2luZCkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzaG9ydHN3b3JkXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1NIT1JUU1dPUkQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlNIT1JUIFNXT1JEXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN3b3JkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1dlYXBvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzU2xhc2g6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHVuUG93ZXI6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxNCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDMwXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImxvbmdzd29yZFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9MT05HU1dPUkQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkxPTkcgU1dPUkRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3dvcmRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzV2VhcG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTbGFzaDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAxNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA3LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDI0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYXhcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQVg6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkFYXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImF4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1dlYXBvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzU2xhc2g6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0Jyb3c6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHVuUG93ZXI6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg6IDQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAyNlxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzcGVhclwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9TUEVBUjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiU1BFQVJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3BlYXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzV2VhcG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTdGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiA0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDM5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYm93XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0JPVzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQk9XXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImJvd1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNXZWFwb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0Jyb3c6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwicm9kXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1JPRDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiTUFHSUMgUk9EXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInJvZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNXZWFwb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0Jyb3c6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0ZpcmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogNyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImJvb2tcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQk9PSzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQk9PS1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJib29rXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1dlYXBvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQnJvdzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSG9seTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dW5Qb3dlcjogNDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhJbmRleDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDIwXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInNoaWVsZFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9TSElFTEQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlNISUVMRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJlcXVpcFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNFcXVpcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAxMDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJhcm1vclwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9BUk1PUjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQVJNT1JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZXF1aXBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRXF1aXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3dlcjogMzAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogNTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiaGF0XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0hBVDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiSEFUXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVxdWlwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VxdWlwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYm9vdHNcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQk9PVFM6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkJPT1RTXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVxdWlwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VxdWlwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDUwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZ3JvdmVcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fR1JPVkU6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkdST1ZFXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVxdWlwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VxdWlwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDUwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwicmluZ1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9SSU5HOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJSSU5HXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImVxdWlwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0VxdWlwOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG93ZXI6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDMwMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcInNjcm9sbFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9TQ1JPTEw6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlNDUk9MTFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpdGVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0l0ZW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwibGV0dGVyXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0xFVFRFUjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiTEVUVEVSXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAxMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImNhcmRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQ0FSRDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiQ0FSRFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpdGVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0l0ZW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwia2V5XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0tFWTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiS0VZXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImtleVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNLZXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMjAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY29pblwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9DT0lOOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJDT0lOXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiA1MDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImJhZ1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9CQUc6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkJBR1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpdGVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0l0ZW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogMTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwib3JiXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX09SQjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiT1JCXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiA1MDAwLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdG9uZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9TVE9ORTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiU1RPTkVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaXRlbVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNJdGVtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQ6IDIwMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FzZSBcImpld2VsXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX0pFV0VMOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJKRVdFTFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpdGVtXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0l0ZW06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDogNTAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiamV3ZWxib3hcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fSkVXRUxCT1g6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkpFV0VMQk9YXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50OiAxMDAwMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYXBwbGVcIjpcbiAgICAgICAgICAgICAgICBjYXNlIElURU1fQVBQTEU6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIkFQUExFXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImZvb2RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRm9vZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAyMCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwiaGFyYlwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9IQVJCOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJIQVJCXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImZvb2RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRm9vZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiA0MCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwibWVhdFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgSVRFTV9NRUFUOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJNRUFUXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImZvb2RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRm9vZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiA2MCxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXNlIFwicG90aW9uXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBJVEVNX1BPVElPTjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiUE9USU9OXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImZvb2RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRm9vZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgIH0sXG59KTtcblxuIiwiLypcbiAqICBpdGVtYm94LmpzXG4gKiAgMjAxNy8wMS8wNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqLjgqTjg4bjg6Djg5zjg4Pjgq/jgrnjgq/jg6njgrlcbnBoaW5hLmRlZmluZShcInFmdC5JdGVtQm94XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNJdGVtQm94OiB0cnVlLFxuXG4gICAgLy/ogJDkuYXliptcbiAgICBocDogMSxcblxuICAgIC8v6ZaL44GE44Gf44OV44Op44KwXG4gICAgb3BlbmVkOiBmYWxzZSxcblxuICAgIC8v44Ki44Kk44OG44Og56iu5YilXG4gICAga2luZDogMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDMsXG5cbiAgICAvL+WPjeeZuuS/guaVsFxuICAgIHJlYm91bmQ6IDAuMyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IDI2LCBoZWlnaHQ6IDI2fS4kc2FmZShvcHRpb25zLnByb3BlcnRpZXMpKTtcblxuICAgICAgICAvL+OCouOCpOODhuODoOODnOODg+OCr+OCueOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiaXRlbWJveFwiLCAzMiwgMzIpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFNjYWxlKDAuOClcbiAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KDApO1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwiY2xvc2VcIik7XG5cbiAgICAgICAgLy/lhoXlrrnnialcbiAgICAgICAgdGhpcy5uYW1lID0gb3B0aW9ucy5uYW1lO1xuICAgICAgICB0aGlzLmtpbmQgPSBvcHRpb25zLnByb3BlcnRpZXM/IG9wdGlvbnMucHJvcGVydGllcy5raW5kOiB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGV2ZWwgPSBvcHRpb25zLnByb3BlcnRpZXM/IG9wdGlvbnMucHJvcGVydGllcy5sZXZlbDogMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wZW5lZCkge1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmlLvmkoPvvIjlm7rlrprvvInjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgaWYgKHBsLmlzQXR0YWNrICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQocGwuYXR0YWNrQ29sbGlzaW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGFtYWdlKHBsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O85pS75pKD5Yik5a6a44Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYW1hZ2UoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlOyAgICAvL+eCuea7heOCreODo+ODs+OCu+ODq1xuICAgIH0sXG5cbiAgICBkYW1hZ2U6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICBpZiAodGhpcy5vcGVuZWQpIHJldHVybjtcbiAgICAgICAgdGhpcy5ocCAtPSB0YXJnZXQucG93ZXI7XG4gICAgICAgIHRoaXMubXV0ZWtpVGltZSA9IDEwO1xuICAgICAgICBpZiAodGhpcy5ocCA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy54IDwgdGFyZ2V0LngpIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlQnkoLTUsIDAsIDIpLm1vdmVCeSg1LCAwLCAyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKS5tb3ZlQnkoNSwgMCwgMikubW92ZUJ5KC01LCAwLCAyKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICB0aGlzLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwib3BlblwiKTtcbiAgICAgICAgc3dpdGNoICh0aGlzLm5hbWUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJlbXB0eVwiOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIml0ZW1cIjpcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBraW5kOiB0aGlzLmtpbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogdGhpcy5sZXZlbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25JdGVtKHRoaXMueCwgdGhpcy55LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGkudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLndhaXQoMTApXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IHRoaXMubGV2ZWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduSXRlbSh0aGlzLngsIHRoaXMueSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpLnZ5ID0gLTU7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY29sb3IgPT0gXCJnb2xkXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJjbG9zZVwiXSA9IFsyXTtcbiAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJvcGVuXCJdID0gWzIsIDYsIDgsIFwic3RvcFwiXTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuY29sb3IgPT0gXCJyZWRcIikge1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlXCJdID0gWzFdO1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5cIl0gPSBbMSwgNCwgNywgXCJzdG9wXCJdO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5jb2xvciA9PSBcImJsdWVcIikge1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlXCJdID0gWzBdO1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5cIl0gPSBbMCwgMywgNiwgXCJzdG9wXCJdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlXCJdID0gWzFdO1xuICAgICAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5cIl0gPSBbMSwgNCwgNywgXCJzdG9wXCJdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgbWFwb2JqZWN0LmpzXG4gKiAgMjAxNy8wMS8xNFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucWZ0Lk1hcE9iamVjdCA9IHFmdC5NYXBPYmplY3QgfHwge307XG5cbi8v44OB44Kn44OD44Kv44Ki44Kk44Kz44OzXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkNoZWNrSWNvblwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuQ2hhcmFjdGVyXCIsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAuMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDMsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IDM2LCBoZWlnaHQ6IDY0fSk7XG4gICAgICAgIHRoaXMuJHNhZmUob3B0aW9ucyk7XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImNoZWNraWNvblwiLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihlKSB7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImluXCJdID0gWzIsIDEsIDBdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSBbNSwgNCwgM107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzgsIDcsIDZdO1xuICAgICAgICB0aGlzLmZyYW1lW1wib3V0XCJdID0gWzExLCAxMCwgOV07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcblxuLy/jg6Hjg4Pjgrvjg7zjgrjooajnpLpcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuTWVzc2FnZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICAvL+OCquODluOCuOOCp+OCr+ODiElEXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+S4gOWbnuOBruOBv+ihqOekuuODleODqeOCsFxuICAgIG9uY2U6IGZhbHNlLFxuXG4gICAgLy/ooajnpLrmuIjjgb/jg5Xjg6njgrBcbiAgICBhbHJlYWR5UmVhZDogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuICAgICAgICB0aGlzLmlkID0gb3B0aW9ucy5pZDtcbiAgICAgICAgdGhpcy5vbmNlID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm9uY2UgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMudGV4dCA9IG9wdGlvbnMucHJvcGVydGllcy50ZXh0IHx8IFwiVEVTVFwiO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBoaXQgPSB0aGlzLmhpdFRlc3RFbGVtZW50KHBsKTtcbiAgICAgICAgaWYgKGhpdCAmJiAhdGhpcy5hbHJlYWR5UmVhZCkge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkV2ZW50TWVzc2FnZSh0aGlzLmlkLCB0aGlzLnRleHQpO1xuICAgICAgICAgICAgdGhpcy5hbHJlYWR5UmVhZCA9IHRydWU7XG5cbiAgICAgICAgICAgIC8v5LiA5Zue44Gu44G/44Gu5aC05ZCI44Gv44Oq44Og44O844OWXG4gICAgICAgICAgICBpZiAodGhpcy5vbmNlKSB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/liKTlrprjgpLlpJbjgozjgZ/jgonooajnpLrmuIjjgb/jg5Xjg6njgrDjgpLlpJbjgZlcbiAgICAgICAgaWYgKCFoaXQgJiYgdGhpcy5hbHJlYWR5UmVhZCkgdGhpcy5hbHJlYWR5UmVhZCA9IGZhbHNlO1xuICAgIH0sXG59KTtcblxuLy/jgqTjg5njg7Pjg4hcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuRXZlbnRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgLy/jgqrjg5bjgrjjgqfjgq/jg4hJRFxuICAgIGlkOiBudWxsLFxuXG4gICAgLy/kuIDlm57jga7jgb/ooajnpLrjg5Xjg6njgrBcbiAgICBvbmNlOiBmYWxzZSxcblxuICAgIC8v5a6f6KGM5riI44G/44OV44Op44KwXG4gICAgYWxyZWFkeTogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuICAgICAgICB0aGlzLmlkID0gb3B0aW9ucy5pZDtcbiAgICAgICAgdGhpcy5vbmNlID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm9uY2UgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMucHJvcGVydGllcyA9IG9wdGlvbnMucHJvcGVydGllcztcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgaGl0ID0gdGhpcy5oaXRUZXN0RWxlbWVudChwbCk7XG4gICAgICAgIGlmIChoaXQgJiYgIXRoaXMuYWxyZWFkeVJlYWQpIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FdmVudE1lc3NhZ2UodGhpcy5pZCwgdGhpcy50ZXh0KTtcbiAgICAgICAgICAgIHRoaXMuYWxyZWFkeSA9IHRydWU7XG5cbiAgICAgICAgICAgIC8v5LiA5Zue44Gu44G/44Gu5aC05ZCI44Gv44Oq44Og44O844OWXG4gICAgICAgICAgICBpZiAodGhpcy5vbmNlKSB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/liKTlrprjgpLlpJbjgozjgZ/jgonlrp/ooYzmuIjjgb/jg5Xjg6njgrDjgpLlpJbjgZlcbiAgICAgICAgaWYgKCFoaXQgJiYgdGhpcy5hbHJlYWR5KSB0aGlzLmFscmVhZHlSZWFkID0gZmFsc2U7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBwbGF5ZXIuanNcbiAqICAyMDE2LzEyLzI4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuUGxheWVyXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNQbGF5ZXI6IHRydWUsXG5cbiAgICAvL+acgOWkp+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwTWF4OiAxMDAsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMDAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v5rCX57W256K6546HXG4gICAgc3R1blBvd2VyOiAxLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZlbnNlOiAxMCxcblxuICAgIC8v56e75YuV6YCf5bqmXG4gICAgc3BlZWQ6IDUsXG5cbiAgICAvL+eZu+WdgumAn+W6plxuICAgIHNwZWVkQXNjZW5kOiA0LFxuXG4gICAgLy/kuIvmirzjgZfpgKPntprjg5Xjg6zjg7zjg6DmlbBcbiAgICBkb3duRnJhbWU6IDAsXG5cbiAgICAvL+WkmuauteOCuOODo+ODs+ODl+WPr+iDveWbnuaVsFxuICAgIG51bUp1bXA6IDAsXG4gICAgbnVtSnVtcE1heDogMSxcblxuICAgIC8v5omA5oyB6KOF5YKZ44Ki44Kk44OG44OgXG4gICAgZXF1aXA6IG51bGwsXG5cbiAgICAvL+OCouOCpOODhuODoOaJgOaMgeacgOWkp+aVsFxuICAgIG1heEl0ZW06IDEwLFxuXG4gICAgLy/miYDmjIHjgqLjgqTjg4bjg6BcbiAgICBpdGVtczogbnVsbCxcblxuICAgIC8v5omA5oyB44Kv44Oq44Ki5p2h5Lu244Kt44O8XG4gICAga2V5czogbnVsbCxcblxuICAgIC8v5pON5L2c5Y+v6IO944OV44Op44KwXG4gICAgaXNDb250cm9sOiB0cnVlLFxuXG4gICAgLy/mlLvmkoPkuK3jg5Xjg6njgrBcbiAgICBpc0F0dGFjazogZmFsc2UsXG5cbiAgICAvL+mYsuW+oeS4reODleODqeOCsFxuICAgIGlzRGVmZW5zZTogZmFsc2UsXG5cbiAgICAvL+ODieOCouS4iuODleODqeOCsFxuICAgIGlzT25Eb29yOiBmYWxzZSxcblxuICAgIC8v44OA44Of44O86KGo56S644K544OX44Op44Kk44OIXG4gICAgZHVtbXk6IG51bGwsXG5cbiAgICAvL+W9seihqOekuuODleODqeOCsFxuICAgIGlzU2hhZG93OiB0cnVlLFxuXG4gICAgLy/jgqrjg7zjg4jjg5HjgqTjg63jg4Pjg4hcbiAgICBpc0F1dG86IGZhbHNlLFxuICAgIGF1dG9LZXk6IHtcbiAgICAgICAgdXA6IGZhbHNlLFxuICAgICAgICByaWdodDogZmFsc2UsXG4gICAgICAgIGRvd246IGZhbHNlLFxuICAgICAgICBsZWZ0OiBmYWxzZSxcbiAgICAgICAgYXR0YWNrOiBmYWxzZSxcbiAgICAgICAganVtcDogZmFsc2UsXG4gICAgfSxcblxuICAgIC8v5YmN44OV44Os44O844Og44Gu5oOF5aCxXG4gICAgYmVmb3JlOiB7XG4gICAgICAgIC8v5pON5L2c57O7XG4gICAgICAgIHVwOiBmYWxzZSxcbiAgICAgICAgZG93bjogZmFsc2UsXG4gICAgICAgIGF0dGFjazogZmFsc2UsXG4gICAgICAgIGp1bXA6IGZhbHNlLFxuICAgICAgICBjaGFuZ2U6IGZhbHNlLFxuICAgICAgICBpc1N0dW46IGZhbHNlLFxuICAgICAgICBpc09uRmxvb3I6IGZhbHNlLFxuICAgICAgICB4OiAwLFxuICAgICAgICB5OiAwLFxuICAgIH0sXG5cbiAgICAvL+OCueODhuODvOOCuOmWi+Wni+aZguOCueODhuODvOOCv+OCuVxuICAgIHN0YXJ0U3RhdHVzOiBudWxsLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHt3aWR0aDogMTYsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIC8v44K544OX44Op44Kk44OI6IOM5b6MXG4gICAgICAgIHRoaXMuYmFjayA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMpLnNldFNjYWxlKC0xLCAxKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwicGxheWVyMVwiLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCgwKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2NhbGVYID0gLTE7XG5cbiAgICAgICAgLy/mrablmajnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy53ZWFwb24gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5iYWNrKVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoMClcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMSwgMSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigzLCAzKTtcbiAgICAgICAgdGhpcy53ZWFwb24uYWxwaGEgPSAwO1xuICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICB0aGlzLndlYXBvbi50eXBlID0gXCJzd29yZFwiO1xuXG4gICAgICAgIC8v55u+XG4gICAgICAgIHRoaXMuc2hpZWxkID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJpdGVtXCIsIDI0LCAyNClcbi8vICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KDcpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oMTAsIDYpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMC44KVxuICAgICAgICAgICAgLnNldFZpc2libGUoZmFsc2UpO1xuXG4gICAgICAgIC8v5pS75pKD5Yik5a6a55SoXG4gICAgICAgIHRoaXMuYXR0YWNrQ29sbGlzaW9uID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IDE0LCBoZWlnaHQ6IDI2fSk7XG4gICAgICAgIC8v5b2T44Gf44KK5Yik5a6a44OH44OQ44OD44Kw55SoXG4gICAgICAgIGlmIChERUJVR19DT0xMSVNJT04pIHtcbiAgICAgICAgICAgIHRoaXMub25lKCdlbnRlcmZyYW1lJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24uYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFja0NvbGxpc2lvbi5hbHBoYSA9IDAuMztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5vbigncmVtb3ZlZCcsIGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrQ29sbGlzaW9uLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaDheWgseOBruWIneacn+WMllxuICAgICAgICB0aGlzLnJlc2V0KCk7XG5cbiAgICAgICAgLy/jga/jgZfjgZTliKTlrprnlKhcbiAgICAgICAgdGhpcy5sYWRkZXJDb2xsaXNpb24gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMTYsIGhlaWdodDogMjB9KTtcblxuICAgICAgICAvL+WIneacn+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYmVmb3JlQW5pbWF0aW9uID0gXCJcIjtcblxuICAgICAgICAvL+atu+S6oeaZguOCs+ODvOODq+ODkOODg+OCr1xuICAgICAgICB0aGlzLm9uKCdkZWFkJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZSgnZ2FtZW92ZXInKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgrjplovlp4vmmYLjgrnjg4bjg7zjgr/jgrlcbiAgICAgICAgdGhpcy5zYXZlU3RhdHVzKCk7XG5cbiAgICAgICAgLy/mnIDlvozjgavluorkuIrjgavjgYTjgZ/loLTmiYDjgpLkv53lrZhcbiAgICAgICAgdGhpcy5sYXN0T25GbG9vclggPSAwO1xuICAgICAgICB0aGlzLmxhc3RPbkZsb29yWSA9IDA7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudFNjZW5lLnBhdXNlU2NlbmUpIHJldHVybjtcblxuICAgICAgICAvL+OCquODluOCuOOCp+OCr+ODiOODrOOCpOODpOODvOaOpeinpuWIpOWumlxuICAgICAgICB0aGlzLmlzT25Eb29yID0gbnVsbDtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5vYmpMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIC8v5omJ5Yik5a6aXG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5NYXBPYmplY3QuRG9vciB8fCBlIGluc3RhbmNlb2YgcWZ0Lk1hcE9iamVjdC5HYXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUuaGl0VGVzdEVsZW1lbnQodGhpcykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09uRG9vciA9IGU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgLy/mrbvkuqHmmYLjga/kvZXjgoLlh7rmnaXjgarjgYRcbiAgICAgICAgaWYgKHRoaXMuaXNEZWFkKSB7XG4gICAgICAgICAgICAvL+ODnuODg+ODl+WkluiQveS4i1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNEcm9wKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ocCA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJkcm9wXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbi8vICAgICAgICB0aGlzLnNoaWVsZC5zZXRWaXNpYmxlKGZhbHNlKTtcbi8vICAgICAgICB0aGlzLmlzRGVmZW5zZSA9IGZhbHNlO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85pON5L2cXG4gICAgICAgIHZhciBjdCA9IGFwcC5jb250cm9sbGVyO1xuICAgICAgICAvL+ODkOODvOODgeODo+ODq+ODkeODg+ODieaDheWgseWPluW+l1xuICAgICAgICB2YXIgdnAgPSBhcHAudmlydHVhbFBhZDtcbiAgICAgICAgaWYgKHZwLmdldEtleShcInVwXCIpKSBjdC51cCA9IHRydWU7XG4gICAgICAgIGlmICh2cC5nZXRLZXkoXCJyaWdodFwiKSkgY3QucmlnaHQgPSB0cnVlO1xuICAgICAgICBpZiAodnAuZ2V0S2V5KFwiZG93blwiKSkgY3QuZG93biA9IHRydWU7XG4gICAgICAgIGlmICh2cC5nZXRLZXkoXCJsZWZ0XCIpKSBjdC5sZWZ0ID0gdHJ1ZTtcbiAgICAgICAgaWYgKHZwLmdldEtleShcIlpcIikpIGN0LmF0dGFjayA9IHRydWU7XG4gICAgICAgIGlmICh2cC5nZXRLZXkoXCJYXCIpKSBjdC5qdW1wID0gdHJ1ZTtcblxuICAgICAgICAvL+OCquODvOODiOODkeOCpOODreODg+ODiFxuICAgICAgICBpZiAodGhpcy5pc0F1dG8pIHtcbiAgICAgICAgICAgIGN0ID0gdGhpcy5hdXRvS2V5O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzQ29udHJvbCkgY3QgPSB7fTtcbiAgICAgICAgaWYgKHRoaXMuc3RvcFRpbWUgPT0gMCkge1xuICAgICAgICAgICAgLy/lt6bnp7vli5VcbiAgICAgICAgICAgIGlmIChjdC5sZWZ0ICYmICFjdC5kb3duKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzSnVtcCAmJiAhdGhpcy5pc0F0dGFjayAmJiAhdGhpcy5pc0NhdGNoTGFkZGVyKSB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgICAgICAgICAgLy/jga/jgZfjgZTmjrTjgb/nirbmhYvjgaflt6bjgavlo4HjgYzjgYLjgovloLTlkIjjga/kuI3lj69cbiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2NvbGxpc2lvblszXTtcbiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLmlzQ2F0Y2hMYWRkZXIgJiYgdGhpcy5jaGVja01hcENvbGxpc2lvbjIoYy54KzYsIGMueSwgYy53aWR0aCwgYy5oZWlnaHQpKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLXRoaXMuc3BlZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/lj7Pnp7vli5VcbiAgICAgICAgICAgIGlmIChjdC5yaWdodCAmJiAhY3QuZG93bikge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0p1bXAgJiYgIXRoaXMuaXNBdHRhY2sgJiYgIXRoaXMuaXNDYXRjaExhZGRlcikgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICAgICAgICAgIC8v44Gv44GX44GU5o6044G/54q25oWL44Gn5Y+z44Gr5aOB44GM44GC44KL5aC05ZCI44Gv5LiN5Y+vXG4gICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLl9jb2xsaXNpb25bMV07XG4gICAgICAgICAgICAgICAgaWYgKCEodGhpcy5pc0NhdGNoTGFkZGVyICYmIHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKGMueC02LCBjLnksIGMud2lkdGgsIGMuaGVpZ2h0KSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gdGhpcy5zcGVlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v6aCt5LiK6Laz5YWD44Gv44GX44GU5qSc55+lXG4gICAgICAgICAgICB2YXIgaGVhZExhZGRlciA9IHRoaXMuY2hlY2tIZWFkTGFkZGVyKCk7XG4gICAgICAgICAgICB2YXIgZm9vdExhZGRlciA9IHRoaXMuY2hlY2tGb290TGFkZGVyKCk7XG5cbiAgICAgICAgICAgIC8v44Gv44GX44GU5o6044G/54q25oWL44Gn5pON5L2c5YiG5bKQXG4gICAgICAgICAgICBpZiAodGhpcy5pc0NhdGNoTGFkZGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGN0LnVwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLXRoaXMuc3BlZWRBc2NlbmQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5fY29sbGlzaW9uWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWhlYWRMYWRkZXIgJiYgdGhpcy5jaGVja01hcENvbGxpc2lvbjIoYy54LCBjLnktNiwgYy53aWR0aCwgYy5oZWlnaHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY3QuZG93bikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IHRoaXMuc3BlZWRBc2NlbmQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL+OCuOODo+ODs+ODl+ODnOOCv+ODs+OBruOBv1xuICAgICAgICAgICAgICAgIGlmIChjdC5qdW1wICYmICFjdC51cCkge1xuICAgICAgICAgICAgICAgICAgICAvL+OCuOODo+ODs+ODl+S6jOauteebruS7pemZjVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0p1bXAgJiYgdGhpcy5udW1KdW1wIDwgdGhpcy5udW1KdW1wTWF4ICYmIHRoaXMudnkgPiAtNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubnVtSnVtcCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v44K444Oj44Oz44OXXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGsgPSB0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngsIHRoaXMueS0xNiwgNSwgMyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0p1bXAgJiYgdGhpcy5pc09uRmxvb3IgJiYgIWNoaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJqdW1wXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubnVtSnVtcCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy/kuIrjgq3jg7zmirzkuItcbiAgICAgICAgICAgICAgICBpZiAoY3QudXApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jgrjjg6Pjg7Pjg5fkuozmrrXnm67ku6XpmY1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNKdW1wICYmIHRoaXMubnVtSnVtcCA8IHRoaXMubnVtSnVtcE1heCAmJiB0aGlzLnZ5ID4gLTUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTE7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm51bUp1bXArKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL+OCuOODo+ODs+ODl1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2hrID0gdGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LCB0aGlzLnktMTYsIDUsIDMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNKdW1wICYmIHRoaXMuaXNPbkZsb29yICYmICF0aGlzLmlzT25MYWRkZXIgJiYgIWNoaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJqdW1wXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubnVtSnVtcCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/jga/jgZfjgZTjgpLmmIfjgovvvIjpmo7mrrXjga/mjqXlnLDmmYLjga7jgb/vvIlcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPbkxhZGRlciAmJiAhdGhpcy5pc09uU3RhaXJzIHx8IHRoaXMuaXNPbkZsb29yICYmIHRoaXMuaXNPblN0YWlycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50aHJvdWdoRmxvb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v5omJ44Gr5YWl44KL77yI5o6l5Zyw5pmC77yG5bem5Y+z44Kt44O844Kq44OV5pmC44Gu44G/77yJXG4gICAgICAgICAgICAgICAgICAgIGlmICghY3QubGVmdCAmJiAhY3QucmlnaHQgJiYgdGhpcy5pc09uRmxvb3IgJiYgdGhpcy5pc09uRG9vciAmJiAhdGhpcy5pc09uRG9vci5pc0xvY2sgJiYgIXRoaXMuaXNPbkRvb3IuYWxyZWFkeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPbkRvb3IuZmxhcmUoJ2VudGVyZG9vcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09uRG9vci5hbHJlYWR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy/kuIvjgq3jg7zmirzkuItcbiAgICAgICAgICAgICAgICBpZiAoY3QuZG93bikge1xuICAgICAgICAgICAgICAgICAgICAvL+OBr+OBl+OBlOOCkumZjeOCiuOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoZm9vdExhZGRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50aHJvdWdoRmxvb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v5bqK44K544Or44O8XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvd25GcmFtZSA+IDYgJiYgIXRoaXMuanVtcCAmJiAhZm9vdExhZGRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yICYmICF0aGlzLnRocm91Z2hGbG9vcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmbG9vciA9IHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCwgdGhpcy55KzE2LCA1LCA1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmxvb3IgJiYgZmxvb3JbMF0uZW5hYmxlVGhyb3VnaCkgdGhpcy50aHJvdWdoRmxvb3IgPSBmbG9vclswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL+ebvuOCkuani+OBiOOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNBdHRhY2spIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGllbGQuc2V0VmlzaWJsZSh0cnVlKTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0RlZmVuc2UgPSB0cnVlO1xuLy8gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImRlZmVuc2VcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44Gv44GX44GU44GL44KJ5aSW44KM44Gf44KJ5qKv5a2Q5o6044G/54q25oWL44Kt44Oj44Oz44K744OrXG4gICAgICAgIGlmICh0aGlzLmlzQ2F0Y2hMYWRkZXIpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc09uTGFkZGVyICYmICFjdC5kb3duIHx8IHRoaXMuaXNPbkxhZGRlciAmJiAhZm9vdExhZGRlciAmJiAhY3QudXApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v5pS75pKDXG4gICAgICAgIGlmICghdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uICE9IFwiZGFtYWdlXCIgJiYgIXRoaXMuaXNEZWZlbnNlKSB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNDYXRjaExhZGRlcikge1xuICAgICAgICAgICAgICAgIGlmIChjdC51cCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3QuZG93bikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc09uU3RhaXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImRvd25cIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNTdHVuICYmICF0aGlzLmlzRGVhZCkgdGhpcy5zZXRBbmltYXRpb24oXCJqdW1wXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN0LmF0dGFjayAmJiAhdGhpcy5iZWZvcmUuYXR0YWNrICYmIHRoaXMuc3RvcFRpbWUgPT0gMCAmJiAhKHRoaXMuaXNDYXRjaExhZGRlciAmJiB0aGlzLmlzT25MYWRkZXIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0NhdGNoTGFkZGVyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJhdHRhY2tcIik7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb25BdHRhY2soKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/mrablmajjga7lpInmm7RcbiAgICAgICAgICAgIGlmIChjdC5jaGFuZ2UgJiYgIXRoaXMuYmVmb3JlLmNoYW5nZSAmJiB0aGlzLmVxdWlwLnN3aXRjaE9rKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hXZWFwb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v5rCX57W254q25oWLXG4gICAgICAgIGlmICh0aGlzLmlzU3R1bikge1xuICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJzdHVuXCIpO1xuXG4gICAgICAgICAgICAvL+air+WtkOaOtOOBv+OCreODo+ODs+OCu+ODq1xuICAgICAgICAgICAgdGhpcy5pc0NhdGNoTGFkZGVyID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8v44Os44OQ44Ks44OB44Oj44Gn5rCX57W25b6p5biw44KS5pep44KB44KLXG4gICAgICAgICAgICBpZiAoY3QubGVmdCAmJiAhY3QuYmVmb3JlLmxlZnQgfHxcbiAgICAgICAgICAgICAgICBjdC5yaWdodCAmJiAhY3QuYmVmb3JlLnJpZ2h0IHx8XG4gICAgICAgICAgICAgICAgY3QudXAgJiYgIWN0LmJlZm9yZS51cCB8fFxuICAgICAgICAgICAgICAgIGN0LmRvd24gJiYgIWN0LmJlZm9yZS5kb3duKSB0aGlzLnN0b3BUaW1lIC09IDI7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5iZWZvcmUuaXNTdHVuKSB7XG4gICAgICAgICAgICAvL+awl+e1tuW+qeW4sOOBl+OBn+OCieOCouODi+ODoeODvOOCt+ODp+ODs+OCkuaomea6luOBq1xuICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJzdGFuZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5q275Lqh54q25oWLXG4gICAgICAgIGlmICh0aGlzLmlzRGVhZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJkZWFkXCIpO1xuICAgICAgICAgICAgdGhpcy5pc0NhdGNoTGFkZGVyID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+WkieabtOOCkuaknOefpVxuICAgICAgICBpZiAodGhpcy5ub3dBbmltYXRpb24gIT0gdGhpcy5iZWZvcmVBbmltYXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vd0FuaW1hdGlvbiA9PSBcImF0dGFja1wiKSB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMjtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vd0FuaW1hdGlvbiA9PSBcImRlZmVuc2VcIikgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL+atqeihjOOCouODi+ODoeODvOOCt+ODp+ODs+OBruWgtOWQiOOBr+enu+WLleOBl+OBpuOBhOOCi+aZguOBruOBv+mAsuOCgeOCi1xuICAgICAgICAgICAgaWYgKHRoaXMubm93QW5pbWF0aW9uID09IFwid2Fsa1wiICYmICFjdC5sZWZ0ICYmICFjdC5yaWdodCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLm5vd0FuaW1hdGlvbiA9PSBcInVwXCIgfHwgdGhpcy5ub3dBbmltYXRpb24gPT0gXCJkb3duXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3QudXAgfHwgY3QuZG93biB8fCBjdC5sZWZ0IHx8IGN0LnJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v5pS75pKD5Yik5a6a6L+95b6TXG4gICAgICAgIHRoaXMuYXR0YWNrQ29sbGlzaW9uLnggPSB0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDEyO1xuICAgICAgICB0aGlzLmF0dGFja0NvbGxpc2lvbi55ID0gdGhpcy55O1xuXG4gICAgICAgIC8v44Kz44Oz44OI44Ot44O844Op5LuW5oOF5aCx5L+d5a2YXG4gICAgICAgIHRoaXMuYmVmb3JlLnVwID0gY3QudXA7XG4gICAgICAgIHRoaXMuYmVmb3JlLmRvd24gPSBjdC5kb3duO1xuICAgICAgICB0aGlzLmJlZm9yZS5hdHRhY2sgPSBjdC5hdHRhY2s7XG4gICAgICAgIHRoaXMuYmVmb3JlLmp1bXAgPSBjdC51cCB8fCBjdC5qdW1wO1xuICAgICAgICB0aGlzLmJlZm9yZS5jaGFuZ2UgPSBjdC5jaGFuZ2U7XG4gICAgICAgIHRoaXMuYmVmb3JlLmlzU3R1biA9IHRoaXMuaXNTdHVuO1xuICAgICAgICB0aGlzLmJlZm9yZS5pbk9uRmxvb3IgPSB0aGlzLmlzT25GbG9vcjtcbiAgICAgICAgdGhpcy5iZWZvcmUueCA9IHRoaXMueDtcbiAgICAgICAgdGhpcy5iZWZvcmUueSA9IHRoaXMueTtcblxuICAgICAgICAvL+ODgOOCpuODs+OCreODvOmAo+e2muaKvOS4i+ODleODrOODvOODoOOCq+OCpuODs+ODiFxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgJiYgIXRoaXMuaXNDYXRjaExhZGRlciAmJiBjdC5kb3duICYmICFjdC5yaWdodCAmJiAhY3QubGVmdCAmJiAhY3QudXAgJiYgIWN0LmF0dGFjaykge1xuICAgICAgICAgICAgdGhpcy5kb3duRnJhbWUrKztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZG93bkZyYW1lID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5o6l5Zyw5pmC5bqn5qiZ5L+d5a2YXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciAmJiB0aGlzLl9jb2xsaXNpb25bMl0uaGl0LnR5cGUgIT0gXCJtb3ZlZmxvb3JcIikge1xuICAgICAgICAgICAgdGhpcy5sYXN0T25GbG9vclggPSB0aGlzLng7XG4gICAgICAgICAgICB0aGlzLmxhc3RPbkZsb29yWSA9IHRoaXMueTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODl+ODrOOCpOODpOODvOaDheWgseODquOCu+ODg+ODiFxuICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/np7vli5Xmg4XloLFcbiAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgIHRoaXMudnkgPSAwO1xuXG4gICAgICAgIC8v44K544OG44O844K/44K5XG4gICAgICAgIHRoaXMuaHAgPSB0aGlzLmhwTWF4O1xuXG4gICAgICAgIC8v5ZCE56iu44OV44Op44KwXG4gICAgICAgIHRoaXMuaXNKdW1wID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNEZWFkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNDYXRjaExhZGRlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzRHJvcCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzT25GbG9vciA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IHRydWU7XG4gICAgICAgIHRoaXMuaWdub3JlQ29sbGlzaW9uID0gZmFsc2U7XG5cbiAgICAgICAgLy/ntYzpgY7mmYLplpPns7tcbiAgICAgICAgdGhpcy5tdXRla2lUaW1lID0gMDtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDA7XG4gICAgICAgIHRoaXMuZG93bkZyYW1lID0gMDtcbiAgICAgICAgdGhpcy50aW1lID0gMDtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYmVmb3JlQW5pbWF0aW9uID0gXCJcIjtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDY7XG5cbiAgICAgICAgLy/miYDmjIHoo4XlgplcbiAgICAgICAgdGhpcy5lcXVpcCA9IHtcbiAgICAgICAgICAgIHVzaW5nOiAwLCAgICAgICAgIC8v54++5Zyo5L2/55So5Lit77yId2VhcG9uc+OBrmluZGV477yJXG4gICAgICAgICAgICB3ZWFwb25zOiBbMF0sICAgICAvL+aJgOaMgeODquOCueODiO+8iOacgOWkp++8k++8iVxuICAgICAgICAgICAgbGV2ZWw6IFswXSwgICAgICAgLy/mrablmajjg6zjg5njg6tcbiAgICAgICAgICAgIHN3aXRjaE9rOiB0cnVlLCAgIC8v5aSJ5pu05Y+v6IO944OV44Op44KwXG4gICAgICAgIH07XG5cbiAgICAgICAgLy/mrablmajjgrvjg4Pjg4hcbiAgICAgICAgdGhpcy5zZXRXZWFwb24odGhpcy5lcXVpcC53ZWFwb25zW3RoaXMuZXF1aXAudXNpbmddKTtcblxuICAgICAgICAvL+aJgOaMgeOCouOCpOODhuODoFxuICAgICAgICB0aGlzLml0ZW1zID0gW107XG5cbiAgICAgICAgLy/miYDmjIHjgq/jg6rjgqLmnaHku7bjgq3jg7xcbiAgICAgICAgdGhpcy5rZXlzID0gW107XG5cbiAgICAgICAgLy/mk43kvZzlj6/og73jg5Xjg6njgrBcbiAgICAgICAgdGhpcy5pc0NvbnRyb2wgPSB0cnVlO1xuXG4gICAgICAgIC8v5aSa5q6144K444Oj44Oz44OX5pyA5aSn5Zue5pWwXG4gICAgICAgIHRoaXMubnVtSnVtcE1heCA9IDA7XG5cbiAgICAgICAgLy/jg4Djg5/jg7zjgrnjg5fjg6njgqTjg4jpmaTljrtcbiAgICAgICAgaWYgKHRoaXMuZHVtbXkpIHtcbiAgICAgICAgICAgIHRoaXMuZHVtbXkucmVtb3ZlKCk7XG4gICAgICAgICAgICB0aGlzLmR1bW15ID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+ODl+ODrOOCpOODpOODvOaDheWgseOCs+ODs+ODhuOCo+ODi+ODpeODvOeUqOODquOCu+ODg+ODiFxuICAgIGNvbnRpbnVlUmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+enu+WLleaDheWgsVxuICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgdGhpcy52eSA9IDA7XG5cbiAgICAgICAgLy/jgrnjg4bjg7zjgr/jgrlcbiAgICAgICAgdGhpcy5ocCA9IHRoaXMuaHBNYXg7XG5cbiAgICAgICAgLy/lkITnqK7jg5Xjg6njgrBcbiAgICAgICAgdGhpcy5pc0p1bXAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0NhdGNoTGFkZGVyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNPbkZsb29yID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNBZHZhbmNlQW5pbWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pZ25vcmVDb2xsaXNpb24gPSBmYWxzZTtcblxuICAgICAgICAvL+e1jOmBjuaZgumWk+ezu1xuICAgICAgICB0aGlzLm11dGVraVRpbWUgPSAwO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgdGhpcy5kb3duRnJhbWUgPSAwO1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44OzXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5iZWZvcmVBbmltYXRpb24gPSBcIlwiO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcblxuICAgICAgICAvL+aTjeS9nOWPr+iDveODleODqeOCsFxuICAgICAgICB0aGlzLmlzQ29udHJvbCA9IHRydWU7XG5cbiAgICAgICAgLy/lpJrmrrXjgrjjg6Pjg7Pjg5fmnIDlpKflm57mlbBcbiAgICAgICAgdGhpcy5udW1KdW1wTWF4ID0gMDtcblxuICAgICAgICAvL+ODgOODn+ODvOOCueODl+ODqeOCpOODiOmZpOWOu1xuICAgICAgICBpZiAodGhpcy5kdW1teSkge1xuICAgICAgICAgICAgdGhpcy5kdW1teS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHRoaXMuZHVtbXkgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3ByaXRlLnZpc2libGUgPSB0cnVlO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+ODgOODoeODvOOCuOWHpueQhlxuICAgIGRhbWFnZTogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIGlmICh0aGlzLm11dGVraVRpbWUgPiAwKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICh0YXJnZXQucG93ZXIgPT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5pc0RlYWQpIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuaXNNdXRla2kpIHJldHVybiBmYWxzZTtcblxuICAgICAgICAvL+awl+e1tuOCreODo+ODs+OCu+ODq1xuICAgICAgICB0aGlzLmlzU3R1biA9IGZhbHNlO1xuXG4gICAgICAgIHZhciBkaXIgPSAwO1xuICAgICAgICBpZiAodGhpcy54IDwgdGFyZ2V0LngpIGRpciA9IDE4MDtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ2F0Y2hMYWRkZXIpIHRoaXMua25vY2tiYWNrKHRhcmdldC5wb3dlciwgZGlyKTtcblxuICAgICAgICB0aGlzLmhwIC09IHRhcmdldC5wb3dlcjtcbiAgICAgICAgdGhpcy5pc0NhdGNoTGFkZGVyID0gZmFsc2U7XG4gICAgICAgIGFwcC5wbGF5U0UoXCJkYW1hZ2VcIik7XG5cbiAgICAgICAgaWYgKHRoaXMuaHAgPD0gMCkge1xuICAgICAgICAgICAgdGhpcy5kZWFkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm11dGVraVRpbWUgPSA2MDtcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAxNTtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vd0FuaW1hdGlvbiAhPSBcImp1bXBcIikgdGhpcy5zZXRBbmltYXRpb24oXCJkYW1hZ2VcIik7XG5cbiAgICAgICAgICAgIC8v5rCX57W25Yik5a6aXG4gICAgICAgICAgICB2YXIgZGljZSA9IE1hdGgucmFuZGludCgxLCAxMDApO1xuICAgICAgICAgICAgaWYgKGRpY2UgPD0gdGFyZ2V0LnN0dW5Qb3dlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ3N0dW4nLCB7cG93ZXI6IDEwfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJzdHVuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICAvL+atu+S6oeaZguWHpueQhlxuICAgIGRlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmhwID0gMDtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzQ2F0Y2hMYWRkZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgIHRoaXMudnkgPSAtNjtcbiAgICAgICAgdmFyIHR3ID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0aGlzKS5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgdHcuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2RlYWQnKTtcbiAgICAgICAgICAgICAgICB0dy5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgLy/jg4Djg5/jg7zjgrnjg5fjg6njgqTjg4jov73liqBcbiAgICAgICAgdGhpcy5zcHJpdGUudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmR1bW15ID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5hZGRDaGlsZFRvKHRoaXMpLnNldEFuaW1hdGlvbihcImRlYWRcIik7XG4gICAgfSxcblxuICAgIC8v44Ki44Kk44OG44Og5Y+W5b6XXG4gICAgZ2V0SXRlbTogZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAvL+atpuWZqFxuICAgICAgICBpZiAoaXRlbS5pc1dlYXBvbikge1xuICAgICAgICAgICAgLy/ml6LjgavmjIHjgaPjgabjgYTjgovmrablmajjgYvjg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXMuZXF1aXAud2VhcG9ucy5maW5kSW5kZXgoZnVuY3Rpb24oZSwgaSwgYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlID09IGl0ZW0ua2luZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGluZGV4ID09IG51bGwgfHwgaW5kZXggPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAvL+aMgeOBo+OBpueEoeOBhOatpuWZqOOBoOOBo+OBn+WgtOWQiFxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVxdWlwLndlYXBvbnMubGVuZ3RoIDwgMykge1xuICAgICAgICAgICAgICAgICAgICAvL+ODquOCueODiOOBq+i/veWKoFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVxdWlwLndlYXBvbnMucHVzaChpdGVtLmtpbmQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVxdWlwLmxldmVsLnB1c2goaXRlbS5sZXZlbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy/nj77lnKjkvb/nlKjmrablmajjga7miYvliY3jga7mrablmajjgpLmjajjgabjgotcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRyb3BJbmRleCA9IHRoaXMuZXF1aXAudXNpbmcgPT0gMD8gMjogdGhpcy5lcXVpcC51c2luZyAtIDE7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ6IHRoaXMuZXF1aXAud2VhcG9uc1tkcm9wSW5kZXhdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsOiB0aGlzLmVxdWlwLmxldmVsW2Ryb3BJbmRleF0sXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB2YXIgZHJvcCA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25JdGVtKHRoaXMueCwgdGhpcy55LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgZHJvcC5mcmljdGlvbiA9IDAuODtcbiAgICAgICAgICAgICAgICAgICAgZHJvcC52eCA9IDAgKiAtdGhpcy5zY2FsZVg7XG4gICAgICAgICAgICAgICAgICAgIGRyb3AudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgZHJvcC50aHJvd0F3YXkgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVxdWlwLndlYXBvbnNbZHJvcEluZGV4XSA9IGl0ZW0ua2luZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcXVpcC5sZXZlbFtkcm9wSW5kZXhdID0gaXRlbS5sZXZlbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8v5omA5oyB5q2m5Zmo44KS5ou+44Gj44Gf44KJ44Gd44Gu5q2m5Zmo44Gu44Os44OZ44Or44GM5LiK44GM44KLXG4gICAgICAgICAgICAgICAgdGhpcy5lcXVpcC5sZXZlbFtpbmRleF0rKztcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSB0aGlzLmVxdWlwLndlYXBvbnNbdGhpcy5lcXVpcC51c2luZ107XG4gICAgICAgICAgICAgICAgdmFyIGx2ID0gdGhpcy5lcXVpcC5sZXZlbFt0aGlzLmVxdWlwLnVzaW5nXTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFdlYXBvbihpZCwgbHYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXBwLnBsYXlTRShcImdldGl0ZW1cIik7XG4gICAgICAgIH1cbiAgICAgICAgLy/oo4Xlgpnlk4FcbiAgICAgICAgaWYgKGl0ZW0uaXNFcXVpcCkge1xuICAgICAgICAgICAgdGhpcy5ocE1heCArPSAoaXRlbS5wb3dlciB8fCAwKTtcbiAgICAgICAgICAgIHRoaXMuaHAgKz0gKGl0ZW0ucG93ZXIgfHwgMCk7XG4gICAgICAgICAgICBpZiAodGhpcy5ocE1heCA+IDIwMCkgdGhpcy5ocE1heCA9IDIwMDtcbiAgICAgICAgICAgIGlmICh0aGlzLmhwID4gdGhpcy5ocE1heCkgdGhpcy5ocCA9IHRoaXMuaHBNYXg7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnRvdGFsU2NvcmUgKz0gKGl0ZW0ucG9pbnQgfHwgMCk7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwiZ2V0aXRlbVwiKTtcbiAgICAgICAgfVxuICAgICAgICAvL+mjn+OBueeJqVxuICAgICAgICBpZiAoaXRlbS5pc0Zvb2QpIHtcbiAgICAgICAgICAgIC8v44K544OG44O844K46YCy5bqm44Gr44KI44Gj44Gm5Zue5b6p6YeP44GM5aKX5YqgXG4gICAgICAgICAgICB2YXIgcG93ZXIgPSBpdGVtLnBvd2VyO1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50U2NlbmUuc3RhZ2VOdW1iZXIgPiA0KSBwb3dlciAqPSAxLjU7XG4gICAgICAgICAgICB0aGlzLmhwICs9IHBvd2VyO1xuICAgICAgICAgICAgYXBwLnBsYXlTRShcInJlY292ZXJ5XCIpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaHAgPiB0aGlzLmhwTWF4KSB0aGlzLmhwID0gdGhpcy5ocE1heDtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUudG90YWxTY29yZSArPSAoaXRlbS5wb2ludCB8fCAwKTtcbiAgICAgICAgfVxuICAgICAgICAvL+mNtVxuICAgICAgICBpZiAoaXRlbS5pc0tleSkge1xuICAgICAgICAgICAgdGhpcy5rZXlzLnB1c2goaXRlbSk7XG4gICAgICAgICAgICBhcHAucGxheVNFKFwiZ2V0a2V5aXRlbVwiKTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoJ2dldGtleScsIHtrZXk6IGl0ZW19KTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUudG90YWxTY29yZSArPSAoaXRlbS5wb2ludCB8fCAwKTtcbiAgICAgICAgfVxuICAgICAgICAvL+W+l+eCueOCouOCpOODhuODoFxuICAgICAgICBpZiAoaXRlbS5pc0l0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUudG90YWxTY29yZSArPSAoaXRlbS5wb2ludCB8fCAwKTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJnZXRpdGVtXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+S9v+eUqOatpuWZqOOBruWkieabtFxuICAgIHN3aXRjaFdlYXBvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v5omL5oyB44Gh44Gu5q2m5Zmo44GM5LiA5YCL44Gu5aC05ZCI44Gv5L2V44KC44GX44Gq44GEXG4gICAgICAgIGlmICh0aGlzLmVxdWlwLndlYXBvbnMubGVuZ3RoIDwgMikgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuZXF1aXAuc3dpdGNoT2sgPSBmYWxzZTtcblxuICAgICAgICB2YXIgcm90ID0gMTIwO1xuICAgICAgICBpZiAodGhpcy5lcXVpcC53ZWFwb25zLmxlbmd0aCA9PSAyICYmIHRoaXMuZXF1aXAudXNpbmcgPT0gMSkgcm90ID0gMjQwO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllcldlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5ieSh7cm90YXRpb246IHJvdH0sIDMwMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXF1aXAuc3dpdGNoT2sgPSB0cnVlO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAvL+ePvuWcqOS9v+eUqOatpuWZqOioreWumlxuICAgICAgICB0aGlzLmVxdWlwLnVzaW5nID0gKHRoaXMuZXF1aXAudXNpbmcgKyAxKSAlIHRoaXMuZXF1aXAud2VhcG9ucy5sZW5ndGg7XG4gICAgICAgIHZhciBpZCA9IHRoaXMuZXF1aXAud2VhcG9uc1t0aGlzLmVxdWlwLnVzaW5nXTtcbiAgICAgICAgdmFyIGx2ID0gdGhpcy5lcXVpcC5sZXZlbFt0aGlzLmVxdWlwLnVzaW5nXTtcbiAgICAgICAgdGhpcy5zZXRXZWFwb24oaWQsIGx2KTtcblxuICAgICAgICBhcHAucGxheVNFKFwic2VsZWN0XCIpO1xuICAgIH0sXG5cbiAgICAvL+atpuWZqOWkieabtFxuICAgIHNldFdlYXBvbjogZnVuY3Rpb24oa2luZCwgbGV2ZWwpIHtcbiAgICAgICAga2luZCA9IGtpbmQgfHwgMDtcbiAgICAgICAgbGV2ZWwgPSBsZXZlbCB8fCAwO1xuXG4gICAgICAgIC8v5bGe5oCn5Yid5pyf5YyWXG4gICAgICAgIHRoaXMuYXR0YWNrQ29sbGlzaW9uLiRleHRlbmQoe1xuICAgICAgICAgICAgaXNTbGFzaDogZmFsc2UsXG4gICAgICAgICAgICBpc1N0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgIGlzQmxvdzogZmFsc2UsXG4gICAgICAgICAgICBpc0Fycm93OiBmYWxzZSxcbiAgICAgICAgICAgIGlzRmlyZTogZmFsc2UsXG4gICAgICAgICAgICBpc0ljZTogZmFsc2UsXG4gICAgICAgICAgICBzdHVuUG93ZXI6IDEsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v44Ki44Kk44OG44Og5oOF5aCx5Y+W5b6XXG4gICAgICAgIHZhciBzcGVjID0gcWZ0Lkl0ZW1JbmZvLmdldChraW5kKTtcbiAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24uJGV4dGVuZChzcGVjKTtcbiAgICAgICAgdGhpcy5hdHRhY2tDb2xsaXNpb24ucG93ZXIgKz0gbGV2ZWwgKiAoc3BlYy5sZXZlbEJvbnVzIHx8IDIpO1xuXG4gICAgICAgIHN3aXRjaCAoa2luZCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIC8v44K344On44O844OI44K944O844OJXG4gICAgICAgICAgICAgICAgbGV2ZWwgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQxLCA0MiwgNDMsIDQ0LCBcInN0b3BcIl07XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24uc2V0UG9zaXRpb24oLTMsIDMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIC8v44Ot44Oz44Kw44K944O844OJXG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRQb3NpdGlvbigtMywgMyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgLy/mlqdcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0NCwgNDQsIDQ0LCA0MywgNDMsIDQzLCA0MiwgNDIsIDQyLCA0MSwgNDEsIDQxLCBcInN0b3BcIl07XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24uc2V0UG9zaXRpb24oLTMsIDMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIC8v5qeNXG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRQb3NpdGlvbigwLCAwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAvL+W8k1xuICAgICAgICAgICAgICAgIGxldmVsID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgIC8v6a2U5rOV44Gu5p2WXG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRQb3NpdGlvbigwLCAwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAvL+mtlOWwjuabuFxuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbIDQ0LCA0NCwgNDQsIDQzLCA0MywgNDMsIDQyLCA0MiwgNDIsIDQxLCA0MSwgNDEsIFwic3RvcFwiXTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRQb3NpdGlvbigtMywgMyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICAvL+atpuWZqOeUu+WDj+ioreWumlxuICAgICAgICB2YXIgaW5kZXggPSBraW5kICogMTAgKyBNYXRoLm1pbihsZXZlbCwgc3BlYy5tYXhJbmRleCk7XG4gICAgICAgIHRoaXMud2VhcG9uLnNldEZyYW1lSW5kZXgoaW5kZXgpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+ijheWCmeatpuWZqOOBq+OCiOOCiuaUu+aSg+ODouODvOOCt+ODp+ODs+OCkuWkieOBiOOCi1xuICAgIHdlYXBvbkF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBraW5kID0gdGhpcy5lcXVpcC53ZWFwb25zW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICB2YXIgbGV2ZWwgPSB0aGlzLmVxdWlwLmxldmVsW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICBzd2l0Y2ggKGtpbmQpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAvL+OCt+ODp+ODvOODiOOCveODvOODiVxuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJhdHRhY2tcIik7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5zZXQoe3JvdGF0aW9uOiAyMDAsIGFscGhhOiAxLjB9KVxuICAgICAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzNjB9LCA1KVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgLy/jg63jg7PjgrDjgr3jg7zjg4lcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiYXR0YWNrXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogMjAwLCBhbHBoYTogMS4wfSlcbiAgICAgICAgICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogMzYwfSwgNilcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIC8v5panXG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImF0dGFja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQwMCwgYWxwaGE6IDEuMH0pXG4gICAgICAgICAgICAgICAgICAgIC50byh7cm90YXRpb246IDI3MH0sIDgpXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAvL+anjVxuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJhdHRhY2tcIik7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5zZXQoe3JvdGF0aW9uOiAtNDUsIGFscGhhOiAxLjB9KVxuICAgICAgICAgICAgICAgICAgICAuYnkoe3g6IC0xMH0sIDIpXG4gICAgICAgICAgICAgICAgICAgIC5ieSh7eDogMTB9LCAyKVxuICAgICAgICAgICAgICAgICAgICAuZmFkZU91dCgxKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgLy/lvJNcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiYXR0YWNrXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogLTQ1LCBhbHBoYTogMS4wfSlcbiAgICAgICAgICAgICAgICAgICAgLmJ5KHt4OiA3fSwgMylcbiAgICAgICAgICAgICAgICAgICAgLmJ5KHt4OiAtN30sIDMpXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFycm93UG93ZXIgPSA1ICsgbGV2ZWwgKiAyO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXJyb3cgPSBxZnQuUGxheWVyQXR0YWNrKHRoaXMucGFyZW50U2NlbmUsIHt3aWR0aDogMTUsIGhlaWdodDogMTAsIHBvd2VyOiBhcnJvd1Bvd2VyLCB0eXBlOiBcImFycm93XCJ9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXJMYXllcilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRTY2FsZSh0aGlzLnNjYWxlWCwgMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgICAgICAgICAgIGFycm93LnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJykuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmJ5KHt4OiAoMTUwICsgbGV2ZWwgKiA1KSAqIHRoaXMuc2NhbGVYfSwgNylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQoYXJyb3cpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAvL+mtlOazleOBruadllxuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJib21iXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuc2V0KHtyb3RhdGlvbjogMjAwLCBhbHBoYTogMS4wfSlcbiAgICAgICAgICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogMzYwfSwgOClcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBtYWdpY1Bvd2VyID0gMTUgKyBsZXZlbCAqIDI7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA2OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hZ2ljID0gcWZ0LlBsYXllckF0dGFjayh0aGlzLnBhcmVudFNjZW5lLCB7d2lkdGg6IDE1LCBoZWlnaHQ6IDEwLCBpbmRleDogMzAsIHBvd2VyOiBtYWdpY1Bvd2VyLCB0eXBlOiBcImZsYW1lXCJ9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXJMYXllcilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRTY2FsZSh0aGlzLnNjYWxlWCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIG1hZ2ljLnJhZCA9ICg5MCAtIGkgKiAzMCkudG9SYWRpYW4oKTtcbiAgICAgICAgICAgICAgICAgICAgbWFnaWMuaXNDb2xsaXNpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgbWFnaWMudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBtYWdpYy50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YWl0KGkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQ29sbGlzaW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBteCA9IE1hdGguY29zKHRoaXMucmFkKSAqIHRoYXQuc2NhbGVYO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBteSA9IE1hdGguc2luKHRoaXMucmFkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uKHRoYXQueCArIDMyICogbXgsIHRoYXQueSArIDMyICogbXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKG1hZ2ljKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YWl0KDgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKG1hZ2ljKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgIC8v6a2U5bCO5pu4XG4gICAgICAgICAgICAgICAgYXBwLnBsYXlTRShcImF0dGFja1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQwMCwgYWxwaGE6IDEuMH0pXG4gICAgICAgICAgICAgICAgICAgIC50byh7cm90YXRpb246IDI3MH0sIDgpXG4gICAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KDEpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFsxMywgMTRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszNiwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFsgMywgIDQsICA1LCAgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWyA5LCAxMCwgMTEsIDEwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbIDAsICAxLCAgMiwgIDFdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGVmZW5zZVwiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRhbWFnZVwiXSA9IFsgMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkcm9wXCJdID0gWzE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGVhZFwiXSA9IFsxOCwgMTksIDIwLCAzMywgMzQsIDM1LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJjbGVhclwiXSA9IFsyNCwgMjUsIDI2XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0dW5cIl0gPSBbIDE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v5b2T44Gf44KK5Yik5a6a55So44Ko44Os44Oh44Oz44OI44Gu5L2N572u5YaN44K744OD44OIXG4gICAgcmVzZXRDb2xsaXNpb25Qb3NpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB3ID0gTWF0aC5mbG9vcih0aGlzLndpZHRoLzIpKzY7XG4gICAgICAgIHZhciBoID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodC8yKSs2O1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMF0uc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkgLSBoKTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzFdLnNldFBvc2l0aW9uKHRoaXMueCArIHcsIHRoaXMueSAtIDUpO1xuICAgICAgICB0aGlzLl9jb2xsaXNpb25bMl0uc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkgKyBoKTtcbiAgICAgICAgdGhpcy5fY29sbGlzaW9uWzNdLnNldFBvc2l0aW9uKHRoaXMueCAtIHcsIHRoaXMueSAtIDUpO1xuICAgICAgICB0aGlzLmxhZGRlckNvbGxpc2lvbi5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+mgreS4iuOBr+OBl+OBlOODgeOCp+ODg+OCr1xuICAgIGNoZWNrSGVhZExhZGRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBoID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodC8yKSsxMDtcbiAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KHt3aWR0aDogMTYsIGhlaWdodDogMn0pLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55LWgpO1xuICAgICAgICB2YXIgcmV0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jb2xsaXNpb25MYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLmhpdFRlc3RFbGVtZW50KGMpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PSBcImxhZGRlclwiIHx8IGUudHlwZSA9PSBcInN0YWlyc1wiKSByZXQgPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH0sXG5cbiAgICAvL+i2s+S4i+OBr+OBl+OBlOODgeOCp+ODg+OCr1xuICAgIGNoZWNrRm9vdExhZGRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBoID0gTWF0aC5mbG9vcih0aGlzLmhlaWdodC8yKSsxMDtcbiAgICAgICAgdmFyIGMgPSBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50KHt3aWR0aDogMTYsIGhlaWdodDogMn0pLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55K2gpO1xuICAgICAgICB2YXIgcmV0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5jb2xsaXNpb25MYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlLmhpdFRlc3RFbGVtZW50KGMpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PSBcImxhZGRlclwiIHx8IGUudHlwZSA9PSBcInN0YWlyc1wiKSByZXQgPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH0sXG5cbiAgICAvL+ePvuWcqOOCueODhuODvOOCv+OCueS/neWtmFxuICAgIHNhdmVTdGF0dXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+aJgOaMgeatpuWZqOOAgeOCouOCpOODhuODoOetieOCueODhuODvOOCv+OCueOBruWPluW+l1xuICAgICAgICB2YXIgZXEgPSB0aGlzLmVxdWlwO1xuICAgICAgICB2YXIgZXF1aXAgPSB7XG4gICAgICAgICAgICB1c2luZzogMCxcbiAgICAgICAgICAgIHdlYXBvbnM6IGVxLndlYXBvbnMuY29uY2F0KCksXG4gICAgICAgICAgICBsZXZlbDogZXEubGV2ZWwuY29uY2F0KCksXG4gICAgICAgICAgICBzd2l0Y2hPazogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5pdGVtcy5jb25jYXQoKTtcbiAgICAgICAgdmFyIG51bUp1bXBNYXggPSB0aGlzLm51bUp1bXBNYXg7XG5cbiAgICAgICAgdGhpcy5zdGFydFN0YXR1cyA9IHtcbiAgICAgICAgICAgIGhwTWF4OiB0aGlzLmhwTWF4LFxuICAgICAgICAgICAgaHA6IHRoaXMuaHAsXG4gICAgICAgICAgICBwb3dlcjogdGhpcy5wb3dlcixcbiAgICAgICAgICAgIGRlZmVuc2U6IHRoaXMuZGVmZW5zZSxcbiAgICAgICAgICAgIGVxdWlwOiBlcXVpcCxcbiAgICAgICAgICAgIGl0ZW1zOiBpdGVtcyxcbiAgICAgICAgICAgIG51bUp1bXBNYXg6IG51bUp1bXBNYXgsXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8v44K544OG44O844K/44K55b6p5YWDXG4gICAgcmVzdG9yZVN0YXR1czogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzcyA9IHRoaXMuc3RhcnRTdGF0dXM7XG4gICAgICAgIHRoaXMuaHBNYXggPSBzcy5ocE1heDtcbiAgICAgICAgdGhpcy5ocCA9IHNzLmhwO1xuICAgICAgICB0aGlzLnBvd2VyID0gc3MucG93ZXI7XG4gICAgICAgIHRoaXMuZGVmZW5zZSA9IHNzLmRlZmVuc2U7XG4gICAgICAgIHRoaXMuZXF1aXAgPSB7XG4gICAgICAgICAgICB1c2luZzogMCxcbiAgICAgICAgICAgIHdlYXBvbnM6IHNzLmVxdWlwLndlYXBvbnMuY29uY2F0KCksXG4gICAgICAgICAgICBsZXZlbDogc3MuZXF1aXAubGV2ZWwuY29uY2F0KCksXG4gICAgICAgICAgICBzd2l0Y2hPazogdHJ1ZSxcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3MuaXRlbXMpIHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBzcy5pdGVtcy5jb25jYXQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXRlbSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubnVtSnVtcE1heCA9IHNzLm51bUp1bXBNYXg7XG5cbiAgICAgICAgdmFyIGlkID0gdGhpcy5lcXVpcC53ZWFwb25zW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICB2YXIgbHYgPSB0aGlzLmVxdWlwLmxldmVsW3RoaXMuZXF1aXAudXNpbmddO1xuICAgICAgICB0aGlzLnNldFdlYXBvbihpZCwgbHYpO1xuICAgIH0sXG59KTtcblxuLy/jg5fjg6zjgqTjg6Tjg7zmlLvmkoPliKTlrppcbnBoaW5hLmRlZmluZShcInFmdC5QbGF5ZXJBdHRhY2tcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMSxcblxuICAgIC8v5b2T44Gf44KK5Yik5a6a55m655Sf44OV44Op44KwXG4gICAgaXNDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+WxnuaAp1xuICAgIGlzU2xhc2g6IGZhbHNlLFxuICAgIGlzU3Rpbmc6IGZhbHNlLFxuICAgIGlzQmxvdzogZmFsc2UsXG4gICAgaXNBcnJvdzogZmFsc2UsXG4gICAgaXNGaXJlOiBmYWxzZSxcbiAgICBpc0ljZTogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZSA9IHBhcmVudFNjZW5lO1xuXG4gICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZSB8fCBcImFycm93XCI7XG4gICAgICAgIHRoaXMucG93ZXIgPSBvcHRpb25zLnBvd2VyIHx8IDA7XG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuXG4gICAgICAgIC8v6KGo56S644K544OX44Op44Kk44OIXG4gICAgICAgIHN3aXRjaCAodGhpcy50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiYXJyb3dcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCgxKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lID0gWzFdO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBcnJvdyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1N0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0dW5Qb3dlciA9IDEwO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImZpcmViYWxsXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJ1bGxldFwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCg5KTtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lID0gWzksIDEwLCAxMSwgMTBdO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNGaXJlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtYXNha2FyaVwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDIwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lID0gWzIwXTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2xhc2ggPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNCcm93ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0dW5Qb3dlciA9IDUwO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImRhZ2dlclwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJ3ZWFwb25zXCIsIDI0LCAyNCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDIwKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZS5yb3RhdGlvbiA9IDEzNTtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lID0gWzBdO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNTdGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHVuUG93ZXIgPSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImZsYW1lXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImVmZmVjdFwiLCA0OCwgNDgpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRGcmFtZVRyaW1taW5nKDAsIDE5MiwgMTkyLCA5NilcbiAgICAgICAgICAgICAgICAgICAgLnNldFNjYWxlKDAuNSk7XG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZSA9IFswLCAxLCAyLCAzLCA0LCA1LCA2LCA3LCA4XTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzRmlyZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHVuUG93ZXIgPSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikge1xuICAgICAgICAgICAgcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IHRoaXMud2lkdGgsIGhlaWdodDogdGhpcy5oZWlnaHR9KS5hZGRDaGlsZFRvKHRoaXMpLnNldEFscGhhKDAuNSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ29sbGlzaW9uIHx8IHRoaXMudHlwZSA9PSBcImV4cGxvZGVcIikgcmV0dXJuO1xuXG4gICAgICAgIGlmICh0aGlzLnRpbWUgJSAzID09IDApIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lSW5kZXgodGhpcy5mcmFtZVt0aGlzLmluZGV4XSk7XG4gICAgICAgICAgICB0aGlzLmluZGV4ID0gKHRoaXMuaW5kZXggKyAxKSAlIHRoaXMuZnJhbWUubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT0gXCJmbGFtZVwiKSByZXR1cm47XG5cbiAgICAgICAgLy/lnLDlvaLmjqXop6bliKTlrppcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmNvbGxpc2lvbkxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUudHlwZSA9PSBcImxhZGRlclwiIHx8IGUudHlwZSA9PSBcInN0YWlyc1wiKSByZXR1cm47XG4gICAgICAgICAgICBpZiAodGhpcy5oaXRUZXN0RWxlbWVudChlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNDb2xsaXNpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYXJyb3dcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RpY2soZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImZpcmViYWxsXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGxvZGUoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcblxuICAgIC8v44OS44OD44OI5b6M5Yem55CGXG4gICAgaGl0OiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJmaXJlYmFsbFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuZXhwbG9kZSh0YXJnZXQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v5Yi644GV44KLXG4gICAgc3RpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy/lirnmnpzpn7NcbiAgICAgICAgc3dpdGNoICh0aGlzLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJhcnJvd1wiOlxuICAgICAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJhcnJvd3N0aWNrXCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm1hc2FrYXJpXCI6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zY2FsZVggPT0gMSkge1xuICAgICAgICAgICAgdGhpcy54ID0gZS5sZWZ0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy54ID0gZS5yaWdodDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoMzApXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG4gICAgLy/lvL7jgYvjgozjgotcbiAgICBzbmFwOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8v5Yq55p6c6Z+zXG4gICAgICAgIGFwcC5wbGF5U0UoXCJ0aW5rbGluZ1wiKTtcbiAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5ieSh7eTogLTkyLCByb3RhdGlvbjogNzAwfSwgMTUsIFwiZWFzZU91dFF1YWRcIilcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvL+eIhueZulxuICAgIGV4cGxvZGU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVmZmVjdCh0aGlzLngsIHRoaXMueSk7XG4gICAgICAgIGFwcC5wbGF5U0UoXCJib21iXCIpO1xuICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgIH0sXG59KTtcblxuLy/jg5fjg6zjgqTjg6Tjg7zjg4Djg5/jg7zjgrnjg5fjg6njgqTjg4hcbnBoaW5hLmRlZmluZShcInFmdC5QbGF5ZXJEdW1teVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LlNwcml0ZVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oYXNzZXROYW1lKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KGFzc2V0TmFtZSwgMzIsIDMyKTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMTMsIDE0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbIDMsICA0LCAgNSwgIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa19zdG9wXCJdID0gWyAzLCAgNCwgIDUsICA0LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWyA5LCAxMCwgMTEsIDEwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwX3N0b3BcIl0gPSAgIFsxMCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFsgMCwgIDEsICAyLCAgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJjbGVhclwiXSA9IFsyNCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGFtYWdlXCJdID0gWyAxOCwgMTksIDIwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRlYWRcIl0gPSBbMTgsIDE5LCAyMCwgMzMsIDM0LCAzNSwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcblxuICAgICAgICB0aGlzLm5vd0FuaW1hdGlvbiA9IFwic3RhbmRcIjtcbiAgICAgICAgdGhpcy5hbmltYXRpb24gPSB0cnVlO1xuXG4gICAgICAgIHRoaXMuYnggPSAwO1xuICAgICAgICB0aGlzLmJ5ID0gMDtcbiAgICAgICAgdGhpcy50aW1lID0gMDtcblxuICAgICAgICAvL+W9seOBrui/veWKoFxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBzYyA9IDE2IC8gMjQ7XG4gICAgICAgIGlmIChzYyA8IDEpIHNjICs9IDAuMjtcbiAgICAgICAgdGhpcy5zaGFkb3dTcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInNoYWRvd1wiLCAyNCwgOClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC41KVxuICAgICAgICAgICAgLnNldFNjYWxlKHNjLCAxLjApXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oMCwgMTYpO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5hbmltYXRpb24gJiYgdGhpcy50aW1lICUgNiA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmluZGV4ID0gKHRoaXMuaW5kZXgrMSkgJSB0aGlzLmZyYW1lW3RoaXMubm93QW5pbWF0aW9uXS5sZW5ndGg7XG4gICAgICAgICAgICBpZiAodGhpcy5mcmFtZVt0aGlzLm5vd0FuaW1hdGlvbl1bdGhpcy5pbmRleF0gPT0gXCJzdG9wXCIpIHRoaXMuaW5kZXgtLTtcbiAgICAgICAgICAgIHRoaXMuZnJhbWVJbmRleCA9IHRoaXMuZnJhbWVbdGhpcy5ub3dBbmltYXRpb25dW3RoaXMuaW5kZXhdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMueCA8IHRoaXMuYngpIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgaWYgKHRoaXMueCA+IHRoaXMuYngpIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgIHRoaXMuYnggPSB0aGlzLng7XG4gICAgICAgIHRoaXMuYnkgPSB0aGlzLnk7XG5cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfSxcblxuICAgIHNldEFuaW1hdGlvbjogZnVuY3Rpb24oYW5pbU5hbWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmZyYW1lW2FuaW1OYW1lXSkgcmV0dXJuO1xuICAgICAgICBpZiAoYW5pbU5hbWUgPT0gdGhpcy5ub3dBbmltYXRpb24pIHJldHVybjtcbiAgICAgICAgdGhpcy5ub3dBbmltYXRpb24gPSBhbmltTmFtZTtcbiAgICAgICAgdGhpcy5pbmRleCA9IC0xO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxufSk7XG5cbi8v44OX44Os44Kk44Ok44O854++5Zyo5L2/55So5q2m5Zmo6KGo56S6XG5waGluYS5kZWZpbmUoXCJxZnQuUGxheWVyV2VhcG9uXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnRcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgICAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcblxuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMuYmFzZSA9IHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLmJhc2UudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gLXRoYXQucm90YXRpb247XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHBhcmFtID0ge1xuICAgICAgICAgICAgd2lkdGg6IDI1LFxuICAgICAgICAgICAgaGVpZ2h0OiAyNSxcbiAgICAgICAgICAgIGZpbGw6IFwicmdiYSgwLDAsMCwwLjApXCIsXG4gICAgICAgICAgICBzdHJva2U6IFwieWVsbG93XCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgfTtcbiAgICAgICAgLy/kvb/nlKjkuK3mrablmahcbiAgICAgICAgcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZShwYXJhbSkuYWRkQ2hpbGRUbyh0aGlzLmJhc2UpLnNldFBvc2l0aW9uKDAsIC0xOCk7XG4gICAgICAgIC8v5o2o44Gm44Gh44KD44GG5q2m5ZmoXG4gICAgICAgIHRoaXMuZHJvcEZyYW1lID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7c3Ryb2tlOiBcInJlZFwifS4kc2FmZShwYXJhbSkpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLmJhc2UpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oMTQsIDEwKVxuICAgICAgICAgICAgLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICB0aGlzLmRyb3BGcmFtZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGF0LnBsYXllci5lcXVpcC53ZWFwb25zLmxlbmd0aCA8IDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v5q2m5Zmo44Oq44K544OI77yI77yT44Gk77yJXG4gICAgICAgIHRoaXMud2VhcG9ucyA9IFtdO1xuICAgICAgICB2YXIgcmFkID0gMDtcbiAgICAgICAgdmFyIHJhZF8xID0gKE1hdGguUEkqMikgLyAzO1xuICAgICAgICAoMykudGltZXMoZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgdmFyIHggPSAgTWF0aC5zaW4ocmFkKSoxODtcbiAgICAgICAgICAgIHZhciB5ID0gLU1hdGguY29zKHJhZCkqMTg7XG4gICAgICAgICAgICByYWQgLT0gcmFkXzE7XG4gICAgICAgICAgICB0aGlzLndlYXBvbnNbaV0gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgICAgICAgdGhpcy53ZWFwb25zW2ldLmluZGV4ID0gaTtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uc1tpXS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gLXRoYXQucm90YXRpb247XG4gICAgICAgICAgICAgICAgdmFyIHdlYXBvbnMgPSB0aGF0LnBsYXllci5lcXVpcC53ZWFwb25zO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmluZGV4IDwgd2VhcG9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtpbmQgPSB0aGF0LnBsYXllci5lcXVpcC53ZWFwb25zW3RoaXMuaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGV2ZWwgPSB0aGF0LnBsYXllci5lcXVpcC5sZXZlbFt0aGlzLmluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNwZWMgPSBxZnQuSXRlbUluZm8uZ2V0KGtpbmQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBraW5kICogMTAgKyBNYXRoLm1pbihsZXZlbCwgc3BlYy5tYXhJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RnJhbWVJbmRleChpbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGxhYmVsUGFyYW0gPSB7XG4gICAgICAgICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxuXG4gICAgICAgICAgICAgICAgZm9udEZhbWlseTogXCJPcmJpdHJvblwiLFxuICAgICAgICAgICAgICAgIGFsaWduOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICAgIGJhc2VsaW5lOiBcIm1pZGRsZVwiLFxuICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxMCxcbiAgICAgICAgICAgICAgICBmb250V2VpZ2h0OiAnJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8v5by35YyW44Os44OZ44Or6KGo56S6XG4gICAgICAgICAgICB0aGlzLndlYXBvbnNbaV0ubGV2ZWwgPSBwaGluYS5kaXNwbGF5LkxhYmVsKHt0ZXh0OiBcIlwifS4kc2FmZShsYWJlbFBhcmFtKSkuc2V0UG9zaXRpb24oNiwgNikuYWRkQ2hpbGRUbyh0aGlzLndlYXBvbnNbaV0pO1xuICAgICAgICAgICAgdGhpcy53ZWFwb25zW2ldLmxldmVsLmluZGV4ID0gaTtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uc1tpXS5sZXZlbC51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGV2ZWwgPSB0aGF0LnBsYXllci5lcXVpcC5sZXZlbFt0aGlzLmluZGV4XTtcbiAgICAgICAgICAgICAgICBpZiAobGV2ZWwgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSBcIitcIitsZXZlbDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuXG4gICAgY2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuYWR2ZW50dXJlci5qc1xuICogIDIwMTcvMDgvMDlcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v5YaS6Zm66ICFXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQWR2ZW50dXJlclwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEwMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxOTIsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMzYwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMTAwMDAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiA2LFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMyxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUxCT1gsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyNCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/mrablmajnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy53ZWFwb24gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KDEwICsgTWF0aC5taW4oOSwgdGhpcy5sZXZlbCkpXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDEsIDEpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oLTMsIDMpO1xuICAgICAgICB0aGlzLndlYXBvbi5hbHBoYSA9IDA7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMud2VhcG9uLmtpbmQgPSBcInN3b3JkXCI7XG4gICAgICAgIHRoaXMud2VhcG9uLnNjYWxlWCA9IC0xO1xuICAgICAgICB0aGlzLndlYXBvbi5zY2FsZVkgPSAtMTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICBpZiAodGhpcy5ibGFjaykge1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInBsYXllcjFCbGFja1wiLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwicGxheWVyMVwiLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zcHJpdGUuc2NhbGVYID0gLTE7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hdHRhY2tJbnRlcnZhbCA9IDMwO1xuXG4gICAgICAgIC8v6KGM5YuV44OV44Kn44O844K6XG4gICAgICAgIHRoaXMucGhhc2UgPSBcIndhbmRlclwiO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuXG4gICAgICAgIC8v5b6F5qmf54q25oWLXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IFwid2FpdFwiKSB7XG4gICAgICAgICAgICB0aGlzLmlzQWR2YW5jZUFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTV9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gXCJhcHByb2FjaFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc0FkdmFuY2VBbmltYXRpb24gPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/lvpjlvopcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJ3YW5kZXJcIikge1xuICAgICAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTV9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gXCJhcHByb2FjaFwiO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJvdW5kdHJpcEFsZ29yaXRobV9ncm91bmQoZGlzdGFuY2UsIGxvb2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozmjqXov5FcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJhcHByb2FjaFwiKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54IDwgcGxheWVyLngpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0zO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFsb29rKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IFwibG9zdFwiO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMTUwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgNTIgJiYgdGhpcy5hdHRhY2tJbnRlcnZhbCA9PSAwKSB0aGlzLnBoYXNlID0gXCJhdHRhY2tcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O86KaL5aSx44GEXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IFwibG9zdFwiKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZS0tO1xuICAgICAgICAgICAgaWYgKHRoaXMueCA8IHBsYXllci54KSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA8IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIi4uLlwifSk7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IFwid2FpdFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJhdHRhY2tcIikge1xuICAgICAgICAgICAgdGhpcy5hdHRhY2soKTtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNrSW50ZXJ2YWwgPSAzMDtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBoYXNlICE9IFwiYXR0YWNraW5nXCIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJqdW1wXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hdHRhY2tJbnRlcnZhbC0tO1xuICAgICAgICBpZiAodGhpcy5hdHRhY2tJbnRlcnZhbCA8IDApIHRoaXMuYXR0YWNrSW50ZXJ2YWwgPSAwO1xuICAgIH0sXG5cbiAgICAvL+aUu+aSg1xuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAyO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcImF0dGFja1wiKTtcbiAgICAgICAgdGhpcy5waGFzZSA9IFwiYXR0YWNraW5nXCI7XG5cbiAgICAgICAgLy/mlLvmkoPliKTlrppcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgYXRrID0gcWZ0LkVuZW15QXR0YWNrKHRoaXMucGFyZW50U2NlbmUsIHt3aWR0aDogMjQsIGhlaWdodDogMjQsIHBvd2VyOiAyMCArIHRoaXMubGV2ZWwgKiA1fSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuZW5lbXlMYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDE4LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC4wKTtcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikgYXRrLnNldEFscGhhKDAuMyk7XG4gICAgICAgIGF0ay5tYXN0ZXIgPSB0aGlzO1xuICAgICAgICBhdGsudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgYXRrLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhhdC54ICsgdGhhdC5zY2FsZVggKiAxODtcbiAgICAgICAgfVxuXG4gICAgICAgIGFwcC5wbGF5U0UoXCJhdHRhY2tcIik7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDIwMCwgYWxwaGE6IDEuMH0pXG4gICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzNjB9LCA2KVxuICAgICAgICAgICAgLmZhZGVPdXQoMSlcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IFwiYXBwcm9hY2hcIjtcbiAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/po5vjgbPpgZPlhbflvL7jgY1cbiAgICBndWFyZDogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMTMsIDE0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMzYsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbIDMsICA0LCAgNSwgIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFsgOSwgMTAsIDExLCAxMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWyAwLCAgMSwgIDIsICAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRlZmVuc2VcIl0gPSBbIDQxLCA0MiwgNDMsIDQ0LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkYW1hZ2VcIl0gPSBbIDE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZHJvcFwiXSA9IFsxOCwgMTksIDIwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRlYWRcIl0gPSBbMTgsIDE5LCAyMCwgMzMsIDM0LCAzNSwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiY2xlYXJcIl0gPSBbMjQsIDI1LCAyNl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdHVuXCJdID0gWyAxOCwgMTksIDIwXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuYXJjaGRlbW9uLmpzXG4gKiAgMjAxNy8wNS8wMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqLjg7zjgq/jg4fjg7zjg6Ljg7NcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5BcmNoRGVtb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMDAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDMwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDE4MCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6ZaT6ZqUXG4gICAgYW5pbWF0aW9uSW50ZXJ2YWw6IDE1LFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogNTAwMCxcblxuICAgIC8v6aOb6KGM44Oi44O844OJXG4gICAgZmx5aW5nOiBmYWxzZSxcbiAgICBmbHlpbmdQaGFzZTogMCwgLy/ooYzli5Xjg5Xjgqfjg7zjgrpcbiAgICBmbHlpbmdYOiAwLCAgICAgLy/po5vooYzplovlp4vvvLjluqfmqJlcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDEwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0pFV0VMLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDIsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0pFV0VMQk9YLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMzUsIGhlaWdodDogMzB9KTtcbiAgICAgICAgaWYgKG9wdGlvbnMuc2l6ZSkge1xuICAgICAgICAgICAgdmFyIHNpemUgPSBvcHRpb25zLnNpemUgfHwgMTtcbiAgICAgICAgICAgIG9wdGlvbnMud2lkdGggPSBzaXplICogMzU7XG4gICAgICAgICAgICBvcHRpb25zLmhlaWdodCA9IHNpemUgKiAzMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMXgyXCIsIDI0KjIsIDMyKjIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjE2KjIsIDY0MCoyLCA3MioyLCAxMjgqMikuc2V0UG9zaXRpb24oMCwgLTEwKTtcbiAgICAgICAgaWYgKG9wdGlvbnMuc2l6ZSkge1xuICAgICAgICAgICAgdmFyIHNpemUgPSBvcHRpb25zLnNpemUgfHwgMTtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnNldFNjYWxlKHNpemUpLnNldFBvc2l0aW9uKDAsIHNpemUgKiAtMTIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCxXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/pgLLooYzmlrnlkJHmsbrlrppcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOeZuuimi+W+jOS4gOWumuaZgumWk+i/vei3oeOBmeOCi1xuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAxMjA7XG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMudnggKj0gMztcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwICYmICF0aGlzLmlzQXR0YWNrICYmIHRoaXMudHVyblRpbWUgPT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDE4MCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnR1cm5UaW1lID0gMTU7XG4gICAgICAgICAgICBpZiAobG9vaykgdGhpcy50dXJuQ291bnQgPSAwO1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgpLopovlpLHjgaPjgZ/nirbmhYvjgafkuInlm57mjK/jgorov5TjgaPjgZ/loLTlkIjjga/ov73ot6HntYLkuoZcbiAgICAgICAgICAgIGlmICh0aGlzLnR1cm5Db3VudCA+IDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+W0luOBo+OBt+OBoeOBp+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBuOOBruaUu+aSg1xuICAgICAgICAgICAgaWYgKGxvb2sgJiYgIXRoaXMuaXNBdHRhY2sgJiYgIXRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpcyA+IDEyOCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmVicmVhdGgoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGxvZGluZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAzMCkgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgIH0sXG5cbiAgICAvL+eBq+eQg+OCkuWQkOOBj1xuICAgIGZpcmViYWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlLCByb3RhdGlvbjogdGhpcy5nZXRQbGF5ZXJBbmdsZSgpLCBwb3dlcjogMzB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg0NSlcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/ngo7jgpLlkJDjgY9cbiAgICBmaXJlYnJlYXRoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSA2MDtcbiAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciByb3QgPSAodGhpcy5zY2FsZVggPT0gMSk/IDA6IDE4MDtcbiAgICAgICAgdmFyIGN0ID0gMDtcbiAgICAgICAgdmFyIHR3ID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54ICsgMjQgKiB0aGlzLnNjYWxlWCwgdGhpcy55LTgsIFwiQnVsbGV0XCIsIHt0eXBlOiBcImV4cGxvZGVcIiwgcG93ZXI6IDEwLCByb3RhdGlvbjogdGhpcy5nZXRQbGF5ZXJBbmdsZSgpLCB2ZWxvY2l0eTogNX0pO1xuICAgICAgICAgICAgICAgIGIuc2V0U2NhbGUoMC4xKTtcbiAgICAgICAgICAgICAgICBiLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKS50byh7c2NhbGVYOiAxLCBzY2FsZVk6IDF9LCAxMCk7XG4gICAgICAgICAgICAgICAgY3QrKztcbiAgICAgICAgICAgICAgICBpZiAoY3QgPT0gNiB8fCB0aGlzLmF0dGFja0NhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICB0dy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFja0NhbmNlbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg1KVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgfSxcblxuICAgIC8v54iG55m6XG4gICAgZXhwbG9kaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gNjA7XG4gICAgICAgIHRoaXMuc3ByaXRlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmZhZGVJbigxNSlcbiAgICAgICAgICAgIC53YWl0KDQ1KVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciByb3QgPSAodGhpcy5zY2FsZVggPT0gMSk/IDA6IDE4MDtcbiAgICAgICAgdmFyIGN0ID0gMDtcbiAgICAgICAgdmFyIHR3ID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIHJhZCA9IHJvdC50b1JhZGlhbigpO1xuICAgICAgICAgICAgICAgIHZhciBleCA9IE1hdGguY29zKHJhZCkgKiAxNjtcbiAgICAgICAgICAgICAgICB2YXIgZXkgPSBNYXRoLnNpbihyYWQpICogMTY7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCArIGV4LCB0aGlzLnkgKyBleSwgXCJCdWxsZXRcIiwge3R5cGU6IFwiZXhwbG9kZVwiLCBwb3dlcjogMTAsIHJvdGF0aW9uOiByb3QsIHZlbG9jaXR5OiAzfSk7XG4gICAgICAgICAgICAgICAgcm90ICs9IDIyLjU7XG4gICAgICAgICAgICAgICAgY3QrKztcbiAgICAgICAgICAgICAgICBpZiAoY3QgPT0gMTYgfHwgdGhpcy5hdHRhY2tDYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdHcucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2tDYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoMSlcbiAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmFyY2hrbmlnaHQuanNcbiAqICAyMDE3LzA1LzE4XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCouODvOOCr+ODiuOCpOODiFxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkFyY2hLbmlnaHRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA3MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxOTIsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiA1MDAwLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PplpPpmpRcbiAgICBhbmltYXRpb25JbnRlcnZhbDogMTAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9KRVdFTCxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAzLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9MT05HU1dPUkQsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyNSwgaGVpZ2h0OiA0MH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/mrablmajjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy53ZWFwb24gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIndlYXBvbnNcIiwgMjQsIDI0KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KDEwICsgTWF0aC5taW4oOSwgdGhpcy5sZXZlbCkpXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDEsIDEpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oLTYsIDMpXG4gICAgICAgICAgICAuc2V0U2NhbGUoLTEuNSwgMS41KVxuICAgICAgICAgICAgLnNldFJvdGF0aW9uKDQzMCk7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIHRoaXMud2VhcG9uLmtpbmQgPSBcInN3b3JkXCI7XG4gICAgICAgIGlmIChvcHRpb25zLndlYXBvbiA9PSBcImF4XCIpIHtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldEZyYW1lSW5kZXgoMjAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5raW5kID0gXCJheFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLndlYXBvbiA9PSBcInNwZWFyXCIpIHtcbiAgICAgICAgICAgIHRoaXMud2VhcG9uLnNldEZyYW1lSW5kZXgoMzAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSk7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5raW5kID0gXCJzcGVhclwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMngyXCIsIDI0KjIsIDMyKjIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjE2KjIsIDEyOCoyLCA3MioyLCAxMjgqMik7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldFBvc2l0aW9uKDAsIC01KTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAxMDAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembolxuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O855m66KaL5b6M5LiA5a6a5pmC6ZaT6L+96Leh44GZ44KLXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDAgJiYgIXRoaXMuaXNBdHRhY2sgJiYgdGhpcy50dXJuVGltZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHVyblRpbWUgPSAxNTtcbiAgICAgICAgICAgIGlmIChsb29rKSB0aGlzLnR1cm5Db3VudCA9IDA7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+WkseOBo+OBn+eKtuaFi+OBp+S4ieWbnuaMr+OCiui/lOOBo+OBn+WgtOWQiOOBr+i/vei3oee1guS6hlxuICAgICAgICAgICAgaWYgKHRoaXMudHVybkNvdW50ID4gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/kuIDlrprot53pm6Lku6XkuIrpm6LjgozjgZ/jgonov73ot6Hop6PpmaRcbiAgICAgICAgaWYgKGRpcyA+IDUxMikgdGhpcy5jaGFzZVRpbWUgPSAwO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMC41O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTAuNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmlzSnVtcCkgdGhpcy52eCAqPSAyO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMTIwO1xuICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDA7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPT0gMCkgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkgdGhpcy52eCAqPSAzO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/jgZPjgozku6XkuIrpgLLjgoHjgarjgYTloLTlkIjjga/mipjjgorov5TjgZlcbiAgICAgICAgICAgIHZhciBpc1JldHVybldhbGwgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBpc1JldHVybkNsaWZmID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkgaXNSZXR1cm5XYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSs0MCwgNSwgNSkgPT0gbnVsbCkgaXNSZXR1cm5DbGlmZiA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudnggPCAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCB8fCBpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOi/vei3oeS4reOBp+auteW3ruOBjOOBguOCi+WgtOWQiOOBr+mjm+OBs+i2iuOBiOOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5XYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafltJbjgYzjgYLjgovloLTlkIjjga/nnYDlnLDngrnjgYzjgYLjgovjgYvoqr/jgbnjgabpo5vjgbPpmY3jgorjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuQ2xpZmYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqdW1wT2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDk2KSkganVtcE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDk2KSkganVtcE9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdW1wT2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eSA9IC01O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+edgOWcsOeCueOBjOeEoeOBhOWgtOWQiOOBr+irpuOCgeOBpuaKmOOCiui/lOOBmVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50dXJuV2FpdCA9IDE1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiLi4uXCJ9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnggKj0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/mlLvmkoNcbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA2NCAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86aOb44Gz6YGT5YW344KS5by+44GPXG4gICAgICAgICAgICBpZiAobG9vayAmJiAhdGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCt+ODp+ODg+ODiOOBqOOBrui3nembouWIpOWumlxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uICYmIGUudHlwZSA9PSBcImFycm93XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmdldERpc3RhbmNlKGUpIDwgNjQpIHRoYXQuZ3VhcmQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDMwKSB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHdpZHRoID0gMjQsIGhlaWdodCA9IDI0O1xuICAgICAgICB2YXIgYXRrID0gcWZ0LkVuZW15QXR0YWNrKHRoaXMucGFyZW50U2NlbmUsIHt3aWR0aDogMjQsIGhlaWdodDogNDgsIHBvd2VyOiAyMCArIHRoaXMubGV2ZWwgKiA1fSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuZW5lbXlMYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDE4LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC4wKTtcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikgYXRrLnNldEFscGhhKDAuMyk7XG4gICAgICAgIGF0ay5tYXN0ZXIgPSB0aGlzO1xuICAgICAgICBhdGsudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgYXRrLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhhdC54ICsgdGhhdC5zY2FsZVggKiAxODtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLndlYXBvbi5raW5kID09IFwic3dvcmRcIiB8fCB0aGlzLndlYXBvbi5raW5kID09IFwiYXhcIikge1xuICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAyNzB9LCAyKVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBhdGsuaXNBY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzU3VwZXJBcm1vciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudnggPSAxNiAqIHRoYXQuc2NhbGVYO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogNDMwfSwgNilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzU3VwZXJBcm1vciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy53ZWFwb24ua2luZCA9PSBcInNwZWFyXCIpIHtcbiAgICAgICAgICAgIGF0ay53aWR0aCA9IDMyO1xuICAgICAgICAgICAgYXRrLmhlaWdodCA9IDg7XG4gICAgICAgICAgICBhdGsuc2V0UG9zaXRpb24odGhpcy54ICsgdGhpcy5zY2FsZVggKiAxLCB0aGlzLnkpO1xuICAgICAgICAgICAgYXRrLnR3ZWVuZXIuY2xlYXIoKS5ieSh7eDogMjAgKiB0aGlzLnNjYWxlWH0sIDEwKS5ieSh7eDogLTIwICogdGhpcy5zY2FsZVh9LCAxMCk7XG4gICAgICAgICAgICBhdGsuaXNBY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQ1LCB4OiAtMjB9KVxuICAgICAgICAgICAgICAgIC53YWl0KDYpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0ay5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNTdXBlckFybW9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52eCA9IDMyICogdGhhdC5zY2FsZVg7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYnkoe3g6IDIwfSwgMylcbiAgICAgICAgICAgICAgICAuYnkoe3g6IC0zMH0sIDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc1N1cGVyQXJtb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYXRrLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQzMCwgeDogLTJ9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgIH0sXG5cbiAgICAvL+mjm+OBs+mBk+WFt+W8vuOBjVxuICAgIGd1YXJkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgd2lkdGggPSAyNCwgaGVpZ2h0ID0gMjQ7XG4gICAgICAgIHZhciBhdGsgPSBxZnQuRW5lbXlBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAyNCwgaGVpZ2h0OiA0OCwgcG93ZXI6IDIwICsgdGhpcy5sZXZlbCAqIDV9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5lbmVteUxheWVyKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCArIHRoaXMuc2NhbGVYICogMTgsIHRoaXMueSlcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjApO1xuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSBhdGsuc2V0QWxwaGEoMC4zKTtcbiAgICAgICAgYXRrLm1hc3RlciA9IHRoaXM7XG4gICAgICAgIGF0ay50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICBhdGsudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGF0LnggKyB0aGF0LnNjYWxlWCAqIDE4O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pc011dGVraSA9IHRydWU7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQzMH0pXG4gICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzMDB9LCAzKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhhdC52eCA9IDQgKiB0aGF0LnNjYWxlWDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudG8oe3JvdGF0aW9uOiA0MzB9LCAzKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoYXQuaXNNdXRla2kgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSBNYXRoLm1pbigwLCA2IC0gdGhpcy5sZXZlbCk7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ0dXJuXCJdID0gWzYsIFwid2Fsa1wiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5hcmNobWFnZS5qc1xuICogIDIwMTcvMDUvMDFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Ki44O844Kv44Oh44Kk44K4XG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQXJjaE1hZ2VcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA1MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAyNTYsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMzYwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogODAwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMzAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIGx2ID0gTWF0aC5taW4odGhpcy5sZXZlbCwgMyk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDNcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKChsdiAlIDIpICogMTQ0ICsgNzIsIE1hdGguZmxvb3IobHYgLyAyKSAqIDEyOCwgNzIsIDEyOCk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMjtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMzAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLnNwZWVkID0gMTtcbiAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcblxuICAgICAgICAvL+aOpei/keaIpue1jOmBjuaZgumWk1xuICAgICAgICB0aGlzLm5lYXJDb3VudCA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuICAgICAgICB2YXIgZGlzdGFuY2UgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG5cbiAgICAgICAgLy/jgZPjgozku6XkuIrpgLLjgoHjgarjgYTloLTlkIjjga/mipjjgorov5TjgZlcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OG44Oq44OI44Oq44O85oyH5a6aXG4gICAgICAgIGlmICh0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgLy/msLTlubPmlrnlkJHjga7jgb/jg4Hjgqfjg4Pjgq9cbiAgICAgICAgICAgIHZhciB0eCA9IHRoaXMueCAtIHRoaXMuZmlyc3RYO1xuICAgICAgICAgICAgaWYgKE1hdGguYWJzKHR4KSA+IHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHR4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/pgJrluLjjg5Xjgqfjg7zjgrrjgafjg5fjg6zjgqTjg6Tjg7zjgpLnmbropovjgZfjgZ/jgonorabmiJLjg5Xjgqfjg7zjgrrjgavnp7vjgotcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMCAmJiBsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgICAgICB0aGlzLnBoYXNlID0gMTtcbiAgICAgICAgICAgIHRoaXMuc3BlZWQgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzpm6LjgozjgZ/jgonpgJrluLjjg5Xjgqfjg7zjgrpcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgIT0gMCkge1xuICAgICAgICAgICAgaWYgKGRpc3RhbmNlID4gMTkyIHx8ICFsb29rKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRhZ2dlci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhZ2dlcltpXS5waGFzZSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/pgJrluLhcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy52eCA9IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbGF5ZXIueCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+itpuaIklxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5iYWxsb29uID09IG51bGwpIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIuLi5cIiwgYW5pbWF0aW9uSW50ZXJ2YWwgOiAxNX0pO1xuICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgMTkyKSB0aGlzLnBoYXNlID0gMjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5pS75pKDXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDIpIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRhZ2dlci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGFnZ2VyW2ldLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDkyKSB0aGlzLnBoYXNlID0gMztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAzKSB7XG4gICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5kYWdnZXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhZ2dlcltpXS5waGFzZSA9IDEwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDQgJiYgdGhpcy50aW1lICUgOTAgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMikge1xuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIkJ1bGxldFwiLCB7ZXhwbG9kZTogdHJ1ZX0pO1xuICAgICAgICAgICAgICAgIGIucm90YXRpb24gPSB0aGlzLmdldFBsYXllckFuZ2xlKCkgKyBNYXRoLnJhbmRpbnQoLTMwLCAzMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5waGFzZSA9PSA0KSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlfSk7XG4gICAgICAgICAgICAgICAgICAgIGIucm90YXRpb24gPSB0aGlzLmdldFBsYXllckFuZ2xlKCkgKyBNYXRoLnJhbmRpbnQoLTYwLCA2MCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRpc3RhbmNlIDwgOTYpIHtcbiAgICAgICAgICAgIHRoaXMubmVhckNvdW50Kys7XG4gICAgICAgICAgICBpZiAodGhpcy5uZWFyQ291bnQgPiA5MCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGVsZXBvcnQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5lYXJDb3VudCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm5lYXJDb3VudCAtPSAxMDtcbiAgICAgICAgICAgIGlmICh0aGlzLm5lYXJDb3VudCA8IDApIHRoaXMubmVhckNvdW50ID0gMDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODhuODrOODneODvOODiFxuICAgIHRlbGVwb3J0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRhZ2dlci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5kYWdnZXJbaV0ucGhhc2UgPSAxMDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzAsIDEsIDIsIDFdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZmlyc3RGcmFtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44Oe44K444OD44Kv44OA44Ks44O86KOF5YKZXG4gICAgICAgIHRoaXMuZGFnZ2VyID0gW107XG4gICAgICAgIHRoaXMuZGFnZ2VyWzBdID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIk1hZ2ljRGFnZ2VyXCIsIHtwYXJlbnQ6IHRoaXMsIG9mZnNldFg6ICAxNiwgb2Zmc2V0WTogLTE2LCBvcmRlcjogMCwgbGV2ZWw6IHRoaXMubGV2ZWx9KTtcbiAgICAgICAgdGhpcy5kYWdnZXJbMV0gPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiTWFnaWNEYWdnZXJcIiwge3BhcmVudDogdGhpcywgb2Zmc2V0WDogLTE2LCBvZmZzZXRZOiAtMTYsIG9yZGVyOiAxLCBsZXZlbDogdGhpcy5sZXZlbH0pO1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDIpIHRoaXMuZGFnZ2VyWzJdID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIk1hZ2ljRGFnZ2VyXCIsIHtwYXJlbnQ6IHRoaXMsIG9mZnNldFg6IC0zMiwgb2Zmc2V0WTogLTgsIG9yZGVyOiAyLCBsZXZlbDogdGhpcy5sZXZlbH0pO1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDMpIHRoaXMuZGFnZ2VyWzNdID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIk1hZ2ljRGFnZ2VyXCIsIHtwYXJlbnQ6IHRoaXMsIG9mZnNldFg6ICAzMiwgb2Zmc2V0WTogLTgsIG9yZGVyOiAzLCBsZXZlbDogdGhpcy5sZXZlbH0pO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuYmFieWRlbW9uLmpzXG4gKiAgMjAxNy8wMS8xM1xuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jg5njg5Pjg7zjg4fjg7zjg6Ljg7NcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5CYWJ5RGVtb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA0MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiA1MDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiA1LFxuICAgIGRyb3BJdGVtOiBJVEVNX0pFV0VMLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDIsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0pFV0VMQk9YLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjAsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDAsIDAsIDcyLCAxMjgpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDI7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDEwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembolxuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/msY7nlKjov73ot6HjgqLjg6vjgrTjg6rjgrrjg6BcbiAgICAgICAgdGhpcy5jaGFzZUFsZ29yaXRobShkaXMsIGxvb2spO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6L+R44GP44Gr44GE44Gf44KJ5pS75pKDXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciAmJiBsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA2NCkge1xuICAgICAgICAgICAgLy/po5vjgbPjgYvjgYvjgotcbiAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMudnkgPSAtNjtcbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsb29rIHx8IHRoaXMuY2hhc2VUaW1lID4gMCkge1xuICAgICAgICAgICAgdGhpcy52eCAqPSA0O1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuYmlyZC5qc1xuICogIDIwMTYvMTIvMzFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v6bOlXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQmlyZFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDMwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA2MCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAyMDAsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZUFycm93OiA1LFxuXG4gICAgZGVmYXVsdE9wdGlvbnM6IHtcbiAgICAgICAgc3BlZWQ6IDIsXG4gICAgICAgIGRpcmVjdGlvbjogMCxcbiAgICAgICAgcmV0dXJuVGltZTogMTIwLFxuICAgIH0sXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE4fSk7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zLiRzYWZlKHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIGNhcExldmVsID0gTWF0aC5taW4odGhpcy5sZXZlbCwgNCk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDFcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKGNhcExldmVsICogNzIsIDAsIDcyLCAxMjgpLnNldFNjYWxlKDEgKyBjYXBMZXZlbCAqIDAuMSk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDY7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmlzVmVydGljYWwgPSB0aGlzLm9wdGlvbnMudmVydGljYWwgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gdGhpcy5vcHRpb25zLmRpcmVjdGlvbiB8fCB0aGlzLmlzVmVydGljYWw/IDkwOiAwO1xuICAgICAgICB0aGlzLnNwZWVkID0gdGhpcy5vcHRpb25zLnNwZWVkIHx8IDI7XG4gICAgICAgIHRoaXMucmV0dXJuVGltZSA9IHRoaXMub3B0aW9ucy5yZXR1cm5UaW1lIHx8IDEyMDtcbiAgICAgICAgdGhpcy5ib21iSW50ZXJ2YWwgPSB0aGlzLm9wdGlvbnMuYm9tYkludGVydmFsIHx8IDkwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHJldHVybjtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODgeOCp+ODg+OCr+OBmeOCi+WjgeaxuuWumlxuICAgICAgICB2YXIgY2hrID0gMDtcbiAgICAgICAgaWYgKCF0aGlzLmlzVmVydGljYWwpIGNoayA9IDE7XG5cbiAgICAgICAgLy/lo4HjgavlvZPjgZ/jgovjgYvkuIDlrprmmYLplpPntYzpgY7jgafmipjjgorov5TjgZdcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvbltjaGtdLmhpdCB8fCB0aGlzLl9jb2xsaXNpb25bY2hrKzJdLmhpdCB8fCB0aGlzLnJldHVyblRpbWUgPCAwKSB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICB0aGlzLnJldHVyblRpbWUgPSB0aGlzLm9wdGlvbnMucmV0dXJuVGltZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844KS44G/44Gk44GR44Gf44KJ5Yqg6YCfXG4gICAgICAgIGlmICh0aGlzLmlzTG9va1BsYXllcigpKSB7XG4gICAgICAgICAgICB0aGlzLnNwZWVkID0gNDtcbiAgICAgICAgICAgIHRoaXMucmV0dXJuVGltZSAtPSAyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zcGVlZCA9IDI7XG4gICAgICAgICAgICB0aGlzLnJldHVyblRpbWUtLTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v56e75YuVXG4gICAgICAgIHZhciByYWQgPSB0aGlzLmRpcmVjdGlvbi50b1JhZGlhbigpO1xuICAgICAgICB0aGlzLnZ4ID0gTWF0aC5jb3MocmFkKSAqIHRoaXMuc3BlZWQ7XG4gICAgICAgIHRoaXMudnkgPSBNYXRoLnNpbihyYWQpICogdGhpcy5zcGVlZDtcblxuICAgICAgICAvL+iQveOBl+eJqVxuICAgICAgICBpZiAodGhpcy5vblNjcmVlbiAmJiB0aGlzLnRpbWUgJSB0aGlzLmJvbWJJbnRlcnZhbCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQmlyZEJvbWJcIiwge30pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/lkJHjgY3jga7mjIflrppcbiAgICAgICAgaWYgKHRoaXMudnggIT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwgJiYgdGhpcy5nZXREaXN0YW5jZVBsYXllcigpIDwgMjU2KSB7XG4gICAgICAgICAgICBpZiAodGhpcy54IDwgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIueCkgdGhpcy5zY2FsZVggPSAxOyBlbHNlIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG5cbi8v6bOl44Gu6JC944GX54mpXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQmlyZEJvbWJcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiA1LFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogNSwgaGVpZ2h0OiA1fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYnVsbGV0XCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDcyKTtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDY7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikgdGhpcy5yZW1vdmUoKTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJub3JtYWxcIl0gPSBbNzIsIDczLCA3NCwgNzNdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5idWxsZXQuanNcbiAqICAyMDE3LzAxLzEzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuQnVsbGV0XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMSxcblxuICAgIC8v5a+/5ZG9XG4gICAgbGlmZXNwYW46IDc1LFxuXG4gICAgLy/pgJ/luqZcbiAgICB2ZWxvY2l0eTogMixcblxuICAgIC8v5Yqg6YCf5bqmXG4gICAgYWNjZWw6IDEuMDIsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAxLjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAwLFxuXG4gICAgLy/niIbnmbrjg5Xjg6njgrBcbiAgICBleHBsb2RlOiBmYWxzZSxcblxuICAgIC8v5b2x6KGo56S644OV44Op44KwXG4gICAgaXNTaGFkb3c6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjAsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTtcbiAgICAgICAgdGhpcy5wb3dlciA9IG9wdGlvbnMucG93ZXIgfHwgdGhpcy5wb3dlcjtcbiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IG9wdGlvbnMucm90YXRpb24gfHwgMDtcbiAgICAgICAgdGhpcy52ZWxvY2l0eSA9IG9wdGlvbnMudmVsb2NpdHkgfHwgdGhpcy52ZWxvY2l0eTtcbiAgICAgICAgdGhpcy5saWZlU3BhbiA9IG9wdGlvbnMubGlmZVNwYW4gfHwgdGhpcy5saWZlU3BhbjtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcImV4cGxvZGVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZWZmZWN0XCIsIDQ4LCA0OCkuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZVRyaW1taW5nKDAsIDE5MiwgMTkyLCA5Nik7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgICAgICAgICAgICAgdGhpcy5leHBsb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5pZ25vcmVDb2xsaXNpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNNdXRla2kgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0dGVybiA9IFwiZXhwbG9kZVwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYnVsbGV0XCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDkpO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgICAgICAgICAgICAgIHRoaXMuZXhwbG9kZSA9IG9wdGlvbnMuZXhwbG9kZSB8fCB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0dGVybiA9IG9wdGlvbnMucGF0dGVybiB8fCBcInBhdHRlcm4xXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbih0aGlzLnBhdHRlcm4pO1xuXG4gICAgICAgIHRoaXMub24oJ2RlYWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmV4cGxvZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRWZmZWN0KHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiYm9tYlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciByYWQgPSB0aGlzLnJvdGF0aW9uLnRvUmFkaWFuKCk7XG4gICAgICAgIHRoaXMudnggPSBNYXRoLmNvcyhyYWQpICogdGhpcy52ZWxvY2l0eTtcbiAgICAgICAgdGhpcy52eSA9IE1hdGguc2luKHJhZCkgKiB0aGlzLnZlbG9jaXR5O1xuICAgICAgICB0aGlzLnZlbG9jaXR5ICo9IHRoaXMuYWNjZWw7XG4gICAgICAgIGlmICh0aGlzLnZ4ID4gMSkgdGhpcy5zcHJpdGUuc2NhbGVYID0gMTsgZWxzZSB0aGlzLnNwcml0ZS5zY2FsZVggPSAtMTtcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IHRoaXMubGlmZXNwYW4pIHRoaXMucmVtb3ZlKCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmlnbm9yZUNvbGxpc2lvbikge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblswXS5oaXQgfHxcbiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25bMV0uaGl0IHx8XG4gICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uWzJdLmhpdCB8fFxuICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHRoaXMuZmxhcmUoJ2RlYWQnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInBhdHRlcm4xXCJdID0gWzksIDEwLCAxMSwgMTBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjJcIl0gPSBbMTUsIDE2LCAxNywgMTZdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZXhwbG9kZVwiXSA9IFswLCAxLCAyLCAzLCA0LCA1LCA2LCA3LCBcInJlbW92ZVwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGhpdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT0gXCJleHBsb2RlXCIpIHJldHVybjtcblxuICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLmZsYXJlKCdkZWFkJyk7XG4gICAgfSxcblxuICAgIGRyb3BEZWFkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzRHJvcCA9IHRydWU7XG4gICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICB0aGlzLnZ5ID0gLTEwO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmRlYXRoLmpzXG4gKiAgMjAxNi8xMi8zMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/mrbvnpZ5cbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5EZWF0aFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDMwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAyMCxcblxuICAgIC8v5rCX57W256K6546HXG4gICAgc3R1blBvd2VyOiAzMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDEyOCxcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAxODAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v44OO44OD44Kv44OQ44OD44Kv44Kt44Oj44Oz44K744OrXG4gICAgaXNTdXBlckFybW9yOiB0cnVlLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogNTAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fU1RPTkUsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogNSxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fU1RPTkUsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZUZpcmU6IDIuMCxcbiAgICBkYW1hZ2VJY2U6IDAuOCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAyXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygwLCAxMjgsIDcyLCAxMjgpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDE7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDEwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm1vdmVcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgICAgICB0aGlzLnNwZWVkID0gMTtcblxuICAgICAgICAvL+ihjOWLleODkeOCv+ODvOODs1xuICAgICAgICB0aGlzLnBhdHRlcm4gPSBvcHRpb25zLnBhdHRlcm4gfHwgXCJsaW5lYXJcIjtcbiAgICAgICAgdGhpcy5tb3ZlTGVuZ3RoID0gb3B0aW9ucy5sZW5ndGggfHwgNDg7XG4gICAgICAgIHRoaXMuZGVncmVlID0gMDtcbiAgICAgICAgdGhpcy5pc1ZlcnRpY2FsID0gZmFsc2U7XG5cbiAgICAgICAgLy/ooqvjg4Djg6Hjg7zjgrjmmYLlh6bnkIZcbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudHdlZW5lcjIgPSBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMpO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIHZhciByYWQgPSB0aGlzLmRlZ3JlZS50b1JhZGlhbigpO1xuICAgICAgICBpZiAodGhpcy5wYXR0ZXJuID09IFwibGluZWFyXCIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gTWF0aC5jb3MocmFkKSAqIDI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSBNYXRoLmNvcyhyYWQpICogMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRlZ3JlZSArPSAyO1xuXG4gICAgICAgIC8v5b6Y5b6K44Oi44O844OJ44Gu5aC05ZCI44Gv6YGp5b2T44Gr5pS75pKDXG4gICAgICAgIGlmICh0aGlzLnRpbWUgJSA5MCA9PSAwKSB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcblxuICAgICAgICAvL+aUu+aSg1xuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiRGVhdGhGbGFtZVwiLCB7cGF0dGVybjogMH0pO1xuICAgICAgICAgICAgYi52eSA9IC0yO1xuICAgICAgICAgICAgYi52eCA9IDIgKiB0aGlzLnNjYWxlWDtcbiAgICAgICAgICAgIHRoaXMuYWN0aW9uV2FpdCA9IDEyMDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm1vdmVcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9IFs2LCA3LCA2LCA4XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSAgIFswLCAxLCAwLCAyXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuXG4vL+eCjlxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkRlYXRoRmxhbWVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjEsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAwLjk4LFxuXG4gICAgLy/msJfntbbnorrnjodcbiAgICBzdHVuUG93ZXI6IDIwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IGZhbHNlLFxuXG4gICAgLy/nhKHmlbXjg5Xjg6njgrBcbiAgICBpc011dGVraTogdHJ1ZSxcblxuICAgIC8v5pS75pKD5b2T44Gf44KK5Yik5a6a5pyJ5Yq544OV44Op44KwXG4gICAgaXNBdHRhY2tDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+Wvv+WRvVxuICAgIGxpZmVTcGFuOiAxMjAsXG5cbiAgICAvL+W9seihqOekuuODleODqeOCsFxuICAgIGlzU2hhZG93OiBmYWxzZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDIwfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLnBhdHRlcm4gPSBvcHRpb25zLnBhdHRlcm4gfHwgMDtcbiAgICAgICAgdGhpcy5saWZlU3BhbiA9IG9wdGlvbnMubGlmZVNwYW4gfHwgMTIwO1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuXG4gICAgICAgIHRoaXMuc2V0dXBBbmltYXRpb24odGhpcy5wYXR0ZXJuKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZmxhbWUwM1wiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgMTQ0LCAxMjgpLnNldEZyYW1lSW5kZXgoMTUgKyB0aGlzLnBhdHRlcm4pO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwiYXBwZWFyXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmxpZmVTcGFuID09IDApIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIGlmICh0aGlzLmxpZmVTcGFuIDwgMzApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAyID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDYwKXtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSA1ID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDkwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMTAgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpZmVTcGFuLS07XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICBpbmRleCA9IGluZGV4IHx8IDA7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImFwcGVhclwiXSA9IFsxNStpbmRleCwgOStpbmRleCwgIDMraW5kZXgsIDIxK2luZGV4LCBcIm5vcm1hbFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm5vcm1hbFwiXSA9IFsgMCtpbmRleCwgNitpbmRleCwgMTIraW5kZXgsIDE4K2luZGV4XTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGRyb3BEZWFkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzRHJvcCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuZGVtb24uanNcbiAqICAyMDE3LzAxLzEzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+ODh+ODvOODouODs1xucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkRlbW9uXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMTAwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAzMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDE5MixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA5MCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDUwMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDUsXG4gICAgZHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogMixcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUxCT1gsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAyMCwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoTWF0aC5taW4odGhpcy5sZXZlbCwgNCkgKiA3MiwgNjQwLCA3MiwgMTI4KVxuICAgICAgICAgICAgLnNldFNjYWxlKDEuNSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAtOCk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogMTA7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDM7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDMwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgMTYpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgMTYpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5aOB44Gr5b2T44Gf44Gj44Gf44KJ5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzFdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBjOi/keOBj+OBq+OBhOOBn+OCieaUu+aSg1xuICAgICAgICAgICAgaWYgKGxvb2sgJiYgIXRoaXMuaXNKdW1wICYmICF0aGlzLmlzQXR0YWNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpcyA+IDk2KSB7XG4gICAgICAgICAgICAgICAgICAgIC8v54Gr44KS5ZCQ44GPXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZWJhbGwoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL+mjm+OBs+OBi+OBi+OCi1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy52eCAqPSAzO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGRpcyA8IDI1Nikge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy/ngavnkIPjgpLlkJDjgY9cbiAgICBmaXJlYmFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcykuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlLCBwb3dlcjogMTAgKyB0aGlzLmxldmVsICogNSwgcm90YXRpb246IHRoaXMuZ2V0UGxheWVyQW5nbGUoKX0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53YWl0KDMwKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHR3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+eBq+OCkuWQkOOBj1xuICAgIGZsYW1pbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDYwO1xuICAgICAgICB0aGlzLnNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWRlT3V0KDE1KTtcblxuICAgICAgICB2YXIgcm90ID0gKHRoaXMuc2NhbGVYID09IDEpPyAwOiAxODA7XG4gICAgICAgIHZhciBjdCA9IDA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCArIDI0ICogdGhpcy5zY2FsZVgsIHRoaXMueS04LCBcIkJ1bGxldFwiLCB7dHlwZTogXCJleHBsb2RlXCIsIHBvd2VyOiAxMCwgcm90YXRpb246IHRoaXMuZ2V0UGxheWVyQW5nbGUoKSwgdmVsb2NpdHk6IDV9KTtcbiAgICAgICAgICAgICAgICBiLnNldFNjYWxlKDAuMSk7XG4gICAgICAgICAgICAgICAgYi50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJykudG8oe3NjYWxlWDogMSwgc2NhbGVZOiAxfSwgMTApO1xuICAgICAgICAgICAgICAgIGN0Kys7XG4gICAgICAgICAgICAgICAgaWYgKGN0ID09IDYgfHwgdGhpcy5hdHRhY2tDYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdHcucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2tDYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoNSlcbiAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmRldmlsLmpzXG4gKiAgMjAxNy8wNC8yNVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/mgqrprZRcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5EZXZpbFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDMwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/mqKrnp7vli5XmuJvoobDnjodcbiAgICBmcmljdGlvbjogMC4wLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAzNjAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDgwMCxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlQXJyb3c6IDUsXG5cbiAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgICBzcGVlZDogMixcbiAgICAgICAgZGlyZWN0aW9uOiAwLFxuICAgICAgICByZXR1cm5UaW1lOiAxMjAsXG4gICAgfSxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDEwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9TVE9ORSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE4fSkuJHNhZmUodGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAyXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyg3MiwgMCwgNzIsIDEyOCk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogMTA7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDEwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0YW5kXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuaXNWZXJ0aWNhbCA9IHRoaXMub3B0aW9ucy52ZXJ0aWNhbCB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSB0aGlzLm9wdGlvbnMuZGlyZWN0aW9uIHx8IHRoaXMuaXNWZXJ0aWNhbD8gOTA6IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSB0aGlzLm9wdGlvbnMuc3BlZWQgfHwgMjtcbiAgICAgICAgdGhpcy5yZXR1cm5UaW1lID0gdGhpcy5vcHRpb25zLnJldHVyblRpbWUgfHwgMTIwO1xuICAgICAgICB0aGlzLmF0dGFja0ludGVydmFsID0gdGhpcy5vcHRpb25zLmF0dGFja0ludGVydmFsIHx8IDkwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaDheWgsVxuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6L+R44GP44Gr44GE44Gf44KJ5a+E44Gj44Gm44GE44GPXG4gICAgICAgIGlmIChsb29rICYmIGRpcyA+IDMyKSB7XG4gICAgICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICAgICAgdmFyIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHBsLngsIHBsLnkpO1xuICAgICAgICAgICAgdmFyIHAgPSBwMi5zdWIocDEpO1xuICAgICAgICAgICAgcC5ub3JtYWxpemUoKTtcbiAgICAgICAgICAgIHRoaXMudnggPSBwLnggKiAoMSArIHRoaXMubGV2ZWwgKiAwLjIpO1xuICAgICAgICAgICAgdGhpcy52eSA9IHAueSAqICgxICsgdGhpcy5sZXZlbCAqIDAuMik7XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844Gu5pa55ZCR44KS5ZCR44GPXG4gICAgICAgICAgICB2YXIgYW5nbGUgPSB0aGlzLmdldFBsYXllckFuZ2xlKCk7XG4gICAgICAgICAgICBpZiAoYW5nbGUgPiAzMTUgfHwgYW5nbGUgPCA0NSkgdGhpcy5zZXRBbmltYXRpb24oJ2hvcml6b24nKTtcbiAgICAgICAgICAgIGlmICggNDUgPCBhbmdsZSAmJiBhbmdsZSA8IDEzNSkgdGhpcy5zZXRBbmltYXRpb24oJ2Rvd24nKTtcbiAgICAgICAgICAgIGlmICgxMzUgPCBhbmdsZSAmJiBhbmdsZSA8IDIyNSkgdGhpcy5zZXRBbmltYXRpb24oJ2hvcml6b24nKTtcbiAgICAgICAgICAgIGlmICgyMjUgPCBhbmdsZSAmJiBhbmdsZSA8IDMxNSkgdGhpcy5zZXRBbmltYXRpb24oJ2Rvd24nKTtcblxuICAgICAgICAgICAgLy/kuIDlrprku6XkuIrov5HjgaXjgYTjgZ/jgonmlLvmkoNcbiAgICAgICAgICAgIGlmIChkaXMgPCA5NikgdGhpcy5pc0F0dGFjayA9IHRydWU7XG5cbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcInN0YW5kXCIpO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy52eCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gLTE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgdGhpcy5hdHRhY2soKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhdHRhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIkJ1bGxldFwiLCB7ZXhwbG9kZTogdHJ1ZSwgcG93ZXI6IDEwICsgdGhpcy5sZXZlbCAqIDUsIHJvdGF0aW9uOiB0aGlzLmdldFBsYXllckFuZ2xlKCl9KTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFs2LCA3LCA4LCA3XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gWzAsIDEsIDIsIDFdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFs1LCA2LCA3LCA2XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImhvcml6b25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuZXhwbG9kZS5qc1xuICogIDIwMTcvMDcvMDFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5FeHBsb2RlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMSxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAuOTgsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAwLFxuXG4gICAgLy/nhKHmlbXjg5Xjg6njgrBcbiAgICBpc011dGVraTogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDIwLCBoZWlnaHQ6IDIwfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZWZmZWN0XCIsIDQ4LCA0OClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0RnJhbWVUcmltbWluZygwLCAxOTIsIDE5MiwgOTYpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcblxuICAgICAgICB0aGlzLnBvd2VyID0gb3B0aW9ucy5wb3dlciB8fCB0aGlzLnBvd2VyO1xuXG4gICAgICAgIHRoaXMucGF0dGVybiA9IG9wdGlvbnMucGF0dGVybiB8fCBcInBhdHRlcm4xXCI7XG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKHRoaXMucGF0dGVybik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5pbmRleCA9PSA4KSB0aGlzLnJlbW92ZSgpO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInBhdHRlcm4xXCJdID0gWzAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5maXJlYmlyZC5qc1xuICogIDIwMTYvMDMvMDlcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v6bOlXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuRmlyZUJpcmRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiA1MCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAyNTYsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogOTAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMzAwLFxuXG4gICAgLy/lsZ7mgKfjg4Djg6Hjg7zjgrjlgI3njodcbiAgICBkYW1hZ2VBcnJvdzogNSxcbiAgICBkYW1hZ2VGaXJlOiAwLjUsXG4gICAgZGFtYWdlSWNlOiAyLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAzLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgICBzcGVlZDogMixcbiAgICAgICAgZGlyZWN0aW9uOiAwLFxuICAgICAgICByZXR1cm5UaW1lOiAxMjAsXG4gICAgfSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2LCBvZmZzZXRDb2xsaXNpb25YOiAtNn0pO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucy4kc2FmZSh0aGlzLmRlZmF1bHRPcHRpb25zKTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjg4LCAwLCA3MiwgMTI4KTtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5pc1ZlcnRpY2FsID0gdGhpcy5vcHRpb25zLnZlcnRpY2FsIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMub3B0aW9ucy5kaXJlY3Rpb24gfHwgdGhpcy5pc1ZlcnRpY2FsPyA5MDogMDtcbiAgICAgICAgdGhpcy5zcGVlZCA9IHRoaXMub3B0aW9ucy5zcGVlZCB8fCAyO1xuICAgICAgICB0aGlzLnJldHVyblRpbWUgPSB0aGlzLm9wdGlvbnMucmV0dXJuVGltZSB8fCAxMjA7XG4gICAgICAgIHRoaXMuYm9tYkludGVydmFsID0gdGhpcy5vcHRpb25zLmJvbWJJbnRlcnZhbCB8fCA5MDtcbiAgICAgICAgdGhpcy5hdHRhY2tJbnRlcnZhbCA9IDA7XG4gICAgICAgIHRoaXMuYXR0YWNrQ291bnQgPSA5OTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHJldHVybjtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm9uKCdkZWFkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRWZmZWN0KHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgICAgIGFwcC5wbGF5U0UoXCJib21iXCIpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg4Hjgqfjg4Pjgq/jgZnjgovlo4HmsbrlrppcbiAgICAgICAgdmFyIGNoayA9IDE7XG4gICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIGNoayA9IDA7XG5cbiAgICAgICAgLy/lo4HjgavlvZPjgZ/jgovjgYvkuIDlrprmmYLplpPntYzpgY7jgafmipjjgorov5TjgZdcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvbltjaGtdLmhpdCB8fCB0aGlzLl9jb2xsaXNpb25bY2hrKzJdLmhpdCB8fCB0aGlzLnJldHVyblRpbWUgPCAwKSB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICB0aGlzLnJldHVyblRpbWUgPSB0aGlzLm9wdGlvbnMucmV0dXJuVGltZTtcbiAgICAgICAgfVxuICAgICAgICAvL+enu+WLlVxuICAgICAgICB2YXIgcmFkID0gdGhpcy5kaXJlY3Rpb24udG9SYWRpYW4oKTtcbiAgICAgICAgdGhpcy52eCA9IE1hdGguY29zKHJhZCkgKiB0aGlzLnNwZWVkO1xuICAgICAgICB0aGlzLnZ5ID0gTWF0aC5zaW4ocmFkKSAqIHRoaXMuc3BlZWQ7XG4gICAgICAgIHRoaXMucmV0dXJuVGltZS0tO1xuIFxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+OBpOOBkeOBn+OCieaUu+aSg1xuICAgICAgICB2YXIgbG9va1BsYXllciA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG4gICAgICAgIGlmIChsb29rUGxheWVyKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hdHRhY2tJbnRlcnZhbCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnkrNiwgXCJCdWxsZXRcIiwge3BhdHRlcm46IFwicGF0dGVybjJcIiwgZXhwbG9kZTogdHJ1ZSwgdmVsb2NpdHk6IDN9KTtcbiAgICAgICAgICAgICAgICBiLnJvdGF0aW9uID0gdGhpcy5nZXRQbGF5ZXJBbmdsZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrSW50ZXJ2YWwgPSA5MDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFja0ludGVydmFsID0gNjA7XG4gICAgICAgIH1cblxuICAgICAgICAvL+iQveOBl+eJqVxuICAgICAgICBpZiAodGhpcy5vblNjcmVlbiAmJiB0aGlzLnRpbWUgJSB0aGlzLmJvbWJJbnRlcnZhbCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiRmlyZUJpcmRCb21iXCIsIHt9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5ZCR44GN44Gu5oyH5a6aXG4gICAgICAgIGlmICh0aGlzLnZ4ICE9IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4ID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc1ZlcnRpY2FsICYmIHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKSA8IDI1Nikge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA8IHRoaXMucGFyZW50U2NlbmUucGxheWVyLngpIHRoaXMuc2NhbGVYID0gMTsgZWxzZSB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuYXR0YWNrSW50ZXJ2YWwgPiAwKSB0aGlzLmF0dGFja0ludGVydmFsLS07XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgfSxcbn0pO1xuXG4vL+mzpeOBruiQveOBl+eJqVxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkZpcmVCaXJkQm9tYlwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiA1LCBoZWlnaHQ6IDV9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJidWxsZXRcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoNzIpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRWZmZWN0KHRoaXMueCwgdGhpcy55LCB7bmFtZTogXCJleHBsb2RlX2dyb3VuZFwifSk7XG4gICAgICAgICAgICBpZiAodGhpcy5vblNjcmVlbikgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWzcyLCA3MywgNzQsIDczXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIGRyb3BEZWFkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0RlYWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzRHJvcCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuZmxhbWUuanNcbiAqICAyMDE2LzEyLzMxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+eCjlxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkZsYW1lXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v54Sh5pW144OV44Op44KwXG4gICAgaXNNdXRla2k6IHRydWUsXG5cbiAgICAvL+aUu+aSg+W9k+OBn+OCiuWIpOWumuacieWKueODleODqeOCsFxuICAgIGlzQXR0YWNrQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/lr7/lkb1cbiAgICBsaWZlU3BhbjogMTIwLFxuXG4gICAgLy/lvbHooajnpLrjg5Xjg6njgrBcbiAgICBpc1NoYWRvdzogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAyMH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy5wYXR0ZXJuID0gb3B0aW9ucy5wYXR0ZXJuIHx8IDA7XG4gICAgICAgIHRoaXMubGlmZVNwYW4gPSBvcHRpb25zLmxpZmVTcGFuIHx8IDEyMDtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogNTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZmxhbWUwMlwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoTWF0aC5taW4odGhpcy5wYXR0ZXJuLCAyKSAqIDI0ICsgNzIsIDAsIDI0LCAxMjgpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmxpZmVTcGFuID09IDApIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgIGlmICh0aGlzLmxpZmVTcGFuIDwgMzApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSAyID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDYwKXtcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWUgJSA1ID09IDApIHRoaXMudmlzaWJsZSA9ICF0aGlzLnZpc2libGU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5saWZlU3BhbiA8IDkwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50aW1lICUgMTAgPT0gMCkgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpZmVTcGFuLS07XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWzAsIDEsIDIsIDNdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5nYXJ1ZGEuanNcbiAqICAyMDE3LzA3LzA3XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+aAqumzpVxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkdhcnVkYVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDgwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAyMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA2MCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDAsXG5cbiAgICAvL+OCueODvOODkeODvOOCouODvOODnuODvFxuICAgIGlzU3VwZXJBcm1vcjogdHJ1ZSxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDMwMDAsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZUFycm93OiA1LFxuXG4gICAgZGVmYXVsdE9wdGlvbnM6IHtcbiAgICAgICAgc3BlZWQ6IDIsXG4gICAgICAgIGRpcmVjdGlvbjogMCxcbiAgICAgICAgcmV0dXJuVGltZTogMTIwLFxuICAgIH0sXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDMsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE4fSk7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zLiRzYWZlKHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMXgyXCIsIDQ4LCA2NCkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygwLCAwLCA3MiAqIDIsIDEyOCAqIDIpLnNldFNjYWxlKDEuNSkuc2V0UG9zaXRpb24oMCwgMTYpO1xuXG4gICAgICAgIHRoaXMuc3ByaXRlMiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxeDJcIiwgNDgsIDY0KS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZTIuc2V0RnJhbWVUcmltbWluZygyODggKiAyLCAwLCA3MiAqIDIsIDEyOCAqIDIpLnNldFNjYWxlKDEuNSkuc2V0UG9zaXRpb24oMCwgMTYpLnNldEFscGhhKDApO1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHRoaXMuc3ByaXRlMi51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuZnJhbWVJbmRleCA9IHRoYXQuc3ByaXRlLmZyYW1lSW5kZXg7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA2O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5tb3ZlVGltZSA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnBhdGgpIHtcbiAgICAgICAgICAgIHZhciBwID0gdGhpcy5nZXRQYXRoUG9zaXRpb24odGhpcy5tb3ZlVGltZSk7XG4gICAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uKHAueCwgcC55KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vdmVUaW1lICs9IDI7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFswLCAxLCAyLCAxXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbNiwgNywgOCwgN107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmdyZWF0ZXJkZW1vbi5qc1xuICogIDIwMTcvMDUvMDFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44Kw44Os44O844K/44O844OH44O844Oi44OzXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuR3JlYXRlckRlbW9uXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMTIwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAyMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAxODAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiAxNSxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDUwMDAsXG5cbiAgICAvL+mjm+ihjOODouODvOODiVxuICAgIGZseWluZzogZmFsc2UsXG4gICAgZmx5aW5nUGhhc2U6IDAsIC8v6KGM5YuV44OV44Kn44O844K6XG4gICAgZmx5aW5nWDogMCwgICAgIC8v6aOb6KGM6ZaL5aeL77y45bqn5qiZXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9KRVdFTCxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAyLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9KRVdFTEJPWCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDM1LCBoZWlnaHQ6IDMwfSk7XG4gICAgICAgIGlmIChvcHRpb25zLnNpemUpIHtcbiAgICAgICAgICAgIHZhciBzaXplID0gb3B0aW9ucy5zaXplIHx8IDE7XG4gICAgICAgICAgICBvcHRpb25zLndpZHRoID0gc2l6ZSAqIDM1O1xuICAgICAgICAgICAgb3B0aW9ucy5oZWlnaHQgPSBzaXplICogMzA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDF4MlwiLCAyNCoyLCAzMioyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDcyKjIqMiwgNjQwKjIsIDcyKjIsIDEyOCoyKS5zZXRQb3NpdGlvbigwLCAtMTApO1xuICAgICAgICBpZiAob3B0aW9ucy5zaXplKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IG9wdGlvbnMuc2l6ZSB8fCAxO1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUuc2V0U2NhbGUoc2l6ZSkuc2V0UG9zaXRpb24oMCwgc2l6ZSAqIC0xMik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNwcml0ZTIgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMXgyXCIsIDI0KjIsIDMyKjIpLmFkZENoaWxkVG8odGhpcykuc2V0QWxwaGEoMCk7XG4gICAgICAgIHRoaXMuc3ByaXRlMi5zZXRGcmFtZVRyaW1taW5nKDI4OCoyLCA2NDAqMiwgNzIqMiwgMTI4KjIpLnNldFBvc2l0aW9uKDAsIC0xMCk7XG4gICAgICAgIHRoaXMuc3ByaXRlMi50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICBpZiAob3B0aW9ucy5zaXplKSB7XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IG9wdGlvbnMuc2l6ZSB8fCAxO1xuICAgICAgICAgICAgdGhpcy5zcHJpdGUyLnNldFNjYWxlKHNpemUpLnNldFBvc2l0aW9uKDAsIHNpemUgKiAtMTIpO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdGhpcy5zcHJpdGUyLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5mcmFtZUluZGV4ID0gdGhhdC5zcHJpdGUuZnJhbWVJbmRleDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0F0dGFja0NhbmNlbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgIHRoaXMudHVyblRpbWUgPSAwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB0aGlzLmlzQXR0YWNrQ2FuY2VsID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O85oOF5aCxXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/pgLLooYzmlrnlkJHmsbrlrppcbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOeZuuimi+W+jOS4gOWumuaZgumWk+i/vei3oeOBmeOCi1xuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAxMjA7XG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMudnggKj0gMztcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwICYmICF0aGlzLmlzQXR0YWNrICYmIHRoaXMudHVyblRpbWUgPT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDE4MCkgdGhpcy50dXJuQ291bnQrKztcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnR1cm5UaW1lID0gMTU7XG4gICAgICAgICAgICBpZiAobG9vaykgdGhpcy50dXJuQ291bnQgPSAwO1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgpLopovlpLHjgaPjgZ/nirbmhYvjgafkuInlm57mjK/jgorov5TjgaPjgZ/loLTlkIjjga/ov73ot6HntYLkuoZcbiAgICAgICAgICAgIGlmICh0aGlzLnR1cm5Db3VudCA+IDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhc2VUaW1lID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+W0luOBo+OBt+OBoeOBp+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBuOOBruaUu+aSg1xuICAgICAgICAgICAgaWYgKGxvb2sgJiYgIXRoaXMuaXNBdHRhY2sgJiYgIXRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpcyA+IDEyOCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmVicmVhdGgoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGxvZGluZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAzMCkgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgIH0sXG5cbiAgICAvL+eBq+eQg+OCkuWQkOOBj1xuICAgIGZpcmViYWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgdGhpcy5zcHJpdGUyLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmZhZGVJbigxMClcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiQnVsbGV0XCIsIHtleHBsb2RlOiB0cnVlLCByb3RhdGlvbjogdGhpcy5nZXRQbGF5ZXJBbmdsZSgpLCBwb3dlcjogMzB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2FpdCg0NSlcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmZhZGVPdXQoMTApO1xuICAgIH0sXG5cbiAgICAvL+eCjuOCkuWQkOOBj1xuICAgIGZpcmVicmVhdGg6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDYwO1xuICAgICAgICB0aGlzLnNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLndhaXQoNjApXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWRlT3V0KDE1KTtcblxuICAgICAgICB2YXIgcm90ID0gKHRoaXMuc2NhbGVYID09IDEpPyAwOiAxODA7XG4gICAgICAgIHZhciBjdCA9IDA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCArIDI0ICogdGhpcy5zY2FsZVgsIHRoaXMueS04LCBcIkJ1bGxldFwiLCB7dHlwZTogXCJleHBsb2RlXCIsIHBvd2VyOiAxMCwgcm90YXRpb246IHRoaXMuZ2V0UGxheWVyQW5nbGUoKSwgdmVsb2NpdHk6IDV9KTtcbiAgICAgICAgICAgICAgICBiLnNldFNjYWxlKDAuMSk7XG4gICAgICAgICAgICAgICAgYi50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJykudG8oe3NjYWxlWDogMSwgc2NhbGVZOiAxfSwgMTApO1xuICAgICAgICAgICAgICAgIGN0Kys7XG4gICAgICAgICAgICAgICAgaWYgKGN0ID09IDYgfHwgdGhpcy5hdHRhY2tDYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdHcucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2tDYW5jZWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoNSlcbiAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgIH0sXG5cbiAgICAvL+eIhueZulxuICAgIGV4cGxvZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIGFwcC5wbGF5U0UoXCJib21iXCIpO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDYwO1xuICAgICAgICB0aGlzLnNwcml0ZTIudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLndhaXQoNDUpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWRlT3V0KDE1KTtcblxuICAgICAgICB2YXIgcm90ID0gKHRoaXMuc2NhbGVYID09IDEpPyAwOiAxODA7XG4gICAgICAgIHZhciBjdCA9IDA7XG4gICAgICAgIHZhciB0dyA9IHBoaW5hLmFjY2Vzc29yeS5Ud2VlbmVyKCkuYXR0YWNoVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciByYWQgPSByb3QudG9SYWRpYW4oKTtcbiAgICAgICAgICAgICAgICB2YXIgZXggPSBNYXRoLmNvcyhyYWQpICogMTY7XG4gICAgICAgICAgICAgICAgdmFyIGV5ID0gTWF0aC5zaW4ocmFkKSAqIDE2O1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLnggKyBleCwgdGhpcy55ICsgZXksIFwiQnVsbGV0XCIsIHt0eXBlOiBcImV4cGxvZGVcIiwgcG93ZXI6IDEwLCByb3RhdGlvbjogcm90LCB2ZWxvY2l0eTogM30pO1xuICAgICAgICAgICAgICAgIHJvdCArPSAyMi41O1xuICAgICAgICAgICAgICAgIGN0Kys7XG4gICAgICAgICAgICAgICAgaWYgKGN0ID09IDE2IHx8IHRoaXMuYXR0YWNrQ2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgIHR3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrQ2FuY2VsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53YWl0KDEpXG4gICAgICAgICAgICAuc2V0TG9vcCh0cnVlKTtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5pbnRlbGxpZ2VudHN3b3JkLmpzXG4gKiAgMjAxNy8wNy8xOVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LkludGVsbGlnZW50U3dvcmRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAyMCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v5qiq56e75YuV5rib6KGw546HXG4gICAgZnJpY3Rpb246IDEuMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMjAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMzYwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMjAwMCxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz44OV44Op44KwXG4gICAgaXNBbmltYXRpb246IGZhbHNlLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fTE9OR1NXT1JELFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDEsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0xPTkdTV09SRCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDI0fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoMTAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSlcbiAgICAgICAgICAgIC5zZXRSb3RhdGlvbigyMTUpO1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC50byh7eTogLTJ9LCAxMDAwLCBcImVhc2VJbk91dFNpbmVcIilcbiAgICAgICAgICAgIC50byh7eTogNH0sIDEwMDAsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG5cbiAgICAgICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlO1xuICAgICAgICB0aGlzLnBvd2VyID0gb3B0aW9ucy5wb3dlciB8fCB0aGlzLnBvd2VyO1xuICAgICAgICB0aGlzLnJvdGF0aW9uID0gb3B0aW9ucy5yb3RhdGlvbiB8fCAwO1xuICAgICAgICB0aGlzLnZlbG9jaXR5ID0gb3B0aW9ucy52ZWxvY2l0eSB8fCB0aGlzLnZlbG9jaXR5O1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuXG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgajjga7ot53pm6JcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlUGxheWVyKCk7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcblxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAobG9vayAmJiBkaXMgPCA2NCkge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDIpIHtcbiAgICAgICAgICAgIHZhciBhbmcgPSB0aGlzLmdldEFuZ2xlKHBsKTtcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSBhbmcgKyAzMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTUsIHk6IDB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjFcIl0gPSBbMF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBzbmFwOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgLy/lirnmnpzpn7NcbiAgICAgICAgYXBwLnBsYXlTRShcInRpbmtsaW5nXCIpO1xuICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLmJ5KHt5OiAtNjQsIHJvdGF0aW9uOiA3MDB9LCAxNSwgXCJlYXNlT3V0UXVhZFwiKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDEwO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LmtuaWdodC5qc1xuICogIDIwMTcvMDUvMDZcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v44OK44Kk44OIXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuS25pZ2h0XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogNzAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/pgJ/luqZcbiAgICBzcGVlZDogMSxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDE5MixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA5MCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDEwMDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiA3LFxuICAgIGRyb3BJdGVtOiBJVEVNX0pFV0VMLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDIsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0xPTkdTV09SRCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDIwLCBoZWlnaHQ6IDIwfSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+atpuWZqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLndlYXBvbiA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoMTAgKyBNYXRoLm1pbig5LCB0aGlzLmxldmVsKSlcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMSwgMSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigtNCwgMilcbiAgICAgICAgICAgIC5zZXRTY2FsZSgtMSwgMSlcbiAgICAgICAgICAgIC5zZXRSb3RhdGlvbig0MzApO1xuICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICB0aGlzLndlYXBvbi5raW5kID0gXCJzd29yZFwiO1xuICAgICAgICBpZiAob3B0aW9ucy53ZWFwb24gPT0gXCJheFwiKSB7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRGcmFtZUluZGV4KDIwICsgTWF0aC5taW4oOSwgdGhpcy5sZXZlbCkpO1xuICAgICAgICAgICAgdGhpcy53ZWFwb24ua2luZCA9IFwiYXhcIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy53ZWFwb24gPT0gXCJzcGVhclwiKSB7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi5zZXRGcmFtZUluZGV4KDMwICsgTWF0aC5taW4oOSwgdGhpcy5sZXZlbCkpO1xuICAgICAgICAgICAgdGhpcy53ZWFwb24ua2luZCA9IFwic3BlYXJcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDE0NCwgMTI4LCA3MiwgMTI4KTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0UG9zaXRpb24oMCwgLTUpLnNldFNjYWxlKDEuMyk7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogMTA7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDEwO1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiA1MDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gNjtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembolxuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O855m66KaL5b6M5LiA5a6a5pmC6ZaT6L+96Leh44GZ44KLXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDAgJiYgIXRoaXMuaXNBdHRhY2sgJiYgdGhpcy50dXJuVGltZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHVyblRpbWUgPSAxNTtcbiAgICAgICAgICAgIGlmIChsb29rKSB0aGlzLnR1cm5Db3VudCA9IDA7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+WkseOBo+OBn+eKtuaFi+OBp+S4ieWbnuaMr+OCiui/lOOBo+OBn+WgtOWQiOOBr+i/vei3oee1guS6hlxuICAgICAgICAgICAgaWYgKHRoaXMudHVybkNvdW50ID4gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/kuIDlrprot53pm6Lku6XkuIrpm6LjgozjgZ/jgonov73ot6Hop6PpmaRcbiAgICAgICAgaWYgKGRpcyA+IDUxMikgdGhpcy5jaGFzZVRpbWUgPSAwO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNKdW1wKSB0aGlzLnZ4ICo9IDE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAxMjA7XG4gICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCJ9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAwKSB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwKSB0aGlzLnZ4ICo9IDM7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+OBk+OCjOS7peS4iumAsuOCgeOBquOBhOWgtOWQiOOBr+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgdmFyIGlzUmV0dXJuV2FsbCA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGlzUmV0dXJuQ2xpZmYgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4ID4gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMV0uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy52eCA8IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkgaXNSZXR1cm5XYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkgaXNSZXR1cm5DbGlmZiA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNSZXR1cm5XYWxsIHx8IGlzUmV0dXJuQ2xpZmYpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86L+96Leh5Lit44Gn5q615beu44GM44GC44KL5aC05ZCI44Gv6aOb44Gz6LaK44GI44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA8IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTEyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTEyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOi/vei3oeS4reOBp+W0luOBjOOBguOCi+WgtOWQiOOBr+edgOWcsOeCueOBjOOBguOCi+OBi+iqv+OBueOBpumjm+OBs+mZjeOCiuOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGp1bXBPayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgOTYpKSBqdW1wT2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgOTYpKSBqdW1wT2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp1bXBPaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v552A5Zyw54K544GM54Sh44GE5aC05ZCI44Gv6Kum44KB44Gm5oqY44KK6L+U44GZXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnR1cm5XYWl0ID0gMTU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIuLi5cIn0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5pS75pKDXG4gICAgICAgICAgICBpZiAobG9vayAmJiAhdGhpcy5pc0p1bXAgJiYgZGlzIDwgNjQgJiYgIXRoaXMuaXNBdHRhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFjaygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOmjm+OBs+mBk+WFt+OCkuW8vuOBj++8iOODrOODmeODq++8lOS7peS4iu+8iVxuICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWwgPiAzICYmIGxvb2sgJiYgIXRoaXMuaXNBdHRhY2spIHtcbiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgrfjg6fjg4Pjg4jjgajjga7ot53pm6LliKTlrppcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnBsYXllckxheWVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5QbGF5ZXJBdHRhY2sgJiYgZS5pc0NvbGxpc2lvbiAmJiBlLnR5cGUgPT0gXCJhcnJvd1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5nZXREaXN0YW5jZShlKSA8IDY0KSB0aGF0Lmd1YXJkKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDMwKSB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiP1wifSk7XG4gICAgfSxcblxuICAgIGF0dGFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHdpZHRoID0gMjQsIGhlaWdodCA9IDI0O1xuICAgICAgICB2YXIgYXRrID0gcWZ0LkVuZW15QXR0YWNrKHRoaXMucGFyZW50U2NlbmUsIHt3aWR0aDogMjQsIGhlaWdodDogMjQsIHBvd2VyOiAyMCArIHRoaXMubGV2ZWwgKiA1fSlcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuZW5lbXlMYXllcilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLnggKyB0aGlzLnNjYWxlWCAqIDE4LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC4wKTtcbiAgICAgICAgaWYgKERFQlVHX0NPTExJU0lPTikgYXRrLnNldEFscGhhKDAuMyk7XG4gICAgICAgIGF0ay5tYXN0ZXIgPSB0aGlzO1xuICAgICAgICBhdGsudHdlZW5lci5zZXRVcGRhdGVUeXBlKCdmcHMnKTtcbiAgICAgICAgYXRrLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhhdC54ICsgdGhhdC5zY2FsZVggKiAxODtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLndlYXBvbi5raW5kID09IFwic3dvcmRcIiB8fCB0aGlzLndlYXBvbi5raW5kID09IFwiYXhcIikge1xuICAgICAgICAgICAgYXRrLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLndlYXBvbi50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAyNzB9LCAzKVxuICAgICAgICAgICAgICAgIC53YWl0KDMpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0ay5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQudnggPSAxNiAqIHRoYXQuc2NhbGVYO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogNDMwfSwgNilcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy53ZWFwb24ua2luZCA9PSBcInNwZWFyXCIpIHtcbiAgICAgICAgICAgIGF0ay53aWR0aCA9IDMyO1xuICAgICAgICAgICAgYXRrLmhlaWdodCA9IDg7XG4gICAgICAgICAgICBhdGsuc2V0UG9zaXRpb24odGhpcy54ICsgdGhpcy5zY2FsZVggKiAxLCB0aGlzLnkpO1xuICAgICAgICAgICAgYXRrLnR3ZWVuZXIuY2xlYXIoKS5ieSh7eDogMjAgKiB0aGlzLnNjYWxlWH0sIDEwKS5ieSh7eDogLTIwICogdGhpcy5zY2FsZVh9LCAxMCk7XG4gICAgICAgICAgICBhdGsuaXNBY3RpdmUgPSBmYWxzZTtcblxuICAgICAgICAgICAgdGhpcy53ZWFwb24udHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQ1LCB4OiAtMjB9KVxuICAgICAgICAgICAgICAgIC53YWl0KDIpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0ay5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNTdXBlckFybW9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC52eCA9IDMyICogdGhhdC5zY2FsZVg7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYnkoe3g6IDIwfSwgMylcbiAgICAgICAgICAgICAgICAuYnkoe3g6IC0zMH0sIDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5pc1N1cGVyQXJtb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYXRrLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQzMCwgeDogLTJ9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgIH0sXG5cbiAgICAvL+mjm+OBs+mBk+WFt+W8vuOBjVxuICAgIGd1YXJkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgd2lkdGggPSAyNCwgaGVpZ2h0ID0gMjQ7XG4gICAgICAgIHZhciBhdGsgPSBxZnQuRW5lbXlBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAyNCwgaGVpZ2h0OiAyNCwgcG93ZXI6IDIwICsgdGhpcy5sZXZlbCAqIDV9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5lbmVteUxheWVyKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCArIHRoaXMuc2NhbGVYICogMTgsIHRoaXMueSlcbiAgICAgICAgICAgIC5zZXRBbHBoYSgwLjApO1xuICAgICAgICBpZiAoREVCVUdfQ09MTElTSU9OKSBhdGsuc2V0QWxwaGEoMC4zKTtcbiAgICAgICAgYXRrLm1hc3RlciA9IHRoaXM7XG4gICAgICAgIGF0ay50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpO1xuICAgICAgICBhdGsudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGF0LnggKyB0aGF0LnNjYWxlWCAqIDE4O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pc011dGVraSA9IHRydWU7XG4gICAgICAgIHRoaXMud2VhcG9uLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnNldCh7cm90YXRpb246IDQzMH0pXG4gICAgICAgICAgICAudG8oe3JvdGF0aW9uOiAzMDB9LCAzKVxuICAgICAgICAgICAgLnRvKHtyb3RhdGlvbjogNDMwfSwgMylcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGF0LmlzTXV0ZWtpID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYXRrLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gNjtcbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5tYWdlLmpzXG4gKiAgMjAxNy8wNC8yOFxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/prZTooZPluKtcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5NYWdlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMjU2LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDE2MCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDUwMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDMwLFxuICAgIGRyb3BJdGVtOiBJVEVNX0NPSU4sXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogNSxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fQkFHLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTZ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHZhciBsdiA9IE1hdGgubWluKHRoaXMubGV2ZWwsIDQpO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAzXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygobHYgJSAyKSAqIDE0NCwgTWF0aC5mbG9vcihsdiAvIDIpICogMTI4LCA3MiwgMTI4KTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0U2NhbGUoMS4yKS5zZXRQb3NpdGlvbigwLCAtMik7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMjtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMjAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vcikge1xuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonot53pm6LjgpLlj5bjgotcbiAgICAgICAgICAgIGlmICh0aGlzLnBoYXNlID09IDAgJiYgbG9vayAmJiAhdGhpcy5pc0p1bXAgJiYgZGlzdGFuY2UgPCAxMjgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwifSk7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGVlZCA9IDM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v6YCD44GS44KL44OV44Kn44O844K6XG4gICAgICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgMTI4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPCBwbGF5ZXIueCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwZWVkID0gMztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGxheWVyLngpIHRoaXMuZGlyZWN0aW9uID0gMDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGVlZCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgbHYgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKChsdiAlIDIpICogMTQ0LCBNYXRoLmZsb29yKGx2IC8gMikgKiAxMjgsIDcyLCAxMjgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+aUu+aSg+ODleOCp+ODvOOCulxuICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMikge1xuICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDk2KSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6L+R44Gl44GE44Gf44KJ6YCD44GS44KLXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAxO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6YGg44GP44Gr44GE44KL5aC05ZCI44Gv5pS75pKDXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/nmbrni4Ljg6Ljg7zjg4lcbiAgICAgICAgICAgIGlmICh0aGlzLnBoYXNlID09IDMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2spIHtcbiAgICAgICAgICAgICAgICB2YXIgbHYgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKChsdiAlIDIpICogMTQ0ICsgNzIsIE1hdGguZmxvb3IobHYgLyAyKSAqIDEyOCwgNzIsIDEyOCk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPCAzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlYmFsbCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSA4O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmViYWxsKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmlrnlkJHjgpLlkJHjgY9cbiAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGxheWVyLngpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJldGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44GT44KM5Lul5LiK6YCy44KB44Gq44GE5aC05ZCI44Gv5oqY44KK6L+U44GZXG4gICAgICAgICAgICB2YXIgY2FudGVzY2FwZSA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQgfHwgdGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBoYXNlID09IDEpIGNhbnRlc2NhcGUgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0IHx8IHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC01LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMSkgY2FudGVzY2FwZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+mAg+OBkuOCieOCjOOBquOBhOWgtOWQiOOBr+eZuueLguODouODvOODiVxuICAgICAgICAgICAgaWYgKGNhbnRlc2NhcGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMztcbiAgICAgICAgICAgICAgICB0aGlzLnNwZWVkID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzpm6LjgozjgZ/jgonpgJrluLjjg5Xjgqfjg7zjgrpcbiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA+IDEyOCArIDY0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGx2ID0gTWF0aC5taW4odGhpcy5sZXZlbCwgNCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygobHYgJSAyKSAqIDE0NCwgTWF0aC5mbG9vcihsdiAvIDIpICogMTI4LCA3MiwgMTI4KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLnNwZWVkID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgdGhpcy52eCA9IHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzAsIDEsIDIsIDFdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgLy/jg5XjgqHjgqTjgqLjg5zjg7zjg6tcbiAgICBmaXJlYmFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJCdWxsZXRcIiwge2V4cGxvZGU6IHRydWUsIHJvdGF0aW9uOiB0aGlzLmdldFBsYXllckFuZ2xlKCkgKyBNYXRoLnJhbmRpbnQoLTQwLCA0MCl9KTtcbiAgICB9LFxuXG4gICAgLy/niIbnmbpcbiAgICBleHBsb2RlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYXBwLnBsYXlTRShcImJvbWJcIik7XG4gICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgdmFyIHJvdCA9ICh0aGlzLnNjYWxlWCA9PSAxKT8gMDogMTgwO1xuICAgICAgICB2YXIgY3QgPSAwO1xuICAgICAgICB2YXIgdHcgPSBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMpXG4gICAgICAgICAgICAuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgcmFkID0gcm90LnRvUmFkaWFuKCk7XG4gICAgICAgICAgICAgICAgdmFyIGV4ID0gTWF0aC5jb3MocmFkKSAqIDE2O1xuICAgICAgICAgICAgICAgIHZhciBleSA9IE1hdGguc2luKHJhZCkgKiAxNjtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54ICsgZXgsIHRoaXMueSArIGV5LCBcIkJ1bGxldFwiLCB7dHlwZTogXCJleHBsb2RlXCIsIHBvd2VyOiAxMCwgcm90YXRpb246IHJvdCwgdmVsb2NpdHk6IDN9KTtcbiAgICAgICAgICAgICAgICByb3QgKz0gMjIuNTtcbiAgICAgICAgICAgICAgICBjdCsrO1xuICAgICAgICAgICAgICAgIGlmIChjdCA9PSAzMiB8fCB0aGlzLmF0dGFja0NhbmNlbCkge1xuICAgICAgICAgICAgICAgICAgICB0dy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoMSlcbiAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkubWFnaWNkZ2dlci5qc1xuICogIDIwMTcvMDcvMTlcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5NYWdpY0RhZ2dlclwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEsXG5cbiAgICAvL+Wvv+WRvVxuICAgIGxpZmVzcGFuOiA3NSxcblxuICAgIC8v6YCf5bqmXG4gICAgdmVsb2NpdHk6IDIsXG5cbiAgICAvL+WKoOmAn+W6plxuICAgIGFjY2VsOiAxLjAyLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/mqKrnp7vli5XmuJvoobDnjodcbiAgICBmcmljdGlvbjogMS4wLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwid2VhcG9uc1wiLCAyNCwgMjQpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCgwKTtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJwYXR0ZXJuMVwiKTtcblxuICAgICAgICB0aGlzLnBvd2VyID0gb3B0aW9ucy5wb3dlciB8fCB0aGlzLnBvd2VyO1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiAyO1xuXG4gICAgICAgIHRoaXMucGFyZW50VW5pdCA9IG9wdGlvbnMucGFyZW50IHx8IG51bGw7XG4gICAgICAgIHRoaXMub2Zmc2V0WCA9IG9wdGlvbnMub2Zmc2V0WCB8fCBNYXRoLnJhbmRpbnQoLTE2LCAxNik7XG4gICAgICAgIHRoaXMub2Zmc2V0WSA9IG9wdGlvbnMub2Zmc2V0WSB8fCBNYXRoLnJhbmRpbnQoLTE2LCAxNik7XG4gICAgICAgIHRoaXMub3JkZXIgPSBvcHRpb25zLm9yZGVyIHx8IDA7XG5cbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzQXR0YWNrX2JlZm9yZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzRGFtYWdlZCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v5b6F5qmf6ZaL5aeLXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDApIHtcbiAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5wYXJlbnRVbml0LnggKyB0aGlzLm9mZnNldFg7XG4gICAgICAgICAgICB2YXIgeSA9IHRoaXMucGFyZW50VW5pdC55ICsgdGhpcy5vZmZzZXRZO1xuICAgICAgICAgICAgeSArPSBNYXRoLmNvcyh0aGlzLnRpbWUudG9SYWRpYW4oKSAqIDYpICogNTtcbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLm1vdmVUbyh4LCB5LCA1KVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/lvoXmqZ/kuK1cbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMikge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhpcy5wYXJlbnRVbml0LnggKyB0aGlzLm9mZnNldFg7XG4gICAgICAgICAgICB0aGlzLnkgPSB0aGlzLnBhcmVudFVuaXQueSArIHRoaXMub2Zmc2V0WTtcbiAgICAgICAgICAgIHRoaXMueSArPSBNYXRoLmNvcyh0aGlzLnRpbWUudG9SYWRpYW4oKSAqIDYpICogNTtcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gLT0gMztcblxuICAgICAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMztcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaUu+aSg+mWi+Wni1xuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAzKSB7XG4gICAgICAgICAgICB0aGlzLnBoYXNlKys7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5nZXRQbGF5ZXJBbmdsZSgpICsgMTM1O1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAubW92ZVRvKHBsLngsIHBsLnksIDIwLCBcImVhc2VJblF1YWRcIilcbiAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v5pS75pKD57WC5LqGXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDUpIHtcbiAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgIHRoaXMuaXNFbmFibGVBdHRhY2tDb2xsaXNpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5wYXJlbnRVbml0LnggKyB0aGlzLm9mZnNldFg7XG4gICAgICAgICAgICB2YXIgeSA9IHRoaXMucGFyZW50VW5pdC55ICsgdGhpcy5vZmZzZXRZO1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAubW92ZVRvKHgsIHksIDE1LCBcImVhc2VJbk91dFF1YWRcIilcbiAgICAgICAgICAgICAgICAud2FpdCg1KVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNFbmFibGVBdHRhY2tDb2xsaXNpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/orabmiJLlvoXmqZ/plovlp4tcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMTApIHtcbiAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgIHZhciBkZWcgPSB0aGlzLnRpbWUudG9SYWRpYW4oKSAqIDYgKyB0aGlzLm9yZGVyICogNjA7XG4gICAgICAgICAgICB2YXIgeCA9IHRoaXMucGFyZW50VW5pdC54ICsgTWF0aC5jb3MoZGVnKSAqIDE2O1xuICAgICAgICAgICAgdmFyIHkgPSB0aGlzLnBhcmVudFVuaXQueSArIE1hdGguc2luKGRlZykgKiAxNjtcbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLm1vdmVUbyh4LCB5LCA1KVxuICAgICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/orabmiJLlvoXmqZ/kuK1cbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gMTIpIHtcbiAgICAgICAgICAgIHZhciBkZWcgPSB0aGlzLnRpbWUudG9SYWRpYW4oKSAqIDYgKyB0aGlzLm9yZGVyICogNjA7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGlzLnBhcmVudFVuaXQueCArIE1hdGguY29zKGRlZykgKiAxNjtcbiAgICAgICAgICAgIHRoaXMueSA9IHRoaXMucGFyZW50VW5pdC55ICsgTWF0aC5zaW4oZGVnKSAqIDE2O1xuICAgICAgICAgICAgdGhpcy5yb3RhdGlvbiAtPSA2O1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAxMztcbiAgICAgICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+i/keaOpeaUu+aSg+mWi+Wni1xuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxMykge1xuICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAud2FpdCgxMClcbiAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3RhdGlvbiA9IHRoaXMuZ2V0UGxheWVyQW5nbGUoKSArIDEzNTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5tb3ZlVG8ocGwueCwgcGwueSwgNilcbiAgICAgICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UrKztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8v6L+R5o6l5pS75pKDXG4gICAgICAgIGlmICh0aGlzLnBoYXNlID09IDE0KSB7XG4gICAgICAgICAgICB2YXIgZGVnID0gdGhpcy50aW1lLnRvUmFkaWFuKCkgKiAyMCArIHRoaXMub3JkZXIgKiA2MDtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoaXMucGFyZW50VW5pdC54ICsgTWF0aC5jb3MoZGVnKSAqIDI0O1xuICAgICAgICAgICAgdGhpcy55ID0gdGhpcy5wYXJlbnRVbml0LnkgKyBNYXRoLnNpbihkZWcpICogMjQ7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uIC09IDY7XG4gICAgICAgIH1cblxuICAgICAgICAvL+aUu+aSg+e1guS6hlxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSAxNikge1xuICAgICAgICAgICAgdGhpcy5waGFzZSsrO1xuICAgICAgICAgICAgdGhpcy5pc0VuYWJsZUF0dGFja0NvbGxpc2lvbiA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIHggPSB0aGlzLnBhcmVudFVuaXQueCArIHRoaXMub2Zmc2V0WDtcbiAgICAgICAgICAgIHZhciB5ID0gdGhpcy5wYXJlbnRVbml0LnkgKyB0aGlzLm9mZnNldFk7XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC5tb3ZlVG8oeCwgeSwgMTApXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMTA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNFbmFibGVBdHRhY2tDb2xsaXNpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/opqrjg6bjg4vjg4Pjg4jlkIzmnJ9cbiAgICAgICAgaWYgKHRoaXMucGFyZW50VW5pdCkge1xuICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSB0aGlzLnBhcmVudFVuaXQuZGlyZWN0aW9uO1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50VW5pdC5ocCA9PSAwKSB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/po5vjgbPpgZPlhbfov47mkoNcbiAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXJMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgcWZ0LlBsYXllckF0dGFjayAmJiBlLmlzQ29sbGlzaW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUudHlwZSAhPSBcImFycm93XCIgJiYgZS50eXBlICE9IFwibWFzYWthcmlcIikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHZhciBkaXMgPSB0aGlzLmdldERpc3RhbmNlKGUpO1xuICAgICAgICAgICAgICAgIGlmIChkaXMgPCA2NCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gMjA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAubW92ZVRvKGUueCwgZS55LCA1KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGhhc2UgPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICB0aGlzLmlzQXR0YWNrX2JlZm9yZSA9IHRoaXMuaXNBdHRhY2s7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjFcIl0gPSBbMF07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBkYW1hZ2U6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICB0aGlzLmlzRGFtYWdlZCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLnBoYXNlIDwgMTApIHRoaXMucGhhc2UgPSA2OyBlbHNlIHRoaXMucGhhc2UgPSAxNztcblxuICAgICAgICAvL+WKueaenOmfs1xuICAgICAgICBhcHAucGxheVNFKFwidGlua2xpbmdcIik7XG4gICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuYnkoe3k6IC02NCwgcm90YXRpb246IDcwMH0sIDE1LCBcImVhc2VPdXRRdWFkXCIpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5waGFzZSA8IDEwKSB0aGlzLnBoYXNlID0gMDsgZWxzZSB0aGlzLnBoYXNlID0gMTA7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0RhbWFnZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS5vZ3JlLmpzXG4gKiAgMjAxNy8wNS8wNlxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgqrjg7zjgqxcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5PZ3JlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogNjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDIwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDkwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMTAwMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDcsXG4gICAgZHJvcEl0ZW06IElURU1fQkFHLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDIsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0pFV0VMLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjAsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDIxNiwgMCwgNzIsIDEyOCk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldFBvc2l0aW9uKDAsIC01KS5zZXRTY2FsZSgxLjMpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDM7XG4gICAgICAgIHRoaXMucG9pbnQgKz0gdGhpcy5sZXZlbCAqIDMwMDtcblxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembolxuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O855m66KaL5b6M5LiA5a6a5pmC6ZaT6L+96Leh44GZ44KLXG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDAgJiYgIXRoaXMuaXNBdHRhY2sgJiYgdGhpcy50dXJuVGltZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB0aGlzLnR1cm5Db3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHVyblRpbWUgPSAxNTtcbiAgICAgICAgICAgIGlmIChsb29rKSB0aGlzLnR1cm5Db3VudCA9IDA7XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOCkuimi+WkseOBo+OBn+eKtuaFi+OBp+S4ieWbnuaMr+OCiui/lOOBo+OBn+WgtOWQiOOBr+i/vei3oee1guS6hlxuICAgICAgICAgICAgaWYgKHRoaXMudHVybkNvdW50ID4gMykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCI/XCJ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/kuIDlrprot53pm6Lku6XkuIrpm6LjgozjgZ/jgonov73ot6Hop6PpmaRcbiAgICAgICAgaWYgKGRpcyA+IDUxMikgdGhpcy5jaGFzZVRpbWUgPSAwO1xuXG4gICAgICAgIGlmICh0aGlzLmlzT25GbG9vciB8fCB0aGlzLmlzSnVtcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gMC41O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTAuNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHRoaXMudnggKj0gNDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDE1MDtcbiAgICAgICAgICAgIHRoaXMudHVybkNvdW50ID0gMDtcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDApIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+OBk+OCjOS7peS4iumAsuOCgeOBquOBhOWgtOWQiOOBr+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgdmFyIGlzUmV0dXJuV2FsbCA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGlzUmV0dXJuQ2xpZmYgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmICh0aGlzLnZ4ID4gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMV0uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzQwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy52eCA8IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkgaXNSZXR1cm5XYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSs0MCwgNSwgNSkgPT0gbnVsbCkgaXNSZXR1cm5DbGlmZiA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNSZXR1cm5XYWxsIHx8IGlzUmV0dXJuQ2xpZmYpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGFzZVRpbWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86L+96Leh5Lit44Gn5q615beu44GM44GC44KL5aC05ZCI44Gv6aOb44Gz6LaK44GI44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA8IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOi/vei3oeS4reOBp+W0luOBjOOBguOCi+WgtOWQiOOBr+edgOWcsOeCueOBjOOBguOCi+OBi+iqv+OBueOBpumjm+OBs+mZjeOCiuOCi1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGp1bXBPayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgOTYpKSBqdW1wT2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgOTYpKSBqdW1wT2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp1bXBPaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v552A5Zyw54K544GM54Sh44GE5aC05ZCI44Gv6Kum44KB44Gm5oqY44KK6L+U44GZXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFzZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnR1cm5XYWl0ID0gMTU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIuLi5cIn0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gKHRoaXMuZGlyZWN0aW9uICsgMTgwKSAlIDM2MDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50dXJuV2FpdCA9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAzMCkgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15Lm9yb2NoaS5qc1xuICogIDIwMTcvMDYvMTNcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v5aSn6JuHXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuT3JvY2hpXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogNTAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDkwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogNzAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAzLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAzMiwgaGVpZ2h0OiAzNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIGNhcExldmVsID0gTWF0aC5taW4odGhpcy5sZXZlbCwgNCk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDF4MlwiLCAyNCAqIDIsIDMyICogMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyhjYXBMZXZlbCAqIDcyICogMiwgMzg0ICogMiwgNzIgKiAyLCAxMjggKiAyKVxuICAgICAgICAgICAgLnNldFNjYWxlKDEgKyBjYXBMZXZlbCAqIDAuMSlcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCBjYXBMZXZlbCAqIC0xIC0gNCk7XG4gICAgICAgIHRoaXMud2lkdGggKz0gY2FwTGV2ZWwgKiAxMDtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiAxMDtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMzAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDE1O1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5pc0RlYWQpIHJldHVybjtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembolxuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+W0luOBo+OBt+OBoeOBp+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCsxMCwgdGhpcy55KzQwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueC0xMCwgdGhpcy55KzQwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonjgrjjg6Pjg7Pjg5fmlLvmkoNcbiAgICAgICAgICAgIGlmIChsb29rICYmICF0aGlzLmlzSnVtcCAmJiBkaXMgPCA0MCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNKdW1wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTY7XG4gICAgICAgICAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMueCA+IHBsLngpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IgfHwgdGhpcy5pc0p1bXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobG9vaykge1xuICAgICAgICAgICAgdGhpcy52eCAqPSA0O1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIiwgbGlmZVNwYW46IDE1LCB5OiAwfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uZXJhY2UnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15LnNsaW1lLmpzXG4gKiAgMjAxNi8xMi8zMVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLy/jgrnjg6njgqTjg6BcbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5TbGltZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDIwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDEyOCxcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiA5MCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDEwMCxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlU3Rpbmc6IDAuOCxcbiAgICBkYW1hZ2VCbG93OiAwLjUsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAzMCxcbiAgICBkcm9wSXRlbTogSVRFTV9DT0lOLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDUsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0JBRyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB2YXIgY2FwTGV2ZWwgPSBNYXRoLm1pbih0aGlzLmxldmVsLCA0KTtcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoY2FwTGV2ZWwgKiA3MiwgMjU2LCA3MiwgMTI4KVxuICAgICAgICAgICAgLnNldFNjYWxlKDEgKyBjYXBMZXZlbCAqIDAuMilcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbigwLCAtMiArIGNhcExldmVsICogLTMpO1xuICAgICAgICB0aGlzLndpZHRoICs9IGNhcExldmVsICogNTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiAxMDtcbiAgICAgICAgaWYgKHRoaXMubGV2ZWwgPiAzKSB0aGlzLmhwICs9IDMwO1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAyMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIGlmICh0aGlzLmxldmVsID4gM+OAgCYmIHRoaXMuc3RvcFRpbWUgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcImFuZ2VyMVwiLCBsaWZlU3BhbjogNjAsIHk6IDAsIGZvcmNlOiB0cnVlfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+W0luOBo+OBt+OBoeOBp+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/lo4HjgavlvZPjgZ/jgaPjgZ/jgonmipjjgorov5TjgZlcbiAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMV0uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OG44Oq44OI44Oq44O85oyH5a6aXG4gICAgICAgICAgICBpZiAodGhpcy50ZXJyaXRvcnkpIHtcbiAgICAgICAgICAgICAgICAvL+awtOW5s+aWueWQkeOBruOBv+ODgeOCp+ODg+OCr1xuICAgICAgICAgICAgICAgIHZhciB0eCA9IHRoaXMueCAtIHRoaXMuZmlyc3RYO1xuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyh0eCkgPiB0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMubGV2ZWwgPCA0KSB7XG4gICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonjgrjjg6Pjg7Pjg5fmlLvmkoNcbiAgICAgICAgICAgICAgICBpZiAobG9vayAmJiAhdGhpcy5pc0p1bXAgJiYgZGlzIDwgNDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ5ID0gLTY7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gIDIgKyBNYXRoLmZsb29yKHRoaXMubGV2ZWwqMC41KSAqIHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhdHRhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN0b3BUaW1lID0gMzA7XG4gICAgICAgIHZhciB2eCA9IDE7XG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHZ4ID0gLTE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZXZlbDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJXaXNwQm9tYlwiLCB7cGF0dGVybjogMn0pO1xuICAgICAgICAgICAgYi52eSA9IC04O1xuICAgICAgICAgICAgYi52eCA9IGkgKiAyICogdng7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmFuZG9tQXR0YWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICB2YXIgdnggPSAxO1xuICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB2eCA9IC0xO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGV2ZWw7IGkrKykge1xuICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiV2lzcEJvbWJcIiwge3BhdHRlcm46IDJ9KTtcbiAgICAgICAgICAgIGIudnkgPSAtODtcbiAgICAgICAgICAgIGIudnggPSBpICogMiAqIHZ4O1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgZW5lbXkuc25ha2UuanNcbiAqICAyMDE3LzAxLzI3XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+ibh1xucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LlNuYWtlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMjAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDkwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMTUwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAzLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxOH0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdmFyIGNhcExldmVsID0gTWF0aC5taW4odGhpcy5sZXZlbCwgNCk7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDFcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKGNhcExldmVsICogNzIsIDM4NCwgNzIsIDEyOClcbiAgICAgICAgICAgIC5zZXRTY2FsZSgxICsgY2FwTGV2ZWwgKiAwLjEpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24oMCwgY2FwTGV2ZWwgKiAtMSlcbiAgICAgICAgdGhpcy53aWR0aCArPSBjYXBMZXZlbCAqIDU7XG5cbiAgICAgICAgdGhpcy5ocCArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogMjtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogMTAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuXG4gICAgICAgIHRoaXMub24oJ2RhbWFnZWQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRpcmVjdGlvbiA9PSAwKSB0aGlzLmRpcmVjdGlvbiA9IDE4MDsgZWxzZSB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5pc0RlYWQpIHJldHVybjtcblxuICAgICAgICAvL+ODl+ODrOOCpOODpOODvOOBqOOBrui3nembolxuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICAvL+W0luOBo+OBt+OBoeOBp+aKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrMjAsIDUsIDUpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54LTUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/lo4HjgavlvZPjgZ/jgaPjgZ/jgonmipjjgorov5TjgZlcbiAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bMV0uaGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbGxpc2lvblszXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6L+R44GP44Gr44GE44Gf44KJ44K444Oj44Oz44OX5pS75pKDXG4gICAgICAgICAgICBpZiAobG9vayAmJiAhdGhpcy5pc0p1bXAgJiYgZGlzIDwgNDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy52eSA9IC02O1xuICAgICAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZ4ID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHRoaXMudnggKj0gNDtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2JhbGxvb24nLCB7cGF0dGVybjogXCIhXCIsIGxpZmVTcGFuOiAxNSwgeTogMH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbmVyYWNlJyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS50aXRhbi5qc1xuICogIDIwMTcvMDUvMDZcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v5beo5Lq6XG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuVGl0YW5cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMDAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDkwLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMzAwMCxcblxuICAgIC8v44Ki44Kk44OG44Og44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgZHJvcFJhdGU6IDcsXG4gICAgZHJvcEl0ZW06IElURU1fQkFHLFxuXG4gICAgLy/jg6zjgqLjg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICByYXJlRHJvcFJhdGU6IDIsXG4gICAgcmFyZURyb3BJdGVtOiBJVEVNX0pFV0VMLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjUsIGhlaWdodDogNDB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDJ4MlwiLCAyNCoyLCAzMioyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKDIxNioyLCAwLCA3MioyLCAxMjgqMik7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldFBvc2l0aW9uKDAsIC01KTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiAxMDtcbiAgICAgICAgdGhpcy5wb3dlciArPSB0aGlzLmxldmVsICogNTtcbiAgICAgICAgdGhpcy5wb2ludCArPSB0aGlzLmxldmVsICogNTAwO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5vbignZGFtYWdlZCcsIGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZGlyZWN0aW9uID09IDApIHRoaXMuZGlyZWN0aW9uID0gMTgwOyBlbHNlIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu6Led6ZuiXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozkuIDlrprmmYLplpPov73ot6HjgZnjgotcbiAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID4gMCAmJiAhdGhpcy5pc0F0dGFjayAmJiB0aGlzLnR1cm5UaW1lID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnggPiBwbC54KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAxODA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAxODApIHRoaXMudHVybkNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy50dXJuVGltZSA9IDE1O1xuICAgICAgICAgICAgaWYgKGxvb2spIHRoaXMudHVybkNvdW50ID0gMDtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O844KS6KaL5aSx44Gj44Gf54q25oWL44Gn5LiJ5Zue5oyv44KK6L+U44Gj44Gf5aC05ZCI44Gv6L+96Leh57WC5LqGXG4gICAgICAgICAgICBpZiAodGhpcy50dXJuQ291bnQgPiAzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL+S4gOWumui3nembouS7peS4iumbouOCjOOBn+OCiei/vei3oeino+mZpFxuICAgICAgICBpZiAoZGlzID4gNTEyKSB0aGlzLmNoYXNlVGltZSA9IDA7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yIHx8IHRoaXMuaXNKdW1wKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAwLjU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudnggPSAtMC41O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNKdW1wKSB0aGlzLnZ4ICo9IDEuNTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDEyMDtcbiAgICAgICAgICAgIHRoaXMuc3RvcFRpbWUgPSAwO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIiFcIn0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2hhc2VUaW1lID09IDApIHRoaXMuZmxhcmUoJ2JhbGxvb25lcmFjZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHRoaXMudnggKj0gMztcblxuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v44GT44KM5Lul5LiK6YCy44KB44Gq44GE5aC05ZCI44Gv5oqY44KK6L+U44GZXG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5XYWxsID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaXNSZXR1cm5DbGlmZiA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMudnggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIGlzUmV0dXJuV2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tNYXBDb2xsaXNpb24yKHRoaXMueCs1LCB0aGlzLnkrNDAsIDUsIDUpID09IG51bGwpIGlzUmV0dXJuQ2xpZmYgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZ4IDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jb2xsaXNpb25bM10uaGl0KSBpc1JldHVybldhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzQwLCA1LCA1KSA9PSBudWxsKSBpc1JldHVybkNsaWZmID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1JldHVybldhbGwgfHwgaXNSZXR1cm5DbGlmZikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zov73ot6HkuK3jgafmrrXlt67jgYzjgYLjgovloLTlkIjjga/po5vjgbPotorjgYjjgotcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuV2FsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy54ID4gcGwueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSnVtcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O86L+96Leh5Lit44Gn5bSW44GM44GC44KL5aC05ZCI44Gv552A5Zyw54K544GM44GC44KL44GL6Kq/44G544Gm6aOb44Gz6ZmN44KK44KLXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1JldHVybkNsaWZmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIganVtcE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngrNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA5NikpIGp1bXBPayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoanVtcE9rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0p1bXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudnkgPSAtNTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nnYDlnLDngrnjgYznhKHjgYTloLTlkIjjga/oq6bjgoHjgabmipjjgorov5TjgZlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wVGltZSA9IDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHVybldhaXQgPSAxNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9ICh0aGlzLmRpcmVjdGlvbiArIDE4MCkgJSAzNjA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52eCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIi4uLlwifSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAodGhpcy5kaXJlY3Rpb24gKyAxODApICUgMzYwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR1cm5XYWl0ID0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8v5pS75pKDXG4gICAgICAgICAgICBpZiAobG9vayAmJiAhdGhpcy5pc0p1bXAgJiYgZGlzIDwgNjQgJiYgIXRoaXMuaXNBdHRhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNoYXNlVGltZSA9PSAzMCkgdGhpcy5mbGFyZSgnYmFsbG9vbicsIHtwYXR0ZXJuOiBcIj9cIn0pO1xuICAgIH0sXG5cbiAgICBhdHRhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBhdGsgPSBxZnQuRW5lbXlBdHRhY2sodGhpcy5wYXJlbnRTY2VuZSwge3dpZHRoOiAxLCBoZWlnaHQ6IDI0LCBwb3dlcjogNDAgKyB0aGlzLmxldmVsICogNX0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLmVuZW15TGF5ZXIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy54ICsgdGhpcy5zY2FsZVggKiAxOCwgdGhpcy55KVxuICAgICAgICAgICAgLnNldEFscGhhKDAuMCk7XG4gICAgICAgIGlmIChERUJVR19DT0xMSVNJT04pIGF0ay5zZXRBbHBoYSgwLjMpO1xuICAgICAgICBhdGsubWFzdGVyID0gdGhpcztcbiAgICAgICAgYXRrLnR3ZWVuZXIuc2V0VXBkYXRlVHlwZSgnZnBzJyk7XG4gICAgICAgIGF0ay51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoYXQueCArIHRoYXQuc2NhbGVYICogMTg7XG4gICAgICAgIH1cblxuICAgICAgICBhdGsuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgYXRrLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLndhaXQoNilcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGF0ay5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhhdC52eCA9IDI0ICogdGhhdC5zY2FsZVg7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndhaXQoNilcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoYXQuaXNBdHRhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBhdGsucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pc0F0dGFjayA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSAzMDtcblxuICAgICAgICBxZnQuQmFsbG9vbih7cGF0dGVybjogXCJhbmdlcjJcIn0pLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oMCwgLXRoaXMuaGVpZ2h0LzItMTApO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG4iLCIvKlxuICogIGVuZW15Lndpc3AuanNcbiAqICAyMDE2LzEyLzMxXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCpuOCo+OCueODl1xucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lldpc3BcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMCxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+imluWKm1xuICAgIGV5ZXNpZ2h0OiAxMjgsXG5cbiAgICAvL+imlumHjuinklxuICAgIHZpZXdBbmdsZTogMzYwLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAxMDAsXG5cbiAgICAvL+OCouOCpOODhuODoOODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIGRyb3BSYXRlOiAxMCxcbiAgICBkcm9wSXRlbTogSVRFTV9TVE9ORSxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAwLFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9TVE9ORSxcblxuICAgIC8v5bGe5oCn44OA44Oh44O844K45YCN546HXG4gICAgZGFtYWdlRmlyZTogMC44LFxuICAgIGRhbWFnZUljZTogMixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJGV4dGVuZCh7d2lkdGg6IDE2LCBoZWlnaHQ6IDE2fSk7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAxXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyhNYXRoLm1pbih0aGlzLmxldmVsLCA0KSAqIDcyLCA1MTIsIDcyLCAxMjgpO1xuXG4gICAgICAgIHRoaXMuaHAgKz0gdGhpcy5sZXZlbCAqIDU7XG4gICAgICAgIHRoaXMucG93ZXIgKz0gdGhpcy5sZXZlbCAqIDI7XG4gICAgICAgIHRoaXMuZXllc2lnaHQgKz0gdGhpcy5sZXZlbCAqIDY0LFxuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAyMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJzdGFuZFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuICAgICAgICB0aGlzLnNldHVwTGlmZUdhdWdlKCk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB0aGlzLm1vdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hdHRhY2tDb3VudCA9IDA7XG4gICAgfSxcblxuICAgIGFsZ29yaXRobTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgZGlzID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzov5HjgY/jgavjgYTjgZ/jgonlr4TjgaPjgabjgYTjgY9cbiAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgIHZhciBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgICB2YXIgcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIocGwueCwgcGwueSk7XG4gICAgICAgICAgICB2YXIgcCA9IHAyLnN1YihwMSk7XG4gICAgICAgICAgICBwLm5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgdGhpcy52eCA9IHAueCAqICgxICsgdGhpcy5sZXZlbCAqIDAuMik7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gcC55ICogKDEgKyB0aGlzLmxldmVsICogMC4yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICAvL+aUu+aSg1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA+IDMgJiYgZGlzIDwgMTI4KSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFja0NvdW50LS07XG4gICAgICAgICAgICBpZiAodGhpcy5hdHRhY2tDb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxldmVsOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnBhcmVudFNjZW5lLnNwYXduRW5lbXkodGhpcy54LCB0aGlzLnksIFwiV2lzcEJvbWJcIiwge3BhdHRlcm46IDF9KTtcbiAgICAgICAgICAgICAgICAgICAgYi52eSA9IC0xMDtcbiAgICAgICAgICAgICAgICAgICAgYi52eCA9IChpKjIpICogdGhpcy5zY2FsZVg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrQ291bnQgPSAxODAgLSB0aGlzLmxldmVsICogMTU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFja0NvdW50ID0gNjA7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImp1bXBcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInVwXCJdID0gICBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkb3duXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuXG4vL+OCpuOCo+OCueODl++8iOW8t++8iVxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15Lldpc3BIYXJkXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5FbmVteVwiLFxuXG4gICAgLy/jg5Ljg4Pjg4jjg53jgqTjg7Pjg4hcbiAgICBocDogMjAsXG5cbiAgICAvL+mHjeWKm+WKoOmAn+W6plxuICAgIGdyYXZpdHk6IDAsXG5cbiAgICAvL+mYsuW+oeWKm1xuICAgIGRlZmZlbmNlOiAxMCxcblxuICAgIC8v5pS75pKD5YqbXG4gICAgcG93ZXI6IDEwLFxuXG4gICAgLy/oppbliptcbiAgICBleWVzaWdodDogMTI4LFxuXG4gICAgLy/oppbph47op5JcbiAgICB2aWV3QW5nbGU6IDM2MCxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/lvpfngrlcbiAgICBwb2ludDogMzAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMTAsXG4gICAgZHJvcEl0ZW06IElURU1fU1RPTkUsXG5cbiAgICAvL+ODrOOCouODieODreODg+ODl+eOh++8iO+8he+8iVxuICAgIHJhcmVEcm9wUmF0ZTogNSxcbiAgICByYXJlRHJvcEl0ZW06IElURU1fSkVXRUwsXG5cbiAgICAvL+WxnuaAp+ODgOODoeODvOOCuOWAjeeOh1xuICAgIGRhbWFnZUZpcmU6IDAuNSxcbiAgICBkYW1hZ2VJY2U6IDIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwMVwiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMjg4LCA1MTIsIDcyLCAxMjgpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwic3RhbmRcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAxMDtcbiAgICAgICAgdGhpcy5zZXR1cExpZmVHYXVnZSgpO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5tb3ZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYXR0YWNrQ291bnQgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgdmFyIGRpcyA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGxvb2sgPSB0aGlzLmlzTG9va1BsYXllcigpO1xuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844GM6L+R44GP44Gr44GE44Gf44KJ5a+E44Gj44Gm44GE44GPXG4gICAgICAgIGlmIChsb29rKSB7XG4gICAgICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgICAgICB2YXIgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xuICAgICAgICAgICAgdmFyIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHBsYXllci54LCBwbGF5ZXIueSk7XG4gICAgICAgICAgICB2YXIgcCA9IHAyLnN1YihwMSk7XG4gICAgICAgICAgICBwLm5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgdGhpcy52eCA9IHAueCAvIDI7XG4gICAgICAgICAgICB0aGlzLnZ5ID0gcC55IC8gMjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudnggPSAwO1xuICAgICAgICAgICAgdGhpcy52eSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICAvL+aUu+aSg1xuICAgICAgICBpZiAoZGlzIDwgMTYwKSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFja0NvdW50LS07XG4gICAgICAgICAgICBpZiAodGhpcy5hdHRhY2tDb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxldmVsKzQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMucGFyZW50U2NlbmUuc3Bhd25FbmVteSh0aGlzLngsIHRoaXMueSwgXCJXaXNwQm9tYlwiLCB7cGF0dGVybjogMX0pO1xuICAgICAgICAgICAgICAgICAgICBiLnZ5ID0gLTEwO1xuICAgICAgICAgICAgICAgICAgICBiLnZ4ID0gKGkqMikgKiB0aGlzLnNjYWxlWDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2tDb3VudCA9IDE4MCAtIHRoaXMubGV2ZWwgKiAxNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNrQ291bnQgPSA2MDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0YW5kXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ3YWxrXCJdID0gWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1widXBcIl0gPSAgIFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJhdHRhY2tcIl0gPSBbMywgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG5cbnBoaW5hLmRlZmluZShcInFmdC5FbmVteS5XaXNwQm9tYlwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDEsXG5cbiAgICAvL+aoquenu+WLlea4m+ihsOeOh1xuICAgIGZyaWN0aW9uOiAwLjk5LFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v5b6X54K5XG4gICAgcG9pbnQ6IDAsXG5cbiAgICAvL+eEoeaVteODleODqeOCsFxuICAgIGlzTXV0ZWtpOiB0cnVlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIHt3aWR0aDogMTAsIGhlaWdodDogMTB9KTtcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgIHRoaXMuJGV4dGVuZChvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwicGFydGljbGVcIiwgMTYsIDE2KS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoMzEpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcblxuICAgICAgICB0aGlzLnBhdHRlcm4gPSBvcHRpb25zLnBhdHRlcm4gfHwgMTtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJwYXR0ZXJuXCIrdGhpcy5wYXR0ZXJuKTtcblxuICAgICAgICB0aGlzLm9uKCdkZWFkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9uU2NyZWVuKSBhcHAucGxheVNFKFwiYm9tYlwiKTtcbiAgICAgICAgICAgIHZhciBiID0gdGhpcy5wYXJlbnRTY2VuZS5zcGF3bkVuZW15KHRoaXMueCwgdGhpcy55LCBcIkZsYW1lXCIsIHtwYXR0ZXJuOiAxfSk7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjFcIl0gPSBbMzEsIDMwLCAyOSwgMjgsIDI3LCAyNiwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wicGF0dGVybjJcIl0gPSBbMzEsIDMwLCAyOSwgMjgsIDI3LCAyNiwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxuXG4gICAgZHJvcERlYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGVhZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcm9wID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBlbmVteS53aXphcmQuanNcbiAqICAyMDE3LzA4LzA5XG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG4vL+OCpuOCo+OCtuODvOODiVxucGhpbmEuZGVmaW5lKFwicWZ0LkVuZW15LldpemFyZFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuRW5lbXlcIixcblxuICAgIC8v44OS44OD44OI44Od44Kk44Oz44OIXG4gICAgaHA6IDUwLFxuXG4gICAgLy/pmLLlvqHliptcbiAgICBkZWZmZW5jZTogMTAsXG5cbiAgICAvL+aUu+aSg+WKm1xuICAgIHBvd2VyOiAxMCxcblxuICAgIC8v6KaW5YqbXG4gICAgZXllc2lnaHQ6IDI1NixcblxuICAgIC8v6KaW6YeO6KeSXG4gICAgdmlld0FuZ2xlOiAzNjAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAzMDAwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMzAsXG4gICAgZHJvcEl0ZW06IElURU1fQ09JTixcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiA1LFxuICAgIHJhcmVEcm9wSXRlbTogSVRFTV9CQUcsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRleHRlbmQoe3dpZHRoOiAxNiwgaGVpZ2h0OiAxNn0pO1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcIm1vbnN0ZXIwM1wiLCAyNCwgMzIpLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgIC5zZXRGcmFtZVRyaW1taW5nKDAsIDAsIDcyLCAxMjgpXG4gICAgICAgICAgICAuc2V0U2NhbGUoMS4yKTtcblxuICAgICAgICB0aGlzLmhwICs9IHRoaXMubGV2ZWwgKiA1O1xuICAgICAgICB0aGlzLnBvd2VyICs9IHRoaXMubGV2ZWwgKiAyO1xuICAgICAgICB0aGlzLnBvaW50ICs9IHRoaXMubGV2ZWwgKiAzMDA7XG5cbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTA7XG4gICAgICAgIHRoaXMuc2V0dXBMaWZlR2F1Z2UoKTtcblxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSAxO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG5cbiAgICAgICAgLy/ooYzli5Xjg5Xjgqfjg7zjgrpcbiAgICAgICAgdGhpcy5waGFzZSA9IFwid2FpdFwiO1xuXG4gICAgICAgIC8v5o6l6L+R5oim57WM6YGO5pmC6ZaTXG4gICAgICAgIHRoaXMubmVhckNvdW50ID0gMDtcblxuICAgICAgICB0aGlzLm9uKCdkYW1hZ2VkJywgZSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5kaXJlY3Rpb24gPT0gMCkgdGhpcy5kaXJlY3Rpb24gPSAxODA7IGVsc2UgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYWxnb3JpdGhtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBsYXllciA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgbG9vayA9IHRoaXMuaXNMb29rUGxheWVyKCk7XG4gICAgICAgIHZhciBkaXN0YW5jZSA9IHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKTtcblxuICAgICAgICAvL+W+heapn+S4rVxuICAgICAgICBpZiAodGhpcy5waGFzZSA9PSBcIndhaXRcIikge1xuICAgICAgICAgICAgaWYgKGxvb2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWxsb29uJywge3BhdHRlcm46IFwiIVwiLCBsaWZlU3BhbjogMTV9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnBoYXNlID0gXCJhcHByb2FjaFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7znmbropovlvozmjqXov5FcbiAgICAgICAgaWYgKHRoaXMucGhhc2UgPT0gXCJhcHByb2FjaFwiKSB7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlzdGFuY2UgPCAxMjgpIHtcbiAgICAgICAgICAgIHRoaXMubmVhckNvdW50KytcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmVhckNvdW50ID0gMDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODhuODrOODneODvOODiOmWi+Wni1xuICAgIHRlbGVwb3J0SW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmZhZGVPdXQoMzApO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgdmFyIHNwID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDNcIiwgMjQsIDMyKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgNzIsIDEyOCk7XG4gICAgICAgICAgICBzcC50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuYnkoe3g6IC02NCArIGkgKiAxNiwgYWxwaGE6IC0xfSwgMzAsXCJlYXNlT3V0U2luZVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODhuODrOODneODvOODiOe1guS6hlxuICAgIHRlbGVwb3J0T3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcHJpdGUudHdlZW5lci5mYWRlSW4oMzApO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgdmFyIHNwID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJtb25zdGVyMDNcIiwgMjQsIDMyKVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldEZyYW1lVHJpbW1pbmcoMCwgMCwgNzIsIDEyOCk7XG4gICAgICAgICAgICBzcC50d2VlbmVyLnNldFVwZGF0ZVR5cGUoJ2ZwcycpLmNsZWFyKClcbiAgICAgICAgICAgICAgICAuYnkoe3g6IC02NCArIGkgKiAxNiwgYWxwaGE6IC0xfSwgMzAsXCJlYXNlT3V0U2luZVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+WIhui6q1xuICAgIGNsb25lTXlTZWxmOiBmdW5jdGlvbigpIHtcbiAgICB9LFxuXG4gICAgLy/ngavngo7prZTms5VcbiAgICBmbGFtZTogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG5cbiAgICBmaXJzdEZyYW1lOiBmdW5jdGlvbigpIHtcbiAgICB9LFxufSk7XG5cbi8v44Km44Kj44K244O844OJ5YiG6LqrXG5waGluYS5kZWZpbmUoXCJxZnQuRW5lbXkuV2l6YXJkQ2xvbmVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkVuZW15XCIsXG5cbiAgICAvL+ODkuODg+ODiOODneOCpOODs+ODiFxuICAgIGhwOiAxMCxcblxuICAgIC8v6Ziy5b6h5YqbXG4gICAgZGVmZmVuY2U6IDEwLFxuXG4gICAgLy/mlLvmkoPliptcbiAgICBwb3dlcjogMTAsXG5cbiAgICAvL+W+l+eCuVxuICAgIHBvaW50OiAwLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLFxuXG4gICAgLy/jgqLjgqTjg4bjg6Djg4njg63jg4Pjg5fnjofvvIjvvIXvvIlcbiAgICBkcm9wUmF0ZTogMCxcblxuICAgIC8v44Os44Ki44OJ44Ot44OD44OX546H77yI77yF77yJXG4gICAgcmFyZURyb3BSYXRlOiAwLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMTYsIGhlaWdodDogMTZ9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHZhciBsdiA9IE1hdGgubWluKHRoaXMubGV2ZWwsIDMpO1xuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwibW9uc3RlcjAzXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygobHYgJSAyKSAqIDE0NCArIDcyLCBNYXRoLmZsb29yKGx2IC8gMikgKiAxMjgsIDcyLCAxMjgpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRTY2FsZSgxLjIpO1xuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDEwO1xuXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgdGhpcy5zcGVlZCA9IDE7XG4gICAgICAgIHRoaXMucGhhc2UgPSAwO1xuICAgICAgICB0aGlzLmlzQXR0YWNrID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNUZWxlcG9ydCA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICBhbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHZhciBsb29rID0gdGhpcy5pc0xvb2tQbGF5ZXIoKTtcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gdGhpcy5nZXREaXN0YW5jZVBsYXllcigpO1xuXG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wic3RhbmRcIl0gPSBbMCwgMSwgMiwgMV07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJqdW1wXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIndhbGtcIl0gPSBbMywgNCwgNSwgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWzMsIDQsIDUsIDRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZG93blwiXSA9IFszLCA0LCA1LCA0XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImF0dGFja1wiXSA9IFszLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgbWFwb2JqZWN0LmFjY2Vzc29yeS5qc1xuICogIDIwMTcvMDEvMTRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnFmdC5NYXBPYmplY3QgPSBxZnQuTWFwT2JqZWN0IHx8IHt9O1xuXG4vL+ODnuODg+ODl+ijhemjvuOCouOCr+OCu+OCteODqlxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5BY2Nlc3NvcnlcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+itmOWIpeODleODqeOCsFxuICAgIGlzTWFwQWNjZXNzb3J5OiB0cnVlLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiAyLFxuXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiB0cnVlLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUoe1xuICAgICAgICAgICAgd2lkdGg6IDMyLFxuICAgICAgICAgICAgaGVpZ2h0OiAzMixcbiAgICAgICAgICAgIGluZGV4OiAwLFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwge3dpZHRoOiB0aGlzLm9wdGlvbnMud2lkdGgsIGhlaWdodDogdGhpcy5vcHRpb25zLmhlaWdodH0pO1xuXG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkO1xuICAgICAgICB0aGlzLmxldmVsID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmxldmVsIHx8IDA7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWzIsIDEsIDAsIDNdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsMlwiXSA9IFsxLCAwLCAzLCAyXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuXG4vL+ODqeODs+ODl1xucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5MYW1wXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5NYXBPYmplY3QuQWNjZXNzb3J5XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImZsYW1lMDJcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpLnNldEZyYW1lSW5kZXgoMCk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcodGhpcy5sZXZlbCAqIDI0LCAwLCAyNCwgMTI4KTtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICBpZiAodGhpcy5pZCAlIDIpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWwyXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSA4O1xuICAgIH0sXG59KTtcblxuLy/jgZ/jgY3ngatcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuQm9uZmlyZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJmbGFtZTAyXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRGcmFtZUluZGV4KDApO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKHRoaXMubGV2ZWwgKiAyNCwgMTI4LCAyNCwgMTI4KTtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgfSxcbn0pO1xuXG4vL+eCjlxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5GbGFtZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJmbGFtZTAyXCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyh0aGlzLmxldmVsICogMjQgKyA3MiwgMCwgMjQsIDEyOCk7XG5cbiAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PoqK3lrppcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgIH0sXG59KTtcblxuLy/ngatcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuRmlyZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJmbGFtZTA1XCIsIDI0LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZyh0aGlzLmxldmVsICogMjQgKyA3MiwgMCwgMjQsIDEyOCk7XG5cbiAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PoqK3lrppcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgIH0sXG59KTtcblxuLy/nh63lj7BcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuQ2FuZGxlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5NYXBPYmplY3QuQWNjZXNzb3J5XCIsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwgb3B0aW9ucyk7XG5cbiAgICAgICAgLy/ooajnpLrnlKjjgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImZsYW1lMDVcIiwgMjQsIDMyKS5hZGRDaGlsZFRvKHRoaXMpO1xuICAgICAgICB0aGlzLnNwcml0ZS5zZXRGcmFtZVRyaW1taW5nKHRoaXMubGV2ZWwgKiAyNCArIDcyLCAxMjgsIDI0LCAxMjgpO1xuXG4gICAgICAgIC8v44Ki44OL44Oh44O844K344On44Oz6Kit5a6aXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwibm9ybWFsXCIpO1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMztcbiAgICB9LFxufSk7XG5cbi8v44Op44Oz44K/44OzXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkxhbnRoYW51bVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuTWFwT2JqZWN0LkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8v6KGo56S655So44K544OX44Op44Kk44OIXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJhY2Nlc3NvcnkxXCIsIDE2LCAzMikuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgdGhpcy5zcHJpdGUuc2V0RnJhbWVUcmltbWluZygwLCA5NiwgNzIsIDMyKTtcblxuICAgICAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ioreWumlxuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm5vcm1hbFwiKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbnRlcnZhbCA9IDM7XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zcGNpYWxBbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IFtdO1xuICAgICAgICB0aGlzLmZyYW1lW1wibm9ybWFsXCJdID0gWzAsIDEsIDIsIDFdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICB9LFxufSk7XG5cbi8v44Op44Oz44OX77ySXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkNhbmRsZUxhbXBcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0Lk1hcE9iamVjdC5BY2Nlc3NvcnlcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCBvcHRpb25zKTtcblxuICAgICAgICAvL+ihqOekuueUqOOCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiYWNjZXNzb3J5MVwiLCAxNiwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNldEZyYW1lVHJpbW1pbmcoMCwgMzIsIDcyLCAzMik7XG5cbiAgICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PoqK3lrppcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJub3JtYWxcIik7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSAzO1xuICAgIH0sXG5cbiAgICBzZXR1cEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm5vcm1hbFwiXSA9IFswLCAxLCAyLCAxXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QuYmxvY2suanNcbiAqICAyMDE3LzAzLzEzXG4gKiAgQGF1dGhlciBtaW5pbW8gIFxuICogIFRoaXMgUHJvZ3JhbSBpcyBNSVQgbGljZW5zZS5cbiAqL1xuXG5xZnQuTWFwT2JqZWN0ID0gcWZ0Lk1hcE9iamVjdCB8fCB7fTtcblxuLy/jg5bjg63jg4Pjgq/jgq/jg6njgrlcbnBoaW5hLmRlZmluZShcInFmdC5NYXBPYmplY3QuQmxvY2tcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicWZ0LkNoYXJhY3RlclwiLFxuXG4gICAgaWQ6IG51bGwsXG5cbiAgICAvL+iAkOS5heWKm1xuICAgIGhwOiAzMCxcblxuICAgIC8v6K2Y5Yil44OV44Op44KwXG4gICAgaXNCbG9jazogdHJ1ZSxcblxuICAgIC8v6YeN5Yqb5Yqg6YCf5bqmXG4gICAgZ3Jhdml0eTogMC4wLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PplpPpmpRcbiAgICBhbmltYXRpb25JbnRlcnZhbDogMSxcblxuICAgIGlzQWR2YW5jZUFuaW1hdGlvbjogZmFsc2UsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgICAgICB3aWR0aDogMzIsXG4gICAgICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IHRoaXMub3B0aW9ucy53aWR0aCwgaGVpZ2h0OiB0aGlzLm9wdGlvbnMuaGVpZ2h0fSk7XG5cbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5pbmRleCA9IG9wdGlvbnMuaW5kZXg7XG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJibG9ja1wiLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCh0aGlzLmluZGV4KTtcblxuICAgICAgICB2YXIgcGFyYW0gPSB7XG4gICAgICAgICAgICB3aWR0aDogMzIsXG4gICAgICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICAgICAgZmlsbDogXCJyZ2JhKDAsIDAsIDAsIDAuMClcIixcbiAgICAgICAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMud2FrdSA9IHBoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUocGFyYW0pLnNldFBvc2l0aW9uKDAsIDApO1xuICAgICAgICBpZiAob3B0aW9ucy5lbmFibGVGcmFtZSkgdGhpcy53YWt1LmFkZENoaWxkVG8odGhpcyk7XG5cbiAgICAgICAgLy/jgrnjgq/jg6rjg5fjg4hcbiAgICAgICAgaWYgKG9wdGlvbnMucHJvcGVydGllcy5zY3JpcHQpIHtcbiAgICAgICAgICAgIHZhciBzYyA9IFwiKGZ1bmN0aW9uKGFwcCkge1wiK29wdGlvbnMucHJvcGVydGllcy5zY3JpcHQrXCJ9KVwiO1xuICAgICAgICAgICAgdmFyIGYgPSBldmFsKHNjKTtcbiAgICAgICAgICAgIHRoaXMub24oJ2VudGVyZnJhbWUnLCBmKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub24oJ2RlYWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuc3ByaXRlLnJlbW92ZSgpO1xuICAgICAgICAgICAgdGhpcy53YWt1LnJlbW92ZSgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29sbGlzaW9uKSB0aGlzLmNvbGxpc2lvbi5yZW1vdmUoKTtcbiAgICAgICAgICAgIHZhciBzID0gW107XG4gICAgICAgICAgICBzWzBdID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJibG9ja1wiLCAxNiwgMTYpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oLTgsIC04KS5zZXRGcmFtZUluZGV4KHRoaXMuaW5kZXggKiAyICsgMCk7XG4gICAgICAgICAgICBzWzFdID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJibG9ja1wiLCAxNiwgMTYpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oIDgsIC04KS5zZXRGcmFtZUluZGV4KHRoaXMuaW5kZXggKiAyICsgMSk7XG4gICAgICAgICAgICBzWzJdID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJibG9ja1wiLCAxNiwgMTYpLmFkZENoaWxkVG8odGhpcykuc2V0UG9zaXRpb24oLTgsICA4KS5zZXRGcmFtZUluZGV4KHRoaXMuaW5kZXggKiAyICsgMTYgKyAwKTtcbiAgICAgICAgICAgIHNbM10gPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcImJsb2NrXCIsIDE2LCAxNikuYWRkQ2hpbGRUbyh0aGlzKS5zZXRQb3NpdGlvbiggOCwgIDgpLnNldEZyYW1lSW5kZXgodGhpcy5pbmRleCAqIDIgKyAxNiArIDEpO1xuICAgICAgICAgICAgLy/jgrnjg5fjg6njgqTjg4jjgYzjg5Djg6njg5Djg6njgavlo4rjgozjgovjgohcbiAgICAgICAgICAgICg0KS50aW1lcyhmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICAgICAgc1tpXS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMudng7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueSArPSB0aGlzLnZ5O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZ4ICo9IDAuOTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52eSArPSAwLjk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm90YXRpb24gKz0gdGhpcy5yb3Q7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWxwaGEgLT0gMC4wNTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc1tpXS52eCA9IDA7XG4gICAgICAgICAgICAgICAgc1tpXS52eSA9IC01O1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIHNbMF0udnggPSAtNjsgc1swXS5yb3QgPSAtMztcbiAgICAgICAgICAgIHNbMV0udnggPSAgNjsgc1sxXS5yb3QgPSAgMztcbiAgICAgICAgICAgIHNbMl0udnggPSAtMzsgc1syXS5yb3QgPSAtMztcbiAgICAgICAgICAgIHNbM10udnggPSAgMzsgc1szXS5yb3QgPSAgMztcbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgLndhaXQoMTApXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAodGhpcy5jb2xsaXNpb24pIHtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnggPSB0aGlzLng7XG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvbi55ID0gdGhpcy55O1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5pc0RlYWQpIHtcbiAgICAgICAgICAgIC8v44OX44Os44Kk44Ok44O85pS75pKD77yI5Zu65a6a77yJ44Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgICAgICB2YXIgcGwgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgICAgIGlmIChwbC5pc0F0dGFjayAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KHBsLmF0dGFja0NvbGxpc2lvbikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhbWFnZShwbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+ODl+ODrOOCpOODpOODvOaUu+aSg+WIpOWumuOBqOOBruW9k+OBn+OCiuWIpOWumlxuICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXJMYXllci5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5QbGF5ZXJBdHRhY2sgJiYgZS5pc0NvbGxpc2lvbiAmJiB0aGlzLmhpdFRlc3RFbGVtZW50KGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGFtYWdlKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTsgICAgLy/ngrnmu4Xjgq3jg6Pjg7Pjgrvjg6tcbiAgICB9LFxuXG4gICAgZGFtYWdlOiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNEZWFkKSByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLm11dGVraVRpbWUgPiAwKSByZXR1cm47XG4gICAgICAgIHRoaXMuaHAgLT0gdGFyZ2V0LnBvd2VyO1xuICAgICAgICB0aGlzLm11dGVraVRpbWUgPSAxMDtcbiAgICAgICAgaWYgKHRoaXMuaHAgPD0gMCkge1xuICAgICAgICAgICAgdGhpcy5pc0RlYWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5mbGFyZSgnZGVhZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkaXIgPSAyO1xuICAgICAgICBpZiAodGhpcy54IDwgdGFyZ2V0LngpIGRpciA9IC0yO1xuICAgICAgICB0aGlzLnNwcml0ZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC5tb3ZlQnkoZGlyLCAwLCAxKVxuICAgICAgICAgICAgLm1vdmVCeSgtZGlyLCAwLCAxKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBhcHAucGxheVNFKFwiaGl0X2JsdW50XCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v5b2T44Gf44KK5Yik5a6a44Gu6L+95YqgXG4gICAgYWRkQ29sbGlzaW9uOiBmdW5jdGlvbiAobGF5ZXIpIHtcbiAgICAgICAgdGhpcy5jb2xsaXNpb24gPSBwaGluYS5kaXNwbGF5LlJlY3RhbmdsZVNoYXBlKHt3aWR0aDogMzIsIGhlaWdodDogMzJ9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8obGF5ZXIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0VmlzaWJsZShERUJVR19DT0xMSVNJT04pO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi5hbHBoYSA9IDAuMztcbiAgICAgICAgdGhpcy5jb2xsaXNpb24udnggPSAwO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi52eSA9IDA7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLmlnbm9yZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi50eXBlID0gXCJibG9ja1wiO1xuICAgIH1cbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QuZG9vci5qc1xuICogIDIwMTcvMDEvMTRcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnFmdC5NYXBPYmplY3QgPSBxZnQuTWFwT2JqZWN0IHx8IHt9O1xuXG4vL+Wkp+Wei+ODieOCouOCr+ODqeOCuVxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5Eb29yXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIGlkOiBudWxsLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjAsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+mWk+malFxuICAgIGFuaW1hdGlvbkludGVydmFsOiAzLFxuXG4gICAgLy/lnLDlvaLnhKHoppZcbiAgICBpZ25vcmVDb2xsaXNpb246IHRydWUsXG5cbiAgICAvL+Wun+ihjOa4iOOBv+ODleODqeOCsFxuICAgIGFscmVhZHk6IGZhbHNlLFxuXG4gICAgLy/jg63jg4Pjgq/jgZXjgozjgabjgYTjgovjgYtcbiAgICBpc0xvY2s6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHdpZHRoID0gb3B0aW9ucy53aWR0aCB8fCAzNjtcbiAgICAgICAgdmFyIGhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IDY0O1xuICAgICAgICB0aGlzLnN1cGVySW5pdChwYXJlbnRTY2VuZSwge3dpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHR9KTtcblxuICAgICAgICAvL+OCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZG9vclwiLCAzNiwgNjQpLmFkZENoaWxkVG8odGhpcykuc2V0RnJhbWVJbmRleCgzKTtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJjbG9zZWRcIik7XG5cbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7XG4gICAgICAgIHRoaXMuaXNMb2NrID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmxvY2sgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMubmFtZSA9IG9wdGlvbnMubmFtZTtcbiAgICAgICAgdGhpcy5lbnRlck9mZnNldCA9IG9wdGlvbnMucHJvcGVydGllcy5lbnRlck9mZnNldCB8fCAwO1xuICAgICAgICB0aGlzLnNwcml0ZS52aXNpYmxlID0gb3B0aW9ucy5wcm9wZXJ0aWVzLnZpc2libGUgPT0gdW5kZWZpbmVkPyB0cnVlOiBvcHRpb25zLnByb3BlcnRpZXMudmlzaWJsZTtcblxuICAgICAgICAvL+ODieOCouapn+iDvVxuICAgICAgICB2YXIgcHJvcGVydGllcyA9IG9wdGlvbnMucHJvcGVydGllcztcbiAgICAgICAgc3dpdGNoIChvcHRpb25zLm5hbWUpIHtcbiAgICAgICAgICAgIC8v44Kv44Oq44KiXG4gICAgICAgICAgICBjYXNlIFwiY2xlYXJcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmlzTG9jayA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5vbignZW50ZXJkb29yJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoJ3N0YWdlY2xlYXInKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIC8v44Oe44OD44OX5YaF56e75YuVXG4gICAgICAgICAgICBjYXNlIFwid2FycFwiOlxuICAgICAgICAgICAgICAgIHRoaXMubmV4dElEID0gcHJvcGVydGllcy5uZXh0SUQ7XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSBwcm9wZXJ0aWVzLm9mZnNldCB8fCAwO1xuICAgICAgICAgICAgICAgIHRoaXMub24oJ2VudGVyZG9vcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAvL+ihjOOBjeWFiOOBruaknOe0olxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMuZmluZERvb3IodGhpcy5uZXh0SUQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5leHQpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbnRlclBsYXllcigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLndhcnAobmV4dC54LCBuZXh0LnkrbmV4dC5vZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoMTIwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFscmVhZHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0LmxlYXZlUGxheWVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgLy/jg57jg4Pjg5fliIfjgormm7/jgYhcbiAgICAgICAgICAgIGNhc2UgXCJtYXBzd2l0Y2hcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5leHRJRCA9IHByb3BlcnRpZXMubmV4dElEO1xuICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gcHJvcGVydGllcy5vZmZzZXQgfHwgMDtcbiAgICAgICAgICAgICAgICB0aGlzLnRvTGF5ZXJOdW1iZXIgPSBwcm9wZXJ0aWVzLnRvTGF5ZXJOdW1iZXI7XG4gICAgICAgICAgICAgICAgdGhpcy5vbignZW50ZXJkb29yJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXllciA9IHRoaXMucGFyZW50U2NlbmUuc3RhZ2VDb250cm9sbGVyLm1hcExheWVyW3RoaXMudG9MYXllck51bWJlcl07XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gdGhpcy5wYXJlbnRTY2VuZS5zdGFnZUNvbnRyb2xsZXIuZmluZE9iamVjdCh0aGlzLm5leHRJRCwgdGhpcy50b0xheWVyTnVtYmVyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0KSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW50ZXJQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YWl0KDYwKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLnN3aXRjaE1hcChsYXllcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXIuc2V0UG9zaXRpb24obmV4dC54LCBuZXh0LnkgKyBuZXh0Lm9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbHJlYWR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dC5sZWF2ZVBsYXllcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mZy50d2VlbmVyLmNsZWFyKCkud2FpdCgzMCkuZmFkZUluKDMwKS5mYWRlT3V0KDMwKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy/ov5HjgY/jgavmnaXjgZ/jgonoh6rli5XnmoTjgavplovjgZHjgotcbiAgICAgICAgaWYgKHRoaXMuZ2V0RGlzdGFuY2VQbGF5ZXIoKSA8IDY0KSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNMb2NrKSB0aGlzLm9wZW4oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vd0FuaW1hdGlvbiA9PSBcIm9wZW5cIikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v44OX44Os44Kk44Ok44O844Go44Gu5b2T44Gf44KK5Yik5a6aXG4gICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICB2YXIgaGl0ID0gdGhpcy5oaXRUZXN0RWxlbWVudChwbCk7XG4gICAgICAgIGlmIChoaXQgJiYgIXRoaXMuaXNMb2NrICYmICF0aGlzLmFscmVhZHkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm5hbWUgPT0gXCJjbGVhclwiKSB7XG4gICAgICAgICAgICAgICAgLy/jgrnjg4bjg7zjgrjjgq/jg6rjgqLjga7miYnjga/nhKHmnaHku7bjgaflhaXjgotcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdlbnRlcmRvb3InKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFscmVhZHkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldHVwQW5pbWF0aW9uOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuc3BjaWFsQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBbXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcIm9wZW5kXCJdID0gWzMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlZFwiXSA9IFsyLCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJvcGVuXCJdID0gWzIsIDEsIDAsIDMsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImNsb3NlXCJdID0gWzMsIDAsIDEsIDIsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG4gICAgfSxcblxuICAgIG9wZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbihcIm9wZW5cIik7XG4gICAgfSxcblxuICAgIGNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJjbG9zZVwiKTtcbiAgICB9LFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzmiYnjgavlhaXjgotcbiAgICBlbnRlclBsYXllcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBlbnRlck9mZnNldCA9IHRoaXMuZW50ZXJPZmZzZXQ7XG4gICAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnBsYXllcjtcbiAgICAgICAgcGxheWVyLmFscGhhID0gMDtcbiAgICAgICAgcGxheWVyLmlzQ29udHJvbCA9IGZhbHNlO1xuICAgICAgICBwbGF5ZXIuaXNNdXRla2kgPSB0cnVlO1xuICAgICAgICB2YXIgcGwgPSBxZnQuUGxheWVyRHVtbXkoXCJwbGF5ZXIxXCIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24ocGxheWVyLngsIHBsYXllci55KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcInVwXCIpO1xuICAgICAgICBwbC50d2VlbmVyLmNsZWFyKCkuc2V0VXBkYXRlVHlwZSgnZnBzJylcbiAgICAgICAgICAgIC5tb3ZlVG8odGhpcy54LCB0aGlzLnkrdGhpcy5oZWlnaHQvMi0xNitlbnRlck9mZnNldCwgMTUpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZmFkZU91dCgxNSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O844GM5omJ44GL44KJ5Ye644KLXG4gICAgbGVhdmVQbGF5ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHBsYXllci5hbHBoYSA9IDA7XG4gICAgICAgIHBsYXllci5pc0NvbnRyb2wgPSBmYWxzZTtcbiAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMueCwgdGhpcy55KzE2KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgIHBsLmFscGhhID0gMDtcbiAgICAgICAgcGwuc2V0QW5pbWF0aW9uKFwiZG93blwiKTtcbiAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLm1vdmVUbyhwbGF5ZXIueCwgcGxheWVyLnksIDMwKVxuICAgICAgICAgICAgLmZhZGVJbigxMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsYXllci5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgcGxheWVyLmlzQ29udHJvbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcGwucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/ku5bjga7miYnjgpLmpJzntKJcbiAgICBmaW5kRG9vcjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG51bGw7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUub2JqTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5NYXBPYmplY3QuRG9vcikge1xuICAgICAgICAgICAgICAgIGlmIChlLmlkID09IGlkKSByZXN1bHQgPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgbWFwb2JqZWN0LmZsb29yLmpzXG4gKiAgMjAxNy8wMy8yN1xuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKi9cblxucWZ0Lk1hcE9iamVjdCA9IHFmdC5NYXBPYmplY3QgfHwge307XG5cbi8v5Y+v5YuV44OV44Ot44Ki44Kv44Op44K5XG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0LkZsb29yXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIGlkOiBudWxsLFxuXG4gICAgLy/orZjliKXjg5Xjg6njgrBcbiAgICBpc0Zsb29yOiB0cnVlLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjAsXG5cbiAgICAvL+enu+WLleODleODqeOCsFxuICAgIGlzQWN0aXZlOiB0cnVlLFxuXG4gICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzkuIrjgavkuZfjgaPjgabjgovjg5Xjg6njgrBcbiAgICBpc09uUGxheWVyOiBmYWxzZSxcblxuICAgIC8v44Ki44OL44Oh44O844K344On44Oz6YCy6KGM5Y+v6IO944OV44Op44KwXG4gICAgaXNBZHZhbmNlQW5pbWF0aW9uOiBmYWxzZSxcblxuICAgIC8v5Zyw5b2i54Sh6KaWXG4gICAgaWdub3JlQ29sbGlzaW9uOiB0cnVlLFxuXG4gICAgLy/np7vli5Xjg5HjgrlcbiAgICBtb3ZlUGF0aDogbnVsbCxcblxuICAgIC8v56e75YuV44OR44K554++5Zyo5pmC6ZaTKDAtMSlcbiAgICBwYXRoVGltZTogMCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudFNjZW5lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgICAgICB3aWR0aDogMzIsXG4gICAgICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IHRoaXMub3B0aW9ucy53aWR0aCwgaGVpZ2h0OiB0aGlzLm9wdGlvbnMuaGVpZ2h0fSk7XG5cbiAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7XG5cbiAgICAgICAgdGhpcy5tb3ZlVHlwZSA9IG9wdGlvbnMucHJvcGVydGllcy5tb3ZlVHlwZSB8fCBcImxpbmVhclwiO1xuICAgICAgICB0aGlzLm1vdmVBbmdsZSA9IG9wdGlvbnMucHJvcGVydGllcy5tb3ZlQW5nbGUgfHwgMDtcbiAgICAgICAgdGhpcy5tb3ZlTGVuZ3RoID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm1vdmVMZW5ndGggfHwgMDtcbiAgICAgICAgdGhpcy5tb3ZlUmFkaXVzID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm1vdmVSYWRpdXMgfHwgNjQ7XG4gICAgICAgIHRoaXMubW92ZVNwZWVkID0gb3B0aW9ucy5wcm9wZXJ0aWVzLm1vdmVTcGVlZCB8fCA2MDtcbiAgICAgICAgdGhpcy5tb3ZlV2FpdCA9IChvcHRpb25zLnByb3BlcnRpZXMubW92ZVdhaXQgIT09IHVuZGVmaW5lZCk/IG9wdGlvbnMucHJvcGVydGllcy5tb3ZlV2FpdDogNjA7XG5cbiAgICAgICAgLy/lp4vngrnjgajntYLngrlcbiAgICAgICAgdGhpcy5zdGFydFggPSBvcHRpb25zLnggKyAob3B0aW9ucy53aWR0aCB8fCAxNikgLyAyO1xuICAgICAgICB0aGlzLnN0YXJ0WSA9IG9wdGlvbnMueSArIChvcHRpb25zLmhlaWdodCB8fCAxNikgLyAyO1xuICAgICAgICBpZiAodGhpcy5tb3ZlTGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy/np7vli5Xot53pm6LjgYzoqK3lrprjgZXjgozjgabjgYTjgovloLTlkIhcbiAgICAgICAgICAgIHZhciByYWQgPSB0aGlzLm1vdmVBbmdsZS50b1JhZGlhbigpO1xuICAgICAgICAgICAgdGhpcy5lbmRYID0gdGhpcy5zdGFydFggKyBNYXRoLmNvcyhyYWQpICogdGhpcy5tb3ZlTGVuZ3RoO1xuICAgICAgICAgICAgdGhpcy5lbmRZID0gdGhpcy5zdGFydFkgKyBNYXRoLnNpbihyYWQpICogdGhpcy5tb3ZlTGVuZ3RoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy/ntYLngrnluqfmqJnjgYzoqK3lrprjgZXjgozjgabjgYTjgovloLTlkIhcbiAgICAgICAgICAgIHRoaXMuZW5kWCA9IG9wdGlvbnMucHJvcGVydGllcy5lbmRYIHx8IHRoaXMuc3RhcnRYO1xuICAgICAgICAgICAgdGhpcy5lbmRZID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmVuZFkgfHwgdGhpcy5zdGFydFk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WGhumBi+WLleOBruWgtOWQiOOBr+S4reW/g+OCkuioreWumu+8iOeEoeOBhOWgtOWQiOOBr+e1gueCueOCkuS4reW/g+OBqOOBmeOCi++8iVxuICAgICAgICBpZiAodGhpcy5tb3ZlVHlwZSA9PSBcImNpcmNsZVwiKSB7XG4gICAgICAgICAgICB0aGlzLmNlbnRlclggPSBvcHRpb25zLnByb3BlcnRpZXMuY2VudGVyWCB8fCB0aGlzLmVuZFg7XG4gICAgICAgICAgICB0aGlzLmNlbnRlclkgPSBvcHRpb25zLnByb3BlcnRpZXMuY2VudGVyWSB8fCB0aGlzLmVuZFk7XG4gICAgICAgIH1cblxuICAgICAgICAvL+enu+WLleODkeOCv+ODvOODs1xuICAgICAgICBzd2l0Y2ggKHRoaXMubW92ZVR5cGUpIHtcbiAgICAgICAgICAgIC8v55u057ea6YGL5YuVXG4gICAgICAgICAgICBjYXNlIFwibGluZWFyXCI6XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLm1vdmVUbyh0aGlzLmVuZFgsIHRoaXMuZW5kWSwgdGhpcy5tb3ZlU3BlZWQsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHt0aGlzLmZsYXJlKCdtb3ZlZW5kJyk7fS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCh0aGlzLm1vdmVXYWl0KVxuICAgICAgICAgICAgICAgICAgICAubW92ZVRvKHRoaXMuc3RhcnRYLCB0aGlzLnN0YXJ0WSwgdGhpcy5tb3ZlU3BlZWQsIFwiZWFzZUluT3V0U2luZVwiKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHt0aGlzLmZsYXJlKCdtb3Zlc3RhcnQnKTt9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC53YWl0KHRoaXMubW92ZVdhaXQpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRMb29wKHRydWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgLy/lhobpgYvli5VcbiAgICAgICAgICAgIGNhc2UgXCJjaXJjbGVcIjpcbiAgICAgICAgICAgICAgICB0aGlzLmFuZ2xlID0gMDtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5wcm9wZXJ0aWVzLmNvdW50ZXJDbG9ja1dpc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/lj43mmYLoqIjlm57jgopcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50byh7YW5nbGU6IC0zNjB9LCB0aGlzLm1vdmVTcGVlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge3RoaXMuZmxhcmUoJ21vdmVlbmQnKTt9LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0KHthbmdsZTogMH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0TG9vcCh0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL+aZguioiOWbnuOCilxuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRvKHthbmdsZTogMzYwfSwgdGhpcy5tb3ZlU3BlZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHt0aGlzLmZsYXJlKCdtb3ZlZW5kJyk7fS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldCh7YW5nbGU6IDB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldExvb3AodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8v6Kit5a6a44GV44KM44Gf44OR44K544Gr5rK/44Gj44Gm56e75YuVXG4gICAgICAgICAgICBjYXNlIFwicGF0aFwiOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jgrnjg5fjg6njgqTjg4hcbiAgICAgICAgdGhpcy5pbmRleCA9IG9wdGlvbnMucHJvcGVydGllcy5pbmRleCB8fCAwO1xuICAgICAgICB2YXIgc3cgPSBNYXRoLmZsb29yKHRoaXMud2lkdGggLyAxNik7XG4gICAgICAgIHZhciBzaCA9IE1hdGguZmxvb3IodGhpcy5oZWlnaHQgLyAxNikrMzI7XG4gICAgICAgIHZhciB0b3AgPSB0aGlzLmhlaWdodCAvIDI7XG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgc3c7IHgrKykge1xuICAgICAgICAgICAgdmFyIGlkeCA9ICh4ICUgMikgKyAxO1xuICAgICAgICAgICAgaWYgKHggPT0gMCkgaWR4ID0gMDtcbiAgICAgICAgICAgIGlmICh4ID09IHN3LTEpIGlkeCA9IDM7XG4gICAgICAgICAgICB2YXIgcyA9IHBoaW5hLmRpc3BsYXkuU3ByaXRlKFwiZmxvb3JcIiwgMTYsIDk2KVxuICAgICAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgICAgICAgICAgLnNldEZyYW1lVHJpbW1pbmcodGhpcy5pbmRleCAqIDY0LCAzMiwgNjQsIDk2KVxuICAgICAgICAgICAgICAgIC5zZXRGcmFtZUluZGV4KGlkeClcbiAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24oeCAqIDE2IC0gdGhpcy53aWR0aCAvIDIgKyA4LCAxNi10b3ApO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAodGhpcy5tb3ZlVHlwZSA9PSBcImNpcmNsZVwiKSB7XG4gICAgICAgICAgICB2YXIgcmFkID0gdGhpcy5yYWRpdXMudG9SYWRpYW4oKTtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoaXMuY2VudGVyWCArIE1hdGguY29zKHJhZCkgKiB0aGlzLm1vdmVSYWRpdXM7XG4gICAgICAgICAgICB0aGlzLnkgPSB0aGlzLmNlbnRlclkgKyBNYXRoLnNpbihyYWQpICogdGhpcy5tb3ZlUmFkaXVzO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubW92ZVR5cGUgPT0gJ3BhdGgnKSB7XG4gICAgICAgIH1cblxuICAgICAgICAvL+WBnOatouOBqOWGjeeUn1xuICAgICAgICBpZiAoIXRoaXMuaXNBY3RpdmUpIHRoaXMudHdlZW5lci5wYXVzZSgpO1xuICAgICAgICBpZiAodGhpcy5pc0FjdGl2ZSkgdGhpcy50d2VlbmVyLnBsYXkoKTtcblxuICAgICAgICBpZiAodGhpcy5jb2xsaXNpb24pIHtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnZ4ID0gdGhpcy54IC0gdGhpcy5jb2xsaXNpb24ueDtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnZ5ID0gdGhpcy55IC0gdGhpcy5jb2xsaXNpb24ueTtcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uLnggPSB0aGlzLng7XG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvbi55ID0gdGhpcy55O1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zjgYzkuIrjgavkuZfjgaPjgabjgYTjgovjgYvliKTlrppcbiAgICAgICAgdmFyIHBsID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHRoaXMuaXNPblBsYXllciA9IGZhbHNlO1xuICAgICAgICBpZiAocGwuZmxvb3JPYmplY3QgJiYgcGwuZmxvb3JPYmplY3QucGFyZW50T2JqZWN0ID09PSB0aGlzKSB7XG4gICAgICAgICAgICB0aGlzLmlzT25QbGF5ZXIgPSB0cnVlO1xuICAgICAgICAgICAgLy/luorjgYzkuIvpmY3jgZfjgabjgYTjgovmmYLjga7jgb9cbiAgICAgICAgICAgIGlmICghcGwuaXNKdW1wICYmIHRoaXMuY29sbGlzaW9uLnZ5ID4gMCkge1xuICAgICAgICAgICAgICAgIHBsLnkgPSB0aGlzLnkgLSB0aGlzLmhlaWdodCAqIDAuNTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+ODleODreOCouW9k+OBn+OCiuWIpOWumuOBrui/veWKoFxuICAgIGFkZENvbGxpc2lvbjogZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uID0gcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZSh7d2lkdGg6IHRoaXMud2lkdGgsIGhlaWdodDogdGhpcy5oZWlnaHR9KVxuICAgICAgICAgICAgLmFkZENoaWxkVG8obGF5ZXIpXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy54LCB0aGlzLnkpXG4gICAgICAgICAgICAuc2V0VmlzaWJsZShERUJVR19DT0xMSVNJT04pO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi5hbHBoYSA9IDAuMztcbiAgICAgICAgdGhpcy5jb2xsaXNpb24udnggPSAwO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi52eSA9IDA7XG4gICAgICAgIHRoaXMuY29sbGlzaW9uLmlnbm9yZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbGxpc2lvbi50eXBlID0gXCJtb3ZlZmxvb3JcIjtcbiAgICAgICAgdGhpcy5jb2xsaXNpb24ucGFyZW50T2JqZWN0ID0gdGhpcztcbiAgICB9LFxuXG4gICAgLy/np7vli5Xjg5Hjgrnjga7oqK3lrppcbiAgICBzZXRQYXRoOiBmdW5jdGlvbihzdGFydFgsIHN0YXJ0WSwgcGF0aCwgbG9vcCkge1xuICAgICAgICB0aGlzLnggPSBzdGFydFg7XG4gICAgICAgIHRoaXMueSA9IHN0YXJ0WTtcbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcbiAgICAgICAgdGhpcy5sb29wID0gbG9vcDtcblxuICAgICAgICBpZiAobG9vcCkge1xuICAgICAgICAgICAgLy/ot53pm6LoqIjnrpdcbiAgICAgICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwMSA9IHBhdGhbaV07XG4gICAgICAgICAgICAgICAgdmFyIHAyID0gcGF0aFtpKzFdO1xuICAgICAgICAgICAgICAgIHAyLm1hZ25pdHVkZSA9IE1hdGguc3FydCgocDIueCAtIHAxLngpICogKHAyLnggLSBwMS54KSArIChwMi55IC0gcDEueSkgKiAocDIueSAtIHAxLnkpKTtcbiAgICAgICAgICAgICAgICBzdW0gKz0gcDIubWFnbml0dWRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/ntYLngrnjgYvjgonlp4vngrnjgb7jgafjga7ot53pm6LjgpLliqDnrpdcbiAgICAgICAgICAgIHZhciBwMSA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIHZhciBwMiA9IHBhdGhbMF07XG4gICAgICAgICAgICBwMi5tYWduaXR1ZGUgPSBNYXRoLnNxcnQoKHAyLnggLSBwMS54KSAqIChwMi54IC0gcDEueCkgKyAocDIueSAtIHAxLnkpICogKHAyLnkgLSBwMS55KSk7XG4gICAgICAgICAgICBzdW0gKz0gcDIubWFnbml0dWRlO1xuICAgICAgICAgICAgdmFyIHVuaXQgPSB0aGlzLm1vdmVTcGVlZCAvIHN1bTtcblxuICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKCkud2FpdCg2MCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHBhdGgubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcCA9IHBhdGhbaV07XG4gICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBNYXRoLmZsb29yKHAubWFnbml0dWRlICogdW5pdCk7XG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLm1vdmVUbyhzdGFydFggKyBwLngsIHN0YXJ0WSArIHAueSwgdGltZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIubW92ZVRvKHN0YXJ0WCArIHBhdGhbMF0ueCwgc3RhcnRZICsgcGF0aFswXS55LCB0aW1lKTtcbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5zZXRMb29wKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy/lvoDot6/ot53pm6LoqIjnrpdcbiAgICAgICAgICAgIHZhciBzdW0gPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwMSA9IHBhdGhbaV07XG4gICAgICAgICAgICAgICAgdmFyIHAyID0gcGF0aFtpKzFdO1xuICAgICAgICAgICAgICAgIHAyLm1hZ25pdHVkZSA9IE1hdGguc3FydCgocDIueCAtIHAxLngpICogKHAyLnggLSBwMS54KSArIChwMi55IC0gcDEueSkgKiAocDIueSAtIHAxLnkpKTtcbiAgICAgICAgICAgICAgICBzdW0gKz0gcDIubWFnbml0dWRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHVuaXQgPSB0aGlzLm1vdmVTcGVlZCAvIHN1bTtcblxuICAgICAgICAgICAgLy/lvqnot6/ot53pm6LoqIjnrpdcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICB2YXIgcDEgPSBwYXRoW2ldO1xuICAgICAgICAgICAgICAgIHZhciBwMiA9IHBhdGhbaS0xXTtcbiAgICAgICAgICAgICAgICBwMi5tYWduaXR1ZGVfcmV0ID0gTWF0aC5zcXJ0KChwMi54IC0gcDEueCkgKiAocDIueCAtIHAxLngpICsgKHAyLnkgLSBwMS55KSAqIChwMi55IC0gcDEueSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnR3ZWVuZXIuY2xlYXIoKS53YWl0KDYwKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwID0gcGF0aFtpXTtcbiAgICAgICAgICAgICAgICB2YXIgdGltZSA9IE1hdGguZmxvb3IocC5tYWduaXR1ZGUgKiB1bml0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIubW92ZVRvKHN0YXJ0WCArIHAueCwgc3RhcnRZICsgcC55LCB0aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHdlZW5lci53YWl0KDYwKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBwYXRoLmxlbmd0aCAtIDI7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBwYXRoW2ldO1xuICAgICAgICAgICAgICAgIHZhciB0aW1lID0gTWF0aC5mbG9vcihwLm1hZ25pdHVkZV9yZXQgKiB1bml0KTtcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVuZXIubW92ZVRvKHN0YXJ0WCArIHAueCwgc3RhcnRZICsgcC55LCB0aW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudHdlZW5lci5zZXRMb29wKHRydWUpO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIiwiLypcbiAqICBtYXBvYmplY3QuZ2F0ZS5qc1xuICogIDIwMTcvMDMvMjBcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbnFmdC5NYXBPYmplY3QgPSBxZnQuTWFwT2JqZWN0IHx8IHt9O1xuXG4vL+ODr+ODvOODl+OCsuODvOODiFxucGhpbmEuZGVmaW5lKFwicWZ0Lk1hcE9iamVjdC5HYXRlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInFmdC5DaGFyYWN0ZXJcIixcblxuICAgIGlkOiBudWxsLFxuXG4gICAgLy/ph43lipvliqDpgJ/luqZcbiAgICBncmF2aXR5OiAwLjAsXG5cbiAgICAvL+WcsOW9oueEoeimllxuICAgIGlnbm9yZUNvbGxpc2lvbjogdHJ1ZSxcblxuICAgIC8v5a6f6KGM5riI44G/44OV44Op44KwXG4gICAgYWxyZWFkeTogZmFsc2UsXG5cbiAgICAvL+ODreODg+OCr+OBleOCjOOBpuOBhOOCi+OBi1xuICAgIGlzTG9jazogZmFsc2UsXG5cbiAgICAvL+OCouODi+ODoeODvOOCt+ODp+ODs+ODleODqeOCsFxuICAgIGlzQWR2YW5jZUFuaW1hdGlvbjogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRTY2VuZSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgd2lkdGggPSBvcHRpb25zLndpZHRoIHx8IDM2O1xuICAgICAgICB2YXIgaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNjQ7XG4gICAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmVudFNjZW5lLCB7d2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodH0pO1xuICAgICAgICB0aGlzLndpZHRoX2hhbGYgPSB3aWR0aCAvIDI7XG4gICAgICAgIHRoaXMuaGVpZ2h0X2hhbGYgPSBoZWlnaHQgLyAyO1xuXG4gICAgICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkO1xuICAgICAgICB0aGlzLmlzTG9jayA9IG9wdGlvbnMucHJvcGVydGllcy5sb2NrIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLm5hbWUgPSBvcHRpb25zLm5hbWU7XG4gICAgICAgIHRoaXMuZW50ZXJPZmZzZXQgPSBvcHRpb25zLnByb3BlcnRpZXMuZW50ZXJPZmZzZXQgfHwgMDtcblxuICAgICAgICAvL+OCueODl+ODqeOCpOODiFxuICAgICAgICB0aGlzLnNwcml0ZSA9IG51bGw7XG5cbiAgICAgICAgLy/jgrLjg7zjg4jmqZ/og71cbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBvcHRpb25zLnByb3BlcnRpZXM7XG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5uYW1lKSB7XG4gICAgICAgICAgICAvL+ODnuODg+ODl+WGheenu+WLlVxuICAgICAgICAgICAgY2FzZSBcIndhcnBcIjpcbiAgICAgICAgICAgICAgICB0aGlzLm5leHRJRCA9IHByb3BlcnRpZXMubmV4dElEO1xuICAgICAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gcHJvcGVydGllcy5vZmZzZXQgfHwgMDtcbiAgICAgICAgICAgICAgICB0aGlzLm9uKCdlbnRlcmRvb3InLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgLy/ooYzjgY3lhYjjga7mpJzntKJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHQgPSB0aGlzLmZpbmRHYXRlKHRoaXMubmV4dElEKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0KSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW50ZXJQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS53YXJwKG5leHQueCwgbmV4dC55K25leHQub2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YWl0KDEyMClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbHJlYWR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dC5sZWF2ZVBsYXllcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIC8v44Oe44OD44OX5YiH44KK5pu/44GIXG4gICAgICAgICAgICBjYXNlIFwibWFwc3dpdGNoXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0SUQgPSBwcm9wZXJ0aWVzLm5leHRJRDtcbiAgICAgICAgICAgICAgICB0aGlzLm9mZnNldCA9IHByb3BlcnRpZXMub2Zmc2V0IHx8IDA7XG4gICAgICAgICAgICAgICAgdGhpcy50b0xheWVyTnVtYmVyID0gcHJvcGVydGllcy50b0xheWVyTnVtYmVyO1xuICAgICAgICAgICAgICAgIHRoaXMub24oJ2VudGVyZG9vcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGF5ZXIgPSB0aGlzLnBhcmVudFNjZW5lLnN0YWdlQ29udHJvbGxlci5tYXBMYXllclt0aGlzLnRvTGF5ZXJOdW1iZXJdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMucGFyZW50U2NlbmUuc3RhZ2VDb250cm9sbGVyLmZpbmRPYmplY3QodGhpcy5uZXh0SUQsIHRoaXMudG9MYXllck51bWJlcik7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbmV4dCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVudGVyUGxheWVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAud2FpdCg2MClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRTY2VuZS5zd2l0Y2hNYXAobGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUucGxheWVyLnNldFBvc2l0aW9uKG5leHQueCwgbmV4dC55ICsgbmV4dC5vZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWxyZWFkeSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHQubGVhdmVQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmcudHdlZW5lci5jbGVhcigpLndhaXQoMzApLmZhZGVJbigzMCkuZmFkZU91dCgzMCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvL+ODkeODvOODhuOCo+OCr+ODq1xuICAgICAgICBpZiAoIXRoaXMuaXNMb2NrICYmIHRoaXMudGltZSAlIDYgPT0gMCkge1xuICAgICAgICAgICAgKDIpLnRpbWVzKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3AgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInBhcnRpY2xlXCIsIDE2LCAxNilcbiAgICAgICAgICAgICAgICAgICAgLmFkZENoaWxkVG8odGhpcylcbiAgICAgICAgICAgICAgICAgICAgLnNldEZyYW1lSW5kZXgoMClcbiAgICAgICAgICAgICAgICAgICAgLnNldFNjYWxlKDApXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihNYXRoLnJhbmRpbnQoLXRoaXMud2lkdGhfaGFsZiwgdGhpcy53aWR0aF9oYWxmKSwgdGhpcy5oZWlnaHRfaGFsZiArIE1hdGgucmFuZGludCgtNCwgNCkpO1xuICAgICAgICAgICAgICAgIHNwLmFscGhhID0gMC4zO1xuICAgICAgICAgICAgICAgIHNwLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICAuYnkoe3k6IC00OCwgYWxwaGE6ICAwLjksIHNjYWxlWDogIDAuMywgc2NhbGVZOiAgMC4zfSwgMTAwMCwgXCJlYXNlSW5TaW5lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5ieSh7eTogLTQ4LCBhbHBoYTogLTAuOSwgc2NhbGVYOiAtMC4zLCBzY2FsZVk6IC0wLjN9LCAxMDAwLCBcImVhc2VPdXRTaW5lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHNwKSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O844GM44Ky44O844OI44Gr5YWl44KLXG4gICAgZW50ZXJQbGF5ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZW50ZXJPZmZzZXQgPSB0aGlzLmVudGVyT2Zmc2V0O1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHBsYXllci5hbHBoYSA9IDA7XG4gICAgICAgIHBsYXllci5pc0NvbnRyb2wgPSBmYWxzZTtcbiAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5zZXRQb3NpdGlvbihwbGF5ZXIueCwgcGxheWVyLnkpLmFkZENoaWxkVG8odGhpcy5wYXJlbnRTY2VuZS5tYXBMYXllci5wbGF5ZXJMYXllcik7XG4gICAgICAgIHBsLnNldEFuaW1hdGlvbihcIndhbGtcIik7XG4gICAgICAgIHBsLnR3ZWVuZXIuY2xlYXIoKS5zZXRVcGRhdGVUeXBlKCdmcHMnKVxuICAgICAgICAgICAgLm1vdmVUbyh0aGlzLngsIHRoaXMueStlbnRlck9mZnNldCwgMTUpXG4gICAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZmFkZU91dCgxNSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44OX44Os44Kk44Ok44O844GM44Ky44O844OI44GL44KJ5Ye644KLXG4gICAgbGVhdmVQbGF5ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGxheWVyID0gdGhpcy5wYXJlbnRTY2VuZS5wbGF5ZXI7XG4gICAgICAgIHBsYXllci5hbHBoYSA9IDA7XG4gICAgICAgIHBsYXllci5pc0NvbnRyb2wgPSBmYWxzZTtcbiAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gdHJ1ZTtcbiAgICAgICAgdmFyIHBsID0gcWZ0LlBsYXllckR1bW15KFwicGxheWVyMVwiKS5zZXRQb3NpdGlvbih0aGlzLngsIHRoaXMueSkuYWRkQ2hpbGRUbyh0aGlzLnBhcmVudFNjZW5lLm1hcExheWVyLnBsYXllckxheWVyKTtcbiAgICAgICAgcGwuYWxwaGEgPSAwO1xuICAgICAgICBwbC5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICBwbC5hbmltYXRpb24gPSBmYWxzZTtcbiAgICAgICAgcGwudHdlZW5lci5jbGVhcigpLnNldFVwZGF0ZVR5cGUoJ2ZwcycpXG4gICAgICAgICAgICAuZmFkZUluKDE1KVxuICAgICAgICAgICAgLm1vdmVUbyhwbGF5ZXIueCwgcGxheWVyLnksIDMwKVxuICAgICAgICAgICAgLmZhZGVJbigxMClcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBsYXllci5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgcGxheWVyLmlzQ29udHJvbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcGxheWVyLmlzTXV0ZWtpID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcGwucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/ku5bjga7jgrLjg7zjg4jjgpLmpJzntKJcbiAgICBmaW5kR2F0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG51bGw7XG4gICAgICAgIHRoaXMucGFyZW50U2NlbmUub2JqTGF5ZXIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIHFmdC5NYXBPYmplY3QuR2F0ZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLmlkID09IGlkKSByZXN1bHQgPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG59KTtcbiIsIi8qXG4gKiAgbWFwb2JqZWN0Lm5wYy5qc1xuICogIDIwMTcvMDgvMDlcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICovXG5cbi8v5YaS6Zm66ICFXG5waGluYS5kZWZpbmUoXCJxZnQuTWFwT2JqZWN0Lm5wY1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJxZnQuQ2hhcmFjdGVyXCIsXG5cbiAgICAvL+enu+WLlemAn+W6plxuICAgIHNwZWVkOiAyLFxuXG4gICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7PplpPpmpRcbiAgICBhbmltYXRpb25JbnRlcnZhbDogOCxcblxuICAgIC8v5b2x6KGo56S644OV44Op44KwXG4gICAgaXNTaGFkb3c6IHRydWUsXG5cbiAgICAvL+enu+WLleODleODqeOCsFxuICAgIGlzTW92ZTogdHJ1ZSxcblxuICAgIC8v5LiN5YuV44OV44Op44KwXG4gICAgdG9GaXg6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyZW50U2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kZXh0ZW5kKHt3aWR0aDogMjQsIGhlaWdodDogMjB9KTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQocGFyZW50U2NlbmUsIG9wdGlvbnMpO1xuXG4gICAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUoXCJhY3RvclwiICsgKG9wdGlvbnMucHJvcGVydGllcy5hY3RvciB8fCBcIjQwXCIpLCAzMiwgMzIpLmFkZENoaWxkVG8odGhpcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlLnNjYWxlWCA9IC0xO1xuXG4gICAgICAgIHRoaXMuc3BlZWQgPSBvcHRpb25zLnByb3BlcnRpZXMuc3BlZWQgfHwgdGhpcy5zcGVlZDtcbiAgICAgICAgdGhpcy5pc01vdmUgPSAob3B0aW9ucy5wcm9wZXJ0aWVzLmlzTW92ZSA9PT0gdW5kZWZpbmVkPyB0cnVlOiBvcHRpb25zLnByb3BlcnRpZXMuaXNNb3ZlKTtcbiAgICAgICAgdGhpcy50ZXJyaXRvcnkgPSBvcHRpb25zLnByb3BlcnRpZXMudGVycml0b3J5IHx8IG51bGw7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gb3B0aW9ucy5wcm9wZXJ0aWVzLmRpcmVjdGlvbiB8fCAwO1xuICAgICAgICB0aGlzLnRleHQgPSBvcHRpb25zLnByb3BlcnRpZXMudGV4dDtcblxuICAgICAgICBpZiAob3B0aW9ucy5wcm9wZXJ0aWVzLnRvRml4KSB7XG4gICAgICAgICAgICB0aGlzLmlnbm9yZUNvbGxpc2lvbiA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmdyYXZpdHkgPSAwO1xuICAgICAgICAgICAgdGhpcy5pc01vdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudG9GaXggPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5vbmUoJ2VudGVyZnJhbWUnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR1cEZpeGVkU2hhZG93KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcblxuICAgICAgICB0aGlzLndhaXRUaW1lID0gMDtcblxuICAgICAgICB0aGlzLm9uZSgnZW50ZXJmcmFtZScsICgpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc01vdmUpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGVYID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDkwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJkb3duXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTgwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRBbmltYXRpb24oXCJ3YWxrXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI3MDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwidXBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy53YWl0VGltZSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc01vdmUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vdmVBbGdvcml0aG0oKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg5fjg6zjgqTjg6Tjg7zmlLvmkoPjgajjga7lvZPjgZ/jgorliKTlrppcbiAgICAgICAgICAgIHZhciBwbCA9IHRoaXMucGFyZW50U2NlbmUucGxheWVyO1xuICAgICAgICAgICAgaWYgKHBsLmlzQXR0YWNrICYmIHRoaXMuaGl0VGVzdEVsZW1lbnQocGwuYXR0YWNrQ29sbGlzaW9uKSkge1xuICAgICAgICAgICAgICAgIC8v6Kmx44GX44GL44GR44Gf5LqL44Gr44Gq44KLXG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgLndhaXQoNSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoKCk9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2NlbmUgPSBxZnQuQ29udmVyc2F0aW9uU2NlbmUodGhpcy5wYXJlbnRTY2VuZSwgdGhpcy50ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5wdXNoU2NlbmUoc2NlbmUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLndhaXRUaW1lID0gMTU7XG5cbiAgICAgICAgICAgICAgICAvL+WQkeOBjeOBruiqv+aVtFxuICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5pbWF0aW9uKFwid2Fsa1wiKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy54IDwgcGwueCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IDE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZVggPSAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLndhaXRUaW1lLS07XG4gICAgICAgIGlmICh0aGlzLndhaXRUaW1lIDwgMCkgdGhpcy53YWl0VGltZSA9IDA7XG4gICAgfSxcblxuICAgIG1vdmVBbGdvcml0aG06IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5pc09uRmxvb3IpIHtcbiAgICAgICAgICAgIC8v5bSW44Gj44G344Gh44Gn5oqY44KK6L+U44GZXG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01hcENvbGxpc2lvbjIodGhpcy54KzUsIHRoaXMueSsyMCwgNSwgNSkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrTWFwQ29sbGlzaW9uMih0aGlzLngtNSwgdGhpcy55KzIwLCA1LCA1KSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL+WjgeOBq+W9k+OBn+OBo+OBn+OCieaKmOOCiui/lOOBmVxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpc2lvblsxXS5oaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IDE4MDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY29sbGlzaW9uWzNdLmhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy/jg4bjg6rjg4jjg6rjg7zmjIflrppcbiAgICAgICAgICAgIGlmICh0aGlzLnRlcnJpdG9yeSkge1xuICAgICAgICAgICAgICAgIC8v5rC05bmz5pa55ZCR44Gu44G/44OB44Kn44OD44KvXG4gICAgICAgICAgICAgICAgdmFyIHR4ID0gdGhpcy54IC0gdGhpcy5maXJzdFg7XG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHR4KSA+IHRoaXMudGVycml0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gMTgwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNPbkZsb29yKSB7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gIHRoaXMuc3BlZWQ7XG4gICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gMTgwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52eCAqPSAtMTtcbiAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IC0xO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjYWxlWCA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0dXBBbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNwY2lhbEFuaW1hdGlvbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZyYW1lID0gW107XG4gICAgICAgIHRoaXMuZnJhbWVbXCJzdGFuZFwiXSA9IFsxMywgMTRdO1xuICAgICAgICB0aGlzLmZyYW1lW1wianVtcFwiXSA9IFszNiwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wid2Fsa1wiXSA9IFsgMywgIDQsICA1LCAgNF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJ1cFwiXSA9ICAgWyA5LCAxMCwgMTEsIDEwXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRvd25cIl0gPSBbIDAsICAxLCAgMiwgIDFdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiYXR0YWNrXCJdID0gWyA0MSwgNDIsIDQzLCA0NCwgXCJzdG9wXCJdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGVmZW5zZVwiXSA9IFsgNDEsIDQyLCA0MywgNDQsIFwic3RvcFwiXTtcbiAgICAgICAgdGhpcy5mcmFtZVtcImRhbWFnZVwiXSA9IFsgMTgsIDE5LCAyMF07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJkcm9wXCJdID0gWzE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmZyYW1lW1wiZGVhZFwiXSA9IFsxOCwgMTksIDIwLCAzMywgMzQsIDM1LCBcInN0b3BcIl07XG4gICAgICAgIHRoaXMuZnJhbWVbXCJjbGVhclwiXSA9IFsyNCwgMjUsIDI2XTtcbiAgICAgICAgdGhpcy5mcmFtZVtcInN0dW5cIl0gPSBbIDE4LCAxOSwgMjBdO1xuICAgICAgICB0aGlzLmluZGV4ID0gMDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8v5Zu65a6a5b2x6KGo56S644K744OD44OI44Ki44OD44OXXG4gICAgc2V0dXBGaXhlZFNoYWRvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIHNjID0gdGhpcy53aWR0aCAvIDI0O1xuICAgICAgICBpZiAoc2MgPCAxKSBzYyArPSAwLjI7XG4gICAgICAgIHRoaXMuZml4ZWRTaGFkb3dTcHJpdGUgPSBwaGluYS5kaXNwbGF5LlNwcml0ZShcInNoYWRvd1wiLCAyNCwgOClcbiAgICAgICAgICAgIC5hZGRDaGlsZFRvKHRoaXMucGFyZW50U2NlbmUuc2hhZG93TGF5ZXIpXG4gICAgICAgICAgICAuc2V0QWxwaGEoMC41KVxuICAgICAgICAgICAgLnNldFNjYWxlKHNjLCAxLjApO1xuICAgICAgICB0aGlzLmZpeGVkU2hhZG93U3ByaXRlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5hbHBoYSA9IDAuNTtcbiAgICAgICAgICAgIGlmICh0aGF0LmFscGhhIDwgMC41KSB0aGlzLmFscGhhID0gdGhhdC5hbHBoYTtcbiAgICAgICAgICAgIHRoaXMueCA9IHRoYXQueDtcbiAgICAgICAgICAgIHRoaXMueSA9IHRoYXQueSArIDE2O1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIl19
